(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))p(x);new MutationObserver(x=>{for(const v of x)if(v.type==="childList")for(const T of v.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&p(T)}).observe(document,{childList:!0,subtree:!0});function l(x){const v={};return x.integrity&&(v.integrity=x.integrity),x.referrerPolicy&&(v.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?v.credentials="include":x.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function p(x){if(x.ep)return;x.ep=!0;const v=l(x);fetch(x.href,v)}})();var $a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Bae(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Wae(r){if(r.__esModule)return r;var a=r.default;if(typeof a=="function"){var l=function p(){return this instanceof p?Reflect.construct(a,arguments,this.constructor):a.apply(this,arguments)};l.prototype=a.prototype}else l={};return Object.defineProperty(l,"__esModule",{value:!0}),Object.keys(r).forEach(function(p){var x=Object.getOwnPropertyDescriptor(r,p);Object.defineProperty(l,p,x.get?x:{enumerable:!0,get:function(){return r[p]}})}),l}var _4={exports:{}},wg={},V4={exports:{}},Yt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var d0=Symbol.for("react.element"),zae=Symbol.for("react.portal"),Xae=Symbol.for("react.fragment"),Zae=Symbol.for("react.strict_mode"),Kae=Symbol.for("react.profiler"),$ae=Symbol.for("react.provider"),Uae=Symbol.for("react.context"),Hae=Symbol.for("react.forward_ref"),jae=Symbol.for("react.suspense"),Yae=Symbol.for("react.memo"),Qae=Symbol.for("react.lazy"),jA=Symbol.iterator;function Jae(r){return r===null||typeof r!="object"?null:(r=jA&&r[jA]||r["@@iterator"],typeof r=="function"?r:null)}var B4={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},W4=Object.assign,z4={};function rf(r,a,l){this.props=r,this.context=a,this.refs=z4,this.updater=l||B4}rf.prototype.isReactComponent={};rf.prototype.setState=function(r,a){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,a,"setState")};rf.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function X4(){}X4.prototype=rf.prototype;function uv(r,a,l){this.props=r,this.context=a,this.refs=z4,this.updater=l||B4}var cv=uv.prototype=new X4;cv.constructor=uv;W4(cv,rf.prototype);cv.isPureReactComponent=!0;var YA=Array.isArray,Z4=Object.prototype.hasOwnProperty,hv={current:null},K4={key:!0,ref:!0,__self:!0,__source:!0};function $4(r,a,l){var p,x={},v=null,T=null;if(a!=null)for(p in a.ref!==void 0&&(T=a.ref),a.key!==void 0&&(v=""+a.key),a)Z4.call(a,p)&&!K4.hasOwnProperty(p)&&(x[p]=a[p]);var M=arguments.length-2;if(M===1)x.children=l;else if(1<M){for(var _=Array(M),O=0;O<M;O++)_[O]=arguments[O+2];x.children=_}if(r&&r.defaultProps)for(p in M=r.defaultProps,M)x[p]===void 0&&(x[p]=M[p]);return{$$typeof:d0,type:r,key:v,ref:T,props:x,_owner:hv.current}}function qae(r,a){return{$$typeof:d0,type:r.type,key:a,ref:r.ref,props:r.props,_owner:r._owner}}function dv(r){return typeof r=="object"&&r!==null&&r.$$typeof===d0}function eoe(r){var a={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(l){return a[l]})}var QA=/\/+/g;function qb(r,a){return typeof r=="object"&&r!==null&&r.key!=null?eoe(""+r.key):a.toString(36)}function Im(r,a,l,p,x){var v=typeof r;(v==="undefined"||v==="boolean")&&(r=null);var T=!1;if(r===null)T=!0;else switch(v){case"string":case"number":T=!0;break;case"object":switch(r.$$typeof){case d0:case zae:T=!0}}if(T)return T=r,x=x(T),r=p===""?"."+qb(T,0):p,YA(x)?(l="",r!=null&&(l=r.replace(QA,"$&/")+"/"),Im(x,a,l,"",function(O){return O})):x!=null&&(dv(x)&&(x=qae(x,l+(!x.key||T&&T.key===x.key?"":(""+x.key).replace(QA,"$&/")+"/")+r)),a.push(x)),1;if(T=0,p=p===""?".":p+":",YA(r))for(var M=0;M<r.length;M++){v=r[M];var _=p+qb(v,M);T+=Im(v,a,l,_,x)}else if(_=Jae(r),typeof _=="function")for(r=_.call(r),M=0;!(v=r.next()).done;)v=v.value,_=p+qb(v,M++),T+=Im(v,a,l,_,x);else if(v==="object")throw a=String(r),Error("Objects are not valid as a React child (found: "+(a==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":a)+"). If you meant to render a collection of children, use an array instead.");return T}function Y1(r,a,l){if(r==null)return r;var p=[],x=0;return Im(r,p,"","",function(v){return a.call(l,v,x++)}),p}function toe(r){if(r._status===-1){var a=r._result;a=a(),a.then(function(l){(r._status===0||r._status===-1)&&(r._status=1,r._result=l)},function(l){(r._status===0||r._status===-1)&&(r._status=2,r._result=l)}),r._status===-1&&(r._status=0,r._result=a)}if(r._status===1)return r._result.default;throw r._result}var Qs={current:null},Cm={transition:null},noe={ReactCurrentDispatcher:Qs,ReactCurrentBatchConfig:Cm,ReactCurrentOwner:hv};function U4(){throw Error("act(...) is not supported in production builds of React.")}Yt.Children={map:Y1,forEach:function(r,a,l){Y1(r,function(){a.apply(this,arguments)},l)},count:function(r){var a=0;return Y1(r,function(){a++}),a},toArray:function(r){return Y1(r,function(a){return a})||[]},only:function(r){if(!dv(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};Yt.Component=rf;Yt.Fragment=Xae;Yt.Profiler=Kae;Yt.PureComponent=uv;Yt.StrictMode=Zae;Yt.Suspense=jae;Yt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=noe;Yt.act=U4;Yt.cloneElement=function(r,a,l){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var p=W4({},r.props),x=r.key,v=r.ref,T=r._owner;if(a!=null){if(a.ref!==void 0&&(v=a.ref,T=hv.current),a.key!==void 0&&(x=""+a.key),r.type&&r.type.defaultProps)var M=r.type.defaultProps;for(_ in a)Z4.call(a,_)&&!K4.hasOwnProperty(_)&&(p[_]=a[_]===void 0&&M!==void 0?M[_]:a[_])}var _=arguments.length-2;if(_===1)p.children=l;else if(1<_){M=Array(_);for(var O=0;O<_;O++)M[O]=arguments[O+2];p.children=M}return{$$typeof:d0,type:r.type,key:x,ref:v,props:p,_owner:T}};Yt.createContext=function(r){return r={$$typeof:Uae,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:$ae,_context:r},r.Consumer=r};Yt.createElement=$4;Yt.createFactory=function(r){var a=$4.bind(null,r);return a.type=r,a};Yt.createRef=function(){return{current:null}};Yt.forwardRef=function(r){return{$$typeof:Hae,render:r}};Yt.isValidElement=dv;Yt.lazy=function(r){return{$$typeof:Qae,_payload:{_status:-1,_result:r},_init:toe}};Yt.memo=function(r,a){return{$$typeof:Yae,type:r,compare:a===void 0?null:a}};Yt.startTransition=function(r){var a=Cm.transition;Cm.transition={};try{r()}finally{Cm.transition=a}};Yt.unstable_act=U4;Yt.useCallback=function(r,a){return Qs.current.useCallback(r,a)};Yt.useContext=function(r){return Qs.current.useContext(r)};Yt.useDebugValue=function(){};Yt.useDeferredValue=function(r){return Qs.current.useDeferredValue(r)};Yt.useEffect=function(r,a){return Qs.current.useEffect(r,a)};Yt.useId=function(){return Qs.current.useId()};Yt.useImperativeHandle=function(r,a,l){return Qs.current.useImperativeHandle(r,a,l)};Yt.useInsertionEffect=function(r,a){return Qs.current.useInsertionEffect(r,a)};Yt.useLayoutEffect=function(r,a){return Qs.current.useLayoutEffect(r,a)};Yt.useMemo=function(r,a){return Qs.current.useMemo(r,a)};Yt.useReducer=function(r,a,l){return Qs.current.useReducer(r,a,l)};Yt.useRef=function(r){return Qs.current.useRef(r)};Yt.useState=function(r){return Qs.current.useState(r)};Yt.useSyncExternalStore=function(r,a,l){return Qs.current.useSyncExternalStore(r,a,l)};Yt.useTransition=function(){return Qs.current.useTransition()};Yt.version="18.3.1";V4.exports=Yt;var Ge=V4.exports;const H4=Bae(Ge);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var roe=Ge,soe=Symbol.for("react.element"),ioe=Symbol.for("react.fragment"),aoe=Object.prototype.hasOwnProperty,ooe=roe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,loe={key:!0,ref:!0,__self:!0,__source:!0};function j4(r,a,l){var p,x={},v=null,T=null;l!==void 0&&(v=""+l),a.key!==void 0&&(v=""+a.key),a.ref!==void 0&&(T=a.ref);for(p in a)aoe.call(a,p)&&!loe.hasOwnProperty(p)&&(x[p]=a[p]);if(r&&r.defaultProps)for(p in a=r.defaultProps,a)x[p]===void 0&&(x[p]=a[p]);return{$$typeof:soe,type:r,key:v,ref:T,props:x,_owner:ooe.current}}wg.Fragment=ioe;wg.jsx=j4;wg.jsxs=j4;_4.exports=wg;var xe=_4.exports,X2={},Y4={exports:{}},Gi={},Q4={exports:{}},J4={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function a(Je,xt){var We=Je.length;Je.push(xt);e:for(;0<We;){var yn=We-1>>>1,Lt=Je[yn];if(0<x(Lt,xt))Je[yn]=xt,Je[We]=Lt,We=yn;else break e}}function l(Je){return Je.length===0?null:Je[0]}function p(Je){if(Je.length===0)return null;var xt=Je[0],We=Je.pop();if(We!==xt){Je[0]=We;e:for(var yn=0,Lt=Je.length,qs=Lt>>>1;yn<qs;){var En=2*(yn+1)-1,$n=Je[En],yt=En+1,jr=Je[yt];if(0>x($n,We))yt<Lt&&0>x(jr,$n)?(Je[yn]=jr,Je[yt]=We,yn=yt):(Je[yn]=$n,Je[En]=We,yn=En);else if(yt<Lt&&0>x(jr,We))Je[yn]=jr,Je[yt]=We,yn=yt;else break e}}return xt}function x(Je,xt){var We=Je.sortIndex-xt.sortIndex;return We!==0?We:Je.id-xt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var v=performance;r.unstable_now=function(){return v.now()}}else{var T=Date,M=T.now();r.unstable_now=function(){return T.now()-M}}var _=[],O=[],V=1,D=null,$=3,re=!1,H=!1,se=!1,Ee=typeof setTimeout=="function"?setTimeout:null,ee=typeof clearTimeout=="function"?clearTimeout:null,Y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function j(Je){for(var xt=l(O);xt!==null;){if(xt.callback===null)p(O);else if(xt.startTime<=Je)p(O),xt.sortIndex=xt.expirationTime,a(_,xt);else break;xt=l(O)}}function fe(Je){if(se=!1,j(Je),!H)if(l(_)!==null)H=!0,kn(be);else{var xt=l(O);xt!==null&&ut(fe,xt.startTime-Je)}}function be(Je,xt){H=!1,se&&(se=!1,ee(we),we=-1),re=!0;var We=$;try{for(j(xt),D=l(_);D!==null&&(!(D.expirationTime>xt)||Je&&!Bt());){var yn=D.callback;if(typeof yn=="function"){D.callback=null,$=D.priorityLevel;var Lt=yn(D.expirationTime<=xt);xt=r.unstable_now(),typeof Lt=="function"?D.callback=Lt:D===l(_)&&p(_),j(xt)}else p(_);D=l(_)}if(D!==null)var qs=!0;else{var En=l(O);En!==null&&ut(fe,En.startTime-xt),qs=!1}return qs}finally{D=null,$=We,re=!1}}var Fe=!1,ue=null,we=-1,Ne=5,it=-1;function Bt(){return!(r.unstable_now()-it<Ne)}function ht(){if(ue!==null){var Je=r.unstable_now();it=Je;var xt=!0;try{xt=ue(!0,Je)}finally{xt?_t():(Fe=!1,ue=null)}}else Fe=!1}var _t;if(typeof Y=="function")_t=function(){Y(ht)};else if(typeof MessageChannel<"u"){var fn=new MessageChannel,Pe=fn.port2;fn.port1.onmessage=ht,_t=function(){Pe.postMessage(null)}}else _t=function(){Ee(ht,0)};function kn(Je){ue=Je,Fe||(Fe=!0,_t())}function ut(Je,xt){we=Ee(function(){Je(r.unstable_now())},xt)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(Je){Je.callback=null},r.unstable_continueExecution=function(){H||re||(H=!0,kn(be))},r.unstable_forceFrameRate=function(Je){0>Je||125<Je?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ne=0<Je?Math.floor(1e3/Je):5},r.unstable_getCurrentPriorityLevel=function(){return $},r.unstable_getFirstCallbackNode=function(){return l(_)},r.unstable_next=function(Je){switch($){case 1:case 2:case 3:var xt=3;break;default:xt=$}var We=$;$=xt;try{return Je()}finally{$=We}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(Je,xt){switch(Je){case 1:case 2:case 3:case 4:case 5:break;default:Je=3}var We=$;$=Je;try{return xt()}finally{$=We}},r.unstable_scheduleCallback=function(Je,xt,We){var yn=r.unstable_now();switch(typeof We=="object"&&We!==null?(We=We.delay,We=typeof We=="number"&&0<We?yn+We:yn):We=yn,Je){case 1:var Lt=-1;break;case 2:Lt=250;break;case 5:Lt=1073741823;break;case 4:Lt=1e4;break;default:Lt=5e3}return Lt=We+Lt,Je={id:V++,callback:xt,priorityLevel:Je,startTime:We,expirationTime:Lt,sortIndex:-1},We>yn?(Je.sortIndex=We,a(O,Je),l(_)===null&&Je===l(O)&&(se?(ee(we),we=-1):se=!0,ut(fe,We-yn))):(Je.sortIndex=Lt,a(_,Je),H||re||(H=!0,kn(be))),Je},r.unstable_shouldYield=Bt,r.unstable_wrapCallback=function(Je){var xt=$;return function(){var We=$;$=xt;try{return Je.apply(this,arguments)}finally{$=We}}}})(J4);Q4.exports=J4;var uoe=Q4.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var coe=Ge,Fi=uoe;function je(r){for(var a="https://reactjs.org/docs/error-decoder.html?invariant="+r,l=1;l<arguments.length;l++)a+="&args[]="+encodeURIComponent(arguments[l]);return"Minified React error #"+r+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var q4=new Set,Zp={};function yh(r,a){jd(r,a),jd(r+"Capture",a)}function jd(r,a){for(Zp[r]=a,r=0;r<a.length;r++)q4.add(a[r])}var vl=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Z2=Object.prototype.hasOwnProperty,hoe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,JA={},qA={};function doe(r){return Z2.call(qA,r)?!0:Z2.call(JA,r)?!1:hoe.test(r)?qA[r]=!0:(JA[r]=!0,!1)}function foe(r,a,l,p){if(l!==null&&l.type===0)return!1;switch(typeof a){case"function":case"symbol":return!0;case"boolean":return p?!1:l!==null?!l.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function poe(r,a,l,p){if(a===null||typeof a>"u"||foe(r,a,l,p))return!0;if(p)return!1;if(l!==null)switch(l.type){case 3:return!a;case 4:return a===!1;case 5:return isNaN(a);case 6:return isNaN(a)||1>a}return!1}function Js(r,a,l,p,x,v,T){this.acceptsBooleans=a===2||a===3||a===4,this.attributeName=p,this.attributeNamespace=x,this.mustUseProperty=l,this.propertyName=r,this.type=a,this.sanitizeURL=v,this.removeEmptyString=T}var ws={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){ws[r]=new Js(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var a=r[0];ws[a]=new Js(a,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){ws[r]=new Js(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){ws[r]=new Js(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){ws[r]=new Js(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){ws[r]=new Js(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){ws[r]=new Js(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){ws[r]=new Js(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){ws[r]=new Js(r,5,!1,r.toLowerCase(),null,!1,!1)});var fv=/[\-:]([a-z])/g;function pv(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var a=r.replace(fv,pv);ws[a]=new Js(a,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var a=r.replace(fv,pv);ws[a]=new Js(a,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var a=r.replace(fv,pv);ws[a]=new Js(a,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){ws[r]=new Js(r,1,!1,r.toLowerCase(),null,!1,!1)});ws.xlinkHref=new Js("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){ws[r]=new Js(r,1,!1,r.toLowerCase(),null,!0,!0)});function mv(r,a,l,p){var x=ws.hasOwnProperty(a)?ws[a]:null;(x!==null?x.type!==0:p||!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(poe(a,l,x,p)&&(l=null),p||x===null?doe(a)&&(l===null?r.removeAttribute(a):r.setAttribute(a,""+l)):x.mustUseProperty?r[x.propertyName]=l===null?x.type===3?!1:"":l:(a=x.attributeName,p=x.attributeNamespace,l===null?r.removeAttribute(a):(x=x.type,l=x===3||x===4&&l===!0?"":""+l,p?r.setAttributeNS(p,a,l):r.setAttribute(a,l))))}var El=coe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Q1=Symbol.for("react.element"),Td=Symbol.for("react.portal"),kd=Symbol.for("react.fragment"),gv=Symbol.for("react.strict_mode"),K2=Symbol.for("react.profiler"),eL=Symbol.for("react.provider"),tL=Symbol.for("react.context"),xv=Symbol.for("react.forward_ref"),$2=Symbol.for("react.suspense"),U2=Symbol.for("react.suspense_list"),yv=Symbol.for("react.memo"),Cu=Symbol.for("react.lazy"),nL=Symbol.for("react.offscreen"),eR=Symbol.iterator;function mp(r){return r===null||typeof r!="object"?null:(r=eR&&r[eR]||r["@@iterator"],typeof r=="function"?r:null)}var hr=Object.assign,e2;function Tp(r){if(e2===void 0)try{throw Error()}catch(l){var a=l.stack.trim().match(/\n( *(at )?)/);e2=a&&a[1]||""}return`
`+e2+r}var t2=!1;function n2(r,a){if(!r||t2)return"";t2=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(a)if(a=function(){throw Error()},Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(a,[])}catch(O){var p=O}Reflect.construct(r,[],a)}else{try{a.call()}catch(O){p=O}r.call(a.prototype)}else{try{throw Error()}catch(O){p=O}r()}}catch(O){if(O&&p&&typeof O.stack=="string"){for(var x=O.stack.split(`
`),v=p.stack.split(`
`),T=x.length-1,M=v.length-1;1<=T&&0<=M&&x[T]!==v[M];)M--;for(;1<=T&&0<=M;T--,M--)if(x[T]!==v[M]){if(T!==1||M!==1)do if(T--,M--,0>M||x[T]!==v[M]){var _=`
`+x[T].replace(" at new "," at ");return r.displayName&&_.includes("<anonymous>")&&(_=_.replace("<anonymous>",r.displayName)),_}while(1<=T&&0<=M);break}}}finally{t2=!1,Error.prepareStackTrace=l}return(r=r?r.displayName||r.name:"")?Tp(r):""}function moe(r){switch(r.tag){case 5:return Tp(r.type);case 16:return Tp("Lazy");case 13:return Tp("Suspense");case 19:return Tp("SuspenseList");case 0:case 2:case 15:return r=n2(r.type,!1),r;case 11:return r=n2(r.type.render,!1),r;case 1:return r=n2(r.type,!0),r;default:return""}}function H2(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case kd:return"Fragment";case Td:return"Portal";case K2:return"Profiler";case gv:return"StrictMode";case $2:return"Suspense";case U2:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case tL:return(r.displayName||"Context")+".Consumer";case eL:return(r._context.displayName||"Context")+".Provider";case xv:var a=r.render;return r=r.displayName,r||(r=a.displayName||a.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case yv:return a=r.displayName||null,a!==null?a:H2(r.type)||"Memo";case Cu:a=r._payload,r=r._init;try{return H2(r(a))}catch{}}return null}function goe(r){var a=r.type;switch(r.tag){case 24:return"Cache";case 9:return(a.displayName||"Context")+".Consumer";case 10:return(a._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=a.render,r=r.displayName||r.name||"",a.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return a;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return H2(a);case 8:return a===gv?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a}return null}function Vu(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function rL(r){var a=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function xoe(r){var a=rL(r)?"checked":"value",l=Object.getOwnPropertyDescriptor(r.constructor.prototype,a),p=""+r[a];if(!r.hasOwnProperty(a)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var x=l.get,v=l.set;return Object.defineProperty(r,a,{configurable:!0,get:function(){return x.call(this)},set:function(T){p=""+T,v.call(this,T)}}),Object.defineProperty(r,a,{enumerable:l.enumerable}),{getValue:function(){return p},setValue:function(T){p=""+T},stopTracking:function(){r._valueTracker=null,delete r[a]}}}}function J1(r){r._valueTracker||(r._valueTracker=xoe(r))}function sL(r){if(!r)return!1;var a=r._valueTracker;if(!a)return!0;var l=a.getValue(),p="";return r&&(p=rL(r)?r.checked?"true":"false":r.value),r=p,r!==l?(a.setValue(r),!0):!1}function Bm(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function j2(r,a){var l=a.checked;return hr({},a,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:l??r._wrapperState.initialChecked})}function tR(r,a){var l=a.defaultValue==null?"":a.defaultValue,p=a.checked!=null?a.checked:a.defaultChecked;l=Vu(a.value!=null?a.value:l),r._wrapperState={initialChecked:p,initialValue:l,controlled:a.type==="checkbox"||a.type==="radio"?a.checked!=null:a.value!=null}}function iL(r,a){a=a.checked,a!=null&&mv(r,"checked",a,!1)}function Y2(r,a){iL(r,a);var l=Vu(a.value),p=a.type;if(l!=null)p==="number"?(l===0&&r.value===""||r.value!=l)&&(r.value=""+l):r.value!==""+l&&(r.value=""+l);else if(p==="submit"||p==="reset"){r.removeAttribute("value");return}a.hasOwnProperty("value")?Q2(r,a.type,l):a.hasOwnProperty("defaultValue")&&Q2(r,a.type,Vu(a.defaultValue)),a.checked==null&&a.defaultChecked!=null&&(r.defaultChecked=!!a.defaultChecked)}function nR(r,a,l){if(a.hasOwnProperty("value")||a.hasOwnProperty("defaultValue")){var p=a.type;if(!(p!=="submit"&&p!=="reset"||a.value!==void 0&&a.value!==null))return;a=""+r._wrapperState.initialValue,l||a===r.value||(r.value=a),r.defaultValue=a}l=r.name,l!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,l!==""&&(r.name=l)}function Q2(r,a,l){(a!=="number"||Bm(r.ownerDocument)!==r)&&(l==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+l&&(r.defaultValue=""+l))}var kp=Array.isArray;function zd(r,a,l,p){if(r=r.options,a){a={};for(var x=0;x<l.length;x++)a["$"+l[x]]=!0;for(l=0;l<r.length;l++)x=a.hasOwnProperty("$"+r[l].value),r[l].selected!==x&&(r[l].selected=x),x&&p&&(r[l].defaultSelected=!0)}else{for(l=""+Vu(l),a=null,x=0;x<r.length;x++){if(r[x].value===l){r[x].selected=!0,p&&(r[x].defaultSelected=!0);return}a!==null||r[x].disabled||(a=r[x])}a!==null&&(a.selected=!0)}}function J2(r,a){if(a.dangerouslySetInnerHTML!=null)throw Error(je(91));return hr({},a,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function rR(r,a){var l=a.value;if(l==null){if(l=a.children,a=a.defaultValue,l!=null){if(a!=null)throw Error(je(92));if(kp(l)){if(1<l.length)throw Error(je(93));l=l[0]}a=l}a==null&&(a=""),l=a}r._wrapperState={initialValue:Vu(l)}}function aL(r,a){var l=Vu(a.value),p=Vu(a.defaultValue);l!=null&&(l=""+l,l!==r.value&&(r.value=l),a.defaultValue==null&&r.defaultValue!==l&&(r.defaultValue=l)),p!=null&&(r.defaultValue=""+p)}function sR(r){var a=r.textContent;a===r._wrapperState.initialValue&&a!==""&&a!==null&&(r.value=a)}function oL(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function q2(r,a){return r==null||r==="http://www.w3.org/1999/xhtml"?oL(a):r==="http://www.w3.org/2000/svg"&&a==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var q1,lL=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(a,l,p,x){MSApp.execUnsafeLocalFunction(function(){return r(a,l,p,x)})}:r}(function(r,a){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=a;else{for(q1=q1||document.createElement("div"),q1.innerHTML="<svg>"+a.valueOf().toString()+"</svg>",a=q1.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;a.firstChild;)r.appendChild(a.firstChild)}});function Kp(r,a){if(a){var l=r.firstChild;if(l&&l===r.lastChild&&l.nodeType===3){l.nodeValue=a;return}}r.textContent=a}var Mp={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},yoe=["Webkit","ms","Moz","O"];Object.keys(Mp).forEach(function(r){yoe.forEach(function(a){a=a+r.charAt(0).toUpperCase()+r.substring(1),Mp[a]=Mp[r]})});function uL(r,a,l){return a==null||typeof a=="boolean"||a===""?"":l||typeof a!="number"||a===0||Mp.hasOwnProperty(r)&&Mp[r]?(""+a).trim():a+"px"}function cL(r,a){r=r.style;for(var l in a)if(a.hasOwnProperty(l)){var p=l.indexOf("--")===0,x=uL(l,a[l],p);l==="float"&&(l="cssFloat"),p?r.setProperty(l,x):r[l]=x}}var boe=hr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ew(r,a){if(a){if(boe[r]&&(a.children!=null||a.dangerouslySetInnerHTML!=null))throw Error(je(137,r));if(a.dangerouslySetInnerHTML!=null){if(a.children!=null)throw Error(je(60));if(typeof a.dangerouslySetInnerHTML!="object"||!("__html"in a.dangerouslySetInnerHTML))throw Error(je(61))}if(a.style!=null&&typeof a.style!="object")throw Error(je(62))}}function tw(r,a){if(r.indexOf("-")===-1)return typeof a.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var nw=null;function bv(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var rw=null,Xd=null,Zd=null;function iR(r){if(r=m0(r)){if(typeof rw!="function")throw Error(je(280));var a=r.stateNode;a&&(a=Tg(a),rw(r.stateNode,r.type,a))}}function hL(r){Xd?Zd?Zd.push(r):Zd=[r]:Xd=r}function dL(){if(Xd){var r=Xd,a=Zd;if(Zd=Xd=null,iR(r),a)for(r=0;r<a.length;r++)iR(a[r])}}function fL(r,a){return r(a)}function pL(){}var r2=!1;function mL(r,a,l){if(r2)return r(a,l);r2=!0;try{return fL(r,a,l)}finally{r2=!1,(Xd!==null||Zd!==null)&&(pL(),dL())}}function $p(r,a){var l=r.stateNode;if(l===null)return null;var p=Tg(l);if(p===null)return null;l=p[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(r=r.type,p=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!p;break e;default:r=!1}if(r)return null;if(l&&typeof l!="function")throw Error(je(231,a,typeof l));return l}var sw=!1;if(vl)try{var gp={};Object.defineProperty(gp,"passive",{get:function(){sw=!0}}),window.addEventListener("test",gp,gp),window.removeEventListener("test",gp,gp)}catch{sw=!1}function woe(r,a,l,p,x,v,T,M,_){var O=Array.prototype.slice.call(arguments,3);try{a.apply(l,O)}catch(V){this.onError(V)}}var Lp=!1,Wm=null,zm=!1,iw=null,voe={onError:function(r){Lp=!0,Wm=r}};function Ioe(r,a,l,p,x,v,T,M,_){Lp=!1,Wm=null,woe.apply(voe,arguments)}function Coe(r,a,l,p,x,v,T,M,_){if(Ioe.apply(this,arguments),Lp){if(Lp){var O=Wm;Lp=!1,Wm=null}else throw Error(je(198));zm||(zm=!0,iw=O)}}function bh(r){var a=r,l=r;if(r.alternate)for(;a.return;)a=a.return;else{r=a;do a=r,a.flags&4098&&(l=a.return),r=a.return;while(r)}return a.tag===3?l:null}function gL(r){if(r.tag===13){var a=r.memoizedState;if(a===null&&(r=r.alternate,r!==null&&(a=r.memoizedState)),a!==null)return a.dehydrated}return null}function aR(r){if(bh(r)!==r)throw Error(je(188))}function Soe(r){var a=r.alternate;if(!a){if(a=bh(r),a===null)throw Error(je(188));return a!==r?null:r}for(var l=r,p=a;;){var x=l.return;if(x===null)break;var v=x.alternate;if(v===null){if(p=x.return,p!==null){l=p;continue}break}if(x.child===v.child){for(v=x.child;v;){if(v===l)return aR(x),r;if(v===p)return aR(x),a;v=v.sibling}throw Error(je(188))}if(l.return!==p.return)l=x,p=v;else{for(var T=!1,M=x.child;M;){if(M===l){T=!0,l=x,p=v;break}if(M===p){T=!0,p=x,l=v;break}M=M.sibling}if(!T){for(M=v.child;M;){if(M===l){T=!0,l=v,p=x;break}if(M===p){T=!0,p=v,l=x;break}M=M.sibling}if(!T)throw Error(je(189))}}if(l.alternate!==p)throw Error(je(190))}if(l.tag!==3)throw Error(je(188));return l.stateNode.current===l?r:a}function xL(r){return r=Soe(r),r!==null?yL(r):null}function yL(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var a=yL(r);if(a!==null)return a;r=r.sibling}return null}var bL=Fi.unstable_scheduleCallback,oR=Fi.unstable_cancelCallback,Toe=Fi.unstable_shouldYield,koe=Fi.unstable_requestPaint,Nr=Fi.unstable_now,Eoe=Fi.unstable_getCurrentPriorityLevel,wv=Fi.unstable_ImmediatePriority,wL=Fi.unstable_UserBlockingPriority,Xm=Fi.unstable_NormalPriority,Noe=Fi.unstable_LowPriority,vL=Fi.unstable_IdlePriority,vg=null,Mo=null;function Aoe(r){if(Mo&&typeof Mo.onCommitFiberRoot=="function")try{Mo.onCommitFiberRoot(vg,r,void 0,(r.current.flags&128)===128)}catch{}}var Ha=Math.clz32?Math.clz32:Loe,Roe=Math.log,Moe=Math.LN2;function Loe(r){return r>>>=0,r===0?32:31-(Roe(r)/Moe|0)|0}var em=64,tm=4194304;function Ep(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function Zm(r,a){var l=r.pendingLanes;if(l===0)return 0;var p=0,x=r.suspendedLanes,v=r.pingedLanes,T=l&268435455;if(T!==0){var M=T&~x;M!==0?p=Ep(M):(v&=T,v!==0&&(p=Ep(v)))}else T=l&~x,T!==0?p=Ep(T):v!==0&&(p=Ep(v));if(p===0)return 0;if(a!==0&&a!==p&&!(a&x)&&(x=p&-p,v=a&-a,x>=v||x===16&&(v&4194240)!==0))return a;if(p&4&&(p|=l&16),a=r.entangledLanes,a!==0)for(r=r.entanglements,a&=p;0<a;)l=31-Ha(a),x=1<<l,p|=r[l],a&=~x;return p}function Doe(r,a){switch(r){case 1:case 2:case 4:return a+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ooe(r,a){for(var l=r.suspendedLanes,p=r.pingedLanes,x=r.expirationTimes,v=r.pendingLanes;0<v;){var T=31-Ha(v),M=1<<T,_=x[T];_===-1?(!(M&l)||M&p)&&(x[T]=Doe(M,a)):_<=a&&(r.expiredLanes|=M),v&=~M}}function aw(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function IL(){var r=em;return em<<=1,!(em&4194240)&&(em=64),r}function s2(r){for(var a=[],l=0;31>l;l++)a.push(r);return a}function f0(r,a,l){r.pendingLanes|=a,a!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,a=31-Ha(a),r[a]=l}function Poe(r,a){var l=r.pendingLanes&~a;r.pendingLanes=a,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=a,r.mutableReadLanes&=a,r.entangledLanes&=a,a=r.entanglements;var p=r.eventTimes;for(r=r.expirationTimes;0<l;){var x=31-Ha(l),v=1<<x;a[x]=0,p[x]=-1,r[x]=-1,l&=~v}}function vv(r,a){var l=r.entangledLanes|=a;for(r=r.entanglements;l;){var p=31-Ha(l),x=1<<p;x&a|r[p]&a&&(r[p]|=a),l&=~x}}var In=0;function CL(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var SL,Iv,TL,kL,EL,ow=!1,nm=[],Mu=null,Lu=null,Du=null,Up=new Map,Hp=new Map,Tu=[],Foe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function lR(r,a){switch(r){case"focusin":case"focusout":Mu=null;break;case"dragenter":case"dragleave":Lu=null;break;case"mouseover":case"mouseout":Du=null;break;case"pointerover":case"pointerout":Up.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Hp.delete(a.pointerId)}}function xp(r,a,l,p,x,v){return r===null||r.nativeEvent!==v?(r={blockedOn:a,domEventName:l,eventSystemFlags:p,nativeEvent:v,targetContainers:[x]},a!==null&&(a=m0(a),a!==null&&Iv(a)),r):(r.eventSystemFlags|=p,a=r.targetContainers,x!==null&&a.indexOf(x)===-1&&a.push(x),r)}function Goe(r,a,l,p,x){switch(a){case"focusin":return Mu=xp(Mu,r,a,l,p,x),!0;case"dragenter":return Lu=xp(Lu,r,a,l,p,x),!0;case"mouseover":return Du=xp(Du,r,a,l,p,x),!0;case"pointerover":var v=x.pointerId;return Up.set(v,xp(Up.get(v)||null,r,a,l,p,x)),!0;case"gotpointercapture":return v=x.pointerId,Hp.set(v,xp(Hp.get(v)||null,r,a,l,p,x)),!0}return!1}function NL(r){var a=ih(r.target);if(a!==null){var l=bh(a);if(l!==null){if(a=l.tag,a===13){if(a=gL(l),a!==null){r.blockedOn=a,EL(r.priority,function(){TL(l)});return}}else if(a===3&&l.stateNode.current.memoizedState.isDehydrated){r.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Sm(r){if(r.blockedOn!==null)return!1;for(var a=r.targetContainers;0<a.length;){var l=lw(r.domEventName,r.eventSystemFlags,a[0],r.nativeEvent);if(l===null){l=r.nativeEvent;var p=new l.constructor(l.type,l);nw=p,l.target.dispatchEvent(p),nw=null}else return a=m0(l),a!==null&&Iv(a),r.blockedOn=l,!1;a.shift()}return!0}function uR(r,a,l){Sm(r)&&l.delete(a)}function _oe(){ow=!1,Mu!==null&&Sm(Mu)&&(Mu=null),Lu!==null&&Sm(Lu)&&(Lu=null),Du!==null&&Sm(Du)&&(Du=null),Up.forEach(uR),Hp.forEach(uR)}function yp(r,a){r.blockedOn===a&&(r.blockedOn=null,ow||(ow=!0,Fi.unstable_scheduleCallback(Fi.unstable_NormalPriority,_oe)))}function jp(r){function a(x){return yp(x,r)}if(0<nm.length){yp(nm[0],r);for(var l=1;l<nm.length;l++){var p=nm[l];p.blockedOn===r&&(p.blockedOn=null)}}for(Mu!==null&&yp(Mu,r),Lu!==null&&yp(Lu,r),Du!==null&&yp(Du,r),Up.forEach(a),Hp.forEach(a),l=0;l<Tu.length;l++)p=Tu[l],p.blockedOn===r&&(p.blockedOn=null);for(;0<Tu.length&&(l=Tu[0],l.blockedOn===null);)NL(l),l.blockedOn===null&&Tu.shift()}var Kd=El.ReactCurrentBatchConfig,Km=!0;function Voe(r,a,l,p){var x=In,v=Kd.transition;Kd.transition=null;try{In=1,Cv(r,a,l,p)}finally{In=x,Kd.transition=v}}function Boe(r,a,l,p){var x=In,v=Kd.transition;Kd.transition=null;try{In=4,Cv(r,a,l,p)}finally{In=x,Kd.transition=v}}function Cv(r,a,l,p){if(Km){var x=lw(r,a,l,p);if(x===null)p2(r,a,p,$m,l),lR(r,p);else if(Goe(x,r,a,l,p))p.stopPropagation();else if(lR(r,p),a&4&&-1<Foe.indexOf(r)){for(;x!==null;){var v=m0(x);if(v!==null&&SL(v),v=lw(r,a,l,p),v===null&&p2(r,a,p,$m,l),v===x)break;x=v}x!==null&&p.stopPropagation()}else p2(r,a,p,null,l)}}var $m=null;function lw(r,a,l,p){if($m=null,r=bv(p),r=ih(r),r!==null)if(a=bh(r),a===null)r=null;else if(l=a.tag,l===13){if(r=gL(a),r!==null)return r;r=null}else if(l===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;r=null}else a!==r&&(r=null);return $m=r,null}function AL(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Eoe()){case wv:return 1;case wL:return 4;case Xm:case Noe:return 16;case vL:return 536870912;default:return 16}default:return 16}}var Nu=null,Sv=null,Tm=null;function RL(){if(Tm)return Tm;var r,a=Sv,l=a.length,p,x="value"in Nu?Nu.value:Nu.textContent,v=x.length;for(r=0;r<l&&a[r]===x[r];r++);var T=l-r;for(p=1;p<=T&&a[l-p]===x[v-p];p++);return Tm=x.slice(r,1<p?1-p:void 0)}function km(r){var a=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&a===13&&(r=13)):r=a,r===10&&(r=13),32<=r||r===13?r:0}function rm(){return!0}function cR(){return!1}function _i(r){function a(l,p,x,v,T){this._reactName=l,this._targetInst=x,this.type=p,this.nativeEvent=v,this.target=T,this.currentTarget=null;for(var M in r)r.hasOwnProperty(M)&&(l=r[M],this[M]=l?l(v):v[M]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?rm:cR,this.isPropagationStopped=cR,this}return hr(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=rm)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=rm)},persist:function(){},isPersistent:rm}),a}var sf={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Tv=_i(sf),p0=hr({},sf,{view:0,detail:0}),Woe=_i(p0),i2,a2,bp,Ig=hr({},p0,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kv,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==bp&&(bp&&r.type==="mousemove"?(i2=r.screenX-bp.screenX,a2=r.screenY-bp.screenY):a2=i2=0,bp=r),i2)},movementY:function(r){return"movementY"in r?r.movementY:a2}}),hR=_i(Ig),zoe=hr({},Ig,{dataTransfer:0}),Xoe=_i(zoe),Zoe=hr({},p0,{relatedTarget:0}),o2=_i(Zoe),Koe=hr({},sf,{animationName:0,elapsedTime:0,pseudoElement:0}),$oe=_i(Koe),Uoe=hr({},sf,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),Hoe=_i(Uoe),joe=hr({},sf,{data:0}),dR=_i(joe),Yoe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Qoe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Joe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function qoe(r){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(r):(r=Joe[r])?!!a[r]:!1}function kv(){return qoe}var ele=hr({},p0,{key:function(r){if(r.key){var a=Yoe[r.key]||r.key;if(a!=="Unidentified")return a}return r.type==="keypress"?(r=km(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?Qoe[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kv,charCode:function(r){return r.type==="keypress"?km(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?km(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),tle=_i(ele),nle=hr({},Ig,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),fR=_i(nle),rle=hr({},p0,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kv}),sle=_i(rle),ile=hr({},sf,{propertyName:0,elapsedTime:0,pseudoElement:0}),ale=_i(ile),ole=hr({},Ig,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),lle=_i(ole),ule=[9,13,27,32],Ev=vl&&"CompositionEvent"in window,Dp=null;vl&&"documentMode"in document&&(Dp=document.documentMode);var cle=vl&&"TextEvent"in window&&!Dp,ML=vl&&(!Ev||Dp&&8<Dp&&11>=Dp),pR=" ",mR=!1;function LL(r,a){switch(r){case"keyup":return ule.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function DL(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Ed=!1;function hle(r,a){switch(r){case"compositionend":return DL(a);case"keypress":return a.which!==32?null:(mR=!0,pR);case"textInput":return r=a.data,r===pR&&mR?null:r;default:return null}}function dle(r,a){if(Ed)return r==="compositionend"||!Ev&&LL(r,a)?(r=RL(),Tm=Sv=Nu=null,Ed=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return ML&&a.locale!=="ko"?null:a.data;default:return null}}var fle={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function gR(r){var a=r&&r.nodeName&&r.nodeName.toLowerCase();return a==="input"?!!fle[r.type]:a==="textarea"}function OL(r,a,l,p){hL(p),a=Um(a,"onChange"),0<a.length&&(l=new Tv("onChange","change",null,l,p),r.push({event:l,listeners:a}))}var Op=null,Yp=null;function ple(r){KL(r,0)}function Cg(r){var a=Rd(r);if(sL(a))return r}function mle(r,a){if(r==="change")return a}var PL=!1;if(vl){var l2;if(vl){var u2="oninput"in document;if(!u2){var xR=document.createElement("div");xR.setAttribute("oninput","return;"),u2=typeof xR.oninput=="function"}l2=u2}else l2=!1;PL=l2&&(!document.documentMode||9<document.documentMode)}function yR(){Op&&(Op.detachEvent("onpropertychange",FL),Yp=Op=null)}function FL(r){if(r.propertyName==="value"&&Cg(Yp)){var a=[];OL(a,Yp,r,bv(r)),mL(ple,a)}}function gle(r,a,l){r==="focusin"?(yR(),Op=a,Yp=l,Op.attachEvent("onpropertychange",FL)):r==="focusout"&&yR()}function xle(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Cg(Yp)}function yle(r,a){if(r==="click")return Cg(a)}function ble(r,a){if(r==="input"||r==="change")return Cg(a)}function wle(r,a){return r===a&&(r!==0||1/r===1/a)||r!==r&&a!==a}var Ya=typeof Object.is=="function"?Object.is:wle;function Qp(r,a){if(Ya(r,a))return!0;if(typeof r!="object"||r===null||typeof a!="object"||a===null)return!1;var l=Object.keys(r),p=Object.keys(a);if(l.length!==p.length)return!1;for(p=0;p<l.length;p++){var x=l[p];if(!Z2.call(a,x)||!Ya(r[x],a[x]))return!1}return!0}function bR(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function wR(r,a){var l=bR(r);r=0;for(var p;l;){if(l.nodeType===3){if(p=r+l.textContent.length,r<=a&&p>=a)return{node:l,offset:a-r};r=p}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=bR(l)}}function GL(r,a){return r&&a?r===a?!0:r&&r.nodeType===3?!1:a&&a.nodeType===3?GL(r,a.parentNode):"contains"in r?r.contains(a):r.compareDocumentPosition?!!(r.compareDocumentPosition(a)&16):!1:!1}function _L(){for(var r=window,a=Bm();a instanceof r.HTMLIFrameElement;){try{var l=typeof a.contentWindow.location.href=="string"}catch{l=!1}if(l)r=a.contentWindow;else break;a=Bm(r.document)}return a}function Nv(r){var a=r&&r.nodeName&&r.nodeName.toLowerCase();return a&&(a==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||a==="textarea"||r.contentEditable==="true")}function vle(r){var a=_L(),l=r.focusedElem,p=r.selectionRange;if(a!==l&&l&&l.ownerDocument&&GL(l.ownerDocument.documentElement,l)){if(p!==null&&Nv(l)){if(a=p.start,r=p.end,r===void 0&&(r=a),"selectionStart"in l)l.selectionStart=a,l.selectionEnd=Math.min(r,l.value.length);else if(r=(a=l.ownerDocument||document)&&a.defaultView||window,r.getSelection){r=r.getSelection();var x=l.textContent.length,v=Math.min(p.start,x);p=p.end===void 0?v:Math.min(p.end,x),!r.extend&&v>p&&(x=p,p=v,v=x),x=wR(l,v);var T=wR(l,p);x&&T&&(r.rangeCount!==1||r.anchorNode!==x.node||r.anchorOffset!==x.offset||r.focusNode!==T.node||r.focusOffset!==T.offset)&&(a=a.createRange(),a.setStart(x.node,x.offset),r.removeAllRanges(),v>p?(r.addRange(a),r.extend(T.node,T.offset)):(a.setEnd(T.node,T.offset),r.addRange(a)))}}for(a=[],r=l;r=r.parentNode;)r.nodeType===1&&a.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof l.focus=="function"&&l.focus(),l=0;l<a.length;l++)r=a[l],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var Ile=vl&&"documentMode"in document&&11>=document.documentMode,Nd=null,uw=null,Pp=null,cw=!1;function vR(r,a,l){var p=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;cw||Nd==null||Nd!==Bm(p)||(p=Nd,"selectionStart"in p&&Nv(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),Pp&&Qp(Pp,p)||(Pp=p,p=Um(uw,"onSelect"),0<p.length&&(a=new Tv("onSelect","select",null,a,l),r.push({event:a,listeners:p}),a.target=Nd)))}function sm(r,a){var l={};return l[r.toLowerCase()]=a.toLowerCase(),l["Webkit"+r]="webkit"+a,l["Moz"+r]="moz"+a,l}var Ad={animationend:sm("Animation","AnimationEnd"),animationiteration:sm("Animation","AnimationIteration"),animationstart:sm("Animation","AnimationStart"),transitionend:sm("Transition","TransitionEnd")},c2={},VL={};vl&&(VL=document.createElement("div").style,"AnimationEvent"in window||(delete Ad.animationend.animation,delete Ad.animationiteration.animation,delete Ad.animationstart.animation),"TransitionEvent"in window||delete Ad.transitionend.transition);function Sg(r){if(c2[r])return c2[r];if(!Ad[r])return r;var a=Ad[r],l;for(l in a)if(a.hasOwnProperty(l)&&l in VL)return c2[r]=a[l];return r}var BL=Sg("animationend"),WL=Sg("animationiteration"),zL=Sg("animationstart"),XL=Sg("transitionend"),ZL=new Map,IR="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Zu(r,a){ZL.set(r,a),yh(a,[r])}for(var h2=0;h2<IR.length;h2++){var d2=IR[h2],Cle=d2.toLowerCase(),Sle=d2[0].toUpperCase()+d2.slice(1);Zu(Cle,"on"+Sle)}Zu(BL,"onAnimationEnd");Zu(WL,"onAnimationIteration");Zu(zL,"onAnimationStart");Zu("dblclick","onDoubleClick");Zu("focusin","onFocus");Zu("focusout","onBlur");Zu(XL,"onTransitionEnd");jd("onMouseEnter",["mouseout","mouseover"]);jd("onMouseLeave",["mouseout","mouseover"]);jd("onPointerEnter",["pointerout","pointerover"]);jd("onPointerLeave",["pointerout","pointerover"]);yh("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));yh("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));yh("onBeforeInput",["compositionend","keypress","textInput","paste"]);yh("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));yh("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));yh("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Np="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Tle=new Set("cancel close invalid load scroll toggle".split(" ").concat(Np));function CR(r,a,l){var p=r.type||"unknown-event";r.currentTarget=l,Coe(p,a,void 0,r),r.currentTarget=null}function KL(r,a){a=(a&4)!==0;for(var l=0;l<r.length;l++){var p=r[l],x=p.event;p=p.listeners;e:{var v=void 0;if(a)for(var T=p.length-1;0<=T;T--){var M=p[T],_=M.instance,O=M.currentTarget;if(M=M.listener,_!==v&&x.isPropagationStopped())break e;CR(x,M,O),v=_}else for(T=0;T<p.length;T++){if(M=p[T],_=M.instance,O=M.currentTarget,M=M.listener,_!==v&&x.isPropagationStopped())break e;CR(x,M,O),v=_}}}if(zm)throw r=iw,zm=!1,iw=null,r}function Yn(r,a){var l=a[mw];l===void 0&&(l=a[mw]=new Set);var p=r+"__bubble";l.has(p)||($L(a,r,2,!1),l.add(p))}function f2(r,a,l){var p=0;a&&(p|=4),$L(l,r,p,a)}var im="_reactListening"+Math.random().toString(36).slice(2);function Jp(r){if(!r[im]){r[im]=!0,q4.forEach(function(l){l!=="selectionchange"&&(Tle.has(l)||f2(l,!1,r),f2(l,!0,r))});var a=r.nodeType===9?r:r.ownerDocument;a===null||a[im]||(a[im]=!0,f2("selectionchange",!1,a))}}function $L(r,a,l,p){switch(AL(a)){case 1:var x=Voe;break;case 4:x=Boe;break;default:x=Cv}l=x.bind(null,a,l,r),x=void 0,!sw||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(x=!0),p?x!==void 0?r.addEventListener(a,l,{capture:!0,passive:x}):r.addEventListener(a,l,!0):x!==void 0?r.addEventListener(a,l,{passive:x}):r.addEventListener(a,l,!1)}function p2(r,a,l,p,x){var v=p;if(!(a&1)&&!(a&2)&&p!==null)e:for(;;){if(p===null)return;var T=p.tag;if(T===3||T===4){var M=p.stateNode.containerInfo;if(M===x||M.nodeType===8&&M.parentNode===x)break;if(T===4)for(T=p.return;T!==null;){var _=T.tag;if((_===3||_===4)&&(_=T.stateNode.containerInfo,_===x||_.nodeType===8&&_.parentNode===x))return;T=T.return}for(;M!==null;){if(T=ih(M),T===null)return;if(_=T.tag,_===5||_===6){p=v=T;continue e}M=M.parentNode}}p=p.return}mL(function(){var O=v,V=bv(l),D=[];e:{var $=ZL.get(r);if($!==void 0){var re=Tv,H=r;switch(r){case"keypress":if(km(l)===0)break e;case"keydown":case"keyup":re=tle;break;case"focusin":H="focus",re=o2;break;case"focusout":H="blur",re=o2;break;case"beforeblur":case"afterblur":re=o2;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":re=hR;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":re=Xoe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":re=sle;break;case BL:case WL:case zL:re=$oe;break;case XL:re=ale;break;case"scroll":re=Woe;break;case"wheel":re=lle;break;case"copy":case"cut":case"paste":re=Hoe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":re=fR}var se=(a&4)!==0,Ee=!se&&r==="scroll",ee=se?$!==null?$+"Capture":null:$;se=[];for(var Y=O,j;Y!==null;){j=Y;var fe=j.stateNode;if(j.tag===5&&fe!==null&&(j=fe,ee!==null&&(fe=$p(Y,ee),fe!=null&&se.push(qp(Y,fe,j)))),Ee)break;Y=Y.return}0<se.length&&($=new re($,H,null,l,V),D.push({event:$,listeners:se}))}}if(!(a&7)){e:{if($=r==="mouseover"||r==="pointerover",re=r==="mouseout"||r==="pointerout",$&&l!==nw&&(H=l.relatedTarget||l.fromElement)&&(ih(H)||H[Il]))break e;if((re||$)&&($=V.window===V?V:($=V.ownerDocument)?$.defaultView||$.parentWindow:window,re?(H=l.relatedTarget||l.toElement,re=O,H=H?ih(H):null,H!==null&&(Ee=bh(H),H!==Ee||H.tag!==5&&H.tag!==6)&&(H=null)):(re=null,H=O),re!==H)){if(se=hR,fe="onMouseLeave",ee="onMouseEnter",Y="mouse",(r==="pointerout"||r==="pointerover")&&(se=fR,fe="onPointerLeave",ee="onPointerEnter",Y="pointer"),Ee=re==null?$:Rd(re),j=H==null?$:Rd(H),$=new se(fe,Y+"leave",re,l,V),$.target=Ee,$.relatedTarget=j,fe=null,ih(V)===O&&(se=new se(ee,Y+"enter",H,l,V),se.target=j,se.relatedTarget=Ee,fe=se),Ee=fe,re&&H)t:{for(se=re,ee=H,Y=0,j=se;j;j=Sd(j))Y++;for(j=0,fe=ee;fe;fe=Sd(fe))j++;for(;0<Y-j;)se=Sd(se),Y--;for(;0<j-Y;)ee=Sd(ee),j--;for(;Y--;){if(se===ee||ee!==null&&se===ee.alternate)break t;se=Sd(se),ee=Sd(ee)}se=null}else se=null;re!==null&&SR(D,$,re,se,!1),H!==null&&Ee!==null&&SR(D,Ee,H,se,!0)}}e:{if($=O?Rd(O):window,re=$.nodeName&&$.nodeName.toLowerCase(),re==="select"||re==="input"&&$.type==="file")var be=mle;else if(gR($))if(PL)be=ble;else{be=xle;var Fe=gle}else(re=$.nodeName)&&re.toLowerCase()==="input"&&($.type==="checkbox"||$.type==="radio")&&(be=yle);if(be&&(be=be(r,O))){OL(D,be,l,V);break e}Fe&&Fe(r,$,O),r==="focusout"&&(Fe=$._wrapperState)&&Fe.controlled&&$.type==="number"&&Q2($,"number",$.value)}switch(Fe=O?Rd(O):window,r){case"focusin":(gR(Fe)||Fe.contentEditable==="true")&&(Nd=Fe,uw=O,Pp=null);break;case"focusout":Pp=uw=Nd=null;break;case"mousedown":cw=!0;break;case"contextmenu":case"mouseup":case"dragend":cw=!1,vR(D,l,V);break;case"selectionchange":if(Ile)break;case"keydown":case"keyup":vR(D,l,V)}var ue;if(Ev)e:{switch(r){case"compositionstart":var we="onCompositionStart";break e;case"compositionend":we="onCompositionEnd";break e;case"compositionupdate":we="onCompositionUpdate";break e}we=void 0}else Ed?LL(r,l)&&(we="onCompositionEnd"):r==="keydown"&&l.keyCode===229&&(we="onCompositionStart");we&&(ML&&l.locale!=="ko"&&(Ed||we!=="onCompositionStart"?we==="onCompositionEnd"&&Ed&&(ue=RL()):(Nu=V,Sv="value"in Nu?Nu.value:Nu.textContent,Ed=!0)),Fe=Um(O,we),0<Fe.length&&(we=new dR(we,r,null,l,V),D.push({event:we,listeners:Fe}),ue?we.data=ue:(ue=DL(l),ue!==null&&(we.data=ue)))),(ue=cle?hle(r,l):dle(r,l))&&(O=Um(O,"onBeforeInput"),0<O.length&&(V=new dR("onBeforeInput","beforeinput",null,l,V),D.push({event:V,listeners:O}),V.data=ue))}KL(D,a)})}function qp(r,a,l){return{instance:r,listener:a,currentTarget:l}}function Um(r,a){for(var l=a+"Capture",p=[];r!==null;){var x=r,v=x.stateNode;x.tag===5&&v!==null&&(x=v,v=$p(r,l),v!=null&&p.unshift(qp(r,v,x)),v=$p(r,a),v!=null&&p.push(qp(r,v,x))),r=r.return}return p}function Sd(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function SR(r,a,l,p,x){for(var v=a._reactName,T=[];l!==null&&l!==p;){var M=l,_=M.alternate,O=M.stateNode;if(_!==null&&_===p)break;M.tag===5&&O!==null&&(M=O,x?(_=$p(l,v),_!=null&&T.unshift(qp(l,_,M))):x||(_=$p(l,v),_!=null&&T.push(qp(l,_,M)))),l=l.return}T.length!==0&&r.push({event:a,listeners:T})}var kle=/\r\n?/g,Ele=/\u0000|\uFFFD/g;function TR(r){return(typeof r=="string"?r:""+r).replace(kle,`
`).replace(Ele,"")}function am(r,a,l){if(a=TR(a),TR(r)!==a&&l)throw Error(je(425))}function Hm(){}var hw=null,dw=null;function fw(r,a){return r==="textarea"||r==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var pw=typeof setTimeout=="function"?setTimeout:void 0,Nle=typeof clearTimeout=="function"?clearTimeout:void 0,kR=typeof Promise=="function"?Promise:void 0,Ale=typeof queueMicrotask=="function"?queueMicrotask:typeof kR<"u"?function(r){return kR.resolve(null).then(r).catch(Rle)}:pw;function Rle(r){setTimeout(function(){throw r})}function m2(r,a){var l=a,p=0;do{var x=l.nextSibling;if(r.removeChild(l),x&&x.nodeType===8)if(l=x.data,l==="/$"){if(p===0){r.removeChild(x),jp(a);return}p--}else l!=="$"&&l!=="$?"&&l!=="$!"||p++;l=x}while(l);jp(a)}function Ou(r){for(;r!=null;r=r.nextSibling){var a=r.nodeType;if(a===1||a===3)break;if(a===8){if(a=r.data,a==="$"||a==="$!"||a==="$?")break;if(a==="/$")return null}}return r}function ER(r){r=r.previousSibling;for(var a=0;r;){if(r.nodeType===8){var l=r.data;if(l==="$"||l==="$!"||l==="$?"){if(a===0)return r;a--}else l==="/$"&&a++}r=r.previousSibling}return null}var af=Math.random().toString(36).slice(2),Eo="__reactFiber$"+af,e0="__reactProps$"+af,Il="__reactContainer$"+af,mw="__reactEvents$"+af,Mle="__reactListeners$"+af,Lle="__reactHandles$"+af;function ih(r){var a=r[Eo];if(a)return a;for(var l=r.parentNode;l;){if(a=l[Il]||l[Eo]){if(l=a.alternate,a.child!==null||l!==null&&l.child!==null)for(r=ER(r);r!==null;){if(l=r[Eo])return l;r=ER(r)}return a}r=l,l=r.parentNode}return null}function m0(r){return r=r[Eo]||r[Il],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function Rd(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(je(33))}function Tg(r){return r[e0]||null}var gw=[],Md=-1;function Ku(r){return{current:r}}function Qn(r){0>Md||(r.current=gw[Md],gw[Md]=null,Md--)}function Kn(r,a){Md++,gw[Md]=r.current,r.current=a}var Bu={},Gs=Ku(Bu),fi=Ku(!1),fh=Bu;function Yd(r,a){var l=r.type.contextTypes;if(!l)return Bu;var p=r.stateNode;if(p&&p.__reactInternalMemoizedUnmaskedChildContext===a)return p.__reactInternalMemoizedMaskedChildContext;var x={},v;for(v in l)x[v]=a[v];return p&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=a,r.__reactInternalMemoizedMaskedChildContext=x),x}function pi(r){return r=r.childContextTypes,r!=null}function jm(){Qn(fi),Qn(Gs)}function NR(r,a,l){if(Gs.current!==Bu)throw Error(je(168));Kn(Gs,a),Kn(fi,l)}function UL(r,a,l){var p=r.stateNode;if(a=a.childContextTypes,typeof p.getChildContext!="function")return l;p=p.getChildContext();for(var x in p)if(!(x in a))throw Error(je(108,goe(r)||"Unknown",x));return hr({},l,p)}function Ym(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||Bu,fh=Gs.current,Kn(Gs,r),Kn(fi,fi.current),!0}function AR(r,a,l){var p=r.stateNode;if(!p)throw Error(je(169));l?(r=UL(r,a,fh),p.__reactInternalMemoizedMergedChildContext=r,Qn(fi),Qn(Gs),Kn(Gs,r)):Qn(fi),Kn(fi,l)}var ml=null,kg=!1,g2=!1;function HL(r){ml===null?ml=[r]:ml.push(r)}function Dle(r){kg=!0,HL(r)}function $u(){if(!g2&&ml!==null){g2=!0;var r=0,a=In;try{var l=ml;for(In=1;r<l.length;r++){var p=l[r];do p=p(!0);while(p!==null)}ml=null,kg=!1}catch(x){throw ml!==null&&(ml=ml.slice(r+1)),bL(wv,$u),x}finally{In=a,g2=!1}}return null}var Ld=[],Dd=0,Qm=null,Jm=0,da=[],fa=0,ph=null,gl=1,xl="";function nh(r,a){Ld[Dd++]=Jm,Ld[Dd++]=Qm,Qm=r,Jm=a}function jL(r,a,l){da[fa++]=gl,da[fa++]=xl,da[fa++]=ph,ph=r;var p=gl;r=xl;var x=32-Ha(p)-1;p&=~(1<<x),l+=1;var v=32-Ha(a)+x;if(30<v){var T=x-x%5;v=(p&(1<<T)-1).toString(32),p>>=T,x-=T,gl=1<<32-Ha(a)+x|l<<x|p,xl=v+r}else gl=1<<v|l<<x|p,xl=r}function Av(r){r.return!==null&&(nh(r,1),jL(r,1,0))}function Rv(r){for(;r===Qm;)Qm=Ld[--Dd],Ld[Dd]=null,Jm=Ld[--Dd],Ld[Dd]=null;for(;r===ph;)ph=da[--fa],da[fa]=null,xl=da[--fa],da[fa]=null,gl=da[--fa],da[fa]=null}var Pi=null,Oi=null,rr=!1,Ka=null;function YL(r,a){var l=pa(5,null,null,0);l.elementType="DELETED",l.stateNode=a,l.return=r,a=r.deletions,a===null?(r.deletions=[l],r.flags|=16):a.push(l)}function RR(r,a){switch(r.tag){case 5:var l=r.type;return a=a.nodeType!==1||l.toLowerCase()!==a.nodeName.toLowerCase()?null:a,a!==null?(r.stateNode=a,Pi=r,Oi=Ou(a.firstChild),!0):!1;case 6:return a=r.pendingProps===""||a.nodeType!==3?null:a,a!==null?(r.stateNode=a,Pi=r,Oi=null,!0):!1;case 13:return a=a.nodeType!==8?null:a,a!==null?(l=ph!==null?{id:gl,overflow:xl}:null,r.memoizedState={dehydrated:a,treeContext:l,retryLane:1073741824},l=pa(18,null,null,0),l.stateNode=a,l.return=r,r.child=l,Pi=r,Oi=null,!0):!1;default:return!1}}function xw(r){return(r.mode&1)!==0&&(r.flags&128)===0}function yw(r){if(rr){var a=Oi;if(a){var l=a;if(!RR(r,a)){if(xw(r))throw Error(je(418));a=Ou(l.nextSibling);var p=Pi;a&&RR(r,a)?YL(p,l):(r.flags=r.flags&-4097|2,rr=!1,Pi=r)}}else{if(xw(r))throw Error(je(418));r.flags=r.flags&-4097|2,rr=!1,Pi=r}}}function MR(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;Pi=r}function om(r){if(r!==Pi)return!1;if(!rr)return MR(r),rr=!0,!1;var a;if((a=r.tag!==3)&&!(a=r.tag!==5)&&(a=r.type,a=a!=="head"&&a!=="body"&&!fw(r.type,r.memoizedProps)),a&&(a=Oi)){if(xw(r))throw QL(),Error(je(418));for(;a;)YL(r,a),a=Ou(a.nextSibling)}if(MR(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(je(317));e:{for(r=r.nextSibling,a=0;r;){if(r.nodeType===8){var l=r.data;if(l==="/$"){if(a===0){Oi=Ou(r.nextSibling);break e}a--}else l!=="$"&&l!=="$!"&&l!=="$?"||a++}r=r.nextSibling}Oi=null}}else Oi=Pi?Ou(r.stateNode.nextSibling):null;return!0}function QL(){for(var r=Oi;r;)r=Ou(r.nextSibling)}function Qd(){Oi=Pi=null,rr=!1}function Mv(r){Ka===null?Ka=[r]:Ka.push(r)}var Ole=El.ReactCurrentBatchConfig;function wp(r,a,l){if(r=l.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(l._owner){if(l=l._owner,l){if(l.tag!==1)throw Error(je(309));var p=l.stateNode}if(!p)throw Error(je(147,r));var x=p,v=""+r;return a!==null&&a.ref!==null&&typeof a.ref=="function"&&a.ref._stringRef===v?a.ref:(a=function(T){var M=x.refs;T===null?delete M[v]:M[v]=T},a._stringRef=v,a)}if(typeof r!="string")throw Error(je(284));if(!l._owner)throw Error(je(290,r))}return r}function lm(r,a){throw r=Object.prototype.toString.call(a),Error(je(31,r==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":r))}function LR(r){var a=r._init;return a(r._payload)}function JL(r){function a(ee,Y){if(r){var j=ee.deletions;j===null?(ee.deletions=[Y],ee.flags|=16):j.push(Y)}}function l(ee,Y){if(!r)return null;for(;Y!==null;)a(ee,Y),Y=Y.sibling;return null}function p(ee,Y){for(ee=new Map;Y!==null;)Y.key!==null?ee.set(Y.key,Y):ee.set(Y.index,Y),Y=Y.sibling;return ee}function x(ee,Y){return ee=_u(ee,Y),ee.index=0,ee.sibling=null,ee}function v(ee,Y,j){return ee.index=j,r?(j=ee.alternate,j!==null?(j=j.index,j<Y?(ee.flags|=2,Y):j):(ee.flags|=2,Y)):(ee.flags|=1048576,Y)}function T(ee){return r&&ee.alternate===null&&(ee.flags|=2),ee}function M(ee,Y,j,fe){return Y===null||Y.tag!==6?(Y=C2(j,ee.mode,fe),Y.return=ee,Y):(Y=x(Y,j),Y.return=ee,Y)}function _(ee,Y,j,fe){var be=j.type;return be===kd?V(ee,Y,j.props.children,fe,j.key):Y!==null&&(Y.elementType===be||typeof be=="object"&&be!==null&&be.$$typeof===Cu&&LR(be)===Y.type)?(fe=x(Y,j.props),fe.ref=wp(ee,Y,j),fe.return=ee,fe):(fe=Dm(j.type,j.key,j.props,null,ee.mode,fe),fe.ref=wp(ee,Y,j),fe.return=ee,fe)}function O(ee,Y,j,fe){return Y===null||Y.tag!==4||Y.stateNode.containerInfo!==j.containerInfo||Y.stateNode.implementation!==j.implementation?(Y=S2(j,ee.mode,fe),Y.return=ee,Y):(Y=x(Y,j.children||[]),Y.return=ee,Y)}function V(ee,Y,j,fe,be){return Y===null||Y.tag!==7?(Y=hh(j,ee.mode,fe,be),Y.return=ee,Y):(Y=x(Y,j),Y.return=ee,Y)}function D(ee,Y,j){if(typeof Y=="string"&&Y!==""||typeof Y=="number")return Y=C2(""+Y,ee.mode,j),Y.return=ee,Y;if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case Q1:return j=Dm(Y.type,Y.key,Y.props,null,ee.mode,j),j.ref=wp(ee,null,Y),j.return=ee,j;case Td:return Y=S2(Y,ee.mode,j),Y.return=ee,Y;case Cu:var fe=Y._init;return D(ee,fe(Y._payload),j)}if(kp(Y)||mp(Y))return Y=hh(Y,ee.mode,j,null),Y.return=ee,Y;lm(ee,Y)}return null}function $(ee,Y,j,fe){var be=Y!==null?Y.key:null;if(typeof j=="string"&&j!==""||typeof j=="number")return be!==null?null:M(ee,Y,""+j,fe);if(typeof j=="object"&&j!==null){switch(j.$$typeof){case Q1:return j.key===be?_(ee,Y,j,fe):null;case Td:return j.key===be?O(ee,Y,j,fe):null;case Cu:return be=j._init,$(ee,Y,be(j._payload),fe)}if(kp(j)||mp(j))return be!==null?null:V(ee,Y,j,fe,null);lm(ee,j)}return null}function re(ee,Y,j,fe,be){if(typeof fe=="string"&&fe!==""||typeof fe=="number")return ee=ee.get(j)||null,M(Y,ee,""+fe,be);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case Q1:return ee=ee.get(fe.key===null?j:fe.key)||null,_(Y,ee,fe,be);case Td:return ee=ee.get(fe.key===null?j:fe.key)||null,O(Y,ee,fe,be);case Cu:var Fe=fe._init;return re(ee,Y,j,Fe(fe._payload),be)}if(kp(fe)||mp(fe))return ee=ee.get(j)||null,V(Y,ee,fe,be,null);lm(Y,fe)}return null}function H(ee,Y,j,fe){for(var be=null,Fe=null,ue=Y,we=Y=0,Ne=null;ue!==null&&we<j.length;we++){ue.index>we?(Ne=ue,ue=null):Ne=ue.sibling;var it=$(ee,ue,j[we],fe);if(it===null){ue===null&&(ue=Ne);break}r&&ue&&it.alternate===null&&a(ee,ue),Y=v(it,Y,we),Fe===null?be=it:Fe.sibling=it,Fe=it,ue=Ne}if(we===j.length)return l(ee,ue),rr&&nh(ee,we),be;if(ue===null){for(;we<j.length;we++)ue=D(ee,j[we],fe),ue!==null&&(Y=v(ue,Y,we),Fe===null?be=ue:Fe.sibling=ue,Fe=ue);return rr&&nh(ee,we),be}for(ue=p(ee,ue);we<j.length;we++)Ne=re(ue,ee,we,j[we],fe),Ne!==null&&(r&&Ne.alternate!==null&&ue.delete(Ne.key===null?we:Ne.key),Y=v(Ne,Y,we),Fe===null?be=Ne:Fe.sibling=Ne,Fe=Ne);return r&&ue.forEach(function(Bt){return a(ee,Bt)}),rr&&nh(ee,we),be}function se(ee,Y,j,fe){var be=mp(j);if(typeof be!="function")throw Error(je(150));if(j=be.call(j),j==null)throw Error(je(151));for(var Fe=be=null,ue=Y,we=Y=0,Ne=null,it=j.next();ue!==null&&!it.done;we++,it=j.next()){ue.index>we?(Ne=ue,ue=null):Ne=ue.sibling;var Bt=$(ee,ue,it.value,fe);if(Bt===null){ue===null&&(ue=Ne);break}r&&ue&&Bt.alternate===null&&a(ee,ue),Y=v(Bt,Y,we),Fe===null?be=Bt:Fe.sibling=Bt,Fe=Bt,ue=Ne}if(it.done)return l(ee,ue),rr&&nh(ee,we),be;if(ue===null){for(;!it.done;we++,it=j.next())it=D(ee,it.value,fe),it!==null&&(Y=v(it,Y,we),Fe===null?be=it:Fe.sibling=it,Fe=it);return rr&&nh(ee,we),be}for(ue=p(ee,ue);!it.done;we++,it=j.next())it=re(ue,ee,we,it.value,fe),it!==null&&(r&&it.alternate!==null&&ue.delete(it.key===null?we:it.key),Y=v(it,Y,we),Fe===null?be=it:Fe.sibling=it,Fe=it);return r&&ue.forEach(function(ht){return a(ee,ht)}),rr&&nh(ee,we),be}function Ee(ee,Y,j,fe){if(typeof j=="object"&&j!==null&&j.type===kd&&j.key===null&&(j=j.props.children),typeof j=="object"&&j!==null){switch(j.$$typeof){case Q1:e:{for(var be=j.key,Fe=Y;Fe!==null;){if(Fe.key===be){if(be=j.type,be===kd){if(Fe.tag===7){l(ee,Fe.sibling),Y=x(Fe,j.props.children),Y.return=ee,ee=Y;break e}}else if(Fe.elementType===be||typeof be=="object"&&be!==null&&be.$$typeof===Cu&&LR(be)===Fe.type){l(ee,Fe.sibling),Y=x(Fe,j.props),Y.ref=wp(ee,Fe,j),Y.return=ee,ee=Y;break e}l(ee,Fe);break}else a(ee,Fe);Fe=Fe.sibling}j.type===kd?(Y=hh(j.props.children,ee.mode,fe,j.key),Y.return=ee,ee=Y):(fe=Dm(j.type,j.key,j.props,null,ee.mode,fe),fe.ref=wp(ee,Y,j),fe.return=ee,ee=fe)}return T(ee);case Td:e:{for(Fe=j.key;Y!==null;){if(Y.key===Fe)if(Y.tag===4&&Y.stateNode.containerInfo===j.containerInfo&&Y.stateNode.implementation===j.implementation){l(ee,Y.sibling),Y=x(Y,j.children||[]),Y.return=ee,ee=Y;break e}else{l(ee,Y);break}else a(ee,Y);Y=Y.sibling}Y=S2(j,ee.mode,fe),Y.return=ee,ee=Y}return T(ee);case Cu:return Fe=j._init,Ee(ee,Y,Fe(j._payload),fe)}if(kp(j))return H(ee,Y,j,fe);if(mp(j))return se(ee,Y,j,fe);lm(ee,j)}return typeof j=="string"&&j!==""||typeof j=="number"?(j=""+j,Y!==null&&Y.tag===6?(l(ee,Y.sibling),Y=x(Y,j),Y.return=ee,ee=Y):(l(ee,Y),Y=C2(j,ee.mode,fe),Y.return=ee,ee=Y),T(ee)):l(ee,Y)}return Ee}var Jd=JL(!0),qL=JL(!1),qm=Ku(null),eg=null,Od=null,Lv=null;function Dv(){Lv=Od=eg=null}function Ov(r){var a=qm.current;Qn(qm),r._currentValue=a}function bw(r,a,l){for(;r!==null;){var p=r.alternate;if((r.childLanes&a)!==a?(r.childLanes|=a,p!==null&&(p.childLanes|=a)):p!==null&&(p.childLanes&a)!==a&&(p.childLanes|=a),r===l)break;r=r.return}}function $d(r,a){eg=r,Lv=Od=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&a&&(di=!0),r.firstContext=null)}function ya(r){var a=r._currentValue;if(Lv!==r)if(r={context:r,memoizedValue:a,next:null},Od===null){if(eg===null)throw Error(je(308));Od=r,eg.dependencies={lanes:0,firstContext:r}}else Od=Od.next=r;return a}var ah=null;function Pv(r){ah===null?ah=[r]:ah.push(r)}function eD(r,a,l,p){var x=a.interleaved;return x===null?(l.next=l,Pv(a)):(l.next=x.next,x.next=l),a.interleaved=l,Cl(r,p)}function Cl(r,a){r.lanes|=a;var l=r.alternate;for(l!==null&&(l.lanes|=a),l=r,r=r.return;r!==null;)r.childLanes|=a,l=r.alternate,l!==null&&(l.childLanes|=a),l=r,r=r.return;return l.tag===3?l.stateNode:null}var Su=!1;function Fv(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function tD(r,a){r=r.updateQueue,a.updateQueue===r&&(a.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function bl(r,a){return{eventTime:r,lane:a,tag:0,payload:null,callback:null,next:null}}function Pu(r,a,l){var p=r.updateQueue;if(p===null)return null;if(p=p.shared,un&2){var x=p.pending;return x===null?a.next=a:(a.next=x.next,x.next=a),p.pending=a,Cl(r,l)}return x=p.interleaved,x===null?(a.next=a,Pv(p)):(a.next=x.next,x.next=a),p.interleaved=a,Cl(r,l)}function Em(r,a,l){if(a=a.updateQueue,a!==null&&(a=a.shared,(l&4194240)!==0)){var p=a.lanes;p&=r.pendingLanes,l|=p,a.lanes=l,vv(r,l)}}function DR(r,a){var l=r.updateQueue,p=r.alternate;if(p!==null&&(p=p.updateQueue,l===p)){var x=null,v=null;if(l=l.firstBaseUpdate,l!==null){do{var T={eventTime:l.eventTime,lane:l.lane,tag:l.tag,payload:l.payload,callback:l.callback,next:null};v===null?x=v=T:v=v.next=T,l=l.next}while(l!==null);v===null?x=v=a:v=v.next=a}else x=v=a;l={baseState:p.baseState,firstBaseUpdate:x,lastBaseUpdate:v,shared:p.shared,effects:p.effects},r.updateQueue=l;return}r=l.lastBaseUpdate,r===null?l.firstBaseUpdate=a:r.next=a,l.lastBaseUpdate=a}function tg(r,a,l,p){var x=r.updateQueue;Su=!1;var v=x.firstBaseUpdate,T=x.lastBaseUpdate,M=x.shared.pending;if(M!==null){x.shared.pending=null;var _=M,O=_.next;_.next=null,T===null?v=O:T.next=O,T=_;var V=r.alternate;V!==null&&(V=V.updateQueue,M=V.lastBaseUpdate,M!==T&&(M===null?V.firstBaseUpdate=O:M.next=O,V.lastBaseUpdate=_))}if(v!==null){var D=x.baseState;T=0,V=O=_=null,M=v;do{var $=M.lane,re=M.eventTime;if((p&$)===$){V!==null&&(V=V.next={eventTime:re,lane:0,tag:M.tag,payload:M.payload,callback:M.callback,next:null});e:{var H=r,se=M;switch($=a,re=l,se.tag){case 1:if(H=se.payload,typeof H=="function"){D=H.call(re,D,$);break e}D=H;break e;case 3:H.flags=H.flags&-65537|128;case 0:if(H=se.payload,$=typeof H=="function"?H.call(re,D,$):H,$==null)break e;D=hr({},D,$);break e;case 2:Su=!0}}M.callback!==null&&M.lane!==0&&(r.flags|=64,$=x.effects,$===null?x.effects=[M]:$.push(M))}else re={eventTime:re,lane:$,tag:M.tag,payload:M.payload,callback:M.callback,next:null},V===null?(O=V=re,_=D):V=V.next=re,T|=$;if(M=M.next,M===null){if(M=x.shared.pending,M===null)break;$=M,M=$.next,$.next=null,x.lastBaseUpdate=$,x.shared.pending=null}}while(!0);if(V===null&&(_=D),x.baseState=_,x.firstBaseUpdate=O,x.lastBaseUpdate=V,a=x.shared.interleaved,a!==null){x=a;do T|=x.lane,x=x.next;while(x!==a)}else v===null&&(x.shared.lanes=0);gh|=T,r.lanes=T,r.memoizedState=D}}function OR(r,a,l){if(r=a.effects,a.effects=null,r!==null)for(a=0;a<r.length;a++){var p=r[a],x=p.callback;if(x!==null){if(p.callback=null,p=l,typeof x!="function")throw Error(je(191,x));x.call(p)}}}var g0={},Lo=Ku(g0),t0=Ku(g0),n0=Ku(g0);function oh(r){if(r===g0)throw Error(je(174));return r}function Gv(r,a){switch(Kn(n0,a),Kn(t0,r),Kn(Lo,g0),r=a.nodeType,r){case 9:case 11:a=(a=a.documentElement)?a.namespaceURI:q2(null,"");break;default:r=r===8?a.parentNode:a,a=r.namespaceURI||null,r=r.tagName,a=q2(a,r)}Qn(Lo),Kn(Lo,a)}function qd(){Qn(Lo),Qn(t0),Qn(n0)}function nD(r){oh(n0.current);var a=oh(Lo.current),l=q2(a,r.type);a!==l&&(Kn(t0,r),Kn(Lo,l))}function _v(r){t0.current===r&&(Qn(Lo),Qn(t0))}var lr=Ku(0);function ng(r){for(var a=r;a!==null;){if(a.tag===13){var l=a.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||l.data==="$!"))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if(a.flags&128)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var x2=[];function Vv(){for(var r=0;r<x2.length;r++)x2[r]._workInProgressVersionPrimary=null;x2.length=0}var Nm=El.ReactCurrentDispatcher,y2=El.ReactCurrentBatchConfig,mh=0,cr=null,Ur=null,as=null,rg=!1,Fp=!1,r0=0,Ple=0;function Ds(){throw Error(je(321))}function Bv(r,a){if(a===null)return!1;for(var l=0;l<a.length&&l<r.length;l++)if(!Ya(r[l],a[l]))return!1;return!0}function Wv(r,a,l,p,x,v){if(mh=v,cr=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,Nm.current=r===null||r.memoizedState===null?Vle:Ble,r=l(p,x),Fp){v=0;do{if(Fp=!1,r0=0,25<=v)throw Error(je(301));v+=1,as=Ur=null,a.updateQueue=null,Nm.current=Wle,r=l(p,x)}while(Fp)}if(Nm.current=sg,a=Ur!==null&&Ur.next!==null,mh=0,as=Ur=cr=null,rg=!1,a)throw Error(je(300));return r}function zv(){var r=r0!==0;return r0=0,r}function To(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return as===null?cr.memoizedState=as=r:as=as.next=r,as}function ba(){if(Ur===null){var r=cr.alternate;r=r!==null?r.memoizedState:null}else r=Ur.next;var a=as===null?cr.memoizedState:as.next;if(a!==null)as=a,Ur=r;else{if(r===null)throw Error(je(310));Ur=r,r={memoizedState:Ur.memoizedState,baseState:Ur.baseState,baseQueue:Ur.baseQueue,queue:Ur.queue,next:null},as===null?cr.memoizedState=as=r:as=as.next=r}return as}function s0(r,a){return typeof a=="function"?a(r):a}function b2(r){var a=ba(),l=a.queue;if(l===null)throw Error(je(311));l.lastRenderedReducer=r;var p=Ur,x=p.baseQueue,v=l.pending;if(v!==null){if(x!==null){var T=x.next;x.next=v.next,v.next=T}p.baseQueue=x=v,l.pending=null}if(x!==null){v=x.next,p=p.baseState;var M=T=null,_=null,O=v;do{var V=O.lane;if((mh&V)===V)_!==null&&(_=_.next={lane:0,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null}),p=O.hasEagerState?O.eagerState:r(p,O.action);else{var D={lane:V,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null};_===null?(M=_=D,T=p):_=_.next=D,cr.lanes|=V,gh|=V}O=O.next}while(O!==null&&O!==v);_===null?T=p:_.next=M,Ya(p,a.memoizedState)||(di=!0),a.memoizedState=p,a.baseState=T,a.baseQueue=_,l.lastRenderedState=p}if(r=l.interleaved,r!==null){x=r;do v=x.lane,cr.lanes|=v,gh|=v,x=x.next;while(x!==r)}else x===null&&(l.lanes=0);return[a.memoizedState,l.dispatch]}function w2(r){var a=ba(),l=a.queue;if(l===null)throw Error(je(311));l.lastRenderedReducer=r;var p=l.dispatch,x=l.pending,v=a.memoizedState;if(x!==null){l.pending=null;var T=x=x.next;do v=r(v,T.action),T=T.next;while(T!==x);Ya(v,a.memoizedState)||(di=!0),a.memoizedState=v,a.baseQueue===null&&(a.baseState=v),l.lastRenderedState=v}return[v,p]}function rD(){}function sD(r,a){var l=cr,p=ba(),x=a(),v=!Ya(p.memoizedState,x);if(v&&(p.memoizedState=x,di=!0),p=p.queue,Xv(oD.bind(null,l,p,r),[r]),p.getSnapshot!==a||v||as!==null&&as.memoizedState.tag&1){if(l.flags|=2048,i0(9,aD.bind(null,l,p,x,a),void 0,null),os===null)throw Error(je(349));mh&30||iD(l,a,x)}return x}function iD(r,a,l){r.flags|=16384,r={getSnapshot:a,value:l},a=cr.updateQueue,a===null?(a={lastEffect:null,stores:null},cr.updateQueue=a,a.stores=[r]):(l=a.stores,l===null?a.stores=[r]:l.push(r))}function aD(r,a,l,p){a.value=l,a.getSnapshot=p,lD(a)&&uD(r)}function oD(r,a,l){return l(function(){lD(a)&&uD(r)})}function lD(r){var a=r.getSnapshot;r=r.value;try{var l=a();return!Ya(r,l)}catch{return!0}}function uD(r){var a=Cl(r,1);a!==null&&ja(a,r,1,-1)}function PR(r){var a=To();return typeof r=="function"&&(r=r()),a.memoizedState=a.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:s0,lastRenderedState:r},a.queue=r,r=r.dispatch=_le.bind(null,cr,r),[a.memoizedState,r]}function i0(r,a,l,p){return r={tag:r,create:a,destroy:l,deps:p,next:null},a=cr.updateQueue,a===null?(a={lastEffect:null,stores:null},cr.updateQueue=a,a.lastEffect=r.next=r):(l=a.lastEffect,l===null?a.lastEffect=r.next=r:(p=l.next,l.next=r,r.next=p,a.lastEffect=r)),r}function cD(){return ba().memoizedState}function Am(r,a,l,p){var x=To();cr.flags|=r,x.memoizedState=i0(1|a,l,void 0,p===void 0?null:p)}function Eg(r,a,l,p){var x=ba();p=p===void 0?null:p;var v=void 0;if(Ur!==null){var T=Ur.memoizedState;if(v=T.destroy,p!==null&&Bv(p,T.deps)){x.memoizedState=i0(a,l,v,p);return}}cr.flags|=r,x.memoizedState=i0(1|a,l,v,p)}function FR(r,a){return Am(8390656,8,r,a)}function Xv(r,a){return Eg(2048,8,r,a)}function hD(r,a){return Eg(4,2,r,a)}function dD(r,a){return Eg(4,4,r,a)}function fD(r,a){if(typeof a=="function")return r=r(),a(r),function(){a(null)};if(a!=null)return r=r(),a.current=r,function(){a.current=null}}function pD(r,a,l){return l=l!=null?l.concat([r]):null,Eg(4,4,fD.bind(null,a,r),l)}function Zv(){}function mD(r,a){var l=ba();a=a===void 0?null:a;var p=l.memoizedState;return p!==null&&a!==null&&Bv(a,p[1])?p[0]:(l.memoizedState=[r,a],r)}function gD(r,a){var l=ba();a=a===void 0?null:a;var p=l.memoizedState;return p!==null&&a!==null&&Bv(a,p[1])?p[0]:(r=r(),l.memoizedState=[r,a],r)}function xD(r,a,l){return mh&21?(Ya(l,a)||(l=IL(),cr.lanes|=l,gh|=l,r.baseState=!0),a):(r.baseState&&(r.baseState=!1,di=!0),r.memoizedState=l)}function Fle(r,a){var l=In;In=l!==0&&4>l?l:4,r(!0);var p=y2.transition;y2.transition={};try{r(!1),a()}finally{In=l,y2.transition=p}}function yD(){return ba().memoizedState}function Gle(r,a,l){var p=Gu(r);if(l={lane:p,action:l,hasEagerState:!1,eagerState:null,next:null},bD(r))wD(a,l);else if(l=eD(r,a,l,p),l!==null){var x=Ys();ja(l,r,p,x),vD(l,a,p)}}function _le(r,a,l){var p=Gu(r),x={lane:p,action:l,hasEagerState:!1,eagerState:null,next:null};if(bD(r))wD(a,x);else{var v=r.alternate;if(r.lanes===0&&(v===null||v.lanes===0)&&(v=a.lastRenderedReducer,v!==null))try{var T=a.lastRenderedState,M=v(T,l);if(x.hasEagerState=!0,x.eagerState=M,Ya(M,T)){var _=a.interleaved;_===null?(x.next=x,Pv(a)):(x.next=_.next,_.next=x),a.interleaved=x;return}}catch{}finally{}l=eD(r,a,x,p),l!==null&&(x=Ys(),ja(l,r,p,x),vD(l,a,p))}}function bD(r){var a=r.alternate;return r===cr||a!==null&&a===cr}function wD(r,a){Fp=rg=!0;var l=r.pending;l===null?a.next=a:(a.next=l.next,l.next=a),r.pending=a}function vD(r,a,l){if(l&4194240){var p=a.lanes;p&=r.pendingLanes,l|=p,a.lanes=l,vv(r,l)}}var sg={readContext:ya,useCallback:Ds,useContext:Ds,useEffect:Ds,useImperativeHandle:Ds,useInsertionEffect:Ds,useLayoutEffect:Ds,useMemo:Ds,useReducer:Ds,useRef:Ds,useState:Ds,useDebugValue:Ds,useDeferredValue:Ds,useTransition:Ds,useMutableSource:Ds,useSyncExternalStore:Ds,useId:Ds,unstable_isNewReconciler:!1},Vle={readContext:ya,useCallback:function(r,a){return To().memoizedState=[r,a===void 0?null:a],r},useContext:ya,useEffect:FR,useImperativeHandle:function(r,a,l){return l=l!=null?l.concat([r]):null,Am(4194308,4,fD.bind(null,a,r),l)},useLayoutEffect:function(r,a){return Am(4194308,4,r,a)},useInsertionEffect:function(r,a){return Am(4,2,r,a)},useMemo:function(r,a){var l=To();return a=a===void 0?null:a,r=r(),l.memoizedState=[r,a],r},useReducer:function(r,a,l){var p=To();return a=l!==void 0?l(a):a,p.memoizedState=p.baseState=a,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:a},p.queue=r,r=r.dispatch=Gle.bind(null,cr,r),[p.memoizedState,r]},useRef:function(r){var a=To();return r={current:r},a.memoizedState=r},useState:PR,useDebugValue:Zv,useDeferredValue:function(r){return To().memoizedState=r},useTransition:function(){var r=PR(!1),a=r[0];return r=Fle.bind(null,r[1]),To().memoizedState=r,[a,r]},useMutableSource:function(){},useSyncExternalStore:function(r,a,l){var p=cr,x=To();if(rr){if(l===void 0)throw Error(je(407));l=l()}else{if(l=a(),os===null)throw Error(je(349));mh&30||iD(p,a,l)}x.memoizedState=l;var v={value:l,getSnapshot:a};return x.queue=v,FR(oD.bind(null,p,v,r),[r]),p.flags|=2048,i0(9,aD.bind(null,p,v,l,a),void 0,null),l},useId:function(){var r=To(),a=os.identifierPrefix;if(rr){var l=xl,p=gl;l=(p&~(1<<32-Ha(p)-1)).toString(32)+l,a=":"+a+"R"+l,l=r0++,0<l&&(a+="H"+l.toString(32)),a+=":"}else l=Ple++,a=":"+a+"r"+l.toString(32)+":";return r.memoizedState=a},unstable_isNewReconciler:!1},Ble={readContext:ya,useCallback:mD,useContext:ya,useEffect:Xv,useImperativeHandle:pD,useInsertionEffect:hD,useLayoutEffect:dD,useMemo:gD,useReducer:b2,useRef:cD,useState:function(){return b2(s0)},useDebugValue:Zv,useDeferredValue:function(r){var a=ba();return xD(a,Ur.memoizedState,r)},useTransition:function(){var r=b2(s0)[0],a=ba().memoizedState;return[r,a]},useMutableSource:rD,useSyncExternalStore:sD,useId:yD,unstable_isNewReconciler:!1},Wle={readContext:ya,useCallback:mD,useContext:ya,useEffect:Xv,useImperativeHandle:pD,useInsertionEffect:hD,useLayoutEffect:dD,useMemo:gD,useReducer:w2,useRef:cD,useState:function(){return w2(s0)},useDebugValue:Zv,useDeferredValue:function(r){var a=ba();return Ur===null?a.memoizedState=r:xD(a,Ur.memoizedState,r)},useTransition:function(){var r=w2(s0)[0],a=ba().memoizedState;return[r,a]},useMutableSource:rD,useSyncExternalStore:sD,useId:yD,unstable_isNewReconciler:!1};function za(r,a){if(r&&r.defaultProps){a=hr({},a),r=r.defaultProps;for(var l in r)a[l]===void 0&&(a[l]=r[l]);return a}return a}function ww(r,a,l,p){a=r.memoizedState,l=l(p,a),l=l==null?a:hr({},a,l),r.memoizedState=l,r.lanes===0&&(r.updateQueue.baseState=l)}var Ng={isMounted:function(r){return(r=r._reactInternals)?bh(r)===r:!1},enqueueSetState:function(r,a,l){r=r._reactInternals;var p=Ys(),x=Gu(r),v=bl(p,x);v.payload=a,l!=null&&(v.callback=l),a=Pu(r,v,x),a!==null&&(ja(a,r,x,p),Em(a,r,x))},enqueueReplaceState:function(r,a,l){r=r._reactInternals;var p=Ys(),x=Gu(r),v=bl(p,x);v.tag=1,v.payload=a,l!=null&&(v.callback=l),a=Pu(r,v,x),a!==null&&(ja(a,r,x,p),Em(a,r,x))},enqueueForceUpdate:function(r,a){r=r._reactInternals;var l=Ys(),p=Gu(r),x=bl(l,p);x.tag=2,a!=null&&(x.callback=a),a=Pu(r,x,p),a!==null&&(ja(a,r,p,l),Em(a,r,p))}};function GR(r,a,l,p,x,v,T){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(p,v,T):a.prototype&&a.prototype.isPureReactComponent?!Qp(l,p)||!Qp(x,v):!0}function ID(r,a,l){var p=!1,x=Bu,v=a.contextType;return typeof v=="object"&&v!==null?v=ya(v):(x=pi(a)?fh:Gs.current,p=a.contextTypes,v=(p=p!=null)?Yd(r,x):Bu),a=new a(l,v),r.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,a.updater=Ng,r.stateNode=a,a._reactInternals=r,p&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=x,r.__reactInternalMemoizedMaskedChildContext=v),a}function _R(r,a,l,p){r=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(l,p),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(l,p),a.state!==r&&Ng.enqueueReplaceState(a,a.state,null)}function vw(r,a,l,p){var x=r.stateNode;x.props=l,x.state=r.memoizedState,x.refs={},Fv(r);var v=a.contextType;typeof v=="object"&&v!==null?x.context=ya(v):(v=pi(a)?fh:Gs.current,x.context=Yd(r,v)),x.state=r.memoizedState,v=a.getDerivedStateFromProps,typeof v=="function"&&(ww(r,a,v,l),x.state=r.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(a=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),a!==x.state&&Ng.enqueueReplaceState(x,x.state,null),tg(r,l,x,p),x.state=r.memoizedState),typeof x.componentDidMount=="function"&&(r.flags|=4194308)}function ef(r,a){try{var l="",p=a;do l+=moe(p),p=p.return;while(p);var x=l}catch(v){x=`
Error generating stack: `+v.message+`
`+v.stack}return{value:r,source:a,stack:x,digest:null}}function v2(r,a,l){return{value:r,source:null,stack:l??null,digest:a??null}}function Iw(r,a){try{console.error(a.value)}catch(l){setTimeout(function(){throw l})}}var zle=typeof WeakMap=="function"?WeakMap:Map;function CD(r,a,l){l=bl(-1,l),l.tag=3,l.payload={element:null};var p=a.value;return l.callback=function(){ag||(ag=!0,Lw=p),Iw(r,a)},l}function SD(r,a,l){l=bl(-1,l),l.tag=3;var p=r.type.getDerivedStateFromError;if(typeof p=="function"){var x=a.value;l.payload=function(){return p(x)},l.callback=function(){Iw(r,a)}}var v=r.stateNode;return v!==null&&typeof v.componentDidCatch=="function"&&(l.callback=function(){Iw(r,a),typeof p!="function"&&(Fu===null?Fu=new Set([this]):Fu.add(this));var T=a.stack;this.componentDidCatch(a.value,{componentStack:T!==null?T:""})}),l}function VR(r,a,l){var p=r.pingCache;if(p===null){p=r.pingCache=new zle;var x=new Set;p.set(a,x)}else x=p.get(a),x===void 0&&(x=new Set,p.set(a,x));x.has(l)||(x.add(l),r=nue.bind(null,r,a,l),a.then(r,r))}function BR(r){do{var a;if((a=r.tag===13)&&(a=r.memoizedState,a=a!==null?a.dehydrated!==null:!0),a)return r;r=r.return}while(r!==null);return null}function WR(r,a,l,p,x){return r.mode&1?(r.flags|=65536,r.lanes=x,r):(r===a?r.flags|=65536:(r.flags|=128,l.flags|=131072,l.flags&=-52805,l.tag===1&&(l.alternate===null?l.tag=17:(a=bl(-1,1),a.tag=2,Pu(l,a,1))),l.lanes|=1),r)}var Xle=El.ReactCurrentOwner,di=!1;function Us(r,a,l,p){a.child=r===null?qL(a,null,l,p):Jd(a,r.child,l,p)}function zR(r,a,l,p,x){l=l.render;var v=a.ref;return $d(a,x),p=Wv(r,a,l,p,v,x),l=zv(),r!==null&&!di?(a.updateQueue=r.updateQueue,a.flags&=-2053,r.lanes&=~x,Sl(r,a,x)):(rr&&l&&Av(a),a.flags|=1,Us(r,a,p,x),a.child)}function XR(r,a,l,p,x){if(r===null){var v=l.type;return typeof v=="function"&&!Jv(v)&&v.defaultProps===void 0&&l.compare===null&&l.defaultProps===void 0?(a.tag=15,a.type=v,TD(r,a,v,p,x)):(r=Dm(l.type,null,p,a,a.mode,x),r.ref=a.ref,r.return=a,a.child=r)}if(v=r.child,!(r.lanes&x)){var T=v.memoizedProps;if(l=l.compare,l=l!==null?l:Qp,l(T,p)&&r.ref===a.ref)return Sl(r,a,x)}return a.flags|=1,r=_u(v,p),r.ref=a.ref,r.return=a,a.child=r}function TD(r,a,l,p,x){if(r!==null){var v=r.memoizedProps;if(Qp(v,p)&&r.ref===a.ref)if(di=!1,a.pendingProps=p=v,(r.lanes&x)!==0)r.flags&131072&&(di=!0);else return a.lanes=r.lanes,Sl(r,a,x)}return Cw(r,a,l,p,x)}function kD(r,a,l){var p=a.pendingProps,x=p.children,v=r!==null?r.memoizedState:null;if(p.mode==="hidden")if(!(a.mode&1))a.memoizedState={baseLanes:0,cachePool:null,transitions:null},Kn(Fd,Li),Li|=l;else{if(!(l&1073741824))return r=v!==null?v.baseLanes|l:l,a.lanes=a.childLanes=1073741824,a.memoizedState={baseLanes:r,cachePool:null,transitions:null},a.updateQueue=null,Kn(Fd,Li),Li|=r,null;a.memoizedState={baseLanes:0,cachePool:null,transitions:null},p=v!==null?v.baseLanes:l,Kn(Fd,Li),Li|=p}else v!==null?(p=v.baseLanes|l,a.memoizedState=null):p=l,Kn(Fd,Li),Li|=p;return Us(r,a,x,l),a.child}function ED(r,a){var l=a.ref;(r===null&&l!==null||r!==null&&r.ref!==l)&&(a.flags|=512,a.flags|=2097152)}function Cw(r,a,l,p,x){var v=pi(l)?fh:Gs.current;return v=Yd(a,v),$d(a,x),l=Wv(r,a,l,p,v,x),p=zv(),r!==null&&!di?(a.updateQueue=r.updateQueue,a.flags&=-2053,r.lanes&=~x,Sl(r,a,x)):(rr&&p&&Av(a),a.flags|=1,Us(r,a,l,x),a.child)}function ZR(r,a,l,p,x){if(pi(l)){var v=!0;Ym(a)}else v=!1;if($d(a,x),a.stateNode===null)Rm(r,a),ID(a,l,p),vw(a,l,p,x),p=!0;else if(r===null){var T=a.stateNode,M=a.memoizedProps;T.props=M;var _=T.context,O=l.contextType;typeof O=="object"&&O!==null?O=ya(O):(O=pi(l)?fh:Gs.current,O=Yd(a,O));var V=l.getDerivedStateFromProps,D=typeof V=="function"||typeof T.getSnapshotBeforeUpdate=="function";D||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(M!==p||_!==O)&&_R(a,T,p,O),Su=!1;var $=a.memoizedState;T.state=$,tg(a,p,T,x),_=a.memoizedState,M!==p||$!==_||fi.current||Su?(typeof V=="function"&&(ww(a,l,V,p),_=a.memoizedState),(M=Su||GR(a,l,M,p,$,_,O))?(D||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(a.flags|=4194308)):(typeof T.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=p,a.memoizedState=_),T.props=p,T.state=_,T.context=O,p=M):(typeof T.componentDidMount=="function"&&(a.flags|=4194308),p=!1)}else{T=a.stateNode,tD(r,a),M=a.memoizedProps,O=a.type===a.elementType?M:za(a.type,M),T.props=O,D=a.pendingProps,$=T.context,_=l.contextType,typeof _=="object"&&_!==null?_=ya(_):(_=pi(l)?fh:Gs.current,_=Yd(a,_));var re=l.getDerivedStateFromProps;(V=typeof re=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(M!==D||$!==_)&&_R(a,T,p,_),Su=!1,$=a.memoizedState,T.state=$,tg(a,p,T,x);var H=a.memoizedState;M!==D||$!==H||fi.current||Su?(typeof re=="function"&&(ww(a,l,re,p),H=a.memoizedState),(O=Su||GR(a,l,O,p,$,H,_)||!1)?(V||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(p,H,_),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(p,H,_)),typeof T.componentDidUpdate=="function"&&(a.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof T.componentDidUpdate!="function"||M===r.memoizedProps&&$===r.memoizedState||(a.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||M===r.memoizedProps&&$===r.memoizedState||(a.flags|=1024),a.memoizedProps=p,a.memoizedState=H),T.props=p,T.state=H,T.context=_,p=O):(typeof T.componentDidUpdate!="function"||M===r.memoizedProps&&$===r.memoizedState||(a.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||M===r.memoizedProps&&$===r.memoizedState||(a.flags|=1024),p=!1)}return Sw(r,a,l,p,v,x)}function Sw(r,a,l,p,x,v){ED(r,a);var T=(a.flags&128)!==0;if(!p&&!T)return x&&AR(a,l,!1),Sl(r,a,v);p=a.stateNode,Xle.current=a;var M=T&&typeof l.getDerivedStateFromError!="function"?null:p.render();return a.flags|=1,r!==null&&T?(a.child=Jd(a,r.child,null,v),a.child=Jd(a,null,M,v)):Us(r,a,M,v),a.memoizedState=p.state,x&&AR(a,l,!0),a.child}function ND(r){var a=r.stateNode;a.pendingContext?NR(r,a.pendingContext,a.pendingContext!==a.context):a.context&&NR(r,a.context,!1),Gv(r,a.containerInfo)}function KR(r,a,l,p,x){return Qd(),Mv(x),a.flags|=256,Us(r,a,l,p),a.child}var Tw={dehydrated:null,treeContext:null,retryLane:0};function kw(r){return{baseLanes:r,cachePool:null,transitions:null}}function AD(r,a,l){var p=a.pendingProps,x=lr.current,v=!1,T=(a.flags&128)!==0,M;if((M=T)||(M=r!==null&&r.memoizedState===null?!1:(x&2)!==0),M?(v=!0,a.flags&=-129):(r===null||r.memoizedState!==null)&&(x|=1),Kn(lr,x&1),r===null)return yw(a),r=a.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(a.mode&1?r.data==="$!"?a.lanes=8:a.lanes=1073741824:a.lanes=1,null):(T=p.children,r=p.fallback,v?(p=a.mode,v=a.child,T={mode:"hidden",children:T},!(p&1)&&v!==null?(v.childLanes=0,v.pendingProps=T):v=Mg(T,p,0,null),r=hh(r,p,l,null),v.return=a,r.return=a,v.sibling=r,a.child=v,a.child.memoizedState=kw(l),a.memoizedState=Tw,r):Kv(a,T));if(x=r.memoizedState,x!==null&&(M=x.dehydrated,M!==null))return Zle(r,a,T,p,M,x,l);if(v){v=p.fallback,T=a.mode,x=r.child,M=x.sibling;var _={mode:"hidden",children:p.children};return!(T&1)&&a.child!==x?(p=a.child,p.childLanes=0,p.pendingProps=_,a.deletions=null):(p=_u(x,_),p.subtreeFlags=x.subtreeFlags&14680064),M!==null?v=_u(M,v):(v=hh(v,T,l,null),v.flags|=2),v.return=a,p.return=a,p.sibling=v,a.child=p,p=v,v=a.child,T=r.child.memoizedState,T=T===null?kw(l):{baseLanes:T.baseLanes|l,cachePool:null,transitions:T.transitions},v.memoizedState=T,v.childLanes=r.childLanes&~l,a.memoizedState=Tw,p}return v=r.child,r=v.sibling,p=_u(v,{mode:"visible",children:p.children}),!(a.mode&1)&&(p.lanes=l),p.return=a,p.sibling=null,r!==null&&(l=a.deletions,l===null?(a.deletions=[r],a.flags|=16):l.push(r)),a.child=p,a.memoizedState=null,p}function Kv(r,a){return a=Mg({mode:"visible",children:a},r.mode,0,null),a.return=r,r.child=a}function um(r,a,l,p){return p!==null&&Mv(p),Jd(a,r.child,null,l),r=Kv(a,a.pendingProps.children),r.flags|=2,a.memoizedState=null,r}function Zle(r,a,l,p,x,v,T){if(l)return a.flags&256?(a.flags&=-257,p=v2(Error(je(422))),um(r,a,T,p)):a.memoizedState!==null?(a.child=r.child,a.flags|=128,null):(v=p.fallback,x=a.mode,p=Mg({mode:"visible",children:p.children},x,0,null),v=hh(v,x,T,null),v.flags|=2,p.return=a,v.return=a,p.sibling=v,a.child=p,a.mode&1&&Jd(a,r.child,null,T),a.child.memoizedState=kw(T),a.memoizedState=Tw,v);if(!(a.mode&1))return um(r,a,T,null);if(x.data==="$!"){if(p=x.nextSibling&&x.nextSibling.dataset,p)var M=p.dgst;return p=M,v=Error(je(419)),p=v2(v,p,void 0),um(r,a,T,p)}if(M=(T&r.childLanes)!==0,di||M){if(p=os,p!==null){switch(T&-T){case 4:x=2;break;case 16:x=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:x=32;break;case 536870912:x=268435456;break;default:x=0}x=x&(p.suspendedLanes|T)?0:x,x!==0&&x!==v.retryLane&&(v.retryLane=x,Cl(r,x),ja(p,r,x,-1))}return Qv(),p=v2(Error(je(421))),um(r,a,T,p)}return x.data==="$?"?(a.flags|=128,a.child=r.child,a=rue.bind(null,r),x._reactRetry=a,null):(r=v.treeContext,Oi=Ou(x.nextSibling),Pi=a,rr=!0,Ka=null,r!==null&&(da[fa++]=gl,da[fa++]=xl,da[fa++]=ph,gl=r.id,xl=r.overflow,ph=a),a=Kv(a,p.children),a.flags|=4096,a)}function $R(r,a,l){r.lanes|=a;var p=r.alternate;p!==null&&(p.lanes|=a),bw(r.return,a,l)}function I2(r,a,l,p,x){var v=r.memoizedState;v===null?r.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:p,tail:l,tailMode:x}:(v.isBackwards=a,v.rendering=null,v.renderingStartTime=0,v.last=p,v.tail=l,v.tailMode=x)}function RD(r,a,l){var p=a.pendingProps,x=p.revealOrder,v=p.tail;if(Us(r,a,p.children,l),p=lr.current,p&2)p=p&1|2,a.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=a.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&$R(r,l,a);else if(r.tag===19)$R(r,l,a);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===a)break e;for(;r.sibling===null;){if(r.return===null||r.return===a)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}p&=1}if(Kn(lr,p),!(a.mode&1))a.memoizedState=null;else switch(x){case"forwards":for(l=a.child,x=null;l!==null;)r=l.alternate,r!==null&&ng(r)===null&&(x=l),l=l.sibling;l=x,l===null?(x=a.child,a.child=null):(x=l.sibling,l.sibling=null),I2(a,!1,x,l,v);break;case"backwards":for(l=null,x=a.child,a.child=null;x!==null;){if(r=x.alternate,r!==null&&ng(r)===null){a.child=x;break}r=x.sibling,x.sibling=l,l=x,x=r}I2(a,!0,l,null,v);break;case"together":I2(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function Rm(r,a){!(a.mode&1)&&r!==null&&(r.alternate=null,a.alternate=null,a.flags|=2)}function Sl(r,a,l){if(r!==null&&(a.dependencies=r.dependencies),gh|=a.lanes,!(l&a.childLanes))return null;if(r!==null&&a.child!==r.child)throw Error(je(153));if(a.child!==null){for(r=a.child,l=_u(r,r.pendingProps),a.child=l,l.return=a;r.sibling!==null;)r=r.sibling,l=l.sibling=_u(r,r.pendingProps),l.return=a;l.sibling=null}return a.child}function Kle(r,a,l){switch(a.tag){case 3:ND(a),Qd();break;case 5:nD(a);break;case 1:pi(a.type)&&Ym(a);break;case 4:Gv(a,a.stateNode.containerInfo);break;case 10:var p=a.type._context,x=a.memoizedProps.value;Kn(qm,p._currentValue),p._currentValue=x;break;case 13:if(p=a.memoizedState,p!==null)return p.dehydrated!==null?(Kn(lr,lr.current&1),a.flags|=128,null):l&a.child.childLanes?AD(r,a,l):(Kn(lr,lr.current&1),r=Sl(r,a,l),r!==null?r.sibling:null);Kn(lr,lr.current&1);break;case 19:if(p=(l&a.childLanes)!==0,r.flags&128){if(p)return RD(r,a,l);a.flags|=128}if(x=a.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),Kn(lr,lr.current),p)break;return null;case 22:case 23:return a.lanes=0,kD(r,a,l)}return Sl(r,a,l)}var MD,Ew,LD,DD;MD=function(r,a){for(var l=a.child;l!==null;){if(l.tag===5||l.tag===6)r.appendChild(l.stateNode);else if(l.tag!==4&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return;l=l.return}l.sibling.return=l.return,l=l.sibling}};Ew=function(){};LD=function(r,a,l,p){var x=r.memoizedProps;if(x!==p){r=a.stateNode,oh(Lo.current);var v=null;switch(l){case"input":x=j2(r,x),p=j2(r,p),v=[];break;case"select":x=hr({},x,{value:void 0}),p=hr({},p,{value:void 0}),v=[];break;case"textarea":x=J2(r,x),p=J2(r,p),v=[];break;default:typeof x.onClick!="function"&&typeof p.onClick=="function"&&(r.onclick=Hm)}ew(l,p);var T;l=null;for(O in x)if(!p.hasOwnProperty(O)&&x.hasOwnProperty(O)&&x[O]!=null)if(O==="style"){var M=x[O];for(T in M)M.hasOwnProperty(T)&&(l||(l={}),l[T]="")}else O!=="dangerouslySetInnerHTML"&&O!=="children"&&O!=="suppressContentEditableWarning"&&O!=="suppressHydrationWarning"&&O!=="autoFocus"&&(Zp.hasOwnProperty(O)?v||(v=[]):(v=v||[]).push(O,null));for(O in p){var _=p[O];if(M=x!=null?x[O]:void 0,p.hasOwnProperty(O)&&_!==M&&(_!=null||M!=null))if(O==="style")if(M){for(T in M)!M.hasOwnProperty(T)||_&&_.hasOwnProperty(T)||(l||(l={}),l[T]="");for(T in _)_.hasOwnProperty(T)&&M[T]!==_[T]&&(l||(l={}),l[T]=_[T])}else l||(v||(v=[]),v.push(O,l)),l=_;else O==="dangerouslySetInnerHTML"?(_=_?_.__html:void 0,M=M?M.__html:void 0,_!=null&&M!==_&&(v=v||[]).push(O,_)):O==="children"?typeof _!="string"&&typeof _!="number"||(v=v||[]).push(O,""+_):O!=="suppressContentEditableWarning"&&O!=="suppressHydrationWarning"&&(Zp.hasOwnProperty(O)?(_!=null&&O==="onScroll"&&Yn("scroll",r),v||M===_||(v=[])):(v=v||[]).push(O,_))}l&&(v=v||[]).push("style",l);var O=v;(a.updateQueue=O)&&(a.flags|=4)}};DD=function(r,a,l,p){l!==p&&(a.flags|=4)};function vp(r,a){if(!rr)switch(r.tailMode){case"hidden":a=r.tail;for(var l=null;a!==null;)a.alternate!==null&&(l=a),a=a.sibling;l===null?r.tail=null:l.sibling=null;break;case"collapsed":l=r.tail;for(var p=null;l!==null;)l.alternate!==null&&(p=l),l=l.sibling;p===null?a||r.tail===null?r.tail=null:r.tail.sibling=null:p.sibling=null}}function Os(r){var a=r.alternate!==null&&r.alternate.child===r.child,l=0,p=0;if(a)for(var x=r.child;x!==null;)l|=x.lanes|x.childLanes,p|=x.subtreeFlags&14680064,p|=x.flags&14680064,x.return=r,x=x.sibling;else for(x=r.child;x!==null;)l|=x.lanes|x.childLanes,p|=x.subtreeFlags,p|=x.flags,x.return=r,x=x.sibling;return r.subtreeFlags|=p,r.childLanes=l,a}function $le(r,a,l){var p=a.pendingProps;switch(Rv(a),a.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Os(a),null;case 1:return pi(a.type)&&jm(),Os(a),null;case 3:return p=a.stateNode,qd(),Qn(fi),Qn(Gs),Vv(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(r===null||r.child===null)&&(om(a)?a.flags|=4:r===null||r.memoizedState.isDehydrated&&!(a.flags&256)||(a.flags|=1024,Ka!==null&&(Pw(Ka),Ka=null))),Ew(r,a),Os(a),null;case 5:_v(a);var x=oh(n0.current);if(l=a.type,r!==null&&a.stateNode!=null)LD(r,a,l,p,x),r.ref!==a.ref&&(a.flags|=512,a.flags|=2097152);else{if(!p){if(a.stateNode===null)throw Error(je(166));return Os(a),null}if(r=oh(Lo.current),om(a)){p=a.stateNode,l=a.type;var v=a.memoizedProps;switch(p[Eo]=a,p[e0]=v,r=(a.mode&1)!==0,l){case"dialog":Yn("cancel",p),Yn("close",p);break;case"iframe":case"object":case"embed":Yn("load",p);break;case"video":case"audio":for(x=0;x<Np.length;x++)Yn(Np[x],p);break;case"source":Yn("error",p);break;case"img":case"image":case"link":Yn("error",p),Yn("load",p);break;case"details":Yn("toggle",p);break;case"input":tR(p,v),Yn("invalid",p);break;case"select":p._wrapperState={wasMultiple:!!v.multiple},Yn("invalid",p);break;case"textarea":rR(p,v),Yn("invalid",p)}ew(l,v),x=null;for(var T in v)if(v.hasOwnProperty(T)){var M=v[T];T==="children"?typeof M=="string"?p.textContent!==M&&(v.suppressHydrationWarning!==!0&&am(p.textContent,M,r),x=["children",M]):typeof M=="number"&&p.textContent!==""+M&&(v.suppressHydrationWarning!==!0&&am(p.textContent,M,r),x=["children",""+M]):Zp.hasOwnProperty(T)&&M!=null&&T==="onScroll"&&Yn("scroll",p)}switch(l){case"input":J1(p),nR(p,v,!0);break;case"textarea":J1(p),sR(p);break;case"select":case"option":break;default:typeof v.onClick=="function"&&(p.onclick=Hm)}p=x,a.updateQueue=p,p!==null&&(a.flags|=4)}else{T=x.nodeType===9?x:x.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=oL(l)),r==="http://www.w3.org/1999/xhtml"?l==="script"?(r=T.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof p.is=="string"?r=T.createElement(l,{is:p.is}):(r=T.createElement(l),l==="select"&&(T=r,p.multiple?T.multiple=!0:p.size&&(T.size=p.size))):r=T.createElementNS(r,l),r[Eo]=a,r[e0]=p,MD(r,a,!1,!1),a.stateNode=r;e:{switch(T=tw(l,p),l){case"dialog":Yn("cancel",r),Yn("close",r),x=p;break;case"iframe":case"object":case"embed":Yn("load",r),x=p;break;case"video":case"audio":for(x=0;x<Np.length;x++)Yn(Np[x],r);x=p;break;case"source":Yn("error",r),x=p;break;case"img":case"image":case"link":Yn("error",r),Yn("load",r),x=p;break;case"details":Yn("toggle",r),x=p;break;case"input":tR(r,p),x=j2(r,p),Yn("invalid",r);break;case"option":x=p;break;case"select":r._wrapperState={wasMultiple:!!p.multiple},x=hr({},p,{value:void 0}),Yn("invalid",r);break;case"textarea":rR(r,p),x=J2(r,p),Yn("invalid",r);break;default:x=p}ew(l,x),M=x;for(v in M)if(M.hasOwnProperty(v)){var _=M[v];v==="style"?cL(r,_):v==="dangerouslySetInnerHTML"?(_=_?_.__html:void 0,_!=null&&lL(r,_)):v==="children"?typeof _=="string"?(l!=="textarea"||_!=="")&&Kp(r,_):typeof _=="number"&&Kp(r,""+_):v!=="suppressContentEditableWarning"&&v!=="suppressHydrationWarning"&&v!=="autoFocus"&&(Zp.hasOwnProperty(v)?_!=null&&v==="onScroll"&&Yn("scroll",r):_!=null&&mv(r,v,_,T))}switch(l){case"input":J1(r),nR(r,p,!1);break;case"textarea":J1(r),sR(r);break;case"option":p.value!=null&&r.setAttribute("value",""+Vu(p.value));break;case"select":r.multiple=!!p.multiple,v=p.value,v!=null?zd(r,!!p.multiple,v,!1):p.defaultValue!=null&&zd(r,!!p.multiple,p.defaultValue,!0);break;default:typeof x.onClick=="function"&&(r.onclick=Hm)}switch(l){case"button":case"input":case"select":case"textarea":p=!!p.autoFocus;break e;case"img":p=!0;break e;default:p=!1}}p&&(a.flags|=4)}a.ref!==null&&(a.flags|=512,a.flags|=2097152)}return Os(a),null;case 6:if(r&&a.stateNode!=null)DD(r,a,r.memoizedProps,p);else{if(typeof p!="string"&&a.stateNode===null)throw Error(je(166));if(l=oh(n0.current),oh(Lo.current),om(a)){if(p=a.stateNode,l=a.memoizedProps,p[Eo]=a,(v=p.nodeValue!==l)&&(r=Pi,r!==null))switch(r.tag){case 3:am(p.nodeValue,l,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&am(p.nodeValue,l,(r.mode&1)!==0)}v&&(a.flags|=4)}else p=(l.nodeType===9?l:l.ownerDocument).createTextNode(p),p[Eo]=a,a.stateNode=p}return Os(a),null;case 13:if(Qn(lr),p=a.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(rr&&Oi!==null&&a.mode&1&&!(a.flags&128))QL(),Qd(),a.flags|=98560,v=!1;else if(v=om(a),p!==null&&p.dehydrated!==null){if(r===null){if(!v)throw Error(je(318));if(v=a.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(je(317));v[Eo]=a}else Qd(),!(a.flags&128)&&(a.memoizedState=null),a.flags|=4;Os(a),v=!1}else Ka!==null&&(Pw(Ka),Ka=null),v=!0;if(!v)return a.flags&65536?a:null}return a.flags&128?(a.lanes=l,a):(p=p!==null,p!==(r!==null&&r.memoizedState!==null)&&p&&(a.child.flags|=8192,a.mode&1&&(r===null||lr.current&1?Hr===0&&(Hr=3):Qv())),a.updateQueue!==null&&(a.flags|=4),Os(a),null);case 4:return qd(),Ew(r,a),r===null&&Jp(a.stateNode.containerInfo),Os(a),null;case 10:return Ov(a.type._context),Os(a),null;case 17:return pi(a.type)&&jm(),Os(a),null;case 19:if(Qn(lr),v=a.memoizedState,v===null)return Os(a),null;if(p=(a.flags&128)!==0,T=v.rendering,T===null)if(p)vp(v,!1);else{if(Hr!==0||r!==null&&r.flags&128)for(r=a.child;r!==null;){if(T=ng(r),T!==null){for(a.flags|=128,vp(v,!1),p=T.updateQueue,p!==null&&(a.updateQueue=p,a.flags|=4),a.subtreeFlags=0,p=l,l=a.child;l!==null;)v=l,r=p,v.flags&=14680066,T=v.alternate,T===null?(v.childLanes=0,v.lanes=r,v.child=null,v.subtreeFlags=0,v.memoizedProps=null,v.memoizedState=null,v.updateQueue=null,v.dependencies=null,v.stateNode=null):(v.childLanes=T.childLanes,v.lanes=T.lanes,v.child=T.child,v.subtreeFlags=0,v.deletions=null,v.memoizedProps=T.memoizedProps,v.memoizedState=T.memoizedState,v.updateQueue=T.updateQueue,v.type=T.type,r=T.dependencies,v.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),l=l.sibling;return Kn(lr,lr.current&1|2),a.child}r=r.sibling}v.tail!==null&&Nr()>tf&&(a.flags|=128,p=!0,vp(v,!1),a.lanes=4194304)}else{if(!p)if(r=ng(T),r!==null){if(a.flags|=128,p=!0,l=r.updateQueue,l!==null&&(a.updateQueue=l,a.flags|=4),vp(v,!0),v.tail===null&&v.tailMode==="hidden"&&!T.alternate&&!rr)return Os(a),null}else 2*Nr()-v.renderingStartTime>tf&&l!==1073741824&&(a.flags|=128,p=!0,vp(v,!1),a.lanes=4194304);v.isBackwards?(T.sibling=a.child,a.child=T):(l=v.last,l!==null?l.sibling=T:a.child=T,v.last=T)}return v.tail!==null?(a=v.tail,v.rendering=a,v.tail=a.sibling,v.renderingStartTime=Nr(),a.sibling=null,l=lr.current,Kn(lr,p?l&1|2:l&1),a):(Os(a),null);case 22:case 23:return Yv(),p=a.memoizedState!==null,r!==null&&r.memoizedState!==null!==p&&(a.flags|=8192),p&&a.mode&1?Li&1073741824&&(Os(a),a.subtreeFlags&6&&(a.flags|=8192)):Os(a),null;case 24:return null;case 25:return null}throw Error(je(156,a.tag))}function Ule(r,a){switch(Rv(a),a.tag){case 1:return pi(a.type)&&jm(),r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 3:return qd(),Qn(fi),Qn(Gs),Vv(),r=a.flags,r&65536&&!(r&128)?(a.flags=r&-65537|128,a):null;case 5:return _v(a),null;case 13:if(Qn(lr),r=a.memoizedState,r!==null&&r.dehydrated!==null){if(a.alternate===null)throw Error(je(340));Qd()}return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 19:return Qn(lr),null;case 4:return qd(),null;case 10:return Ov(a.type._context),null;case 22:case 23:return Yv(),null;case 24:return null;default:return null}}var cm=!1,Ps=!1,Hle=typeof WeakSet=="function"?WeakSet:Set,dt=null;function Pd(r,a){var l=r.ref;if(l!==null)if(typeof l=="function")try{l(null)}catch(p){Cr(r,a,p)}else l.current=null}function Nw(r,a,l){try{l()}catch(p){Cr(r,a,p)}}var UR=!1;function jle(r,a){if(hw=Km,r=_L(),Nv(r)){if("selectionStart"in r)var l={start:r.selectionStart,end:r.selectionEnd};else e:{l=(l=r.ownerDocument)&&l.defaultView||window;var p=l.getSelection&&l.getSelection();if(p&&p.rangeCount!==0){l=p.anchorNode;var x=p.anchorOffset,v=p.focusNode;p=p.focusOffset;try{l.nodeType,v.nodeType}catch{l=null;break e}var T=0,M=-1,_=-1,O=0,V=0,D=r,$=null;t:for(;;){for(var re;D!==l||x!==0&&D.nodeType!==3||(M=T+x),D!==v||p!==0&&D.nodeType!==3||(_=T+p),D.nodeType===3&&(T+=D.nodeValue.length),(re=D.firstChild)!==null;)$=D,D=re;for(;;){if(D===r)break t;if($===l&&++O===x&&(M=T),$===v&&++V===p&&(_=T),(re=D.nextSibling)!==null)break;D=$,$=D.parentNode}D=re}l=M===-1||_===-1?null:{start:M,end:_}}else l=null}l=l||{start:0,end:0}}else l=null;for(dw={focusedElem:r,selectionRange:l},Km=!1,dt=a;dt!==null;)if(a=dt,r=a.child,(a.subtreeFlags&1028)!==0&&r!==null)r.return=a,dt=r;else for(;dt!==null;){a=dt;try{var H=a.alternate;if(a.flags&1024)switch(a.tag){case 0:case 11:case 15:break;case 1:if(H!==null){var se=H.memoizedProps,Ee=H.memoizedState,ee=a.stateNode,Y=ee.getSnapshotBeforeUpdate(a.elementType===a.type?se:za(a.type,se),Ee);ee.__reactInternalSnapshotBeforeUpdate=Y}break;case 3:var j=a.stateNode.containerInfo;j.nodeType===1?j.textContent="":j.nodeType===9&&j.documentElement&&j.removeChild(j.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(je(163))}}catch(fe){Cr(a,a.return,fe)}if(r=a.sibling,r!==null){r.return=a.return,dt=r;break}dt=a.return}return H=UR,UR=!1,H}function Gp(r,a,l){var p=a.updateQueue;if(p=p!==null?p.lastEffect:null,p!==null){var x=p=p.next;do{if((x.tag&r)===r){var v=x.destroy;x.destroy=void 0,v!==void 0&&Nw(a,l,v)}x=x.next}while(x!==p)}}function Ag(r,a){if(a=a.updateQueue,a=a!==null?a.lastEffect:null,a!==null){var l=a=a.next;do{if((l.tag&r)===r){var p=l.create;l.destroy=p()}l=l.next}while(l!==a)}}function Aw(r){var a=r.ref;if(a!==null){var l=r.stateNode;switch(r.tag){case 5:r=l;break;default:r=l}typeof a=="function"?a(r):a.current=r}}function OD(r){var a=r.alternate;a!==null&&(r.alternate=null,OD(a)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(a=r.stateNode,a!==null&&(delete a[Eo],delete a[e0],delete a[mw],delete a[Mle],delete a[Lle])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function PD(r){return r.tag===5||r.tag===3||r.tag===4}function HR(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||PD(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Rw(r,a,l){var p=r.tag;if(p===5||p===6)r=r.stateNode,a?l.nodeType===8?l.parentNode.insertBefore(r,a):l.insertBefore(r,a):(l.nodeType===8?(a=l.parentNode,a.insertBefore(r,l)):(a=l,a.appendChild(r)),l=l._reactRootContainer,l!=null||a.onclick!==null||(a.onclick=Hm));else if(p!==4&&(r=r.child,r!==null))for(Rw(r,a,l),r=r.sibling;r!==null;)Rw(r,a,l),r=r.sibling}function Mw(r,a,l){var p=r.tag;if(p===5||p===6)r=r.stateNode,a?l.insertBefore(r,a):l.appendChild(r);else if(p!==4&&(r=r.child,r!==null))for(Mw(r,a,l),r=r.sibling;r!==null;)Mw(r,a,l),r=r.sibling}var gs=null,Xa=!1;function bu(r,a,l){for(l=l.child;l!==null;)FD(r,a,l),l=l.sibling}function FD(r,a,l){if(Mo&&typeof Mo.onCommitFiberUnmount=="function")try{Mo.onCommitFiberUnmount(vg,l)}catch{}switch(l.tag){case 5:Ps||Pd(l,a);case 6:var p=gs,x=Xa;gs=null,bu(r,a,l),gs=p,Xa=x,gs!==null&&(Xa?(r=gs,l=l.stateNode,r.nodeType===8?r.parentNode.removeChild(l):r.removeChild(l)):gs.removeChild(l.stateNode));break;case 18:gs!==null&&(Xa?(r=gs,l=l.stateNode,r.nodeType===8?m2(r.parentNode,l):r.nodeType===1&&m2(r,l),jp(r)):m2(gs,l.stateNode));break;case 4:p=gs,x=Xa,gs=l.stateNode.containerInfo,Xa=!0,bu(r,a,l),gs=p,Xa=x;break;case 0:case 11:case 14:case 15:if(!Ps&&(p=l.updateQueue,p!==null&&(p=p.lastEffect,p!==null))){x=p=p.next;do{var v=x,T=v.destroy;v=v.tag,T!==void 0&&(v&2||v&4)&&Nw(l,a,T),x=x.next}while(x!==p)}bu(r,a,l);break;case 1:if(!Ps&&(Pd(l,a),p=l.stateNode,typeof p.componentWillUnmount=="function"))try{p.props=l.memoizedProps,p.state=l.memoizedState,p.componentWillUnmount()}catch(M){Cr(l,a,M)}bu(r,a,l);break;case 21:bu(r,a,l);break;case 22:l.mode&1?(Ps=(p=Ps)||l.memoizedState!==null,bu(r,a,l),Ps=p):bu(r,a,l);break;default:bu(r,a,l)}}function jR(r){var a=r.updateQueue;if(a!==null){r.updateQueue=null;var l=r.stateNode;l===null&&(l=r.stateNode=new Hle),a.forEach(function(p){var x=sue.bind(null,r,p);l.has(p)||(l.add(p),p.then(x,x))})}}function Va(r,a){var l=a.deletions;if(l!==null)for(var p=0;p<l.length;p++){var x=l[p];try{var v=r,T=a,M=T;e:for(;M!==null;){switch(M.tag){case 5:gs=M.stateNode,Xa=!1;break e;case 3:gs=M.stateNode.containerInfo,Xa=!0;break e;case 4:gs=M.stateNode.containerInfo,Xa=!0;break e}M=M.return}if(gs===null)throw Error(je(160));FD(v,T,x),gs=null,Xa=!1;var _=x.alternate;_!==null&&(_.return=null),x.return=null}catch(O){Cr(x,a,O)}}if(a.subtreeFlags&12854)for(a=a.child;a!==null;)GD(a,r),a=a.sibling}function GD(r,a){var l=r.alternate,p=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(Va(a,r),So(r),p&4){try{Gp(3,r,r.return),Ag(3,r)}catch(se){Cr(r,r.return,se)}try{Gp(5,r,r.return)}catch(se){Cr(r,r.return,se)}}break;case 1:Va(a,r),So(r),p&512&&l!==null&&Pd(l,l.return);break;case 5:if(Va(a,r),So(r),p&512&&l!==null&&Pd(l,l.return),r.flags&32){var x=r.stateNode;try{Kp(x,"")}catch(se){Cr(r,r.return,se)}}if(p&4&&(x=r.stateNode,x!=null)){var v=r.memoizedProps,T=l!==null?l.memoizedProps:v,M=r.type,_=r.updateQueue;if(r.updateQueue=null,_!==null)try{M==="input"&&v.type==="radio"&&v.name!=null&&iL(x,v),tw(M,T);var O=tw(M,v);for(T=0;T<_.length;T+=2){var V=_[T],D=_[T+1];V==="style"?cL(x,D):V==="dangerouslySetInnerHTML"?lL(x,D):V==="children"?Kp(x,D):mv(x,V,D,O)}switch(M){case"input":Y2(x,v);break;case"textarea":aL(x,v);break;case"select":var $=x._wrapperState.wasMultiple;x._wrapperState.wasMultiple=!!v.multiple;var re=v.value;re!=null?zd(x,!!v.multiple,re,!1):$!==!!v.multiple&&(v.defaultValue!=null?zd(x,!!v.multiple,v.defaultValue,!0):zd(x,!!v.multiple,v.multiple?[]:"",!1))}x[e0]=v}catch(se){Cr(r,r.return,se)}}break;case 6:if(Va(a,r),So(r),p&4){if(r.stateNode===null)throw Error(je(162));x=r.stateNode,v=r.memoizedProps;try{x.nodeValue=v}catch(se){Cr(r,r.return,se)}}break;case 3:if(Va(a,r),So(r),p&4&&l!==null&&l.memoizedState.isDehydrated)try{jp(a.containerInfo)}catch(se){Cr(r,r.return,se)}break;case 4:Va(a,r),So(r);break;case 13:Va(a,r),So(r),x=r.child,x.flags&8192&&(v=x.memoizedState!==null,x.stateNode.isHidden=v,!v||x.alternate!==null&&x.alternate.memoizedState!==null||(Hv=Nr())),p&4&&jR(r);break;case 22:if(V=l!==null&&l.memoizedState!==null,r.mode&1?(Ps=(O=Ps)||V,Va(a,r),Ps=O):Va(a,r),So(r),p&8192){if(O=r.memoizedState!==null,(r.stateNode.isHidden=O)&&!V&&r.mode&1)for(dt=r,V=r.child;V!==null;){for(D=dt=V;dt!==null;){switch($=dt,re=$.child,$.tag){case 0:case 11:case 14:case 15:Gp(4,$,$.return);break;case 1:Pd($,$.return);var H=$.stateNode;if(typeof H.componentWillUnmount=="function"){p=$,l=$.return;try{a=p,H.props=a.memoizedProps,H.state=a.memoizedState,H.componentWillUnmount()}catch(se){Cr(p,l,se)}}break;case 5:Pd($,$.return);break;case 22:if($.memoizedState!==null){QR(D);continue}}re!==null?(re.return=$,dt=re):QR(D)}V=V.sibling}e:for(V=null,D=r;;){if(D.tag===5){if(V===null){V=D;try{x=D.stateNode,O?(v=x.style,typeof v.setProperty=="function"?v.setProperty("display","none","important"):v.display="none"):(M=D.stateNode,_=D.memoizedProps.style,T=_!=null&&_.hasOwnProperty("display")?_.display:null,M.style.display=uL("display",T))}catch(se){Cr(r,r.return,se)}}}else if(D.tag===6){if(V===null)try{D.stateNode.nodeValue=O?"":D.memoizedProps}catch(se){Cr(r,r.return,se)}}else if((D.tag!==22&&D.tag!==23||D.memoizedState===null||D===r)&&D.child!==null){D.child.return=D,D=D.child;continue}if(D===r)break e;for(;D.sibling===null;){if(D.return===null||D.return===r)break e;V===D&&(V=null),D=D.return}V===D&&(V=null),D.sibling.return=D.return,D=D.sibling}}break;case 19:Va(a,r),So(r),p&4&&jR(r);break;case 21:break;default:Va(a,r),So(r)}}function So(r){var a=r.flags;if(a&2){try{e:{for(var l=r.return;l!==null;){if(PD(l)){var p=l;break e}l=l.return}throw Error(je(160))}switch(p.tag){case 5:var x=p.stateNode;p.flags&32&&(Kp(x,""),p.flags&=-33);var v=HR(r);Mw(r,v,x);break;case 3:case 4:var T=p.stateNode.containerInfo,M=HR(r);Rw(r,M,T);break;default:throw Error(je(161))}}catch(_){Cr(r,r.return,_)}r.flags&=-3}a&4096&&(r.flags&=-4097)}function Yle(r,a,l){dt=r,_D(r)}function _D(r,a,l){for(var p=(r.mode&1)!==0;dt!==null;){var x=dt,v=x.child;if(x.tag===22&&p){var T=x.memoizedState!==null||cm;if(!T){var M=x.alternate,_=M!==null&&M.memoizedState!==null||Ps;M=cm;var O=Ps;if(cm=T,(Ps=_)&&!O)for(dt=x;dt!==null;)T=dt,_=T.child,T.tag===22&&T.memoizedState!==null?JR(x):_!==null?(_.return=T,dt=_):JR(x);for(;v!==null;)dt=v,_D(v),v=v.sibling;dt=x,cm=M,Ps=O}YR(r)}else x.subtreeFlags&8772&&v!==null?(v.return=x,dt=v):YR(r)}}function YR(r){for(;dt!==null;){var a=dt;if(a.flags&8772){var l=a.alternate;try{if(a.flags&8772)switch(a.tag){case 0:case 11:case 15:Ps||Ag(5,a);break;case 1:var p=a.stateNode;if(a.flags&4&&!Ps)if(l===null)p.componentDidMount();else{var x=a.elementType===a.type?l.memoizedProps:za(a.type,l.memoizedProps);p.componentDidUpdate(x,l.memoizedState,p.__reactInternalSnapshotBeforeUpdate)}var v=a.updateQueue;v!==null&&OR(a,v,p);break;case 3:var T=a.updateQueue;if(T!==null){if(l=null,a.child!==null)switch(a.child.tag){case 5:l=a.child.stateNode;break;case 1:l=a.child.stateNode}OR(a,T,l)}break;case 5:var M=a.stateNode;if(l===null&&a.flags&4){l=M;var _=a.memoizedProps;switch(a.type){case"button":case"input":case"select":case"textarea":_.autoFocus&&l.focus();break;case"img":_.src&&(l.src=_.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(a.memoizedState===null){var O=a.alternate;if(O!==null){var V=O.memoizedState;if(V!==null){var D=V.dehydrated;D!==null&&jp(D)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(je(163))}Ps||a.flags&512&&Aw(a)}catch($){Cr(a,a.return,$)}}if(a===r){dt=null;break}if(l=a.sibling,l!==null){l.return=a.return,dt=l;break}dt=a.return}}function QR(r){for(;dt!==null;){var a=dt;if(a===r){dt=null;break}var l=a.sibling;if(l!==null){l.return=a.return,dt=l;break}dt=a.return}}function JR(r){for(;dt!==null;){var a=dt;try{switch(a.tag){case 0:case 11:case 15:var l=a.return;try{Ag(4,a)}catch(_){Cr(a,l,_)}break;case 1:var p=a.stateNode;if(typeof p.componentDidMount=="function"){var x=a.return;try{p.componentDidMount()}catch(_){Cr(a,x,_)}}var v=a.return;try{Aw(a)}catch(_){Cr(a,v,_)}break;case 5:var T=a.return;try{Aw(a)}catch(_){Cr(a,T,_)}}}catch(_){Cr(a,a.return,_)}if(a===r){dt=null;break}var M=a.sibling;if(M!==null){M.return=a.return,dt=M;break}dt=a.return}}var Qle=Math.ceil,ig=El.ReactCurrentDispatcher,$v=El.ReactCurrentOwner,ga=El.ReactCurrentBatchConfig,un=0,os=null,Vr=null,bs=0,Li=0,Fd=Ku(0),Hr=0,a0=null,gh=0,Rg=0,Uv=0,_p=null,hi=null,Hv=0,tf=1/0,pl=null,ag=!1,Lw=null,Fu=null,hm=!1,Au=null,og=0,Vp=0,Dw=null,Mm=-1,Lm=0;function Ys(){return un&6?Nr():Mm!==-1?Mm:Mm=Nr()}function Gu(r){return r.mode&1?un&2&&bs!==0?bs&-bs:Ole.transition!==null?(Lm===0&&(Lm=IL()),Lm):(r=In,r!==0||(r=window.event,r=r===void 0?16:AL(r.type)),r):1}function ja(r,a,l,p){if(50<Vp)throw Vp=0,Dw=null,Error(je(185));f0(r,l,p),(!(un&2)||r!==os)&&(r===os&&(!(un&2)&&(Rg|=l),Hr===4&&ku(r,bs)),mi(r,p),l===1&&un===0&&!(a.mode&1)&&(tf=Nr()+500,kg&&$u()))}function mi(r,a){var l=r.callbackNode;Ooe(r,a);var p=Zm(r,r===os?bs:0);if(p===0)l!==null&&oR(l),r.callbackNode=null,r.callbackPriority=0;else if(a=p&-p,r.callbackPriority!==a){if(l!=null&&oR(l),a===1)r.tag===0?Dle(qR.bind(null,r)):HL(qR.bind(null,r)),Ale(function(){!(un&6)&&$u()}),l=null;else{switch(CL(p)){case 1:l=wv;break;case 4:l=wL;break;case 16:l=Xm;break;case 536870912:l=vL;break;default:l=Xm}l=$D(l,VD.bind(null,r))}r.callbackPriority=a,r.callbackNode=l}}function VD(r,a){if(Mm=-1,Lm=0,un&6)throw Error(je(327));var l=r.callbackNode;if(Ud()&&r.callbackNode!==l)return null;var p=Zm(r,r===os?bs:0);if(p===0)return null;if(p&30||p&r.expiredLanes||a)a=lg(r,p);else{a=p;var x=un;un|=2;var v=WD();(os!==r||bs!==a)&&(pl=null,tf=Nr()+500,ch(r,a));do try{eue();break}catch(M){BD(r,M)}while(!0);Dv(),ig.current=v,un=x,Vr!==null?a=0:(os=null,bs=0,a=Hr)}if(a!==0){if(a===2&&(x=aw(r),x!==0&&(p=x,a=Ow(r,x))),a===1)throw l=a0,ch(r,0),ku(r,p),mi(r,Nr()),l;if(a===6)ku(r,p);else{if(x=r.current.alternate,!(p&30)&&!Jle(x)&&(a=lg(r,p),a===2&&(v=aw(r),v!==0&&(p=v,a=Ow(r,v))),a===1))throw l=a0,ch(r,0),ku(r,p),mi(r,Nr()),l;switch(r.finishedWork=x,r.finishedLanes=p,a){case 0:case 1:throw Error(je(345));case 2:rh(r,hi,pl);break;case 3:if(ku(r,p),(p&130023424)===p&&(a=Hv+500-Nr(),10<a)){if(Zm(r,0)!==0)break;if(x=r.suspendedLanes,(x&p)!==p){Ys(),r.pingedLanes|=r.suspendedLanes&x;break}r.timeoutHandle=pw(rh.bind(null,r,hi,pl),a);break}rh(r,hi,pl);break;case 4:if(ku(r,p),(p&4194240)===p)break;for(a=r.eventTimes,x=-1;0<p;){var T=31-Ha(p);v=1<<T,T=a[T],T>x&&(x=T),p&=~v}if(p=x,p=Nr()-p,p=(120>p?120:480>p?480:1080>p?1080:1920>p?1920:3e3>p?3e3:4320>p?4320:1960*Qle(p/1960))-p,10<p){r.timeoutHandle=pw(rh.bind(null,r,hi,pl),p);break}rh(r,hi,pl);break;case 5:rh(r,hi,pl);break;default:throw Error(je(329))}}}return mi(r,Nr()),r.callbackNode===l?VD.bind(null,r):null}function Ow(r,a){var l=_p;return r.current.memoizedState.isDehydrated&&(ch(r,a).flags|=256),r=lg(r,a),r!==2&&(a=hi,hi=l,a!==null&&Pw(a)),r}function Pw(r){hi===null?hi=r:hi.push.apply(hi,r)}function Jle(r){for(var a=r;;){if(a.flags&16384){var l=a.updateQueue;if(l!==null&&(l=l.stores,l!==null))for(var p=0;p<l.length;p++){var x=l[p],v=x.getSnapshot;x=x.value;try{if(!Ya(v(),x))return!1}catch{return!1}}}if(l=a.child,a.subtreeFlags&16384&&l!==null)l.return=a,a=l;else{if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function ku(r,a){for(a&=~Uv,a&=~Rg,r.suspendedLanes|=a,r.pingedLanes&=~a,r=r.expirationTimes;0<a;){var l=31-Ha(a),p=1<<l;r[l]=-1,a&=~p}}function qR(r){if(un&6)throw Error(je(327));Ud();var a=Zm(r,0);if(!(a&1))return mi(r,Nr()),null;var l=lg(r,a);if(r.tag!==0&&l===2){var p=aw(r);p!==0&&(a=p,l=Ow(r,p))}if(l===1)throw l=a0,ch(r,0),ku(r,a),mi(r,Nr()),l;if(l===6)throw Error(je(345));return r.finishedWork=r.current.alternate,r.finishedLanes=a,rh(r,hi,pl),mi(r,Nr()),null}function jv(r,a){var l=un;un|=1;try{return r(a)}finally{un=l,un===0&&(tf=Nr()+500,kg&&$u())}}function xh(r){Au!==null&&Au.tag===0&&!(un&6)&&Ud();var a=un;un|=1;var l=ga.transition,p=In;try{if(ga.transition=null,In=1,r)return r()}finally{In=p,ga.transition=l,un=a,!(un&6)&&$u()}}function Yv(){Li=Fd.current,Qn(Fd)}function ch(r,a){r.finishedWork=null,r.finishedLanes=0;var l=r.timeoutHandle;if(l!==-1&&(r.timeoutHandle=-1,Nle(l)),Vr!==null)for(l=Vr.return;l!==null;){var p=l;switch(Rv(p),p.tag){case 1:p=p.type.childContextTypes,p!=null&&jm();break;case 3:qd(),Qn(fi),Qn(Gs),Vv();break;case 5:_v(p);break;case 4:qd();break;case 13:Qn(lr);break;case 19:Qn(lr);break;case 10:Ov(p.type._context);break;case 22:case 23:Yv()}l=l.return}if(os=r,Vr=r=_u(r.current,null),bs=Li=a,Hr=0,a0=null,Uv=Rg=gh=0,hi=_p=null,ah!==null){for(a=0;a<ah.length;a++)if(l=ah[a],p=l.interleaved,p!==null){l.interleaved=null;var x=p.next,v=l.pending;if(v!==null){var T=v.next;v.next=x,p.next=T}l.pending=p}ah=null}return r}function BD(r,a){do{var l=Vr;try{if(Dv(),Nm.current=sg,rg){for(var p=cr.memoizedState;p!==null;){var x=p.queue;x!==null&&(x.pending=null),p=p.next}rg=!1}if(mh=0,as=Ur=cr=null,Fp=!1,r0=0,$v.current=null,l===null||l.return===null){Hr=1,a0=a,Vr=null;break}e:{var v=r,T=l.return,M=l,_=a;if(a=bs,M.flags|=32768,_!==null&&typeof _=="object"&&typeof _.then=="function"){var O=_,V=M,D=V.tag;if(!(V.mode&1)&&(D===0||D===11||D===15)){var $=V.alternate;$?(V.updateQueue=$.updateQueue,V.memoizedState=$.memoizedState,V.lanes=$.lanes):(V.updateQueue=null,V.memoizedState=null)}var re=BR(T);if(re!==null){re.flags&=-257,WR(re,T,M,v,a),re.mode&1&&VR(v,O,a),a=re,_=O;var H=a.updateQueue;if(H===null){var se=new Set;se.add(_),a.updateQueue=se}else H.add(_);break e}else{if(!(a&1)){VR(v,O,a),Qv();break e}_=Error(je(426))}}else if(rr&&M.mode&1){var Ee=BR(T);if(Ee!==null){!(Ee.flags&65536)&&(Ee.flags|=256),WR(Ee,T,M,v,a),Mv(ef(_,M));break e}}v=_=ef(_,M),Hr!==4&&(Hr=2),_p===null?_p=[v]:_p.push(v),v=T;do{switch(v.tag){case 3:v.flags|=65536,a&=-a,v.lanes|=a;var ee=CD(v,_,a);DR(v,ee);break e;case 1:M=_;var Y=v.type,j=v.stateNode;if(!(v.flags&128)&&(typeof Y.getDerivedStateFromError=="function"||j!==null&&typeof j.componentDidCatch=="function"&&(Fu===null||!Fu.has(j)))){v.flags|=65536,a&=-a,v.lanes|=a;var fe=SD(v,M,a);DR(v,fe);break e}}v=v.return}while(v!==null)}XD(l)}catch(be){a=be,Vr===l&&l!==null&&(Vr=l=l.return);continue}break}while(!0)}function WD(){var r=ig.current;return ig.current=sg,r===null?sg:r}function Qv(){(Hr===0||Hr===3||Hr===2)&&(Hr=4),os===null||!(gh&268435455)&&!(Rg&268435455)||ku(os,bs)}function lg(r,a){var l=un;un|=2;var p=WD();(os!==r||bs!==a)&&(pl=null,ch(r,a));do try{qle();break}catch(x){BD(r,x)}while(!0);if(Dv(),un=l,ig.current=p,Vr!==null)throw Error(je(261));return os=null,bs=0,Hr}function qle(){for(;Vr!==null;)zD(Vr)}function eue(){for(;Vr!==null&&!Toe();)zD(Vr)}function zD(r){var a=KD(r.alternate,r,Li);r.memoizedProps=r.pendingProps,a===null?XD(r):Vr=a,$v.current=null}function XD(r){var a=r;do{var l=a.alternate;if(r=a.return,a.flags&32768){if(l=Ule(l,a),l!==null){l.flags&=32767,Vr=l;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{Hr=6,Vr=null;return}}else if(l=$le(l,a,Li),l!==null){Vr=l;return}if(a=a.sibling,a!==null){Vr=a;return}Vr=a=r}while(a!==null);Hr===0&&(Hr=5)}function rh(r,a,l){var p=In,x=ga.transition;try{ga.transition=null,In=1,tue(r,a,l,p)}finally{ga.transition=x,In=p}return null}function tue(r,a,l,p){do Ud();while(Au!==null);if(un&6)throw Error(je(327));l=r.finishedWork;var x=r.finishedLanes;if(l===null)return null;if(r.finishedWork=null,r.finishedLanes=0,l===r.current)throw Error(je(177));r.callbackNode=null,r.callbackPriority=0;var v=l.lanes|l.childLanes;if(Poe(r,v),r===os&&(Vr=os=null,bs=0),!(l.subtreeFlags&2064)&&!(l.flags&2064)||hm||(hm=!0,$D(Xm,function(){return Ud(),null})),v=(l.flags&15990)!==0,l.subtreeFlags&15990||v){v=ga.transition,ga.transition=null;var T=In;In=1;var M=un;un|=4,$v.current=null,jle(r,l),GD(l,r),vle(dw),Km=!!hw,dw=hw=null,r.current=l,Yle(l),koe(),un=M,In=T,ga.transition=v}else r.current=l;if(hm&&(hm=!1,Au=r,og=x),v=r.pendingLanes,v===0&&(Fu=null),Aoe(l.stateNode),mi(r,Nr()),a!==null)for(p=r.onRecoverableError,l=0;l<a.length;l++)x=a[l],p(x.value,{componentStack:x.stack,digest:x.digest});if(ag)throw ag=!1,r=Lw,Lw=null,r;return og&1&&r.tag!==0&&Ud(),v=r.pendingLanes,v&1?r===Dw?Vp++:(Vp=0,Dw=r):Vp=0,$u(),null}function Ud(){if(Au!==null){var r=CL(og),a=ga.transition,l=In;try{if(ga.transition=null,In=16>r?16:r,Au===null)var p=!1;else{if(r=Au,Au=null,og=0,un&6)throw Error(je(331));var x=un;for(un|=4,dt=r.current;dt!==null;){var v=dt,T=v.child;if(dt.flags&16){var M=v.deletions;if(M!==null){for(var _=0;_<M.length;_++){var O=M[_];for(dt=O;dt!==null;){var V=dt;switch(V.tag){case 0:case 11:case 15:Gp(8,V,v)}var D=V.child;if(D!==null)D.return=V,dt=D;else for(;dt!==null;){V=dt;var $=V.sibling,re=V.return;if(OD(V),V===O){dt=null;break}if($!==null){$.return=re,dt=$;break}dt=re}}}var H=v.alternate;if(H!==null){var se=H.child;if(se!==null){H.child=null;do{var Ee=se.sibling;se.sibling=null,se=Ee}while(se!==null)}}dt=v}}if(v.subtreeFlags&2064&&T!==null)T.return=v,dt=T;else e:for(;dt!==null;){if(v=dt,v.flags&2048)switch(v.tag){case 0:case 11:case 15:Gp(9,v,v.return)}var ee=v.sibling;if(ee!==null){ee.return=v.return,dt=ee;break e}dt=v.return}}var Y=r.current;for(dt=Y;dt!==null;){T=dt;var j=T.child;if(T.subtreeFlags&2064&&j!==null)j.return=T,dt=j;else e:for(T=Y;dt!==null;){if(M=dt,M.flags&2048)try{switch(M.tag){case 0:case 11:case 15:Ag(9,M)}}catch(be){Cr(M,M.return,be)}if(M===T){dt=null;break e}var fe=M.sibling;if(fe!==null){fe.return=M.return,dt=fe;break e}dt=M.return}}if(un=x,$u(),Mo&&typeof Mo.onPostCommitFiberRoot=="function")try{Mo.onPostCommitFiberRoot(vg,r)}catch{}p=!0}return p}finally{In=l,ga.transition=a}}return!1}function eM(r,a,l){a=ef(l,a),a=CD(r,a,1),r=Pu(r,a,1),a=Ys(),r!==null&&(f0(r,1,a),mi(r,a))}function Cr(r,a,l){if(r.tag===3)eM(r,r,l);else for(;a!==null;){if(a.tag===3){eM(a,r,l);break}else if(a.tag===1){var p=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(Fu===null||!Fu.has(p))){r=ef(l,r),r=SD(a,r,1),a=Pu(a,r,1),r=Ys(),a!==null&&(f0(a,1,r),mi(a,r));break}}a=a.return}}function nue(r,a,l){var p=r.pingCache;p!==null&&p.delete(a),a=Ys(),r.pingedLanes|=r.suspendedLanes&l,os===r&&(bs&l)===l&&(Hr===4||Hr===3&&(bs&130023424)===bs&&500>Nr()-Hv?ch(r,0):Uv|=l),mi(r,a)}function ZD(r,a){a===0&&(r.mode&1?(a=tm,tm<<=1,!(tm&130023424)&&(tm=4194304)):a=1);var l=Ys();r=Cl(r,a),r!==null&&(f0(r,a,l),mi(r,l))}function rue(r){var a=r.memoizedState,l=0;a!==null&&(l=a.retryLane),ZD(r,l)}function sue(r,a){var l=0;switch(r.tag){case 13:var p=r.stateNode,x=r.memoizedState;x!==null&&(l=x.retryLane);break;case 19:p=r.stateNode;break;default:throw Error(je(314))}p!==null&&p.delete(a),ZD(r,l)}var KD;KD=function(r,a,l){if(r!==null)if(r.memoizedProps!==a.pendingProps||fi.current)di=!0;else{if(!(r.lanes&l)&&!(a.flags&128))return di=!1,Kle(r,a,l);di=!!(r.flags&131072)}else di=!1,rr&&a.flags&1048576&&jL(a,Jm,a.index);switch(a.lanes=0,a.tag){case 2:var p=a.type;Rm(r,a),r=a.pendingProps;var x=Yd(a,Gs.current);$d(a,l),x=Wv(null,a,p,r,x,l);var v=zv();return a.flags|=1,typeof x=="object"&&x!==null&&typeof x.render=="function"&&x.$$typeof===void 0?(a.tag=1,a.memoizedState=null,a.updateQueue=null,pi(p)?(v=!0,Ym(a)):v=!1,a.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,Fv(a),x.updater=Ng,a.stateNode=x,x._reactInternals=a,vw(a,p,r,l),a=Sw(null,a,p,!0,v,l)):(a.tag=0,rr&&v&&Av(a),Us(null,a,x,l),a=a.child),a;case 16:p=a.elementType;e:{switch(Rm(r,a),r=a.pendingProps,x=p._init,p=x(p._payload),a.type=p,x=a.tag=aue(p),r=za(p,r),x){case 0:a=Cw(null,a,p,r,l);break e;case 1:a=ZR(null,a,p,r,l);break e;case 11:a=zR(null,a,p,r,l);break e;case 14:a=XR(null,a,p,za(p.type,r),l);break e}throw Error(je(306,p,""))}return a;case 0:return p=a.type,x=a.pendingProps,x=a.elementType===p?x:za(p,x),Cw(r,a,p,x,l);case 1:return p=a.type,x=a.pendingProps,x=a.elementType===p?x:za(p,x),ZR(r,a,p,x,l);case 3:e:{if(ND(a),r===null)throw Error(je(387));p=a.pendingProps,v=a.memoizedState,x=v.element,tD(r,a),tg(a,p,null,l);var T=a.memoizedState;if(p=T.element,v.isDehydrated)if(v={element:p,isDehydrated:!1,cache:T.cache,pendingSuspenseBoundaries:T.pendingSuspenseBoundaries,transitions:T.transitions},a.updateQueue.baseState=v,a.memoizedState=v,a.flags&256){x=ef(Error(je(423)),a),a=KR(r,a,p,l,x);break e}else if(p!==x){x=ef(Error(je(424)),a),a=KR(r,a,p,l,x);break e}else for(Oi=Ou(a.stateNode.containerInfo.firstChild),Pi=a,rr=!0,Ka=null,l=qL(a,null,p,l),a.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(Qd(),p===x){a=Sl(r,a,l);break e}Us(r,a,p,l)}a=a.child}return a;case 5:return nD(a),r===null&&yw(a),p=a.type,x=a.pendingProps,v=r!==null?r.memoizedProps:null,T=x.children,fw(p,x)?T=null:v!==null&&fw(p,v)&&(a.flags|=32),ED(r,a),Us(r,a,T,l),a.child;case 6:return r===null&&yw(a),null;case 13:return AD(r,a,l);case 4:return Gv(a,a.stateNode.containerInfo),p=a.pendingProps,r===null?a.child=Jd(a,null,p,l):Us(r,a,p,l),a.child;case 11:return p=a.type,x=a.pendingProps,x=a.elementType===p?x:za(p,x),zR(r,a,p,x,l);case 7:return Us(r,a,a.pendingProps,l),a.child;case 8:return Us(r,a,a.pendingProps.children,l),a.child;case 12:return Us(r,a,a.pendingProps.children,l),a.child;case 10:e:{if(p=a.type._context,x=a.pendingProps,v=a.memoizedProps,T=x.value,Kn(qm,p._currentValue),p._currentValue=T,v!==null)if(Ya(v.value,T)){if(v.children===x.children&&!fi.current){a=Sl(r,a,l);break e}}else for(v=a.child,v!==null&&(v.return=a);v!==null;){var M=v.dependencies;if(M!==null){T=v.child;for(var _=M.firstContext;_!==null;){if(_.context===p){if(v.tag===1){_=bl(-1,l&-l),_.tag=2;var O=v.updateQueue;if(O!==null){O=O.shared;var V=O.pending;V===null?_.next=_:(_.next=V.next,V.next=_),O.pending=_}}v.lanes|=l,_=v.alternate,_!==null&&(_.lanes|=l),bw(v.return,l,a),M.lanes|=l;break}_=_.next}}else if(v.tag===10)T=v.type===a.type?null:v.child;else if(v.tag===18){if(T=v.return,T===null)throw Error(je(341));T.lanes|=l,M=T.alternate,M!==null&&(M.lanes|=l),bw(T,l,a),T=v.sibling}else T=v.child;if(T!==null)T.return=v;else for(T=v;T!==null;){if(T===a){T=null;break}if(v=T.sibling,v!==null){v.return=T.return,T=v;break}T=T.return}v=T}Us(r,a,x.children,l),a=a.child}return a;case 9:return x=a.type,p=a.pendingProps.children,$d(a,l),x=ya(x),p=p(x),a.flags|=1,Us(r,a,p,l),a.child;case 14:return p=a.type,x=za(p,a.pendingProps),x=za(p.type,x),XR(r,a,p,x,l);case 15:return TD(r,a,a.type,a.pendingProps,l);case 17:return p=a.type,x=a.pendingProps,x=a.elementType===p?x:za(p,x),Rm(r,a),a.tag=1,pi(p)?(r=!0,Ym(a)):r=!1,$d(a,l),ID(a,p,x),vw(a,p,x,l),Sw(null,a,p,!0,r,l);case 19:return RD(r,a,l);case 22:return kD(r,a,l)}throw Error(je(156,a.tag))};function $D(r,a){return bL(r,a)}function iue(r,a,l,p){this.tag=r,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function pa(r,a,l,p){return new iue(r,a,l,p)}function Jv(r){return r=r.prototype,!(!r||!r.isReactComponent)}function aue(r){if(typeof r=="function")return Jv(r)?1:0;if(r!=null){if(r=r.$$typeof,r===xv)return 11;if(r===yv)return 14}return 2}function _u(r,a){var l=r.alternate;return l===null?(l=pa(r.tag,a,r.key,r.mode),l.elementType=r.elementType,l.type=r.type,l.stateNode=r.stateNode,l.alternate=r,r.alternate=l):(l.pendingProps=a,l.type=r.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=r.flags&14680064,l.childLanes=r.childLanes,l.lanes=r.lanes,l.child=r.child,l.memoizedProps=r.memoizedProps,l.memoizedState=r.memoizedState,l.updateQueue=r.updateQueue,a=r.dependencies,l.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},l.sibling=r.sibling,l.index=r.index,l.ref=r.ref,l}function Dm(r,a,l,p,x,v){var T=2;if(p=r,typeof r=="function")Jv(r)&&(T=1);else if(typeof r=="string")T=5;else e:switch(r){case kd:return hh(l.children,x,v,a);case gv:T=8,x|=8;break;case K2:return r=pa(12,l,a,x|2),r.elementType=K2,r.lanes=v,r;case $2:return r=pa(13,l,a,x),r.elementType=$2,r.lanes=v,r;case U2:return r=pa(19,l,a,x),r.elementType=U2,r.lanes=v,r;case nL:return Mg(l,x,v,a);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case eL:T=10;break e;case tL:T=9;break e;case xv:T=11;break e;case yv:T=14;break e;case Cu:T=16,p=null;break e}throw Error(je(130,r==null?r:typeof r,""))}return a=pa(T,l,a,x),a.elementType=r,a.type=p,a.lanes=v,a}function hh(r,a,l,p){return r=pa(7,r,p,a),r.lanes=l,r}function Mg(r,a,l,p){return r=pa(22,r,p,a),r.elementType=nL,r.lanes=l,r.stateNode={isHidden:!1},r}function C2(r,a,l){return r=pa(6,r,null,a),r.lanes=l,r}function S2(r,a,l){return a=pa(4,r.children!==null?r.children:[],r.key,a),a.lanes=l,a.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},a}function oue(r,a,l,p,x){this.tag=a,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=s2(0),this.expirationTimes=s2(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=s2(0),this.identifierPrefix=p,this.onRecoverableError=x,this.mutableSourceEagerHydrationData=null}function qv(r,a,l,p,x,v,T,M,_){return r=new oue(r,a,l,M,_),a===1?(a=1,v===!0&&(a|=8)):a=0,v=pa(3,null,null,a),r.current=v,v.stateNode=r,v.memoizedState={element:p,isDehydrated:l,cache:null,transitions:null,pendingSuspenseBoundaries:null},Fv(v),r}function lue(r,a,l){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Td,key:p==null?null:""+p,children:r,containerInfo:a,implementation:l}}function UD(r){if(!r)return Bu;r=r._reactInternals;e:{if(bh(r)!==r||r.tag!==1)throw Error(je(170));var a=r;do{switch(a.tag){case 3:a=a.stateNode.context;break e;case 1:if(pi(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break e}}a=a.return}while(a!==null);throw Error(je(171))}if(r.tag===1){var l=r.type;if(pi(l))return UL(r,l,a)}return a}function HD(r,a,l,p,x,v,T,M,_){return r=qv(l,p,!0,r,x,v,T,M,_),r.context=UD(null),l=r.current,p=Ys(),x=Gu(l),v=bl(p,x),v.callback=a??null,Pu(l,v,x),r.current.lanes=x,f0(r,x,p),mi(r,p),r}function Lg(r,a,l,p){var x=a.current,v=Ys(),T=Gu(x);return l=UD(l),a.context===null?a.context=l:a.pendingContext=l,a=bl(v,T),a.payload={element:r},p=p===void 0?null:p,p!==null&&(a.callback=p),r=Pu(x,a,T),r!==null&&(ja(r,x,T,v),Em(r,x,T)),T}function ug(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function tM(r,a){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var l=r.retryLane;r.retryLane=l!==0&&l<a?l:a}}function eI(r,a){tM(r,a),(r=r.alternate)&&tM(r,a)}function uue(){return null}var jD=typeof reportError=="function"?reportError:function(r){console.error(r)};function tI(r){this._internalRoot=r}Dg.prototype.render=tI.prototype.render=function(r){var a=this._internalRoot;if(a===null)throw Error(je(409));Lg(r,a,null,null)};Dg.prototype.unmount=tI.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var a=r.containerInfo;xh(function(){Lg(null,r,null,null)}),a[Il]=null}};function Dg(r){this._internalRoot=r}Dg.prototype.unstable_scheduleHydration=function(r){if(r){var a=kL();r={blockedOn:null,target:r,priority:a};for(var l=0;l<Tu.length&&a!==0&&a<Tu[l].priority;l++);Tu.splice(l,0,r),l===0&&NL(r)}};function nI(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function Og(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function nM(){}function cue(r,a,l,p,x){if(x){if(typeof p=="function"){var v=p;p=function(){var O=ug(T);v.call(O)}}var T=HD(a,p,r,0,null,!1,!1,"",nM);return r._reactRootContainer=T,r[Il]=T.current,Jp(r.nodeType===8?r.parentNode:r),xh(),T}for(;x=r.lastChild;)r.removeChild(x);if(typeof p=="function"){var M=p;p=function(){var O=ug(_);M.call(O)}}var _=qv(r,0,!1,null,null,!1,!1,"",nM);return r._reactRootContainer=_,r[Il]=_.current,Jp(r.nodeType===8?r.parentNode:r),xh(function(){Lg(a,_,l,p)}),_}function Pg(r,a,l,p,x){var v=l._reactRootContainer;if(v){var T=v;if(typeof x=="function"){var M=x;x=function(){var _=ug(T);M.call(_)}}Lg(a,T,r,x)}else T=cue(l,a,r,x,p);return ug(T)}SL=function(r){switch(r.tag){case 3:var a=r.stateNode;if(a.current.memoizedState.isDehydrated){var l=Ep(a.pendingLanes);l!==0&&(vv(a,l|1),mi(a,Nr()),!(un&6)&&(tf=Nr()+500,$u()))}break;case 13:xh(function(){var p=Cl(r,1);if(p!==null){var x=Ys();ja(p,r,1,x)}}),eI(r,1)}};Iv=function(r){if(r.tag===13){var a=Cl(r,134217728);if(a!==null){var l=Ys();ja(a,r,134217728,l)}eI(r,134217728)}};TL=function(r){if(r.tag===13){var a=Gu(r),l=Cl(r,a);if(l!==null){var p=Ys();ja(l,r,a,p)}eI(r,a)}};kL=function(){return In};EL=function(r,a){var l=In;try{return In=r,a()}finally{In=l}};rw=function(r,a,l){switch(a){case"input":if(Y2(r,l),a=l.name,l.type==="radio"&&a!=null){for(l=r;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll("input[name="+JSON.stringify(""+a)+'][type="radio"]'),a=0;a<l.length;a++){var p=l[a];if(p!==r&&p.form===r.form){var x=Tg(p);if(!x)throw Error(je(90));sL(p),Y2(p,x)}}}break;case"textarea":aL(r,l);break;case"select":a=l.value,a!=null&&zd(r,!!l.multiple,a,!1)}};fL=jv;pL=xh;var hue={usingClientEntryPoint:!1,Events:[m0,Rd,Tg,hL,dL,jv]},Ip={findFiberByHostInstance:ih,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},due={bundleType:Ip.bundleType,version:Ip.version,rendererPackageName:Ip.rendererPackageName,rendererConfig:Ip.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:El.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=xL(r),r===null?null:r.stateNode},findFiberByHostInstance:Ip.findFiberByHostInstance||uue,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var dm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!dm.isDisabled&&dm.supportsFiber)try{vg=dm.inject(due),Mo=dm}catch{}}Gi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=hue;Gi.createPortal=function(r,a){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nI(a))throw Error(je(200));return lue(r,a,null,l)};Gi.createRoot=function(r,a){if(!nI(r))throw Error(je(299));var l=!1,p="",x=jD;return a!=null&&(a.unstable_strictMode===!0&&(l=!0),a.identifierPrefix!==void 0&&(p=a.identifierPrefix),a.onRecoverableError!==void 0&&(x=a.onRecoverableError)),a=qv(r,1,!1,null,null,l,!1,p,x),r[Il]=a.current,Jp(r.nodeType===8?r.parentNode:r),new tI(a)};Gi.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var a=r._reactInternals;if(a===void 0)throw typeof r.render=="function"?Error(je(188)):(r=Object.keys(r).join(","),Error(je(268,r)));return r=xL(a),r=r===null?null:r.stateNode,r};Gi.flushSync=function(r){return xh(r)};Gi.hydrate=function(r,a,l){if(!Og(a))throw Error(je(200));return Pg(null,r,a,!0,l)};Gi.hydrateRoot=function(r,a,l){if(!nI(r))throw Error(je(405));var p=l!=null&&l.hydratedSources||null,x=!1,v="",T=jD;if(l!=null&&(l.unstable_strictMode===!0&&(x=!0),l.identifierPrefix!==void 0&&(v=l.identifierPrefix),l.onRecoverableError!==void 0&&(T=l.onRecoverableError)),a=HD(a,null,r,1,l??null,x,!1,v,T),r[Il]=a.current,Jp(r),p)for(r=0;r<p.length;r++)l=p[r],x=l._getVersion,x=x(l._source),a.mutableSourceEagerHydrationData==null?a.mutableSourceEagerHydrationData=[l,x]:a.mutableSourceEagerHydrationData.push(l,x);return new Dg(a)};Gi.render=function(r,a,l){if(!Og(a))throw Error(je(200));return Pg(null,r,a,!1,l)};Gi.unmountComponentAtNode=function(r){if(!Og(r))throw Error(je(40));return r._reactRootContainer?(xh(function(){Pg(null,null,r,!1,function(){r._reactRootContainer=null,r[Il]=null})}),!0):!1};Gi.unstable_batchedUpdates=jv;Gi.unstable_renderSubtreeIntoContainer=function(r,a,l,p){if(!Og(l))throw Error(je(200));if(r==null||r._reactInternals===void 0)throw Error(je(38));return Pg(r,a,l,!1,p)};Gi.version="18.3.1-next-f1338f8080-20240426";function YD(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(YD)}catch(r){console.error(r)}}YD(),Y4.exports=Gi;var fue=Y4.exports,rM=fue;X2.createRoot=rM.createRoot,X2.hydrateRoot=rM.hydrateRoot;var fm={exports:{}},sM;function pue(){return sM||(sM=1,function(r,a){var l=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof $a<"u")return $a;throw new Error("unable to locate global object")},p=l();r.exports=a=p.fetch,p.fetch&&(a.default=p.fetch.bind(p)),a.Headers=p.Headers,a.Request=p.Request,a.Response=p.Response}(fm,fm.exports)),fm.exports}const mue={},gue=Object.freeze(Object.defineProperty({__proto__:null,default:mue},Symbol.toStringTag,{value:"Module"})),xue=Wae(gue);var T2={};(function(){function r(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const i in s)if(i!=="default"&&!(i in n)){const o=Object.getOwnPropertyDescriptor(s,i);o&&Object.defineProperty(n,i,o.get?o:{enumerable:!0,get:()=>s[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const a=1e-7,l=1e-4;class p{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class x{refCount(e){return v("refCount")}incRef(e){return v("incRef")}timerAvailable(){return!0}time(e){return v("time")}read(e){return v("read")}readSync(e){return v("readSync")}readToGPU(e,t){return v("readToGPU")}numDataIds(){return v("numDataIds")}disposeData(e,t){return v("disposeData")}write(e,t,s){return v("write")}move(e,t,s,i,o){return v("move")}createTensorFromGPUData(e,t,s){return v("createTensorFromGPUData")}memory(){return v("memory")}floatPrecision(){return v("floatPrecision")}epsilon(){return this.floatPrecision()===32?a:l}dispose(){return v("dispose")}}function v(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function T(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,O(n,e,t)}function M(n,e,t){return Math.max(n,Math.min(e,t))}function _(n){return n%2===0?n:n+1}function O(n,e,t){const s=n[e];n[e]=n[t],n[t]=s}function V(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function D(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function $(n,e,t=""){D(se(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function re(n){D(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function H(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function se(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Ee(n){return n%1===0}function ee(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function Y(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function j(n,e=i=>0,t,s){return new Promise((i,o)=>{let c=0;const h=()=>{if(n()){i();return}c++;const f=e(c);if(t!=null&&c>=t){o();return}s!=null?s(h,f):setTimeout(h,f)};h()})}function fe(n,e){let t=1,s=-1;for(let o=0;o<n.length;++o)if(n[o]>=0)t*=n[o];else if(n[o]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${o}`);s=o}else if(n[o]<0)throw Error(`Shapes can not be < 0. Found ${n[o]} at dim ${o}`);if(s===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const i=n.slice();return i[s]=e/t,i}function be(n,e){const t=e.length;return n=n==null?e.map((s,i)=>i):[].concat(n),D(n.every(s=>s>=-t&&s<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),D(n.every(s=>Ee(s)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(s=>s<0?t+s:s)}function Fe(n,e){const t=[],s=[],i=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||i?null:be(e,n).sort();let c=0;for(let h=0;h<n.length;++h){if(o!=null){if(o[c]===h&&n[h]!==1)throw new Error(`Can't squeeze axis ${h} since its dim '${n[h]}' is not 1`);(o[c]==null||o[c]>h)&&n[h]===1&&(t.push(n[h]),s.push(h)),o[c]<=h&&c++}n[h]!==1&&(t.push(n[h]),s.push(h))}return{newShape:t,keptDims:s}}function ue(n,e){return we(n,e)}function we(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function Ne(n,e){for(let t=0;t<n.length;t++){const s=n[t];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function it(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function Bt(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function ht(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function _t(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function fn(n){return typeof n=="string"||n instanceof String}function Pe(n){return typeof n=="boolean"}function kn(n){return typeof n=="number"}function ut(n){return Array.isArray(n)?ut(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":kn(n)?"float32":fn(n)?"string":Pe(n)?"bool":"float32"}function Je(n){return!!(n&&n.constructor&&n.call&&n.apply)}function xt(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function We(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let s=e-3;s>=0;--s)t[s]=t[s+1]*n[s+1];return t}function yn(n,e,t,s=!1){const i=new Array;if(e.length===1){const o=e[0]*(s?2:1);for(let c=0;c<o;c++)i[c]=t[n+c]}else{const o=e[0],c=e.slice(1),h=c.reduce((f,g)=>f*g)*(s?2:1);for(let f=0;f<o;f++)i[f]=yn(n+f*h,c,t,s)}return i}function Lt(n,e,t=!1){if(n.length===0)return e[0];const s=n.reduce((i,o)=>i*o)*(t?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return yn(0,n,e,t)}function qs(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function En(n,e){const t=$n(n,e);for(let s=0;s<t.length;s++)t[s]=1;return t}function $n(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function yt(n,e){const t=n.reduce((s,i)=>s*i,1);if(e==null||e==="float32")return Lt(n,new Float32Array(t));if(e==="int32")return Lt(n,new Int32Array(t));if(e==="bool")return Lt(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function jr(n){n.forEach(e=>{D(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function bn(n,e,t){if(e===0)return 0;if(e===1)return n[0];let s=n[n.length-1];for(let i=0;i<n.length-1;++i)s+=t[i]*n[i];return s}function Bi(n,e,t){if(e===0)return[];if(e===1)return[n];const s=new Array(e);for(let i=0;i<s.length-1;++i)s[i]=Math.floor(n/t[i]),n-=s[i]*t[i];return s[s.length-1]=n,s}function Po(n){return n&&n.then&&typeof n.then=="function"}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ls="tfjsflags";class wh{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=an,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(ke().getBool("IS_TEST")||ke().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,s){if(this.flagRegistry[e]={evaluationFn:t,setHook:s},this.urlFlags[e]!=null){const i=this.urlFlags[e];ke().getBool("IS_TEST")||ke().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${i}.`),this.set(e,i)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(Po(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);ls in e&&e[ls].split(",").forEach(t=>{const[s,i]=t.split(":");this.urlFlags[s]=Wi(s,i)})}}function an(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...s)=>(Nl(e,s[0],s[1]),s.join("="))),e}function Nl(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Wi(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function ke(){return Ar}let Ar=null;function Cn(n){Ar=n}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/let Ht;function Yu(){if(Ht==null){let n;if(typeof window<"u")n=window;else if(typeof $a<"u")n=$a;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");Ht=n}return Ht}function gt(){const n=Yu();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function Al(n,e){const t=gt();if(t.has(n))return t.get(n);{const s=e();return t.set(n,s),t.get(n)}}const Qu="Abs",_s="Acos",Fo="Acosh",Yr="Add",vh="AddN",zi="All",Br="Any",Ju="ArgMax",Go="ArgMin",qu="Asin",_n="Asinh",et="Atan",Un="Atanh",on="Atan2",Nn="AvgPool",_o="AvgPoolGrad",Rl="AvgPool3D",Ih="AvgPool3DGrad",Qt="BatchMatMul",Xi="BatchToSpaceND",Ch="Bincount",Sh="BitwiseAnd",gi="BroadcastTo",Th="BroadcastArgs",dr="Cast",Zi="Ceil",Qa="ClipByValue",ei="Complex",kh="ComplexAbs",Ki="Concat",Ml="Conv2D",Qr="Conv2DBackpropFilter",$i="Conv2DBackpropInput",us="Conv3D",lt="Conv3DBackpropFilterV2",Ja="Conv3DBackpropInputV2",Vo="Cos",Rr="Cosh",qa="Cumprod",Bo="Cumsum",Ll="CropAndResize",ti="DenseBincount",cf="DepthToSpace",Eh="DepthwiseConv2dNative",ni="DepthwiseConv2dNativeBackpropFilter",Wr="DepthwiseConv2dNativeBackpropInput",An="Diag",ec="Dilation2D",Ui="Dilation2DBackpropInput",tc="Dilation2DBackpropFilter",ze="Draw",nc="RealDiv",Vn="Einsum",Hi="Elu",hf="EluGrad",Jt="Erf",qt="Equal",Wt="Exp",Dl="ExpandDims",Wo="Expm1",rc="FFT",sr="Fill",ji="FlipLeftRight",sc="Floor",Rn="FloorDiv",xi="FusedBatchNorm",Nh="GatherV2",zo="GatherNd",dn="Greater",fr="GreaterEqual",Ie="Identity",q="IFFT",bt="Imag",qn="IsFinite",Jr="IsInf",ic="IsNan",Ol="LeakyRelu",cs="Less",wt="LessEqual",Bn="LinSpace",Pl="Log",ac="Log1p",Fl="LogicalAnd",Xo="LogicalNot",Gl="LogicalOr",Zg="LogSoftmax",ir="LRN",Zo="LRNGrad",yi="Max",Ct="Maximum",Ah="MaxPool",Ot="MaxPoolGrad",pr="MaxPool3D",df="MaxPool3DGrad",Rh="MaxPoolWithArgmax",oc="Mean",Yi="Min",lc="Minimum",eo="MirrorPad",wa="Mod",_l="Multinomial",Vl="Multiply",to="Neg",no="NotEqual",qr="NonMaxSuppressionV3",Mh="NonMaxSuppressionV4",Lh="NonMaxSuppressionV5",uc="OnesLike",Dh="OneHot",Oh="Pack",Ph="PadV2",rn="Pow",cc="Prelu",Ko="Prod",va="RaggedGather",C0="RaggedRange",Ae="RaggedTensorToTensor",Gt="Range",Tr="Real",ro="Reciprocal",Bl="Relu",Fh="Reshape",Gh="ResizeNearestNeighbor",ff="ResizeNearestNeighborGrad",Wl="ResizeBilinear",ar="ResizeBilinearGrad",$o="Relu6",Mn="Reverse",so="Round",bi="Rsqrt",pn="ScatterNd",kt="TensorScatterUpdate",S0="SearchSorted",mn="Select",wi="Selu",Ia="Slice",hc="Sin",vs="Sinh",Uo="Sign",zl="Sigmoid",Ho="Softplus",Xl="Sqrt",dc="Sum",_h="SpaceToBatchND",Ca="SplitV",Zl="Softmax",T0="SparseFillEmptyRows",Kl="SparseReshape",k0="SparseSegmentMean",Sa="SparseSegmentSum",fc="SparseToDense",es="SquaredDifference",Vh="Square",ri="StaticRegexReplace",pf="StridedSlice",Bh="StringNGrams",E0="StringSplit",mf="StringToHashBucketFast",Is="Sub",pc="Tan",jo="Tanh",Ta="Tile",jt="TopK",$l="Transform",K="Transpose",u="Unique",d="Unpack",m="UnsortedSegmentSum",b="ZerosLike",w="Step",S="FromPixels",E="RotateWithOffset",A="_FusedMatMul",G="FusedConv2D",B="FusedDepthwiseConv2D";/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Z(...n){ke().getBool("IS_TEST")||ke().getBool("PROD")||console.warn(...n)}function U(...n){ke().getBool("IS_TEST")||ke().getBool("PROD")||console.log(...n)}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ne=Al("kernelRegistry",()=>new Map),le=Al("gradRegistry",()=>new Map);function ce(n,e){const t=Ke(n,e);return ne.get(t)}function ve(n){return le.get(n)}function Re(n){const e=ne.entries(),t=[];for(;;){const{done:s,value:i}=e.next();if(s)break;const[o,c]=i,[h]=o.split("_");h===n&&t.push(c)}return t}function Xe(n){const{kernelName:e,backendName:t}=n,s=Ke(e,t);ne.has(s)&&Z(`The kernel '${e}' for backend '${t}' is already registered`),ne.set(s,n)}function Ye(n){const{kernelName:e}=n;le.has(e)&&ke().getBool("DEBUG")&&Z(`Overriding the gradient for '${e}'`),le.set(e,n)}function Ke(n,e){return`${e}_${n}`}/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Kt(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var At=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof $a<"u"?$a:typeof self<"u"?self:{};function Cs(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function vi(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var i=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:function(){return n[s]}})}),t}var hs=Pt,zt=null;try{zt=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Pt(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}Pt.prototype.__isLong__,Object.defineProperty(Pt.prototype,"__isLong__",{value:!0});function Sn(n){return(n&&n.__isLong__)===!0}Pt.isLong=Sn;var Yo={},Qo={};function Jo(n,e){var t,s,i;return e?(n>>>=0,(i=0<=n&&n<256)&&(s=Qo[n],s)?s:(t=Wn(n,(n|0)<0?-1:0,!0),i&&(Qo[n]=t),t)):(n|=0,(i=-128<=n&&n<128)&&(s=Yo[n],s)?s:(t=Wn(n,n<0?-1:0,!1),i&&(Yo[n]=t),t))}Pt.fromInt=Jo;function si(n,e){if(isNaN(n))return e?mc:Qi;if(e){if(n<0)return mc;if(n>=WI)return $I}else{if(n<=-zI)return ii;if(n+1>=zI)return KI}return n<0?si(-n,e).neg():Wn(n%Wh|0,n/Wh|0,e)}Pt.fromNumber=si;function Wn(n,e,t){return new Pt(n,e,t)}Pt.fromBits=Wn;var N0=Math.pow;function Kg(n,e,t){if(n.length===0)throw Error("empty string");if(n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return Qi;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var s;if((s=n.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return Kg(n.substring(1),e,t).neg();for(var i=si(N0(t,8)),o=Qi,c=0;c<n.length;c+=8){var h=Math.min(8,n.length-c),f=parseInt(n.substring(c,c+h),t);if(h<8){var g=si(N0(t,h));o=o.mul(g).add(si(f))}else o=o.mul(i),o=o.add(si(f))}return o.unsigned=e,o}Pt.fromString=Kg;function ka(n,e){return typeof n=="number"?si(n,e):typeof n=="string"?Kg(n,e):Wn(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}Pt.fromValue=ka;var BI=65536,lP=1<<24,Wh=BI*BI,WI=Wh*Wh,zI=WI/2,XI=Jo(lP),Qi=Jo(0);Pt.ZERO=Qi;var mc=Jo(0,!0);Pt.UZERO=mc;var zh=Jo(1);Pt.ONE=zh;var ZI=Jo(1,!0);Pt.UONE=ZI;var $g=Jo(-1);Pt.NEG_ONE=$g;var KI=Wn(-1,2147483647,!1);Pt.MAX_VALUE=KI;var $I=Wn(-1,-1,!0);Pt.MAX_UNSIGNED_VALUE=$I;var ii=Wn(0,-2147483648,!1);Pt.MIN_VALUE=ii;var rt=Pt.prototype;rt.toInt=function(){return this.unsigned?this.low>>>0:this.low},rt.toNumber=function(){return this.unsigned?(this.high>>>0)*Wh+(this.low>>>0):this.high*Wh+(this.low>>>0)},rt.toString=function(n){if(n=n||10,n<2||36<n)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ii)){var e=si(n),t=this.div(e),s=t.mul(e).sub(this);return t.toString(n)+s.toInt().toString(n)}else return"-"+this.neg().toString(n);for(var i=si(N0(n,6),this.unsigned),o=this,c="";;){var h=o.div(i),f=o.sub(h.mul(i)).toInt()>>>0,g=f.toString(n);if(o=h,o.isZero())return g+c;for(;g.length<6;)g="0"+g;c=""+g+c}},rt.getHighBits=function(){return this.high},rt.getHighBitsUnsigned=function(){return this.high>>>0},rt.getLowBits=function(){return this.low},rt.getLowBitsUnsigned=function(){return this.low>>>0},rt.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ii)?64:this.neg().getNumBitsAbs();for(var n=this.high!=0?this.high:this.low,e=31;e>0&&!(n&1<<e);e--);return this.high!=0?e+33:e+1},rt.isZero=function(){return this.high===0&&this.low===0},rt.eqz=rt.isZero,rt.isNegative=function(){return!this.unsigned&&this.high<0},rt.isPositive=function(){return this.unsigned||this.high>=0},rt.isOdd=function(){return(this.low&1)===1},rt.isEven=function(){return(this.low&1)===0},rt.equals=function(n){return Sn(n)||(n=ka(n)),this.unsigned!==n.unsigned&&this.high>>>31===1&&n.high>>>31===1?!1:this.high===n.high&&this.low===n.low},rt.eq=rt.equals,rt.notEquals=function(n){return!this.eq(n)},rt.neq=rt.notEquals,rt.ne=rt.notEquals,rt.lessThan=function(n){return this.comp(n)<0},rt.lt=rt.lessThan,rt.lessThanOrEqual=function(n){return this.comp(n)<=0},rt.lte=rt.lessThanOrEqual,rt.le=rt.lessThanOrEqual,rt.greaterThan=function(n){return this.comp(n)>0},rt.gt=rt.greaterThan,rt.greaterThanOrEqual=function(n){return this.comp(n)>=0},rt.gte=rt.greaterThanOrEqual,rt.ge=rt.greaterThanOrEqual,rt.compare=function(n){if(Sn(n)||(n=ka(n)),this.eq(n))return 0;var e=this.isNegative(),t=n.isNegative();return e&&!t?-1:!e&&t?1:this.unsigned?n.high>>>0>this.high>>>0||n.high===this.high&&n.low>>>0>this.low>>>0?-1:1:this.sub(n).isNegative()?-1:1},rt.comp=rt.compare,rt.negate=function(){return!this.unsigned&&this.eq(ii)?ii:this.not().add(zh)},rt.neg=rt.negate,rt.add=function(n){Sn(n)||(n=ka(n));var e=this.high>>>16,t=this.high&65535,s=this.low>>>16,i=this.low&65535,o=n.high>>>16,c=n.high&65535,h=n.low>>>16,f=n.low&65535,g=0,y=0,I=0,C=0;return C+=i+f,I+=C>>>16,C&=65535,I+=s+h,y+=I>>>16,I&=65535,y+=t+c,g+=y>>>16,y&=65535,g+=e+o,g&=65535,Wn(I<<16|C,g<<16|y,this.unsigned)},rt.subtract=function(n){return Sn(n)||(n=ka(n)),this.add(n.neg())},rt.sub=rt.subtract,rt.multiply=function(n){if(this.isZero())return Qi;if(Sn(n)||(n=ka(n)),zt){var e=zt.mul(this.low,this.high,n.low,n.high);return Wn(e,zt.get_high(),this.unsigned)}if(n.isZero())return Qi;if(this.eq(ii))return n.isOdd()?ii:Qi;if(n.eq(ii))return this.isOdd()?ii:Qi;if(this.isNegative())return n.isNegative()?this.neg().mul(n.neg()):this.neg().mul(n).neg();if(n.isNegative())return this.mul(n.neg()).neg();if(this.lt(XI)&&n.lt(XI))return si(this.toNumber()*n.toNumber(),this.unsigned);var t=this.high>>>16,s=this.high&65535,i=this.low>>>16,o=this.low&65535,c=n.high>>>16,h=n.high&65535,f=n.low>>>16,g=n.low&65535,y=0,I=0,C=0,k=0;return k+=o*g,C+=k>>>16,k&=65535,C+=i*g,I+=C>>>16,C&=65535,C+=o*f,I+=C>>>16,C&=65535,I+=s*g,y+=I>>>16,I&=65535,I+=i*f,y+=I>>>16,I&=65535,I+=o*h,y+=I>>>16,I&=65535,y+=t*g+s*f+i*h+o*c,y&=65535,Wn(C<<16|k,y<<16|I,this.unsigned)},rt.mul=rt.multiply,rt.divide=function(n){if(Sn(n)||(n=ka(n)),n.isZero())throw Error("division by zero");if(zt){if(!this.unsigned&&this.high===-2147483648&&n.low===-1&&n.high===-1)return this;var e=(this.unsigned?zt.div_u:zt.div_s)(this.low,this.high,n.low,n.high);return Wn(e,zt.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?mc:Qi;var t,s,i;if(this.unsigned){if(n.unsigned||(n=n.toUnsigned()),n.gt(this))return mc;if(n.gt(this.shru(1)))return ZI;i=mc}else{if(this.eq(ii)){if(n.eq(zh)||n.eq($g))return ii;if(n.eq(ii))return zh;var o=this.shr(1);return t=o.div(n).shl(1),t.eq(Qi)?n.isNegative()?zh:$g:(s=this.sub(n.mul(t)),i=t.add(s.div(n)),i)}else if(n.eq(ii))return this.unsigned?mc:Qi;if(this.isNegative())return n.isNegative()?this.neg().div(n.neg()):this.neg().div(n).neg();if(n.isNegative())return this.div(n.neg()).neg();i=Qi}for(s=this;s.gte(n);){t=Math.max(1,Math.floor(s.toNumber()/n.toNumber()));for(var c=Math.ceil(Math.log(t)/Math.LN2),h=c<=48?1:N0(2,c-48),f=si(t),g=f.mul(n);g.isNegative()||g.gt(s);)t-=h,f=si(t,this.unsigned),g=f.mul(n);f.isZero()&&(f=zh),i=i.add(f),s=s.sub(g)}return i},rt.div=rt.divide,rt.modulo=function(n){if(Sn(n)||(n=ka(n)),zt){var e=(this.unsigned?zt.rem_u:zt.rem_s)(this.low,this.high,n.low,n.high);return Wn(e,zt.get_high(),this.unsigned)}return this.sub(this.div(n).mul(n))},rt.mod=rt.modulo,rt.rem=rt.modulo,rt.not=function(){return Wn(~this.low,~this.high,this.unsigned)},rt.and=function(n){return Sn(n)||(n=ka(n)),Wn(this.low&n.low,this.high&n.high,this.unsigned)},rt.or=function(n){return Sn(n)||(n=ka(n)),Wn(this.low|n.low,this.high|n.high,this.unsigned)},rt.xor=function(n){return Sn(n)||(n=ka(n)),Wn(this.low^n.low,this.high^n.high,this.unsigned)},rt.shiftLeft=function(n){return Sn(n)&&(n=n.toInt()),(n&=63)===0?this:n<32?Wn(this.low<<n,this.high<<n|this.low>>>32-n,this.unsigned):Wn(0,this.low<<n-32,this.unsigned)},rt.shl=rt.shiftLeft,rt.shiftRight=function(n){return Sn(n)&&(n=n.toInt()),(n&=63)===0?this:n<32?Wn(this.low>>>n|this.high<<32-n,this.high>>n,this.unsigned):Wn(this.high>>n-32,this.high>=0?0:-1,this.unsigned)},rt.shr=rt.shiftRight,rt.shiftRightUnsigned=function(n){if(Sn(n)&&(n=n.toInt()),n&=63,n===0)return this;var e=this.high;if(n<32){var t=this.low;return Wn(t>>>n|e<<32-n,e>>>n,this.unsigned)}else return n===32?Wn(e,0,this.unsigned):Wn(e>>>n-32,0,this.unsigned)},rt.shru=rt.shiftRightUnsigned,rt.shr_u=rt.shiftRightUnsigned,rt.toSigned=function(){return this.unsigned?Wn(this.low,this.high,!1):this},rt.toUnsigned=function(){return this.unsigned?this:Wn(this.low,this.high,!0)},rt.toBytes=function(n){return n?this.toBytesLE():this.toBytesBE()},rt.toBytesLE=function(){var n=this.high,e=this.low;return[e&255,e>>>8&255,e>>>16&255,e>>>24,n&255,n>>>8&255,n>>>16&255,n>>>24]},rt.toBytesBE=function(){var n=this.high,e=this.low;return[n>>>24,n>>>16&255,n>>>8&255,n&255,e>>>24,e>>>16&255,e>>>8&255,e&255]},Pt.fromBytes=function(n,e,t){return t?Pt.fromBytesLE(n,e):Pt.fromBytesBE(n,e)},Pt.fromBytesLE=function(n,e){return new Pt(n[0]|n[1]<<8|n[2]<<16|n[3]<<24,n[4]|n[5]<<8|n[6]<<16|n[7]<<24,e)},Pt.fromBytesBE=function(n,e){return new Pt(n[4]<<24|n[5]<<16|n[6]<<8|n[7],n[0]<<24|n[1]<<16|n[2]<<8|n[3],e)};const UI=Cs(hs),uP=r({__proto__:null,default:UI},[hs]);/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const gc=UI||uP;function A0(n){return gc.fromString(n,!0,16)}const HI=A0("c3a5c85c97cb3127"),xc=A0("b492b66fbe98f273"),Ss=A0("9ae16a3b2f90404f");function Ug(n){return n.xor(n.shru(47))}function jI(n,e,t){const s=n.slice(e,e+t);return gc.fromBytes(Array.from(s),!0,!0)}function Ln(n,e){return jI(n,e,8)}function YI(n,e){return jI(n,e,4)}function zr(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function Ul(n,e,t=A0("9ddfea08eb382d69")){let s=n.xor(e).mul(t);s=s.xor(s.shru(47));let i=e.xor(s).mul(t);return i=i.xor(i.shru(47)),i=i.mul(t),i}function cP(n,e,t,s,i,o){i=i.add(n),o=zr(o.add(i).add(s),21);const c=i;return i=i.add(e),i=i.add(t),o=o.add(zr(i,44)),[i.add(s),o.add(c)]}function R0(n,e,t,s){return cP(Ln(n,e),Ln(n,e+8),Ln(n,e+16),Ln(n,e+24),t,s)}function hP(n,e=n.length){if(e>=8){const t=Ss.add(e*2),s=Ln(n,0).add(Ss),i=Ln(n,e-8),o=zr(i,37).mul(t).add(s),c=zr(s,25).add(i).mul(t);return Ul(o,c,t)}if(e>=4){const t=Ss.add(e*2),s=YI(n,0);return Ul(s.shl(3).add(e),YI(n,e-4),t)}if(e>0){const t=n[0],s=n[e>>1],i=n[e-1],o=t+(s<<8),c=e+(i<<2);return Ug(Ss.mul(o).xor(HI.mul(c))).mul(Ss)}return Ss}function dP(n,e=n.length){const t=Ss.add(e*2),s=Ln(n,0).mul(xc),i=Ln(n,8),o=Ln(n,e-8).mul(t),c=Ln(n,e-16).mul(Ss);return Ul(zr(s.add(i),43).add(zr(o,30)).add(c),s.add(zr(i.add(Ss),18)).add(o),t)}function fP(n,e=n.length){const t=Ss.add(e*2),s=Ln(n,0).mul(Ss),i=Ln(n,8),o=Ln(n,e-8).mul(t),c=Ln(n,e-16).mul(Ss),h=zr(s.add(i),43).add(zr(o,30)).add(c),f=Ul(h,s.add(zr(i.add(Ss),18)).add(o),t),g=Ln(n,16).mul(t),y=Ln(n,24),I=h.add(Ln(n,e-32)).mul(t),C=f.add(Ln(n,e-24)).mul(t);return Ul(zr(g.add(y),43).add(zr(I,30)).add(C),g.add(zr(y.add(s),18)).add(I),t)}function pP(n,e=n.length){const t=gc.fromNumber(81,!0);if(e<=32)return e<=16?hP(n,e):dP(n,e);if(e<=64)return fP(n,e);let s=t,i=t.mul(xc).add(113),o=Ug(i.mul(Ss).add(113)).mul(Ss),c=[gc.UZERO,gc.UZERO],h=[gc.UZERO,gc.UZERO];s=s.mul(Ss).add(Ln(n,0));let f=0;const g=(e-1>>6)*64,y=g+(e-1&63)-63;do s=zr(s.add(i).add(c[0]).add(Ln(n,f+8)),37).mul(xc),i=zr(i.add(c[1]).add(Ln(n,f+48)),42).mul(xc),s=s.xor(h[1]),i=i.add(c[0]).add(Ln(n,f+40)),o=zr(o.add(h[0]),33).mul(xc),c=R0(n,f,c[1].mul(xc),s.add(h[0])),h=R0(n,f+32,o.add(h[1]),i.add(Ln(n,f+16))),[o,s]=[s,o],f+=64;while(f!==g);const I=xc.add(o.and(255).shl(1));return f=y,h[0]=h[0].add(e-1&63),c[0]=c[0].add(h[0]),h[0]=h[0].add(c[0]),s=zr(s.add(i).add(c[0]).add(Ln(n,f+8)),37).mul(I),i=zr(i.add(c[1]).add(Ln(n,f+48)),42).mul(I),s=s.xor(h[1].mul(9)),i=i.add(c[0].mul(9).add(Ln(n,f+40))),o=zr(o.add(h[0]),33).mul(I),c=R0(n,f,c[1].mul(I),s.add(h[0])),h=R0(n,f+32,o.add(h[1]),i.add(Ln(n,f+16))),[o,s]=[s,o],Ul(Ul(c[0],h[0],I).add(Ug(i).mul(HI)).add(o),Ul(c[1],h[1],I).add(s),I)}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Hl(n,e){return e==="string"?jl(n):yc([n],e)}function mP(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function yc(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=bc(n)),ke().getBool("DEBUG")&&Ne(n,e),mP(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let s=0;s<t.length;++s)Math.round(n[s])!==0&&(t[s]=1);return t}else throw new Error(`Unknown data type ${e}`)}function Vs(){return ke().platform.now()}function jl(n,e="utf-8"){return e=e||"utf-8",ke().platform.encode(n,e)}function Yl(n,e="utf-8"){return e=e||"utf-8",ke().platform.decode(n,e)}function Ji(n){return ke().platform.isTypedArray!=null?ke().platform.isTypedArray(n):Kt(n)}function bc(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||Po(n)||n==null||Ji(n)&&t)e.push(n);else if(Array.isArray(n)||Ji(n))for(let s=0;s<n.length;++s)bc(n[s],e,t);else{let s=-1;for(const i of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(i)&&(s=Math.max(s,Number(i)));for(let i=0;i<=s;i++)bc(n[i],e,t)}return e}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class gP{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new yP)}profileKernel(e,t,s){let i;const o=()=>{i=s()};let c;const h=Vs();if(this.backendTimer.timerAvailable())c=this.backendTimer.time(o);else{o();for(const f of i)f.dataSync();c=Promise.resolve({kernelMs:Vs()-h})}if(ke().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let f=0;f<i.length;f++){const g=i[f];g.data().then(y=>{xP(y,g.dtype,e)})}return{kernelName:e,outputs:i,inputs:t,timeMs:c.then(f=>f.kernelMs),extraInfo:c.then(f=>f.getExtraProfileInfo!=null?f.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:s,timeMs:i,inputs:o,extraInfo:c}=e;s.forEach(h=>{Promise.all([h.data(),i,c]).then(f=>{this.logger.logKernelProfile(t,h,f[0],f[1],o,f[2])})})}}function xP(n,e,t){if(e!=="float32")return!1;for(let s=0;s<n.length;s++){const i=n[s];if(isNaN(i)||!isFinite(i))return console.warn(`Found ${i} in the result of '${t}'`),!0}return!1}class yP{logKernelProfile(e,t,s,i,o,c){const h=typeof i=="number"?Y(`${i}ms`,9):i.error,f=Y(e,25),g=t.rank,y=t.size,I=Y(t.shape.toString(),14);let C="";for(const k in o){const N=o[k];if(N!=null){const R=N.shape||t.shape,P=R.length;C+=`${k}: ${P}D ${P>0?R:""} `}}console.log(`%c${f}	%c${h}	%c${g}D ${I}	%c${y}	%c${C}	%c${c}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function bP(n,e,t){const s={},i={};for(let f=0;f<e.length;f++)s[e[f].id]=!0;for(let f=0;f<n.length;f++){const g=n[f],y=g.inputs;for(const I in y){const C=y[I];let k=!1;for(let N=0;N<e.length;N++)if(s[C.id]){g.outputs.forEach(R=>s[R.id]=!0),k=!0,i[g.id]=!0;break}if(k)break}}const o={};o[t.id]=!0;const c={};for(let f=n.length-1;f>=0;f--){const g=n[f],y=g.inputs;for(let I=0;I<g.outputs.length;I++)if(o[g.outputs[I].id]){for(const C in y)o[y[C].id]=!0,c[g.id]=!0;break}}const h=[];for(let f=0;f<n.length;f++){const g=n[f];if(i[g.id]&&c[g.id]){const y={};for(const C in g.inputs){const k=g.inputs[C];s[k.id]&&(y[C]=k)}const I=Object.assign({},g);I.inputs=y,I.outputs=g.outputs,h.push(I)}}return h}function wP(n,e,t,s){for(let i=e.length-1;i>=0;i--){const o=e[i],c=[];if(o.outputs.forEach(f=>{const g=n[f.id];g!=null?c.push(g):c.push(null)}),o.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const h=o.gradient(c);for(const f in o.inputs){if(!(f in h))throw new Error(`Cannot backprop through input ${f}. Available gradients found: ${Object.keys(h)}.`);const g=t(()=>h[f]());if(g.dtype!=="float32")throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${f} must have 'float32' dtype, but has '${g.dtype}'`);const y=o.inputs[f];if(!se(g.shape,y.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${f}' has shape '${g.shape}', which does not match the shape of the input '${y.shape}'`);if(n[y.id]==null)n[y.id]=g;else{const I=n[y.id];n[y.id]=s(I,g),I.dispose()}}}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const QI=20,gf=3,Hg=7;function vP(n,e,t,s){const i=We(e),o=IP(n,e,t,i),c=e.length,h=M0(n,e,t,i,o),f=["Tensor"];return s&&(f.push(`  dtype: ${t}`),f.push(`  rank: ${c}`),f.push(`  shape: [${e}]`),f.push("  values:")),f.push(h.map(g=>"    "+g).join(`
`)),f.join(`
`)}function IP(n,e,t,s){const i=H(e),o=s[s.length-1],c=new Array(o).fill(0),h=e.length,f=t==="complex64"?yf(n):n;if(h>1)for(let g=0;g<i/o;g++){const y=g*o;for(let I=0;I<o;I++)c[I]=Math.max(c[I],xf(f[y+I],0,t).length)}return c}function xf(n,e,t){let s;return Array.isArray(n)?s=`${parseFloat(n[0].toFixed(Hg))} + ${parseFloat(n[1].toFixed(Hg))}j`:fn(n)?s=`'${n}'`:t==="bool"?s=JI(n):s=parseFloat(n.toFixed(Hg)).toString(),Y(s,e)}function JI(n){return n===0?"false":"true"}function M0(n,e,t,s,i,o=!0){const c=t==="complex64"?2:1,h=e[0],f=e.length;if(f===0){if(t==="complex64"){const R=yf(n);return[xf(R[0],0,t)]}return t==="bool"?[JI(n[0])]:[n[0].toString()]}if(f===1){if(h>QI){const R=gf*c;let P=Array.from(n.slice(0,R)),L=Array.from(n.slice((h-gf)*c,h*c));return t==="complex64"&&(P=yf(P),L=yf(L)),["["+P.map((F,W)=>xf(F,i[W],t)).join(", ")+", ..., "+L.map((F,W)=>xf(F,i[h-gf+W],t)).join(", ")+"]"]}return["["+(t==="complex64"?yf(n):Array.from(n)).map((R,P)=>xf(R,i[P],t)).join(", ")+"]"]}const g=e.slice(1),y=s.slice(1),I=s[0]*c,C=[];if(h>QI){for(let R=0;R<gf;R++){const P=R*I,L=P+I;C.push(...M0(n.slice(P,L),g,t,y,i,!1))}C.push("...");for(let R=h-gf;R<h;R++){const P=R*I,L=P+I;C.push(...M0(n.slice(P,L),g,t,y,i,R===h-1))}}else for(let R=0;R<h;R++){const P=R*I,L=P+I;C.push(...M0(n.slice(P,L),g,t,y,i,R===h-1))}const k=f===2?",":"";C[0]="["+(h>0?C[0]+k:"");for(let R=1;R<C.length-1;R++)C[R]=" "+C[R]+k;let N=`,
`;for(let R=2;R<f;R++)N+=`
`;return C[C.length-1]=" "+C[C.length-1]+"]"+(o?"":N),C}function yf(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class ts{constructor(e,t,s){if(this.dtype=t,this.shape=e.slice(),this.size=H(e),s!=null){const i=s.length;D(i===this.size,()=>`Length of values '${i}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||we(t,this.size),this.strides=We(e)}set(e,...t){t.length===0&&(t=[0]),D(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const s=this.locToIndex(t);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const i of e){if(i<0||i>=this.shape[t]){const o=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(o)}t++}let s=e[e.length-1];for(let i=0;i<e.length-1;++i)s+=this.strides[i]*e[i];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let s=0;s<e.length-1;++s)t+=this.strides[s]*e[s];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let s=0;s<t.length-1;++s)t[s]=Math.floor(e/this.strides[s]),e-=t[s]*this.strides[s];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return Ea().makeTensor(this.values,this.shape,this.dtype)}}let Ea=null,Xh=null;function CP(n){Ea=n}function SP(n){Xh=n}class Mr{constructor(e,t,s,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=H(e),this.strides=We(e),this.dataId=s,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Xh.buffer(this.shape,this.dtype,e)}bufferSync(){return Xh.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Lt(this.shape,e,this.dtype==="complex64")}arraySync(){return Lt(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=Ea().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(s=>Yl(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Ea().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=Ea().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>Yl(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Ea().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Ea().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Xh.print(this,e)}clone(){return this.throwIfDisposed(),Xh.clone(this)}toString(e=!1){const t=this.dataSync();return vP(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Xh.cast(this,e)}variable(e=!0,t,s){return this.throwIfDisposed(),Ea().makeVariable(this,e,t,s)}}Object.defineProperty(Mr,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function De(){return Al("Tensor",()=>Mr)}De();class L0 extends Mr{constructor(e,t,s,i){super(e.shape,e.dtype,e.dataId,i),this.trainable=t,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!se(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Ea().disposeTensor(this),this.dataId=e.dataId,Ea().incRef(this,null)}dispose(){Ea().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(L0,Symbol.hasInstance,{value:n=>n instanceof Mr&&n.assign!=null&&n.assign instanceof Function});/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var qI;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(qI||(qI={}));var jg;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(jg||(jg={}));var Yg;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(Yg||(Yg={}));var Qg;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(Qg||(Qg={}));var Jg;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(Jg||(Jg={}));const TP={float32:Qg,int32:jg,bool:Yg,complex64:Jg};function ai(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return TP[n][e]}function qg(n){return ai(n,"int32")}function eC(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function tC(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mr(n,e){if(n.dtype===e.dtype)return[n,e];const t=ai(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function nC(n){const e=[];return rC(n,e,new Set),e}function rC(n,e,t){if(n==null)return;if(n instanceof Mr){e.push(n);return}if(!kP(n))return;const s=n;for(const i in s){const o=s[i];t.has(o)||(t.add(o),rC(o,e,t))}}function kP(n){return Array.isArray(n)||typeof n=="object"}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ex(n){return n.kernelName!=null}class sC{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class Zh{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new sC}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,s=1){return e in this.registryFactory?(Z(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:s}=this.initializeBackend(e);if(!(s?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new gP(this.backendInstance),!0}setupRegisteredKernels(){Re(this.backendName).forEach(e=>{e.setupFunc!=null&&e.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){Re(e).forEach(t=>{t.disposeFunc!=null&&t.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=t.factory();if(s&&!(s instanceof x)&&typeof s.then=="function"){const i=++this.pendingBackendInitId,o=s.then(c=>i<this.pendingBackendInitId?!1:(this.registry[e]=c,this.pendingBackendInit=null,!0)).catch(c=>(i<this.pendingBackendInitId||(this.pendingBackendInit=null,Z(`Initialization of backend ${e} failed`),Z(c.stack||c.message)),!1));return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return Z(`Initialization of backend ${e} failed`),Z(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t],{success:i,asyncInit:o}=this.initializeBackend(s);if(o||i)return{name:s,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const s=this.state.tensorInfo.get(t),i=s.backend,o=this.readSync(t),c=i.refCount(t);i.disposeData(t,!0),s.backend=e,e.move(t,o,s.shape,s.dtype,c),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let s=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let i;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(i),()=>(i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i))}scopedRun(e,t,s){e();try{const i=s();return t(),i}catch(i){throw t(),i}}nextTensorId(){return Zh.nextTensorId++}nextVariableId(){return Zh.nextVariableId++}clone(e){const t=de.runKernel(Ie,{x:e}),s={x:e},i=c=>({x:()=>{const h="float32",f={x:c},g={dtype:h};return de.runKernel(dr,f,g)}}),o=[];return this.addTapeNode(this.state.activeScope.name,s,[t],i,o,{}),t}runKernel(e,t,s){if(this.backendName==null&&this.backend,ce(e,this.backendName)==null)throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,s){const i=this.backend.numDataIds();let o=0;s.forEach(f=>{o+=f.dtype==="complex64"?3:1});const c=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],h=i-t-o-c;if(h>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${h} data ids) after running '${e}'`)}runKernelFunc(e){let t,s=[];const i=this.isTapeOn(),o=this.state.numBytes,c=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let h;this.backendName==null&&this.backend;let f;const g=ex(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(ex(e)){const{kernelName:N,inputs:R,attrs:P}=e;this.backendName==null&&this.backend;const L=ce(N,this.backendName);D(L!=null,()=>`Cannot find registered kernel '${N}' for backend '${this.backendName}'`),h=()=>{const F=this.backend.numDataIds();f=L.kernelFunc({inputs:R,attrs:P,backend:this.backend});const W=Array.isArray(f)?f:[f];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(N,F,W);const z=W.map(X=>X.rank!=null?X:this.makeTensorFromTensorInfo(X));if(i){const X=this.getTensorsForGradient(N,R,z);s=this.saveTensorsForBackwardMode(X)}return z}}else{const{forwardFunc:N}=e,R=P=>{i&&(s=P.map(L=>this.keep(this.clone(L))))};h=()=>{const P=this.backend.numDataIds();f=this.tidy(()=>N(this.backend,R));const L=Array.isArray(f)?f:[f];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(g,P,L),L}}const{inputs:y,attrs:I}=e,C=ex(e)?null:e.backwardsFunc;let k;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=h():(k=this.profiler.profileKernel(g,y,()=>h()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(k),t=k.outputs)}),i&&this.addTapeNode(g,y,t,C,s,I),this.state.profiling&&this.state.activeProfile.kernels.push({name:g,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-c,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(y).map(N=>y[N]!=null?y[N].shape:null),outputShapes:t.map(N=>N.shape),kernelTimeMs:k.timeMs,extraInfo:k.extraInfo}),Array.isArray(f)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(t=>this.keep(this.clone(t)))}getTensorsForGradient(e,t,s){const i=ve(e);if(i!=null){const o=i.inputsToSave||[],c=i.outputsToSave||[];let h;i.saveAllInputs?(D(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),h=Object.keys(t).map(g=>t[g])):h=o.map(g=>t[g]);const f=s.filter((g,y)=>c[y]);return h.concat(f)}return[]}makeTensor(e,t,s,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",i=i||this.backend;let o=e;s==="string"&&fn(e[0])&&(o=e.map(f=>jl(f)));const c=i.write(o,t,s),h=new Mr(t,s,c,this.nextTensorId());if(this.trackTensor(h,i),s==="string"){const f=this.state.tensorInfo.get(c),g=_t(o);this.state.numBytes+=g-f.bytes,f.bytes=g}return h}makeTensorFromDataId(e,t,s,i){s=s||"float32";const o={dataId:e,shape:t,dtype:s};return this.makeTensorFromTensorInfo(o,i)}makeTensorFromTensorInfo(e,t){const{dataId:s,shape:i,dtype:o}=e,c=new Mr(i,o,s,this.nextTensorId());return this.trackTensor(c,t),c}makeVariable(e,t=!0,s,i){s=s||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.cast(i));const o=new L0(e,t,s,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error(`Variable with name ${o.name} was already registered`);return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*ht(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof L0||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*ht(e.dtype);this.state.numBytes-=s}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(i=>i.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const i of this.state.activeProfile.kernels)i.kernelTimeMs=await i.kernelTimeMs,i.extraInfo=await i.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,s,i,o,c){const h={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:s,saved:o},f=ve(e);f!=null&&(i=f.gradFunc),i!=null&&(h.gradient=g=>(g=g.map((y,I)=>{if(y==null){const C=s[I],k=$n(C.size,C.dtype);return this.makeTensor(k,C.shape,C.dtype)}return y}),i(g.length>1?g:g[0],o,c))),this.state.activeTape.push(h)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=nC(e),s=new Set(t.map(o=>o.id));for(let o=0;o<this.state.activeScope.track.length;o++){const c=this.state.activeScope.track[o];!c.kept&&!s.has(c.id)&&c.dispose()}const i=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(o=>{!o.kept&&o.scopeId===i.id&&this.track(o)})}gradients(e,t,s,i=!1){if(D(t.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const o=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));D(o instanceof Mr,()=>"The result y returned by f() must be a tensor.");const c=bP(this.state.activeTape,t,o);if(!i&&c.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const h={};h[o.id]=s??EP(o.shape),wP(h,c,g=>this.tidy(g),NP);const f=t.map(g=>h[g.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(g=>{for(const y of g.saved)y.dispose()}),this.state.activeTape=null),{value:o,grads:f}})}customGrad(e){return D(Je(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{D(t.every(h=>h instanceof Mr),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const i={};t.forEach((h,f)=>{i[f]=h});const o=(h,f)=>(s=e(...t,f),D(s.value instanceof Mr,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),D(Je(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),c=(h,f)=>{const g=s.gradFunc(h,f),y=Array.isArray(g)?g:[g];D(y.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),D(y.every(C=>C instanceof Mr),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const I={};return y.forEach((C,k)=>{I[k]=()=>C}),I};return this.runKernelFunc({forwardFunc:o,backwardsFunc:c,inputs:i})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=Vs(),s=await this.backend.time(e);return s.wallMs=Vs()-t,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new sC;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}Zh.nextTensorId=0,Zh.nextVariableId=0;function EP(n){const e=En(H(n),"float32");return de.makeTensor(e,n,"float32")}function iC(){const n=Yu();if(n._tfengine==null){const e=new wh(n);n._tfengine=new Zh(e)}return Cn(n._tfengine.ENV),CP(()=>n._tfengine),n._tfengine}const de=iC();function NP(n,e){const t={a:n,b:e};return de.runKernel(Yr,t)}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function AP(){return typeof navigator<"u"&&navigator!=null}function aC(n){if(n||AP()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function oC(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Bs=ke();Bs.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Bs.registerFlag("IS_BROWSER",()=>oC()),Bs.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"),Bs.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)),Bs.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)),Bs.registerFlag("PROD",()=>!1),Bs.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Bs.getBool("DEBUG")),Bs.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0),Bs.registerFlag("IS_TEST",()=>!1),Bs.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Bs.getBool("DEBUG")),Bs.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1),Bs.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1),Bs.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function bf(n,e){let t=n;if(Ji(n))return e==="string"?[]:[n.length];if(eC(n)){const i=n.channels||"RGBA";return[n.height,n.width*i.length]}else if(tC(n))return[n.buffer.size/(e==null?4:ht(e))];if(!Array.isArray(n))return[];const s=[];for(;Array.isArray(t)||Ji(t)&&e!=="string";)s.push(t.length),t=t[0];return Array.isArray(n)&&ke().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&lC(n,s,[]),s}function lC(n,e,t){if(t=t||[],!Array.isArray(n)&&!Ji(n)){D(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}D(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),D(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const s=e.slice(1);for(let i=0;i<n.length;++i)lC(n[i],s,t.concat(i))}function uC(n,e,t,s){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${s}' must be ${n} tensor, but got ${e} tensor`)}}function ae(n,e,t,s="numeric"){if(n instanceof De())return uC(s,n.dtype,e,t),n;let i=ut(n);if(i!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(i=s),uC(s,i,e,t),n==null||!Ji(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const h=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${h}'`)}const o=bf(n,i);!Ji(n)&&!Array.isArray(n)&&(n=[n]);const c=i!=="string"?yc(n,i):bc(n,[],!0);return de.makeTensor(c,o,i)}function cC(n,e,t,s="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((i,o)=>ae(i,`${e}[${o}]`,t,s))}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const RP="__op";function me(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const s=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+RP;const i=(...o)=>{de.startScope(t);try{const c=s(...o);return Po(c)&&console.error("Cannot return a Promise inside of tidy."),de.endScope(c),c}catch(c){throw de.endScope(null),c}};return Object.defineProperty(i,"name",{value:t,configurable:!0}),i}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function MP(n,e){const t=ae(n,"real","complex"),s=ae(e,"imag","complex");$(t.shape,s.shape,`real and imag shapes, ${t.shape} and ${s.shape}, must match in call to tf.complex().`);const i={real:t,imag:s};return de.runKernel(ei,i)}const Kh=me({complex_:MP});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function wf(n,e,t,s){if(s==null)s=ut(n);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(tC(n)||eC(n)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return de.backend.createTensorFromGPUData(n,e||t,s)}if(!Ji(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){jr(e);const i=H(e),o=H(t);D(i===o,()=>`Based on the provided shape, [${e}], the tensor should have ${i} values but has ${o}`);for(let c=0;c<t.length;++c){const h=t[c],f=c===t.length-1?h!==H(e.slice(c)):!0;D(t[c]===e[c]||!f,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!Ji(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=s!=="string"?yc(n,s):bc(n,[],!0),de.makeTensor(n,e,s)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ii(n,e,t){const s=bf(n,t);return wf(n,e,s,t)}class $h{static join(e){return new $h(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>Ji(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let s=0;s<e.length;s++){const i=e[s];s!==e.length-1&&i.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const o=t+i.byteLength;this.shards.push({buffer:i,start:t,end:o}),t=o}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const i=t-e,o=new ArrayBuffer(i),c=new Uint8Array(o);let h=0;for(let f=s;f<this.shards.length;f++){const g=this.shards[f],y=e+h-g.start,I=h,C=Math.min(t,g.end)-g.start,k=new Uint8Array(g.buffer,y,C-y);if(c.set(k,I),h+=k.length,t<g.end)break}return o}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(i){return e<i.start?-1:e>=i.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=LP(this.shards,t);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function LP(n,e){let t=0,s=n.length;for(;t<=s;){const i=Math.floor((s-t)/2)+t,o=e(n[i]);if(o===0)return i;o<0?s=i:t=i+1}return-1}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Dn(){return de}function tx(){return de.memory()}function ye(n,e){return de.tidy(n,e)}function $t(n){nC(n).forEach(e=>e.dispose())}function Ci(n){return de.keep(n)}function hC(n,e,t=1){return de.registerBackend(n,e,t)}function Ql(){return de.backend}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const dC=4;async function fC(n,e){const t=[],s=[],i=Array.isArray(n)?n.map(c=>c.name):Object.keys(n);for(let c=0;c<i.length;++c){const h=i[c],f=Array.isArray(n)?n[c].tensor:n[h];if(f.dtype!=="float32"&&f.dtype!=="int32"&&f.dtype!=="bool"&&f.dtype!=="string"&&f.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${h}': ${f.dtype}`);const g={name:h,shape:f.shape,dtype:f.dtype};if(f.dtype==="string"){const y=new Promise(async I=>{const C=await f.bytes(),k=C.reduce((P,L)=>P+L.length,0)+dC*C.length,N=new Uint8Array(k);let R=0;for(let P=0;P<C.length;P++){const L=C[P],F=new Uint8Array(new Uint32Array([L.length]).buffer);N.set(F,R),R+=dC,N.set(L,R),R+=L.length}I(N)});s.push(y)}else s.push(f.data());e!=null&&(g.group=e),t.push(g)}const o=await Promise.all(s);return{data:DP(o),specs:t}}function DP(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(o=>{if(e+=o.byteLength,t.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${o.constructor.name}`)});const s=new Uint8Array(e);let i=0;return t.forEach(o=>{s.set(new Uint8Array(o.buffer),i),i+=o.byteLength}),s.buffer}const nx=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function pC(n){return nx?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function OP(n){if(nx)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let s=0,i=e.length;s<i;s++)t+=String.fromCharCode(e[s]);return btoa(t)}function PP(n){if(nx){const s=Buffer.from(n,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let s=0;s<e.length;++s)t.set([e.charCodeAt(s)],s);return t.buffer}function FP(n){return $h.join(n)}function mC(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:pC(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:pC(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new $h(n.weightData).byteLength}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Ts{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Ts.instance==null&&(Ts.instance=new Ts),Ts.instance}static registerSaveRouter(e){Ts.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Ts.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Ts.getHandlers(e,"save")}static getLoadHandlers(e,t){return Ts.getHandlers(e,"load",t)}static getHandlers(e,t,s){const i=[];return(t==="load"?Ts.getInstance().loadRouters:Ts.getInstance().saveRouters).forEach(o=>{const c=o(e,s);c!==null&&i.push(c)}),i}}const GP=n=>Ts.getSaveHandlers(n);/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const rx="tensorflowjs",sx=1,wc="models_store",Jl="model_info_store";function gC(){if(!ke().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function ix(n){const e=n.result;e.createObjectStore(wc,{keyPath:"modelPath"}),e.createObjectStore(Jl,{keyPath:"modelPath"})}class vc{constructor(e){if(this.indexedDB=gC(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((s,i)=>{const o=this.indexedDB.open(rx,sx);o.onupgradeneeded=()=>ix(o),o.onsuccess=()=>{const c=o.result;if(t==null){const h=c.transaction(wc,"readonly"),f=h.objectStore(wc).get(this.modelPath);f.onsuccess=()=>{if(f.result==null)return c.close(),i(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(f.result.modelArtifacts)},f.onerror=g=>(c.close(),i(f.error)),h.oncomplete=()=>c.close()}else{t.weightData=$h.join(t.weightData);const h=mC(t),f=c.transaction(Jl,"readwrite");let g=f.objectStore(Jl),y;try{y=g.put({modelPath:this.modelPath,modelArtifactsInfo:h})}catch(C){return i(C)}let I;y.onsuccess=()=>{I=c.transaction(wc,"readwrite");const C=I.objectStore(wc);let k;try{k=C.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:h})}catch(N){return i(N)}k.onsuccess=()=>s({modelArtifactsInfo:h}),k.onerror=N=>{g=f.objectStore(Jl);const R=g.delete(this.modelPath);R.onsuccess=()=>(c.close(),i(k.error)),R.onerror=P=>(c.close(),i(k.error))}},y.onerror=C=>(c.close(),i(y.error)),f.oncomplete=()=>{I==null?c.close():I.oncomplete=()=>c.close()}}},o.onerror=c=>i(o.error)})}}vc.URL_SCHEME="indexeddb://";const xC=n=>ke().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(vc.URL_SCHEME)?_P(n.slice(vc.URL_SCHEME.length)):null;Ts.registerSaveRouter(xC),Ts.registerLoadRouter(xC);function _P(n){return new vc(n)}function VP(n){return n.startsWith(vc.URL_SCHEME)?n.slice(vc.URL_SCHEME.length):n}class BP{constructor(){this.indexedDB=gC()}async listModels(){return new Promise((e,t)=>{const s=this.indexedDB.open(rx,sx);s.onupgradeneeded=()=>ix(s),s.onsuccess=()=>{const i=s.result,o=i.transaction(Jl,"readonly"),c=o.objectStore(Jl).getAll();c.onsuccess=()=>{const h={};for(const f of c.result)h[f.modelPath]=f.modelArtifactsInfo;e(h)},c.onerror=h=>(i.close(),t(c.error)),o.oncomplete=()=>i.close()},s.onerror=i=>t(s.error)})}async removeModel(e){return e=VP(e),new Promise((t,s)=>{const i=this.indexedDB.open(rx,sx);i.onupgradeneeded=()=>ix(i),i.onsuccess=()=>{const o=i.result,c=o.transaction(Jl,"readwrite"),h=c.objectStore(Jl),f=h.get(e);let g;f.onsuccess=()=>{if(f.result==null)return o.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const y=h.delete(e),I=()=>{g=o.transaction(wc,"readwrite");const C=g.objectStore(wc).delete(e);C.onsuccess=()=>t(f.result.modelArtifactsInfo),C.onerror=k=>s(f.error)};y.onsuccess=I,y.onerror=C=>(I(),o.close(),s(f.error))}},f.onerror=y=>(o.close(),s(f.error)),c.oncomplete=()=>{g==null?o.close():g.oncomplete=()=>o.close()}},i.onerror=o=>s(i.error)})}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const qo="/",Uh="tensorflowjs_models",yC="info",WP="model_topology",zP="weight_specs",XP="weight_data",ZP="model_metadata";function bC(n){return{info:[Uh,n,yC].join(qo),topology:[Uh,n,WP].join(qo),weightSpecs:[Uh,n,zP].join(qo),weightData:[Uh,n,XP].join(qo),modelMetadata:[Uh,n,ZP].join(qo)}}function wC(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function KP(n){const e=n.split(qo);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(qo)}function $P(n){return n.startsWith(Ic.URL_SCHEME)?n.slice(Ic.URL_SCHEME.length):n}class Ic{constructor(e){if(!ke().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=bC(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),i=mC(e),o=$h.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,OP(o));const c={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(c)),{modelArtifactsInfo:i}}catch{throw wC(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${i.modelTopologyBytes}, weightSpecsBytes=${i.weightSpecsBytes}, weightDataBytes=${i.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=s;const i=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(i==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=i;const o=this.LS.getItem(this.keys.modelMetadata);if(o!=null){const h=JSON.parse(o);t.format=h.format,t.generatedBy=h.generatedBy,t.convertedBy=h.convertedBy,h.signature!=null&&(t.signature=h.signature),h.userDefinedMetadata!=null&&(t.userDefinedMetadata=h.userDefinedMetadata),h.modelInitializer!=null&&(t.modelInitializer=h.modelInitializer),h.initializerSignature!=null&&(t.initializerSignature=h.initializerSignature),h.trainingConfig!=null&&(t.trainingConfig=h.trainingConfig)}const c=this.LS.getItem(this.keys.weightData);if(c==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=PP(c),t}}Ic.URL_SCHEME="localstorage://";const vC=n=>ke().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Ic.URL_SCHEME)?UP(n.slice(Ic.URL_SCHEME.length)):null;Ts.registerSaveRouter(vC),Ts.registerLoadRouter(vC);function UP(n){return new Ic(n)}class HP{constructor(){D(ke().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),D(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=Uh+qo,s=qo+yC;for(let i=0;i<this.LS.length;++i){const o=this.LS.key(i);if(o.startsWith(t)&&o.endsWith(s)){const c=KP(o);e[c]=JSON.parse(this.LS.getItem(o))}}return e}async removeModel(e){e=$P(e);const t=bC(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(t.info));return wC(t),s}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const IC="://";class io{constructor(){this.managers={}}static getInstance(){return io.instance==null&&(io.instance=new io),io.instance}static registerManager(e,t){D(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(IC)&&(e=e.slice(0,e.indexOf(IC))),D(e.length>0,()=>"scheme must not be an empty string.");const s=io.getInstance();D(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=t}static getManager(e){const t=io.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(io.getInstance().managers)}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class jP{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!ke().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const i=this.functionRefs[s.data.index];i(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return Kt(e)}}if(ke().get("IS_BROWSER")){ke().setPlatform("browser",new jP);try{io.registerManager(Ic.URL_SCHEME,new HP)}catch{}try{io.registerManager(vc.URL_SCHEME,new BP)}catch{}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const YP={importFetch:()=>pue()};let ax;class QP{constructor(){this.util=xue,this.textEncoder=new this.util.TextEncoder}fetch(e,t){return ke().global.fetch!=null?ke().global.fetch(e,t):(ax==null&&(ax=YP.importFetch()),ax(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}ke().get("IS_NODE")&&!ke().get("IS_BROWSER")&&ke().setPlatform("node",new QP);/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Xt(n,e="float32",t){return e=e||"float32",jr(n),new ts(n,e,t)}/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function JP(n,e){const t=ae(n,"x","cast");if(!it(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:t},i={dtype:e};return de.runKernel(dr,s,i)}const at=me({cast_:JP});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function qP(n){const e={x:ae(n,"x","clone","string_or_numeric")};return de.runKernel(Ie,e)}const Cc=me({clone_:qP});/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function eF(n,e=!1){console.log(n.toString(e))}/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/iC(),SP({buffer:Xt,cast:at,clone:Cc,print:eF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tF(n,e){let t=ae(n,"a","add"),s=ae(e,"b","add");[t,s]=mr(t,s);const i={a:t,b:s};return de.runKernel(Yr,i)}const Ue=me({add_:tF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function nF(n,e){let t=ae(n,"a","floorDiv"),s=ae(e,"b","floorDiv");[t,s]=mr(t,s);const i={a:t,b:s};return de.runKernel(Rn,i)}const CC=me({floorDiv_:nF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function rF(n,e){let t=ae(n,"a","div"),s=ae(e,"b","div");if([t,s]=mr(t,s),t.dtype==="int32"&&s.dtype==="int32")return CC(t,s);const i={a:t,b:s},o={};return de.runKernel(nc,i,o)}const Et=me({div_:rF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sF(n,e){let t=ae(n,"a","mul"),s=ae(e,"b","mul");[t,s]=mr(t,s);const i={a:t,b:s};return de.runKernel(Vl,i)}const pe=me({mul_:sF});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function iF(n){const e=ae(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return de.runKernel(kh,t)}else{const t={x:e};return de.runKernel(Qu,t)}}const ks=me({abs_:iF});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function aF(n){const e={x:ae(n,"x","acos")};return de.runKernel(_s,e)}const oF=me({acos_:aF});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function lF(n){const e={x:ae(n,"x","acosh")};return de.runKernel(Fo,e)}const uF=me({acosh_:lF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cF(n,e=null,t=!1){const s={x:ae(n,"x","all","bool")},i={axis:e,keepDims:t};return de.runKernel(zi,s,i)}const SC=me({all_:cF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hF(n,e=null,t=!1){const s={x:ae(n,"x","any","bool")},i={axis:e,keepDims:t};return de.runKernel(Br,s,i)}const ox=me({any_:hF});/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function dF(n,e=0){const t={x:ae(n,"x","argMax")},s={axis:e};return de.runKernel(Ju,t,s)}const vf=me({argMax_:dF});/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function fF(n,e=0){const t={x:ae(n,"x","argMin")},s={axis:e};return de.runKernel(Go,t,s)}const pF=me({argMin_:fF});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mF(n){const e={x:ae(n,"x","asin")};return de.runKernel(qu,e)}const gF=me({asin_:mF});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xF(n){const e={x:ae(n,"x","asinh")};return de.runKernel(_n,e)}const yF=me({asinh_:xF});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function bF(n){const e={x:ae(n,"x","atan")};return de.runKernel(et,e)}const wF=me({atan_:bF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vF(n,e){let t=ae(n,"a","atan2"),s=ae(e,"b","atan2");[t,s]=mr(t,s);const i={a:t,b:s};return de.runKernel(on,i)}const IF=me({atan2_:vF});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function CF(n){const e={x:ae(n,"x","atanh")};return de.runKernel(Un,e)}const SF=me({atanh_:CF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function If(n,e,t,s,i="NHWC",o){const c=n[3],h=[...e,c],f=tl(i);return ns(n,h,t,o,s,null,null,f)}function qi(n,e,t,s,i,o,c="channelsLast"){const[h,f]=Cf(e);let g;if(c==="channelsLast")g=[h,f,n[3],n[3]];else if(c==="channelsFirst")g=[h,f,n[1],n[1]];else throw new Error(`Unknown dataFormat ${c}`);return ns(n,g,t,s,i,o,!1,c)}function el(n,e,t,s,i,o,c="NDHWC"){const[h,f,g]=ux(e);let y,I;if(c==="NDHWC")I="channelsLast",y=[h,f,g,n[4],n[4]];else if(c==="NCDHW")I="channelsFirst",y=[h,f,g,n[1],n[1]];else throw new Error(`Unknown dataFormat ${c}`);return ql(n,y,t,s,i,!1,I,o)}function ns(n,e,t,s,i,o,c=!1,h="channelsLast"){let[f,g,y,I]=[-1,-1,-1,-1];if(h==="channelsLast")[f,g,y,I]=n;else if(h==="channelsFirst")[f,I,g,y]=n;else throw new Error(`Unknown dataFormat ${h}`);const[C,k,,N]=e,[R,P]=Cf(t),[L,F]=Cf(s),W=Hh(C,L),z=Hh(k,F),{padInfo:X,outHeight:Q,outWidth:J}=EF(i,g,y,R,P,W,z,o,h),te=c?N*I:N;let ie;return h==="channelsFirst"?ie=[f,te,Q,J]:h==="channelsLast"&&(ie=[f,Q,J,te]),{batchSize:f,dataFormat:h,inHeight:g,inWidth:y,inChannels:I,outHeight:Q,outWidth:J,outChannels:te,padInfo:X,strideHeight:R,strideWidth:P,filterHeight:C,filterWidth:k,effectiveFilterHeight:W,effectiveFilterWidth:z,dilationHeight:L,dilationWidth:F,inShape:n,outShape:ie,filterShape:e}}function ql(n,e,t,s,i,o=!1,c="channelsLast",h){let[f,g,y,I,C]=[-1,-1,-1,-1,-1];if(c==="channelsLast")[f,g,y,I,C]=n;else if(c==="channelsFirst")[f,C,g,y,I]=n;else throw new Error(`Unknown dataFormat ${c}`);const[k,N,R,,P]=e,[L,F,W]=ux(t),[z,X,Q]=ux(s),J=Hh(k,z),te=Hh(N,X),ie=Hh(R,Q),{padInfo:oe,outDepth:Ce,outHeight:Se,outWidth:Te}=NF(i,g,y,I,L,F,W,J,te,ie,h),Le=o?P*C:P;let Me;return c==="channelsFirst"?Me=[f,Le,Ce,Se,Te]:c==="channelsLast"&&(Me=[f,Ce,Se,Te,Le]),{batchSize:f,dataFormat:c,inDepth:g,inHeight:y,inWidth:I,inChannels:C,outDepth:Ce,outHeight:Se,outWidth:Te,outChannels:Le,padInfo:oe,strideDepth:L,strideHeight:F,strideWidth:W,filterDepth:k,filterHeight:N,filterWidth:R,effectiveFilterDepth:J,effectiveFilterHeight:te,effectiveFilterWidth:ie,dilationDepth:z,dilationHeight:X,dilationWidth:Q,inShape:n,outShape:Me,filterShape:e}}function TF(n,e,t,s,i){s==null&&(s=lx(n,e,t));const o=n[0],c=n[1],h=Sf((o-e+2*s)/t+1,i),f=Sf((c-e+2*s)/t+1,i);return[h,f]}function kF(n,e,t,s,i,o){i==null&&(i=lx(n,e[0],s[0]));const c=[0,0,0,t];for(let h=0;h<3;h++)n[h]+2*i>=e[h]&&(c[h]=Sf((n[h]-e[h]+2*i)/s[h]+1,o));return c}function lx(n,e,t,s=1){const i=Hh(e,s);return Math.floor((n[0]*(t-1)-t+i)/2)}function Cf(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function ux(n){return typeof n=="number"?[n,n,n]:n}function Hh(n,e){return e<=1?n:n+(n-1)*(e-1)}function EF(n,e,t,s,i,o,c,h,f){let g,y,I;if(typeof n=="number"){g={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const C=TF([e,t],o,s,n,h);y=C[0],I=C[1]}else if(n==="same"){y=Math.ceil(e/s),I=Math.ceil(t/i);const C=Math.max(0,(y-1)*s+o-e),k=Math.max(0,(I-1)*i+c-t),N=Math.floor(C/2),R=C-N,P=Math.floor(k/2),L=k-P;g={top:N,bottom:R,left:P,right:L,type:"SAME"}}else if(n==="valid")g={top:0,bottom:0,left:0,right:0,type:"VALID"},y=Math.ceil((e-o+1)/s),I=Math.ceil((t-c+1)/i);else if(typeof n=="object"){const C=f==="channelsLast"?n[1][0]:n[2][0],k=f==="channelsLast"?n[1][1]:n[2][1],N=f==="channelsLast"?n[2][0]:n[3][0],R=f==="channelsLast"?n[2][1]:n[3][1];g={top:C,bottom:k,left:N,right:R,type:C===0&&k===0&&N===0&&R===0?"VALID":"EXPLICIT"},y=Sf((e-o+C+k)/s+1,h),I=Sf((t-c+N+R)/i+1,h)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:g,outHeight:y,outWidth:I}}function NF(n,e,t,s,i,o,c,h,f,g,y){let I,C,k,N;if(n==="valid"&&(n=0),typeof n=="number"){I={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const R=kF([e,t,s,1],[h,f,g],1,[i,o,c],n,y);C=R[0],k=R[1],N=R[2]}else if(n==="same"){C=Math.ceil(e/i),k=Math.ceil(t/o),N=Math.ceil(s/c);const R=(C-1)*i+h-e,P=(k-1)*o+f-t,L=(N-1)*c+g-s,F=Math.floor(R/2),W=R-F,z=Math.floor(P/2),X=P-z,Q=Math.floor(L/2),J=L-Q;I={top:z,bottom:X,left:Q,right:J,front:F,back:W,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:I,outDepth:C,outHeight:k,outWidth:N}}function Sf(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function Sc(n){const[e,t,s]=Cf(n);return e===1&&t===1&&s===1}function ds(n,e){return Sc(n)||Sc(e)}function Tc(n){return Cf(n).every(e=>e>0)}function tl(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function Ws(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")D(Ee(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(i=>{D(Ee(i),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${i}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function AF(n,e){const t={x:ae(n,"x","reshape","string_or_numeric")},s={shape:e};return de.runKernel(Fh,t,s)}const ge=me({reshape_:AF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function RF(n,e,t,s,i){const o=ae(n,"x","avgPool","float32"),c=1;D(ds(t,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${c}'`);let h=o,f=!1;o.rank===3&&(f=!0,h=ge(o,[1,o.shape[0],o.shape[1],o.shape[2]])),D(h.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${h.rank}.`),Ws("avgPool",s,i);const g={x:h},y={filterSize:e,strides:t,pad:s,dimRoundingMode:i};let I=de.runKernel(Nn,g,y);return I=at(I,o.dtype),f?ge(I,[I.shape[1],I.shape[2],I.shape[3]]):I}const cx=me({avgPool_:RF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function MF(n,e,t,s,i,o="NDHWC"){const c=ae(n,"x","avgPool3d","float32");let h=c,f=!1;c.rank===4&&(f=!0,h=ge(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),D(h.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${h.rank}.`),D(o==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),D(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),Ws("avgPool3d",s,i);const g={x:h},y={filterSize:e,strides:t,pad:s,dimRoundingMode:i,dataFormat:o};let I=de.runKernel(Rl,g,y);return I=at(I,h.dtype),f?ge(I,[I.shape[1],I.shape[2],I.shape[3],I.shape[4]]):I}const LF=me({avgPool3d_:MF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function DF(n,e=0){D(n.length>=1,()=>"Pass at least one tensor to concat");const t=cC(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(o=>{if(o.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${o.dtype}. `)}),t.length===1)return Cc(t[0]);const s=t,i={axis:e};return de.runKernel(Ki,s,i)}const zs=me({concat_:DF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function OF(n,e,t=!1,s=!1){let i=ae(n,"a","matMul"),o=ae(e,"b","matMul");[i,o]=mr(i,o);const c={a:i,b:o},h={transposeA:t,transposeB:s};return de.runKernel(Qt,c,h)}const cn=me({matMul_:OF});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function PF(n){const e={x:ae(n,"x","sigmoid","float32")};return de.runKernel(zl,e)}const jh=me({sigmoid_:PF});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function FF(n,e,t){const s=ae(n,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const i={x:s},o={begin:e,size:t};return de.runKernel(Ia,i,o)}const On=me({slice_:FF});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function GF(n){const e={x:ae(n,"x","tanh","float32")};return de.runKernel(jo,e)}const hx=me({tanh_:GF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _F(n,e,t){const s=ae(n,"x","batchToSpaceND"),i=e.reduce((h,f)=>h*f);D(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),D(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),D(s.shape[0]%i===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${i}`);const o={x:s},c={blockShape:e,crops:t};return de.runKernel(Xi,o,c)}const dx=me({batchToSpaceND_:_F});function VF(n){let e;return n.rank===0||n.rank===1?e=ge(n,[1,1,1,n.size]):n.rank===2?e=ge(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=ge(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function BF(n,e,t,s,i,o){o==null&&(o=.001);const c=ae(n,"x","batchNorm"),h=ae(e,"mean","batchNorm"),f=ae(t,"variance","batchNorm");let g;i!=null&&(g=ae(i,"scale","batchNorm"));let y;s!=null&&(y=ae(s,"offset","batchNorm")),D(h.rank===f.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),D(y==null||h.rank===y.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),D(g==null||h.rank===g.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const I={x:VF(c),scale:g,offset:y,mean:h,variance:f},C={varianceEpsilon:o},k=de.runKernel(xi,I,C);return ge(k,c.shape)}const D0=me({batchNorm_:BF});function WF(n,e,t,s,i,o){const c=ae(n,"x","batchNorm"),h=ae(e,"mean","batchNorm"),f=ae(t,"variance","batchNorm");let g;i!=null&&(g=ae(i,"scale","batchNorm"));let y;return s!=null&&(y=ae(s,"offset","batchNorm")),D(c.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${c.rank}.`),D(h.rank===2||h.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${h.rank}.`),D(f.rank===2||f.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${f.rank}.`),g!=null&&D(g.rank===2||g.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${g.rank}.`),y!=null&&D(y.rank===2||y.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${y.rank}.`),D0(c,h,f,y,g,o)}const zF=me({batchNorm2d_:WF});function XF(n,e,t,s,i,o){const c=ae(n,"x","batchNorm"),h=ae(e,"mean","batchNorm"),f=ae(t,"variance","batchNorm");let g;i!=null&&(g=ae(i,"scale","batchNorm"));let y;return s!=null&&(y=ae(s,"offset","batchNorm")),D(c.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${c.rank}.`),D(h.rank===3||h.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${h.rank}.`),D(f.rank===3||f.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${f.rank}.`),g!=null&&D(g.rank===3||g.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${g.rank}.`),y!=null&&D(y.rank===3||y.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${y.rank}.`),D0(c,h,f,y,g,o)}const ZF=me({batchNorm3d_:XF});function KF(n,e,t,s,i,o){const c=ae(n,"x","batchNorm"),h=ae(e,"mean","batchNorm"),f=ae(t,"variance","batchNorm");let g;i!=null&&(g=ae(i,"scale","batchNorm"));let y;return s!=null&&(y=ae(s,"offset","batchNorm")),D(c.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${c.rank}.`),D(h.rank===4||h.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${h.rank}.`),D(f.rank===4||f.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${f.rank}.`),g!=null&&D(g.rank===4||g.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${g.rank}.`),y!=null&&D(y.rank===4||y.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${y.rank}.`),D0(c,h,f,y,g,o)}const $F=me({batchNorm4d_:KF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function UF(n,e,t){const s=ae(n,"x","bincount"),i=ae(e,"weights","bincount");D(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),D(t>=0,()=>`size must be non-negative, but got ${t}.`),D(i.size===s.size||i.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${i.shape}.`);const o={x:s,weights:i},c={size:t};return de.runKernel(Ch,o,c)}const HF=me({bincount_:UF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function jF(n,e){let t=ae(n,"broadcastTo","x");const s=t.shape;if(jr(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const f=t.shape.slice();for(;f.length<e.length;)f.unshift(1);t=ge(t,f)}const i=t.shape,o=Array.from(e);for(let f=e.length-1;f>=0;f--)if(i[f]===e[f])o[f]=1;else if(t.shape[f]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(o.map((f,g)=>f>1?g:-1).filter(f=>f>=0).length===0)return Cc(t);const c={x:t},h={reps:o};return de.runKernel(Ta,c,h)}const Tf=me({broadcastTo_:jF});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function YF(n){const e={x:ae(n,"x","ceil","float32")};return de.runKernel(Zi,e)}const QF=me({ceil_:YF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function O0(n,e,t){jr(n),t=t||ut(e);const s={shape:n,value:e,dtype:t};return de.runKernel(sr,{},s)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function JF(n,e,t){const s=ae(n,"x","clipByValue");if(D(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return O0(s.shape,e,s.dtype);const i={x:s},o={clipValueMin:e,clipValueMax:t};return de.runKernel(Qa,i,o)}const Si=me({clipByValue_:JF});function qF(n){return zs(n,0)}const e9=me({concat1d_:qF});function t9(n,e){return zs(n,e)}const n9=me({concat2d_:t9});function r9(n,e){return zs(n,e)}const s9=me({concat3d_:r9});function i9(n,e){return zs(n,e)}const a9=me({concat4d_:i9});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function o9(n,e,t,s,i="NHWC",o=[1,1],c){const h=ae(n,"x","conv2d","float32"),f=ae(e,"filter","conv2d","float32");let g=h,y=!1;h.rank===3&&(y=!0,g=ge(h,[1,h.shape[0],h.shape[1],h.shape[2]])),D(g.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${g.rank}.`),D(f.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${f.rank}.`),Ws("conv2d",s,c);const I=i==="NHWC"?g.shape[3]:g.shape[1];D(I===f.shape[2],()=>`Error in conv2d: depth of input (${I}) must match input depth for filter ${f.shape[2]}.`),D(ds(t,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),D(Tc(o),()=>"Error in conv2D: Dilated rates should be larger than 0."),D(Tc(t),()=>"Error in conv2D: Strides should be larger than 0.");const C={x:g,filter:f},k={strides:t,pad:s,dataFormat:i,dilations:o,dimRoundingMode:c},N=de.runKernel(Ml,C,k);return y?ge(N,[N.shape[1],N.shape[2],N.shape[3]]):N}const kc=me({conv2d_:o9});function l9(n,e,t,s,i="NWC",o=1,c){const h=ae(n,"x","conv1d"),f=ae(e,"filter","conv1d");let g=h,y=!1;h.rank===2&&(y=!0,g=ge(h,[1,h.shape[0],h.shape[1]])),D(g.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${g.rank}.`),D(f.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${f.rank}.`),Ws("conv1d",s,c),D(g.shape[2]===f.shape[1],()=>`Error in conv1d: depth of input (${g.shape[2]}) must match input depth for filter ${f.shape[1]}.`),D(ds(t,o),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${o}'`),D(Tc(o),()=>"Error in conv1D: Dilated rates should be larger than 0."),D(Tc(t),()=>"Error in conv1D: Stride should be larger than 0."),D(i==="NWC",()=>`Error in conv1d: got dataFormat of ${i} but only NWC is currently supported.`);const I=ge(f,[1,f.shape[0],f.shape[1],f.shape[2]]),C=ge(g,[g.shape[0],1,g.shape[1],g.shape[2]]),k=kc(C,I,[1,t],s,"NHWC",[1,o],c);return y?ge(k,[k.shape[2],k.shape[3]]):ge(k,[k.shape[0],k.shape[2],k.shape[3]])}const TC=me({conv1d_:l9});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function u9(n,e,t,s,i,o="NHWC",c){D(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let h=n,f=e,g=!1;e.rank===3&&(g=!0,f=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]]),h=[1,n[0],n[1],n[2]]),D(h.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${h.length}.`),D(f.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${f.rank}`),D(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const y=o==="NHWC"?h[3]:h[1],I=o==="NHWC"?f.shape[3]:f.shape[1];D(y===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${y}) must match input depth for filter ${t.shape[2]}.`),D(I===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${I}) must match output depth for filter ${t.shape[3]}.`),Ws("conv2dDerInput",i,c);const C={dy:f,filter:t},k={strides:s,pad:i,dataFormat:o,dimRoundingMode:c,inputShape:h},N=de.runKernel($i,C,k);return g?ge(N,[N.shape[1],N.shape[2],N.shape[3]]):N}const fx=me({conv2DBackpropInput_:u9});function c9(n,e,t,s,i,o){const c=ae(n,"x","conv2dTranspose"),h=ae(e,"filter","conv2dTranspose");return fx(t,c,h,s,i,"NHWC",o)}const kC=me({conv2dTranspose_:c9});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function h9(n,e,t,s,i="NDHWC",o=[1,1,1]){const c=ae(n,"x","conv3d"),h=ae(e,"filter","conv3d");let f=c,g=!1;c.rank===4&&(g=!0,f=ge(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),D(f.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${f.rank}.`),D(h.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${h.rank}.`),D(f.shape[4]===h.shape[3],()=>`Error in conv3d: depth of input (${f.shape[4]}) must match input depth for filter ${h.shape[3]}.`),D(ds(t,o),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),D(i==="NDHWC",()=>`Error in conv3d: got dataFormat of ${i} but only NDHWC is currently supported.`),D(Tc(o),()=>"Error in conv3D: Dilated rates should be larger than 0."),D(Tc(t),()=>"Error in conv3D: Strides should be larger than 0.");const y={x:f,filter:h},I={strides:t,pad:s,dataFormat:i,dilations:o},C=de.runKernel(us,y,I);return g?ge(C,[C.shape[1],C.shape[2],C.shape[3],C.shape[4]]):C}const d9=me({conv3d_:h9});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function f9(n,e,t,s,i){D(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let o=n,c=e,h=!1;e.rank===4&&(h=!0,c=ge(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,n[0],n[1],n[2],n[3]]);const f=o[4],g=c.shape[4];D(o.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`),D(c.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${c.rank}`),D(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),D(f===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${f}) must match input depth for filter ${t.shape[3]}.`),D(g===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${g}) must match output depth for filter ${t.shape[4]}.`);const y={dy:c,filter:t},I={pad:i,strides:s,inputShape:o},C=de.runKernel(Ja,y,I);return h?ge(C,[C.shape[1],C.shape[2],C.shape[3],C.shape[4]]):C}const EC=me({conv3DBackpropInput_:f9});function p9(n,e,t,s,i){const o=ae(n,"x","conv3dTranspose"),c=ae(e,"filter","conv3dTranspose");return EC(t,o,c,s,i)}const m9=me({conv3dTranspose_:p9});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function g9(n){const e={x:ae(n,"x","cos","float32")};return de.runKernel(Vo,e)}const px=me({cos_:g9});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function x9(n){const e={x:ae(n,"x","cosh","float32")};return de.runKernel(Rr,e)}const NC=me({cosh_:x9});/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function y9(n,e=0,t=!1,s=!1){const i={x:ae(n,"x","cumprod")},o={axis:e,exclusive:t,reverse:s};return de.runKernel(qa,i,o)}const mx=me({cumprod_:y9});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function b9(n,e=0,t=!1,s=!1){const i={x:ae(n,"x","cumsum")},o={axis:e,exclusive:t,reverse:s};return de.runKernel(Bo,i,o)}const AC=me({cumsum_:b9});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function w9(n,e,t,s=!1){const i=ae(n,"x","denseBincount"),o=ae(e,"weights","denseBincount");D(i.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${i.dtype}`),D(i.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${i.rank}.`),D(t>=0,()=>`size must be non-negative, but got ${t}.`),D(o.size===i.size||o.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${i.shape}, weights shape: ${o.shape}.`);const c={x:i,weights:o},h={size:t,binaryOutput:s};return de.runKernel(ti,c,h)}const RC=me({denseBincount_:w9});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function v9(n,e,t="NHWC"){const s=ae(n,"x","depthToSpace","float32"),i=t==="NHWC"?s.shape[1]:s.shape[2],o=t==="NHWC"?s.shape[2]:s.shape[3],c=t==="NHWC"?s.shape[3]:s.shape[1];D(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),D(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e}  for depthToSpace with input shape
    ${s.shape}`),D(o*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${e} for depthToSpace with input shape
        ${s.shape}`),D(c%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${c} for depthToSpace with input shape ${s.shape}`);const h={x:s},f={blockSize:e,dataFormat:t};return de.runKernel(cf,h,f)}const I9=me({depthToSpace_:v9});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function C9(n,e,t,s,i="NHWC",o=[1,1],c){const h=ae(n,"x","depthwiseConv2d","float32"),f=ae(e,"filter","depthwiseConv2d","float32");let g=h,y=!1;h.rank===3&&(y=!0,g=ge(h,[1,h.shape[0],h.shape[1],h.shape[2]])),D(g.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${g.rank}.`),D(f.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${f.rank}.`);const I=i==="NHWC"?g.shape[3]:g.shape[1];D(I===f.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${I}) must match the inChannels dimension in filter ${f.shape[2]}.`),Ws("depthwiseConv2d",s,c);const C={x:g,filter:f},k={strides:t,pad:s,dataFormat:i,dilations:o,dimRoundingMode:c},N=de.runKernel(Eh,C,k);return y?ge(N,[N.shape[1],N.shape[2],N.shape[3]]):N}const gx=me({depthwiseConv2d_:C9});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function S9(n,e,t,s,i=[1,1],o="NHWC"){const c=ae(n,"x","dilation2d"),h=ae(e,"filter","dilation2d");D(c.rank===3||c.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${c.rank}.`),D(h.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${h.rank}.`),D(o==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`);let f=c,g=!1;c.rank===3&&(f=ge(c,[1,c.shape[0],c.shape[1],c.shape[2]]),g=!0),D(f.shape[3]===h.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${f.shape[3]} vs ${h.shape[2]}`);const y={x:f,filter:h},I={strides:t,pad:s,dilations:i},C=de.runKernel(ec,y,I);return g?ge(C,[C.shape[1],C.shape[2],C.shape[3]]):C}const T9=me({dilation2d_:S9});/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Yh(n,e){const t=n.length,s=[];for(let i=0;i<t;i++){const o=t-1-i,c=n[o]||1;(e[e.length-1-i]||1)>1&&c===1&&s.unshift(o)}return s}function Lr(n,e){const t=[];for(let s=0;s<e.length;s++){const i=n[n.length-s-1],o=e.length-s-1,c=e[o];(i==null||i===1&&c>1)&&t.unshift(o)}return t}function Ft(n,e){const t=Math.max(n.length,e.length),s=new Array(t);for(let i=0;i<t;i++){let o=n[n.length-i-1];o==null&&(o=1);let c=e[e.length-i-1];if(c==null&&(c=1),o===1)s[t-i-1]=c;else if(c===1)s[t-i-1]=o;else if(o!==c){const h=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(h)}else s[t-i-1]=o}return s}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function k9(n,e){let t=ae(n,"a","equal","string_or_numeric"),s=ae(e,"b","equal","string_or_numeric");[t,s]=mr(t,s),Ft(t.shape,s.shape);const i={a:t,b:s};return de.runKernel(qt,i)}const ao=me({equal_:k9});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function E9(n,e,t){const s=ae(e,"a","where"),i=ae(t,"b","where"),o=ae(n,"condition","where","bool"),c=Ft(Ft(o.shape,s.shape),i.shape),h=Tf(o,c),f=Tf(s,c),g=Tf(i,c),y={condition:h,t:f,e:g};return de.runKernel(mn,y)}const Es=me({where_:E9});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function N9(n){const e={x:ae(n,"x","zerosLike")};return de.runKernel(b,e)}const en=me({zerosLike_:N9});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function A9(n,e){let t=ae(n,"a","div"),s=ae(e,"b","div");[t,s]=mr(t,s);const i=Et(t,s),o=en(i),c=ao(s,o);return Es(c,o,i)}const R9=me({divNoNan_:A9});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function M9(n,e){const t=ae(n,"t1","dot"),s=ae(e,"t2","dot");D((t.rank===1||t.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${s.rank}.`);const i=t.rank===1?t.size:t.shape[1],o=s.rank===1?s.size:s.shape[0];if(D(i===o,()=>`Error in dot: inner dimensions of inputs must match, but got ${i} and ${o}.`),t.rank===1&&s.rank===1){const c=ge(t,[1,-1]),h=ge(s,[-1,1]),f=cn(c,h);return ge(f,[])}else if(t.rank===1&&s.rank===2){const c=ge(t,[1,-1]),h=ge(s,[s.shape[0],s.shape[1]]),f=cn(c,h);return ge(f,[f.size])}else if(t.rank===2&&s.rank===1){const c=ge(s,[-1,1]),h=cn(t,c);return ge(h,[h.size])}else{const c=ge(s,[s.shape[0],s.shape[1]]);return cn(t,c)}}const L9=me({dot_:M9});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function D9(n,...e){const t=e.map((i,o)=>ae(i,`tensors${o}`,"einsum")),s={equation:n};return de.runKernel(Vn,t,s)}const kf=me({einsum_:D9});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function O9(n){const e={x:ae(n,"x","elu","float32")};return de.runKernel(Hi,e)}const P0=me({elu_:O9});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function P9(n){let e=ae(n,"x","erf");D(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=at(e,"float32"));const t={x:e};return de.runKernel(Jt,t)}const F9=me({erf_:P9});/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xx(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function MC(n,e,t){const s=n.length+e.length,i=[];let o=0,c=0;for(let h=0;h<s;h++)t.indexOf(h)===-1?i.push(n[o++]):i.push(e[c++]);return i}function Xr(n,e){const t=[],s=n.length;for(let o=0;o<s;o++)e.indexOf(o)===-1&&t.push(n[o]);const i=e.map(o=>n[o]);return[t,i]}function kr(n,e){const t=e.map(s=>1);return MC(n,t,e)}function rs(n,e,t){D(xx(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function er(n,e){if(xx(n,e))return null;const t=[];for(let s=0;s<e;++s)n.indexOf(s)===-1&&t.push(s);return n.forEach(s=>t.push(s)),t}function eu(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function gr(n,e){const t=[];for(let s=e-n;s<e;++s)t.push(s);return t}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function G9(n,e=null,t=!1){const s={x:ae(n,"x","max")},i={reductionIndices:e,keepDims:t};return de.runKernel(yi,s,i)}const Na=me({max_:G9});/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _9(n,e=null,t=!1){const s={x:ae(n,"x","min")},i={axis:e,keepDims:t};return de.runKernel(Yi,s,i)}const F0=me({min_:_9});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function V9(n,e){let t=ae(n,"base","pow"),s=ae(e,"exp","pow");[t,s]=mr(t,s);const i={a:t,b:s};return de.runKernel(rn,i)}const Qh=me({pow_:V9});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hn(n,e){if((Ji(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Ji(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return wf(n,[],[],e)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function B9(n){const e={x:ae(n,"x","sqrt","float32")};return de.runKernel(Xl,e)}const Ns=me({sqrt_:B9});/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function W9(n){const e=ae(n,"x","square"),t={};return de.runKernel("Square",{x:e},t)}const zn=me({square_:W9});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function z9(n,e=null,t=!1){let s=ae(n,"x","sum");s.dtype==="bool"&&(s=at(s,"int32"));const i={x:s},o={axis:e,keepDims:t};return de.runKernel(dc,i,o)}const It=me({sum_:z9});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function X9(n,e="euclidean",t=null,s=!1){n=ae(n,"x","norm");const i=LC(n,e,t);let o=i.shape;if(s){const c=be(t,n.shape);o=kr(i.shape,c)}return ge(i,o)}function LC(n,e,t=null){if(n.rank===0)return ks(n);if(n.rank!==1&&t===null)return LC(ge(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return It(ks(n),t);if(e===1/0)return Na(ks(n),t);if(e===-1/0)return F0(ks(n),t);if(e==="euclidean"||e===2)return Ns(It(Qh(ks(n),hn(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return Na(It(ks(n),t[0]),t[1]-1);if(e===1/0)return Na(It(ks(n),t[1]),t[0]);if(e===-1/0)return F0(It(ks(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return Ns(It(zn(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const G0=me({norm_:X9});/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Z9(n,e=null,t=!1){return G0(n,"euclidean",e,t)}const K9=me({euclideanNorm_:Z9});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function $9(n){const e={x:ae(n,"x","exp")};return de.runKernel(Wt,e)}const oo=me({exp_:$9});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function U9(n,e=0){const t=ae(n,"x","expandDims","string_or_numeric");D(e<=t.rank,()=>"Axis must be <= rank of the tensor");const s={input:t},i={dim:e};return de.runKernel(Dl,s,i)}const Xs=me({expandDims_:U9});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function H9(n){const e={x:ae(n,"x","expm1")};return de.runKernel(Wo,e)}const j9=me({expm1_:H9});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Y9(n,e){const t=ae(n,"x","tile","string_or_numeric");D(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const s={x:t},i={reps:e};return de.runKernel(Ta,s,i)}const Aa=me({tile_:Y9});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Q9(n,e,t,s="float32"){e==null&&(e=n);const i=Xt([n,e],s),o=n<=e?n:e;for(let h=0;h<o;++h)i.set(1,h,h);const c=ge(i.toTensor(),[n,e]);if(t==null)return c;if(t.length===1)return Aa(Xs(c,0),[t[0],1,1]);if(t.length===2)return Aa(Xs(Xs(c,0),0),[t[0],t[1],1,1]);if(t.length===3)return Aa(Xs(Xs(Xs(c,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const DC=me({eye_:Q9});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function J9(n){const e={x:ae(n,"x","floor","float32")};return de.runKernel(sc,e)}const _0=me({floor_:J9});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function q9(n,e,t=0,s=0){const i=ae(n,"x","gather"),o=ae(e,"indices","gather","int32"),c={x:i,indices:o},h={axis:t,batchDims:s};return de.runKernel(Nh,c,h)}const yx=me({gather_:q9});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function eG(n,e){let t=ae(n,"a","greater","string_or_numeric"),s=ae(e,"b","greater","string_or_numeric");[t,s]=mr(t,s),Ft(t.shape,s.shape);const i={a:t,b:s};return de.runKernel(dn,i)}const Ti=me({greater_:eG});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tG(n,e){let t=ae(n,"a","greaterEqual","string_or_numeric"),s=ae(e,"b","greaterEqual","string_or_numeric");[t,s]=mr(t,s),Ft(t.shape,s.shape);const i={a:t,b:s};return de.runKernel(fr,i)}const Ec=me({greaterEqual_:tG});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function nG(n){const e={input:ae(n,"input","imag")};return de.runKernel(bt,e)}const bx=me({imag_:nG});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function rG(n){const e={x:ae(n,"x","isFinite")};return de.runKernel(qn,e)}const sG=me({isFinite_:rG});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function iG(n){const e={x:ae(n,"x","isInf")};return de.runKernel(Jr,e)}const aG=me({isInf_:iG});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function oG(n){const e={x:ae(n,"x","isNaN")};return de.runKernel(ic,e)}const lG=me({isNaN_:oG});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function uG(n,e=.2){const t={x:ae(n,"x","leakyRelu")},s={alpha:e};return de.runKernel(Ol,t,s)}const wx=me({leakyRelu_:uG});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cG(n,e){let t=ae(n,"a","less","string_or_numeric"),s=ae(e,"b","less","string_or_numeric");[t,s]=mr(t,s),Ft(t.shape,s.shape);const i={a:t,b:s};return de.runKernel(cs,i)}const V0=me({less_:cG});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hG(n,e){let t=ae(n,"a","lessEqual","string_or_numeric"),s=ae(e,"b","lessEqual","string_or_numeric");[t,s]=mr(t,s),Ft(t.shape,s.shape);const i={a:t,b:s};return de.runKernel(wt,i)}const Jh=me({lessEqual_:hG});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function dG(n,e=5,t=1,s=1,i=.5){const o=ae(n,"x","localResponseNormalization");D(o.rank===4||o.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${o.rank}.`),D(Ee(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let c=o,h=!1;o.rank===3&&(h=!0,c=ge(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const f={x:c},g={depthRadius:e,bias:t,alpha:s,beta:i},y=de.runKernel(ir,f,g);return h?ge(y,[y.shape[1],y.shape[2],y.shape[3]]):y}const fG=me({localResponseNormalization_:dG});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function pG(n){const e={x:ae(n,"x","log","float32")};return de.runKernel(Pl,e)}const lo=me({log_:pG});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mG(n){const e={x:ae(n,"x","log1p")};return de.runKernel(ac,e)}const OC=me({log1p_:mG});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function gG(n,e){D(Je(n),()=>"The f passed in variableGrads(f) must be a function"),D(e==null||Array.isArray(e)&&e.every(g=>g instanceof L0),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const g in de.registeredVariables)e.push(de.registeredVariables[g])}const s=t?e.filter(g=>!g.trainable):null,i=e.length;e=e.filter(g=>g.trainable),D(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${i} variables is trainable.`);const o=!0,{value:c,grads:h}=de.gradients(n,e,null,o);D(h.some(g=>g!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),D(c.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${c.rank} tensor`);const f={};return e.forEach((g,y)=>{h[y]!=null&&(f[g.name]=h[y])}),s!=null&&s.forEach(g=>f[g.name]=null),{value:c,grads:f}}function qh(n){return de.customGrad(n)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xG(n){const e={x:ae(n,"x","neg")};return de.runKernel(to,e)}const xr=me({neg_:xG});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yG(n){const e={x:ae(n,"x","softplus")};return de.runKernel(Ho,e)}const Ef=me({softplus_:yG});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function bG(n){const e=ae(n,"x","logSigmoid");return qh(t=>({value:xr(Ef(xr(t))),gradFunc:s=>pe(s,jh(xr(t)))}))(e)}const wG=me({logSigmoid_:bG});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vG(n,e){let t=ae(n,"a","sub"),s=ae(e,"b","sub");[t,s]=mr(t,s);const i={a:t,b:s};return de.runKernel(Is,i)}const Nt=me({sub_:vG});/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function IG(n,e=-1){const t=ae(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return qh((s,i)=>{const o=Na(s,e,!0),c=Nt(s,o),h=Nt(at(c,"float32"),lo(It(oo(c),e,!0)));return i([h]),{value:h,gradFunc:(f,g)=>{const[y]=g,I=!0,C=oo(y);return Nt(f,pe(It(f,e,I),C))}}})(t)}const PC=me({logSoftmax_:IG});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function CG(n,e=null,t=!1){const s=ae(n,"x","logSumExp"),i=be(e,s.shape),o=Na(s,i,!0),c=Nt(s,o),h=oo(c),f=It(h,i),g=lo(f),y=Ue(ge(o,g.shape),g);if(t){const I=kr(y.shape,i);return ge(y,I)}return y}const FC=me({logSumExp_:CG});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function SG(n,e){const t=ae(n,"a","logicalAnd","bool"),s=ae(e,"b","logicalAnd","bool");Ft(t.shape,s.shape);const i={a:t,b:s};return de.runKernel(Fl,i)}const nl=me({logicalAnd_:SG});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function TG(n){const e={x:ae(n,"x","logicalNot","bool")};return de.runKernel(Xo,e)}const vx=me({logicalNot_:TG});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function kG(n,e){const t=ae(n,"a","logicalOr","bool"),s=ae(e,"b","logicalOr","bool");Ft(t.shape,s.shape);const i={a:t,b:s};return de.runKernel(Gl,i)}const GC=me({logicalOr_:kG});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function EG(n,e){const t=ae(n,"a","logicalXor","bool"),s=ae(e,"b","logicalXor","bool");return Ft(t.shape,s.shape),nl(GC(n,e),vx(nl(n,e)))}const NG=me({logicalXor_:EG});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function AG(n,e,t,s,i){const o=ae(n,"x","maxPool"),c=1;let h=o,f=!1;o.rank===3&&(f=!0,h=ge(o,[1,o.shape[0],o.shape[1],o.shape[2]])),D(h.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${h.rank}.`),D(ds(t,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${c}'`),Ws("maxPool",s,i);const g={x:h},y={filterSize:e,strides:t,pad:s,dimRoundingMode:i},I=de.runKernel(Ah,g,y);return f?ge(I,[I.shape[1],I.shape[2],I.shape[3]]):I}const Ix=me({maxPool_:AG});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function RG(n,e=[1,1,1],t,s,i,o="NDHWC"){const c=ae(n,"x","maxPool3d");let h=c,f=!1;c.rank===4&&(f=!0,h=ge(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),D(h.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${h.rank}.`),D(o==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),Ws("maxPool3d",s,i);const g={x:h},y={filterSize:e,strides:t,pad:s,dimRoundingMode:i,dataFormat:o},I=de.runKernel(pr,g,y);return f?ge(I,[I.shape[1],I.shape[2],I.shape[3],I.shape[4]]):I}const MG=me({maxPool3d_:RG});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function LG(n,e){let t=ae(n,"a","maximum"),s=ae(e,"b","maximum");[t,s]=mr(t,s),t.dtype==="bool"&&(t=at(t,"int32"),s=at(s,"int32")),Ft(t.shape,s.shape);const i={a:t,b:s};return de.runKernel(Ct,i)}const tu=me({maximum_:LG});/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function DG(n,e=null,t=!1){const s={x:ae(n,"x","mean")},i={axis:e,keepDims:t};return de.runKernel(oc,s,i)}const Er=me({mean_:DG});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Zr(n,e="float32"){if(jr(n),e==="complex64"){const s=Zr(n,"float32"),i=Zr(n,"float32");return Kh(s,i)}const t=$n(H(n),e);return de.makeTensor(t,n,e)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function nu(n,e="float32"){if(jr(n),e==="complex64"){const s=nu(n,"float32"),i=Zr(n,"float32");return Kh(s,i)}const t=En(H(n),e);return de.makeTensor(t,n,e)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function OG(n,e){let t=ae(n,"a","minimum"),s=ae(e,"b","minimum");[t,s]=mr(t,s),t.dtype==="bool"&&(t=at(t,"int32"),s=at(s,"int32")),Ft(t.shape,s.shape);const i={a:t,b:s};return de.runKernel(lc,i)}const Nf=me({minimum_:OG});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function PG(n,e,t){D(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const s=ae(n,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");D(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const i=t==="reflect"?1:0;for(let h=0;h<s.rank;h++)D(e[h].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),D(e[h][0]>=0&&e[h][0]<=s.shape[h]-i&&e[h][1]>=0&&e[h][1]<=s.shape[h]-i,()=>`Padding in dimension ${h} cannot be greater than or equal to ${s.shape[h]-i} or less than 0 for input of shape ${s.shape}`);const o={paddings:e,mode:t},c={x:s};return de.runKernel(eo,c,o)}const FG=me({mirrorPad_:PG});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function GG(n,e){let t=ae(n,"a","mod"),s=ae(e,"b","mod");[t,s]=mr(t,s);const i={a:t,b:s};return de.runKernel(wa,i)}const _G=me({mod_:GG});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function VG(n,e=null,t=!1){n=ae(n,"x","moments");const s=be(e,n.shape),i=Er(n,s,t);let o=i.shape;t||(o=kr(i.shape,s));const c=zn(Nt(at(n,"float32"),ge(i,o))),h=Er(c,s,t);return{mean:i,variance:h}}const Cx=me({moments_:VG});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function BG(n,e){let t=ae(n,"a","notEqual","string_or_numeric"),s=ae(e,"b","notEqual","string_or_numeric");[t,s]=mr(t,s),Ft(t.shape,s.shape);const i={a:t,b:s};return de.runKernel(no,i)}const B0=me({notEqual_:BG});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function WG(n,e,t=1,s=0,i="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const o={indices:ae(n,"indices","oneHot","int32")},c={dtype:i,depth:e,onValue:t,offValue:s};return de.runKernel(Dh,o,c)}const _C=me({oneHot_:WG});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function zG(n){const e={x:ae(n,"x","onesLike")};return de.runKernel(uc,e)}const ea=me({onesLike_:zG});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function XG(n,e,t=0){const s=ae(n,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const i={paddings:e,constantValue:t},o={x:s};return de.runKernel(Ph,o,i)}const Sx=me({pad_:XG});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ZG(n,e,t){const s=ae(n,"x","spaceToBatchND");D(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),D(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),D(s.shape.reduce((c,h,f)=>f>0&&f<=e.length?c&&(h+t[f-1][0]+t[f-1][1])%e[f-1]===0:c,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const i={x:s},o={blockShape:e,paddings:t};return de.runKernel(_h,i,o)}const Tx=me({spaceToBatchND_:ZG});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function KG(n,e,t,s,i,o,c){i==null&&(i=[1,1]),o==null&&(o=1),s===0&&(s="valid");const h=ae(n,"x","maxPool");let f=h,g=!1;h.rank===3&&(g=!0,f=ge(h,[1,h.shape[0],h.shape[1],h.shape[2]])),D(ds(o,i),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${i}'`);const y=qi(f.shape,e,o,i,s),I=[y.dilationHeight,y.dilationWidth];let C;s==="same"?C=UG([y.filterHeight,y.filterWidth],I):C=[[0,0],[0,0]];const k=I[0]===1&&I[1]===1,[N,R]=$G([y.inHeight,y.inWidth],I,C),P=k?s:"valid",L=k?f:Tx(f,I,N),F=(t==="avg"?()=>cx(L,e,o,P,c):()=>Ix(L,e,o,P,c))(),W=k?F:dx(F,I,R);return g?ge(W,[W.shape[1],W.shape[2],W.shape[3]]):W}function $G(n,e,t){const s=t.map(y=>y[0]),i=t.map(y=>y[1]),o=n.concat(s,i),c=e.map((y,I)=>(y-o[I]%y)%y),h=i.map((y,I)=>y+c[I]),f=e.map((y,I)=>[s[I],h[I]]),g=e.map((y,I)=>[0,c[I]]);return[f,g]}function UG(n,e){const t=n.map((o,c)=>o+(o-1)*(e[c]-1)).map(o=>o-1),s=t.map(o=>Math.floor(o/2)),i=t.map((o,c)=>o-s[c]);return t.map((o,c)=>[s[c],i[c]])}const HG=me({pool_:KG});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function jG(n,e){const t=ae(n,"x","prelu"),s=ae(e,"alpha","prelu"),i={x:t,alpha:s};return de.runKernel(cc,i)}const kx=me({prelu_:jG});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function YG(n,e=null,t=!1){let s=ae(n,"x","prod");s.dtype==="bool"&&(s=at(s,"int32"));const i={x:s},o={axis:e,keepDims:t};return de.runKernel(Ko,i,o)}const QG=me({prod_:YG});var VC={exports:{}};(function(n){(function(e,t,s){function i(f){var g=this,y=h();g.next=function(){var I=2091639*g.s0+g.c*23283064365386963e-26;return g.s0=g.s1,g.s1=g.s2,g.s2=I-(g.c=I|0)},g.c=1,g.s0=y(" "),g.s1=y(" "),g.s2=y(" "),g.s0-=y(f),g.s0<0&&(g.s0+=1),g.s1-=y(f),g.s1<0&&(g.s1+=1),g.s2-=y(f),g.s2<0&&(g.s2+=1),y=null}function o(f,g){return g.c=f.c,g.s0=f.s0,g.s1=f.s1,g.s2=f.s2,g}function c(f,g){var y=new i(f),I=g&&g.state,C=y.next;return C.int32=function(){return y.next()*4294967296|0},C.double=function(){return C()+(C()*2097152|0)*11102230246251565e-32},C.quick=C,I&&(typeof I=="object"&&o(I,y),C.state=function(){return o(y,{})}),C}function h(){var f=4022871197,g=function(y){y=String(y);for(var I=0;I<y.length;I++){f+=y.charCodeAt(I);var C=.02519603282416938*f;f=C>>>0,C-=f,C*=f,f=C>>>0,C-=f,f+=C*4294967296}return(f>>>0)*23283064365386963e-26};return g}t&&t.exports?t.exports=c:this.alea=c})(At,n)})(VC);var JG=VC.exports,BC={exports:{}};(function(n){(function(e,t,s){function i(h){var f=this,g="";f.x=0,f.y=0,f.z=0,f.w=0,f.next=function(){var I=f.x^f.x<<11;return f.x=f.y,f.y=f.z,f.z=f.w,f.w^=f.w>>>19^I^I>>>8},h===(h|0)?f.x=h:g+=h;for(var y=0;y<g.length+64;y++)f.x^=g.charCodeAt(y)|0,f.next()}function o(h,f){return f.x=h.x,f.y=h.y,f.z=h.z,f.w=h.w,f}function c(h,f){var g=new i(h),y=f&&f.state,I=function(){return(g.next()>>>0)/4294967296};return I.double=function(){do var C=g.next()>>>11,k=(g.next()>>>0)/4294967296,N=(C+k)/(1<<21);while(N===0);return N},I.int32=g.next,I.quick=I,y&&(typeof y=="object"&&o(y,g),I.state=function(){return o(g,{})}),I}t&&t.exports?t.exports=c:this.xor128=c})(At,n)})(BC);var qG=BC.exports,WC={exports:{}};(function(n){(function(e,t,s){function i(h){var f=this,g="";f.next=function(){var I=f.x^f.x>>>2;return f.x=f.y,f.y=f.z,f.z=f.w,f.w=f.v,(f.d=f.d+362437|0)+(f.v=f.v^f.v<<4^(I^I<<1))|0},f.x=0,f.y=0,f.z=0,f.w=0,f.v=0,h===(h|0)?f.x=h:g+=h;for(var y=0;y<g.length+64;y++)f.x^=g.charCodeAt(y)|0,y==g.length&&(f.d=f.x<<10^f.x>>>4),f.next()}function o(h,f){return f.x=h.x,f.y=h.y,f.z=h.z,f.w=h.w,f.v=h.v,f.d=h.d,f}function c(h,f){var g=new i(h),y=f&&f.state,I=function(){return(g.next()>>>0)/4294967296};return I.double=function(){do var C=g.next()>>>11,k=(g.next()>>>0)/4294967296,N=(C+k)/(1<<21);while(N===0);return N},I.int32=g.next,I.quick=I,y&&(typeof y=="object"&&o(y,g),I.state=function(){return o(g,{})}),I}t&&t.exports?t.exports=c:this.xorwow=c})(At,n)})(WC);var e_=WC.exports,zC={exports:{}};(function(n){(function(e,t,s){function i(h){var f=this;f.next=function(){var y=f.x,I=f.i,C,k;return C=y[I],C^=C>>>7,k=C^C<<24,C=y[I+1&7],k^=C^C>>>10,C=y[I+3&7],k^=C^C>>>3,C=y[I+4&7],k^=C^C<<7,C=y[I+7&7],C=C^C<<13,k^=C^C<<9,y[I]=k,f.i=I+1&7,k};function g(y,I){var C,k=[];if(I===(I|0))k[0]=I;else for(I=""+I,C=0;C<I.length;++C)k[C&7]=k[C&7]<<15^I.charCodeAt(C)+k[C+1&7]<<13;for(;k.length<8;)k.push(0);for(C=0;C<8&&k[C]===0;++C);for(C==8?k[7]=-1:k[C],y.x=k,y.i=0,C=256;C>0;--C)y.next()}g(f,h)}function o(h,f){return f.x=h.x.slice(),f.i=h.i,f}function c(h,f){h==null&&(h=+new Date);var g=new i(h),y=f&&f.state,I=function(){return(g.next()>>>0)/4294967296};return I.double=function(){do var C=g.next()>>>11,k=(g.next()>>>0)/4294967296,N=(C+k)/(1<<21);while(N===0);return N},I.int32=g.next,I.quick=I,y&&(y.x&&o(y,g),I.state=function(){return o(g,{})}),I}t&&t.exports?t.exports=c:this.xorshift7=c})(At,n)})(zC);var t_=zC.exports,XC={exports:{}};(function(n){(function(e,t,s){function i(h){var f=this;f.next=function(){var y=f.w,I=f.X,C=f.i,k,N;return f.w=y=y+1640531527|0,N=I[C+34&127],k=I[C=C+1&127],N^=N<<13,k^=k<<17,N^=N>>>15,k^=k>>>12,N=I[C]=N^k,f.i=C,N+(y^y>>>16)|0};function g(y,I){var C,k,N,R,P,L=[],F=128;for(I===(I|0)?(k=I,I=null):(I=I+"\0",k=0,F=Math.max(F,I.length)),N=0,R=-32;R<F;++R)I&&(k^=I.charCodeAt((R+32)%I.length)),R===0&&(P=k),k^=k<<10,k^=k>>>15,k^=k<<4,k^=k>>>13,R>=0&&(P=P+1640531527|0,C=L[R&127]^=k+P,N=C==0?N+1:0);for(N>=128&&(L[(I&&I.length||0)&127]=-1),N=127,R=4*128;R>0;--R)k=L[N+34&127],C=L[N=N+1&127],k^=k<<13,C^=C<<17,k^=k>>>15,C^=C>>>12,L[N]=k^C;y.w=P,y.X=L,y.i=N}g(f,h)}function o(h,f){return f.i=h.i,f.w=h.w,f.X=h.X.slice(),f}function c(h,f){h==null&&(h=+new Date);var g=new i(h),y=f&&f.state,I=function(){return(g.next()>>>0)/4294967296};return I.double=function(){do var C=g.next()>>>11,k=(g.next()>>>0)/4294967296,N=(C+k)/(1<<21);while(N===0);return N},I.int32=g.next,I.quick=I,y&&(y.X&&o(y,g),I.state=function(){return o(g,{})}),I}t&&t.exports?t.exports=c:this.xor4096=c})(At,n)})(XC);var n_=XC.exports,ZC={exports:{}};(function(n){(function(e,t,s){function i(h){var f=this,g="";f.next=function(){var I=f.b,C=f.c,k=f.d,N=f.a;return I=I<<25^I>>>7^C,C=C-k|0,k=k<<24^k>>>8^N,N=N-I|0,f.b=I=I<<20^I>>>12^C,f.c=C=C-k|0,f.d=k<<16^C>>>16^N,f.a=N-I|0},f.a=0,f.b=0,f.c=-1640531527,f.d=1367130551,h===Math.floor(h)?(f.a=h/4294967296|0,f.b=h|0):g+=h;for(var y=0;y<g.length+20;y++)f.b^=g.charCodeAt(y)|0,f.next()}function o(h,f){return f.a=h.a,f.b=h.b,f.c=h.c,f.d=h.d,f}function c(h,f){var g=new i(h),y=f&&f.state,I=function(){return(g.next()>>>0)/4294967296};return I.double=function(){do var C=g.next()>>>11,k=(g.next()>>>0)/4294967296,N=(C+k)/(1<<21);while(N===0);return N},I.int32=g.next,I.quick=I,y&&(typeof y=="object"&&o(y,g),I.state=function(){return o(g,{})}),I}t&&t.exports?t.exports=c:this.tychei=c})(At,n)})(ZC);var r_=ZC.exports,KC={exports:{}};const s_=vi(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));(function(n){(function(e,t,s){var i=256,o=6,c=52,h="random",f=s.pow(i,o),g=s.pow(2,c),y=g*2,I=i-1,C;function k(z,X,Q){var J=[];X=X==!0?{entropy:!0}:X||{};var te=L(P(X.entropy?[z,W(t)]:z??F(),3),J),ie=new N(J),oe=function(){for(var Ce=ie.g(o),Se=f,Te=0;Ce<g;)Ce=(Ce+Te)*i,Se*=i,Te=ie.g(1);for(;Ce>=y;)Ce/=2,Se/=2,Te>>>=1;return(Ce+Te)/Se};return oe.int32=function(){return ie.g(4)|0},oe.quick=function(){return ie.g(4)/4294967296},oe.double=oe,L(W(ie.S),t),(X.pass||Q||function(Ce,Se,Te,Le){return Le&&(Le.S&&R(Le,ie),Ce.state=function(){return R(ie,{})}),Te?(s[h]=Ce,Se):Ce})(oe,te,"global"in X?X.global:this==s,X.state)}function N(z){var X,Q=z.length,J=this,te=0,ie=J.i=J.j=0,oe=J.S=[];for(Q||(z=[Q++]);te<i;)oe[te]=te++;for(te=0;te<i;te++)oe[te]=oe[ie=I&ie+z[te%Q]+(X=oe[te])],oe[ie]=X;(J.g=function(Ce){for(var Se,Te=0,Le=J.i,Me=J.j,Oe=J.S;Ce--;)Se=Oe[Le=I&Le+1],Te=Te*i+Oe[I&(Oe[Le]=Oe[Me=I&Me+Se])+(Oe[Me]=Se)];return J.i=Le,J.j=Me,Te})(i)}function R(z,X){return X.i=z.i,X.j=z.j,X.S=z.S.slice(),X}function P(z,X){var Q=[],J=typeof z,te;if(X&&J=="object")for(te in z)try{Q.push(P(z[te],X-1))}catch{}return Q.length?Q:J=="string"?z:z+"\0"}function L(z,X){for(var Q=z+"",J,te=0;te<Q.length;)X[I&te]=I&(J^=X[I&te]*19)+Q.charCodeAt(te++);return W(X)}function F(){try{var z;return C&&(z=C.randomBytes)?z=z(i):(z=new Uint8Array(i),(e.crypto||e.msCrypto).getRandomValues(z)),W(z)}catch{var X=e.navigator,Q=X&&X.plugins;return[+new Date,e,Q,e.screen,W(t)]}}function W(z){return String.fromCharCode.apply(0,z)}if(L(s.random(),t),n.exports){n.exports=k;try{C=s_}catch{}}else s["seed"+h]=k})(typeof self<"u"?self:At,[],Math)})(KC);var i_=KC.exports,a_=JG,o_=qG,l_=e_,u_=t_,c_=n_,h_=r_,Nc=i_;Nc.alea=a_,Nc.xor128=o_,Nc.xorwow=l_,Nc.xorshift7=u_,Nc.xor4096=c_,Nc.tychei=h_;var Ex=Nc;/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class $C{constructor(e,t,s,i,o){this.mean=e,this.stdDev=t,this.dtype=s,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const c=o||Math.random();this.random=Ex.alea(c.toString())}nextValue(){if(!isNaN(this.nextVal)){const i=this.nextVal;return this.nextVal=NaN,i}let e,t,s=!1;for(;!s;){let i,o,c;do i=2*this.random()-1,o=2*this.random()-1,c=i*i+o*o;while(c>=1||c===0);const h=Math.sqrt(-2*Math.log(c)/c);e=this.mean+this.stdDev*i*h,t=this.mean+this.stdDev*o*h,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class d_{constructor(e=0,t=1,s,i){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=s,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=Ex.alea(i)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function f_(n,e=0,t=1,s,i){if(jr(n),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const o=new $C(e,t,s,!1,i),c=Xt(n,s);for(let h=0;h<c.values.length;h++)c.values[h]=o.nextValue();return c.toTensor()}const p_=me({randomNormal_:f_});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function m_(n,e=0,t=1,s="float32",i){jr(n);const o=Xt(n,s),c=new d_(e,t,null,i);for(let h=0;h<o.values.length;h++)o.values[h]=c.nextValue();return o.toTensor()}const Af=me({randomUniform_:m_});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Rf(n,e,t=1,s="float32"){if(t===0)throw new Error("Cannot have a step of zero");const i={start:n,stop:e,step:t,dtype:s};return de.runKernel(Gt,{},i)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function g_(n){const e={input:ae(n,"input","real")};return de.runKernel(Tr,e)}const W0=me({real_:g_});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function x_(n){const e={x:ae(n,"x","reciprocal")};return de.runKernel(ro,e)}const y_=me({reciprocal_:x_});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function b_(n){const e={x:ae(n,"x","relu")};return de.runKernel(Bl,e)}const Ac=me({relu_:b_});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function w_(n){const e={x:ae(n,"x","relu6")};return de.runKernel($o,e)}const UC=me({relu6_:w_});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function v_(n,e){const t={x:ae(n,"x","reverse")},s={dims:e};return de.runKernel(Mn,t,s)}const Rc=me({reverse_:v_});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function I_(n){const e={x:ae(n,"x","round")};return de.runKernel(so,e)}const HC=me({round_:I_});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function C_(n){const e={x:ae(n,"x","rsqrt","float32")};return de.runKernel(bi,e)}const jC=me({rsqrt_:C_});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function S_(n){const e={x:ae(n,"x","selu")};return de.runKernel(wi,e)}const YC=me({selu_:S_});function T_(n,e,t,s,i,o=[1,1],c="NHWC"){const h=ae(n,"x","separableConv2d"),f=ae(e,"depthwiseFilter","separableConv2d"),g=ae(t,"pointwiseFilter","separableConv2d");let y=h,I=!1;if(h.rank===3&&(I=!0,y=ge(h,[1,h.shape[0],h.shape[1],h.shape[2]])),c==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");D(y.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${y.rank}.`),D(f.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${f.rank}.`),D(g.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${f.rank}.`),D(g.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${g.shape[0]}.`),D(g.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${g.shape[1]}.`);const C=f.shape[2],k=f.shape[3];D(g.shape[2]===C*k,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${C*k}, but got ${g.shape[2]}.`);const N=gx(y,f,s,i,c,o),R=kc(N,g,1,"valid",c);return I?ge(R,[R.shape[1],R.shape[2],R.shape[3]]):R}const QC=me({separableConv2d_:T_});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function k_(n){const e={x:ae(n,"x","sign")};return de.runKernel(Uo,e)}const E_=me({sign_:k_});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function N_(n){const e={x:ae(n,"x","sin","float32")};return de.runKernel(hc,e)}const JC=me({sin_:N_});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function A_(n){const e={x:ae(n,"x","sinh")};return de.runKernel(vs,e)}const qC=me({sinh_:A_});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function R_(n,e,t){const s=ae(n,"x","slice1d");return D(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),On(s,[e],[t])}const Nx=me({slice1d_:R_});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function M_(n,e,t){const s=ae(n,"x","slice2d");return D(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),On(s,e,t)}const eS=me({slice2d_:M_});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function L_(n,e,t){const s=ae(n,"x","slice3d");return D(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),On(s,e,t)}const Ax=me({slice3d_:L_});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function D_(n,e,t){const s=ae(n,"x","slice4d");return D(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),On(s,e,t)}const z0=me({slice4d_:D_});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function O_(n,e=-1){const t=ae(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const s={logits:t},i={dim:e};return de.runKernel(Zl,s,i)}const Rx=me({softmax_:O_});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function P_(n){D(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return de.runKernel(rc,e)}const tS=me({fft_:P_});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function F_(n){D(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return de.runKernel(q,e)}const Mx=me({ifft_:F_});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function G_(n){const e=n.shape[n.shape.length-1],t=n.size/e;let s;if(e<=2){const i=ge(n,[t,e]);s=Mx(i)}else{const i=[t,2*(e-1)],o=ge(W0(n),[t,e]),c=ge(bx(n),[t,e]),h=Rc(On(o,[0,1],[t,e-2]),1),f=pe(Rc(On(c,[0,1],[t,e-2]),1),hn(-1)),g=zs([o,h],1),y=zs([c,f],1),I=ge(Kh(g,y),[i[0],i[1]]);s=Mx(I)}if(s=W0(s),n.rank===3&&n.shape[0]!==0){const i=s,o=n.shape[0];s=ge(s,[o,s.shape[0]/o,s.shape[1]]),i.dispose()}return s}const __=me({irfft_:G_});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function V_(n,e,t=0){const s={x:ae(n,"x","split")},i={numOrSizeSplits:e,axis:t};return de.runKernel(Ca,s,i)}const ki=me({split_:V_});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function B_(n,e){D(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const s=n.size/t;let i;if(e!=null&&e<t){const N=n.shape.map(P=>0),R=n.shape.map(P=>P);R[n.shape.length-1]=e,i=On(n,N,R),t=e}else if(e!=null&&e>t){const N=n.shape.map(R=>R);N[n.shape.length-1]=e-t,i=zs([n,Zr(N)],n.shape.length-1),t=e}else i=n;const o=en(i),c=ge(Kh(i,o),[s,t]),h=tS(c),f=Math.floor(t/2)+1,g=W0(h),y=bx(h),I=ki(g,[f,t-f],g.shape.length-1),C=ki(y,[f,t-f],y.shape.length-1),k=i.shape.slice();return k[i.shape.length-1]=f,ge(Kh(I[0],C[0]),k)}const W_=me({rfft_:B_});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function z_(n,e){let t=ae(n,"a","squaredDifference"),s=ae(e,"b","squaredDifference");[t,s]=mr(t,s),Ft(t.shape,s.shape);const i={a:t,b:s},o={};return de.runKernel(es,i,o)}const X_=me({squaredDifference_:z_});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Z_(n,e){const t=ae(n,"x","squeeze","string_or_numeric");return ge(t,Fe(t.shape,e).newShape)}const Mf=me({squeeze_:Z_});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function K_(n,e=0){const t=cC(n,"tensors","stack","string_or_numeric");D(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&D(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const s=t,i={axis:e};return de.runKernel(Oh,s,i)}const uo=me({stack_:K_});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function $_(n,e=0){const t={x:ae(n,"x","step")},s={alpha:e};return de.runKernel(w,t,s)}const Lf=me({step_:$_});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function U_(n,e,t,s,i=0,o=0,c=0,h=0,f=0){const g={x:ae(n,"x","stridedSlice","string_or_numeric")},y={begin:e,end:t,strides:s,beginMask:i,endMask:o,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:f};return de.runKernel(pf,g,y)}const H_=me({stridedSlice_:U_});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function j_(n){const e={x:ae(n,"x","tan","float32")};return de.runKernel(pc,e)}const Y_=me({tan_:j_});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function oi(n,e){re(n);const t=bf(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return wf(n,null,t,e)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Lx(n,e,t){if(re(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=bf(n,t);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return wf(n,e,s,t)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Q_(n,e,t){if(re(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const s=bf(n,t);if(s.length!==3&&s.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return wf(n,e,s,t)}function nS(n,e,t){const s=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${s}, and batchDim: ${i}.`;if(t.rank<i)throw new Error(o+` update.rank < ${i}. `);if(n.length<s+(t.rank-i))throw new Error(o+` Output shape length < ${s+(t.rank-i)}`);if(t.rank!==i+n.length-s)throw new Error(o+` update.rank != ${i+n.length-s}`);for(let c=0;c<i;++c)if(t.shape[c]!==e.shape[c])throw new Error(o+` updates.shape[${c}] (${t.shape[c]}) != indices.shape[${c}] (${e.shape[c]}).`);for(let c=0;c<t.rank-i;++c)if(t.shape[c+i]!==n[c+s])throw new Error(o+` updates.shape[${c+i}] (${t.shape[c+i]}) != shape[${c+i}] (${n[c+i]})`)}function J_(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}nS(t,e,n)}function Mc(n,e,t){const s=e.shape.length,i=s>1?e.shape[s-1]:1,o=t.length;let c=1;for(let I=i;I<o;++I)c*=t[I];const h=i<1?1:i,f=H(e.shape)/h,g=[...We(t.slice(0,i)),1],y=H(t);return{sliceRank:i,numUpdates:f,sliceSize:c,strides:g,outputSize:y}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function q_(n,e=1,t=!0){const s=ae(n,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const i=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>i)throw new Error(`'k' passed to topk() must be <= the last dimension (${i}) but got ${e}`);const o={x:s},c={k:e,sorted:t},[h,f]=de.runKernel(jt,o,c);return{values:h,indices:f}}const eV=me({topk_:q_});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tV(n,e=0,t=1,s,i){if(jr(n),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const o=new $C(e,t,s,!0,i),c=Xt(n,s);for(let h=0;h<c.values.length;h++)c.values[h]=o.nextValue();return c.toTensor()}const rS=me({truncatedNormal_:tV});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function nV(n,e=0){const t=ae(n,"x","unique","string_or_numeric");D(t.rank>0,()=>"The input tensor must be at least 1D");const s={x:t},i={axis:e},[o,c]=de.runKernel(u,s,i);return{values:o,indices:c}}const rV=me({unique_:nV});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sV(n,e,t){const s=ae(n,"x","unsortedSegmentSum"),i=ae(e,"segmentIds","unsortedSegmentSum","int32");D(Ee(t),()=>"numSegments must be of dtype int");const o={x:s,segmentIds:i},c={numSegments:t};return de.runKernel(m,o,c)}const sS=me({unsortedSegmentSum_:sV});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function iV(n,e=0){const t=ae(n,"x","unstack","string_or_numeric");D(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const s={value:t},i={axis:e};return de.runKernel(d,s,i)}const Lc=me({unstack_:iV});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function aV(n,e=!0,t,s){return de.makeVariable(n,e,t,s)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function iS(n,e){const t=[];for(let o=0;o<e.length;o++)e[o]&&t.push(o);const s=Xt(n,"int32"),i=Xt([t.length,n.length],"int32");for(let o=0;o<t.length;o++){const c=s.indexToLoc(t[o]),h=o*n.length;i.values.set(c,h)}return i.toTensor()}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function oV(n,e,t){const s=ae(n,"x","transpose");if(e==null&&(e=s.shape.map((c,h)=>h).reverse()),D(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(c=>{D(c>=0&&c<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const i={x:s},o={perm:e};return s.dtype==="complex64"?ye(()=>{let c=W0(s),h=bx(s);return c=de.runKernel(K,{x:c},o),h=de.runKernel(K,{x:h},o),t&&(h=xr(h)),Kh(c,h)}):de.runKernel(K,i,o)}const tn=me({transpose_:oV});/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function lV(n,e){if(e==null)return n.shape.slice();if(se(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let s=0;s<n.shape.length;s++)e[s]==null&&n.shape[s]!=null?t.push(n.shape[s]):t.push(e[s]);return t}return e}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function uV(n,e,t,s){const i=ae(n,"x","dropout");if(D(i.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${i.dtype} tensor instead.`),D(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof Mr?i.clone():i;const o=lV(i,t),c=1-e,h=Et(_0(Ue(Af(o,0,1,"float32",s),c)),c);return pe(i,h)}const cV=me({dropout_:uV});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hV(n,e,t,s,i,o="NHWC",c){let h=n;n.rank===3&&(h=ge(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let f=e;f.rank===3&&(f=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]])),D(h.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${h.shape}.`),D(f.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${f.shape}.`),D(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const g=o==="NHWC"?h.shape[3]:h.shape[1],y=o==="NHWC"?f.shape[3]:f.shape[1];D(g===t[2],()=>`Error in conv2dDerFilter: depth of input ${g}) must match input depth in filter (${t[2]}.`),D(y===t[3],()=>`Error in conv2dDerFilter: depth of dy (${y}) must match output depth for filter (${t[3]}).`),Ws("conv2dDerFilter",i,c);const I={x:h,dy:f},C={strides:s,pad:i,dataFormat:o,dimRoundingMode:c,filterShape:t};return de.runKernel(Qr,I,C)}const Dx=me({conv2DBackpropFilter_:hV});/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ox(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return pe(n,Lf(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function Px(n,e){let t=e;const s=Lr(n.shape,e.shape);return s.length>0&&(t=It(t,s)),ge(t,n.shape)}function Fx(n,e,t,s){if(e==="linear")return n;if(e==="relu")return Ac(n);if(e==="elu")return P0(n);if(e==="relu6")return UC(n);if(e==="prelu")return kx(n,t);if(e==="leakyrelu")return wx(n,s);if(e==="sigmoid")return jh(n);throw new Error(`Unknown fused activation ${e}.`)}const Gx=(n,e)=>!(n>0)||e==="linear";/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function dV({x:n,filter:e,strides:t,pad:s,dataFormat:i="NHWC",dilations:o=[1,1],dimRoundingMode:c,bias:h,activation:f="linear",preluActivationWeights:g,leakyreluAlpha:y}){if(f=f||"linear",Gx(de.state.gradientDepth,f)===!1){D(i==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${i} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let Q=kc(n,e,t,s,i,o,c);return h!=null&&(Q=Ue(Q,h)),Fx(Q,f,g,y)}const I=ae(n,"x","conv2d","float32"),C=ae(e,"filter","conv2d","float32");let k=I,N=!1;I.rank===3&&(N=!0,k=ge(I,[1,I.shape[0],I.shape[1],I.shape[2]])),D(k.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${k.rank}.`),D(C.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${C.rank}.`),Ws("fused conv2d",s,c);const R=i==="NHWC"?k.shape[3]:k.shape[1];D(C.shape[2]===R,()=>`Error in conv2d: depth of input (${R}) must match input depth for filter ${C.shape[2]}.`),D(ds(t,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);const P=ns(k.shape,C.shape,t,o,s,c);let L;h!=null&&(L=ae(h,"bias","fused conv2d"),[L]=mr(L,I),i==="NHWC"?Ft(P.outShape,L.shape):(D(L.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${L.shape.length}.`),D(L.shape.length===0||L.shape[0]===P.outChannels||L.shape[0]===1,()=>`Error in fused conv2d: bias shape (${L.shape}) is not compatible with the number of output channels (${P.outChannels})`)));let F;if(g!=null){const Q=g.shape;if(D(Q.length<=1||Q.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${Q.length}.`),Q.length===1)D(Q[0]===1||Q[0]===P.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${Q}) is not compatible with the number of output channels (${P.outChannels}).`);else if(Q.length===3)try{Ft(Q,P.outShape)}catch{const J=`Error in fused conv2d: PReLU activation weights (${Q}) is not compatible with the output shape of the conv2d (${P.outShape}).`;throw Error(J)}F=ae(g,"prelu weights","fused conv2d")}const W=(Q,J)=>{D(i==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${i} but only NHWC is currently supported.`);const[te,ie,oe,Ce]=J,Se=Ox(Q,oe,f);D(Sc(o),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`);const Te=fx(ie.shape,Se,te,t,s),Le=Dx(ie,Se,te.shape,t,s),Me=[Te,Le];if(Ce!=null){const Oe=Px(Ce,Se);Me.push(Oe)}return Me},z={x:k,filter:C,bias:L,preluActivationWeights:F},X={strides:t,pad:s,dataFormat:i,dilations:o,dimRoundingMode:c,activation:f,leakyreluAlpha:y};return h==null?qh((Q,J,te)=>{let ie=de.runKernel(G,z,X);return te([J,Q,ie]),N&&(ie=ge(ie,[ie.shape[1],ie.shape[2],ie.shape[3]])),{value:ie,gradFunc:W}})(k,C):qh((Q,J,te,ie)=>{let oe=de.runKernel(G,z,X);return ie([J,Q,oe,te]),N&&(oe=ge(oe,[oe.shape[1],oe.shape[2],oe.shape[3]])),{value:oe,gradFunc:W}})(k,C,L)}const fV=me({fusedConv2d_:dV});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function pV(n,e,t,s,i,o=[1,1],c){let h=n;n.rank===3&&(h=ge(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let f=e;f.rank===3&&(f=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const g={x:h,dy:f},y={strides:s,pad:i,dimRoundingMode:c,dilations:o,filterShape:t};return de.runKernel(ni,g,y)}const mV=me({depthwiseConv2dNativeBackpropFilter_:pV});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function gV(n,e,t,s,i,o=[1,1],c){let h=e,f=!1;e.rank===3&&(f=!0,h=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const g={dy:h,filter:t},y={strides:s,pad:i,dimRoundingMode:c,dilations:o,inputShape:n},I=de.runKernel(Wr,g,y);return f?ge(I,[I.shape[1],I.shape[2],I.shape[3]]):I}const xV=me({depthwiseConv2dNativeBackpropInput_:gV});/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yV({a:n,b:e,transposeA:t=!1,transposeB:s=!1,bias:i,activation:o="linear",preluActivationWeights:c,leakyreluAlpha:h=.2}){if(Gx(de.state.gradientDepth,o)===!1){let oe=cn(n,e,t,s);return i!=null&&(oe=Ue(oe,i)),Fx(oe,o,c,h)}let f=ae(n,"a","fused matMul"),g=ae(e,"b","fused matMul");[f,g]=mr(f,g);const y=t?f.shape[f.rank-2]:f.shape[f.rank-1],I=s?g.shape[g.rank-1]:g.shape[g.rank-2],C=t?f.shape[f.rank-1]:f.shape[f.rank-2],k=s?g.shape[g.rank-2]:g.shape[g.rank-1],N=f.shape.slice(0,-2),R=g.shape.slice(0,-2),P=H(N),L=H(R);D(y===I,()=>`Error in fused matMul: inner shapes (${y}) and (${I}) of Tensors with shapes ${f.shape} and ${g.shape} and transposeA=${t} and transposeB=${s} must match.`);const F=Ft(f.shape.slice(0,-2),g.shape.slice(0,-2)).concat([C,k]),W=t?ge(f,[P,y,C]):ge(f,[P,C,y]),z=s?ge(g,[L,k,I]):ge(g,[L,I,k]);let X;i!=null&&(X=ae(i,"bias","fused matMul"),[X]=mr(X,f),Ft(F,X.shape));let Q;c!=null&&(Q=ae(c,"prelu weights","fused matMul"));const J=(oe,Ce)=>{const[Se,Te,Le,Me]=Ce,Oe=Ox(ge(oe,Le.shape),Le,o);let Ve,_e;if(!t&&!s?(Ve=cn(Oe,Te,!1,!0),_e=cn(Se,Oe,!0,!1)):!t&&s?(Ve=cn(Oe,Te,!1,!1),_e=cn(Oe,Se,!0,!1)):t&&!s?(Ve=cn(Te,Oe,!1,!0),_e=cn(Se,Oe,!1,!1)):(Ve=cn(Te,Oe,!0,!0),_e=cn(Oe,Se,!0,!0)),i!=null){const Be=Px(Me,Oe);return[Ve,_e,Be]}else return[Ve,_e]},te={a:W,b:z,bias:X,preluActivationWeights:Q},ie={transposeA:t,transposeB:s,activation:o,leakyreluAlpha:h};return i==null?qh((oe,Ce,Se)=>{const Te=de.runKernel(A,te,ie);return Se([oe,Ce,Te]),{value:ge(Te,F),gradFunc:J}})(W,z):qh((oe,Ce,Se,Te)=>{const Le=de.runKernel(A,te,ie);return Te([oe,Ce,Le,Se]),{value:ge(Le,F),gradFunc:J}})(W,z,X)}const aS=me({fusedMatMul_:yV});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function bV(n,e,t,s,i="bilinear",o=0){const c=ae(n,"image","cropAndResize"),h=ae(e,"boxes","cropAndResize","float32"),f=ae(t,"boxInd","cropAndResize","int32"),g=h.shape[0];D(c.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${c.rank}.`),D(h.rank===2&&h.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${g},4] but had shape ${h.shape}.`),D(f.rank===1&&f.shape[0]===g,()=>`Error in cropAndResize: boxInd must be have size [${g}] but had shape ${h.shape}.`),D(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),D(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),D(i==="bilinear"||i==="nearest",()=>`method must be bilinear or nearest, but was ${i}`);const y={image:c,boxes:h,boxInd:f},I={method:i,extrapolationValue:o,cropSize:s};return de.runKernel(Ll,y,I)}const wV=me({cropAndResize_:bV});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vV(n){const e=ae(n,"image","flipLeftRight","float32");D(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return de.runKernel(ji,t,{})}const IV=me({flipLeftRight_:vV});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function CV(n){const e=ae(n,"image","grayscaleToRGB"),t=e.rank-1,s=e.shape[t];D(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),D(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const i=new Array(e.rank);return i.fill(1,0,t),i[t]=3,Aa(e,i)}const SV=me({grayscaleToRGB_:CV});/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function TV(n){const e=ae(n,"image","RGBToGrayscale"),t=e.rank-1,s=e.shape[t];D(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),D(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const i=e.dtype,o=at(e,"float32"),c=oi([.2989,.587,.114]);let h;switch(e.rank){case 2:h=kf("ij,j->i",o,c);break;case 3:h=kf("ijk,k->ij",o,c);break;case 4:h=kf("ijkl,l->ijk",o,c);break;case 5:h=kf("ijklm,m->ijkl",o,c);break;case 6:h=kf("ijklmn,n->ijklm",o,c);break;default:throw new Error("Not a valid tensor rank.")}return h=Xs(h,-1),at(h,i)}const kV=me({rgbToGrayscale_:TV});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function EV(n,e,t=0,s=.5){const i=ae(n,"image","rotateWithOffset","float32");D(i.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${i.rank}.`);const o={image:i},c={radians:e,fillValue:t,center:s};return de.runKernel(E,o,c)}const NV=me({rotateWithOffset_:EV});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ed(n,e,t,s,i,o){s==null&&(s=.5),i==null&&(i=Number.NEGATIVE_INFINITY),o==null&&(o=0);const c=n.shape[0];return t=Math.min(t,c),D(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),D(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),D(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),D(e.rank===1,()=>"scores must be a 1D tensor"),D(e.shape[0]===c,()=>`scores has incompatible shape with boxes. Expected ${c}, but was ${e.shape[0]}`),D(0<=o&&o<=1,()=>`softNmsSigma must be in [0, 1], but was '${o}'`),{maxOutputSize:t,iouThreshold:s,scoreThreshold:i,softNmsSigma:o}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function AV(n,e,t,s=.5,i=Number.NEGATIVE_INFINITY){const o=ae(n,"boxes","nonMaxSuppression","float32"),c=ae(e,"scores","nonMaxSuppression","float32"),h=ed(o,c,t,s,i);t=h.maxOutputSize,s=h.iouThreshold,i=h.scoreThreshold;const f={maxOutputSize:t,iouThreshold:s,scoreThreshold:i};return de.runKernel(qr,{boxes:o,scores:c},f)}const RV=me({nonMaxSuppression_:AV});/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function MV(n,e,t){const s=LV(n,e,t),i=s<0?-(s+1):s;n.splice(i,0,e)}function LV(n,e,t){return OV(n,e,t||DV)}function DV(n,e){return n>e?1:n<e?-1:0}function OV(n,e,t){let s=0,i=n.length,o=0,c=!1;for(;s<i;){o=s+(i-s>>>1);const h=t(e,n[o]);h>0?s=o+1:(i=o,c=!h)}return c?s:-s-1}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _x(n,e,t,s,i){return Wx(n,e,t,s,i,0)}function Vx(n,e,t,s,i,o){return Wx(n,e,t,s,i,0,!1,o,!0)}function Bx(n,e,t,s,i,o){return Wx(n,e,t,s,i,o,!0)}function Wx(n,e,t,s,i,o,c=!1,h=!1,f=!1){const g=[];for(let P=0;P<e.length;P++)e[P]>i&&g.push({score:e[P],boxIndex:P,suppressBeginIndex:0});g.sort(oS);const y=o>0?-.5/o:0,I=[],C=[];for(;I.length<t&&g.length>0;){const P=g.pop(),{score:L,boxIndex:F,suppressBeginIndex:W}=P;if(L<i)break;let z=!1;for(let X=I.length-1;X>=W;--X){const Q=PV(n,F,I[X]);if(Q>=s){z=!0;break}if(P.score=P.score*FV(s,y,Q),P.score<=i)break}P.suppressBeginIndex=I.length,z||(P.score===L?(I.push(F),C.push(P.score)):P.score>i&&MV(g,P,oS))}const k=I.length,N=t-k;h&&N>0&&(I.push(...new Array(N).fill(0)),C.push(...new Array(N).fill(0)));const R={selectedIndices:I};return c&&(R.selectedScores=C),f&&(R.validOutputs=k),R}function PV(n,e,t){const s=n.subarray(e*4,e*4+4),i=n.subarray(t*4,t*4+4),o=Math.min(s[0],s[2]),c=Math.min(s[1],s[3]),h=Math.max(s[0],s[2]),f=Math.max(s[1],s[3]),g=Math.min(i[0],i[2]),y=Math.min(i[1],i[3]),I=Math.max(i[0],i[2]),C=Math.max(i[1],i[3]),k=(h-o)*(f-c),N=(I-g)*(C-y);if(k<=0||N<=0)return 0;const R=Math.max(o,g),P=Math.max(c,y),L=Math.min(h,I),F=Math.min(f,C),W=Math.max(L-R,0)*Math.max(F-P,0);return W/(k+N-W)}function FV(n,e,t){const s=Math.exp(e*t*t);return t<=n?s:0}function oS(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/async function GV(n,e,t,s=.5,i=Number.NEGATIVE_INFINITY){const o=ae(n,"boxes","nonMaxSuppressionAsync"),c=ae(e,"scores","nonMaxSuppressionAsync"),h=ed(o,c,t,s,i);t=h.maxOutputSize,s=h.iouThreshold,i=h.scoreThreshold;const f=await Promise.all([o.data(),c.data()]),g=f[0],y=f[1],{selectedIndices:I}=_x(g,y,t,s,i);return o!==n&&o.dispose(),c!==e&&c.dispose(),oi(I,"int32")}const _V=GV;/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function VV(n,e,t,s=.5,i=Number.NEGATIVE_INFINITY,o=0){const c=ae(n,"boxes","nonMaxSuppression"),h=ae(e,"scores","nonMaxSuppression"),f=ed(c,h,t,s,i,o);t=f.maxOutputSize,s=f.iouThreshold,i=f.scoreThreshold,o=f.softNmsSigma;const g={boxes:c,scores:h},y={maxOutputSize:t,iouThreshold:s,scoreThreshold:i,softNmsSigma:o},I=de.runKernel(Lh,g,y);return{selectedIndices:I[0],selectedScores:I[1]}}const BV=me({nonMaxSuppressionWithScore_:VV});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/async function WV(n,e,t,s=.5,i=Number.NEGATIVE_INFINITY,o=0){const c=ae(n,"boxes","nonMaxSuppressionAsync"),h=ae(e,"scores","nonMaxSuppressionAsync"),f=ed(c,h,t,s,i,o);t=f.maxOutputSize,s=f.iouThreshold,i=f.scoreThreshold,o=f.softNmsSigma;const g=await Promise.all([c.data(),h.data()]),y=g[0],I=g[1],{selectedIndices:C,selectedScores:k}=Bx(y,I,t,s,i,o);return c!==n&&c.dispose(),h!==e&&h.dispose(),{selectedIndices:oi(C,"int32"),selectedScores:oi(k)}}const zV=WV;/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function XV(n,e,t,s=.5,i=Number.NEGATIVE_INFINITY,o=!1){const c=ae(n,"boxes","nonMaxSuppression"),h=ae(e,"scores","nonMaxSuppression"),f=ed(c,h,t,s,i,null),g=f.maxOutputSize,y=f.iouThreshold,I=f.scoreThreshold,C={boxes:c,scores:h},k={maxOutputSize:g,iouThreshold:y,scoreThreshold:I,padToMaxOutputSize:o},N=de.runKernel(Mh,C,k);return{selectedIndices:N[0],validOutputs:N[1]}}const ZV=me({nonMaxSuppressionPadded_:XV});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/async function KV(n,e,t,s=.5,i=Number.NEGATIVE_INFINITY,o=!1){const c=ae(n,"boxes","nonMaxSuppressionAsync"),h=ae(e,"scores","nonMaxSuppressionAsync"),f=ed(c,h,t,s,i,null),g=f.maxOutputSize,y=f.iouThreshold,I=f.scoreThreshold,[C,k]=await Promise.all([c.data(),h.data()]),{selectedIndices:N,validOutputs:R}=Vx(C,k,g,y,I,o);return c!==n&&c.dispose(),h!==e&&h.dispose(),{selectedIndices:oi(N,"int32"),validOutputs:hn(R,"int32")}}const $V=KV;/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function UV(n,e,t=!1,s=!1){const i=ae(n,"images","resizeBilinear");D(i.rank===3||i.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${i.rank}.`),D(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),D(s===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let o=i,c=!1;i.rank===3&&(c=!0,o=ge(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const h={images:o},f={alignCorners:t,halfPixelCenters:s,size:e},g=de.runKernel(Wl,h,f);return c?ge(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const lS=me({resizeBilinear_:UV});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function HV(n,e,t=!1,s=!1){const i=ae(n,"images","resizeNearestNeighbor");D(i.rank===3||i.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${i.rank}.`),D(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),D(i.dtype==="float32"||i.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),D(s===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let o=i,c=!1;i.rank===3&&(c=!0,o=ge(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const h={images:o},f={alignCorners:t,halfPixelCenters:s,size:e},g=de.runKernel(Gh,h,f);return c?ge(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const uS=me({resizeNearestNeighbor_:HV});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* https://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function jV(n,e="binary",t=!1,s=.5){const i=ae(n,"image","threshold"),o=.2989,c=.587,h=.114,f=i.shape[0]*i.shape[1];let g=pe(oi([s]),255),y,I,C,k;if(D(i.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${i.rank}.`),D(i.shape[2]===3||i.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${i.shape[2]}.`),D(i.dtype==="int32"||i.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${i.dtype}.`),D(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),i.shape[2]===3){[y,I,C]=ki(i,[1,1,1],-1);const R=pe(y,o),P=pe(I,c),L=pe(C,h);k=Ue(Ue(R,P),L)}else k=n;if(e==="otsu"){const R=HF(at(HC(k),"int32"),Ii([]),256);g=YV(R,f)}const N=t?Jh(k,g):Ti(k,g);return at(pe(N,255),"int32")}function YV(n,e){let t=oi([-1]),s=oi([0]),i=oi([0]),o,c,h,f,g,y;for(let I=0;I<n.size-1;I++){o=On(n,0,I+1),c=On(n,I+1),g=Et(It(o),e),y=Et(It(c),e);const C=It(pe(o,Rf(0,o.size)));h=Et(C,It(o));const k=O0(c.shape,o.size),N=Ue(Rf(0,c.size),k),R=pe(c,N);f=Et(It(R),It(c));const P=Nt(h,f),L=Nt(h,f),F=pe(g,y);i=pe(pe(F,P),L);const W=Ti(i,s);s=Es(W,i,s),t=Es(W,oi([I]),t)}return t}const QV=me({threshold_:jV});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function JV(n,e,t="nearest",s="constant",i=0,o){const c=ae(n,"image","transform","float32"),h=ae(e,"transforms","transform","float32");D(c.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${c.rank}.`),D(h.rank===2&&(h.shape[0]===c.shape[0]||h.shape[0]===1)&&h.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),D(o==null||o.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`);const f={image:c,transforms:h},g={interpolation:t,fillMode:s,fillValue:i,outputShape:o};return de.runKernel($l,f,g)}const qV=me({transform_:JV});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function eB(n,e,t){const s=ae(n,"a","bandPart");D(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const i=s.shape,[o,c]=s.shape.slice(-2);let h,f;typeof e=="number"?(D(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),D(e<=o,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`),h=ae(e<0?o:e,"numLower","bandPart")):(D(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),h=Es(V0(e,0),o,Nf(e,o))),typeof t=="number"?(D(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),D(t<=c,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${c}).`),f=ae(t<0?c:t,"numUpper","bandPart")):(D(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),f=Es(V0(t,0),c,Nf(t,c)));const g=ge(Rf(0,o,1,"int32"),[-1,1]),y=Rf(0,c,1,"int32"),I=Nt(g,y),C=nl(Jh(I,h),Ec(I,xr(f))),k=Zr([o,c],s.dtype);return ge(uo(Lc(ge(s,[-1,o,c])).map(N=>Es(C,N,k))),i)}const tB=me({bandPart_:eB});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function nB(n){let e;if(Array.isArray(n)){e=!1,D(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const i=n[0].shape[0];for(let o=1;o<n.length;++o)D(n[o].shape[0]===i,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[o].shape[0]} vs. ${i})`)}else e=!0,n=ki(n,n.shape[0],0).map(i=>Mf(i,[0]));D(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],s=n;for(let i=0;i<n.length;++i)t.push(de.tidy(()=>{let o=s[i];if(i>0)for(let c=0;c<i;++c){const h=pe(It(pe(t[c],o)),t[c]);o=Nt(o,h)}return Et(o,G0(o,"euclidean"))}));return e?uo(t,0):t}const rB=me({gramSchmidt_:nB});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sB(n,e=!1){if(D(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return cS(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((f,g)=>f*g),s=Lc(ge(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),i=[],o=[];s.forEach(f=>{const[g,y]=cS(f,e);i.push(g),o.push(y)});const c=ge(uo(i,0),n.shape),h=ge(uo(o,0),n.shape);return[c,h]}}function cS(n,e=!1){return de.tidy(()=>{D(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],s=n.shape[1];let i=DC(t),o=Cc(n);const c=Lx([[1]],[1,1]);let h=Cc(c);const f=t>=s?s:t;for(let g=0;g<f;++g){const y=o,I=h,C=i;[h,o,i]=de.tidy(()=>{const k=On(o,[g,g],[t-g,1]),N=G0(k),R=On(o,[g,g],[1,1]),P=Es(Ti(R,0),Lx([[-1]]),Lx([[1]])),L=Nt(R,pe(P,N)),F=Et(k,L);F.shape[0]===1?h=Cc(c):h=zs([c,On(F,[1,0],[F.shape[0]-1,F.shape[1]])],0);const W=xr(Et(cn(P,L),N)),z=On(o,[g,0],[t-g,s]),X=pe(W,h),Q=tn(h);if(g===0)o=Nt(z,cn(X,cn(Q,z)));else{const ie=Nt(z,cn(X,cn(Q,z)));o=zs([On(o,[0,0],[g,s]),ie],0)}const J=tn(X),te=On(i,[0,g],[t,i.shape[1]-g]);if(g===0)i=Nt(te,cn(cn(te,h),J));else{const ie=Nt(te,cn(cn(te,h),J));i=zs([On(i,[0,0],[t,g]),ie],1)}return[h,o,i]}),$t([y,I,C])}return!e&&t>s&&(i=On(i,[0,0],[t,s]),o=On(o,[0,0],[s,s])),[i,o]})}const iB=me({qr_:sB});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const rl={flipLeftRight:IV,grayscaleToRGB:SV,resizeNearestNeighbor:uS,resizeBilinear:lS,rgbToGrayscale:kV,rotateWithOffset:NV,cropAndResize:wV,nonMaxSuppression:RV,nonMaxSuppressionAsync:_V,nonMaxSuppressionWithScore:BV,nonMaxSuppressionWithScoreAsync:zV,nonMaxSuppressionPadded:ZV,nonMaxSuppressionPaddedAsync:$V,threshold:QV,transform:qV},aB={bandPart:tB,gramSchmidt:rB,qr:iB};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const oB=new Map,lB=new Map;class td{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class ta{constructor(){this.classNameMap={}}static getMap(){return ta.instance==null&&(ta.instance=new ta),ta.instance}static register(e){ta.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function Ze(n,e,t){D(n.className!=null,()=>"Class being registered does not have the static className property defined."),D(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),D(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const s=t,i=e+">"+s;return ta.register(n),oB.set(i,n),lB.set(n,i),n}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class ru extends td{minimize(e,t=!1,s){const{value:i,grads:o}=this.computeGradients(e,s);if(s!=null){const c=s.map(h=>({name:h.name,tensor:o[h.name]}));this.applyGradients(c)}else this.applyGradients(o);return $t(o),t?i:(i.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return gG(e,t)}dispose(){this.iterations_!=null&&$t(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:hn(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(ru,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class hS extends ru{static get className(){return"Adadelta"}constructor(e,t,s=null){super(),this.learningRate=e,this.rho=t,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=de.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,s)=>{const i=de.registeredVariables[t],o=!1;this.accumulatedGrads[s]==null&&(this.accumulatedGrads[s]={originalName:`${t}/accum_grad`,variable:ye(()=>en(i).variable(o))}),this.accumulatedUpdates[s]==null&&(this.accumulatedUpdates[s]={originalName:`${t}/accum_var`,variable:ye(()=>en(i).variable(o))});const c=Array.isArray(e)?e[s].tensor:e[t];if(c==null)return;const h=this.accumulatedGrads[s].variable,f=this.accumulatedUpdates[s].variable;ye(()=>{const g=Ue(pe(h,this.rho),pe(zn(c),1-this.rho)),y=pe(Et(Ns(Ue(f,this.epsilon)),Ns(Ue(h,this.epsilon))),c),I=Ue(pe(f,this.rho),pe(zn(y),1-this.rho));h.assign(g),f.assign(I);const C=Ue(pe(y,-this.learningRate),i);i.assign(C)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&($t(this.accumulatedGrads.map(e=>e.variable)),$t(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,t).map(i=>({originalName:i.name,variable:i.tensor.variable(s)})),this.accumulatedUpdates=e.slice(t,t*2).map(i=>({originalName:i.name,variable:i.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class dS extends ru{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,s)=>{const i=de.registeredVariables[t];this.accumulatedGrads[s]==null&&(this.accumulatedGrads[s]={originalName:`${t}/accumulator`,variable:ye(()=>O0(i.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[s].tensor:e[t];if(o==null)return;const c=this.accumulatedGrads[s].variable;ye(()=>{const h=Ue(c,zn(o));c.assign(h);const f=Ue(pe(Et(o,Ns(Ue(h,de.backend.epsilon()))),-this.learningRate),i);i.assign(f)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&$t(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class fS extends ru{static get className(){return"Adam"}constructor(e,t,s,i=null){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=i,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],ye(()=>{this.accBeta1=hn(t).variable(),this.accBeta2=hn(s).variable()}),i==null&&(this.epsilon=de.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);ye(()=>{const s=Nt(1,this.accBeta1),i=Nt(1,this.accBeta2);t.forEach((o,c)=>{const h=de.registeredVariables[o],f=!1;this.accumulatedFirstMoment[c]==null&&(this.accumulatedFirstMoment[c]={originalName:`${o}/m`,variable:ye(()=>en(h).variable(f))}),this.accumulatedSecondMoment[c]==null&&(this.accumulatedSecondMoment[c]={originalName:`${o}/v`,variable:ye(()=>en(h).variable(f))});const g=Array.isArray(e)?e[c].tensor:e[o];if(g==null)return;const y=this.accumulatedFirstMoment[c].variable,I=this.accumulatedSecondMoment[c].variable,C=Ue(pe(y,this.beta1),pe(g,1-this.beta1)),k=Ue(pe(I,this.beta2),pe(zn(g),1-this.beta2)),N=Et(C,s),R=Et(k,i);y.assign(C),I.assign(k);const P=Ue(pe(Et(N,Ue(Ns(R),this.epsilon)),-this.learningRate),h);h.assign(P)}),this.accBeta1.assign(pe(this.accBeta1,this.beta1)),this.accBeta2.assign(pe(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&$t(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&$t(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),ye(()=>{this.accBeta1.assign(Qh(this.beta1,this.iterations_+1)),this.accBeta2.assign(Qh(this.beta2,this.iterations_+1))});const t=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,t).map(i=>({originalName:i.name,variable:i.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(i=>({originalName:i.name,variable:i.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class pS extends ru{static get className(){return"Adamax"}constructor(e,t,s,i=null,o=0){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=i,this.decay=o,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],ye(()=>{this.iteration=hn(0).variable(),this.accBeta1=hn(t).variable()}),i==null&&(this.epsilon=de.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);ye(()=>{const s=Nt(1,this.accBeta1),i=Et(-this.learningRate,Ue(pe(this.iteration,this.decay),1));t.forEach((o,c)=>{const h=de.registeredVariables[o],f=!1;this.accumulatedFirstMoment[c]==null&&(this.accumulatedFirstMoment[c]={originalName:`${o}/m`,variable:en(h).variable(f)}),this.accumulatedWeightedInfNorm[c]==null&&(this.accumulatedWeightedInfNorm[c]={originalName:`${o}/v`,variable:en(h).variable(f)});const g=Array.isArray(e)?e[c].tensor:e[o];if(g==null)return;const y=this.accumulatedFirstMoment[c].variable,I=this.accumulatedWeightedInfNorm[c].variable,C=Ue(pe(y,this.beta1),pe(g,1-this.beta1)),k=pe(I,this.beta2),N=ks(g),R=tu(k,N);y.assign(C),I.assign(R);const P=Ue(pe(Et(i,s),Et(C,Ue(R,this.epsilon))),h);h.assign(P)}),this.iteration.assign(Ue(this.iteration,1)),this.accBeta1.assign(pe(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&$t(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&$t(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class zx extends ru{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,s)=>{const i=Array.isArray(e)?e[s].tensor:e[t];if(i==null)return;const o=de.registeredVariables[t];ye(()=>{const c=Ue(pe(this.c,i),o);o.assign(c)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Ci(hn(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class mS extends zx{static get className(){return"Momentum"}constructor(e,t,s=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=s,this.accumulations=[],this.m=hn(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,s)=>{const i=de.registeredVariables[t];this.accumulations[s]==null&&(this.accumulations[s]={originalName:`${t}/momentum`,variable:ye(()=>en(i).variable(!1))});const o=this.accumulations[s].variable,c=Array.isArray(e)?e[s].tensor:e[t];c!=null&&ye(()=>{let h;const f=Ue(pe(this.m,o),c);this.useNesterov?h=Ue(pe(this.c,Ue(c,pe(f,this.m))),i):h=Ue(pe(this.c,f),i),o.assign(f),i.assign(h)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&$t(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class gS extends ru{static get className(){return"RMSProp"}constructor(e,t=.9,s=0,i=null,o=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=s,this.epsilon=i,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=o,i==null&&(this.epsilon=de.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,s)=>{const i=de.registeredVariables[t],o=!1;this.accumulatedMeanSquares[s]==null&&(this.accumulatedMeanSquares[s]={originalName:`${t}/rms`,variable:ye(()=>en(i).variable(o))}),this.accumulatedMoments[s]==null&&(this.accumulatedMoments[s]={originalName:`${t}/momentum`,variable:ye(()=>en(i).variable(o))}),this.accumulatedMeanGrads[s]==null&&this.centered&&(this.accumulatedMeanGrads[s]={originalName:`${t}/mg`,variable:ye(()=>en(i).variable(o))});const c=Array.isArray(e)?e[s].tensor:e[t];if(c==null)return;const h=this.accumulatedMeanSquares[s].variable,f=this.accumulatedMoments[s].variable;ye(()=>{const g=Ue(pe(h,this.decay),pe(zn(c),1-this.decay));if(this.centered){const y=this.accumulatedMeanGrads[s].variable,I=Ue(pe(y,this.decay),pe(c,1-this.decay)),C=Et(pe(c,this.learningRate),Ns(Nt(g,Ue(zn(I),this.epsilon)))),k=Ue(pe(f,this.momentum),C);h.assign(g),y.assign(I),f.assign(k);const N=Nt(i,k);i.assign(N)}else{const y=Ue(pe(h,this.decay),pe(zn(c),1-this.decay)),I=Ue(pe(f,this.momentum),Et(pe(c,this.learningRate),Ns(Ue(y,this.epsilon))));h.assign(y),f.assign(I);const C=Nt(i,I);i.assign(C)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&$t(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&$t(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&$t(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,t).map(i=>({originalName:i.name,variable:i.tensor.variable(s)})),this.accumulatedMoments=e.slice(t,t*2).map(i=>({originalName:i.name,variable:i.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(i=>({originalName:i.name,variable:i.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}/**
* @license
* Copyright 2022 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const uB=[hS,dS,fS,pS,mS,gS,zx];function cB(){for(const n of uB)Ze(n)}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/let Dc;function hB(n,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let t=!1,s=!1,i=!1,o=!1,c=!1,h=!1;if(n.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)s=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)o=!0;else if(n.getContext!=null)c=!0;else if(typeof ImageBitmap<"u"&&n instanceof ImageBitmap)h=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${n.constructor.name}`);if(ce(S,de.backendName)!=null){const C={pixels:n},k={numChannels:e};return de.runKernel(S,C,k)}const[f,g]=i?[n.videoWidth,n.videoHeight]:[n.width,n.height];let y;if(c)y=n.getContext("2d").getImageData(0,0,f,g).data;else if(s||t)y=n.data;else if(o||i||h){if(Dc==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")Dc=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else Dc=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Dc.canvas.width=f,Dc.canvas.height=g,Dc.drawImage(n,0,0,f,g),y=Dc.getImageData(0,0,f,g).data}let I;if(e===4)I=new Int32Array(y);else{const C=f*g;I=new Int32Array(C*e);for(let k=0;k<C;k++)for(let N=0;N<e;++N)I[k*e+N]=y[k*4+N]}return Q_(I,[g,f,e],"int32")}const dB=me({fromPixels_:hB});function Xx(n,e){const t=n.shape.length,s=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${t}`);if(H(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const i=e.shape,o=i[i.length-1];let c=1;for(let I=0;I<i.length-1;++I)c*=i[I];const h=n.shape,f=i.slice();f.pop();let g=1;for(let I=o;I<t;++I)g*=h[I],f.push(h[I]);const y=[...We(n.shape).map(I=>I/g),1].slice(0,o);return[f,c,g,y]}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Zx=-2,fB=-1;function Kx(n,e,t){const s=n.shape.length;D(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),D(s===t.length,()=>`Error in slice${s}D: Length of size ${t} must match the rank of the array (${s}).`);for(let i=0;i<s;++i)D(e[i]+t[i]<=n.shape[i],()=>`Error in slice${s}D: begin[${i}] + size[${i}] (${e[i]+t[i]}) would overflow input.shape[${i}] (${n.shape[i]})`)}function pB(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function $x(n,e,t){const s=[];for(let i=0;i<n.length;i++)s[i]=Math.ceil((e[i]-n[i])/t[i]);return s}function xS(n,e,t,s){const i=[...n];for(let o=i.length;o<s.length;o++)i.push(1);for(let o=0;o<t;o++)o===0?i[e]=1:(i.splice(e,0,1),i.pop());return i}function yS(n,e,t){return t<=n?t:t-(e-1)}function bS(n,e){const t=[];for(let s=0;s<n;s++)t.push(e+s);return t}function mB(n,e,t,s,i,o,c,h,f){const g=n.length;let y=new Array(g),I=new Array(g),C=new Array(g);if(e.length&&t>0){const k=e[0],N=t+1;y=wS(c,k,N,s,n),I=vS(h,k,N,i,n),C=xS(o,k,N,n)}else for(let k=0;k<g;k++)y[k]=CS(c,s,o,n,k,f),I[k]=SS(h,i,o,n,k,f),C[k]=IS(o,k,f);return{begin:y,end:I,strides:C}}function wS(n,e,t,s,i){const o=[...i],c=bS(t,e);for(let h=0;h<o.length;h++)if(c.indexOf(h)>-1)o[h]=0;else{const f=yS(e,t,h);let g=s[f];n&1<<f&&(g=0),o[h]=g}return o}function vS(n,e,t,s,i){const o=[...i],c=bS(t,e);for(let h=0;h<o.length;h++)if(c.indexOf(h)>-1)o[h]=Number.MAX_SAFE_INTEGER;else{const f=yS(e,t,h);let g=s[f];n&1<<f&&(g=Number.MAX_SAFE_INTEGER),o[h]=g}for(let h=0;h<o.length;h++){const f=i[h];o[h]<0&&(o[h]+=f),o[h]=M(0,o[h],i[h])}return o}function IS(n,e,t){let s=n[e];return(t&1<<e||s==null)&&(s=1),s}function CS(n,e,t,s,i,o){let c=e[i];const h=t[i]||1;(n&1<<i||o&1<<i||c==null)&&(h>0?c=Number.MIN_SAFE_INTEGER:c=Number.MAX_SAFE_INTEGER);const f=s[i];return c<0&&(c+=f),c=M(0,c,f-1),c}function SS(n,e,t,s,i,o){let c=e[i];const h=t[i]||1;(n&1<<i||o&1<<i||c==null)&&(h>0?c=Number.MAX_SAFE_INTEGER:c=Number.MIN_SAFE_INTEGER);const f=s[i];return c<0&&(c+=f),h>0?c=M(0,c,f):c=M(-1,c,f-1),c}function Ux(n,e,t){let s=t.length;for(let i=0;i<t.length;i++)if(t[i]>1){s=i;break}for(let i=s+1;i<t.length;i++)if(e[i]>0||t[i]!==n[i])return!1;return!0}function Hx(n,e){let t=n.length>0?n[n.length-1]:1;for(let s=0;s<n.length-1;s++)t+=n[s]*e[s];return t}function X0(n,e,t){let s;const i=n.shape.length;typeof e=="number"?s=[e,...new Array(i-1).fill(0)]:e.length<i?s=e.concat(new Array(i-e.length).fill(0)):s=e.slice(),s.forEach(c=>{D(c!==-1,()=>"slice() does not support negative begin indexing.")});let o;return t==null?o=new Array(i).fill(-1):typeof t=="number"?o=[t,...new Array(i-1).fill(-1)]:t.length<i?o=t.concat(new Array(i-t.length).fill(-1)):o=t,o=o.map((c,h)=>c>=0?c:(D(c===-1,()=>`Negative size values should be exactly -1 but got ${c} for the slice() size at index ${h}.`),n.shape[h]-s[h])),[s,o]}function jx(n,e,t,s,i,o,c,h,f){let g;if(s==null?(g=new Array(e.length),g.fill(1)):g=s,c!=null&&c&c-1)throw new Error("Multiple ellipses in slice is not allowed.");let y=!1;const I={dims:g.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:g.slice(),beginMask:i,endMask:o,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:f};for(let F=0;F<I.dims;F++)y&&1<<F&h&&I.numAddAxisAfterEllipsis++,1<<F&c&&(y=!0);y||(I.ellipsisMask|=1<<I.dims,I.dims++);const C={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};gB(I,C);let k=!0,N=!0,R=!0;const P=[],L=[];for(let F=0;F<n.length;++F){if(C.strides[F]===0)throw Error(`strides[${F}] must be non-zero`);const W=!!(C.shrinkAxisMask&1<<F),z=n[F];if(z===-1){P.push(W?1:-1);continue}const X=[C.beginMask&1<<F,C.endMask&1<<F],Q=[C.strides[F]>0?0:-1,C.strides[F]>0?z:z-1];if(W&&C.strides[F]<=0)throw Error("only stride 1 allowed on non-range indexing.");R=R&&C.strides[F]===1;const J=!!(C.beginMask&1<<F&&C.endMask&1<<F);if(C.beginValid&&C.endValid){if(W){const Ce=C.begin[F]<0?z+C.begin[F]:C.begin[F];if(C.begin[F]=Ce,C.end[F]=C.begin[F]+1,Ce<0||Ce>=z)throw Error(`slice index ${C.begin[F]} of dimension ${F} out of bounds.`)}else C.begin[F]=TS(C.begin[F],0,C.strides[F],z,X,Q),C.end[F]=TS(C.end[F],1,C.strides[F],z,X,Q);const oe=C.strides[F]===1&&C.begin[F]===0&&C.end[F]===z;k=k&&oe,N=N&&(F===0&&C.strides[F]===1||oe)}else k=k&&C.strides[F]===1&&J,N=N&&(F===0&&C.strides[F]===1||J);let te,ie=!1;if(C.beginValid&&C.endValid?(te=C.end[F]-C.begin[F],ie=!0):W?(te=1,ie=!0):J&&z>=0&&(C.strides[F]<0?te=-z:te=z,ie=!0),ie){let oe;te===0||te<0!=C.strides[F]<0?oe=0:oe=Math.trunc(te/C.strides[F])+(te%C.strides[F]!==0?1:0),P.push(oe)}else P.push(-1)}for(let F=0;F<C.finalShapeGatherIndices.length;++F){const W=C.finalShapeGatherIndices[F];W>=0?L.push(P[W]):W===Zx&&L.push(1)}return{finalShapeSparse:L.filter((F,W)=>C.finalShapeGatherIndices[W]!==Zx),finalShape:L,isIdentity:k,sliceDim0:N,isSimpleSlice:R,begin:C.begin,end:C.end,strides:C.strides}}function gB(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<n.dims;s++)if(1<<s&n.ellipsisMask){const i=Math.min(e.dims-(n.dims-s)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<i;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=s}else if(1<<s&n.newAxisMask)e.finalShapeGatherIndices.push(Zx),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[s]),n.end!=null&&(e.end[t]=n.end[s]),e.strides[t]=n.strides[s],n.beginMask&1<<s&&(e.beginMask|=1<<t),n.endMask&1<<s&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(fB),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[t]=s,t++}}function TS(n,e,t,s,i,o){if(i[e])return t>0?o[e]:o[e+1&1];{const c=n<0?s+n:n;return c<o[0]?o[0]:c>o[1]?o[1]:c}}const xB=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:Kx,computeFlatOffset:Hx,computeOutShape:$x,getNormalizedAxes:mB,isSliceContinous:Ux,maskToAxes:pB,parseSliceParams:X0,sliceInfo:jx,startForAxis:CS,startIndicesWithElidedDims:wS,stopForAxis:SS,stopIndicesWithElidedDims:vS,stridesForAxis:IS,stridesWithElidedDims:xS},Symbol.toStringTag,{value:"Module"}));/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class yB{static sgd(e){return new zx(e)}static momentum(e,t,s=!1){return new mS(e,t,s)}static rmsprop(e,t=.9,s=0,i=null,o=!1){return new gS(e,t,s,i,o)}static adam(e=.001,t=.9,s=.999,i=null){return new fS(e,t,s,i)}static adadelta(e=.001,t=.95,s=null){return new hS(e,t,s)}static adamax(e=.002,t=.9,s=.999,i=null,o=0){return new pS(e,t,s,i,o)}static adagrad(e,t=.1){return new dS(e,t)}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const nd=yB;/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const bB=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function Z0(){return new Promise(n=>bB(()=>n()))}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Yx(n,e){const t=n[0].length;n.forEach((i,o)=>{D(i.length===t,()=>`Error in concat${t}D: rank of tensors[${o}] must be the same as the rank of the rest (${t})`)}),D(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const s=n[0];n.forEach((i,o)=>{for(let c=0;c<t;c++)D(c===e||i[c]===s[c],()=>`Error in concat${t}D: Shape of tensors[${o}] (${i}) does not match the shape of the rest (${s}) along the non-concatenated axis ${o}.`)})}function co(n,e){const t=n[0].slice();for(let s=1;s<n.length;s++)t[e]+=n[s][e];return t}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var Ra;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(Ra||(Ra={}));function kS(n,e,t){let s=new Array;if(t==null&&e==null)return s;if(e==null)for(;s.length<n+t.length;)s.push(-1);else s=e.slice();if(t==null)return s;if(n+t.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${s.length}`);for(let i=1;i<t.length;++i){const o=t[i],c=s[s.length-t.length+i],h=s[c];if(o>=0)if(h>=0){if(h!==o)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${i+n}] = ${o} but shape[${i+n}] = ${h}`)}else s[c]=o}return s}function ES(n){const e={FIRST_DIM_SIZE:Ra.FIRST_DIM_SIZE,VALUE_ROWIDS:Ra.VALUE_ROWIDS,ROW_LENGTHS:Ra.ROW_LENGTHS,ROW_SPLITS:Ra.ROW_SPLITS,ROW_LIMITS:Ra.ROW_LIMITS,ROW_STARTS:Ra.ROW_STARTS},t=[];for(const s of n)if(s in e)t.push(e[s]);else break;return t}function NS(n){return n.length===0?0:n[0]===Ra.FIRST_DIM_SIZE?n.length-1:n.length}function AS(n,e){if(n==null||e==null)return;const t=n.length,s=e.length;if(t>=s)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${s})`);for(let i=0;i<Math.min(t,s-1);++i){const o=n[i],c=e[i+1];if(o>=0&&c>=0&&o!==1&&o!==c)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${i-n.length}] = ${o} but ragged tensor input.flatValues.shape[${i-n.length}] = ${c}`)}}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Qx=30;function K0(n){return n<=Qx?n:xt(n,Math.floor(Math.sqrt(n)))}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Jx(n,e,t){const s=t*(typeof n=="number"?n:n[0]),i=e*(typeof n=="number"?n:n[1]);return[s,i]}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Df(n,e,t,s=!0){let i=[];if(s)i=i.concat(e.slice(0)),i.push(n[0]/t),i=i.concat(n.slice(1));else{i=i.concat(n[0]);const o=e.length;for(let c=0;c<o;++c)i=i.concat([n[c+1]/e[c],e[c]]);i=i.concat(n.slice(o+1))}return i}function Of(n,e,t=!0){const s=[];if(t){s.push(e);for(let i=e+1;i<n;++i)i<=2*e?(s.push(i),s.push(i-(e+1))):s.push(i)}else{const i=[],o=[];for(let c=1;c<n;++c)c>=e*2+1||c%2===1?o.push(c):i.push(c);s.push(...i),s.push(0),s.push(...o)}return s}function Pf(n,e,t,s=!0){const i=[];s?i.push(n[0]/t):i.push(n[0]*t);for(let o=1;o<n.length;++o)o<=e.length?s?i.push(e[o-1]*n[o]):i.push(n[o]/e[o-1]):i.push(n[o]);return i}function qx(n,e){const t=[0];for(let s=0;s<e;++s)t.push(n[s][0]);return t}function ey(n,e,t){const s=n.slice(0,1);for(let i=0;i<t;++i)s.push(n[i+1]-e[i][0]-e[i][1]);return s}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const $0=1.7580993408473768,U0=1.0507009873554805;/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ty=.3275911,ny=.254829592,ry=-.284496736,sy=1.421413741,iy=-1.453152027,ay=1.061405429;/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sl(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let s=0;s<t.length;s+=2)t[s]=n[s/2],t[s+1]=e[s/2];return t}function RS(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let s=0;s<n.length;s+=2)e[s/2]=n[s],t[s/2]=n[s+1];return{real:e,imag:t}}function MS(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let i=0;i<n.length;i+=4)t[Math.floor(i/4)]=n[i],s[Math.floor(i/4)]=n[i+1];return{real:t,imag:s}}function LS(n){const e=Math.floor(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let i=2;i<n.length;i+=4)t[Math.floor(i/4)]=n[i],s[Math.floor(i/4)]=n[i+1];return{real:t,imag:s}}function oy(n,e){const t=n[e*2],s=n[e*2+1];return{real:t,imag:s}}function DS(n,e,t,s){n[s*2]=e,n[s*2+1]=t}function OS(n,e){const t=new Float32Array(n/2),s=new Float32Array(n/2);for(let i=0;i<Math.ceil(n/2);i++){const o=(e?2:-2)*Math.PI*(i/n);t[i]=Math.cos(o),s[i]=Math.sin(o)}return{real:t,imag:s}}function PS(n,e,t){const s=(t?2:-2)*Math.PI*(n/e),i=Math.cos(s),o=Math.sin(s);return{real:i,imag:o}}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ly="->",wB=/->/g,FS=",",GS="...";function uy(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(wB,"").length)/ly.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${ly}").`);const[s,i]=n.split(ly);D(s.indexOf(GS)===-1,()=>`The ellipsis notation ("${GS}") is not supported yet.`);const o=s.split(FS),c=o.length;if(e!==c)throw new Error(`Expected ${c} input tensors, received ${e}`);if(c>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const h=[];for(let C=0;C<i.length;++C){const k=i[C];if(!o.some(N=>N.indexOf(k)!==-1))throw new Error(`Output subscripts contain the label ${k} not present in the input subscripts.`);h.indexOf(k)===-1&&h.push(k)}for(let C=0;C<s.length;++C){const k=s[C];h.indexOf(k)===-1&&k!==FS&&h.push(k)}const f=new Array(o.length);for(let C=0;C<c;++C){if(new Set(o[C].split("")).size!==o[C].length)throw new Error(`Found duplicate axes in input component ${o[C]}. Support for duplicate axes in input is not implemented yet.`);f[C]=[];for(let k=0;k<o[C].length;++k)f[C].push(h.indexOf(o[C][k]))}const g=h.length,y=i.length,I=[];for(let C=y;C<g;++C)I.push(C);return{allDims:h,summedDims:I,idDims:f}}function cy(n,e){let t=new Array(n);t.fill(-1);for(let i=0;i<e.length;++i)t[e[i]]=i;const s=[];for(let i=0;i<n;++i)t[i]===-1&&s.push(i);return t=t.filter(i=>i!==-1),{permutationIndices:t,expandDims:s}}function hy(n,e,t){const s=new Array(n);for(let i=0;i<t.length;++i){const o=t[i].shape;for(let c=0;c<e[i].length;++c)s[e[i][c]]===void 0?s[e[i][c]]=o[c]:D(s[e[i][c]]===o[c],()=>`Expected dimension ${s[e[i][c]]} at axis ${c} of input shaped ${JSON.stringify(o)}, but got dimension ${o[c]}`)}}function dy(n,e){const t=n,s=[];let i=0;n.length===0&&t.push(-1),i=n.length+1;for(let c=0;c<i;++c)s.push([]);const o=[];for(let c=0;c<t.length;++c){const h=t[c],f=vB(e,h);for(const g of f)o.indexOf(g)===-1&&(s[c].push(g),o.push(g))}return{path:t,steps:s}}function fy(n){return n.every((e,t)=>e===t)}function vB(n,e){const t=[];for(let s=0;s<n.length;++s)(n[s].length===0||n[s].indexOf(e)!==-1||e===-1)&&t.push(s);return t}function py(n,e,t=0){let s=[];if(typeof e=="number")D(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(n.shape[t]/e);else{const i=e.reduce((c,h)=>(h===-1&&(c+=1),c),0);D(i<=1,()=>"There should be only one negative value in split array.");const o=e.indexOf(-1);if(o!==-1){const c=e.reduce((h,f)=>f>0?h+f:h);e[o]=n.shape[t]-c}D(n.shape[t]===e.reduce((c,h)=>c+h),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _S(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function VS(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function BS(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function WS(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function zS(n,e){return`size ${n} must be non-negative, not ${e}`}function XS(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function ZS(n,e){const t=H(n),s=H(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${n} outputShape= ${e}`}function KS(n,e){const t=H(n),s=H(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${s}. inputShape=${n} outputShape=${e}`}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function my(){return"segment ids must be >= 0"}function $S(){return"segment ids are not increasing"}function US(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function HS(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function jS(n,e){let t=!1,s;for(n<=Qx?(s=n,t=!0):s=xt(n,Math.floor(Math.sqrt(n)));!t;)s>e||s===n?t=!0:s=xt(n,s+1);return s}function YS(n,e,t){const s=[],i=n.length;for(let o=0;o<i;o++)o!==e?s.push(n[o]):s.push(t);return s}function gy(n,e,t,s){const i=e.shape.length,o=n.shape.length;if(s!==0&&(s<-i||s>i))throw new Error(`Expect batchDims in the range of [-${i}, ${i}], but got ${s}`);if(s<0&&(s+=i),s>o)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${o}).`);if(t<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${t}).`);for(let I=0;I<s;++I)if(n.shape[I]!==e.shape[I])throw new Error(`x.shape[${I}]: ${n.shape[I]} should be equal to indices.shape[${I}]: ${e.shape[I]}.`);const c=n.shape[t],h=[];let f=1,g=1,y=1;for(let I=0;I<s;++I)h.push(n.shape[I]),f*=n.shape[I];for(let I=s;I<t;I++)h.push(n.shape[I]),g*=n.shape[I];for(let I=s;I<i;I++)h.push(e.shape[I]);for(let I=t+1;I<o;I++)h.push(n.shape[I]),y*=n.shape[I];return{batchSize:f,sliceSize:y,outerSize:g,dimSize:c,outputShape:h}}const IB=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:gy,computeOutShape:YS,segOpComputeOptimalWindowSize:jS},Symbol.toStringTag,{value:"Module"}));/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function il(n){try{return n.map(e=>Yl(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function QS(n){return n.map(e=>jl(e))}const CB=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:ny,ERF_A2:ry,ERF_A3:sy,ERF_A4:iy,ERF_A5:ay,ERF_P:ty,PARALLELIZE_THRESHOLD:Qx,get RowPartitionType(){return Ra},SELU_SCALE:U0,SELU_SCALEALPHA:$0,applyActivation:Fx,assertAndGetBroadcastShape:Ft,assertAxesAreInnerMostDims:rs,assertParamsConsistent:Yx,assignToTypedArray:DS,axesAreInnerMostDims:xx,calculateShapes:Mc,checkEinsumDimSizes:hy,checkPadOnDimRoundingMode:Ws,combineLocations:MC,combineRaggedTensorToTensorShapes:kS,complexWithEvenIndex:MS,complexWithOddIndex:LS,computeConv2DInfo:ns,computeConv3DInfo:ql,computeDefaultPad:lx,computeDilation2DInfo:If,computeOptimalWindowSize:K0,computeOutAndReduceShapes:Xr,computeOutShape:co,computePool2DInfo:qi,computePool3DInfo:el,convertConv2DDataFormat:tl,decodeEinsumEquation:uy,eitherStridesOrDilationsAreOne:ds,expandShapeToKeepDim:kr,exponent:PS,exponents:OS,fromStringArrayToUint8:QS,fromUint8ToStringArray:il,getAxesPermutation:er,getBroadcastDims:Yh,getComplexWithIndex:oy,getEinsumComputePath:dy,getEinsumPermutation:cy,getFusedBiasGradient:Px,getFusedDyActivation:Ox,getImageCenter:Jx,getInnerMostAxes:gr,getPermuted:Of,getRaggedRank:NS,getReductionAxes:Lr,getReshaped:Df,getReshapedPermuted:Pf,getRowPartitionTypesHelper:ES,getSliceBeginCoords:qx,getSliceSize:ey,getSparseFillEmptyRowsIndicesDenseShapeMismatch:_S,getSparseFillEmptyRowsNegativeIndexErrorMessage:VS,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:BS,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:XS,getSparseReshapeInputOutputMismatchErrorMessage:KS,getSparseReshapeInputOutputMultipleErrorMessage:ZS,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:WS,getSparseReshapeNegativeOutputDimErrorMessage:zS,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:HS,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:my,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:$S,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:US,getUndoAxesPermutation:eu,isIdentityPermutation:fy,log:U,mergeRealAndImagArrays:sl,prepareAndValidate:Xx,prepareSplitSize:py,segment_util:IB,shouldFuse:Gx,slice_util:xB,splitRealAndImagArrays:RS,stridesOrDilationsArePositive:Tc,tupleValuesAreOne:Sc,upcastType:ai,validateDefaultValueShape:AS,validateInput:J_,validateUpdateShape:nS,warn:Z},Symbol.toStringTag,{value:"Module"}));/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/cB();/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const JS={kernelName:Qu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>pe(n,Lf(at(t,"float32"),-1))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const SB={kernelName:_s,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=zn(at(t,"float32")),i=Ns(Nt(hn(1),s));return xr(Et(n,i))}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const TB={kernelName:Fo,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Ns(Nt(zn(at(t,"float32")),1));return Et(n,s)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const kB={kernelName:Yr,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,i=Ft(t.shape,s.shape);return{a:()=>{let o=n;const c=Lr(t.shape,i);return c.length>0&&(o=It(o,c)),ge(o,t.shape)},b:()=>{let o=n;const c=Lr(s.shape,i);return c.length>0&&(o=It(o,c)),ge(o,s.shape)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const EB={kernelName:vh,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((s,i)=>{t[i]=()=>n.clone()}),t}};/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const NB={kernelName:Ju,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>en(t)}}};/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const AB={kernelName:Go,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>en(t)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const RB={kernelName:qu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Et(n,Ns(Nt(hn(1),zn(at(t,"float32")))))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const MB={kernelName:_n,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Ns(Ue(hn(1),zn(at(t,"float32"))));return Et(n,s)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const LB={kernelName:on,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,i=Ft(t.shape,s.shape);return{a:()=>{const o=Ue(zn(t),zn(s));let c=pe(n,Et(s,o));const h=Lr(t.shape,i);return h.length>0&&(c=It(c,h)),ge(c,t.shape)},b:()=>{const o=Ue(zn(t),zn(s));let c=xr(pe(n,Et(t,o)));const h=Lr(s.shape,i);return h.length>0&&(c=It(c,h)),ge(c,s.shape)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const DB={kernelName:et,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Et(n,Ue(zn(at(t,"float32")),1))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const OB={kernelName:Un,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Et(n,Nt(hn(1),zn(at(t,"float32"))))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function PB(n,e,t,s,i,o){const c=ae(n,"dy","avgPool3dGrad"),h=ae(e,"input","avgPool3dGrad");let f=c,g=h,y=!1;h.rank===4&&(y=!0,f=ge(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),g=ge(h,[1,h.shape[0],h.shape[1],h.shape[2],h.shape[3]])),D(f.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${f.rank}.`),D(g.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${g.rank}.`),Ws("avgPool3dGrad",i,o);const I={dy:f,input:g},C={filterSize:t,strides:s,pad:i,dimRoundingMode:o},k=de.runKernel(Ih,I,C);return y?ge(k,[k.shape[1],k.shape[2],k.shape[3],k.shape[4]]):k}const FB=me({avgPool3dGrad_:PB});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const GB={kernelName:Rl,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:i,strides:o,pad:c,dimRoundingMode:h}=t;return{x:()=>FB(n,s,i,o,c,h)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _B(n,e,t,s,i){const o=ae(n,"dy","avgPoolGrad"),c=ae(e,"input","avgPoolGrad");D(c.rank===o.rank,()=>`Rank of input (${c.rank}) does not match rank of dy (${o.rank})`);let h=c,f=o,g=!1;c.rank===3&&(g=!0,h=ge(c,[1,c.shape[0],c.shape[1],c.shape[2]]),f=ge(o,[1,o.shape[0],o.shape[1],o.shape[2]])),D(f.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${f.rank}.`),D(h.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${h.rank}.`);const y={dy:f,input:h},I={filterSize:t,strides:s,pad:i},C=de.runKernel(_o,y,I);return g?ge(C,[C.shape[1],C.shape[2],C.shape[3]]):C}const VB=me({avgPoolGrad_:_B});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const BB={kernelName:Nn,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:i,strides:o,pad:c}=t;return{x:()=>VB(n,s,i,o,c)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const WB={kernelName:Qt,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[s,i]=e,{transposeA:o,transposeB:c}=t;return!o&&!c?{a:()=>cn(n,i,!1,!0),b:()=>cn(s,n,!0,!1)}:!o&&c?{a:()=>cn(n,i,!1,!1),b:()=>cn(n,s,!0,!1)}:o&&!c?{a:()=>cn(i,n,!1,!0),b:()=>cn(s,n,!1,!1)}:{a:()=>cn(i,n,!0,!0),b:()=>cn(n,s,!0,!0)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const zB={kernelName:Xi,gradFunc:(n,e,t)=>{const{blockShape:s,crops:i}=t;return{x:()=>Tx(n,s,i)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const XB={kernelName:gi,gradFunc:(n,e,t)=>{const s=t,i=s.inputShape,o=s.shape,c=Array.from(o);for(let f=i.length-1;f>=0;f--)if(i[f]===o[f])c[f]=1;else if(i[f]!==1)throw new Error(`broadcastTo(): [${i}] cannot be broadcast to [${o}].`);const h=[];for(let f=0;f<c.length;f++)c[f]>1&&h.push(f);return{x:()=>It(n,h,!0)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ZB={kernelName:dr,gradFunc:n=>({x:()=>n.clone()})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const KB={kernelName:Zi,gradFunc:n=>({x:()=>en(n)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const $B={kernelName:Qa,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{clipValueMin:i,clipValueMax:o}=t;return{x:()=>Es(nl(Ec(s,i),Jh(s,o)),n,en(n))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const UB={kernelName:kh,inputsToSave:["x"],gradFunc:JS.gradFunc};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const HB={kernelName:Ki,saveAllInputs:!0,gradFunc:(n,e,t)=>{const s=e.map(h=>h.shape),{axis:i}=t,o=be(i,e[0].shape)[0],c=s.map(h=>h[o]);return ki(n,c,o).map(h=>()=>h)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const jB={kernelName:Ml,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,i]=e,{dilations:o,strides:c,pad:h,dataFormat:f}=t;return D(Sc(o),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`),{x:()=>fx(s.shape,n,i,c,h,f),filter:()=>Dx(s,n,i.shape,c,h,f)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const YB={kernelName:$i,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[s,i]=e,{strides:o,pad:c,dataFormat:h,dimRoundingMode:f}=t;return{dy:()=>kc(n,i,o,c,h,1,f),filter:()=>Dx(n,s,i.shape,o,c,h,f)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function QB(n,e,t,s,i){let o=n;n.rank===4&&(o=ge(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let c=e;c.rank===4&&(c=ge(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),D(o.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${o.shape}.`),D(c.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${c.shape}.`),D(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),D(o.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${o.shape[4]}) must match input depth in filter (${t[3]}.`),D(c.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${c.shape[4]}) must match output depth for filter (${t[4]}).`);const h={x:o,dy:c},f={strides:s,pad:i,filterShape:t};return de.runKernel(lt,h,f)}const JB=me({conv3DBackpropFilter_:QB});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const qB={kernelName:us,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:i,pad:o}=t;D(Sc(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[c,h]=e;return{x:()=>EC(c.shape,n,h,i,o),filter:()=>JB(c,n,h.shape,i,o)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const eW={kernelName:Vo,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>pe(xr(JC(at(t,"float32"))),n)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const tW={kernelName:Rr,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>pe(qC(at(t,"float32")),n)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const nW={kernelName:Bo,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:i,exclusive:o,reverse:c}=t;return{x:()=>{const h=er([i],s.rank);let f=AC(n,i,o,!c);return h!=null&&(f=tn(f,h)),f}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const rW={kernelName:Eh,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:i,pad:o,dimRoundingMode:c}=t,h=s??[1,1];D(Sc(h),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${h}'`);const[f,g]=e;return D(f.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${f.rank}.`),D(g.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${g.rank}.`),D(f.shape[3]===g.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${f.shape[3]}) must match the inChannels dimension in filter ${g.shape[2]}.`),D(ds(i,h),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${i} and dilations '${h}'.`),Ws("depthwiseConv2d",o,c),{x:()=>xV(f.shape,n,g,i,o,h,c),filter:()=>mV(f,n,g.shape,i,o,h,c)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const sW={kernelName:ec,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,i]=e,o={x:s,filter:i,dy:n},c={x:s,filter:i,dy:n};return{x:()=>de.runKernel(Ui,o,t),filter:()=>de.runKernel(tc,c,t)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const iW={kernelName:Hi,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,s={dy:n,y:t};return{x:()=>de.runKernel(hf,s)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const aW={kernelName:Jt,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=pe(oo(xr(zn(t))),2/Math.sqrt(Math.PI));return{x:()=>pe(n,s)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const oW={kernelName:Wt,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>pe(n,t)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const lW={kernelName:Dl,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>ge(n,t.shape)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const uW={kernelName:Wo,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>pe(n,oo(t))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const cW={kernelName:sc,gradFunc:n=>({x:()=>en(n)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const hW={kernelName:Rn,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,i=Ft(t.shape,s.shape);return{a:()=>{const o=Et(n,at(s,"float32")),c=Lr(t.shape,i);return c.length>0?ge(It(o,c),t.shape):o},b:()=>{let o=pe(n,at(t,"float32"));const c=Lr(s.shape,i);c.length>0&&(o=ge(It(o,c),s.shape));const h=zn(s);return xr(Et(o,at(h,"float32")))}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const dW={kernelName:xi,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:s}=t,[i,o,c,h]=e,f=h??hn(1),g=Lr(o.shape,i.shape),y=[];if(o.rank===1){for(let R=0;R<i.shape.length-1;++R)y.push(i.shape[R]);y.push(1)}const I=Nt(i,o),C=pe(n,f),k=jC(Ue(c,hn(s))),N=pe(pe(pe(k,k),k),hn(-.5));return{x:()=>o.rank===1?ge(pe(pe(n,Aa(ge(k,[1,1,1,o.shape[0]]),y)),f),i.shape):ge(pe(pe(n,k),f),i.shape),mean:()=>{let R=pe(pe(k,hn(-1)),C);return o.rank===1&&(R=It(R,g)),ge(R,o.shape)},variance:()=>{let R=pe(pe(N,I),C);return o.rank===1&&(R=It(R,g)),ge(R,o.shape)},scale:()=>{const R=pe(I,k);let P=pe(n,R);return o.rank===1&&(P=It(P,g)),ge(P,o.shape)},offset:()=>{let R=n;return o.rank===1&&(R=It(R,g)),ge(R,o.shape)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const fW={kernelName:Nh,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[s,i]=e,{axis:o,batchDims:c}=t,h=be(o,s.shape)[0],f=(g,y,I)=>()=>{const C=g.shape,k=y.size,N=C.slice(0,h),R=N.length,P=C.slice(o,C.length).slice(1),L=P.length,F=qS(0,R),W=qS(R+1,R+1+L),z=eT([N,[k],P]),X=ge(I,z),Q=ge(y,[k]),J=eT([[R],F,W]),te=tn(X,J);let ie=sS(te,Q,g.shape[h]);const oe=eu(J);return ie=tn(ie,oe),ie};if(c===1){const g=s.shape[0],y=s.split(g,0);return{x:()=>uo(y.map((I,C)=>f(I,i.slice(C,1),n.slice(C,1))())).reshape(s.shape),indices:()=>i}}else return{x:f(s,i,n),indices:()=>i}}};function qS(n,e){const t=[];for(let s=n;s<e;++s)t.push(s);return t}function eT(n){const e=[];for(let t=0;t<n.length;++t)for(let s=0;s<n[t].length;++s)e.push(n[t][s]);return e}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const pW={kernelName:fr,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>en(t),b:()=>en(s)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const mW={kernelName:Ie,gradFunc:n=>({x:()=>at(n,"float32")})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const gW={kernelName:qn,gradFunc:n=>({x:()=>en(n)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const xW={kernelName:Jr,gradFunc:n=>({x:()=>en(n)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const yW={kernelName:ic,gradFunc:n=>({x:()=>en(n)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const bW={kernelName:Ol,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{alpha:i}=t,o=Ti(s,0);return{x:()=>Es(o,n,pe(n,i))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const wW={kernelName:ac,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Et(n,Ue(t,1))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const vW={kernelName:Pl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Et(n,at(t,"float32"))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const IW={kernelName:Zg,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{axis:i}=t;return{logits:()=>{const o=oo(s);return Nt(n,pe(It(n,i,!0),o))}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function CW(n,e,t,s=5,i=1,o=1,c=.5){const h={x:n,y:e,dy:t},f={depthRadius:s,bias:i,alpha:o,beta:c};return de.runKernel(Zo,h,f)}const SW=me({localResponseNormalizationBackprop_:CW});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const TW={kernelName:ir,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,i]=e,{depthRadius:o,bias:c,alpha:h,beta:f}=t;return{x:()=>SW(s,i,n,o,c,h,f)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tT(n,e,t,s){return e.rank<t.rank&&(e=ge(e,kr(e.shape,s))),n.rank<t.rank&&(n=ge(n,kr(n.shape,s))),{x:()=>pe(n,at(ao(t,e),n.dtype))}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const nT={kernelName:yi,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{reductionIndices:i}=s,o=e[0],c=e[1],h=be(i,o.shape),f=tT(n,c,o,h);return{x:()=>f.x()}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const kW={kernelName:Ct,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>pe(n,at(Ec(t,s),"float32")),b:()=>pe(n,at(V0(t,s),"float32"))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function EW(n,e,t,s,i,o,c){const h=ae(n,"dy","maxPool3dGrad"),f=ae(e,"input","maxPool3dGrad"),g=ae(t,"output","maxPool3dGrad");let y=h,I=f,C=g,k=!1;f.rank===4&&(k=!0,y=ge(h,[1,h.shape[0],h.shape[1],h.shape[2],h.shape[3]]),I=ge(f,[1,f.shape[0],f.shape[1],f.shape[2],f.shape[3]]),C=ge(g,[1,g.shape[0],g.shape[1],g.shape[2],g.shape[3]])),D(y.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${y.rank}.`),D(I.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${I.rank}.`),D(C.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${C.rank}.`),Ws("maxPool3dGrad",o,c);const N={dy:y,input:I,output:C},R={filterSize:s,strides:i,pad:o,dimRoundingMode:c},P=de.runKernel(df,N,R);return k?ge(P,[P.shape[1],P.shape[2],P.shape[3],P.shape[4]]):P}const NW=me({maxPool3dGrad_:EW});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const AW={kernelName:pr,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,i]=e,{filterSize:o,strides:c,pad:h,dimRoundingMode:f}=t;return{x:()=>NW(n,s,i,o,c,h,f)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function RW(n,e,t,s,i,o,c){const h=ae(n,"dy","maxPoolGrad"),f=ae(e,"input","maxPoolGrad"),g=ae(t,"output","maxPoolGrad");D(f.rank===h.rank,()=>`Rank of input (${f.rank}) does not match rank of dy (${h.rank})`),D(h.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${h.rank}.`),D(f.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${f.rank}.`),Ws("maxPoolGrad",o,c);const y={dy:h,input:f,output:g},I={filterSize:s,strides:i,pad:o,dimRoundingMode:c};return de.runKernel(Ot,y,I)}const MW=me({maxPoolGrad_:RW});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const LW={kernelName:Ah,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,i]=e,{filterSize:o,strides:c,pad:h}=t;return{x:()=>MW(n,s,i,o,c,h)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const DW={kernelName:oc,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:i}=t,o=be(i,s.shape),c=Xr(s.shape,o)[1],h=H(c);return{x:()=>{const f=s.shape.slice();o.forEach(y=>{f[y]=1});const g=ge(n,f);return Et(pe(g,nu(s.shape,"float32")),h)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const OW={kernelName:Yi,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{axis:i}=s,[o,c]=e,h=be(i,o.shape),f=tT(n,c,o,h);return{x:()=>f.x()}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const PW={kernelName:lc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>pe(n,at(Jh(t,s),"float32")),b:()=>pe(n,at(Ti(t,s),"float32"))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const FW={kernelName:eo,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:i}=t,o=i.map(c=>c[0]);return{x:()=>On(n,o,s.shape)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const GW={kernelName:wa,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,i=Ft(t.shape,s.shape);return{a:()=>{const o=Lr(t.shape,i);return o.length>0?ge(It(n,o),t.shape):n},b:()=>{const o=pe(n,xr(_0(Et(t,s)))),c=Lr(s.shape,i);return c.length>0?ge(It(o,c),s.shape):o}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const _W={kernelName:Vl,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,i=Ft(t.shape,s.shape);return{a:()=>{const o=pe(n,at(s,"float32")),c=Lr(t.shape,i);return c.length>0?ge(It(o,c),t.shape):o},b:()=>{const o=pe(n,at(t,"float32")),c=Lr(s.shape,i);return c.length>0?ge(It(o,c),s.shape):o}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const VW={kernelName:to,gradFunc:n=>({x:()=>xr(n)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const BW={kernelName:Dh,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>Zr(t.shape,"float32")}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const WW={kernelName:uc,gradFunc:n=>({x:()=>en(n)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const zW={kernelName:Oh,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:s}=t;return Lc(n,s).map(i=>()=>i)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const rT={kernelName:Ph,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:i}=t,o=i.map(c=>c[0]);return{x:()=>On(n,o,s.shape)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const XW={kernelName:rn,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,s,i]=e,o=t,c=s,h=Ft(o.shape,c.shape);return{a:()=>{const f=at(c,"float32");let g=pe(n,pe(f,Qh(o,Nt(f,hn(1)))));const y=Lr(o.shape,h);return y.length>0&&(g=It(g,y)),ge(g,o.shape)},b:()=>{const f=Ti(o,0),g=Es(f,lo(o),en(o));let y=pe(n,pe(i,g));const I=Lr(c.shape,h);return I.length>0&&(y=It(y,I)),ge(y,c.shape)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ZW={kernelName:cc,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,s]=e,i=Ti(t,0);return{x:()=>Es(i,n,pe(n,s)),alpha:()=>{let o=Es(i,en(n),pe(n,t));const c=Lr(s.shape,n.shape);return c.length>0&&(o=It(o,c)),ge(o,s.shape)}}}};/**
* @license
* Copyright 2022 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function KW(n,e,t){const s=n.shape.slice();s[t]=1;const i=ge(e,s),o=mx(n,t,!0,!1),c=mx(n,t,!0,!0),h=pe(o,c);return pe(i,h)}function $W(n,e,t){const s=n.shape.length,i=s-t.length,o=er(t,s);let c=n;o!=null&&(c=tn(n,o));const h=c.shape.slice(),f=h.splice(s-t.length,t.length).reduce((I,C)=>I*C,1);h.push(f);const g=c.reshape(h);let y=KW(g,e,i);if(y=y.reshape(c.shape),o!=null){const I=eu(o);y=tn(y,I)}return y}const UW={kernelName:Ko,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:i}=t;let o=[];return i==null?o=s.shape.map((c,h)=>h):typeof i=="number"?o=[i]:o=i,{x:()=>$W(s,n,o)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const HW={kernelName:nc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,i=Ft(t.shape,s.shape);return{a:()=>{const o=Et(n,at(s,"float32")),c=Lr(t.shape,i);return c.length>0?ge(It(o,c),t.shape):o},b:()=>{let o=pe(n,at(t,"float32"));const c=Lr(s.shape,i);c.length>0&&(o=ge(It(o,c),s.shape));const h=zn(s);return xr(Et(o,at(h,"float32")))}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const jW={kernelName:ro,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Et(n,xr(zn(t)))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const YW={kernelName:$o,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=pe(Jh(t,6),Lf(t));return{x:()=>pe(n,at(s,"float32"))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const QW={kernelName:Bl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>pe(n,at(Lf(t),"float32"))}}};/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const JW={kernelName:Fh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ge(n,t.shape)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const qW={kernelName:Wl,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,i={dy:n,images:s};return{images:()=>de.runKernel(ar,i,t)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ez={kernelName:Gh,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,i={dy:n,images:s};return{images:()=>de.runKernel(ff,i,t)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const tz={kernelName:Mn,gradFunc:(n,e,t)=>{const{dims:s}=t,i=be(s,n.shape);return{x:()=>Rc(n,i)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const nz={kernelName:so,gradFunc:n=>({x:()=>en(n)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const rz={kernelName:bi,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>xr(Et(n,pe(Qh(t,1.5),2)))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const sz={kernelName:mn,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>at(en(t),"float32"),t:()=>pe(n,at(t,n.dtype)),e:()=>pe(n,at(vx(t),n.dtype))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const iz={kernelName:wi,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Ti(t,hn(0)),i=hn($0),o=hn(U0),c=pe(n,o),h=pe(pe(n,i),oo(at(t,"float32")));return Es(s,c,h)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const az={kernelName:zl,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>pe(n,pe(t,Nt(hn(1),t)))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const oz={kernelName:Uo,gradFunc:n=>({x:()=>en(n)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const lz={kernelName:hc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>pe(px(at(t,"float32")),n)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const uz={kernelName:vs,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>pe(NC(at(t,"float32")),n)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const cz={kernelName:Ia,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{begin:i,size:o}=t,c=s.shape,[h,f]=X0(s,i,o),g=[];for(let y=0;y<n.rank;y++)g.push([h[y],c[y]-h[y]-f[y]]);return{x:()=>Sx(n,g)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const hz={kernelName:Zl,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{dim:i}=t,o=!0,c=pe(n,s);return{logits:()=>Nt(c,pe(It(c,[i],o),s))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const dz={kernelName:Ho,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>pe(n,jh(t))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const sT={kernelName:_h,gradFunc:(n,e,t)=>{const{blockShape:s,paddings:i}=t;return{x:()=>dx(n,s,i)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const iT={kernelName:Ca,gradFunc:(n,e,t)=>{const{axis:s}=t;return{x:()=>zs(n,s)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const fz={kernelName:Xl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Et(n,pe(Ns(at(t,"float32")),2))}}};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const pz={kernelName:Vh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>pe(n,pe(at(t,"float32"),2))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const mz={kernelName:es,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,i=hn(2);return{a:()=>pe(n,pe(i,Nt(t,s))),b:()=>pe(n,pe(i,Nt(s,t)))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const gz={kernelName:w,gradFunc:n=>({x:()=>en(n)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const xz={kernelName:Is,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,i=Ft(t.shape,s.shape);return{a:()=>{let o=n;const c=Lr(t.shape,i);return c.length>0&&(o=It(o,c)),ge(o,t.shape)},b:()=>{let o=n;const c=Lr(s.shape,i);return c.length>0&&(o=It(o,c)),ge(xr(o),s.shape)}}}};/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const yz={kernelName:dc,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,i=s.shape.slice(),{axis:o}=t;be(o,s.shape).forEach(f=>{i[f]=1});const c=ge(n,i),h=pe(c,nu(s.shape,"float32"));return{x:()=>h}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const bz={kernelName:pc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Et(n,zn(px(t)))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const wz={kernelName:jo,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>pe(Nt(hn(1),zn(t)),n)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const vz={kernelName:Ta,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{reps:i}=t;return{x:()=>{let o=en(s);if(s.rank===1)for(let c=0;c<i[0];++c)o=Ue(o,On(n,[c*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let c=0;c<i[0];++c)for(let h=0;h<i[1];++h)o=Ue(o,On(n,[c*s.shape[0],h*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let c=0;c<i[0];++c)for(let h=0;h<i[1];++h)for(let f=0;f<i[2];++f)o=Ue(o,On(n,[c*s.shape[0],h*s.shape[1],f*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let c=0;c<i[0];++c)for(let h=0;h<i[1];++h)for(let f=0;f<i[2];++f)for(let g=0;g<i[3];++g)o=Ue(o,On(n,[c*s.shape[0],h*s.shape[1],f*s.shape[2],g*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return o}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Iz={kernelName:K,gradFunc:(n,e,t)=>{const s=t,{perm:i}=s,o=eu(i);return{x:()=>tn(n,o)}}};/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Cz={kernelName:d,gradFunc:(n,e,t)=>{const s=t,{axis:i}=s;return{value:()=>uo(n,i)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Sz={kernelName:m,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Tz(n,t)}}};function Tz(n,e){const t=tu(e,en(e)),s=yx(n,t);let i=Ec(e,hn(0,"int32"));const o=s.rank-i.rank;for(let h=0;h<o;++h)i=Xs(i,h+1);i=nl(i,nu(s.shape,"bool"));const c=en(s);return Es(i,s,c)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const kz={kernelName:b,gradFunc:n=>({x:()=>en(n)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Ez=[JS,SB,TB,kB,EB,NB,AB,RB,MB,LB,DB,OB,GB,BB,WB,zB,XB,ZB,KB,$B,UB,HB,YB,jB,qB,eW,tW,nW,rW,sW,HW,iW,aW,oW,lW,uW,hW,cW,dW,fW,pW,mW,gW,xW,yW,bW,wW,vW,IW,TW,nT,nT,kW,AW,LW,DW,OW,PW,FW,GW,_W,VW,BW,WW,zW,rT,rT,XW,ZW,UW,jW,YW,QW,JW,qW,ez,tz,nz,rz,sz,iz,az,oz,lz,uz,cz,hz,dz,sT,sT,iT,iT,fz,mz,pz,gz,xz,yz,bz,wz,vz,Iz,Cz,Sz,kz];for(const n of Ez)Ye(n);/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.abs=function(){return this.throwIfDisposed(),ks(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.acos=function(){return this.throwIfDisposed(),oF(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.acosh=function(){return this.throwIfDisposed(),uF(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.add=function(n){return this.throwIfDisposed(),Ue(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.all=function(n,e){return this.throwIfDisposed(),SC(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.any=function(n,e){return this.throwIfDisposed(),ox(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.argMax=function(n){return this.throwIfDisposed(),vf(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.argMin=function(n){return this.throwIfDisposed(),pF(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.asScalar=function(){return this.throwIfDisposed(),D(this.size===1,()=>"The array must have only 1 element."),ge(this,[])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.asType=function(n){return this.throwIfDisposed(),at(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.as1D=function(){return this.throwIfDisposed(),ge(this,[this.size])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.as2D=function(n,e){return this.throwIfDisposed(),ge(this,[n,e])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),ge(this,[n,e,t])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.as4D=function(n,e,t,s){return this.throwIfDisposed(),ge(this,[n,e,t,s])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.as5D=function(n,e,t,s,i){return this.throwIfDisposed(),ge(this,[n,e,t,s,i])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.asin=function(){return this.throwIfDisposed(),gF(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.asinh=function(){return this.throwIfDisposed(),yF(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.atan=function(){return this.throwIfDisposed(),wF(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.atan2=function(n){return this.throwIfDisposed(),IF(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.atanh=function(){return this.throwIfDisposed(),SF(this)},De().prototype.avgPool=function(n,e,t,s){return this.throwIfDisposed(),cx(this,n,e,t,s)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),dx(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.batchNorm=function(n,e,t,s,i){return this.throwIfDisposed(),D0(this,n,e,t,s,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.broadcastTo=function(n){return this.throwIfDisposed(),Tf(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.cast=function(n){return this.throwIfDisposed(),at(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.ceil=function(){return this.throwIfDisposed(),QF(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),Si(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof Mr&&(n=[n]),zs([this,...n],e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.conv1d=function(n,e,t,s,i,o){return this.throwIfDisposed(),TC(this,n,e,t,s,i,o)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.conv2dTranspose=function(n,e,t,s,i){return this.throwIfDisposed(),kC(this,n,e,t,s,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.conv2d=function(n,e,t,s,i,o){return this.throwIfDisposed(),kc(this,n,e,t,s,i,o)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.cos=function(){return this.throwIfDisposed(),px(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.cosh=function(){return this.throwIfDisposed(),NC(this)};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),mx(this,n,e,t)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),AC(this,n,e,t)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),I9(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.depthwiseConv2d=function(n,e,t,s,i,o){return this.throwIfDisposed(),gx(this,n,e,t,s,i,o)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.dilation2d=function(n,e,t,s,i){return this.throwIfDisposed(),T9(this,n,e,t,s,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.divNoNan=function(n){return this.throwIfDisposed(),R9(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.div=function(n){return this.throwIfDisposed(),Et(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.dot=function(n){return this.throwIfDisposed(),L9(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.elu=function(){return this.throwIfDisposed(),P0(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.equal=function(n){return this.throwIfDisposed(),ao(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.erf=function(){return this.throwIfDisposed(),F9(this)};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),K9(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.exp=function(){return this.throwIfDisposed(),oo(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.expandDims=function(n){return this.throwIfDisposed(),Xs(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.expm1=function(){return this.throwIfDisposed(),j9(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.fft=function(){return this.throwIfDisposed(),tS(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.flatten=function(){return this.throwIfDisposed(),ge(this,[this.size])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.floor=function(){return this.throwIfDisposed(),_0(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.floorDiv=function(n){return this.throwIfDisposed(),CC(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.gather=function(n,e,t){return this.throwIfDisposed(),yx(this,n,e,t)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.greaterEqual=function(n){return this.throwIfDisposed(),Ec(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.greater=function(n){return this.throwIfDisposed(),Ti(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.ifft=function(){return this.throwIfDisposed(),Mx(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.irfft=function(){return this.throwIfDisposed(),__(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.isFinite=function(){return this.throwIfDisposed(),sG(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.isInf=function(){return this.throwIfDisposed(),aG(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.isNaN=function(){return this.throwIfDisposed(),lG(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.leakyRelu=function(n){return this.throwIfDisposed(),wx(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.lessEqual=function(n){return this.throwIfDisposed(),Jh(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.less=function(n){return this.throwIfDisposed(),V0(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.localResponseNormalization=function(n,e,t,s){return this.throwIfDisposed(),fG(this,n,e,t,s)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.logSigmoid=function(){return this.throwIfDisposed(),wG(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.logSoftmax=function(n){return this.throwIfDisposed(),PC(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),FC(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.log=function(){return this.throwIfDisposed(),lo(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.log1p=function(){return this.throwIfDisposed(),OC(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.logicalAnd=function(n){return this.throwIfDisposed(),nl(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.logicalNot=function(){return this.throwIfDisposed(),vx(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.logicalOr=function(n){return this.throwIfDisposed(),GC(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.logicalXor=function(n){return this.throwIfDisposed(),NG(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),cn(this,n,e,t)},De().prototype.maxPool=function(n,e,t,s){return this.throwIfDisposed(),Ix(this,n,e,t,s)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.max=function(n,e){return this.throwIfDisposed(),Na(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.maximum=function(n){return this.throwIfDisposed(),tu(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.mean=function(n,e){return this.throwIfDisposed(),Er(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.min=function(n,e){return this.throwIfDisposed(),F0(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.minimum=function(n){return this.throwIfDisposed(),Nf(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),FG(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.mod=function(n){return this.throwIfDisposed(),_G(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.mul=function(n){return this.throwIfDisposed(),pe(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.neg=function(){return this.throwIfDisposed(),xr(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.norm=function(n,e,t){return this.throwIfDisposed(),G0(this,n,e,t)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.notEqual=function(n){return this.throwIfDisposed(),B0(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),_C(this,n,e,t)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.onesLike=function(){return this.throwIfDisposed(),ea(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.pad=function(n,e){return this.throwIfDisposed(),Sx(this,n,e)},De().prototype.pool=function(n,e,t,s,i,o){return this.throwIfDisposed(),HG(this,n,e,t,s,i,o)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.pow=function(n){return this.throwIfDisposed(),Qh(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.prelu=function(n){return this.throwIfDisposed(),kx(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.prod=function(n,e){return this.throwIfDisposed(),QG(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.reciprocal=function(){return this.throwIfDisposed(),y_(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.relu=function(){return this.throwIfDisposed(),Ac(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.relu6=function(){return this.throwIfDisposed(),UC(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.reshapeAs=function(n){return this.throwIfDisposed(),ge(this,n.shape)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.reshape=function(n){return this.throwIfDisposed(),ge(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),lS(this,n,e,t)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),uS(this,n,e,t)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.reverse=function(n){return this.throwIfDisposed(),Rc(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.rfft=function(){return this.throwIfDisposed(),W_(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.round=function(){return this.throwIfDisposed(),HC(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.rsqrt=function(){return this.throwIfDisposed(),jC(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.selu=function(){return this.throwIfDisposed(),YC(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.separableConv2d=function(n,e,t,s,i,o){return this.throwIfDisposed(),QC(this,n,e,t,s,i,o)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.sigmoid=function(){return this.throwIfDisposed(),jh(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.sign=function(){return this.throwIfDisposed(),E_(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.sin=function(){return this.throwIfDisposed(),JC(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.sinh=function(){return this.throwIfDisposed(),qC(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.slice=function(n,e){return this.throwIfDisposed(),On(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.softmax=function(n){return this.throwIfDisposed(),Rx(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.softplus=function(){return this.throwIfDisposed(),Ef(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),Tx(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.split=function(n,e){return this.throwIfDisposed(),ki(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.sqrt=function(){return this.throwIfDisposed(),Ns(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.square=function(){return this.throwIfDisposed(),zn(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.squaredDifference=function(n){return this.throwIfDisposed(),X_(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.squeeze=function(n){return this.throwIfDisposed(),Mf(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof Mr?[this,n]:[this,...n];return uo(t,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.step=function(n){return this.throwIfDisposed(),Lf(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.stridedSlice=function(n,e,t,s,i,o,c,h){return this.throwIfDisposed(),H_(this,n,e,t,s,i,o,c,h)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.sub=function(n){return this.throwIfDisposed(),Nt(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.sum=function(n,e){return this.throwIfDisposed(),It(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.tan=function(){return this.throwIfDisposed(),Y_(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.tanh=function(){return this.throwIfDisposed(),hx(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.tile=function(n){return this.throwIfDisposed(),Aa(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.toBool=function(){return this.throwIfDisposed(),at(this,"bool")};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.toFloat=function(){return this.throwIfDisposed(),at(this,"float32")};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.toInt=function(){return this.throwIfDisposed(),at(this,"int32")};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.topk=function(n,e){return this.throwIfDisposed(),eV(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.transpose=function(n){return this.throwIfDisposed(),tn(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.unique=function(n){return this.throwIfDisposed(),rV(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),sS(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.unstack=function(n){return this.throwIfDisposed(),Lc(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.where=function(n,e){return this.throwIfDisposed(),Es(n,this,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/De().prototype.zerosLike=function(){return this.throwIfDisposed(),en(this)};/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class ho extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ho.prototype)}}class na extends Error{constructor(e){super(e),Object.setPrototypeOf(this,na.prototype)}}class he extends Error{constructor(e){super(e),Object.setPrototypeOf(this,he.prototype)}}class Vt extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Vt.prototype)}}class xy extends Error{constructor(e){super(e),Object.setPrototypeOf(this,xy.prototype)}}/**
* @license
* Copyright 2022 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class aT{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function Oc(n,e){if(Array.isArray(n)){let t=[];for(let s=0;s<e;s++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function fo(n,e){if(!n)throw new xy(e)}function oT(n,e){let t=0;for(const s of n)s===e&&t++;return t}function Zs(n){return n.length===1?n[0]:n}function gn(n){return Array.isArray(n)?n:[n]}function al(n){const e=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return e[0]!=="_"?e:"private"+e}function Pc(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let ra={};function yy(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function by(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>by(e));else{const e=Object.keys(n);for(const t of e){const s=n[t];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[t]=s.value:by(s))}}}function Ff(n,e={},t={},s="object",i=!1){if(typeof n=="string"){const o=n;let c;if(o in t)c=t[o];else if(o in ra)c=ra[o];else if(c=e[o],c==null)throw new he(`Unknown ${s}: ${n}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return c}else{const o=n;if(o.className==null||o.config==null)throw new he(`${s}: Improper config format: ${JSON.stringify(o)}.
'className' and 'config' must set.`);const c=o.className;let h,f;if(c in t?[h,f]=t[c]:c in ra?[h,f]=ra.className:c in e&&([h,f]=e[c]),h==null)throw new he(`Unknown ${s}: ${c}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(f!=null){const g={};for(const k of Object.keys(ra))g[k]=ra[k];for(const k of Object.keys(t))g[k]=t[k];const y=o.config;y.customObjects=g;const I=Object.assign({},ra);for(const k of Object.keys(t))ra[k]=t[k];by(o.config);const C=f(h,o.config,t,i);return ra=Object.assign({},I),C}else{const g=Object.assign({},ra);for(const I of Object.keys(t))ra[I]=t[I];const y=new h(o.config);return ra=Object.assign({},g),y}}}function Nz(n,e){return n<e?-1:n>e?1:0}function H0(n,e){return-1*Nz(n,e)}function su(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function Az(n){if(n==null)throw new he(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function Fc(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new he(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function wy(n,e,t=0,s=1/0){return fo(t>=0),fo(s>=t),Array.isArray(n)&&n.length>=t&&n.length<=s&&n.every(i=>typeof i===e)}function Kr(n,e){Array.isArray(n)?(D(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,s)=>Kr(t,`element ${s+1} of ${e}`))):D(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${lT(n)}.`)}function lT(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>lT(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function Rz(n,e,t){let s=t!=null?t():Vs(),i;return(...o)=>{const c=t!=null?t():Vs();return c-s<e||(s=c,i=n(...o)),i}}function uT(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/let Mz=0;function cT(){return Mz++}const j0={};function Y0(n=""){return n in j0||(j0[n]=0),j0[n]+=1,n+j0[n].toString()}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const Lz=["channelsFirst","channelsLast"],Dz=["nearest","bilinear"],Oz=["valid","same","causal"],Pz=["max","avg"],Fz=["sum","mul","concat","ave"];/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const rd=new Map;function yr(n){Fc(Lz,"DataFormat",n)}function Gz(n){Fc(Dz,"InterpolationFormat",n)}function Ei(n){Fc(Oz,"PaddingMode",n)}function hT(n){Fc(Pz,"PoolMode",n)}const Gf=[],dT="/";function Gc(n,e){Gf.push(n);try{const t=e();return Gf.pop(),t}catch(t){throw Gf.pop(),t}}function _z(){return Gf.length===0?"":Gf.join(dT)+dT}function fT(n){if(!mT(n))throw new Error("Not a valid tensor name: '"+n+"'");return _z()+n}function pT(n){if(!mT(n))throw new Error("Not a valid tensor name: '"+n+"'");rd.has(n)||rd.set(n,0);const e=rd.get(n);if(rd.set(n,rd.get(n)+1),e>0){const t=`${n}_${e}`;return rd.set(t,1),t}else return n}const Vz=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function mT(n){return!!n.match(Vz)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function Bz(n){return n===parseInt(n.toString(),10)}function iu(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let s=1;for(let i=e;i<t;++i)s*=n[i];return s}function sd(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s<e&&(e=s)}return e}function au(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s>e&&(e=s)}return e}function Ma(n,e){if(e<n)throw new he(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let s=n;s<e;++s)t.push(s);return t}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/let vy;function Dr(){return vy==null&&(vy=Ql().epsilon()),vy}function La(){return"channelsLast"}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function ol(n,e){return at(n,e)}function _f(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),ge(n,t)}function Wz(n,e){return ye(()=>{if(n.shape.length!==2)throw new he(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=_f(n,1);return Sy(t,[1,e,1])})}function zz(n){const e=[iu(n.shape)];return ge(n,e)}function Xz(n){if(n.rank<=1)throw new he(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],iu(n.shape,1)];return ge(n,e)}function _c(n,e,t){return ye(()=>{switch(n.rank){case 1:return Nx(n,e,t);case 2:return eS(n,[e,0],[t,n.shape[1]]);case 3:return Ax(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return z0(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return On(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return On(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new he(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Iy(n,e,t){return ye(()=>{switch(n.rank){case 1:return Nx(n,e,t);case 2:return eS(n,[0,e],[n.shape[0],t]);case 3:return Ax(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return z0(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new he(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Q0(n,e,t,s){return ye(()=>{switch(n.rank){case 1:return Nx(n,e,t);case 2:switch(s){case 1:return _c(n,e,t);case 2:return Iy(n,e,t);default:throw new he(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return _c(n,e,t);case 2:return Ax(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return Iy(n,e,t);default:throw new he(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return _c(n,e,t);case 2:return z0(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return z0(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return Iy(n,e,t);default:throw new he(`The axis is not within the rank of the tensor ${s}`)}default:throw new he(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Cy(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),zs(n,e)}function gT(n,e){switch(n.rank){case 1:return e9([n,e]);case 2:return n9([n,e],0);case 3:return s9([n,e],0);case 4:return a9([n,e],0);default:throw new he(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function Sy(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new he(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return Aa(n,e)}function J0(n,e=0,t=1,s,i){return p_(n,e,t,s,i)}function po(n,e,t,s){if(n.rank<2||e.rank<2)throw new Vt(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const i=n.shape.slice(-1)[0],o=e.shape.slice(-2)[0];if(i!==o)throw new Vt(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return aS({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?Ty(n.rank,s,La()):null,activation:t});{const i=n.shape.slice(),o=i.pop();n=ge(n,[-1,o]);const c=e.shape.slice(),h=c.pop(),f=c.pop(),g=[...c,h],y=Array.from({length:e.rank},(C,k)=>k===0?e.rank-2:k<=e.rank-2?k-1:k);e=ge(tn(e,y),[f,-1]);const I=[...i,...g];return ge(aS({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?Ty(n.rank,s,La()):null,activation:t}),I)}}function xT(n,e,t){return ye(()=>(Array.isArray(e)?e=oi(e,"int32"):e=at(e,"int32"),yx(n,e,t)))}function Vf(n){return pe(n,n)}function Ty(n,e,t){const s=e.shape;if(e.rank!==1&&e.rank!==n)throw new he(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return s.length===1?ge(e,[1,s[0],1,1,1]):ge(e,[1,s[3],s[0],s[1],s[2]]);if(t==="channelsLast")return s.length===1?ge(e,[1,1,1,1,s[0]]):ge(e,[1].concat(s))}else if(n===4){if(t==="channelsFirst")return s.length===1?ge(e,[1,s[0],1,1]):ge(e,[1,s[2],s[0],s[1]]);if(t==="channelsLast")return s.length===1?ge(e,[1,1,1,s[0]]):ge(e,[1].concat(s))}else if(n===3){if(t==="channelsFirst")return s.length===1?ge(e,[1,s[0],1]):ge(e,[1,s[1],s[0]]);if(t==="channelsLast")return s.length===1?ge(e,[1,1,s[0]]):ge(e,[1].concat(s))}else if(n<3)return e;throw new he(`Unsupported input rank by biasAdd: ${e.rank}`)}function Da(n,e,t){return ye(()=>(t==null&&(t=La()),yr(t),Ue(n,Ty(n.rank,e,t))))}function Zz(n,e=1){if(e!==1)throw new Vt(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return P0(n)}function Kz(n){return ye(()=>Et(n,Ue(ks(n),1)))}function yT(n,e,t,s){return ye(()=>cV(n,e,t,s))}function $z(n){return ye(()=>{const e=Ue(.5,pe(.2,n));return Si(e,0,1)})}function Bf(n,e,t=!1){return t?n():e()}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const Uz=["fanIn","fanOut","fanAvg"],Hz=["normal","uniform","truncatedNormal"];/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function jz(n){Fc(Uz,"FanMode",n)}function Yz(n){Fc(Hz,"Distribution",n)}class sa extends td{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class bT extends sa{apply(e,t){return Zr(e,t)}}bT.className="Zeros",Ze(bT);class ky extends sa{apply(e,t){return nu(e,t)}}ky.className="Ones",Ze(ky);class wT extends sa{constructor(e){if(super(),typeof e!="object")throw new he(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new he(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return ye(()=>pe(hn(this.value),nu(e,t)))}getConfig(){return{value:this.value}}}wT.className="Constant",Ze(wT);class vT extends sa{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return Af(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}vT.className="RandomUniform",Ze(vT);class IT extends sa{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Vt(`randomNormal does not support dType ${t}.`);return J0(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}IT.className="RandomNormal",Ze(IT);class CT extends sa{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Vt(`truncatedNormal does not support dType ${t}.`);return rS(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}CT.className="TruncatedNormal",Ze(CT);class ST extends sa{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return ye(()=>{if(e.length!==2||e[0]!==e[1])throw new he("Identity matrix initializer can only be used for 2D square matrices.");return pe(this.gain,DC(e[0]))})}getConfig(){return{gain:this.gain}}}ST.className="Identity",Ze(ST);function Qz(n,e="channelsLast"){let t,s;if(yr(e),n.length===2)t=n[0],s=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const i=iu(n,2);t=n[1]*i,s=n[0]*i}else if(e==="channelsLast"){const i=iu(n,0,n.length-2);t=n[n.length-2]*i,s=n[n.length-1]*i}}else{const i=iu(n);t=Math.sqrt(i),s=Math.sqrt(i)}return[t,s]}class li extends sa{constructor(e){if(super(),e.scale<0)throw new he(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,jz(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,Yz(this.distribution),this.seed=e.seed}apply(e,t){const s=Qz(e),i=s[0],o=s[1];let c=this.scale;if(this.mode==="fanIn"?c/=Math.max(1,i):this.mode==="fanOut"?c/=Math.max(1,o):c/=Math.max(1,(i+o)/2),this.distribution==="normal"){const h=Math.sqrt(c);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Vt(`${this.getClassName()} does not support dType ${t}.`);return rS(e,0,h,t,this.seed)}else{const h=Math.sqrt(3*c);return Af(e,-h,h,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}li.className="VarianceScaling",Ze(li);class Ey extends li{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return li.className}}Ey.className="GlorotUniform",Ze(Ey);class Ny extends li{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return li.className}}Ny.className="GlorotNormal",Ze(Ny);class Ay extends li{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return li.className}}Ay.className="HeNormal",Ze(Ay);class Ry extends li{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return li.className}}Ry.className="HeUniform",Ze(Ry);class My extends li{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return li.className}}My.className="LeCunNormal",Ze(My);class Ly extends li{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return li.className}}Ly.className="LeCunUniform",Ze(Ly);class TT extends sa{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return ye(()=>{if(e.length<2)throw new Vt("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;const s=H(e.slice(0,-1)),i=e[e.length-1],o=s*i;o>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${o}) elements: Slowness may result.`);const c=[Math.max(i,s),Math.min(i,s)],h=J0(c,0,1,t,this.seed),f=aB.qr(h,!1);let g=f[0];const y=f[1].flatten().stridedSlice([0],[Math.min(i,s)*Math.min(i,s)],[Math.min(i,s)+1]);return g=pe(g,y.sign()),s<i&&(g=g.transpose()),pe(hn(this.gain),g.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}TT.className="Orthogonal",Ze(TT);const kT={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function ET(n,e={}){return Ff(n,ta.getMap().classNameMap,e,"initializer")}function tr(n){return yy(n)}function Hn(n){if(typeof n=="string"){const e=n in kT?kT[n]:n;if(e==="GlorotNormal")return new Ny;if(e==="GlorotUniform")return new Ey;if(e==="HeNormal")return new Ay;if(e==="HeUniform")return new Ry;if(e==="LeCunNormal")return new My;if(e==="LeCunUniform")return new Ly;{const t={};return t.className=e,t.config={},ET(t)}}else return n instanceof sa?n:ET(n)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function Dy(n){return Array.isArray(n)&&Array.isArray(n[0])}function q0(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function Rt(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new he(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function sn(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new he(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function e1(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((s,i)=>s*i);return e}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const NT="Variable";class Jz{constructor(e,t="float32",s=NT,i=!0,o=null){this.dtype=t??"float32",this.shape=e.shape,this.id=cT(),s=s??NT,this.originalName=fT(s),this.name=pT(this.originalName),this.trainable_=i,this.constraint=o,this.val=aV(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),qz(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function qz(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function Oy(n){return n.map(e=>e.read())}function Py(n){n.forEach(e=>{e[0].write(e[1])})}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class Or{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class mo{constructor(e,t,s,i,o,c,h){this.dtype=e,this.shape=t,this.sourceLayer=s,this.inputs=i,this.callArgs=o,this.outputTensorIndex=h,this.id=cT(),c!=null&&(this.originalName=fT(c),this.name=pT(this.originalName)),this.rank=t.length}}let e8=0;class t1{constructor(e,t){this.callArgs=t,this.id=e8++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let t8=0;class Zt extends td{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=t8++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const s=this.getClassName();t=al(s)+"_"+Y0(s)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let o=null;e.batchSize!=null&&(o=e.batchSize),s=[o].concat(e.inputShape)}this.batchInputShape=s;let i=e.dtype;i==null&&(i=e.inputDType),i==null&&(i="float32"),this.dtype=i}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new na(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new he(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return Zs(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return Zs(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new ho(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new ho(`Layer ${this.name} is not connected, no input to return.`);return Zs(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new ho(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new ho(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Zs(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=gn(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=gn(this.inputSpec);if(t.length!==s.length)throw new he(`Layer ${this.name} expects ${s.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let i=0;i<t.length;i++){const o=t[i],c=s[i];if(c==null)continue;const h=o.rank;if(c.ndim!=null&&h!==c.ndim)throw new he(`Input ${i} is incompatible with layer ${this.name}: expected ndim=${c.ndim}, found ndim=${h}`);if(c.maxNDim!=null&&h>c.maxNDim)throw new he(`Input ${i} is incompatible with layer ${this.name}: expected max_ndim=${c.maxNDim}, found ndim=${h}`);if(c.minNDim!=null&&h<c.minNDim)throw new he(`Input ${i} is incompatible with layer ${this.name}: expected min_ndim=${c.minNDim}, found ndim=${h}.`);if(c.dtype!=null&&o.dtype!==c.dtype)throw new he(`Input ${i} is incompatible with layer ${this.name} : expected dtype=${c.dtype}, found dtype=${o.dtype}.`);if(c.axes){const f=o.shape;for(const g in c.axes){const y=Number(g),I=c.axes[g],C=y>=0?f[y]:f[f.length+y];if(I!=null&&[I,null].indexOf(C)===-1)throw new he(`Input ${i} is incompatible with layer ${this.name}: expected axis ${y} of input shape to have value ${I} but got shape ${f}.`)}}if(c.shape!=null)for(let f=0;f<c.shape.length;++f){const g=c.shape[f],y=o.shape[f];if(g!=null&&y!=null&&g!==y)throw new he(`Input ${i} is incompatible with layer ${this.name}: expected shape=${c.shape}, found shape=${o.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const s=gn(e),i=s8(e),o=i8(e);if(i===o)throw new he("Arguments to apply() must be all SymbolicTensors or all Tensors");return Gc(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const c=[];for(const h of gn(e))c.push(h.shape);this.build(Zs(c)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&o&&(this._refCount=1)}if(this.assertInputCompatibility(e),o){let c=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,c);const h=gn(c),f=[];for(let g of h)s.indexOf(g)!==-1&&(g=g.clone()),f.push(g);if(c=Zs(f),this.activityRegularizer!=null)throw new Vt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return c}else{const c=n8(e),h=this.computeOutputShape(c);let f;const g=r8(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?c[0]:c),h!=null&&h.length>0&&Array.isArray(h[0])?f=h.map((y,I)=>new mo(g,y,this,gn(e),t,this.name,I)):f=new mo(g,h,this,gn(e),t,this.name),this.addInboundNode(e,f,null,null,c,h,t),this._refCount++,this.activityRegularizer!=null)throw new Vt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return f}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((s,i)=>{s!=null&&e[i]!=null&&e[i]!==s&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new ho(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const s=JSON.stringify(t.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new ho(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new na(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return e1(this.weights)}build(e){this.built=!0}getWeights(e=!1){return Oy(e?this.trainableWeights:this.weights)}setWeights(e){ye(()=>{const t=this.weights;if(t.length!==e.length)throw new he(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const s=[],i=Oy(t);for(let o=0;o<i.length;++o){const c=i[o],h=t[o],f=e[o];if(!se(c.shape,f.shape))throw new he(`Layer weight shape ${c.shape} not compatible with provided weight shape ${f.shape}`);s.push([h,f])}Py(s)})}addWeight(e,t,s,i,o,c,h,f){if(this._addedWeightNames.indexOf(e)!==-1)throw new he(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(i=f!=null?f():Hn("zeros"));const g=i.apply(t,s),y=new Jz(g,s,e,c,h);return g.dispose(),o!=null&&this.addLoss(()=>o.apply(y.read())),c==null&&(c=!0),c?this._trainableWeights.push(y):this._nonTrainableWeights.push(y),y}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=gn(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,s){if(!this.supportsMasking)return;const i=this.computeMask(e,s),o=gn(t),c=gn(i);if(o.length!==c.length)throw new Error(`${this.name} outputs ${o.length} tensors but ${o.length} masks for those tensors`);for(let h=0;h<o.length;h++)o[h].kerasMask=c[h]}addInboundNode(e,t,s,i,o,c,h=null){const f=gn(e);t=gn(t),s=gn(s),i=gn(i),o=q0(o),c=q0(c);const g=[],y=[],I=[];for(const C of f)g.push(C.sourceLayer),y.push(C.nodeIndex),I.push(C.tensorIndex);new t1({outboundLayer:this,inboundLayers:g,nodeIndices:y,tensorIndices:I,inputTensors:f,outputTensors:t,inputMasks:s,outputMasks:i,inputShapes:o,outputShapes:c},h);for(let C=0;C<t.length;C++)t[C].sourceLayer=this,t[C].nodeIndex=this.inboundNodes.length-1,t[C].tensorIndex=C}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function n8(n){n=gn(n);const e=[];for(const t of n)e.push(t.shape);return Zs(e)}function r8(n){return"float32"}function AT(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const s=e.inboundNodes[t];if(s.inboundLayers.length===0)return s.inputTensors;{const i=[];for(let o=0;o<s.inboundLayers.length;o++){const c=s.inputTensors[o],h=s.inboundLayers[o],f=s.nodeIndices[o],g=AT(c,h,f);for(const y of g)i.indexOf(y)===-1&&i.push(y)}return i}}}function s8(n){let e=!0;for(const t of gn(n))if(!(t instanceof mo)){e=!1;break}return e}function i8(n){let e=!0;for(const t of gn(n))if(t instanceof mo){e=!1;break}return e}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class Wf extends Zt{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:Y0("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new he("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new he("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new he("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=t,this.dtype=s,this.inputSpec=[{shape:t}];const i=new mo(this.dtype,this.batchInputShape,this,[],{},this.name);i.nodeIndex=0,i.tensorIndex=0,new t1({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[i],outputTensors:[i],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new he(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Wf.className="InputLayer",Ze(Wf);function a8(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new he("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new Wf({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function o8(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return at(e,n.dtype)}catch{throw new he(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class ou{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof ou)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=o8(e,t),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new he(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof mo){if(this.id2Value[e.id]==null)throw new he(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new he(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof mo){if(this.id2Value[e.id]==null)throw new he(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new he(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&$t(this.id2Mask)}}const n1=new aT,r1=new aT;function l8(n){n1!=null&&n1.setMaxEntries(n),r1!=null&&r1.setMaxEntries(n)}function zf(n,e,t,s){const i=t==null?!1:t.training,o=Array.isArray(n),c=o?n:[n],h=c.map(N=>N.name),f=[],g=e.names();for(const N of h)g.indexOf(N)!==-1?f.push(e.getValue(N)):f.push(null);const y=h.join(",")+"|"+e.names().sort().join(",");let I=n1.get(y),C;if(I==null){const N=u8(c,e);I=N.sorted,C=N.recipientCounts,n1.put(y,I),r1.put(y,C)}C={},i||Object.assign(C,r1.get(y));const k=new ou(e);for(let N=0;N<I.length;++N){const R=I[N],P=R.sourceLayer;if(P instanceof Wf)continue;const L=[],F=[],W=[];let z=!1;for(const ie of R.inputs){const oe=k.getValue(ie),Ce=k.getMask(ie);L.push(oe),F.push(Ce),Ce!=null&&(z=!0),i||(C[ie.name]--,C[ie.name]===0&&!e.hasKey(ie)&&h.indexOf(ie.name)===-1&&!oe.isDisposed&&ie.sourceLayer.stateful!==!0&&W.push(oe))}z&&(t=t||{},t.mask=F[0]);const X=gn(P.apply(L,t));let Q=null;P.supportsMasking&&(Q=P.computeMask(L,F));const J=h8(R),te=Array.isArray(J)?J:[J];for(let ie=0;ie<te.length;++ie){k.hasKey(te[ie])||k.add(te[ie],X[ie],Array.isArray(Q)?Q[0]:Q);const oe=h.indexOf(te[ie].name);oe!==-1&&(f[oe]=X[ie])}i||$t(W)}return k.disposeMasks(),o?f:f[0]}function u8(n,e){D(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],s={};if(n.length===1){const i=RT(n[0],e);t=i.sorted,s=i.recipientMap}else{const i=new Set;for(const o of n){const{sorted:c,recipientMap:h}=RT(o,e);for(const f of c)i.has(f.name)||(t.push(f),i.add(f.name));for(const f in h)s[f]==null&&(s[f]=new Set),h[f].forEach(g=>s[f].add(g))}}return{sorted:t,recipientCounts:c8(s)}}function c8(n){const e={};for(const t in n)e[t]=n[t].size;return e}function RT(n,e){const t=new Set,s=[],i={};for(const h of e.names())t.add(h);const o=[],c=[];for(o.push(n);o.length>0;){const h=o[o.length-1];if(t.has(h.name)){o.pop();continue}const f=c[c.length-1]===o.length-1;if(h.inputs.length===0||f)o.pop(),s.push(h),t.add(h.name),f&&c.pop();else{c.push(o.length-1);for(const g of h.inputs)i[g.name]==null&&(i[g.name]=new Set),i[g.name].add(h.name),!t.has(g.name)&&o.push(g)}}return{sorted:s,recipientMap:i}}function h8(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let s=0;s<n.sourceLayer.inboundNodes.length;++s)for(const i of n.sourceLayer.inboundNodes[s].outputTensors)if(i.id===n.id){t=s;break}e=n.sourceLayer.getOutputAt(t)}return e}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/ke().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,l8);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function Fy(n,e){return ye(()=>Ns(It(pe(n,n),e,!0)))}class Xf extends td{getConfig(){return{}}}class MT extends Xf{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ye(()=>{const t=Fy(e,this.axis),s=Si(t,0,this.maxValue);return pe(e,Et(s,Ue(Dr(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}MT.className="MaxNorm",Ze(MT);class LT extends Xf{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ye(()=>Et(e,Ue(Dr(),Fy(e,this.axis))))}getConfig(){return{axis:this.axis}}}LT.className="UnitNorm",Ze(LT);class DT extends Xf{apply(e){return Ac(e)}}DT.className="NonNeg",Ze(DT);class OT extends Xf{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ye(()=>{const t=Fy(e,this.axis),s=Ue(pe(this.rate,Si(t,this.minValue,this.maxValue)),pe(1-this.rate,t));return pe(e,Et(s,Ue(Dr(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}OT.className="MinMaxNorm",Ze(OT);const PT={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Pr(n){return yy(n)}function FT(n,e={}){return Ff(n,ta.getMap().classNameMap,e,"constraint")}function Fr(n){if(n==null)return null;if(typeof n=="string"){const e={className:n in PT?PT[n]:n,config:{}};return FT(e)}else return n instanceof Xf?n:FT(n)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/async function Vc(n){if(n==null)return;const e=[],t=[],s=[];for(const i in n){const o=n[i];if(typeof o!="number"){const c=o;e.push(c.data()),t.push(i),s.push(c)}}if(e.length>0){const i=await Promise.all(e);for(let o=0;o<i.length;++o)n[t[o]]=i[o][0];$t(s)}}function GT(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/var _T;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(_T||(_T={}));const d8=125;class Zf{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class f8{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class p8 extends Zf{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const s=t.size==null?0:t.size;this.seen+=s;for(const i in t){const o=t[i];if(typeof o=="number")this.totals.hasOwnProperty(i)||(this.totals[i]=0),this.totals[i]=this.totals[i]+o*s;else{let c;i in this.totals?c=this.totals[i]:this.totals[i]=0;const h=ye(()=>Ue(this.totals[i],pe(o,s)));this.totals[i]=h,c!=null&&c.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?t[s]=this.totals[s]/this.seen:ye(()=>{const i=pe(Et(1,this.seen),this.totals[s]);t[s]=i,this.totals[s].dispose(),Ci(t[s])}))}}class m8 extends Zf{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const s in t)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(t[s])}async syncData(){const e=[],t=[],s=[];for(const o in this.history){const c=this.history[o];for(let h=0;h<c.length;++h)if(typeof c[h]!="number"){const f=c[h];e.push(f.data()),t.push(o),s.push(h)}}const i=await Promise.all(e);for(let o=0;o<i.length;++o)this.history[t[o]][s[o]].dispose(),this.history[t[o]][s[o]]=i[o][0]}}class g8 extends Zf{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||Z0,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=d8),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");kn(this.yieldEvery)&&(this.maybeWait=Rz(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,s){const i=[];this.yield!=null&&(await Vc(s),i.push(this.yield(e,t,s))),i.push(this.nextFrameFunc()),await Promise.all(i)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await Vc(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const s=[];this.epochEnd!=null&&(await Vc(t),s.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,t){this.batchBegin!=null&&(await Vc(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const s=[];this.batchEnd!=null&&(await Vc(t),s.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):kn(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await Vc(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Vc(e),await this.trainEnd(e))}}function VT(n,e){return n==null&&(n={}),n instanceof Zf?[n]:Array.isArray(n)&&n[0]instanceof Zf?n:gn(n).map(t=>new g8(t,e))}class ia{constructor(){}static registerCallbackConstructor(e,t){D(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),ia.checkForDuplicate(t),ia.constructors[e]==null&&(ia.constructors[e]=[]),ia.constructors[e].push(t)}static checkForDuplicate(e){for(const t in ia.constructors)ia.constructors[+t].forEach(s=>{if(s===e)throw new he("Duplicate callback constructor.")})}static clear(){ia.constructors={}}static createCallbacks(e){const t=[];for(const s in ia.constructors){const i=+s;e>=i&&t.push(...ia.constructors[i])}return t.map(s=>new s)}}ia.constructors={};function BT(n,e,t,s,i,o,c,h,f){const g=new m8,y=[new p8,...ia.createCallbacks(e)];n!=null&&y.push(...n),y.push(g);const I=new f8(y);return I.setParams({epochs:t,initialEpoch:s,samples:i,steps:o,batchSize:c,verbose:e,doValidation:h,metrics:f}),{callbackList:I,history:g}}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function ll(n,e={},t=!1){return Ff(n,ta.getMap().classNameMap,e,"layer",t)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function s1(n,e){return ye(()=>{n.dtype!=="float32"&&(n=at(n,"float32"));const t=It(Vf(n),e,!0),s=O0(t.shape,Dr()),i=Ns(tu(t,s));return Et(n,i)})}function i1(n,e){return ye(()=>Er(Vf(Nt(e,n)),-1))}function Gy(n,e){return ye(()=>Er(ks(Nt(e,n)),-1))}function _y(n,e){return ye(()=>{const t=Nt(n,e),s=Si(ks(n),Dr(),Number.MAX_VALUE),i=ks(Et(t,s));return pe(100,Er(i,-1))})}function x8(n,e){return ye(()=>{const t=Si(e,Dr(),Number.MAX_VALUE),s=lo(Ue(1,t)),i=Si(n,Dr(),Number.MAX_VALUE),o=lo(Ue(1,i));return Er(Vf(Nt(s,o)),-1)})}function y8(n,e){return ye(()=>{const t=tu(0,Nt(1,pe(n,e)));return Er(Vf(t),-1)})}function b8(n,e){return ye(()=>{const t=tu(0,Nt(1,pe(n,e)));return Er(t,-1)})}function w8(n,e){return ye(()=>{const t=It(pe(n,e),-1),s=Na(pe(Nt(1,n),e),-1);return tu(0,Ue(1,Nt(s,t)))})}function v8(n,e){return ye(()=>{const t=Math.log(2),s=Nt(e,n),i=Nt(Ue(s,Ef(pe(-2,s))),t);return Er(i,-1)})}function Kf(n,e,t=!1){return ye(()=>{if(t)e=Rx(e);else{const s=It(e,e.shape.length-1,!0);e=Et(e,s)}return e=Si(e,Dr(),1-Dr()),xr(It(pe(at(n,"float32"),lo(e)),e.shape.length-1))})}function a1(n,e,t=!1){return ye(()=>{const s=at(_0(zz(n)),"int32");e=Si(e,Dr(),1-Dr());const i=e.shape,o=ge(_C(s,i[i.length-1]),i);return Kf(o,e,t)})}function I8(n,e){if(!se(n.shape,e.shape))throw new he(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return ye(()=>{const t=Ac(e),s=xr(ks(e));return Ue(Nt(t,pe(e,n)),OC(oo(s)))})}function o1(n,e){return ye(()=>{let t;return t=Si(e,Dr(),1-Dr()),t=lo(Et(t,Nt(1,t))),Er(I8(n,t),-1)})}function C8(n,e){return ye(()=>{const t=Si(n,Dr(),1),s=Si(e,Dr(),1);return It(pe(n,lo(Et(t,s))),-1)})}function S8(n,e){return ye(()=>{const t=lo(Ue(Dr(),e));return Er(Nt(e,pe(n,t)),-1)})}function WT(n,e){return ye(()=>{const t=s1(n,-1),s=s1(e,-1),i=pe(t,s);return xr(It(i,-1))})}const l1={meanSquaredError:i1,meanAbsoluteError:Gy,meanAbsolutePercentageError:_y,meanSquaredLogarithmicError:x8,squaredHinge:y8,hinge:b8,categoricalHinge:w8,logcosh:v8,categoricalCrossentropy:Kf,sparseCategoricalCrossentropy:a1,binaryCrossentropy:o1,kullbackLeiblerDivergence:C8,poisson:S8,cosineProximity:WT};function Vy(n){if(typeof n=="string"){if(n in l1)return l1[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new he(e)}else return n}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function zT(n,e){return ye(()=>{const t=pe(.5,ea(e)),s=ol(Ti(e,t),n.dtype);return Er(ao(n,s),-1)})}function XT(n,e){return ye(()=>ol(ao(vf(n,-1),vf(e,-1)),"float32"))}function T8(n,e){return ye(()=>at(It(nl(ao(n,1),ao(e,1))),"float32"))}function k8(n,e){return ye(()=>at(It(nl(ao(n,0),ao(e,1))),"float32"))}function E8(n,e){return ye(()=>{const t=T8(n,e),s=k8(n,e),i=Ue(t,s);return at(Es(Ti(i,0),Et(t,i),0),"float32")})}function N8(n,e){return o1(n,e)}function A8(n,e){return n.rank===e.rank&&(n=Mf(n,[n.rank-1])),e=vf(e,-1),e.dtype!==n.dtype&&(e=at(e,n.dtype)),at(ao(n,e),"float32")}const R8=i1,M8=i1,L8=Gy,D8=Gy,O8=_y,P8=_y,ZT=Kf,F8=WT,KT=a1,u1={binaryAccuracy:zT,categoricalAccuracy:XT,precision:E8,categoricalCrossentropy:ZT,sparseCategoricalCrossentropy:KT,mse:R8,MSE:M8,mae:L8,MAE:D8,mape:O8,MAPE:P8,cosine:F8};function G8(n){if(typeof n=="string"&&n in u1)return u1[n];if(typeof n!="string"&&n!=null)return n;throw new he(`Unknown metric ${n}`)}function c1(n){if(fo(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(l1))if(l1[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(u1))if(u1[t]===n){e=t;break}return e!==void 0?e:n.name}}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function _8(n){const e={Adagrad:()=>nd.adagrad(.01),Adadelta:()=>nd.adadelta(1,.95,Dr()),Adam:()=>nd.adam(.001,.9,.999,Dr()),Adamax:()=>nd.adamax(.002,.9,.999,Dr(),0),RMSProp:()=>nd.rmsprop(.001,.9,0,Dr()),SGD:()=>nd.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new he(`Unknown Optimizer ${n}`)}/**
* @license
* Copyright 2019 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const $T=1*1024*1024;function UT(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!By(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const s=JSON.stringify(n);s.length>$T&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${$T}.`)}}function By(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!By(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!By(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function V8(n,e,t,s=console.log){const i=W8(n),o=["Layer (type)","Input Shape","Output shape","Param #"];i?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(y=>Math.floor(e*y)));let c;if(!i){o.push("Receives inputs"),c=[];for(const y in n.nodesByDepth)c.push(...n.nodesByDepth[y])}s("_".repeat(e)),h1(o,t,s),s("=".repeat(e));const h=n.layers;for(let y=0;y<h.length;++y)i?z8(h[y],t,s):X8(h[y],t,c,s),s((y===h.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const f=B8(n),g=e1(n.nonTrainableWeights);s(`Total params: ${f+g}`),s(`Trainable params: ${f}`),s(`Non-trainable params: ${g}`),s("_".repeat(e))}function B8(n){let e;return n.collectedTrainableWeights!=null?e=e1(n.collectedTrainableWeights):e=e1(n.trainableWeights),e}function W8(n){let e=!0;const t=[],s=[];for(const i in n.nodesByDepth)t.push(n.nodesByDepth[i]);for(const i of t){if(i.length>1||i.length===1&&i[0].inboundLayers.length>1){e=!1;break}s.push(...i)}if(e)for(const i of n.layers){let o=!1;for(const c of i.inboundNodes)if(s.indexOf(c)!==-1)if(o){e=!1;break}else o=!0;if(!e)break}return e}function h1(n,e,t=console.log){let s="";for(let i=0;i<n.length;++i)i>0&&(s=s.slice(0,s.length-1)+" "),s+=n[i],s=s.slice(0,e[i]),s+=" ".repeat(e[i]-s.length);t(s)}function z8(n,e,t){let s,i;try{i=n.inboundNodes.map(f=>JSON.stringify(f.inputShapes)).join(",")}catch{i="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const o=n.name,c=n.getClassName(),h=[`${o} (${c})`,i,s,n.countParams().toString()];h1(h,e,t)}function X8(n,e,t,s){let i,o;try{o=n.inboundNodes.map(I=>JSON.stringify(I.inputShapes)).join(",")}catch{o="multiple"}try{i=JSON.stringify(n.outputShape)}catch{i="multiple"}const c=[];for(const I of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(I)===-1))for(let C=0;C<I.inboundLayers.length;++C){const k=I.inboundLayers[C].name,N=I.nodeIndices[C],R=I.tensorIndices[C];c.push(`${k}[${N}][${R}]`)}const h=n.name,f=n.getClassName(),g=c.length===0?"":c[0],y=[`${h} (${f})`,o,i,n.countParams().toString(),g];h1(y,e,s);for(let I=1;I<c.length;++I)h1(["","","","",c[I]],e,s)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function HT(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function Wy(n,e){if(n===null)return null;if(typeof n=="string")return Pc(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let i=0;i<s;++i){const o=n[i];HT(e,i,o)?t.push(o):t.push(Wy(o,e))}return t}else{const t={};for(const s of Object.keys(n)){const i=n[s];if(s==="name"&&typeof i=="string")t[s]=i;else{const o=Pc(s);t[o]=Wy(i,o)}}return t}}function zy(n,e){if(n==null)return null;if(typeof n=="string")return al(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let i=0;i<s;++i){const o=n[i];HT(e,i,o)?t.push(o):t.push(zy(o,e))}return t}else{const t={};for(const s of Object.keys(n)){const i=n[s],o=al(s);(s==="name"||s==="className")&&typeof i=="string"?t[o]=i:t[o]=zy(i,s)}return t}}/** @license See the LICENSE file. */const jT="4.16.0";/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const Z8=n=>{const e=Object.keys(n);if(e.length===0)return!1;const t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))};class Oa extends Zt{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const F=this.getClassName().toLowerCase();this.name=Y0(F)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],su(this.inputs).length!==this.inputs.length)throw new he(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(F=>F.name)}`);su(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(F=>F.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const F of this.outputs){const W=F.sourceLayer,z=F.nodeIndex,X=F.tensorIndex;this.outputLayers.push(W),this.outputLayersNodeIndices.push(z),this.outputLayersTensorIndices.push(X)}for(const F of this.inputs){const W=F.sourceLayer,z=F.nodeIndex,X=F.tensorIndex;fo(z===0,"input layer has >1 nodes"),fo(X===0,"input layer has >1 tensors"),this.inputLayers.push(W),this.inputLayersNodeIndices.push(z),this.inputLayersTensorIndices.push(X)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let F=0;F<this.inputLayers.length;F++){const W=this.inputLayers[F];if(!(W instanceof Wf))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${F} (0-based) originates from layer type ${W.getClassName()}.`);this.inputNames.push(W.name),this.feedInputShapes.push(W.batchInputShape),this.feedInputNames.push(W.name)}for(const F of this.outputLayers)this.outputNames.push(F.name);this.internalInputShapes=this.inputs.map(F=>F.shape),this.internalOutputShapes=this.outputs.map(F=>F.shape);const t={},s={},i={},o={},c={},h=[],f=(F,W,z,X,Q,J)=>{(X==null||Q==null||J==null)&&(X=F.sourceLayer,Q=F.nodeIndex,J=F.tensorIndex);const te=X.inboundNodes[Q];if(z.indexOf(te)!==-1)throw new na(`The tensor ${F.name} at layer "${X.name}" is part of a cycle.`);if(W.indexOf(te)!==-1)return;this.containerNodes.add(Oa.nodeKey(X,Q)),X.id in c||(c[X.id]=Object.keys(c).length),z.indexOf(te)===-1&&z.push(te);const ie=te.inboundLayers.length;for(let oe=0;oe<ie;oe++){const Ce=te.inputTensors[oe],Se=te.inboundLayers[oe],Te=te.nodeIndices[oe],Le=te.tensorIndices[oe];f(Ce,W,z,Se,Te,Le)}for(W.push(te);z.indexOf(te)>=0;)z.splice(z.indexOf(te),1);h.push(te)},g=[],y=[];for(const F of this.outputs)f(F,g,y);const I=h.slice().reverse();for(const F of I){s[F.id]=F,F.id in t||(t[F.id]=0);let W=t[F.id];const z=i[F.outboundLayer.id]==null?0:i[F.outboundLayer.id];W=Math.max(W,z),i[F.outboundLayer.id]=W,o[F.outboundLayer.id]=F.outboundLayer,t[F.id]=W;for(let X=0;X<F.inboundLayers.length;X++){const Q=F.inboundLayers[X],J=F.nodeIndices[X],te=Q.inboundNodes[J],ie=t[te.id]==null?0:t[te.id];t[te.id]=Math.max(W+1,ie),s[te.id]=te}}const C={};for(const F in t){const W=t[F];W in C||(C[W]=[]),C[W].push(s[F])}const k={};for(const F in i){const W=i[F];W in k||(k[W]=[]),k[W].push(o[F])}let N=Object.keys(k).map(F=>parseInt(F,10)).sort(H0);this.layers=[];for(const F of N){const W=k[F];W.sort((z,X)=>{const Q=c[z.id],J=c[X.id];return Q<J?-1:Q>J?1:0});for(const z of W)z instanceof Oa&&this.internalContainerRefs.push(z),this.layers.push(z)}this.layersByDepth=k,N=Object.keys(C).map(F=>parseInt(F,10)).sort(H0);const R=this.inputs.slice(),P=[];for(const F of N)for(const W of C[F]){const z=W.outboundLayer;if(z!=null){for(const X of W.inputTensors)if(R.indexOf(X)===-1)throw new na(`Graph disconnected: cannot obtain value for tensor ${X} at layer "${z.name}". The following previous layers were accessed without issue: ${P}`);for(const X of W.outputTensors)R.push(X);P.push(z.name)}}this.nodesByDepth=C;const L=this.layers.map(F=>F.name);for(const F of L){const W=L.filter(z=>z===F).length;if(W!==1)throw new na(`The name "${F}" is used ${W} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(L))}this.outboundNodes=[],this.inboundNodes=[],new t1({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(F=>null),outputMasks:this.outputs.map(F=>null),inputShapes:this.inputs.map(F=>F.shape),outputShapes:this.outputs.map(F=>F.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new he("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.layers)t.push(...s.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const s={};let i=0;const o=Z8(e);o&&this.parseWeights(e);for(const h of this.layers)for(const[f,g]of h.weights.entries()){const y=o?`${g.name.split("/").slice(0,-1).join("/")+"/"}${f}`:g.originalName;if(s[y]!=null)throw new he(`Duplicate weight name: ${y}`);s[y]=g,i++}const c=[];for(const h in e){let f=h;if(s[h]==null){const g=h.split("/");f=g.slice(0,-2).concat([g[g.length-1]]).join("/")}if(s[f]!=null)c.push([s[f],e[h]]);else if(t)throw new he(`Provided weight data has no target variable: ${h}`);delete s[f]}if(t){const h=[];for(const f in s)h.push(f);if(h.length>0)throw new he(`${h.length} of ${i} weights are not set: ${h}`)}Py(c)}parseWeights(e){for(const t in Object.keys(e)){const s=t.split("/"),i=["vars","layer_checkpoint_dependencies"],o=s.map(c=>c.startsWith("_")?c.slice(1):c).filter(c=>!i.includes(c)).join("/");o!==t&&(e[o]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${jT}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const s=zy(this.updatedConfig());return t?JSON.stringify(s):s}call(e,t){return ye(()=>{e=gn(e);const s=new ou;for(let i=0;i<this.inputs.length;++i)s.add(this.inputs[i],e[i]);return zf(this.outputs,s,t)})}computeMask(e,t){return ye(()=>{e=gn(e);let s;return t==null?s=Oc(null,e.length):s=gn(t),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const t=q0(e);if(t.length!==this.inputLayers.length)throw new he(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let h=0;h<t.length;h++){const f=this.inputLayers[h],g=t[h],y=f.name+"_0_0";s[y]=g}const i=Object.keys(this.nodesByDepth).map(h=>parseInt(h,10)).sort(H0);if(i.length>1)for(const h of i){const f=this.nodesByDepth[h];for(const g of f){const y=g.outboundLayer;if(this.inputLayers.map(R=>R.id).indexOf(y.id)!==-1)continue;const I=[];for(let R=0;R<g.inboundLayers.length;R++){const P=g.inboundLayers[R],L=g.nodeIndices[R],F=g.tensorIndices[R],W=`${P.name}_${L}_${F}`,z=s[W];I.push(z)}const C=y.computeOutputShape(Zs(I)),k=q0(C),N=y.inboundNodes.indexOf(g);for(let R=0;R<k.length;R++){const P=`${y.name}_${N}_${R}`;s[P]=k[R]}}}const o=[],c=[];for(let h=0;h<this.outputLayers.length;h++){const f=this.outputLayers[h],g=this.outputLayersNodeIndices[h],y=this.outputLayersTensorIndices[h],I=`${f.name}_${g}_${y}`;c.push(I)}for(let h=0;h<c.length;h++){const f=c[h];fo(f in s),o.push(s[f])}return Zs(o)}runInternalGraph(e,t){t==null&&(t=Oc(null,e.length));const s={};for(let f=0;f<this.inputs.length;++f){const g=this.inputs[f],y=e[f],I=t[f];s[g.id]=[y,I]}const i=Object.keys(this.nodesByDepth).map(f=>parseInt(f,10)).sort(H0);for(const f of i){const g=this.nodesByDepth[f];for(const y of g){const I=y.outboundLayer,C=y.inputTensors,k=y.outputTensors,N=new Array;for(const R of C)R.id in s&&N.push(s[R.id]);if(N.length===C.length){let R={},P,L,F,W;if(y.callArgs!=null&&(R=y.callArgs),N.length===1){const[z,X]=N[0];R.mask==null&&(R.mask=X),F=gn(I.call(z,R)),W=gn(I.computeMask(z,X)),P=[z],L=[X]}else P=N.map(z=>z[0]),L=N.map(z=>z[1]),R.mask==null&&(R.mask=L),F=gn(I.call(P,R)),W=gn(I.computeMask(P,L));if(I.activityRegularizer)throw new Vt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let z=0;z<k.length;++z){const X=k[z],Q=F[z],J=W[z];s[X.id]=[Q,J]}}}}const o=[],c=[],h=[];for(const f of this.outputs){fo(f.id in s,`Could not compute output ${f.name} : ${f.id}`);const[g,y]=s[f.id];h.push(g.shape),o.push(g),c.push(y)}return[o,c,h]}buildNodeConversionMap(e){const t={};let s;for(const i of this.layers){s=i instanceof Oa?1:0;for(let o=0;o<i.inboundNodes.length;o++){const c=Oa.nodeKey(i,o);this.containerNodes.has(c)&&(t[c]=s,s+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new he("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new he(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new he(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return ye(()=>{const e=[];for(const t of this.layers)for(let s=0;s<t.inboundNodes.length;++s){const i=Oa.nodeKey(t,s);this.containerNodes.has(i)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),s=[];for(const c of this.layers){const h=c.getClassName(),f=c.getConfig(),g=[];for(let I=0;I<c.inboundNodes.length;I++){const C=c.inboundNodes[I],k=Oa.nodeKey(c,I);let N={};if(this.containerNodes.has(k)){if(C.callArgs)try{JSON.stringify(C.callArgs),N=C.callArgs}catch{console.warn(`Layer ${c.name} was passed non-serializable keyword arguments: ${C.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),N={}}if(C.inboundLayers.length>0){const R=[];for(let P=0;P<C.inboundLayers.length;P++){const L=C.inboundLayers[P],F=C.nodeIndices[P],W=C.tensorIndices[P],z=Oa.nodeKey(L,F);let X=t[z];X==null&&(X=0),R.push([L.name,X,W,N])}g.push(R)}}}const y={};y.name=c.name,y.className=h,y.config=f,y.inboundNodes=g,s.push(y)}e.layers=s;const i=[];for(let c=0;c<this.inputLayers.length;c++){const h=this.inputLayers[c],f=this.inputLayersNodeIndices[c],g=Oa.nodeKey(h,f);if(!this.containerNodes.has(g))continue;let y=t[g];y==null&&(y=0);const I=this.inputLayersTensorIndices[c];i.push([h.name,y,I])}e.inputLayers=i;const o=[];for(let c=0;c<this.outputLayers.length;c++){const h=this.outputLayers[c],f=this.outputLayersNodeIndices[c],g=Oa.nodeKey(h,f);if(!this.containerNodes.has(g))continue;let y=t[g];y==null&&(y=0);const I=this.outputLayersTensorIndices[c];o.push([h.name,y,I])}return e.outputLayers=o,e}static fromConfig(e,t,s={},i=!1){const o={},c={};function h(P,L){P.name in c?c[P.name].push(L):c[P.name]=[L]}function f(P,L){const F=[];let W;for(const z of L){const X=z[0],Q=z[1],J=z[2];if(W=z[3]==null?{}:z[3],!(X in o)){h(P,L);return}const te=o[X];if(te.inboundNodes.length<=Q){h(P,L);return}const ie=te.inboundNodes[Q];F.push(ie.outputTensors[J])}F.length>0&&P.apply(Zs(F),W)}function g(P){const L=P.name,F=ll(P,t.customObjects!=null?t.customObjects:{});F.setFastWeightInitDuringBuild(i),o[L]=F,P.inboundNodes.forEach(W=>{if(!(W instanceof Array))throw new he(`Corrupted configuration, expected array for nodeData: ${W}`);h(F,W)})}const y=t.name,I=t.layers;for(const P of I)g(P);for(;!Az(c);)for(const P of I){const L=o[P.name];if(L.name in c){const F=c[L.name];delete c[L.name];for(const W of F)f(L,W)}}const C=[],k=[],N=t.inputLayers;for(const P of N){const L=P[0],F=P[1],W=P[2];fo(L in o);const z=o[L].inboundNodes[F].outputTensors;C.push(z[W])}const R=t.outputLayers;for(const P of R){const L=P[0],F=P[1],W=P[2];fo(L in o);const z=o[L].inboundNodes[F].outputTensors;k.push(z[W])}return new e({inputs:C,outputs:k,name:y})}get stateful(){if(this._stateful)throw new he("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){ye(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function K8(n,e,t){const s=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(i=>null);if(s===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==s)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const i=[];return e.forEach(o=>{o in n?i.push(n[o]):i.push(null)}),i}else throw new Error(`The model has multiple (${s}) outputs, so ${t} must be either an array with ${s} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function YT(n,e){return K8(n,e,"classWeight")}async function QT(n,e,t,s){if(t!=null){const i=ye(()=>{if(n.shape.length===1)return Cc(n);if(n.shape.length===2){if(n.shape[1]>1)return vf(n,1);if(n.shape[1]===1)return ge(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),o=Array.from(await i.data());$t(i);const c=[];return o.forEach(h=>{if(t[h]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${h} exists in the data but not in classWeight`);c.push(t[h])}),oi(c,"float32")}else return null}function $8(n,e){return pe(n,e)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const U8=32;function JT(n,e){let t,s;const i=e;t=i.xs,s=i.ys,D(t!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const o=qT("input",n.inputNames,t),c=qT("output",n.outputNames,s),h=o[0].shape[0];D(o.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${o.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),D(c.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${c.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let f=0;f<o.length;f++)D(o[f].shape[0]===h,()=>`Batch size mismatch: input ${n.inputNames[f]} has ${o[f].shape[0]}; expected  ${h} based on input ${n.inputNames[0]}.`);for(let f=0;f<c.length;f++)D(c[f].shape[0]===h,()=>`Batch size mismatch: output ${n.outputNames[f]} has ${c[f].shape[0]}; expected  ${h} based on input ${n.inputNames[0]}.`);return{xs:o,ys:c}}function qT(n,e,t){if(t instanceof Mr)return[t];if(Array.isArray(t))return D(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const s=[];for(const i of e){if(t[i]==null)throw new he(`The feature data generated by the dataset lacks the required ${n} key '${i}'.`);s.push(t[i])}return s}}function H8(n){if(n.length===3)throw new Vt("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function j8(n,e,t){const s=t.batchesPerEpoch!=null;if(D(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),D(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),D(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),D(!s||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),D(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const i=t.validationData!=null;let o,c;if(i)if(ek(t.validationData))D(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const P=H8(t.validationData);o=P.xs,c=P.ys}const h=n.makeTrainFunction(),f=n.getDedupedMetricsNames();let g;i?g=f.slice().concat(f.map(P=>"val_"+P)):g=f.slice();const y=VT(t.callbacks,t.yieldEvery),I=t.verbose==null?1:t.verbose,{callbackList:C,history:k}=BT(y,I,t.epochs,null,null,Y8(e,t),null,i,g);C.setModel(n),n.history=k,await C.onTrainBegin(),n.stopTraining_=!1;let N=t.initialEpoch==null?0:t.initialEpoch,R=await e.iterator();for(;N<t.epochs;){const P={};await C.onEpochBegin(N);let L=0,F=0;for(s||(R=await e.iterator());!s||L<t.batchesPerEpoch;){const W=await R.next();if(s&&W.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${L} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(W.value!=null){const{xs:z,ys:X}=JT(n,W.value),Q={};Q.batch=F,Q.size=z[0].shape[0],await C.onBatchBegin(F,Q);const J=[];if(t.classWeight!=null){const oe=YT(t.classWeight,n.outputNames);for(let Ce=0;Ce<oe.length;++Ce)J.push(await QT(X[Ce],null,oe[Ce]))}const te=z.concat(X).concat(J),ie=h(te);$t(te);for(let oe=0;oe<f.length;++oe){const Ce=f[oe],Se=ie[oe];Q[Ce]=Se,Ci(Se)}await C.onBatchEnd(F,Q),GT(Q),F++,L++}if(s?L>=t.batchesPerEpoch:W.done){if(i){let z;ek(t.validationData)?z=gn(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):z=gn(n.evaluate(o,c,{batchSize:t.validationBatchSize==null?U8:t.validationBatchSize,verbose:0}));for(let X=0;X<n.metricsNames.length;++X)P[`val_${n.metricsNames[X]}`]=z[X]}break}if(n.stopTraining_)break}if(await C.onEpochEnd(N,P),N++,n.stopTraining_)break}return await C.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function Y8(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function ek(n){return typeof n.iterator=="function"}function Q8(n){return typeof n.next=="function"}async function J8(n,e,t){t=t||{};const s=t.batches!=null,i=n.testFunction;let o=[];if(t.verbose>0)throw new Vt("Verbose mode is not implemented yet.");D(!s||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const c=Q8(e)?e:await e.iterator();let h=0,f=0;for(;!s||f<t.batches;){const g=await c.next();if(o=ye(()=>{if(g.value){const{xs:y,ys:I}=JT(n,g.value),C=y.concat(I),k=ye(()=>i(C));if($t(C),f===0)for(let R=0;R<k.length;++R)o.push(hn(0));const N=C[0].shape[0];for(let R=0;R<k.length;++R){const P=k[R],L=o[R];o[R]=ye(()=>Ue(o[R],pe(N,P))),f>0&&$t(L)}$t(k),h+=N,++f}return o}),g.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let g=0;g<o.length;++g){const y=o[g];o[g]=Et(o[g],h),$t(y)}return Zs(o)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function Xy(n){D(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function $f(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(s=>_c(s,e,t-e)):_c(n,e,t-e)}function Zy(n,e){return ye(()=>n==null?null:Array.isArray(n)?n.map(t=>Zy(t,e)):xT(n,e.dtype==="int32"?e:at(e,"int32")))}function Ky(n,e){const t=[];let s=0,i=null;for(;s<n;)i=s+e,i>=n&&(i=n),t.push([s,i]),s=i;return t}function tk(n){const e=[];n instanceof Mr&&(n=[n]);for(let t=0;t<n.length;++t){const s=n[t];if(s.rank===1)e.push(_f(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function Pa(n,e){if(n==null)return;const t=[];if(e instanceof Mr)t.push(e.id);else if(Array.isArray(e))e.forEach(i=>t.push(i.id));else if(e!=null)for(const i in e){const o=e[i];t.push(o.id)}const s=[];if(n instanceof Mr)t.indexOf(n.id)===-1&&s.push(n);else if(Array.isArray(n))n.forEach(i=>{t.indexOf(i.id)===-1&&s.push(i)});else if(n!=null)for(const i in n){const o=n[i];t.indexOf(o.id)===-1&&s.push(o)}s.forEach(i=>{i.isDisposed||i.dispose()})}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function q8(n){return n instanceof Mr}function $y(n){return Array.isArray(n)}function nk(n){return!q8(n)&&!$y(n)}function rk(n,e,t,s=!0,i=""){if(e==null||e.length===0){if(n!=null){let c=!1;if($y(n)&&n.length>0)c=!0;else if(nk(n)){for(const h in n)if(n.hasOwnProperty(h)){c=!0;break}}else c=!0;if(c)throw new he(`Error when checking model ${i} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(c=>null);let o;if(nk(n)){n=n,o=[];for(const c of e){if(n[c]==null)throw new he(`No data provided for "${c}". Need data for each key in: ${e}`);o.push(n[c])}}else if($y(n)){if(n=n,n.length!==e.length)throw new he(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);o=n}else{if(n=n,e.length>1)throw new he(`The model ${i} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);o=[n]}if(o=tk(o),t!=null)for(let c=0;c<e.length;++c){if(t[c]==null)continue;const h=o[c];if(h.shape.length!==t[c].length)throw new he(`Error when checking ${i}: expected ${e[c]} to have ${t[c].length} dimension(s). but got array with shape ${h.shape}`);for(let f=0;f<t[c].length;++f){if(f===0&&!s)continue;const g=h.shape[f],y=t[c][f];if(y!=null&&y>=0&&g!==y)throw new he(`${i} expected a batch of elements where each example has shape [${t[c].slice(1,t[c].length)}] (i.e.,tensor shape [*,${t[c].slice(1,t[c].length)}]) but the ${i} received an input with ${h.shape[0]} examples, each with shape [${h.shape.slice(1,h.shape.length)}] (tensor shape [${h.shape}])`)}}return o}function e6(n,e,t){const s=su(n.map(o=>o.shape[0]));s.sort();const i=su(e.map(o=>o.shape[0]));if(i.sort(),s.length>1)throw new he(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(o=>o.shape))}`);if(i.length>1)throw new he(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(o=>o.shape))}`);if(s.length>0&&i.length>0&&!se(s,i))throw new he(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${i[0]} target sample(s).`)}function t6(n,e,t){const s=[i1,o1,Kf];for(let i=0;i<n.length;++i){const o=n[i],c=e[i],h=t[i];if(c!=null){if(c===Kf&&o.shape[o.shape.length-1]===1)throw new he(`You are passing a target array of shape ${o.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(c)!==-1){const f=o.shape.slice(1),g=h.slice(1);for(let y=0;y<f.length;++y){const I=f[y],C=g[y];if(C!=null&&I!==C)throw new he(`A target Tensor with shape ${o.shape} was passed for an output of shape ${h}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function sk(n,e,t,s=!0,i=""){let o;if(Array.isArray(n)){if(n.length!==e.length)throw new he(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);o=n}else{if(e.length>1)throw new he(`The model expects ${e.length} ${i} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);o=[n]}if(t!=null)for(let c=0;c<e.length;++c){if(t[c]==null)continue;const h=o[c];if(h.shape.length!==t[c].length)throw new he(`Error when checking ${i}: expected ${e[c]} to have ${t[c].length} dimension(s), but got array with shape ${JSON.stringify(h.shape)}`);for(let f=0;f<t[c].length;++f){if(f===0&&!s)continue;const g=h.shape[f],y=t[c][f];if(y!=null&&y!==g)throw new he(`Error when checking ${i}: expected ${e[c]} to have shape ${JSON.stringify(t[c])} but got array with shape ${JSON.stringify(h.shape)}.`)}}}function n6(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(s=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(s=>t);{const s=[];for(const i of e){let o=t.hasOwnProperty(i)?t[i]:[];Array.isArray(o)||(o=[o]),s.push(o)}return s}}const r6="layers-model";class id extends Oa{constructor(e){super(e),this.isTraining=!1}summary(e,t,s=console.log){if(!this.built)throw new he("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");V8(this,e,t,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=_8(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof ru))throw new he("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const c in e.loss)if(this.outputNames.indexOf(c)===-1)throw new he(`Unknown entry in loss dictionary: "${c}". Only expected the following keys: ${this.outputNames}`);for(const c of this.outputNames)e.loss[c]==null&&console.warn(`Output "${c}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${c} during training`),t.push(Vy(e.loss[c]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new he(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(c=>Vy(c))}else{const c=Vy(e.loss);this.outputs.forEach(h=>{t.push(c)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let c=0;c<this.outputs.length;++c){const h=this.internalOutputShapes[c],f=this.outputNames[c];this.feedOutputNames.push(f),this.feedOutputShapes.push(h),this.feedLossFns.push(this.lossFunctions[c])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Gc("loss",()=>{for(let c=0;c<this.outputs.length;++c){if(s.indexOf(c)!==-1)continue;const h=this.lossFunctions[c];this.outputs.length>1&&(this.metricsTensors.push([h,c]),this.metricsNames.push(this.outputNames[c]+"_loss"))}});const i=n6(e.metrics,this.outputNames),o=(c,h,f)=>{this.outputNames.length>1&&(h=this.outputNames[c]+"_"+h),this.metricsNames.push(h),this.metricsTensors.push([f,c])};Gc("metric",()=>{for(let c=0;c<this.outputs.length;++c){if(s.indexOf(c)!==-1)continue;const h=i[c];(f=>{const g="";let y,I,C;for(const k of f){if(typeof k=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(k)!==-1){const R=this.internalOutputShapes[c];R[R.length-1]===1||this.lossFunctions[c]===o1?["accuracy","acc"].indexOf(k)!==-1?I=zT:["crossentropy","ce"].indexOf(k)!==-1&&(I=N8):this.lossFunctions[c]===a1?["accuracy","acc"].indexOf(k)!==-1?I=A8:["crossentropy","ce"].indexOf(k)!==-1&&(I=KT):["accuracy","acc"].indexOf(k)!==-1?I=XT:["crossentropy","ce"].indexOf(k)!==-1&&(I=ZT);let P;["accuracy","acc"].indexOf(k)!==-1?P="acc":["crossentropy","ce"].indexOf(k)!==-1&&(P="ce"),C=I,y=g+P}else C=G8(k),y=g+c1(k);let N;Gc(y,()=>{N=C}),o(c,y,N)}})(h)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,s={}){const i=s.batchSize==null?32:s.batchSize;Xy(i);const o=this.standardizeUserDataXY(e,t,!0,i);try{const c=o[0].concat(o[1]);this.makeTestFunction();const h=this.testFunction,f=this.testLoop(h,c,i,s.verbose,s.steps);return Zs(f)}finally{Pa(o[0],e),Pa(o[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),J8(this,e,t)}checkNumSamples(e,t,s,i="steps"){let o;if(s!=null){if(o=null,t!=null)throw new he(`If ${i} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?o=e[0].shape[0]:o=e.shape[0];else throw new he(`Either the input data should have a defined shape, or ${i} shoud be specified.`);return o}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new he("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(t),i=s?t:[t],o=this.retrieveSymbolicTensors(i),c=new ou;if(e instanceof Mr&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new he(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let f=0;f<this.inputs.length;++f)c.add(this.inputs[f],e[f])}else for(const f of this.inputs){const g=e[f.name];if(g==null)throw new he(`No value is provided for the model's input ${f.name}`);c.add(f,g)}const h=zf(o,c);return s?h:h[0]}retrieveSymbolicTensors(e){const t=Oc(null,e.length);let s=e.length;for(const i of this.layers){const o=Array.isArray(i.output)?i.output:[i.output],c=o.map(h=>h.name);for(let h=0;h<e.length;++h){const f=c.indexOf(e[h]);if(f!==-1&&(t[h]=o[f],s--),s===0)break}if(s===0)break}if(s>0){const i=[];throw t.forEach((o,c)=>{o==null&&i.push(e[c])}),new he(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(i)}`)}return t}predictLoop(e,t=32,s=!1){return ye(()=>{const i=this.checkNumSamples(e);if(s)throw new Vt("Verbose predictLoop() is not implemented yet.");const o=Ky(i,t),c=this.outputs.map(h=>[]);for(let h=0;h<o.length;++h)ye(()=>{const f=o[h][0],g=o[h][1],y=$f(e,f,g),I=[];if(Array.isArray(y))for(let k=0;k<y.length;++k)I.push({key:this.inputs[k],value:y[k]});else I.push({key:this.inputs[0],value:y});const C=new ou(I);return zf(this.outputs,C)}).forEach((f,g)=>c[g].push(f));return Zs(c.map(h=>zs(h,0)))})}predict(e,t={}){const s=tk(e);sk(s,this.inputNames,this.feedInputShapes,!1);try{const i=t.batchSize==null?32:t.batchSize;return Xy(i),this.predictLoop(s,i)}finally{Pa(s,e)}}predictOnBatch(e){sk(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,s=!0,i){if(this.optimizer_==null)throw new na("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const o=[];for(let c=0;c<this.feedOutputShapes.length;++c){const h=this.feedOutputShapes[c];this.feedLossFns[c]===a1?o.push(h.slice(0,h.length-1).concat([1])):o.push(h)}if(e=rk(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=rk(t,this.feedOutputNames,o,!1,"target"),e6(e,t),t6(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&i!=null&&i>0&&e[0].shape[0]%i!==0)throw new he(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${i}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,s,i,o=!0,c){const[h,f]=this.standardizeUserDataXY(e,t,o,c);if(s!=null)throw new Error("sample weight is not supported yet.");let g=null;if(i!=null){const y=YT(i,this.outputNames);g=[];for(let I=0;I<y.length;++I)g.push(await QT(f[I],null,y[I]))}return[h,f,g]}testLoop(e,t,s,i=0,o){return ye(()=>{const c=this.checkNumSamples(t,s,o,"steps"),h=[];if(i>0)throw new Vt("Verbose mode is not implemented yet.");if(o!=null)throw new Vt("steps mode in testLoop() is not implemented yet");{const f=Ky(c,s),g=oi(Ma(0,c));for(let y=0;y<f.length;++y){const I=f[y][0],C=f[y][1],k=_c(g,I,C-I),N=Zy(t,k),R=e(N);if(y===0)for(let P=0;P<R.length;++P)h.push(hn(0));for(let P=0;P<R.length;++P){const L=R[P];h[P]=Ue(h[P],pe(C-I,L))}}for(let y=0;y<h.length;++y)h[y]=Et(h[y],c)}return h})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let s=0;s<e.length;++s){const i=e[s];let o=i;if(oT(e,i)>1){const c=oT(e.slice(0,s),i);o+=`_${c}`}t.push(o)}return t}makeTrainFunction(){return e=>{const t=[],s=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),c=[],h=()=>{const g=[];for(let k=0;k<this.inputs.length;++k)g.push({key:this.inputs[k],value:s[k]});const y=new ou(g),I=zf(this.outputs,y,{training:!0});let C;for(let k=0;k<this.lossFunctions.length;++k){const N=this.lossFunctions[k];let R=N(i[k],I[k]);o[k]!=null&&(R=$8(R,o[k]));const P=Er(R);t.push(P),k===0?C=R:C=Ue(C,R)}for(let k=0;k<this.metricsTensors.length;++k){let N;if(this.outputs.length>1&&k<this.outputs.length)N=t[k];else{const R=this.metricsTensors[k][0],P=this.metricsTensors[k][1];N=Er(R(i[P],I[P]))}Ci(N),c.push(N)}return C=Er(C),this.calculateLosses().forEach(k=>{C=Ue(C,k)}),C},f=this.collectedTrainableWeights.map(g=>g.read());return[this.optimizer_.minimize(h,!0,f)].concat(c)}}makeTestFunction(){this.testFunction=e=>ye(()=>{const t=[];let s;const i=e.slice(0,this.inputs.length),o=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),c=[];for(let g=0;g<this.inputs.length;++g)c.push({key:this.inputs[g],value:i[g]});const h=new ou(c),f=zf(this.outputs,h);for(let g=0;g<this.lossFunctions.length;++g){const y=this.lossFunctions[g],I=Er(y(o[g],f[g]));g===0?s=I:s=Ue(s,I),t.push(s)}for(let g=0;g<this.metricsTensors.length;++g){const y=this.metricsTensors[g][0],I=this.metricsTensors[g][1],C=Er(y(o[I],f[I]));t.push(C)}return t})}async fit(e,t,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let i,o,c,h,f,g,y,I,C;try{const k=s.batchSize==null?32:s.batchSize;Xy(k);const N=await this.standardizeUserData(e,t,s.sampleWeight,s.classWeight,!1,k);i=N[0],o=N[1],C=N[2];let R=!1,P;if(s.validationData!=null&&s.validationData.length>0){if(R=!0,s.validationData.length===2)f=s.validationData[0],g=s.validationData[1];else throw s.validationData.length===3?new Vt("validationData including sample weights is not supported yet."):new he(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const J=await this.standardizeUserData(f,g,null,null,!0,k);y=J[0],I=J[1],P=y.concat(I)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){R=!0;const J=Math.floor(i[0].shape[0]*(1-s.validationSplit)),te=i[0].shape[0];y=$f(i,J,te),c=i,i=$f(i,0,J),I=$f(o,J,te),h=o,o=$f(o,0,J),P=y.concat(I)}else s.validationSteps!=null&&(R=!0);const L=i.concat(o).concat(C);this.checkTrainableWeightsConsistency();const F=this.makeTrainFunction(),W=this.getDedupedMetricsNames();let z,X;R?(this.makeTestFunction(),z=this.testFunction,X=W.slice().concat(W.map(J=>"val_"+J))):(z=null,P=[],X=W.slice());const Q=VT(s.callbacks,s.yieldEvery);return await this.fitLoop(F,L,W,k,s.epochs,s.verbose,Q,z,P,s.shuffle,X,s.initialEpoch,null,null)}finally{this.isTraining=!1,Pa(i,e),Pa(o,t),Pa(c,e),Pa(h,t),Pa(y,f),Pa(I,g),C!=null&&$t(C)}}async fitLoop(e,t,s,i,o,c,h,f,g,y,I,C,k,N){i==null&&(i=32),o==null&&(o=1),y==null&&(y=!0),C==null&&(C=0);let R=!1;if(f!=null&&g!=null&&(R=!0),N!=null&&(R=!0,k==null))throw new he("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const P=this.checkNumSamples(t,i,k,"steps_per_epoch");let L;P!=null&&(L=Ma(0,P)),c==null&&(c=1);const{callbackList:F,history:W}=BT(h,c,o,C,P,k,i,R,I);F.setModel(this),this.history=W,await F.onTrainBegin(),this.stopTraining_=!1;for(let z=C;z<o;++z){await F.onEpochBegin(z);const X={};if(k!=null)throw new Vt("stepsPerEpoch mode is not implemented yet.");{if(y==="batch")throw new Vt("batch shuffling is not implemneted yet");y&&T(L);const Q=oi(L),J=Ky(P,i);for(let te=0;te<J.length;++te){const ie={};if(await F.onBatchBegin(te,ie),ye(()=>{const oe=J[te][0],Ce=J[te][1],Se=_c(Q,oe,Ce-oe);ie.batch=te,ie.size=Ce-oe;const Te=Zy(t,Se),Le=e(Te);for(let Me=0;Me<s.length;++Me){const Oe=s[Me],Ve=Le[Me];ie[Oe]=Ve,Ci(Ve)}if(te===J.length-1&&R){const Me=this.testLoop(f,g,i);for(let Oe=0;Oe<s.length;++Oe){const Ve=s[Oe],_e=Me[Oe];Ci(_e),X["val_"+Ve]=_e}}}),await F.onBatchEnd(te,ie),GT(ie),this.stopTraining_)break}Q.dispose()}if(await F.onEpochEnd(z,X),this.stopTraining_)break}return await F.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return j8(this,e,t)}async trainOnBatch(e,t){const s=await this.standardizeUserData(e,t),i=s[0],o=s[1],c=this.makeTrainFunction()(i.concat(o)),h=[];for(const f of c){const g=await f.data();h.push(g[0])}return $t(c),Pa(s[0],e),Pa(s[1],t),Zs(h)}getNamedWeights(e){const t=[],s=e!=null&&e.trainableOnly,i=s?this.trainableWeights:this.weights,o=this.getWeights(s);for(let c=0;c<i.length;++c)s&&!i[c].trainable||t.push({name:i[c].originalName,tensor:o[c]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=tx().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-tx().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=al(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>al(t))}else{const t=Object.keys(this.loss);e={};const s=this.loss;for(const i of t)if(typeof s[i]=="string")e[i]=al(s[i]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[al(c1(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>al(c1(e)));{const e={};for(const t in this.metrics)e[t]=al(c1(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=Wy(e.optimizer_config),s=ll(t);let i;if(typeof e.loss=="string")i=Pc(e.loss);else if(Array.isArray(e.loss))i=e.loss.map(c=>Pc(c));else if(e.loss!=null){i={};for(const c in e.loss)i[c]=Pc(e.loss[c])}let o;if(Array.isArray(e.metrics))o=e.metrics.map(c=>Pc(c));else if(e.metrics!=null){o={};for(const c in e.metrics)o[c]=Pc(e.metrics[c])}this.compile({loss:i,metrics:o,optimizer:s})}async save(e,t){if(typeof e=="string"){const o=GP(e);if(o.length===0)throw new he(`Cannot find any save handlers for URL '${e}'`);if(o.length>1)throw new he(`Found more than one (${o.length}) save handlers for URL '${e}'`);e=o[0]}if(e.save==null)throw new he("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await fC(this.getNamedWeights(t)),i={modelTopology:this.toJSON(null,!1),format:r6,generatedBy:`TensorFlow.js tfjs-layers v${jT}`,convertedBy:null};if(t!=null&&t.includeOptimizer&&this.optimizer!=null){i.trainingConfig=this.getTrainingConfig();const o="optimizer",{data:c,specs:h}=await fC(await this.optimizer.getWeights(),o);s.specs.push(...h),s.data=FP([s.data,c])}return this.userDefinedMetadata!=null&&(UT(this.userDefinedMetadata,this.name,!0),i.userDefinedMetadata=this.userDefinedMetadata),i.weightData=s.data,i.weightSpecs=s.specs,e.save(i)}setUserDefinedMetadata(e){UT(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}id.className="Model",Ze(id);class ik extends id{}ik.className="Functional",Ze(ik);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class Uf extends id{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:Y0("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(t=>t<0))throw new he(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof Uf||e instanceof id;let s;if(t){if(s=e,s.outputs.length!==1)throw new he("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new he("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new he("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const i=a8({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(i)}if(t)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new he(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new he("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=AT(this.outputs[0])}this.inboundNodes=[],new t1({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Oc(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(i=>i.shape),outputShapes:this.outputs[0].shape})}else{const i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(sn(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new id({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,s=console.log){this.built||this.build(),super.summary(e,t,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,s={}){if(!this.built)throw new na("The model needs to be compiled before being used.");return this.model.evaluate(e,t,s)}async evaluateDataset(e,t){if(!this.built)throw new na("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,s={}){if(!this.built)throw new na("The model needs to be compiled before being used.");return this.model.fit(e,t,s)}async fitDataset(e,t){if(!this.built)throw new na("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,s={},i=!1){let o,c={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new he("Legacy serialization format not supported yet.");o=t}else D(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),o=t.layers,delete t.layers,c=t;const h=new e(c);if(!(h instanceof Uf))throw new Vt(`Sequential.fromConfig called on non-Sequential input: ${h}`);for(const f of o){const g=ll(f,void 0,i);i&&g.setFastWeightInitDuringBuild(!0),h.add(g)}return h}set stopTraining(e){if(this.model==null)throw new he("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new he("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const s={};s.className=t.getClassName(),s.config=t.getConfig(),e.push(s)}return{name:this.name,layers:e}}}Uf.className="Sequential",Ze(Uf);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/let Ks=class extends td{getConfig(){return{}}};class ak extends Ks{apply(e,t=1){return Zz(e,t)}}ak.className="elu",Ze(ak);class ok extends Ks{apply(e){return YC(e)}}ok.className="selu",Ze(ok);class lk extends Ks{apply(e){return Ac(e)}}lk.className="relu",Ze(lk);class uk extends Ks{apply(e){return ye(()=>Nf(6,Ac(e)))}}uk.className="relu6",Ze(uk);class ck extends Ks{apply(e){return e}}ck.className="linear",Ze(ck);class hk extends Ks{apply(e){return jh(e)}}hk.className="sigmoid",Ze(hk);class dk extends Ks{apply(e){return $z(e)}}dk.className="hardSigmoid",Ze(dk);class fk extends Ks{apply(e){return Ef(e)}}fk.className="softplus",Ze(fk);class pk extends Ks{apply(e){return Kz(e)}}pk.className="softsign",Ze(pk);class mk extends Ks{apply(e){return hx(e)}}mk.className="tanh",Ze(mk);let Uy=class extends Ks{apply(n,e=-1){return Rx(n,e)}};Uy.className="softmax",Ze(Uy);class gk extends Ks{apply(e,t=-1){return PC(e,t)}}gk.className="logSoftmax",Ze(gk);class xk extends Ks{apply(e,t=1){return ye(()=>pe(jh(pe(e,t)),e))}}xk.className="swish",Ze(xk);class yk extends Ks{apply(e){return ye(()=>pe(e,hx(Ef(e))))}}yk.className="mish",Ze(yk);function lu(n){return n.getClassName()}function Hy(n,e={}){return Ff(n,ta.getMap().classNameMap,e,"activation")}function uu(n){if(n==null){const e={};return e.className="linear",e.config={},Hy(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},Hy(e)}else return n instanceof Ks?n:Hy(n)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function s6(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class bk extends td{}class wk extends bk{constructor(e){super(),s6(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return ye(()=>{let t=Zr([1]);return this.hasL1&&(t=Ue(t,It(pe(this.l1,ks(e))))),this.hasL2&&(t=Ue(t,It(pe(this.l2,Vf(e))))),ge(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}wk.className="L1L2",Ze(wk);const vk={l1l2:"L1L2"};function Tn(n){return yy(n)}function Ik(n,e={}){return Ff(n,ta.getMap().classNameMap,e,"regularizer")}function jn(n){if(n==null)return null;if(typeof n=="string"){const e={className:n in vk?vk[n]:n,config:{}};return Ik(e)}else return n instanceof bk?n:Ik(n)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class Ck extends Zt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=Rt(e);let s=Ac(e);return this.maxValue!=null&&(s=Si(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}Ck.className="ReLU",Ze(Ck);class Sk extends Zt{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=Rt(e);return wx(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}Sk.className="LeakyReLU",Ze(Sk);class Tk extends Zt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Hn(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=jn(e.alphaRegularizer),this.alphaConstraint=Fr(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new he(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=sn(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const i of this.sharedAxes)t[i-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let i=1;i<e.length;++i)s[i]=e[i];this.inputSpec=[new Or({ndim:e.length,axes:s})],this.built=!0}call(e,t){return e=Rt(e),kx(e,this.alpha.read())}getConfig(){const e={alphaInitializer:tr(this.alphaInitializer),alphaRegularizer:Tn(this.alphaRegularizer),alphaConstraint:Pr(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}Tk.className="PReLU",Ze(Tk);let kk=class extends Zt{constructor(n){if(super(n??{}),this.DEFAULT_ALPHA=1,n==null&&(n={}),n.alpha!=null&&n.alpha!==this.DEFAULT_ALPHA)throw new Vt(`Non-default alpha value (${n.alpha}) is not supported by the ELU layer yet.`);this.alpha=n.alpha==null?this.DEFAULT_ALPHA:n.alpha}call(n,e){const t=Rt(n);return P0(t)}computeOutputShape(n){return n}getConfig(){const n={alpha:this.alpha},e=super.getConfig();return Object.assign(n,e),n}};kk.className="ELU",Ze(kk);class Ek extends Zt{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const s=Rt(e);return pe(s,at(Ti(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}Ek.className="ThresholdedReLU",Ze(Ek);class Nk extends Zt{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new Uy().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return ye(()=>{let s=Rt(e);const i=t.mask;if(i!=null){const o=pe(Nt(nu(s.shape),at(i,s.dtype)),hn(-1e9));s=Ue(s,o)}return this.axis instanceof Array?this.axis.length>1?oo(Nt(s,FC(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}Nk.className="Softmax",Ze(Nk);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function ad(n,e,t){if(typeof n=="number")return Oc(n,e);if(n.length!==e)throw new he(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let s=0;s<e;++s){const i=n[s];if(!Bz(i))throw new he(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${i}`)}return n}function Fa(n,e,t,s,i=1){if(n==null)return n;const o=e+(e-1)*(i-1);let c;return t==="same"?c=n:c=n-o+1,Math.floor((c+s-1)/s)}function go(n,e,t,s){if(n==null)return null;if(s==="valid")n=n*e+au([t-e,0]);else if(s==="same")n=n*e;else throw new he(`Unsupport padding mode: ${s}.`);return n}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function jy(n,e){return ye(()=>(yr(e),e==="channelsFirst"?tn(n,[0,2,3,1]):n))}function Ak(n,e){return ye(()=>(yr(e),e==="channelsFirst"?tn(n,[0,2,3,4,1]):n))}function i6(n,e,t,s=1,i="valid",o,c=1){return ye(()=>{if(o==null&&(o=La()),yr(o),n.shape.length!==3)throw new he(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new he(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new he(`The bias for a conv1dWithBias operation should be 1, but is ${e.shape.length} instead`);if(o==="channelsFirst"&&(n=tn(n,[0,2,1])),i==="causal")throw new Vt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let h=TC(n,e,s,i==="same"?"same":"valid","NWC",c);return t!=null&&(h=Da(h,t)),h})}function Rk(n,e,t,s=[1,1],i="valid",o,c,h=null){return ye(()=>{if(o==null&&(o=La()),yr(o),n.rank!==3&&n.rank!==4)throw new he(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new he(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let f=jy(n,o);if(i==="causal")throw new Vt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return f=fV({x:f,filter:e,strides:s,pad:i==="same"?"same":"valid",dilations:c,dataFormat:"NHWC",bias:t,activation:h}),o==="channelsFirst"&&(f=tn(f,[0,3,1,2])),f})}function a6(n,e,t,s=[1,1,1],i="valid",o,c){return ye(()=>{if(o==null&&(o=La()),yr(o),n.rank!==4&&n.rank!==5)throw new he(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new he(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let h=Ak(n,o);if(i==="causal")throw new Vt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return h=d9(h,e,s,i==="same"?"same":"valid","NDHWC",c),t!=null&&(h=Da(h,t)),o==="channelsFirst"&&(h=tn(h,[0,4,1,2,3])),h})}class d1 extends Zt{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",d1.verifyArgs(t),this.rank=e,Kr(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Vt(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=ad(t.kernelSize,e,"kernelSize"),this.strides=ad(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,Ei(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,yr(this.dataFormat),this.activation=uu(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=Hn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Fr(t.biasConstraint),this.biasRegularizer=jn(t.biasRegularizer),this.activityRegularizer=jn(t.activityRegularizer),this.dilationRate=ad(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new he(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new he(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new he(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(fo("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!wy(e.kernelSize,"number",1,3))throw new he(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:lu(this.activation),useBias:this.useBias,biasInitializer:tr(this.biasInitializer),biasRegularizer:Tn(this.biasRegularizer),activityRegularizer:Tn(this.activityRegularizer),biasConstraint:Pr(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class od extends d1{constructor(e,t){super(e,t),this.kernel=null,od.verifyArgs(t),this.filters=t.filters,Kr(this.filters,"filters"),this.kernelInitializer=Hn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Fr(t.kernelConstraint),this.kernelRegularizer=jn(t.kernelRegularizer)}build(e){e=sn(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new he(`The channel dimension of the input should be defined. Found ${e[t]}`);const s=e[t],i=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:s}}],this.built=!0}call(e,t){return ye(()=>{e=Rt(e);let s;const i=this.bias==null?null:this.bias.read(),o=uT(this.activation.getClassName());if(o!=null&&this.rank===2)s=Rk(e,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate,o);else{if(this.rank===1)s=i6(e,this.kernel.read(),i,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=Rk(e,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=a6(e,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Vt("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=sn(e);const t=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let o=0;o<s.length;++o){const c=Fa(s[o],this.kernelSize[o],this.padding,this.strides[o],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[o]);t.push(c)}let i=[e[0]];return this.dataFormat==="channelsLast"?(i=i.concat(t),i.push(this.filters)):(i.push(this.filters),i=i.concat(t)),i}getConfig(){const e={filters:this.filters,kernelInitializer:tr(this.kernelInitializer),kernelRegularizer:Tn(this.kernelRegularizer),kernelConstraint:Pr(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new he(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Hf extends od{constructor(e){super(2,e),Hf.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!wy(e.kernelSize,"number",1,2))throw new he(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Hf.className="Conv2D",Ze(Hf);class jf extends od{constructor(e){super(3,e),jf.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new he(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}jf.className="Conv3D",Ze(jf);class Mk extends Hf{constructor(e){if(super(e),this.inputSpec=[new Or({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new he(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=sn(e),e.length!==4)throw new he("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new he("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],i=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Or({ndim:4,axes:{[t]:s}})],this.built=!0}call(e,t){return ye(()=>{let s=Rt(e);if(s.shape.length!==4)throw new he(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const i=s.shape,o=i[0];let c,h;this.dataFormat==="channelsFirst"?(c=2,h=3):(c=1,h=2);const f=i[c],g=i[h],y=this.kernelSize[0],I=this.kernelSize[1],C=this.strides[0],k=this.strides[1],N=go(f,C,y,this.padding),R=go(g,k,I,this.padding),P=[o,N,R,this.filters];this.dataFormat!=="channelsLast"&&(s=tn(s,[0,2,3,1]));let L=kC(s,this.kernel.read(),P,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(L=tn(L,[0,3,1,2])),this.bias!=null&&(L=Da(L,this.bias.read(),this.dataFormat)),this.activation!=null&&(L=this.activation.apply(L)),L})}computeOutputShape(e){e=sn(e);const t=e.slice();let s,i,o;this.dataFormat==="channelsFirst"?(s=1,i=2,o=3):(s=3,i=1,o=2);const c=this.kernelSize[0],h=this.kernelSize[1],f=this.strides[0],g=this.strides[1];return t[s]=this.filters,t[i]=go(t[i],f,c,this.padding),t[o]=go(t[o],g,h,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}Mk.className="Conv2DTranspose",Ze(Mk);class Lk extends jf{constructor(e){if(super(e),this.inputSpec=[new Or({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new he(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=sn(e),e.length!==5)throw new he("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new he("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],i=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Or({ndim:5,axes:{[t]:s}})],this.built=!0}call(e,t){return ye(()=>{let s=Rt(e);if(s.shape.length!==5)throw new he(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const i=s.shape,o=i[0];let c,h,f;this.dataFormat==="channelsFirst"?(f=2,c=3,h=4):(f=1,c=2,h=3);const g=i[f],y=i[c],I=i[h],C=this.kernelSize[0],k=this.kernelSize[1],N=this.kernelSize[2],R=this.strides[0],P=this.strides[1],L=this.strides[2],F=go(g,R,C,this.padding),W=go(y,P,k,this.padding),z=go(I,L,N,this.padding),X=[o,F,W,z,this.filters];this.dataFormat!=="channelsLast"&&(s=tn(s,[0,2,3,4,1]));let Q=m9(s,this.kernel.read(),X,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(Q=tn(Q,[0,4,1,2,3])),this.bias!==null&&(Q=Da(Q,this.bias.read(),this.dataFormat)),this.activation!==null&&(Q=this.activation.apply(Q)),Q})}computeOutputShape(e){e=sn(e);const t=e.slice();let s,i,o,c;this.dataFormat==="channelsFirst"?(s=1,i=2,o=3,c=4):(s=4,i=1,o=2,c=3);const h=this.kernelSize[0],f=this.kernelSize[1],g=this.kernelSize[2],y=this.strides[0],I=this.strides[1],C=this.strides[2];return t[s]=this.filters,t[i]=go(t[i],y,h,this.padding),t[o]=go(t[o],I,f,this.padding),t[c]=go(t[c],C,g,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}Lk.className="Conv3DTranspose",Ze(Lk);class Dk extends od{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new he("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new he("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new he(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=Hn(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=jn(t.depthwiseRegularizer),this.depthwiseConstraint=Fr(t.depthwiseConstraint),this.pointwiseInitializer=Hn(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=jn(t.pointwiseRegularizer),this.pointwiseConstraint=Fr(t.pointwiseConstraint)}build(e){if(e=sn(e),e.length<this.rank+2)throw new he(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new he(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const s=e[t],i=this.kernelSize.concat([s,this.depthMultiplier]),o=[];for(let h=0;h<this.rank;++h)o.push(1);o.push(s*this.depthMultiplier,this.filters);const c=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,c,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",o,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,c,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,c,this.biasConstraint):this.bias=null,this.inputSpec=[new Or({ndim:this.rank+2,axes:{[t]:s}})],this.built=!0}call(e,t){return ye(()=>{e=Rt(e);let s;if(this.rank===1)throw new Vt("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=tn(e,[0,2,3,1])),s=QC(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=Da(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=tn(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=tr(this.depthwiseInitializer),e.pointwiseInitializer=tr(this.pointwiseInitializer),e.depthwiseRegularizer=Tn(this.depthwiseRegularizer),e.pointwiseRegularizer=Tn(this.pointwiseRegularizer),e.depthwiseConstraint=Pr(this.depthwiseConstraint),e.pointwiseConstraint=Pr(this.pointwiseConstraint),e}}Dk.className="SeparableConv";class Ok extends Dk{constructor(e){super(2,e)}}Ok.className="SeparableConv2D",Ze(Ok);class f1 extends od{constructor(e){super(1,e),f1.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!wy(e.kernelSize,"number",1,1))throw new he(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}f1.className="Conv1D",Ze(f1);class Pk extends Zt{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return ye(()=>{if(e=Rt(e),this.dataFormat==="channelsLast"){const s=Q0(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Q0(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=Q0(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Q0(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}Pk.className="Cropping2D",Ze(Pk);class Fk extends Zt{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,yr(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,Gz(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,s]}else{const t=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],t,s,e[3]]}}call(e,t){return ye(()=>{let s=Rt(e);const i=s.shape;if(this.dataFormat==="channelsFirst"){s=tn(s,[0,2,3,1]);const o=this.size[0]*i[2],c=this.size[1]*i[3],h=this.interpolation==="nearest"?rl.resizeNearestNeighbor(s,[o,c]):rl.resizeBilinear(s,[o,c]);return tn(h,[0,3,1,2])}else{const o=this.size[0]*i[1],c=this.size[1]*i[2];return this.interpolation==="nearest"?rl.resizeNearestNeighbor(s,[o,c]):rl.resizeBilinear(s,[o,c])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}Fk.className="UpSampling2D",Ze(Fk);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function o6(n,e,t=[1,1],s="valid",i,o){return ye(()=>{i==null&&(i=La()),yr(i);let c=jy(n,i);if(n.rank!==4)throw new he(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new he(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return c=gx(c,e,t,s==="same"?"same":"valid","NHWC",o),i==="channelsFirst"&&(c=tn(c,[0,3,1,2])),c})}class Gk extends d1{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=Hn(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Fr(e.depthwiseConstraint),this.depthwiseRegularizer=jn(e.depthwiseRegularizer)}build(e){if(e=sn(e),e.length<4)throw new he(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new he(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const s=e[t],i=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ye(()=>{e=Rt(e);let s=o6(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=Da(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=sn(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],i=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,o=Fa(t,this.kernelSize[0],this.padding,this.strides[0]),c=Fa(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],i,o,c]:[e[0],o,c,i]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=tr(this.depthwiseInitializer),e.depthwiseRegularizer=Tn(this.depthwiseRegularizer),e.depthwiseConstraint=Pr(this.depthwiseRegularizer),e}}Gk.className="DepthwiseConv2D",Ze(Gk);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function _k(n,e,t,s){if(Array.isArray(n)){if(e!=null||t!=null)throw new he("When inputs is an array, neither initialState or constants should be provided");s!=null&&(t=n.slice(n.length-s,n.length),n=n.slice(0,n.length-s)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function i(o){return o==null||Array.isArray(o)?o:[o]}return e=i(e),t=i(t),{inputs:n,initialState:e,constants:t}}function Vk(n,e,t,s=!1,i,o,c=!1,h=!1){return ye(()=>{const f=e.shape.length;if(f<3)throw new he(`Input should be at least 3D, but is ${f}D.`);const g=[1,0].concat(Ma(2,f));e=tn(e,g),o!=null,c&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),i!=null&&(i=at(at(i,"bool"),"float32"),i.rank===f-1&&(i=Xs(i,-1)),i=tn(i,g)),s&&(e=Rc(e,0),i!=null&&(i=Rc(i,0)));const y=[];let I,C=t;const k=e.shape[0],N=Lc(e);let R;i!=null&&(R=Lc(i));for(let L=0;L<k;++L){const F=N[L],W=ye(()=>n(F,C));if(i==null)I=W[0],C=W[1];else{const z=ye(()=>{const X=R[L],Q=Nt(ea(X),X),J=Ue(pe(W[0],X),pe(C[0],Q)),te=C.map((ie,oe)=>Ue(pe(W[1][oe],X),pe(ie,Q)));return{output:J,newStates:te}});I=z.output,C=z.newStates}h&&y.push(I)}let P;return h&&(P=uo(y,1)),[I,P,C]})}class cu extends Zt{constructor(e){super(e);let t;if(e.cell==null)throw new he("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new Jy({cells:e.cell}):t=e.cell,t.stateSize==null)throw new he("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new Or({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Ma(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){Dy(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const s=t[0];let i;if(this.returnSequences?i=[e[0],e[1],s]:i=[e[0],s],this.returnState){const o=[];for(const c of t)o.push([e[0],c]);return[i].concat(o)}else return i}computeMask(e,t){return ye(()=>{Array.isArray(t)&&(t=t[0]);const s=this.returnSequences?t:null;if(this.returnState){const i=this.states.map(o=>null);return[s].concat(i)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let s=0;s<e;++s)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new Vt("Constants support is not implemented in RNN yet.");Dy(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new Or({shape:[t,null,...s]});const i=[e[0]].concat(e.slice(2));this.cell.build(i);let o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!se(this.stateSpec.map(c=>c.shape[c.shape.length-1]),o))throw new he(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=o.map(c=>new Or({shape:[null,c]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){ye(()=>{if(!this.stateful)throw new ho("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new he("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>Zr([s,i])):this.states_=[Zr([s,this.cell.stateSize])];else if(e==null)$t(this.states_),this.keptStates!=null&&($t(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>Zr([s,i])):this.states_[0]=Zr([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new he(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):$t(this.states_);for(let i=0;i<this.states_.length;++i){const o=e[i],c=Array.isArray(this.cell.stateSize)?this.cell.stateSize[i]:this.cell.stateSize,h=[s,c];if(!se(o.shape,h))throw new he(`State ${i} is incompatible with layer ${this.name}: expected shape=${h}, received shape=${o.shape}`);this.states_[i]=o}}this.states_=this.states_.map(i=>Ci(i.clone()))})}apply(e,t){let s=t==null?null:t.initialState,i=t==null?null:t.constants;t==null&&(t={});const o=_k(e,s,i,this.numConstants);e=o.inputs,s=o.initialState,i=o.constants;let c=[],h=[];if(s!=null){t.initialState=s,c=c.concat(s),this.stateSpec=[];for(const f of s)this.stateSpec.push(new Or({shape:f.shape}));h=h.concat(this.stateSpec)}if(i!=null&&(t.constants=i,c=c.concat(i),this.numConstants=i.length),c[0]instanceof mo){const f=[e].concat(c),g=this.inputSpec.concat(h),y=this.inputSpec;this.inputSpec=g;const I=super.apply(f,t);return this.inputSpec=y,I}else return super.apply(e,t)}call(e,t){return ye(()=>{const s=t==null?null:t.mask,i=t==null?null:t.training;let o=t==null?null:t.initialState;e=Rt(e),o==null&&(this.stateful?o=this.states_:o=this.getInitialState(e));const c=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(o.length!==c)throw new he(`RNN Layer has ${c} state(s) but was passed ${o.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const h={training:i},f=Vk((k,N)=>{const R=this.cell.call([k].concat(N),h);return[R[0],R.slice(1)]},e,o,this.goBackwards,s,null,this.unroll,this.returnSequences),g=f[0],y=f[1],I=f[2];this.stateful&&this.resetStates(I,i);const C=this.returnSequences?y:g;return this.returnState?[C].concat(I):C})}getInitialState(e){return ye(()=>{let t=Zr(e.shape);return t=It(t,[1,2]),t=_f(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?Sy(t,[1,s]):t):this.cell.stateSize>1?[Sy(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===cu.className&&(t.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),t)}static fromConfig(e,t,s={}){const i=t.cell,o=ll(i,s);return new e(Object.assign(t,{cell:o}))}}cu.className="RNN",Ze(cu);class p1 extends Zt{}class Yy extends p1{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Kr(this.units,"units"),this.activation=uu(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Hn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Hn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Hn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=jn(e.kernelRegularizer),this.recurrentRegularizer=jn(e.recurrentRegularizer),this.biasRegularizer=jn(e.biasRegularizer),this.kernelConstraint=Fr(e.kernelConstraint),this.recurrentConstraint=Fr(e.recurrentConstraint),this.biasConstraint=Fr(e.biasConstraint),this.dropout=sd([1,au([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=sd([1,au([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=sn(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ye(()=>{if(e=e,e.length!==2)throw new he(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const i=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=hu({ones:()=>ea(e),rate:this.dropout,training:i,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=hu({ones:()=>ea(s),rate:this.recurrentDropout,training:i,dropoutFunc:this.dropoutFunc}));let o;const c=this.dropoutMask,h=this.recurrentDropoutMask;c!=null?o=po(pe(e,c),this.kernel.read()):o=po(e,this.kernel.read()),this.bias!=null&&(o=Da(o,this.bias.read())),h!=null&&(s=pe(s,h));let f=Ue(o,po(s,this.recurrentKernel.read()));return this.activation!=null&&(f=this.activation.apply(f)),[f,f]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:lu(this.activation),useBias:this.useBias,kernelInitializer:tr(this.kernelInitializer),recurrentInitializer:tr(this.recurrentInitializer),biasInitializer:tr(this.biasInitializer),kernelRegularizer:Tn(this.kernelRegularizer),recurrentRegularizer:Tn(this.recurrentRegularizer),biasRegularizer:Tn(this.biasRegularizer),activityRegularizer:Tn(this.activityRegularizer),kernelConstraint:Pr(this.kernelConstraint),recurrentConstraint:Pr(this.recurrentConstraint),biasConstraint:Pr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}Yy.className="SimpleRNNCell",Ze(Yy);class Bk extends cu{constructor(e){e.cell=new Yy(e),super(e)}call(e,t){return ye(()=>{this.cell.dropoutMask!=null&&($t(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&($t(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,i=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:i,initialState:o})})}static fromConfig(e,t){return new e(t)}}Bk.className="SimpleRNN",Ze(Bk);class Qy extends p1{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new he("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Kr(this.units,"units"),this.activation=uu(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=uu(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Hn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Hn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Hn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=jn(e.kernelRegularizer),this.recurrentRegularizer=jn(e.recurrentRegularizer),this.biasRegularizer=jn(e.biasRegularizer),this.kernelConstraint=Fr(e.kernelConstraint),this.recurrentConstraint=Fr(e.recurrentConstraint),this.biasConstraint=Fr(e.biasConstraint),this.dropout=sd([1,au([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=sd([1,au([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=sn(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ye(()=>{if(e=e,e.length!==2)throw new he(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training==null?!1:t.training;let i=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=hu({ones:()=>ea(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=hu({ones:()=>ea(i),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,c=this.recurrentDropoutMask;let h,f,g;0<this.dropout&&this.dropout<1&&(e=pe(e,o[0]));let y=po(e,this.kernel.read());this.useBias&&(y=Da(y,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(i=pe(i,c[0]));const I=this.recurrentKernel.read(),[C,k]=ki(I,[2*this.units,this.units],I.rank-1),N=po(i,C),[R,P,L]=ki(y,3,y.rank-1),[F,W]=ki(N,2,N.rank-1);h=this.recurrentActivation.apply(Ue(R,F)),f=this.recurrentActivation.apply(Ue(P,W));const z=po(pe(f,i),k);g=this.activation.apply(Ue(L,z));const X=Ue(pe(h,i),pe(Ue(1,xr(h)),g));return[X,X]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:lu(this.activation),recurrentActivation:lu(this.recurrentActivation),useBias:this.useBias,kernelInitializer:tr(this.kernelInitializer),recurrentInitializer:tr(this.recurrentInitializer),biasInitializer:tr(this.biasInitializer),kernelRegularizer:Tn(this.kernelRegularizer),recurrentRegularizer:Tn(this.recurrentRegularizer),biasRegularizer:Tn(this.biasRegularizer),activityRegularizer:Tn(this.activityRegularizer),kernelConstraint:Pr(this.kernelConstraint),recurrentConstraint:Pr(this.recurrentConstraint),biasConstraint:Pr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}Qy.className="GRUCell",Ze(Qy);class Wk extends cu{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Qy(e),super(e)}call(e,t){return ye(()=>{this.cell.dropoutMask!=null&&($t(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&($t(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,i=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:i,initialState:o})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}Wk.className="GRU",Ze(Wk);class m1 extends p1{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Kr(this.units,"units"),this.activation=uu(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=uu(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Hn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Hn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Hn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=jn(e.kernelRegularizer),this.recurrentRegularizer=jn(e.recurrentRegularizer),this.biasRegularizer=jn(e.biasRegularizer),this.kernelConstraint=Fr(e.kernelConstraint),this.recurrentConstraint=Fr(e.recurrentConstraint),this.biasConstraint=Fr(e.biasConstraint),this.dropout=sd([1,au([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=sd([1,au([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=sn(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let i;if(this.useBias){if(this.unitForgetBias){const o=this.biasInitializer,c=this.units;i=new(t=class extends sa{apply(h,f){const g=o.apply([c]),y=new ky().apply([c]),I=o.apply([c*2]);return gT(gT(g,y),I)}},t.className="CustomInit",t)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return ye(()=>{const s=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new he(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let i=e[1];const o=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=hu({ones:()=>ea(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=hu({ones:()=>ea(i),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const c=this.dropoutMask,h=this.recurrentDropoutMask;let f,g,y,I;0<this.dropout&&this.dropout<1&&(e=pe(e,c[0]));let C=po(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(i=pe(i,h[0])),C=Ue(C,po(i,this.recurrentKernel.read())),this.useBias&&(C=Da(C,this.bias.read()));const[k,N,R,P]=ki(C,4,C.rank-1);f=this.recurrentActivation.apply(k),g=this.recurrentActivation.apply(N),y=Ue(pe(g,o),pe(f,this.activation.apply(R))),I=this.recurrentActivation.apply(P);const L=pe(I,this.activation.apply(y));return[L,L,y]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:lu(this.activation),recurrentActivation:lu(this.recurrentActivation),useBias:this.useBias,kernelInitializer:tr(this.kernelInitializer),recurrentInitializer:tr(this.recurrentInitializer),biasInitializer:tr(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Tn(this.kernelRegularizer),recurrentRegularizer:Tn(this.recurrentRegularizer),biasRegularizer:Tn(this.biasRegularizer),activityRegularizer:Tn(this.activityRegularizer),kernelConstraint:Pr(this.kernelConstraint),recurrentConstraint:Pr(this.recurrentConstraint),biasConstraint:Pr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}m1.className="LSTMCell",Ze(m1);class zk extends cu{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new m1(e),super(e)}call(e,t){return ye(()=>{this.cell.dropoutMask!=null&&($t(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&($t(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,i=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:i,initialState:o})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}zk.className="LSTM",Ze(zk);class Jy extends p1{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return ye(()=>{e=e;let s=e.slice(1);const i=[];for(const h of this.cells.slice().reverse())Array.isArray(h.stateSize)?i.push(s.splice(0,h.stateSize.length)):i.push(s.splice(0,1));i.reverse();const o=[];let c;for(let h=0;h<this.cells.length;++h){const f=this.cells[h];s=i[h],h===0?c=[e[0]].concat(s):c=[c[0]].concat(s),c=f.call(c,t),o.push(c.slice(1))}s=[];for(const h of o.slice().reverse())s.push(...h);return[c[0]].concat(s)})}build(e){Dy(e)&&(e=e[0]),e=e;let t;this.cells.forEach((s,i)=>{Gc(`RNNCell_${i}`,()=>{s.build(e),Array.isArray(s.stateSize)?t=s.stateSize[0]:t=s.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=i=>({className:i.getClassName(),config:i.getConfig()}),s={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),s)}static fromConfig(e,t,s={}){const i=[];for(const o of t.cells)i.push(ll(o,s));return new e({cells:i})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.cells)t.push(...s.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return Oy(e)}setWeights(e){const t=[];for(const s of this.cells){const i=s.weights.length,o=e.splice(i);for(let c=0;c<s.weights.length;++c)t.push([s.weights[c],o[c]])}Py(t)}}Jy.className="StackedRNNCells",Ze(Jy);function hu(n){const{ones:e,rate:t,training:s=!1,count:i=1,dropoutFunc:o}=n,c=()=>o!=null?o(e(),t):yT(e(),t),h=()=>Bf(c,e,s);return!i||i<=1?Ci(h().clone()):Array(i).fill(void 0).map(h).map(f=>Ci(f.clone()))}/**
* @license
* Copyright 2020 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/var l6=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(n);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(n,s[i])&&(t[s[i]]=n[s[i]]);return t};class Xk extends cu{constructor(e){if(e.unroll)throw new Vt("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Vt("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Or({ndim:5})]}call(e,t){return ye(()=>{if(this.cell.dropoutMask!=null&&($t(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&($t(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new he("ConvRNN2D cell does not support constants");const s=t==null?null:t.mask,i=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:i,initialState:o})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return ye(()=>{const{stateSize:t}=this.cell,s=e.shape,i=this.computeSingleOutputShape(s),o=[i[0],...i.slice(2)],c=Zr(o);return Array.isArray(t)?Array(t.length).fill(c):[c]})}resetStates(e,t=!1){ye(()=>{if(!this.stateful)throw new ho("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,i=this.computeSingleOutputShape(s),o=[i[0],...i.slice(2)];if(s[0]==null)throw new he("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Zr(o)):this.states_=[Zr(o)];else if(e==null)$t(this.states_),this.keptStates!=null&&($t(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Zr(o)):this.states_[0]=Zr(o);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new he(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):$t(this.states_);for(let c=0;c<this.states_.length;++c){const h=e[c],f=o;if(!se(h.shape,f))throw new he(`State ${c} is incompatible with layer ${this.name}: expected shape=${f}, received shape=${h.shape}`);this.states_[c]=h}}this.states_=this.states_.map(c=>Ci(c.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:s,kernelSize:i,padding:o,strides:c,dilationRate:h}=this.cell,f=t==="channelsFirst",g=e[f?3:2],y=e[f?4:3],I=Fa(g,i[0],o,c[0],h[0]),C=Fa(y,i[1],o,c[1],h[1]);return[...e.slice(0,2),...f?[s,I,C]:[I,C,s]]}}Xk.className="ConvRNN2D";class qy extends m1{constructor(e){const{filters:t,kernelSize:s,strides:i,padding:o,dataFormat:c,dilationRate:h}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,Kr(this.filters,"filters"),this.kernelSize=ad(s,2,"kernelSize"),this.kernelSize.forEach(f=>Kr(f,"kernelSize")),this.strides=ad(i||1,2,"strides"),this.strides.forEach(f=>Kr(f,"strides")),this.padding=o||"valid",Ei(this.padding),this.dataFormat=c||"channelsLast",yr(this.dataFormat),this.dilationRate=ad(h||1,2,"dilationRate"),this.dilationRate.forEach(f=>Kr(f,"dilationRate"))}build(e){var t;e=sn(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new he(`The channel dimension of the input should be defined. Found ${e[s]}`);const i=e[s],o=4,c=this.kernelSize.concat([i,this.filters*o]);this.kernel=this.addWeight("kernel",c,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const h=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",h,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let f;if(this.unitForgetBias){const g=this.biasInitializer,y=this.filters;f=new(t=class extends sa{apply(I,C){const k=g.apply([y]),N=nu([y]),R=g.apply([y*2]);return Cy([k,N,R])}},t.className="CustomInit",t)}else f=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,f,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return ye(()=>{if(e.length!==3)throw new he(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training||!1,i=e[0],o=e[1],c=e[2],h=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=hu({ones:()=>ea(i),rate:this.dropout,training:s,count:h,dropoutFunc:this.dropoutFunc}));const f=this.dropoutMask,g=(He,$e,Qe)=>!$e||!$e[Qe]?He:pe($e[Qe],He);let y=g(i,f,0),I=g(i,f,1),C=g(i,f,2),k=g(i,f,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=hu({ones:()=>ea(o),rate:this.recurrentDropout,training:s,count:h,dropoutFunc:this.dropoutFunc}));const N=this.recurrentDropoutMask;let R=g(o,N,0),P=g(o,N,1),L=g(o,N,2),F=g(o,N,3);const W=3,[z,X,Q,J]=ki(this.kernel.read(),h,W),[te,ie,oe,Ce]=this.useBias?ki(this.bias.read(),h):[null,null,null,null];y=this.inputConv(y,z,te,this.padding),I=this.inputConv(I,X,ie,this.padding),C=this.inputConv(C,Q,oe,this.padding),k=this.inputConv(k,J,Ce,this.padding);const[Se,Te,Le,Me]=ki(this.recurrentKernel.read(),h,W);R=this.recurrentConv(R,Se),P=this.recurrentConv(P,Te),L=this.recurrentConv(L,Le),F=this.recurrentConv(F,Me);const Oe=this.recurrentActivation.apply(Ue(y,R)),Ve=this.recurrentActivation.apply(Ue(I,P)),_e=Ue(pe(Ve,c),pe(Oe,this.activation.apply(Ue(C,L)))),Be=pe(this.recurrentActivation.apply(Ue(k,F)),this.activation.apply(_e));return[Be,Be,_e]})}getConfig(){const e=super.getConfig(),t=l6(e,["units"]),s={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},t),s)}inputConv(e,t,s,i){const o=kc(e,t,this.strides,i||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?Da(o,s,this.dataFormat):o}recurrentConv(e,t){return kc(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}qy.className="ConvLSTM2DCell",Ze(qy);class Zk extends Xk{constructor(e){const t=new qy(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}Zk.className="ConvLSTM2D",Ze(Zk);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class eb extends Zt{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,s=[];for(let i=0;i<this.noiseShape.length;++i)s.push(this.noiseShape[i]==null?t[i]:this.noiseShape[i]);return s}call(e,t){return ye(()=>{this.invokeCallHook(e,t);const s=Rt(e);if(0<this.rate&&this.rate<1){const i=t.training==null?!1:t.training,o=this.getNoiseShape(s);return Bf(()=>yT(s,this.rate,o,this.seed),()=>s,i)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}eb.className="Dropout",Ze(eb);class Kk extends eb{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}Kk.className="SpatialDropout1D",Ze(Kk);class $k extends Zt{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,Kr(this.units,"units"),this.activation=uu(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=Hn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Hn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Fr(e.kernelConstraint),this.biasConstraint=Fr(e.biasConstraint),this.kernelRegularizer=jn(e.kernelRegularizer),this.biasRegularizer=jn(e.biasRegularizer),this.activityRegularizer=jn(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=sn(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=sn(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return ye(()=>{this.invokeCallHook(e,t);const s=Rt(e),i=uT(this.activation.getClassName());let o;return i!=null?o=po(s,this.kernel.read(),i,this.bias?this.bias.read():null):(o=po(s,this.kernel.read()),this.bias!=null&&(o=Da(o,this.bias.read())),this.activation!=null&&(o=this.activation.apply(o))),o})}getConfig(){const e={units:this.units,activation:lu(this.activation),useBias:this.useBias,kernelInitializer:tr(this.kernelInitializer),biasInitializer:tr(this.biasInitializer),kernelRegularizer:Tn(this.kernelRegularizer),biasRegularizer:Tn(this.biasRegularizer),activityRegularizer:Tn(this.activityRegularizer),kernelConstraint:Pr(this.kernelConstraint),biasConstraint:Pr(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}$k.className="Dense",Ze($k);class Uk extends Zt{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=sn(e);for(const t of e.slice(1))if(t==null)throw new he(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],iu(e,1)]}call(e,t){return ye(()=>{this.invokeCallHook(e,t);let s=Rt(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const i=[0];for(let o=2;o<s.rank;++o)i.push(o);i.push(1),s=tn(s,i)}return Xz(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}Uk.className="Flatten",Ze(Uk);class Hk extends Zt{constructor(e){super(e),this.supportsMasking=!0,this.activation=uu(e.activation)}call(e,t){return ye(()=>{this.invokeCallHook(e,t);const s=Rt(e);return this.activation.apply(s)})}getConfig(){const e={activation:lu(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}Hk.className="Activation",Ze(Hk);class jk extends Zt{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return ye(()=>(e=Rt(e),Wz(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}jk.className="RepeatVector",Ze(jk);class Yk extends Zt{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const s="Total size of new array must be unchanged.",i=t.slice();let o=1,c=null;for(let f=0;f<i.length;++f){const g=i[f];if(this.isUnknown(g))if(c===null)c=f;else throw new he("Can only specifiy one unknown dimension.");else o*=g}const h=iu(e);if(c!==null){if(o===0||h%o!==0)throw new he(s);i[c]=h/o}else if(h!==o)throw new he(s);return i}computeOutputShape(e){let t=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return ye(()=>{this.invokeCallHook(e,t);const s=Rt(e),i=s.shape,o=i.slice(0,1).concat(this.fixUnknownDimension(i.slice(1),this.targetShape));return ge(s,o)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}Yk.className="Reshape",Ze(Yk);class Qk extends Zt{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=Ma(1,e.dims.length+1);if(!se(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Or({ndim:this.dims.length+1})]}computeOutputShape(e){e=sn(e);const t=e.slice();return this.dims.forEach((s,i)=>{t[i+1]=e[s]}),t}call(e,t){return tn(Rt(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}Qk.className="Permute",Ze(Qk);class Jk extends Zt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const s=Rt(e);return ox(B0(s,this.maskValue),-1)}call(e,t){return ye(()=>{this.invokeCallHook(e,t);const s=Rt(e),i=ox(B0(s,this.maskValue),-1,!0);return pe(s,at(i,s.dtype))})}}Jk.className="Masking",Ze(Jk);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class qk extends Zt{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(gn(e.inputLength))}this.inputDim=e.inputDim,Kr(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Kr(this.outputDim,"outputDim"),this.embeddingsInitializer=Hn(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=jn(e.embeddingsRegularizer),this.activityRegularizer=jn(e.activityRegularizer),this.embeddingsConstraint=Fr(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return ye(()=>this.maskZero?(e=Rt(e),B0(e,en(e))):null)}computeOutputShape(e){if(e=sn(e),this.inputLength==null)return[...e,this.outputDim];const t=gn(this.inputLength);if(t.length!==e.length-1)throw new he(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let i=0;i<t.length;++i){const o=t[i],c=e[i+1];if(o!=null&&c!=null&&o!==c)throw new he(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);o==null&&(t[s]=c),s++}}return[e[0],...t,this.outputDim]}call(e,t){return ye(()=>{this.invokeCallHook(e,t);let s=Rt(e);s.dtype!=="int32"&&(s=ol(s,"int32"));const i=xT(this.embeddings.read(),ge(s,[s.size]));return ge(i,sn(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:tr(this.embeddingsInitializer),embeddingsRegularizer:Tn(this.embeddingsRegularizer),activityRegularizer:Tn(this.activityRegularizer),embeddingsConstraint:Pr(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}qk.className="Embedding",Ze(qk);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class Bc extends Zt{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new Vt}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const s=e.slice(0,e.length-t.length);for(let i=0;i<t.length;++i){const o=e[e.length-t.length+i],c=t[i];if(o==null||c==null||o<0||c<0)s.push(null);else if(o===1)s.push(c);else if(c===1)s.push(o);else{if(o!==c)throw new he("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));s.push(o)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[sn(e)]),e=e,e.length<2)throw new he(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const o of e)o!=null&&o[0]!==null&&t.push(o[0]);if(t=su(t),t.length>1)throw new he(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let o=1;o<e.length;++o){const c=e[o]==null?null:e[o].slice(1);s=this.computeElementwiseOpOutputShape(s,c)}const i=e.map(o=>o.length);e.indexOf(null)===-1&&su(i).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return ye(()=>{if(e=e,this.reshapeRequired){const s=[],i=e.map(o=>o.rank);if(i.indexOf(null)===-1){const o=au(i);for(let c of e){const h=c.rank;for(let f=0;f<o-h;++f)c=_f(c,1);s.push(c)}return this.mergeFunction(s)}else{let o=!1;for(const f of e){const g=f.rank;if(g==null){const y=f.shape,I=y[0],C=y.slice(1).concat([I]);let k=ge(f,[I].concat(iu(y.slice(1))));k=tn(k,[1,0]),k=ge(k,C),s.push(k),o=!0}else if(g>1){const y=Ma(1,g).concat([0]);s.push(tn(f,y)),o=!0}else s.push(f)}let c=this.mergeFunction(s);const h=c.rank;if(o){if(h==null){const f=c.shape,g=f.length,y=f[g-1],I=[y].concat(f.slice(0,f.length-1));c=ge(tn(ge(c,[-1,y]),[1,0]),I)}else if(h>1){const f=[h-1].concat(Ma(0,h-1));c=tn(c,f)}}return c}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let i=1;i<e.length;++i){const o=e[i]==null?null:e[i].slice(1);t=this.computeElementwiseOpOutputShape(t,o)}let s=[];for(const i of e)i!=null&&i[0]!==null&&s.push(i[0]);return s=su(s),s.length===1?t=s.concat(t):t=[null].concat(t),t}computeMask(e,t){return ye(()=>{if(t==null)return null;if(!Array.isArray(t))throw new he("`mask` should be an Array");if(!Array.isArray(e))throw new he("`inputs` should be an Array");if(t.length!==e.length)throw new he(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(i=>i==null))return null;t=t.map(i=>i==null?i:Xs(i,0));let s=t[0];for(let i=1;i<t.length-1;++i)s=nl(s,t[i]);return s})}}class e3 extends Bc{constructor(e){super(e)}mergeFunction(e){return ye(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=Ue(t,e[s]);return t})}}e3.className="Add",Ze(e3);class t3 extends Bc{constructor(e){super(e)}mergeFunction(e){return ye(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=pe(t,e[s]);return t})}}t3.className="Multiply",Ze(t3);class n3 extends Bc{constructor(e){super(e)}mergeFunction(e){return ye(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=Ue(t,e[s]);return pe(1/e.length,t)})}}n3.className="Average",Ze(n3);class r3 extends Bc{constructor(e){super(e)}mergeFunction(e){return ye(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=tu(t,e[s]);return t})}}r3.className="Maximum",Ze(r3);class s3 extends Bc{constructor(e){super(e)}mergeFunction(e){return ye(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=Nf(t,e[s]);return t})}}s3.className="Minimum",Ze(s3);class i3 extends Bc{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new he("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const i of e)if(i!=null){t=!1;break}if(t)return;const s=[];for(let i=0;i<e.length;++i){const o=e[i].slice();o.splice(this.axis,1);let c=!1;for(const h of s)if(se(h,o)){c=!0;break}c||s.push(o)}if(s.length>1)throw new he("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return ye(()=>Cy(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new he("A `Concatenate` layer should be called on a list of inputs.");const t=e,s=t[0].slice(),i=this.axis<0?s.length+this.axis:this.axis;for(const o of t.slice(1)){if(s[i]==null||o[i]==null){s[i]=null;break}s[i]+=o[i]}return s}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new he("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new he("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new he(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return ye(()=>{let s=!0;if(t.forEach(c=>{if(c!=null){s=!1;return}}),s)return null;const i=[];for(let c=0;c<e.length;++c)t[c]==null?i.push(at(ea(e[c]),"bool")):t[c].rank<e[c].rank?i.push(Xs(t[c],-1)):i.push(t[c]);const o=zs(i,this.axis);return SC(o,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}i3.className="Concatenate",Ze(i3);function Yf(n,e){for(;n<0;)n+=e;return n}function u6(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new Vt("batchDot is not implemented for tensors of 4D or higher rank yet");if(D(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),D(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new Vt("batchDot is not implemented for complex64-type Tensors yet.");const s=n.shape.length,i=e.shape.length;t==null&&(t=[s-1,i-2]);const o=t;return ye(()=>{let c;if(s>i){c=s-i;const f=[];for(let g=0;g<c;++g)f.push(1);e=ge(e,e.shape.concat(f))}else if(i>s){c=i-s;const f=[];for(let g=0;g<c;++g)f.push(1);n=ge(n,n.shape.concat(f))}else c=0;let h;if(n.shape.length===2&&e.shape.length===2)o[0]===o[1]?h=It(pe(n,e),o[0]):h=It(pe(tn(n,[1,0]),e),o[1]);else{const f=o[0]!==n.shape.length-1,g=o[1]===e.shape.length-1;h=cn(n,e,f,g)}if(c>0){let f;s>i?f=s+i-3:f=s-1;const g=[];for(let y=f;y<f+c;++y)g.push(y);h=Mf(h,g)}return h.shape.length===1&&(h=Xs(h,1)),h})}class a3 extends Bc{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){D(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],s=e[1];if(t.length>3||s.length>3)throw new Vt("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(t,s);if(t[i[0]]!==s[i[1]])throw new he(`Dimension incompatibility: ${t[i[0]]} !== ${s[i[1]]}`)}mergeFunction(e){if(e.length!==2)throw new he(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],s=e[1],i;return Array.isArray(this.axes)?i=this.axes.map((o,c)=>Yf(o,e[c].shape.length)):i=[Yf(this.axes,t.shape.length),Yf(this.axes,s.shape.length)],this.normalize&&(t=s1(t,i[0]),s=s1(s,i[1])),u6(t,s,i)}interpretAxes(e,t){let s;return Array.isArray(this.axes)?s=this.axes:s=[Yf(this.axes,e.length),Yf(this.axes,t.length)],s}computeOutputShape(e){D(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),s=e[1].slice();if(t.length>3||s.length>3)throw new Vt("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(t,s);t.splice(i[0],1),s.splice(i[1],1),s.splice(0,1);const o=t.concat(s);return o.length===1&&o.push(1),o}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}a3.className="Dot",Ze(a3);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class o3 extends Zt{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return ye(()=>{this.invokeCallHook(e,t);const s=Rt(e);return Bf(()=>Ue(J0(s.shape,0,this.stddev),s),()=>s,t.training||!1)})}}o3.className="GaussianNoise",Ze(o3);class l3 extends Zt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return ye(()=>{this.invokeCallHook(e,t);const s=Rt(e);return this.rate>0&&this.rate<1?Bf(()=>{const i=Math.sqrt(this.rate/(1-this.rate));return pe(s,J0(s.shape,1,i))},()=>s,t.training||!1):s})}}l3.className="GaussianDropout",Ze(l3);class u3 extends Zt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||Rt(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return ye(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return Bf(()=>{const i=Rt(e),o=-1.6732632423543772*1.0507009873554805;let c=Ec(Af(s),this.rate);c=ol(c,"float32");const h=((1-this.rate)*(1+this.rate*o**2))**-.5,f=-h*o*this.rate,g=Ue(pe(i,c),pe(Ue(c,-1),o));return Ue(pe(g,h),f)},()=>Rt(e),t.training||!1)}return e})}}u3.className="AlphaDropout",Ze(u3);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function Qf(n,e,t,s,i,o=.001){let c;if(n.rank===2)c=zF(n,e,t,s,i,o);else if(n.rank===3)c=ZF(n,e,t,s,i,o);else if(n.rank===4)c=$F(n,e,t,s,i,o);else throw new Vt(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return c}function c6(n,e,t,s,i=.001){return ye(()=>{const o=Cx(n,s),c=o.mean,h=o.variance;return[Qf(n,c,h,t,e,i),c,h]})}function h6(n,e,t,s,i=.001){return ye(()=>{const o=Cx(n,s),c=o.mean,h=o.variance,f=[];for(const k of Ma(0,n.rank))s.indexOf(k)!==-1?f.push(1):f.push(n.shape[k]);const g=ge(c,f),y=ge(h,f),I=e==null?null:ge(e,f),C=t==null?null:ge(t,f);return[Qf(n,g,y,C,I,i),c,h]})}function d6(n,e,t,s,i=.001){return se(s.slice().sort(),Ma(0,n.rank-1))?c6(n,e,t,s,i):h6(n,e,t,s,i)}class c3 extends Zt{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Hn(e.betaInitializer||"zeros"),this.gammaInitializer=Hn(e.gammaInitializer||"ones"),this.movingMeanInitializer=Hn(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Hn(e.movingVarianceInitializer||"ones"),this.betaConstraint=Fr(e.betaConstraint),this.gammaConstraint=Fr(e.gammaConstraint),this.betaRegularizer=jn(e.betaRegularizer),this.gammaRegularizer=jn(e.gammaRegularizer)}build(e){e=sn(e);const t=this.axis>=0?this.axis:this.axis+e.length,s=e[t];if(s==null)throw new he(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Or({ndim:e.length,axes:{[t]:s}})];const i=[s];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return ye(()=>{const s=t.training==null?!1:t.training,i=Rt(e),o=i.shape,c=o.length,h=Ma(0,c),f=this.axis>=0?this.axis:this.axis+c;h.splice(f,1);const g=Oc(1,c);g[f]=o[f];const y=h.slice();y.sort();const I=!se(y,Ma(0,c).slice(0,c-1)),C=()=>{if(I){const L=ge(this.movingMean.read(),g),F=ge(this.movingVariance.read(),g),W=this.center?ge(this.beta.read(),g):null,z=this.scale?ge(this.gamma.read(),g):null;return Qf(i,L,F,W,z,this.epsilon)}else return Qf(i,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return C();const[k,N,R]=d6(i,this.gamma.read(),this.beta.read(),h,this.epsilon),P=(L,F,W)=>{ye(()=>{const z=1-W,X=L.read(),Q=pe(Nt(X,F),z);L.write(Nt(X,Q))})};return P(this.movingMean,N,this.momentum),P(this.movingVariance,R,this.momentum),k})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:tr(this.betaInitializer),gammaInitializer:tr(this.gammaInitializer),movingMeanInitializer:tr(this.movingMeanInitializer),movingVarianceInitializer:tr(this.movingVarianceInitializer),betaRegularizer:Tn(this.betaRegularizer),gammaRegularizer:Tn(this.gammaRegularizer),betaConstraint:Pr(this.betaConstraint),gammaConstraint:Pr(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}c3.className="BatchNormalization",Ze(c3);class h3 extends Zt{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Hn(e.betaInitializer||"zeros"),this.gammaInitializer=Hn(e.gammaInitializer||"ones"),this.betaRegularizer=jn(e.betaRegularizer),this.gammaRegularizer=jn(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=sn(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=t);for(const o of this.axis)if(o<0||o>=t)throw new Error(`Invalid axis: ${o}`);if(this.axis.length!==su(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(o=>e[o]),i=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,i):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,i):this.beta=null,this.built=!0}call(e,t){const s=Rt(e),i=s.shape,o=i.length;return ye(()=>{let{mean:c,variance:h}=Cx(s,this.axis,!0);const f=Oc(1,o);for(const N of this.axis)f[N]=i[N];const g=N=>N!=null&&N.shape.length!==o?ge(N,f):N;let y=this.scale?g(this.gamma.read()):null,I=this.center?g(this.beta.read()):null;const C=[],k=[];for(let N=0;N<o;++N)this.axis.indexOf(N)!==-1?(C.push(i[N]),k.push(1)):(C.push(1),k.push(i[N]));return c=Aa(c,C),h=Aa(h,C),y!=null&&(y=Aa(y,k)),I!=null&&(I=Aa(I,k)),Qf(s,c,h,I,y,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:tr(this.betaInitializer),gammaInitializer:tr(this.gammaInitializer),betaRegularizer:Tn(this.betaRegularizer),gammaRegularizer:Tn(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}h3.className="LayerNormalization",Ze(h3);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function f6(n,e,t){return ye(()=>{if(n.rank!==4)throw new he(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new he("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=La()),t!=="channelsLast"&&t!=="channelsFirst")throw new he(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return t==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],Sx(n,s)})}class d3 extends Zt{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?La():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new he(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,s;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new he(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new he(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[t,s]}this.inputSpec=[new Or({ndim:4})]}computeOutputShape(e){e=sn(e);let t,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],t,s]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],t,s,e[3]])}call(e,t){return ye(()=>f6(Rt(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}d3.className="ZeroPadding2D",Ze(d3);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function g1(n,e,t,s,i,o){return ye(()=>{yr(i),hT(o),Ei(s),t==null&&(t=[1,1]),s==null&&(s="valid"),i==null&&(i=La()),o==null&&(o="max"),n=jy(n,i);let c;const h=s==="same"?"same":"valid";return o==="max"?c=Ix(n,e,t,h):c=cx(n,e,t,h),i==="channelsFirst"&&(c=tn(c,[0,3,1,2])),c})}function f3(n,e,t,s,i,o){return ye(()=>{yr(i),hT(o),Ei(s),t==null&&(t=[1,1,1]),s==null&&(s="valid"),i==null&&(i=La()),o==null&&(o="max"),n=Ak(n,i);let c;const h=s==="same"?"same":"valid";return o==="max"?c=MG(n,e,t,h):c=LF(n,e,t,h),i==="channelsFirst"&&(c=tn(c,[0,4,1,2,3])),c})}class p3 extends Zt{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new he(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(Kr(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new he(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);Kr(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Ei(this.padding),this.inputSpec=[new Or({ndim:3})]}computeOutputShape(e){e=sn(e);const t=Fa(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return ye(()=>{this.invokeCallHook(e,t),e=_f(Rt(e),2);const s=this.poolingFunction(Rt(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Mf(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class m3 extends p3{constructor(e){super(e)}poolingFunction(e,t,s,i,o){return yr(o),Ei(i),g1(e,t,s,i,o,"max")}}m3.className="MaxPooling1D",Ze(m3);class g3 extends p3{constructor(e){super(e)}poolingFunction(e,t,s,i,o){return yr(o),Ei(i),g1(e,t,s,i,o,"avg")}}g3.className="AveragePooling1D",Ze(g3);class x3 extends Zt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new he(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];Kr(this.poolSize,"poolSize"),Kr(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,yr(this.dataFormat),Ei(this.padding),this.inputSpec=[new Or({ndim:4})]}computeOutputShape(e){e=sn(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=Fa(t,this.poolSize[0],this.padding,this.strides[0]),s=Fa(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s]:[e[0],t,s,e[3]]}call(e,t){return ye(()=>(this.invokeCallHook(e,t),this.poolingFunction(Rt(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class y3 extends x3{constructor(e){super(e)}poolingFunction(e,t,s,i,o){return yr(o),Ei(i),g1(e,t,s,i,o,"max")}}y3.className="MaxPooling2D",Ze(y3);class b3 extends x3{constructor(e){super(e)}poolingFunction(e,t,s,i,o){return yr(o),Ei(i),g1(e,t,s,i,o,"avg")}}b3.className="AveragePooling2D",Ze(b3);class w3 extends Zt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new he(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Kr(this.poolSize,"poolSize"),Kr(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,yr(this.dataFormat),Ei(this.padding),this.inputSpec=[new Or({ndim:5})]}computeOutputShape(e){e=sn(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],i=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=Fa(t,this.poolSize[0],this.padding,this.strides[0]),s=Fa(s,this.poolSize[1],this.padding,this.strides[1]),i=Fa(i,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s,i]:[e[0],t,s,i,e[4]]}call(e,t){return ye(()=>(this.invokeCallHook(e,t),this.poolingFunction(Rt(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class v3 extends w3{constructor(e){super(e)}poolingFunction(e,t,s,i,o){return yr(o),Ei(i),f3(e,t,s,i,o,"max")}}v3.className="MaxPooling3D",Ze(v3);class I3 extends w3{constructor(e){super(e)}poolingFunction(e,t,s,i,o){return yr(o),Ei(i),f3(e,t,s,i,o,"avg")}}I3.className="AveragePooling3D",Ze(I3);class C3 extends Zt{constructor(e){super(e),this.inputSpec=[new Or({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new Vt}}class S3 extends C3{constructor(e){super(e||{})}call(e,t){return ye(()=>{const s=Rt(e);return Er(s,1)})}}S3.className="GlobalAveragePooling1D",Ze(S3);class T3 extends C3{constructor(e){super(e||{})}call(e,t){return ye(()=>{const s=Rt(e);return Na(s,1)})}}T3.className="GlobalMaxPooling1D",Ze(T3);class k3 extends Zt{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,yr(this.dataFormat),this.inputSpec=[new Or({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new Vt}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class E3 extends k3{call(e,t){return ye(()=>{const s=Rt(e);return this.dataFormat==="channelsLast"?Er(s,[1,2]):Er(s,[2,3])})}}E3.className="GlobalAveragePooling2D",Ze(E3);class N3 extends k3{call(e,t){return ye(()=>{const s=Rt(e);return this.dataFormat==="channelsLast"?Na(s,[1,2]):Na(s,[2,3])})}}N3.className="GlobalMaxPooling2D",Ze(N3);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class A3 extends Zt{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,s={}){const i=t.layer,o=ll(i,s);delete t.layer;const c={layer:o};return Object.assign(c,t),new e(c)}}class R3 extends A3{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=sn(e),e.length<3)throw new he(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=sn(e);const t=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(t),i=e[1];return[s[0],i].concat(s.slice(1))}call(e,t){return ye(()=>(e=Rt(e),Vk((s,i)=>[Rt(this.layer.call(s,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}R3.className="TimeDistributed",Ze(R3);function p6(n){Fc(Fz,"BidirectionalMergeMode",n)}const m6="concat";class M3 extends A3{constructor(e){super(e);const t=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=t,this.forwardLayer=ll(s),t.goBackwards=t.goBackwards!==!0;const i={};if(i.className=e.layer.getClassName(),i.config=t,this.backwardLayer=ll(i),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?m6:e.mergeMode,p6(this.mergeMode),e.weights)throw new Vt("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,s=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let s,i,o;return this.returnState&&(o=t.slice(1)),s=t[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,i=[s]):this.mergeMode==null?i=[s,s.slice()]:i=[s],this.returnState?this.mergeMode==null?i.concat(o).concat(o.slice()):[s].concat(o).concat(o.slice()):Zs(i)}apply(e,t){let s=t==null?null:t.initialState,i=t==null?null:t.constants;t==null&&(t={});const o=_k(e,s,i,this.numConstants);if(e=o.inputs,s=o.initialState,i=o.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&i==null)return super.apply(e,t);const c=[],h=[];if(s!=null){const g=s.length;if(g%2>0)throw new he("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=s,c.push(...s);const y=s.map(I=>new Or({shape:I.shape}));this.forwardLayer.stateSpec=y.slice(0,g/2),this.backwardLayer.stateSpec=y.slice(g/2),h.push(...y)}if(i!=null)throw new Vt("Support for constants in Bidirectional layers is not implemented yet.");const f=c[0]instanceof mo;for(const g of c)if(g instanceof mo!==f)throw new he("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(f){const g=[e].concat(c),y=this.inputSpec.concat(h),I=this.inputSpec;this.inputSpec=y;const C=super.apply(g,t);return this.inputSpec=I,C}else return super.apply(e,t)}call(e,t){return ye(()=>{const s=t.initialState;let i,o;if(s==null)i=this.forwardLayer.call(e,t),o=this.backwardLayer.call(e,t);else{const f=s.slice(0,s.length/2),g=s.slice(s.length/2);i=this.forwardLayer.call(e,Object.assign(t,{initialState:f})),o=this.backwardLayer.call(e,Object.assign(t,{initialState:g}))}let c;this.returnState&&(Array.isArray(i)&&(c=i.slice(1).concat(o.slice(1))),i=i[0],o=o[0]),this.returnSequences&&(o=Rc(o,1));let h;return this.mergeMode==="concat"?h=Cy([i,o]):this.mergeMode==="sum"?h=Ue(i,o):this.mergeMode==="ave"?h=pe(.5,Ue(i,o)):this.mergeMode==="mul"?h=pe(i,o):this.mergeMode==null&&(h=[i,o]),this.returnState?this.mergeMode==null?h.concat(c):[h].concat(c):h})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Gc(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Gc(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[t,t]:s=t:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const i=this.forwardLayer.states.map(o=>null);return Array.isArray(s)?s.concat(i).concat(i):[s].concat(i).concat(i)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const s=ll(t.layer);if(delete t.layer,t.numConstants!=null)throw new Vt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const i=t;return i.layer=s,new e(i)}}M3.className="Bidirectional",Ze(M3);/**
* @license
* Copyright 2022 CodeSmith LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class L3 extends Zt{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return ye(()=>(e=Rt(e),e.dtype!=="float32"&&(e=ol(e,"float32")),Ue(pe(e,this.scale),this.offset)))}}L3.className="Rescaling",Ze(L3);/**
* @license
* Copyright 2022 CodeSmith LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const{resizeBilinear:g6,cropAndResize:x6}=rl;class D3 extends Zt{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,s,i,o,c,h,f){return ye(()=>{let g,y=!1;const I=t/c,C=s/h,k=(i+t)/c,N=(o+s)/h,R=[I,C,k,N],P=[];e.rank===3?(y=!0,g=uo([e])):g=e;for(let z=0;z<g.shape[0];z++)P.push(R);const L=Ii(P,[P.length,4]),F=Rf(0,P.length,1,"int32"),W=x6(g,L,F,[i,o],"nearest");return ol(y?Rt(Lc(W)):W,f)})}upsize(e,t,s,i){return ye(()=>{const o=g6(e,[t,s]);return ol(o,i)})}call(e,t){return ye(()=>{const s=Rt(e),i=s.dtype,o=s.shape,c=o[o.length-3],h=o[o.length-2];let f=0;c!==this.height&&(f=Math.floor((c-this.height)/2));let g=0;return h!==this.width&&(g=Math.floor((h-this.width)/2),g===0&&(g=1)),f>=0&&g>=0?this.centerCrop(s,f,g,this.height,this.width,c,h,i):this.upsize(e,this.height,this.width,i)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=sn(e);const t=e.length-3,s=e.length-2;return e[t]=this.height,e[s]=this.width,e}}D3.className="CenterCrop",Ze(D3);/**
* @license
* Copyright 2022 CodeSmith LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function y6(n,e,t,s){let i=Rt(n);if(i.dtype!=="int32"&&(i=ol(i,"int32")),e==="int")return i;const o=i.shape;if(i.rank===0&&(i=Xs(i,-1)),e==="oneHot"&&i.shape[i.shape.length-1]!==1&&(i=Xs(i,-1)),i.rank>2)throw new he(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${o} which would result in output rank ${i.rank}.`);const c=["multiHot","oneHot"].includes(e),h=i;let f;if(typeof s<"u"&&e==="count"?f=RC(h,s,t,c):f=RC(h,[],t,c),e!=="tfIdf")return f;if(s)return pe(f,s);throw new he("When outputMode is 'tfIdf', weights must be provided.")}/**
* @license
* Copyright 2022 CodeSmith LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class O3 extends Zt{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=sn(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return ye(()=>{e=Rt(e),e.dtype!=="int32"&&(e=ol(e,"int32"));let s;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new he(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);s=Rt(t.countWeights)}const i=Na(e),o=F0(e),c=Ti(this.numTokens,i).bufferSync().get(0),h=Ec(o,0).bufferSync().get(0);if(!(c&&h))throw new he(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return y6(e,this.outputMode,this.numTokens,s)})}}O3.className="CategoryEncoding",Ze(O3);/**
* @license
* Copyright 2022 CodeSmith LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const b6=["bilinear","nearest"],P3=new Set(b6);class F3 extends Zt{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(P3.has(e.interpolation))this.interpolation=e.interpolation;else throw new he(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=sn(e);const t=e[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return ye(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return rl.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return rl.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...P3]} are supported`)})}}F3.className="Resizing",Ze(F3);/**
* @license
* Copyright 2023 CodeSmith LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class G3{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}G3.className="RandomSeed";/**
* @license
* Copyright 2023 CodeSmith LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class _3 extends Zt{constructor(e){super(e),this.randomGenerator=new G3(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}_3.className="BaseRandomLayer";/**
* @license
* Copyright 2023 CodeSmith LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const w6=["bilinear","nearest"],V3=new Set(w6);class B3 extends _3{constructor(e){super(e);const{factor:t,interpolation:s="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new he(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new he(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new he(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(V3.has(s))this.interpolation=s;else throw new he(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=sn(e);const t=e[2];return[this.imgHeight,-1,t]}call(e,t){return ye(()=>{const s=Rt(e);this.imgHeight=s.shape[s.shape.length-3];const i=s.shape[s.shape.length-2];this.widthFactor=Af([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let o=this.widthFactor.dataSync()[0]*i;o=Math.round(o);const c=[this.imgHeight,o];switch(this.interpolation){case"bilinear":return rl.resizeBilinear(e,c);case"nearest":return rl.resizeNearestNeighbor(e,c);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...V3]} are supported`)}})}}B3.className="RandomWidth",Ze(B3);/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/ke().registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*
* =============================================================================
*/var W3;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(W3||(W3={}));var z3;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(z3||(z3={}));/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*
* =============================================================================
*/var X3;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(X3||(X3={}));/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ft(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&D(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const v6=iS;class x1 extends x{nextDataId(){return x1.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new p(this,Dn())}write(e,t,s){this.firstUse&&(this.firstUse=!1,ke().get("IS_NODE")&&Z(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const i={id:this.nextDataId()};return this.data.set(i,{values:e,dtype:s,refCount:1}),i}makeTensorInfo(e,t,s){let i;if(t==="string"&&s!=null&&s.length>0&&fn(s[0])){const o=s.map(c=>jl(c));i=this.write(o,e,t)}else i=this.write(s,e,t);return{dataId:i,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,s,i,o){this.data.set(e,{values:t,dtype:i,refCount:o})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:s}=this.data.get(e);if(t==="complex64"){const i=this.readSync(s.real.dataId),o=this.readSync(s.imag.dataId);return sl(i,o)}return qs(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(i=>Yl(i));return Xt(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Xt(e.shape,e.dtype,t)}makeOutput(e,t,s){return Dn().makeTensorFromTensorInfo(this.makeTensorInfo(t,s,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=Vs();return e(),{kernelMs:Vs()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){ft([e],"where");const t=this.readSync(e.dataId);return v6(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}x1.nextDataId=0;/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Z3(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const I6={kernelName:Qu,backendName:"cpu",kernelFunc:n=>{const{x:e}=n.inputs,t=n.backend;ft(e,"abs");let s=new Float32Array(H(e.shape));const i=t.data.get(e.dataId).values;return s=Z3(i),t.makeOutput(s,e.shape,e.dtype)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function br(n){return(e,t,s,i,o)=>{const c=Ft(e,t),h=c.length,f=We(c),g=H(c),y=ue(o,g),I=e.length,C=t.length,k=We(e),N=We(t),R=Yh(e,c),P=Yh(t,c);if(R.length+P.length===0)for(let L=0;L<y.length;++L)y[L]=n(s[L%s.length],i[L%i.length]);else for(let L=0;L<y.length;++L){const F=Bi(L,h,f),W=F.slice(-I);R.forEach(J=>W[J]=0);const z=bn(W,I,k),X=F.slice(-C);P.forEach(J=>X[J]=0);const Q=bn(X,C,N);y[L]=n(s[z],i[Q])}return[y,c]}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ui(n){const{inputs:e,backend:t}=n,{real:s,imag:i}=e,o=t.data.get(s.dataId).values,c=t.data.get(i.dataId).values,h=t.makeTensorInfo(s.shape,"complex64"),f=t.data.get(h.dataId);return f.complexTensorInfos={real:t.makeTensorInfo(s.shape,"float32",o),imag:t.makeTensorInfo(i.shape,"float32",c)},h}const C6={kernelName:ei,backendName:"cpu",kernelFunc:ui};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function y1(n,e,t="float32"){if(t==="complex64"){const i=y1(n,e,"float32"),o=y1(n,e,"float32");return ui({inputs:{real:i,imag:o},backend:n})}const s=$n(H(e),t);return n.makeTensorInfo(e,t,s)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xo(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const S6={kernelName:Ie,backendName:"cpu",kernelFunc:xo};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Wc(n){const{inputs:e,backend:t}=n,{input:s}=e,i=t.data.get(s.dataId).complexTensorInfos.real,o=t.data.get(i.dataId).values;return t.makeTensorInfo(i.shape,i.dtype,o)}const T6={kernelName:Tr,backendName:"cpu",kernelFunc:Wc};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function K3(n,e,t,s){if(s==="int32"){const i=Int32Array.from(n);return[e,"int32",i]}if(s==="bool"){const i=yc([0],t),[o,c]=br((h,f)=>h!==f?1:0)(e,[],n,i,"bool");return[c,"bool",o]}throw new Error(`Error in Cast: failed to cast ${t} to ${s}`)}function du(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{dtype:o}=s;if(o==="complex64"){if(i.dtype==="complex64")return xo({inputs:{x:i},backend:t});const y=y1(t,i.shape,i.dtype),I=du({inputs:{x:i},backend:t,attrs:{dtype:"float32"}}),C=ui({inputs:{real:I,imag:y},backend:t});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(I),C}if(i.dtype==="complex64"){const y=Wc({inputs:{input:i},backend:t}),I=du({inputs:{x:y},backend:t,attrs:{dtype:o}});return t.disposeIntermediateTensorInfo(y),I}if(!Bt(i.dtype,o)){const y=xo({inputs:{x:i},backend:t});return{dataId:y.dataId,shape:y.shape,dtype:o}}const c=t.data.get(i.dataId).values,[h,f,g]=K3(c,i.shape,i.dtype,o);return t.makeTensorInfo(h,f,g)}const k6={kernelName:dr,backendName:"cpu",kernelFunc:du};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Gr(n,e,t,s){return t==null?({inputs:i,backend:o})=>{const{a:c,b:h}=i,f=o;ft([c,h],n);const g=f.data.get(c.dataId).values,y=f.data.get(h.dataId).values,I=c.dtype==="string"?il(g):g,C=c.dtype==="string"?il(y):y,k=s||c.dtype,[N,R]=e(c.shape,h.shape,I,C,k);return f.makeTensorInfo(R,k,N)}:({inputs:i,backend:o})=>{const{a:c,b:h}=i,f=o;if(c.dtype==="complex64"||h.dtype==="complex64"){const g=du({inputs:{x:c},backend:f,attrs:{dtype:"complex64"}}),y=f.data.get(g.dataId),I=y.complexTensorInfos.real,C=y.complexTensorInfos.imag,k=f.data.get(I.dataId).values,N=f.data.get(C.dataId).values,R=du({inputs:{x:h},backend:f,attrs:{dtype:"complex64"}}),P=f.data.get(R.dataId),L=P.complexTensorInfos.real,F=P.complexTensorInfos.imag,W=f.data.get(L.dataId).values,z=f.data.get(F.dataId).values,[X,Q,J]=t(c.shape,h.shape,k,N,W,z),te=f.makeTensorInfo(J,"float32",X),ie=f.makeTensorInfo(J,"float32",Q),oe=ui({inputs:{real:te,imag:ie},backend:f});return f.disposeIntermediateTensorInfo(g),f.disposeIntermediateTensorInfo(R),f.disposeIntermediateTensorInfo(te),f.disposeIntermediateTensorInfo(ie),oe}else{const g=f.data.get(c.dataId).values,y=f.data.get(h.dataId).values,I=s||c.dtype,[C,k]=e(c.shape,h.shape,g,y,I);return f.makeTensorInfo(k,I,C)}}}function tb(n){return(e,t,s,i,o,c)=>{const h=Ft(e,t),f=H(h),g=h.length,y=We(h),I=ue("float32",f),C=ue("float32",f),k=Yh(e,h),N=Yh(t,h),R=sl(s,i),P=sl(o,c),L=e.length,F=We(e),W=t.length,z=We(t);if(k.length+N.length===0)for(let X=0;X<I.length;X++){const Q=X%R.length,J=X%P.length,te=n(R[Q*2],R[Q*2+1],P[J*2],P[J*2+1]);I[X]=te.real,C[X]=te.imag}else for(let X=0;X<I.length;X++){const Q=Bi(X,g,y),J=Q.slice(-L);k.forEach(Se=>J[Se]=0);const te=bn(J,L,F),ie=Q.slice(-W);N.forEach(Se=>ie[Se]=0);const oe=bn(ie,W,z),Ce=n(R[te*2],R[te*2+1],P[oe*2],P[oe*2+1]);I[X]=Ce.real,C[X]=Ce.imag}return[I,C,h]}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const $3=br((n,e)=>n+e),E6=tb((n,e,t,s)=>({real:n+t,imag:e+s})),ld=Gr(Yr,$3,E6),N6={kernelName:Yr,backendName:"cpu",kernelFunc:ld};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function nb(n,e,t,s,i){const o=H(s),c=$n(i,t);for(let h=0;h<n.length;h++){const f=n[h];if(f<0)throw new Error("Input x must be non-negative!");f>=i||(o>0?c[f]+=e[h]:c[f]+=1)}return c}function U3(n,e,t,s=!1){const i=n.shape[0],o=n.shape[1],c=Xt([i,t],e.dtype);for(let h=0;h<i;h++)for(let f=0;f<o;f++){const g=n.get(h,f);if(g<0)throw new Error("Input x must be non-negative!");g>=t||(s?c.set(1,h,g):e.size>0?c.set(c.get(h,g)+e.get(h,f),h,g):c.set(c.get(h,g)+1,h,g))}return c}/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const H3=br((n,e)=>n&e),A6=Gr(Sh,H3),R6={kernelName:Sh,backendName:"cpu",kernelFunc:A6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yo(n){return(e,t,s)=>{const i=we(t,e.length);for(let o=0;o<e.length;++o)i[o]=n(e[o],s);return i}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xn(n,e,t){const s=yo(e);return fu(n,s,t)}function fu(n,e,t){return({inputs:s,attrs:i,backend:o})=>{const{x:c}=s;ft(c,n);const h=o,f=h.data.get(c.dataId).values;let g;if(c.dtype==="string"){if(!Array.isArray(f))throw new Error("String tensor's value was not an instance of Array");g=il(f)}else g=f;const y=t||c.dtype,I=e(g,y,i);return h.makeTensorInfo(c.shape,y,I)}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const j3=yo(n=>Math.ceil(n)),M6=fu(Zi,j3),L6={kernelName:Zi,backendName:"cpu",kernelFunc:M6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Y3(n,e,t,s){const i=we(t,H(e));if(s&&t!=="string"){let o=0;n.forEach(c=>{const h=H(c.shape);i.set(c.vals,o),o+=h})}else{let o=0;n.forEach(c=>{const h=t==="string"?il(c.vals):c.vals;let f=0;for(let g=0;g<c.shape[0];++g){const y=g*e[1]+o;for(let I=0;I<c.shape[1];++I)i[y+I]=h[f++]}o+=c.shape[1]})}return i}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Q3=br((n,e)=>n===e?1:0),J3=Gr(qt,Q3,null,"bool"),D6={kernelName:qt,backendName:"cpu",kernelFunc:J3};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const q3=yo(n=>Math.exp(n)),eE=fu(Wt,q3,"float32"),O6={kernelName:Wt,backendName:"cpu",kernelFunc:eE};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const tE=yo(n=>Math.expm1(n)),P6=fu(Wo,tE),F6={kernelName:Wo,backendName:"cpu",kernelFunc:P6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const nE=yo(n=>Math.floor(n)),G6=fu(sc,nE),_6={kernelName:sc,backendName:"cpu",kernelFunc:G6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const rE=br((n,e)=>Math.floor(n/e)),V6=Gr(Rn,rE,null,"int32"),B6={kernelName:Rn,backendName:"cpu",kernelFunc:V6};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sE(n,e,t,s,i,o,c,h,f){const g=Xt([s,o],t);for(let y=0;y<s;y++){const I=[];let C=0;for(let k=0;k<i;k++){const N=n[y*i+k];C+=N*c[k],I.push(N)}if(C<0||C>=f/o)throw new Error(`Invalid indices: ${I} does not index into ${h}`);for(let k=0;k<o;k++)g.values[y*o+k]=e.get(...e.indexToLoc(C*o+k))}return g}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function iE(n,e,t){const s=Xt(t,n.dtype);for(let i=0;i<s.size;++i){const o=s.indexToLoc(i).slice(),c=o[0],h=o[2],f=e.locToIndex([c,h]);o[2]=e.values[f];const g=n.locToIndex(o);0<=g&&g<n.values.length&&(s.values[i]=n.values[g])}return s}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const aE=br((n,e)=>n>e?1:0),W6=Gr(dn,aE,null,"bool"),z6={kernelName:dn,backendName:"cpu",kernelFunc:W6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const oE=br((n,e)=>n>=e?1:0),X6=Gr(fr,oE,null,"bool"),Z6={kernelName:fr,backendName:"cpu",kernelFunc:X6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const lE=br((n,e)=>n<e?1:0),K6=Gr(cs,lE,null,"bool"),$6={kernelName:cs,backendName:"cpu",kernelFunc:K6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const uE=br((n,e)=>n<=e?1:0),U6=Gr(wt,uE,null,"bool"),H6={kernelName:wt,backendName:"cpu",kernelFunc:U6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cE(n,e,t){const s=(e-n)/(t-1),i=$n(t,"float32");i[0]=n;for(let o=1;o<i.length;o++)i[o]=i[o-1]+s;return i}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const hE=yo(n=>Math.log(n)),j6=fu(Pl,hE),Y6={kernelName:Pl,backendName:"cpu",kernelFunc:j6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function dE(n,e,t,s){const i=ue(s,H(t));for(let o=0;o<i.length;++o){const c=o*e;let h=n[c];for(let f=0;f<e;++f){const g=n[c+f];(Number.isNaN(g)||g>h)&&(h=g)}i[o]=h}return i}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const fE=br((n,e)=>Math.max(n,e)),Q6=Gr(Ct,fE),J6={kernelName:Ct,backendName:"cpu",kernelFunc:Q6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const pE=br((n,e)=>Math.min(n,e)),q6=Gr(lc,pE),eX={kernelName:lc,backendName:"cpu",kernelFunc:q6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const rb=br((n,e)=>n*e),tX=tb((n,e,t,s)=>({real:n*t-e*s,imag:n*s+e*t})),b1=Gr(Vl,rb,tX),nX={kernelName:Vl,backendName:"cpu",kernelFunc:b1};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mE(n,e,t){const s=Hl(-1,t);return rb([],e,s,n,t)}function rX(n){const{inputs:e,backend:t}=n,{x:s}=e;ft(s,"neg");const i=t.data.get(s.dataId).values,[o,c]=mE(i,s.shape,s.dtype);return t.makeTensorInfo(c,s.dtype,o)}const sX={kernelName:to,backendName:"cpu",kernelFunc:rX};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const gE=br((n,e)=>n!==e?1:0),iX=Gr(no,gE,null,"bool"),aX={kernelName:no,backendName:"cpu",kernelFunc:iX};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sb(n,e,t,s,i){const o=e.length,c=H(e),h=We(e),f=We(i),g=ue(t,H(i));for(let y=0;y<c;++y){const I=Bi(y,o,h),C=new Array(I.length);for(let N=0;N<C.length;N++)C[N]=I[s[N]];const k=bn(C,o,f);g[k]=n[y]}return g}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function $s(n){const{inputs:e,attrs:t,backend:s}=n,{x:i}=e,{perm:o}=t;ft(i,"transpose");const c=i.shape.length,h=new Array(c);for(let y=0;y<h.length;y++)h[y]=i.shape[o[y]];const f=s.data.get(i.dataId).values,g=sb(f,i.shape,i.dtype,o,h);return{dataId:s.write(g,h,i.dtype),shape:h,dtype:i.dtype}}const oX={kernelName:K,backendName:"cpu",kernelFunc:$s};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xE(n,e,t,s){const[i,o]=Xr(n,s),c=ai(e,"int32"),h=$n(H(i),c),f=H(o);for(let g=0;g<h.length;++g){const y=g*f;let I=1;for(let C=0;C<f;++C)I*=t[y+C];h[g]=I}return{outVals:h,outShape:i,outDtype:c}}function lX(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{axis:o,keepDims:c}=s;ft(i,"prod");const h=i.shape.length,f=be(o,i.shape),g=er(f,h);let y=f,I=i;const C=[];g!=null&&(I=$s({inputs:{x:i},backend:t,attrs:{perm:g}}),C.push(I),y=gr(y.length,h));const k=t.data.get(I.dataId).values,{outVals:N,outShape:R,outDtype:P}=xE(I.shape,I.dtype,k,y);let L=R;return c&&(L=kr(R,f)),C.forEach(F=>t.disposeIntermediateTensorInfo(F)),t.makeTensorInfo(L,P,N)}const uX={kernelName:Ko,backendName:"cpu",kernelFunc:lX};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cX(n,e,t){n.forEach((s,i)=>{if(s<0||s>=t){const o=Bi(i,e.length,We(e)).join(",");throw new Error(`indices[${o}] = ${s} is not in [0, ${t})`)}})}function hX(n,e){for(let t=0;t<n.length;++t){const s=n[t],i=t===n.length-1?e:n[t+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>i)throw new Error("Ragged splits must not point past values");for(let o=1;o<s.length;++o)if(s[o-1]>s[o])throw new Error("Ragged splits must be sorted in ascending order")}}function dX(n,e,t,s){const i=[];let o=0;const c=e.length-1+t.length,h=new Array(c).fill(null).map(()=>[0]);hX(t,s);let f=1;for(let g=0;g<e.length-1;++g){f*=e[g];const y=e[g+1];for(let I=1;I<f+1;++I)h[g].push(I*y)}for(let g=0;g<n.length;++g){let y=n[g],I=n[g]+1;for(let C=0;C<t.length;++C){const k=t[C],N=C+e.length-1;if(N>=0){const R=h[N],P=R[R.length-1]-k[y];for(let L=y;L<I;++L)h[N].push(k[L+1]+P)}y=k[y],I=k[I]}I!==y&&(i.push([y,I]),o+=I-y)}return{outSplits:h,valueSlices:i,numValues:o}}function fX(n){const e=[];for(let t=0;t<n.length;++t){const s=n[t].length,i=we("int32",s);e.push(i),n[t].forEach((o,c)=>i[c]=o)}return e}function yE(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let s=e;s<n.length;s++)t[e-1]*=n[s];return t}function pX(n,e,t,s,i,o){const c=yE(e,2)[1],h=yE(o,2)[1];let f=0;for(const g of t)for(let y=g[0];y<g[1];++y){for(let I=0;I<s;++I)i[f*h+I]=n[y*c+I];++f}}function mX(n,e,t,s,i){const o=e.slice();o[0]=i;const c=we(t,H(o)),h=n.length,f=h===0?0:h/e[0];return pX(n,e,s,f,c,o),[c,o]}function bE(n,e,t,s,i,o,c,h){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const f=e[0][0]-1;if(cX(o,c,f),s.length===0)throw new Error("params.rank must be nonzero");const g=s[0],{outSplits:y,valueSlices:I,numValues:C}=dX(o,c,n,g),k=fX(y),N=mX(t,s,i,I,C);return[k,N[0],N[1]]}/**
* @license
* Copyright 2022 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const wE=2147483647;function vE(n,e,t,s,i,o,c){if(e.length>1)throw new Error("starts must be a scalar or vector");if(i.length>1)throw new Error("limits must be a scalar or vector");if(c.length>1)throw new Error("deltas must be a scalar or vector");const h=e.length===0,f=i.length===0,g=c.length===0,y=[];h||y.push(e[0]),f||y.push(i[0]),g||y.push(c[0]);for(let P=1;P<y.length;++P)if(y[P]!==y[P-1])throw new Error("starts, limits, and deltas must have the same shape");const I=y.length===0?1:y[0],C=we("int32",I+1);C[0]=0;for(let P=0;P<I;++P){const L=h?n[0]:n[P],F=f?s[0]:s[P],W=g?o[0]:o[P];if(W===0)throw new Error("Requires delta != 0");let z;if(W>0&&F<L||W<0&&F>L)z=0;else if(z=Math.ceil(Math.abs((F-L)/W)),z>wE)throw new Error(`Requires ((limit - start) / delta) <= ${wE}`);C[P+1]=C[P]+z}const k=C[I],N=we(t,k);let R=0;for(let P=0;P<I;++P){const L=C[P+1]-C[P];let F=h?n[0]:n[P];const W=g?o[0]:o[P];for(let z=0;z<L;++z)N[R++]=F,F+=W}return[C,N]}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var aa=Ra;class w1{constructor(e,t,s,i,o,c,h,f,g,y){this.shape=e,this.shapeShape=t,this.values=s,this.valuesShape=i,this.valuesDType=o,this.defaultValue=c,this.defaultValueShape=h,this.rowPartitionValues=f,this.rowPartitionValuesShapes=g,this.rowPartitionTypes=ES(y),this.raggedRank=NS(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===aa.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===aa.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case aa.VALUE_ROWIDS:return w1.getMaxWidthValueRowID(t);case aa.ROW_SPLITS:return w1.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${aa[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let s=0;for(let i=0;i<t-1;++i){const o=e[i+1]-e[i];o>s&&(s=o)}return s}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let s=0,i=e[0],o=0;for(let c=1;c<t;++c){const h=e[c];h!==i&&(i=h,o=Math.max(c-s,o),s=c)}return Math.max(t-s,o)}tensorShapeFromTensor(e,t,s=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return CE(e,s)}calculateOutputSize(e){const t=this.valuesShape,s=this.defaultValueShape;AS(s,t);const i=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=kS(this.raggedRank,i,t);o[0]<0&&(o[0]=e);for(let c=1;c<=this.raggedRank;++c)o[c]<0&&(o[c]=this.getMaxWidth(c));return o}calculateFirstParentOutputIndex(e,t,s){const i=Math.min(e,s),o=[];let c=0;for(let h=0;h<i;++h,c+=t)o.push(c);for(let h=i;h<e;++h)o.push(-1);return D(o.length===e,()=>"Final length of result must be equal to firstDimension."),o}calculateOutputIndexRowSplit(e,t,s,i){const o=e.length,c=[];for(let h=0;h<o-1;++h){const f=e[h+1]-e[h];let g=Math.min(i,f),y=t[h];y===-1&&(g=0);for(let I=0;I<g;++I)c.push(y),y+=s;for(let I=0;I<f-g;++I)c.push(-1)}if(o>0&&c.length!==e[o-1])throw new Error("Invalid row split size.");return c}calculateOutputIndexValueRowID(e,t,s,i){const o=e.length,c=[];if(o===0)return[];let h=0,f=e[0];if(f>=t.length)throw new Error(`Got currentValueRowId=${f}, which is not less than ${t.length}`);let g=t[f];c.push(g);for(let y=1;y<o;++y){const I=e[y];if(I===f)g>=0&&(++h,h<i?g+=s:g=-1);else{if(h=0,f=I,I>=t.length)throw new Error(`Got nextValueRowId=${I} which is not less than ${t.length}`);g=t[I]}c.push(g)}if(c.length!==e.length)throw new Error("Invalid row ids.");return c}calculateOutputIndex(e,t,s,i){const o=this.getRowPartitionTensor(e),c=this.getRowPartitionTypeByDimension(e);switch(c){case aa.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(o,t,s,i);case aa.ROW_SPLITS:if(o.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${o.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(o,t,s,i);default:throw new Error(`Unsupported partition type: ${aa[c]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case aa.FIRST_DIM_SIZE:return e[0];case aa.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case aa.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${aa[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),s=new Array(this.raggedRank+1);s[s.length-1]=1;for(let c=s.length-2;c>=0;--c)s[c]=s[c+1]*t[c+1];const i=CE(t,!1),o=we(this.valuesDType,H(i));if(s[0]*t[0]>0){let c=this.calculateFirstParentOutputIndex(e,s[0],t[0]);for(let h=1;h<=this.raggedRank;++h)c=this.calculateOutputIndex(h-1,c,s[h],t[h]);this.setOutput(this.raggedRank,c,o,i)}return[i,o]}setOutput(e,t,s,i){if(s.length===0)return;const o=this.values,c=s;let h=i.slice();h=h.slice(e+1);const f=H(h),g=t.length;let y=this.defaultValue;if(y.length!==f&&y.length!==1){const N=this.defaultValueShape;ye(()=>{const R=ge(y,N);y=Tf(R,h).dataSync()})}let I=0,C=0,k=0;for(let N=0;N<=g;++N){let R=N<g?t[N]:-1;if(R===k){++k;continue}if(C<k){const P=o.subarray(I*f),L=c.subarray(C*f),F=(k-C)*f;IE(L,P,F)}if(N>=g){const P=s.length;R=Math.floor(P/f)}if(R>k)if(this.defaultValue.length===1)c.subarray(k*f,R*f).fill(this.defaultValue[0]),k=R;else for(;R>k;){const P=c.slice(k*f);IE(P,y,f),++k}R<0?(I=N+1,C=k):(I=N,C=k,k=C+1)}}}function IE(n,e,t){for(let s=0;s<t;s++)n[s]=e[s]}function CE(n,e){const t=[];for(let s of n){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}t.push(s)}return t}function SE(n,e,t,s,i,o,c,h,f,g){return new w1(n,e,t,s,i,o,c,h,f,g).compute()}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function TE(n,e,t,s){const i=n===e,o=n<e&&t<0,c=e<n&&t>1;if(i||o||c)return $n(0,s);const h=Math.abs(Math.ceil((e-n)/t)),f=$n(h,s);e<n&&t===1&&(t=-1),f[0]=n;for(let g=1;g<f.length;g++)f[g]=f[g-1]+t;return f}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const kE=yo(n=>1/Math.sqrt(n)),gX=fu(bi,kE),xX={kernelName:bi,backendName:"cpu",kernelFunc:gX};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function zc(n,e,t,s,i,o,c,h,f,g){const y=[s/i,i],I=n.values,C=e.values;if(s===0)return Xt(t,e.dtype);const k=f instanceof ts?f:Xt(y,e.dtype);typeof f=="string"||typeof f=="number"?k.values.fill(f):typeof f=="boolean"&&k.values.fill(+f);for(let N=0;N<o;N++){const R=[];let P=0;for(let L=0;L<c;L++){const F=I[N*c+L];R.push(F),P+=F*h[L]}if(P<0||P>=s/i)throw new Error(`Invalid indices: ${R} does not index into ${t}`);for(let L=0;L<i;L++)g?k.values[P*i+L]+=C[N*i+L]:k.values[P*i+L]=e.rank===0?C[0]:C[N*i+L]}return k}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const yX=yo(n=>1/(1+Math.exp(-n))),EE=xn(zl,n=>1/(1+Math.exp(-n))),bX={kernelName:zl,backendName:"cpu",kernelFunc:EE};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function NE(n,e,t,s,i){const o=Ux(s,e,t),c=H(t),h=We(s);if(o){const I=Hx(e,h);return i==="string"?n.slice(I,I+c):n.subarray(I,I+c)}const f=i==="string"?il(n):n,g=Xt(s,i,f),y=Xt(t,i);for(let I=0;I<y.size;++I){const C=y.indexToLoc(I),k=C.map((N,R)=>N+e[R]);y.set(g.get(...k),...C)}return i==="string"?QS(y.values):y.values}function Xc(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{begin:o,size:c}=s;ft(i,"slice");const[h,f]=X0(i,o,c);Kx(i,h,f);const g=t.data.get(i.dataId).values,y=NE(g,h,f,i.shape,i.dtype);return t.makeTensorInfo(f,i.dtype,y)}const wX={kernelName:Ia,backendName:"cpu",kernelFunc:Xc};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function AE(n,e,t,s,i,o,c){const h=e[0],f=o[0],g=new Array(f),y=new Array(h),I=e[1];if(f===0){if(h!==0)throw new Error(_S(h));const P=we(t,0),L=we(i,0);return[P,[0,I],L,g,y]}let C=!0,k=0;const N=new Array(f).fill(0);for(let P=0;P<h;++P){const L=n[P*I];if(L<0)throw new Error(VS(P,L));if(L>=f)throw new Error(BS(P,L,f));++N[L],C=C&&L>=k,k=L}let R=!0;for(let P=0;P<f;++P){const L=N[P]===0;g[P]=L,R=R&&!L,N[P]=Math.max(N[P],1),P>0&&(N[P]+=N[P-1])}if(R&&C){const P=n,L=s;for(let F=0;F<h;++F)y[F]=F;return[P,[h,I],L,g,y]}else{const P=N[f-1],L=we(t,P*I),F=we(i,P),W=new Array(f).fill(0);for(let z=0;z<h;++z){const X=n[z*I],Q=W[X],J=(X===0?0:N[X-1])+Q;W[X]++;for(let te=0;te<I;++te)L[J*I+te]=n[z*I+te];F[J]=s[z],y[z]=J}for(let z=0;z<f;++z)if(W[z]===0){const X=z===0?0:N[z-1];L[X*I+0]=z;for(let Q=1;Q<I;++Q)L[X*I+Q]=0;F[X]=c}return[L,[P,I],F,g,y]}}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function RE(n,e,t,s,i){const o=H(s),c=e[0],h=i.length,f=[];let g=1,y=-1;for(let R=0;R<h;++R){const P=i[R];if(P===-1){if(y!==-1)throw new Error(WS(y,R));y=R,f.push(1)}else{if(P<0)throw new Error(zS(R,P));g*=P,f.push(P)}}if(y!==-1){if(g<=0)throw new Error(XS());const R=Math.trunc(o/g);if(g*R!==o)throw new Error(ZS(s,f));f[y]=R}if(H(f)!==o)throw new Error(KS(s,f));const I=s.length,C=[];if(I>0){C[I-1]=1;for(let R=I-2;R>=0;--R)C[R]=C[R+1]*s[R+1]}const k=[];if(h>0){k[h-1]=1;for(let R=h-2;R>=0;--R)k[R]=k[R+1]*f[R+1]}const N=we(t,c*h);for(let R=0;R<c;++R){let P=0;for(let L=0;L<I;++L)P+=n[R*I+L]*C[L];for(let L=0;L<h;++L)N[R*h+L]=Math.trunc(P/k[L]),P%=k[L]}return[N,[c,h],f]}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ib(n,e,t,s,i,o=!1,c=0){const h=s.length,f=[e[0],n.length/e[0]],g=f[1],y=h>0?i[h-1]+1:0;if(y<0)throw new Error(my());const I=e.slice();I[0]=y;const C=I.reduce((F,W)=>F*W,1),k=we(t,C);if(h===0)return y>0&&k.fill(c),[k,I];if(y<=0)throw new Error(my());let N=0,R=1,P=0,L=i[N];for(;;){let F=0;if(R<h){if(F=i[R],L===F){++R;continue}if(L>=F)throw new Error($S())}if(L<0||L>=y)throw new Error(US(L,y));L>P&&k.fill(c,P*g,L*g);for(let W=N;W<R;++W){const z=s[W];if(z<0||z>=f[0])throw new Error(HS(W,s[W],f[0]));for(let X=0;X<g;X++)k[L*g+X]+=n[z*g+X]}if(o)for(let W=0;W<g;W++)k[L*g+W]/=R-N;if(N=R,++R,P=L+1,L=F,R>h)break}return P<y&&k.fill(c,P*g,y*g),[k,I]}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const vX=yo(n=>Math.sqrt(n)),IX=xn(Xl,n=>Math.sqrt(n)),CX={kernelName:Xl,backendName:"cpu",kernelFunc:IX};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ME=br((n,e)=>{const t=n-e;return t*t}),SX=Gr(es,ME),TX={kernelName:es,backendName:"cpu",kernelFunc:SX};/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const LE=yo((n,e)=>{const{pattern:t,replaceGlobal:s,rewrite:i}=e;return n.replace(new RegExp(t,s?"g":""),i)}),kX=fu(ri,LE),EX={kernelName:ri,backendName:"cpu",kernelFunc:kX};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function DE(n,e,t,s){const i=Xt(n,e.dtype);for(let o=0;o<i.size;o++){const c=i.indexToLoc(o),h=new Array(c.length);for(let f=0;f<h.length;f++)h[f]=c[f]*t[f]+s[f];i.set(e.get(...h),...c)}return i}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class NX{constructor(e,t,s,i,o,c){this.separator=jl(e),this.nGramWidths=t,this.leftPad=jl(s),this.rightPad=jl(i),this.padWidth=o,this.preserveShort=c}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const s=this.getPadWidth(t);return Math.max(0,e+2*s-t+1)}createNGrams(e,t,s,i,o,c){for(let h=0;h<o;++h){const f=this.getPadWidth(c),g=Math.max(0,f-h),y=Math.max(0,f-(o-(h+1))),I=c-(g+y),C=t+(g>0?0:h-f);let k=0;k+=g*this.leftPad.length;for(let F=0;F<I;++F)k+=e[C+F].length;k+=y*this.rightPad.length;const N=g+y+I-1;k+=N*this.separator.length,s[i+h]=new Uint8Array(k);const R=s[i+h];let P=0;const L=F=>F.forEach(W=>R[P++]=W);for(let F=0;F<g;++F)L(this.leftPad),L(this.separator);for(let F=0;F<I-1;++F)L(e[C+F]),L(this.separator);if(I>0){L(e[C+I-1]);for(let F=0;F<y;++F)L(this.separator),L(this.rightPad)}else{for(let F=0;F<y-1;++F)L(this.rightPad),L(this.separator);L(this.rightPad)}}}compute(e,t){const s=e.length,i=t.length;if(i>0){let f=t[0];if(f!==0)throw new Error(`First split value must be 0, got ${f}`);for(let g=1;g<i;++g){let y=t[g]>=f;if(y=y&&t[g]<=s,!y)throw new Error(`Invalid split value ${t[g]}, must be in [${f}, ${s}]`);f=t[g]}if(f!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${f}`)}const o=i-1,c=we("int32",i);if(s===0||i===0){const f=new Array(s);for(let g=0;g<=o;++g)c[g]=0;return[f,c]}c[0]=0;for(let f=1;f<=o;++f){const g=t[f]-t[f-1];let y=0;this.nGramWidths.forEach(I=>{y+=this.getNumNGrams(g,I)}),this.preserveShort&&g>0&&y===0&&(y=1),c[f]=c[f-1]+y}const h=new Array(c[o]);for(let f=0;f<o;++f){const g=t[f];let y=c[f];if(this.nGramWidths.forEach(I=>{const C=t[f+1]-t[f],k=this.getNumNGrams(C,I);this.createNGrams(e,g,h,y,k,I),y+=k}),this.preserveShort&&y===c[f]){const I=t[f+1]-t[f];if(I===0)continue;const C=I+2*this.padWidth;this.createNGrams(e,g,h,y,1,C)}}return[h,c]}}function OE(n,e,t,s,i,o,c,h){return new NX(t,s,i,o,c,h).compute(n,e)}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function AX(n,e,t,s){if(!n.length)return;if(e.length===0){for(let o=0;o<n.length;++o)s.push(n.subarray(o,o+1));return}if(e.length===1){const o=e[0];let c=n.indexOf(o);for(;c!==-1;){const h=n.subarray(0,c);(!t||h.length!==0)&&s.push(h),n=n.subarray(c+1),c=n.indexOf(o)}(!t||n.length!==0)&&s.push(n);return}let i=0;for(let o=0;o<n.length+1;o++)if(o===n.length||e.indexOf(n[o])!==-1){const c=n.subarray(i,o);(!t||c.length!==0)&&s.push(c),i=o+1}}function PE(n,e,t){const s=n.length,i=[];let o=0,c=0;const h=new Array(s);for(let C=0;C<s;++C){const k=i.length;AX(n[C],e,t,i);const N=i.length-k;h[C]=N,o+=N,c=Math.max(c,N)}const f=we("int32",o*2),g=new Array(o),y=[s,c];let I=0;for(let C=0;C<s;++C)for(let k=0;k<h[C];++k)f[I*2]=C,f[I*2+1]=k,g[I]=i[I],++I;return[f,g,y]}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function FE(n,e){const t=we("int32",n.length);for(let s=0;s<n.length;++s)t[s]=pP(n[s]).modulo(e).getLowBitsUnsigned();return t}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const GE=br((n,e)=>n-e),RX=tb((n,e,t,s)=>({real:n-t,imag:e-s})),ab=Gr(Is,GE,RX),MX={kernelName:Is,backendName:"cpu",kernelFunc:ab};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _E(n,e){const t=new Array(n.rank);for(let i=0;i<t.length;i++)t[i]=n.shape[i]*e[i];const s=Xt(t,n.dtype);for(let i=0;i<s.values.length;++i){const o=s.indexToLoc(i),c=new Array(n.rank);for(let f=0;f<c.length;f++)c[f]=o[f]%n.shape[f];const h=n.locToIndex(c);s.values[i]=n.values[h]}return s}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Jf=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function VE(n,e,t=0,s=n.length-1){for(;s>t;){if(s-t>600){const h=s-t+1,f=e-t+1,g=Math.log(h),y=.5*Math.exp(2*g/3),I=.5*Math.sqrt(g*y*(h-y)/h)*Math.sign(f-h/2),C=Math.max(t,Math.floor(e-f*y/h+I)),k=Math.min(s,Math.floor(e+(h-f)*y/h+I));VE(n,e,C,k)}const i=n[e];let o=t,c=s;for(O(n,t,e),Jf(n[s],i)>0&&O(n,t,s);o<c;){for(O(n,o,c),o++,c--;Jf(n[o],i)<0;)o=o+1;for(;Jf(n[c],i)>0;)c=c-1}Jf(n[t],i)===0?O(n,t,c):(c=c+1,O(n,c,s)),c<=e&&(t=c+1),e<=c&&(s=c-1)}}function BE(n,e,t,s,i){const o=e[e.length-1],[c,h]=[n.length/o,o],f=ue(t,c*s),g=ue("int32",c*s);for(let I=0;I<c;I++){const C=I*h,k=n.subarray(C,C+h);let N=new Array(k.length);k.forEach((F,W)=>N[W]={value:F,index:W}),s<N.length&&(VE(N,s),N=N.slice(0,s)),i&&N.sort(Jf);const R=I*s,P=f.subarray(R,R+s),L=g.subarray(R,R+s);for(let F=0;F<s;F++)P[F]=N[F].value,L[F]=N[F].index}const y=e.slice();return y[y.length-1]=s,[Xt(y,t,f),Xt(y,"int32",g)]}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function WE(n,e,t,s){const i=be(e,t)[0],o=[1,t[0],1];for(let N=0;N<i;N++)o[0]*=t[N];o[1]=t[i];for(let N=i+1;N<t.length;N++)o[2]*=t[N];const c=new Map,h=new Int32Array(t[i]),f=new ts(o,s,n),g=[],y=o[0]===1&&o[2]===1;for(let N=0;N<t[i];N++){let R;if(y)R=n[N].toString();else{const L=[];for(let F=0;F<o[0];F++)for(let W=0;W<o[2];W++)L.push(f.get(F,N,W));R=L.join(",")}const P=c.get(R);if(P!=null)h[N]=P;else{const L=c.size;c.set(R,L),h[N]=L,g.push(N)}}const I=o.slice();I[1]=c.size;const C=new ts(I,s);g.forEach((N,R)=>{for(let P=0;P<o[0];P++)for(let L=0;L<o[2];L++)C.set(f.get(P,N,L),P,R,L)});const k=t.slice();return k[i]=I[1],{outputValues:C.values,outputShape:k,indices:h}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const LX=Object.freeze(Object.defineProperty({__proto__:null,addImpl:$3,bincountImpl:nb,bincountReduceImpl:U3,bitwiseAndImpl:H3,castImpl:K3,ceilImpl:j3,concatImpl:Y3,equalImpl:Q3,expImpl:q3,expm1Impl:tE,floorDivImpl:rE,floorImpl:nE,gatherNdImpl:sE,gatherV2Impl:iE,greaterEqualImpl:oE,greaterImpl:aE,lessEqualImpl:uE,lessImpl:lE,linSpaceImpl:cE,logImpl:hE,maxImpl:dE,maximumImpl:fE,minimumImpl:pE,multiplyImpl:rb,negImpl:mE,notEqualImpl:gE,prodImpl:xE,raggedGatherImpl:bE,raggedRangeImpl:vE,raggedTensorToTensorImpl:SE,rangeImpl:TE,rsqrtImpl:kE,scatterImpl:zc,sigmoidImpl:yX,simpleAbsImpl:Z3,sliceImpl:NE,sparseFillEmptyRowsImpl:AE,sparseReshapeImpl:RE,sparseSegmentReductionImpl:ib,sqrtImpl:vX,squaredDifferenceImpl:ME,staticRegexReplaceImpl:LE,stridedSliceImpl:DE,stringNGramsImpl:OE,stringSplitImpl:PE,stringToHashBucketFastImpl:FE,subImpl:GE,tileImpl:_E,topKImpl:BE,transposeImpl:sb,uniqueImpl:WE},Symbol.toStringTag,{value:"Module"}));/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/hC("cpu",()=>new x1,1);/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const zE=xn(Hi,n=>n>=0?n:Math.exp(n)-1),DX={kernelName:Hi,backendName:"cpu",kernelFunc:zE};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function XE(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{alpha:o}=s;ft([i],"leakyRelu");const c=H(i.shape),h=t.data.get(i.dataId).values,f=ue("float32",c);for(let g=0;g<h.length;g++)f[g]=h[g]<0?o*h[g]:h[g];return t.makeTensorInfo(i.shape,"float32",f)}const OX={kernelName:Ol,backendName:"cpu",kernelFunc:XE};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const PX=br((n,e)=>n<0?e*n:n);function ZE(n){const{inputs:e,backend:t}=n,{x:s,alpha:i}=e;ft([s,i],"prelu");const o=t.data.get(s.dataId).values,c=t.data.get(i.dataId).values,[h,f]=PX(s.shape,i.shape,o,c,"float32");return t.makeTensorInfo(f,"float32",h)}const FX={kernelName:cc,backendName:"cpu",kernelFunc:ZE};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const KE=xn(Bl,n=>Math.max(0,n)),GX={kernelName:Bl,backendName:"cpu",kernelFunc:KE};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const $E=xn($o,n=>Math.min(Math.max(0,n),6)),_X={kernelName:$o,backendName:"cpu",kernelFunc:$E};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function v1(n,e,t,s,i){if(t==="linear")return xo({inputs:{x:e},backend:n});if(t==="relu")return KE({inputs:{x:e},backend:n});if(t==="elu")return zE({inputs:{x:e},backend:n});if(t==="relu6")return $E({inputs:{x:e},backend:n});if(t==="prelu")return ZE({inputs:{x:e,alpha:s},backend:n});if(t==="leakyrelu")return XE({inputs:{x:e},backend:n,attrs:{alpha:i}});if(t==="sigmoid")return EE({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Pn(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{shape:o}=s,c=H(i.shape),h=fe(o,c),f=H(h);D(c===f,()=>`The new shape (${h}) has ${f} elements and the old shape (${i.shape}) has ${c} elements. The new shape and old shape must have the same number of elements.`),t.incRef(i.dataId);const g=t.data.get(i.dataId);if(g.complexTensorInfos!=null){const y=g.complexTensorInfos.real,I=g.complexTensorInfos.imag;y.shape=h,I.shape=h}return{dataId:i.dataId,shape:h,dtype:i.dtype}}const VX={kernelName:Fh,backendName:"cpu",kernelFunc:Pn};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function UE(n){const{inputs:e,backend:t,attrs:s}=n,{a:i,b:o}=e,{transposeA:c,transposeB:h}=s;ft([i,o],"matMul");const f=i.shape.length,g=o.shape.length,y=c?i.shape[f-2]:i.shape[f-1],I=h?o.shape[g-1]:o.shape[g-2],C=c?i.shape[f-1]:i.shape[f-2],k=h?o.shape[g-2]:o.shape[g-1],N=i.shape.slice(0,-2),R=o.shape.slice(0,-2),P=H(N),L=H(R),F=Ft(i.shape.slice(0,-2),o.shape.slice(0,-2)).concat([C,k]);D(y===I,()=>`Error in matMul: inner shapes (${y}) and (${I}) of Tensors with shapes ${i.shape} and ${o.shape} and transposeA=${c} and transposeB=${h} must match.`);const W=c?[P,y,C]:[P,C,y],z=h?[L,k,I]:[L,I,k],X=Pn({inputs:{x:i},backend:t,attrs:{shape:W}}),Q=Pn({inputs:{x:o},backend:t,attrs:{shape:z}}),J=c?X.shape[1]:X.shape[2],te=c?X.shape[2]:X.shape[1],ie=h?Q.shape[1]:Q.shape[2],oe=Math.max(P,L),Ce=t.data.get(X.dataId).values,Se=t.data.get(Q.dataId).values,Te=We(X.shape),Le=We(Q.shape),[Me,Oe,Ve]=c?[Te[0],1,Te[1]]:[Te[0],Te[1],1],[_e,Be,He]=h?[1,Le[1],Le[0]]:[Le[1],1,Le[0]],$e=te*ie,Qe=Xt([oe,te,ie],X.dtype),qe=Qe.values,nt=t.blockSize;for(let st=0;st<oe;st++){const St=st%P,vt=st%L;for(let Tt=0;Tt<te;Tt+=nt){const Mt=Math.min(Tt+nt,te);for(let Dt=0;Dt<ie;Dt+=nt){const Ut=Math.min(Dt+nt,ie);for(let ln=0;ln<J;ln+=nt){const nr=Math.min(ln+nt,J);for(let Xn=Tt;Xn<Mt;Xn++)for(let Fn=Dt;Fn<Ut;Fn++){let Gn=0;for(let Zn=ln;Zn<nr;Zn++){const wr=Ce[St*Me+Xn*Oe+Zn*Ve],cl=Se[Zn*_e+Fn*Be+vt*He];Gn+=wr*cl}qe[st*$e+(Xn*ie+Fn)]+=Gn}}}}}return t.disposeIntermediateTensorInfo(X),t.disposeIntermediateTensorInfo(Q),t.makeTensorInfo(F,Qe.dtype,Qe.values)}const BX={kernelName:Qt,backendName:"cpu",kernelFunc:UE};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function WX(n){const{inputs:e,backend:t,attrs:s}=n,{a:i,b:o,bias:c,preluActivationWeights:h}=e,{transposeA:f,transposeB:g,activation:y,leakyreluAlpha:I}=s;let C,k,N;const R=[];C=UE({inputs:{a:i,b:o},attrs:{transposeA:f,transposeB:g},backend:t}),c&&(k=ld({inputs:{a:C,b:c},backend:t}),R.push(C),C=k),y&&(N=v1(t,C,y,h,I),R.push(C),C=N);for(const P of R)t.disposeIntermediateTensorInfo(P);return C}const zX={kernelName:A,backendName:"cpu",kernelFunc:WX};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const XX=xn(_s,n=>Math.acos(n)),ZX={kernelName:_s,backendName:"cpu",kernelFunc:XX};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const KX=xn(Fo,n=>Math.acosh(n)),$X={kernelName:Fo,backendName:"cpu",kernelFunc:KX};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function UX(n){const{inputs:e,backend:t}=n,s=e;ft(e,"addN");const i=s.map(h=>t.data.get(h.dataId).values),o=Xt(s[0].shape,s[0].dtype),c=o.values;for(let h=0;h<s.length;h++){const f=i[h];for(let g=0;g<c.length;g++)c[g]+=f[g]}return t.makeTensorInfo(o.shape,o.dtype,o.values)}const HX={kernelName:vh,backendName:"cpu",kernelFunc:UX};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function jX(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{axis:o,keepDims:c}=s;ft(i,"all");const h=be(o,i.shape);let f=h;const g=er(f,i.shape.length);let y=i;g!=null&&(y=$s({inputs:{x:i},backend:t,attrs:{perm:g}}),f=gr(f.length,i.shape.length)),rs("all",f,y.shape.length);const[I,C]=Xr(y.shape,f),k=H(C),N=$n(H(I),y.dtype),R=t.data.get(y.dataId).values;for(let L=0;L<N.length;++L){const F=L*k;let W=R[F];for(let z=0;z<k;++z){const X=R[F+z];W=W&&X}N[L]=W}g!=null&&t.disposeIntermediateTensorInfo(y);const P=t.makeTensorInfo(I,y.dtype,N);if(c){const L=kr(I,h),F=Pn({inputs:{x:P},backend:t,attrs:{shape:L}});return t.disposeIntermediateTensorInfo(P),F}return P}const YX={kernelName:zi,backendName:"cpu",kernelFunc:jX};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function QX(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{axis:o,keepDims:c}=s;ft(i,"any");const h=be(o,i.shape);let f=h;const g=er(f,i.shape.length);let y=i;g!=null&&(y=$s({inputs:{x:i},backend:t,attrs:{perm:g}}),f=gr(f.length,i.shape.length)),rs("any",f,y.shape.length);const[I,C]=Xr(y.shape,f),k=H(C),N=$n(H(I),y.dtype),R=t.data.get(y.dataId).values;for(let L=0;L<N.length;++L){const F=L*k;let W=R[F];for(let z=0;z<k;++z){const X=R[F+z];W=W||X}N[L]=W}g!=null&&t.disposeIntermediateTensorInfo(y);const P=t.makeTensorInfo(I,y.dtype,N);if(c){const L=kr(I,h),F=Pn({inputs:{x:P},backend:t,attrs:{shape:L}});return t.disposeIntermediateTensorInfo(P),F}return P}const JX={kernelName:Br,backendName:"cpu",kernelFunc:QX};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function qX(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{axis:o}=s;ft(i,"argMax");let c=be(o,i.shape);const h=er(c,i.shape.length);let f=i;const g=[];h!=null&&(f=$s({inputs:{x:i},backend:t,attrs:{perm:h}}),g.push(f),c=gr(c.length,f.shape.length)),c=[c[0]],rs("argMax",c,f.shape.length);const[y,I]=Xr(f.shape,c),C=H(y),k=$n(C,"int32"),N=H(I),R=t.data.get(f.dataId).values;for(let P=0;P<k.length;++P){const L=P*N;let F=R[L],W=0;for(let z=0;z<N;++z){const X=R[L+z];X>F&&(F=X,W=z)}k[P]=W}return g.forEach(P=>t.disposeIntermediateTensorInfo(P)),t.makeTensorInfo(y,"int32",k)}const eZ={kernelName:Ju,backendName:"cpu",kernelFunc:qX};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tZ(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{axis:o}=s;ft(i,"argMin");let c=be(o,i.shape);const h=er(c,i.shape.length);let f=i;const g=[];h!=null&&(f=$s({inputs:{x:i},backend:t,attrs:{perm:h}}),g.push(f),c=gr(c.length,f.shape.length)),c=[c[0]],rs("argMin",c,f.shape.length);const[y,I]=Xr(f.shape,c),C=H(y),k=$n(C,"int32"),N=H(I),R=t.data.get(f.dataId).values;for(let P=0;P<k.length;++P){const L=P*N;let F=R[L],W=0;for(let z=0;z<N;++z){const X=R[L+z];X<F&&(F=X,W=z)}k[P]=W}return g.forEach(P=>t.disposeIntermediateTensorInfo(P)),t.makeTensorInfo(y,"int32",k)}const nZ={kernelName:Go,backendName:"cpu",kernelFunc:tZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const rZ=xn(qu,n=>Math.asin(n)),sZ={kernelName:qu,backendName:"cpu",kernelFunc:rZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const iZ=xn(_n,n=>Math.asinh(n)),aZ={kernelName:_n,backendName:"cpu",kernelFunc:iZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const oZ=xn(et,n=>Math.atan(n)),lZ={kernelName:et,backendName:"cpu",kernelFunc:oZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const uZ=br((n,e)=>Math.atan2(n,e)),cZ=Gr(on,uZ),hZ={kernelName:on,backendName:"cpu",kernelFunc:cZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const dZ=xn(Un,n=>Math.atanh(n)),fZ={kernelName:Un,backendName:"cpu",kernelFunc:dZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ob(n,e,t,s,i,o){const c=i.strideHeight,h=i.strideWidth,f=i.dilationHeight,g=i.dilationWidth,y=i.effectiveFilterHeight,I=i.effectiveFilterWidth,C=i.padInfo.top,k=i.padInfo.left,N=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,R=Xt(i.outShape,t),P=R.values,L=i.outShape[1]*i.outShape[2]*i.outShape[3],F=i.outShape[2]*i.outShape[3],W=i.outShape[3];for(let z=0;z<i.batchSize;++z){const X=z*L,Q=z*s[0];for(let J=0;J<i.inChannels;++J)for(let te=0;te<i.outHeight;++te){const ie=te*c-C,oe=Math.max(0,ie),Ce=Math.min(i.inHeight,y+ie),Se=X+te*F;for(let Te=0;Te<i.outWidth;++Te){const Le=Te*h-k,Me=Math.max(0,Le),Oe=Math.min(i.inWidth,I+Le);let Ve=N,_e=0,Be=0;for(let $e=oe;$e<Ce;$e+=f){const Qe=Q+$e*s[1];for(let qe=Me;qe<Oe;qe+=g){const nt=Qe+qe*s[2],st=n[nt+J];o==="max"&&st>Ve?Ve=st:o==="avg"&&(_e+=st,Be++)}if(isNaN(Ve))break}const He=Se+Te*W+J;P[He]=o==="avg"?_e/Be:Ve}}}return R}function HE(n,e,t,s,i=!1,o=!1){const c=Xt(s.outShape,"int32"),h=s.strideHeight,f=s.strideWidth,g=s.dilationHeight,y=s.dilationWidth,I=s.effectiveFilterHeight,C=s.effectiveFilterWidth,k=s.padInfo.top,N=s.padInfo.left,R=Xt(e,t,n);for(let P=0;P<s.batchSize;++P)for(let L=0;L<s.inChannels;++L)for(let F=0;F<s.outHeight;++F){const W=F*h-k;let z=W;for(;z<0;)z+=g;const X=Math.min(s.inHeight,I+W);for(let Q=0;Q<s.outWidth;++Q){const J=Q*f-N;let te=J;for(;te<0;)te+=y;const ie=Math.min(s.inWidth,C+J);let oe=Number.NEGATIVE_INFINITY,Ce=-1;for(let Se=z;Se<X;Se+=g){const Te=Se-W;for(let Le=te;Le<ie;Le+=y){const Me=Le-J,Oe=R.get(P,Se,Le,L);Oe>oe&&(oe=Oe,i?Ce=o?((P*s.inHeight+Se)*s.inWidth+Le)*s.inChannels+L:(Se*s.inWidth+Le)*s.inChannels+L:Ce=Te*C+Me)}}c.set(Ce,P,F,Q,L)}}return c}function jE(n,e,t,s,i,o){const c=i.strideDepth,h=i.strideHeight,f=i.strideWidth,g=i.dilationDepth,y=i.dilationHeight,I=i.dilationWidth,C=i.effectiveFilterDepth,k=i.effectiveFilterHeight,N=i.effectiveFilterWidth,R=i.padInfo.front,P=i.padInfo.top,L=i.padInfo.left,F=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,W=Xt(i.outShape,t),z=W.values,X=i.outShape[1]*i.outShape[2]*i.outShape[3]*i.outShape[4],Q=i.outShape[2]*i.outShape[3]*i.outShape[4],J=i.outShape[3]*i.outShape[4],te=i.outShape[4];for(let ie=0;ie<i.batchSize;++ie){const oe=ie*X,Ce=ie*s[0];for(let Se=0;Se<i.inChannels;++Se)for(let Te=0;Te<i.outDepth;++Te){const Le=Te*c-R;let Me=Le;for(;Me<0;)Me+=g;const Oe=Math.min(i.inDepth,C+Le),Ve=oe+Te*Q;for(let _e=0;_e<i.outHeight;++_e){const Be=_e*h-P;let He=Be;for(;He<0;)He+=y;const $e=Math.min(i.inHeight,k+Be),Qe=Ve+_e*J;for(let qe=0;qe<i.outWidth;++qe){const nt=qe*f-L;let st=nt;for(;st<0;)st+=I;const St=Math.min(i.inWidth,N+nt),vt=Qe+qe*te;let Tt=F,Mt=0,Dt=0;for(let ln=Me;ln<Oe;ln+=g){const nr=Ce+ln*s[1];for(let Xn=He;Xn<$e;Xn+=y){const Fn=nr+Xn*s[2];for(let Gn=st;Gn<St;Gn+=I){const Zn=Fn+Gn*s[3],wr=n[Zn+Se];if(o==="max"&&wr>Tt?Tt=wr:o==="avg"&&(Mt+=wr,Dt++),isNaN(Tt))break}if(isNaN(Tt))break}if(isNaN(Tt))break}const Ut=vt+Se;z[Ut]=o==="avg"?Mt/Math.max(Dt,1):Tt}}}}return W}function pZ(n,e){const t=Xt(e.outShape,"int32"),s=e.strideDepth,i=e.strideHeight,o=e.strideWidth,c=e.dilationDepth,h=e.dilationHeight,f=e.dilationWidth,g=e.effectiveFilterDepth,y=e.effectiveFilterHeight,I=e.effectiveFilterWidth,C=e.padInfo.front,k=e.padInfo.top,N=e.padInfo.left;for(let R=0;R<e.batchSize;++R)for(let P=0;P<e.inChannels;++P)for(let L=0;L<e.outDepth;++L){const F=L*s-C;let W=F;for(;W<0;)W+=c;const z=Math.min(e.inDepth,g+F);for(let X=0;X<e.outHeight;++X){const Q=X*i-k;let J=Q;for(;J<0;)J+=h;const te=Math.min(e.inHeight,y+Q);for(let ie=0;ie<e.outWidth;++ie){const oe=ie*o-N;let Ce=oe;for(;Ce<0;)Ce+=f;const Se=Math.min(e.inWidth,I+oe);let Te=Number.NEGATIVE_INFINITY,Le=-1;for(let Me=W;Me<z;Me+=c){const Oe=Me-F;for(let Ve=J;Ve<te;Ve+=h){const _e=Ve-Q;for(let Be=Ce;Be<Se;Be+=f){const He=Be-oe,$e=n.get(R,Me,Ve,Be,P);$e>=Te&&(Te=$e,Le=Oe*y*I+_e*y+He)}}}t.set(Le,R,L,X,ie,P)}}}return t}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mZ(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e;ft(i,"avgPool");const{filterSize:o,strides:c,pad:h,dimRoundingMode:f}=s,g=1;D(ds(c,g),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${c} and dilations '${g}'`);const y=qi(i.shape,o,c,g,h,f);let I;if(y.filterWidth===1&&y.filterHeight===1&&se(y.inShape,y.outShape))I=xo({inputs:{x:i},backend:t});else{const C=t.data.get(i.dataId).values,k=We(i.shape),N=ob(C,i.shape,i.dtype,k,y,"avg");I=t.makeTensorInfo(y.outShape,i.dtype,N.values)}return I}const gZ={kernelName:Nn,backendName:"cpu",kernelFunc:mZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xZ(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{filterSize:o,strides:c,pad:h,dimRoundingMode:f,dataFormat:g}=s;ft(i,"avgPool3d");const y=el(i.shape,o,c,1,h,f,g),I=t.data.get(i.dataId).values,C=jE(I,i.shape,i.dtype,We(i.shape),y,"avg");return t.makeTensorInfo(C.shape,"float32",C.values)}const yZ={kernelName:Rl,backendName:"cpu",kernelFunc:xZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function bZ(n){const{inputs:e,backend:t,attrs:s}=n,{dy:i,input:o}=e,{filterSize:c,strides:h,pad:f,dimRoundingMode:g}=s;ft([i,o],"avgPool3DGrad");const y=el(o.shape,c,h,1,f,g),I=y.strideDepth,C=y.strideHeight,k=y.strideWidth,N=y.filterDepth,R=y.filterHeight,P=y.filterWidth,L=y.dilationDepth,F=y.dilationHeight,W=y.dilationWidth,z=y.effectiveFilterDepth,X=y.effectiveFilterHeight,Q=y.effectiveFilterWidth,J=z-1-y.padInfo.front,te=Q-1-y.padInfo.left,ie=X-1-y.padInfo.top,oe=Xt(o.shape,"float32"),Ce=1/(N*R*P),Se=t.bufferSync(i);for(let Te=0;Te<y.batchSize;++Te)for(let Le=0;Le<y.inChannels;++Le)for(let Me=0;Me<y.inDepth;++Me)for(let Oe=0;Oe<y.inHeight;++Oe)for(let Ve=0;Ve<y.inWidth;++Ve){const _e=Me-J,Be=Oe-ie,He=Ve-te;let $e=0;for(let Qe=0;Qe<z;Qe+=L){const qe=(_e+Qe)/I;if(!(qe<0||qe>=y.outDepth||Math.floor(qe)!==qe))for(let nt=0;nt<X;nt+=F){const st=(Be+nt)/C;if(!(st<0||st>=y.outHeight||Math.floor(st)!==st))for(let St=0;St<Q;St+=W){const vt=(He+St)/k;if(vt<0||vt>=y.outWidth||Math.floor(vt)!==vt)continue;const Tt=Se.get(Te,qe,st,vt,Le);$e+=Tt}}}oe.set($e*Ce,Te,Me,Oe,Ve,Le)}return t.makeTensorInfo(oe.shape,oe.dtype,oe.values)}const wZ={kernelName:Ih,backendName:"cpu",kernelFunc:bZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vZ(n){const{inputs:e,backend:t,attrs:s}=n,{dy:i,input:o}=e,c=o;ft([i,o],"avgPoolGrad");const{filterSize:h,strides:f,pad:g}=s,y=qi(c.shape,h,f,1,g),I=y.strideHeight,C=y.strideWidth,k=y.filterHeight,N=y.filterWidth,R=y.dilationHeight,P=y.dilationWidth,L=y.effectiveFilterHeight,F=y.effectiveFilterWidth,W=F-1-y.padInfo.left,z=L-1-y.padInfo.top,X=Xt(c.shape,"float32"),Q=1/(k*N),J=t.data.get(i.dataId).values,te=Xt(i.shape,"float32",J);for(let ie=0;ie<y.batchSize;++ie)for(let oe=0;oe<y.inChannels;++oe)for(let Ce=0;Ce<y.inHeight;++Ce)for(let Se=0;Se<y.inWidth;++Se){const Te=Ce-z,Le=Se-W;let Me=0;for(let Oe=0;Oe<L;Oe+=R){const Ve=(Te+Oe)/I;if(!(Ve<0||Ve>=y.outHeight||Math.floor(Ve)!==Ve))for(let _e=0;_e<F;_e+=P){const Be=(Le+_e)/C;if(Be<0||Be>=y.outWidth||Math.floor(Be)!==Be)continue;const He=te.get(ie,Ve,Be,oe);Me+=He}}X.set(Me*Q,ie,Ce,Se,oe)}return t.makeTensorInfo(X.shape,X.dtype,X.values)}const IZ={kernelName:_o,backendName:"cpu",kernelFunc:vZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function CZ(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,scale:o,offset:c,mean:h,variance:f}=e;D(h.shape.length===f.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),D(c==null||h.shape.length===c.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),D(o==null||h.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),ft([i,h,f,o,c],"batchNorm");let{varianceEpsilon:g}=s;g==null&&(g=.001);const y=t.data.get(i.dataId).values,I=t.data.get(h.dataId).values,C=t.data.get(f.dataId).values,k=o?t.data.get(o.dataId).values:new Float32Array([1]),N=c?t.data.get(c.dataId).values:new Float32Array([0]),R=new Float32Array(y.length),P=N.length,L=k.length,F=C.length,W=I.length;let z=0,X=0,Q=0,J=0;for(let te=0;te<y.length;++te)R[te]=N[z++]+(y[te]-I[X++])*k[Q++]/Math.sqrt(C[J++]+g),z>=P&&(z=0),X>=W&&(X=0),Q>=L&&(Q=0),J>=F&&(J=0);return t.makeTensorInfo(i.shape,i.dtype,R)}const SZ={kernelName:xi,backendName:"cpu",kernelFunc:CZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function TZ(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{blockShape:o,crops:c}=s;ft([i],"batchToSpaceND");const h=o.reduce((L,F)=>L*F),f=Df(i.shape,o,h),g=Of(f.length,o.length),y=Pf(i.shape,o,h),I=qx(c,o.length),C=ey(y,c,o.length),k=Pn({inputs:{x:i},backend:t,attrs:{shape:f}}),N=$s({inputs:{x:k},backend:t,attrs:{perm:g}}),R=Pn({inputs:{x:N},backend:t,attrs:{shape:y}}),P=Xc({inputs:{x:R},backend:t,attrs:{begin:I,size:C}});return t.disposeIntermediateTensorInfo(k),t.disposeIntermediateTensorInfo(N),t.disposeIntermediateTensorInfo(R),P}const kZ={kernelName:Xi,backendName:"cpu",kernelFunc:TZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function EZ(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,weights:o}=e,{size:c}=s,h=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,g=nb(h,f,o.dtype,o.shape,c);return t.makeTensorInfo([c],o.dtype,g)}const NZ={kernelName:Ch,backendName:"cpu",kernelFunc:EZ};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function AZ(n){const{inputs:e,backend:t}=n,{s0:s,s1:i}=e,o=t.data.get(s.dataId).values,c=t.data.get(i.dataId).values,h=Ft(Array.from(o),Array.from(c));return t.makeTensorInfo([h.length],"int32",Int32Array.from(h))}const RZ={kernelName:Th,backendName:"cpu",kernelFunc:AZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const MZ=xn(Qa,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),LZ={kernelName:Qa,backendName:"cpu",kernelFunc:MZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const DZ={kernelName:kh,backendName:"cpu",kernelFunc:n=>{const{x:e}=n.inputs,t=n.backend,s=new Float32Array(H(e.shape)),i=t.data.get(e.dataId),o=i.complexTensorInfos.real,c=i.complexTensorInfos.imag,h=t.data.get(o.dataId).values,f=t.data.get(c.dataId).values;for(let g=0;g<h.length;g++){const y=h[g],I=f[g];s[g]=Math.hypot(y,I)}return t.makeOutput(s,e.shape,"float32")}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ud(n){const{inputs:e,backend:t}=n,{input:s}=e,i=t.data.get(s.dataId).complexTensorInfos.imag,o=t.data.get(i.dataId).values;return t.makeTensorInfo(i.shape,i.dtype,o)}const OZ={kernelName:bt,backendName:"cpu",kernelFunc:ud};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cd(n){const{inputs:e,backend:t,attrs:s}=n,{axis:i}=s,o=be(i,e[0].shape)[0],c=e.map(R=>R.shape);Yx(c,o);let h=co(e.map(R=>R.shape),o);if(H(h)===0)return t.makeTensorInfo(h,e[0].dtype,[]);const f=e.filter(R=>H(R.shape)>0);if(f.length===1)return xo({inputs:{x:f[0]},backend:t});if(f[0].dtype==="complex64"){const R=f.map(z=>Wc({inputs:{input:z},backend:t})),P=f.map(z=>ud({inputs:{input:z},backend:t})),L=cd({inputs:R,backend:t,attrs:{axis:o}}),F=cd({inputs:P,backend:t,attrs:{axis:o}}),W=ui({inputs:{real:L,imag:F},backend:t});return R.forEach(z=>t.disposeIntermediateTensorInfo(z)),P.forEach(z=>t.disposeIntermediateTensorInfo(z)),t.disposeIntermediateTensorInfo(L),t.disposeIntermediateTensorInfo(F),W}const g=f.map(R=>{const P=[-1,H(R.shape.slice(o))];return Pn({inputs:{x:R},backend:t,attrs:{shape:P}})}),y=g.map(R=>({vals:t.data.get(R.dataId).values,shape:R.shape}));h=co(g.map(R=>R.shape),1);const I=g[0].shape[0]===1,C=Y3(y,h,e[0].dtype,I),k=co(f.map(R=>R.shape),o),N=t.makeTensorInfo(k,e[0].dtype,C);return g.forEach(R=>t.disposeIntermediateTensorInfo(R)),N}const PZ={kernelName:Ki,backendName:"cpu",kernelFunc:cd};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function YE(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,filter:o}=e,{strides:c,pad:h,dataFormat:f,dilations:g,dimRoundingMode:y}=s;ft([i,o],"conv2d");const I=tl(f),C=ns(i.shape,o.shape,c,g,h,y,!1,I),k=C.filterHeight,N=C.filterWidth,R=C.dilationHeight,P=C.dilationWidth,L=C.padInfo.left,F=C.padInfo.top,W=C.dataFormat==="channelsLast",z=new ts(C.outShape,i.dtype),X=We(i.shape),Q=We(o.shape),J=X[0],te=W?X[1]:X[2],ie=W?X[2]:1,oe=W?1:X[1],Ce=z.strides[0],Se=W?z.strides[1]:z.strides[2],Te=W?z.strides[2]:1,Le=W?1:z.strides[1],Me=t.data.get(i.dataId).values,Oe=t.data.get(o.dataId).values,Ve=z.values;for(let _e=0;_e<C.batchSize;++_e){const Be=_e*J,He=_e*Ce;for(let $e=0;$e<C.outHeight;++$e){const Qe=He+$e*Se,qe=$e*C.strideHeight-F;for(let nt=0;nt<k;++nt){const st=qe+nt*R;if(st<0||st>=C.inHeight)continue;const St=nt*Q[0],vt=Be+st*te;for(let Tt=0;Tt<C.outWidth;++Tt){const Mt=Qe+Tt*Te,Dt=Tt*C.strideWidth-L;for(let Ut=0;Ut<N;++Ut){const ln=Dt+Ut*P;if(ln<0||ln>=C.inWidth)continue;const nr=St+Ut*Q[1],Xn=vt+ln*ie;let Fn=nr;for(let Gn=0;Gn<C.inChannels;++Gn){const Zn=Me[Xn+Gn*oe];for(let wr=0;wr<C.outChannels;++wr)Ve[Mt+wr*Le]+=Zn*Oe[Fn+wr];Fn+=C.outChannels}}}}}}return t.makeTensorInfo(z.shape,z.dtype,Ve)}const FZ={kernelName:Ml,backendName:"cpu",kernelFunc:YE};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function GZ(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,dy:o}=e,{strides:c,pad:h,dataFormat:f,dimRoundingMode:g,filterShape:y}=s;ft([i,o],"conv2dBackpropFilter");const I=tl(f),C=ns(i.shape,y,c,1,h,g,!1,I),{strideHeight:k,strideWidth:N,filterHeight:R,filterWidth:P}=C,L=C.dataFormat==="channelsLast",F=new ts(C.filterShape,"float32"),W=C.padInfo.left,z=C.padInfo.top,X=t.data.get(i.dataId).values,Q=t.data.get(o.dataId).values,J=new ts(i.shape,i.dtype,X),te=new ts(o.shape,o.dtype,Q);for(let ie=0;ie<R;++ie){const oe=Math.max(0,Math.ceil((z-ie)/k)),Ce=Math.min(C.outHeight,(C.inHeight+z-ie)/k);for(let Se=0;Se<P;++Se){const Te=Math.max(0,Math.ceil((W-Se)/N)),Le=Math.min(C.outWidth,(C.inWidth+W-Se)/N);for(let Me=0;Me<C.inChannels;++Me)for(let Oe=0;Oe<C.outChannels;++Oe){let Ve=0;for(let _e=0;_e<C.batchSize;++_e)for(let Be=oe;Be<Ce;++Be){const He=ie+Be*k-z;for(let $e=Te;$e<Le;++$e){const Qe=Se+$e*N-W;L?Ve+=J.get(_e,He,Qe,Me)*te.get(_e,Be,$e,Oe):Ve+=J.get(_e,Me,He,Qe)*te.get(_e,Oe,Be,$e)}}F.set(Ve,ie,Se,Me,Oe)}}}return t.makeTensorInfo(F.shape,F.dtype,F.values)}const _Z={kernelName:Qr,backendName:"cpu",kernelFunc:GZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function VZ(n){const{inputs:e,backend:t,attrs:s}=n,{dy:i,filter:o}=e,{inputShape:c,strides:h,pad:f,dataFormat:g,dimRoundingMode:y}=s;ft([i,o],"conv2dBackpropInput");const I=We(o.shape),C=We(i.shape);let k=tl(g);const N=ns(c,o.shape,h,1,f,y,!1,k),R=new ts(N.inShape,"float32"),P=R.values,L=t.data.get(i.dataId).values,F=t.data.get(o.dataId).values,[W,z,X]=I,{batchSize:Q,filterHeight:J,filterWidth:te,inChannels:ie,inHeight:oe,inWidth:Ce,outChannels:Se,outHeight:Te,outWidth:Le,strideHeight:Me,strideWidth:Oe}=N;k=N.dataFormat;const Ve=J-1-N.padInfo.top,_e=te-1-N.padInfo.left,Be=k==="channelsLast",He=R.strides[0],$e=Be?R.strides[1]:R.strides[2],Qe=Be?R.strides[2]:1,qe=Be?1:R.strides[1],nt=C[0],st=Be?C[1]:C[2],St=Be?C[2]:1,vt=Be?1:C[1];for(let Tt=0;Tt<Q;++Tt)for(let Mt=0;Mt<ie;++Mt)for(let Dt=0;Dt<oe;++Dt){const Ut=Dt-Ve,ln=Math.max(0,Math.ceil(Ut/Me)),nr=Math.min(Te,(J+Ut)/Me);for(let Xn=0;Xn<Ce;++Xn){const Fn=Xn-_e,Gn=Math.max(0,Math.ceil(Fn/Oe)),Zn=Math.min(Le,(te+Fn)/Oe);let wr=0;for(let Ls=ln;Ls<nr;++Ls){const hl=Ls*Me-Ut;for(let Ai=Gn;Ai<Zn;++Ai){const Io=Ai*Oe-Fn,xu=nt*Tt+st*Ls+St*Ai,Co=W*(J-1-hl)+z*(te-1-Io)+X*Mt;for(let _a=0;_a<Se;++_a){const yu=L[xu+vt*_a],pp=F[Co+_a];wr+=yu*pp}}}const cl=He*Tt+$e*Dt+Qe*Xn+qe*Mt;P[cl]=wr}}return t.makeTensorInfo(R.shape,R.dtype,R.values)}const BZ={kernelName:$i,backendName:"cpu",kernelFunc:VZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function WZ(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,filter:o}=e,{strides:c,pad:h,dilations:f}=s;ft([i,o],"conv3d");const g=ql(i.shape,o.shape,c,f,h),{filterDepth:y,filterHeight:I,filterWidth:C,dilationDepth:k,dilationHeight:N,dilationWidth:R,padInfo:P}=g,L=P.front,F=P.left,W=P.top,z=new ts(g.outShape,i.dtype),X=t.data.get(i.dataId).values,Q=t.data.get(o.dataId).values,J=z.values,te=We(i.shape),ie=We(o.shape);for(let oe=0;oe<g.batchSize;++oe){const Ce=oe*te[0],Se=oe*z.strides[0];for(let Te=0;Te<g.outDepth;++Te){const Le=Se+Te*z.strides[1],Me=Te*g.strideDepth-L;for(let Oe=0;Oe<y;++Oe){const Ve=Me+Oe*k;if(Ve<0||Ve>=g.inDepth)continue;const _e=Oe*ie[0],Be=Ce+Ve*te[1];for(let He=0;He<g.outHeight;++He){const $e=Le+He*z.strides[2],Qe=He*g.strideHeight-W;for(let qe=0;qe<I;++qe){const nt=Qe+qe*N;if(nt<0||nt>=g.inHeight)continue;const st=_e+qe*ie[1],St=Be+nt*te[2];for(let vt=0;vt<g.outWidth;++vt){const Tt=$e+vt*g.outChannels,Mt=vt*g.strideWidth-F;for(let Dt=0;Dt<C;++Dt){const Ut=Mt+Dt*R;if(Ut<0||Ut>=g.inWidth)continue;const ln=st+Dt*ie[2],nr=St+Ut*g.inChannels;let Xn=ln;for(let Fn=0;Fn<g.inChannels;++Fn){const Gn=X[nr+Fn];for(let Zn=0;Zn<g.outChannels;++Zn)J[Tt+Zn]+=Gn*Q[Xn+Zn];Xn+=g.outChannels}}}}}}}}return t.makeTensorInfo(z.shape,z.dtype,z.values)}const zZ={kernelName:us,backendName:"cpu",kernelFunc:WZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function XZ(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,dy:o}=e,{strides:c,pad:h,filterShape:f}=s;ft([i,o],"conv3dBackpropFilterV2");const g=We(i.shape),y=We(o.shape),I=ql(i.shape,f,c,1,h),C=I.strideDepth,k=I.strideHeight,N=I.strideWidth,R=I.filterDepth,P=I.filterHeight,L=I.filterWidth,F=new ts(I.filterShape,"float32"),W=F.values,[z,X,Q,J]=F.strides,te=t.data.get(o.dataId).values,[ie,oe,Ce,Se]=y,Te=t.data.get(i.dataId).values,[Le,Me,Oe,Ve]=g,_e=I.padInfo.front,Be=I.padInfo.left,He=I.padInfo.top;for(let $e=0;$e<R;++$e){const Qe=Math.max(0,Math.ceil((_e-$e)/C)),qe=Math.min(I.outDepth,(I.inDepth+_e-$e)/C),nt=$e*z;for(let st=0;st<P;++st){const St=Math.max(0,Math.ceil((He-st)/k)),vt=Math.min(I.outHeight,(I.inHeight+He-st)/k),Tt=st*X+nt;for(let Mt=0;Mt<L;++Mt){const Dt=Math.max(0,Math.ceil((Be-Mt)/N)),Ut=Math.min(I.outWidth,(I.inWidth+Be-Mt)/N),ln=Mt*Q+Tt;for(let nr=0;nr<I.inChannels;++nr){const Xn=nr*J+ln;for(let Fn=0;Fn<I.outChannels;++Fn){let Gn=0;for(let Zn=0;Zn<I.batchSize;++Zn){const wr=Zn*Le,cl=Zn*ie;for(let Ls=Qe;Ls<qe;++Ls){const hl=($e+Ls*C-_e)*Me+wr,Ai=Ls*oe+cl;for(let Io=St;Io<vt;++Io){const xu=(st+Io*k-He)*Oe+hl,Co=Io*Ce+Ai;for(let _a=Dt;_a<Ut;++_a){const yu=(Mt+_a*N-Be)*Ve+xu,pp=_a*Se+Co;Gn+=Te[yu+nr]*te[pp+Fn]}}}}W[Xn+Fn]=Gn}}}}}return t.makeTensorInfo(F.shape,F.dtype,F.values)}const ZZ={kernelName:lt,backendName:"cpu",kernelFunc:XZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function KZ(n){const{inputs:e,backend:t,attrs:s}=n,{dy:i,filter:o}=e,{pad:c,strides:h,inputShape:f}=s;ft([i],"conv3dBackpropInputV2");const g=We(i.shape),y=We(o.shape),I=ql(f,o.shape,h,1,c),C=new ts(I.inShape,"float32"),k=C.values,[N,R,P,L]=C.strides,F=t.data.get(i.dataId).values,[W,z,X,Q]=g,J=t.data.get(o.dataId).values,[te,ie,oe,Ce]=y,{batchSize:Se,filterDepth:Te,filterHeight:Le,filterWidth:Me,inChannels:Oe,inDepth:Ve,inHeight:_e,inWidth:Be,outChannels:He,outDepth:$e,outHeight:Qe,outWidth:qe,strideDepth:nt,strideHeight:st,strideWidth:St}=I,vt=Te-1-I.padInfo.front,Tt=Le-1-I.padInfo.top,Mt=Me-1-I.padInfo.left;for(let Dt=0;Dt<Se;++Dt)for(let Ut=0;Ut<Oe;++Ut)for(let ln=0;ln<Ve;++ln){const nr=ln-vt,Xn=Math.max(0,Math.ceil(nr/nt)),Fn=Math.min($e,(Te+nr)/nt);for(let Gn=0;Gn<_e;++Gn){const Zn=Gn-Tt,wr=Math.max(0,Math.ceil(Zn/st)),cl=Math.min(Qe,(Le+Zn)/st);for(let Ls=0;Ls<Be;++Ls){const hl=Ls-Mt,Ai=Math.max(0,Math.ceil(hl/St)),Io=Math.min(qe,(Me+hl)/St);let xu=0;for(let Co=Xn;Co<Fn;++Co){const _a=Co*nt-nr;for(let yu=wr;yu<cl;++yu){const pp=yu*st-Zn;for(let H1=Ai;H1<Io;++H1){const Pae=H1*St-hl,Fae=W*Dt+z*Co+X*yu+Q*H1,Gae=te*(Te-1-_a)+ie*(Le-1-pp)+oe*(Me-1-Pae)+Ce*Ut;for(let j1=0;j1<He;++j1){const _ae=F[Fae+j1],Vae=J[Gae+j1];xu+=_ae*Vae}}}}k[N*Dt+R*ln+P*Gn+L*Ls+Ut]=xu}}}return t.makeTensorInfo(C.shape,C.dtype,C.values)}const $Z={kernelName:Ja,backendName:"cpu",kernelFunc:KZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const UZ=xn(Vo,n=>Math.cos(n)),HZ={kernelName:Vo,backendName:"cpu",kernelFunc:UZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const jZ=xn(Rr,n=>Math.cosh(n)),YZ={kernelName:Rr,backendName:"cpu",kernelFunc:jZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function QZ(n){const{inputs:e,backend:t,attrs:s}=n,{image:i,boxes:o,boxInd:c}=e,{cropSize:h,method:f,extrapolationValue:g}=s,[y,I,C,k]=i.shape,N=o.shape[0],[R,P]=h,L=Xt([N,R,P,k],"float32"),F=t.data.get(o.dataId).values,W=t.data.get(c.dataId).values,z=t.data.get(i.dataId).values,X=We(i.shape),Q=We(L.shape);for(let J=0;J<N;J++){const te=J*4,ie=F[te],oe=F[te+1],Ce=F[te+2],Se=F[te+3],Te=W[J];if(Te>=y)continue;const Le=R>1?(Ce-ie)*(I-1)/(R-1):0,Me=P>1?(Se-oe)*(C-1)/(P-1):0;for(let Oe=0;Oe<R;Oe++){const Ve=R>1?ie*(I-1)+Oe*Le:.5*(ie+Ce)*(I-1);if(Ve<0||Ve>I-1){for(let _e=0;_e<P;_e++)for(let Be=0;Be<k;Be++){const He=Be+_e*Q[2]+Oe*Q[1]+J*Q[0];L.values[He]=g}continue}if(f==="bilinear"){const _e=Math.floor(Ve),Be=Math.ceil(Ve),He=Ve-_e;for(let $e=0;$e<P;$e++){const Qe=P>1?oe*(C-1)+$e*Me:.5*(oe+Se)*(C-1);if(Qe<0||Qe>C-1){for(let St=0;St<k;St++){const vt=St+$e*Q[2]+Oe*Q[1]+J*Q[0];L.values[vt]=g}continue}const qe=Math.floor(Qe),nt=Math.ceil(Qe),st=Qe-qe;for(let St=0;St<k;St++){let vt=St+qe*X[2]+_e*X[1]+Te*X[0];const Tt=z[vt];vt=St+nt*X[2]+_e*X[1]+Te*X[0];const Mt=z[vt];vt=St+qe*X[2]+Be*X[1]+Te*X[0];const Dt=z[vt];vt=St+nt*X[2]+Be*X[1]+Te*X[0];const Ut=z[vt],ln=Tt+(Mt-Tt)*st,nr=Dt+(Ut-Dt)*st;vt=St+$e*Q[2]+Oe*Q[1]+J*Q[0],L.values[vt]=ln+(nr-ln)*He}}}else for(let _e=0;_e<P;++_e){const Be=P>1?oe*(C-1)+_e*Me:.5*(oe+Se)*(C-1);if(Be<0||Be>C-1){for(let Qe=0;Qe<k;Qe++){const qe=Qe+_e*Q[2]+Oe*Q[1]+J*Q[0];L.values[qe]=g}continue}const He=Math.round(Be),$e=Math.round(Ve);for(let Qe=0;Qe<k;Qe++){const qe=Qe+He*X[2]+$e*X[1]+Te*X[0],nt=Qe+_e*Q[2]+Oe*Q[1]+J*Q[0];L.values[nt]=z[qe]}}}}return t.makeTensorInfo(L.shape,L.dtype,L.values)}const JZ={kernelName:Ll,backendName:"cpu",kernelFunc:QZ};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function qZ(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{axis:o,exclusive:c,reverse:h}=s;ft(i,"cumprod");const f=er([o],i.shape.length);let g=i;f!=null&&(g=$s({inputs:{x:i},backend:t,attrs:{perm:f}}));const y=gr(1,i.shape.length)[0];if(y!==g.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${g.shape.length-1} but got axis=${y}`);const I=ai(g.dtype,"int32"),C=En(H(g.shape),I),k=t.data.get(g.dataId).values,N=g.shape[g.shape.length-1],R=h?(L,F)=>L+N-F-1:(L,F)=>L+F;for(let L=0;L<k.length;L+=N)for(let F=0;F<N;F++){const W=R(L,F);if(F===0)C[W]=c?1:k[W];else{const z=R(L,F-1);C[W]=c?k[z]*C[z]:k[W]*C[z]}}const P=t.makeTensorInfo(g.shape,I,C);if(f!=null){const L=eu(f),F=$s({inputs:{x:P},backend:t,attrs:{perm:L}});return t.disposeIntermediateTensorInfo(P),t.disposeIntermediateTensorInfo(g),F}return P}const e7={kernelName:qa,backendName:"cpu",kernelFunc:qZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function t7(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{axis:o,exclusive:c,reverse:h}=s;ft(i,"cumsum");const f=er([o],i.shape.length);let g=i;f!=null&&(g=$s({inputs:{x:i},backend:t,attrs:{perm:f}}));const y=gr(1,i.shape.length)[0];if(y!==g.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${g.shape.length-1} but got axis=${y}`);const I=ai(g.dtype,"int32"),C=$n(H(g.shape),I),k=t.data.get(g.dataId).values,N=g.shape[g.shape.length-1],R=h?(L,F)=>L+N-F-1:(L,F)=>L+F;for(let L=0;L<k.length;L+=N)for(let F=0;F<N;F++){const W=R(L,F);if(F===0)C[W]=c?0:k[W];else{const z=R(L,F-1);C[W]=c?k[z]+C[z]:k[W]+C[z]}}const P=t.makeTensorInfo(g.shape,I,C);if(f!=null){const L=eu(f),F=$s({inputs:{x:P},backend:t,attrs:{perm:L}});return t.disposeIntermediateTensorInfo(P),t.disposeIntermediateTensorInfo(g),F}return P}const n7={kernelName:Bo,backendName:"cpu",kernelFunc:t7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function r7(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,weights:o}=e,{size:c,binaryOutput:h}=s;if(i.shape.length===1){const f=t.data.get(i.dataId).values,g=t.data.get(o.dataId).values,y=nb(f,g,o.dtype,o.shape,c);return t.makeTensorInfo([c],o.dtype,y)}else if(i.shape.length===2){const f=t.bufferSync(i),g=t.bufferSync(o),y=U3(f,g,c,h);return t.makeTensorInfo(y.shape,o.dtype,y.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}const s7={kernelName:ti,backendName:"cpu",kernelFunc:r7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function i7(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{blockSize:o,dataFormat:c}=s;D(c==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${c}`);const h=i.shape[0],f=i.shape[1],g=i.shape[2],y=i.shape[3],I=f*o,C=g*o,k=y/(o*o),N=t.data.get(i.dataId).values,R=new Float32Array(h*I*C*k);let P=0;for(let L=0;L<h;++L)for(let F=0;F<I;++F){const W=Math.floor(F/o),z=F%o;for(let X=0;X<C;++X){const Q=Math.floor(X/o),J=X%o,te=(z*o+J)*k;for(let ie=0;ie<k;++ie){const oe=ie+te+y*(Q+g*(W+f*L));R[P++]=N[oe]}}}return t.makeTensorInfo([h,I,C,k],i.dtype,R)}const a7={kernelName:cf,backendName:"cpu",kernelFunc:i7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function QE(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,filter:o}=e,{strides:c,pad:h,dilations:f,dimRoundingMode:g}=s;ft([i,o],"depthwiseConv2DNative");const y=We(i.shape),I=We(o.shape);let C=f;C==null&&(C=[1,1]),D(ds(c,C),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${c} and dilations '${C}'`);const k=ns(i.shape,o.shape,c,C,h,g,!0),{filterHeight:N,filterWidth:R,dilationHeight:P,dilationWidth:L,padInfo:F}=k,W=F.left,z=F.top,X=k.outChannels/k.inChannels,Q=new ts(k.outShape,i.dtype),J=t.data.get(i.dataId).values,te=t.data.get(o.dataId).values,ie=Q.values;for(let oe=0;oe<k.batchSize;++oe){const Ce=oe*y[0],Se=oe*Q.strides[0];for(let Te=0;Te<k.outHeight;++Te){const Le=Se+Te*Q.strides[1],Me=Te*k.strideHeight-z;for(let Oe=0;Oe<N;++Oe){const Ve=Me+Oe*P;if(Ve<0||Ve>=k.inHeight)continue;const _e=Oe*I[0],Be=Ce+Ve*y[1];for(let He=0;He<k.outWidth;++He){const $e=Le+He*Q.strides[2],Qe=He*k.strideWidth-W;for(let qe=0;qe<R;++qe){const nt=Qe+qe*L;if(nt<0||nt>=k.inWidth)continue;const st=_e+qe*I[1],St=Be+nt*k.inChannels;let vt=$e,Tt=st;for(let Mt=0;Mt<k.inChannels;++Mt){const Dt=J[St+Mt];for(let Ut=0;Ut<X;++Ut)ie[vt+Ut]+=Dt*te[Tt+Ut];vt+=X,Tt+=X}}}}}}return t.makeTensorInfo(Q.shape,Q.dtype,Q.values)}const o7={kernelName:Eh,backendName:"cpu",kernelFunc:QE};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function l7(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,dy:o}=e,{strides:c,dilations:h,pad:f,dimRoundingMode:g,filterShape:y}=s;ft([i,o],"depthwiseConv2dNativeBackpropFilter");const I=ns(i.shape,y,c,h,f,g,!0),{strideHeight:C,strideWidth:k,filterHeight:N,filterWidth:R}=I,P=new ts(I.filterShape,"float32"),L=I.padInfo.left,F=I.padInfo.top,W=I.outChannels/I.inChannels,z=t.data.get(i.dataId).values,X=new ts(i.shape,i.dtype,z),Q=t.data.get(o.dataId).values,J=new ts(o.shape,o.dtype,Q);for(let te=0;te<N;++te){const ie=Math.max(0,Math.ceil((F-te)/C)),oe=Math.min(I.outHeight,(I.inHeight+F-te)/C);for(let Ce=0;Ce<R;++Ce){const Se=Math.max(0,Math.ceil((L-Ce)/k)),Te=Math.min(I.outWidth,(I.inWidth+L-Ce)/k);for(let Le=0;Le<I.outChannels;++Le){const Me=Math.trunc(Le/W),Oe=Le%W;let Ve=0;for(let _e=0;_e<I.batchSize;++_e)for(let Be=ie;Be<oe;++Be){const He=te+Be*C-F;for(let $e=Se;$e<Te;++$e){const Qe=Ce+$e*k-L;Ve+=X.get(_e,He,Qe,Me)*J.get(_e,Be,$e,Le)}}P.set(Ve,te,Ce,Me,Oe)}}}return t.makeTensorInfo(P.shape,P.dtype,P.values)}const u7={kernelName:ni,backendName:"cpu",kernelFunc:l7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function c7(n){const{inputs:e,backend:t,attrs:s}=n,{dy:i,filter:o}=e,{strides:c,dilations:h,pad:f,dimRoundingMode:g,inputShape:y}=s;ft([i,o],"depthwiseConv2DNativeBackpropInput");const I=We(i.shape),C=We(o.shape),k=ns(y,o.shape,c,h,f,g,!0),N=new ts(k.inShape,"float32"),R=N.values,[P,L,F]=N.strides,W=t.data.get(i.dataId).values,[z,X,Q]=I,J=t.data.get(o.dataId).values,[te,ie,oe]=C,{batchSize:Ce,filterHeight:Se,filterWidth:Te,inChannels:Le,inHeight:Me,inWidth:Oe,outChannels:Ve,outHeight:_e,outWidth:Be,strideHeight:He,strideWidth:$e}=k,Qe=Se-1-k.padInfo.top,qe=Te-1-k.padInfo.left,nt=Ve/Le;for(let st=0;st<Ce;++st)for(let St=0;St<Le;++St)for(let vt=0;vt<Me;++vt){const Tt=vt-Qe,Mt=Math.max(0,Math.ceil(Tt/He)),Dt=Math.min(_e,(Se+Tt)/He);for(let Ut=0;Ut<Oe;++Ut){const ln=Ut-qe,nr=Math.max(0,Math.ceil(ln/$e)),Xn=Math.min(Be,(Te+ln)/$e);let Fn=0;for(let Gn=Mt;Gn<Dt;++Gn){const Zn=Gn*He-Tt;for(let wr=nr;wr<Xn;++wr){const cl=wr*$e-ln,Ls=z*st+X*Gn+Q*wr,hl=te*(Se-1-Zn)+ie*(Te-1-cl)+oe*St;for(let Ai=0;Ai<nt;++Ai){const Io=St*nt+Ai,xu=W[Ls+Io],Co=J[hl+Ai];Fn+=xu*Co}}}R[P*st+L*vt+F*Ut+St]=Fn}}return t.makeTensorInfo(N.shape,N.dtype,N.values)}const h7={kernelName:Wr,backendName:"cpu",kernelFunc:c7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function d7(n){const{inputs:e,backend:t}=n,{x:s}=e,i=H(s.shape),o=t.data.get(s.dataId).values,c=Xt([i,i],s.dtype),h=c.values;for(let g=0;g<o.length;g++)h[g*i+g]=o[g];const f=[...s.shape,...s.shape];return t.makeTensorInfo(f,c.dtype,c.values)}const f7={kernelName:An,backendName:"cpu",kernelFunc:d7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const p7={kernelName:ec,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:i}=n,{strides:o,pad:c,dilations:h}=t,f=e,g=f.data.get(s.dataId).values,y=s.shape.length,I=f.data.get(i.dataId).values,C=i.shape.length,{batchSize:k,inHeight:N,inWidth:R,inChannels:P,outHeight:L,outWidth:F,padInfo:W,strideHeight:z,strideWidth:X,filterHeight:Q,filterWidth:J,dilationHeight:te,dilationWidth:ie,outShape:oe}=If(s.shape,i.shape,o,c,"NHWC",h),Ce=H(oe),Se=oe.length,Te=we(s.dtype,Ce);for(let Le=0;Le<k;++Le)for(let Me=0;Me<L;++Me){const Oe=Me*z-W.top;for(let Ve=0;Ve<F;++Ve){const _e=Ve*X-W.left;for(let Be=0;Be<P;++Be){let He=Number.MIN_SAFE_INTEGER;for(let Qe=0;Qe<Q;++Qe){const qe=Oe+Qe*te;if(qe>=0&&qe<N)for(let nt=0;nt<J;++nt){const st=_e+nt*ie;if(st>=0&&st<R){const St=bn([Le,qe,st,Be],y,We(s.shape)),vt=bn([Qe,nt,Be],C,We(i.shape)),Tt=g[St]+I[vt];Tt>He&&(He=Tt)}}}const $e=bn([Le,Me,Ve,Be],Se,We(oe));Te[$e]=He}}}return{dataId:f.write(yc(Te,s.dtype),oe,s.dtype),shape:oe,dtype:s.dtype}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const m7={kernelName:tc,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:i,dy:o}=n,{strides:c,pad:h,dilations:f}=t,g=e,y=Lt(s.shape,g.data.get(s.dataId).values),I=Lt(i.shape,g.data.get(i.dataId).values),{batchSize:C,inHeight:k,inWidth:N,inChannels:R,outHeight:P,outWidth:L,padInfo:F,strideHeight:W,strideWidth:z,filterHeight:X,filterWidth:Q,dilationHeight:J,dilationWidth:te,outShape:ie}=If(s.shape,i.shape,c,h,"NHWC",f);D(o.rank===ie.length,()=>`Error in ${tc}, dy must have the same rank as output ${ie.length}, but got ${o.rank}`);const oe=Lt(ie,g.data.get(o.dataId).values),Ce=yt(i.shape,i.dtype);for(let Se=0;Se<C;++Se)for(let Te=0;Te<P;++Te){const Le=Te*W-F.top;for(let Me=0;Me<L;++Me){const Oe=Me*z-F.left;for(let Ve=0;Ve<R;++Ve){let _e=Number.MIN_SAFE_INTEGER,Be=0,He=0;for(let $e=0;$e<X;++$e){const Qe=Le+$e*J;if(Qe>=0&&Qe<k)for(let qe=0;qe<Q;++qe){const nt=Oe+qe*te;if(nt>=0&&nt<N){const st=y[Se][Qe][nt][Ve]+I[$e][qe][Ve];st>_e&&(_e=st,Be=$e,He=qe)}}}Ce[Be][He][Ve]+=oe[Se][Te][Me][Ve]}}}return{dataId:g.write(yc(Ce,s.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const g7={kernelName:Ui,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:i,dy:o}=n,{strides:c,pad:h,dilations:f}=t,g=e,y=Lt(s.shape,g.data.get(s.dataId).values),I=Lt(i.shape,g.data.get(i.dataId).values),{batchSize:C,inHeight:k,inWidth:N,inChannels:R,outHeight:P,outWidth:L,padInfo:F,strideHeight:W,strideWidth:z,filterHeight:X,filterWidth:Q,dilationHeight:J,dilationWidth:te,outShape:ie}=If(s.shape,i.shape,c,h,"NHWC",f);D(o.rank===ie.length,()=>`Error in ${Ui}, dy must have the same rank as output ${ie.length}, but got ${o.rank}`);const oe=Lt(ie,g.data.get(o.dataId).values),Ce=yt(s.shape,s.dtype);for(let Se=0;Se<C;++Se)for(let Te=0;Te<P;++Te){const Le=Te*W-F.top;for(let Me=0;Me<L;++Me){const Oe=Me*z-F.left;for(let Ve=0;Ve<R;++Ve){let _e=Number.MIN_SAFE_INTEGER,Be=Le<0?0:Le,He=Oe<0?0:Oe;for(let $e=0;$e<X;++$e){const Qe=Le+$e*J;if(Qe>=0&&Qe<k)for(let qe=0;qe<Q;++qe){const nt=Oe+qe*te;if(nt>=0&&nt<N){const st=y[Se][Qe][nt][Ve]+I[$e][qe][Ve];st>_e&&(_e=st,Be=Qe,He=nt)}}}Ce[Se][Be][He][Ve]+=oe[Se][Te][Me][Ve]}}}return{dataId:g.write(yc(Ce,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function x7(n){const{inputs:e,backend:t,attrs:s}=n,{image:i}=e,{canvas:o,options:c}=s,{contextOptions:h,imageOptions:f}=c||{},g=(f==null?void 0:f.alpha)||1,y=(h==null?void 0:h.contextType)||"2d";if(y!=="2d")throw new Error(`Context type ${h.contextType} is not supported by the CPU backend.`);const I=o.getContext(y,(h==null?void 0:h.contextAttributes)||{});if(I==null)throw new Error(`Could not get the context with ${y} type.`);const[C,k]=i.shape.slice(0,2),N=i.shape.length===2?1:i.shape[2],R=t.data.get(i.dataId).values,P=i.dtype==="float32"?255:1,L=new Uint8ClampedArray(k*C*4);for(let W=0;W<C*k;++W){const z=[0,0,0,255*g];for(let Q=0;Q<N;Q++){const J=R[W*N+Q];if(i.dtype==="float32"){if(J<0||J>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${J}.`)}else if(i.dtype==="int32"&&(J<0||J>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${J}.`);N===1?(z[0]=J*P,z[1]=J*P,z[2]=J*P):z[Q]=J*P}const X=W*4;L[X+0]=Math.round(z[0]),L[X+1]=Math.round(z[1]),L[X+2]=Math.round(z[2]),L[X+3]=Math.round(z[3])}o.width=k,o.height=C;const F=new ImageData(L,k,C);return I.putImageData(F,0,0),i}const y7={kernelName:ze,backendName:"cpu",kernelFunc:x7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function qf(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{axis:o,keepDims:c}=s;ft(i,"sum");let h;i.dtype==="bool"?h=du({inputs:{x:i},backend:t,attrs:{dtype:"int32"}}):h=xo({inputs:{x:i},backend:t});const f=h.shape.length,g=be(o,h.shape),y=er(g,f);let I=g,C=h;y!=null&&(C=$s({inputs:{x:h},backend:t,attrs:{perm:y}}),I=gr(I.length,f)),rs("sum",I,C.shape.length);const[k,N]=Xr(C.shape,I),R=ai(C.dtype,"int32");let P=y1(t,k,R);const L=H(N),F=t.data.get(P.dataId).values,W=t.data.get(C.dataId).values;for(let z=0;z<F.length;++z){const X=z*L;let Q=0;for(let J=0;J<L;++J)Q+=W[X+J];F[z]=Q}if(c){const z=kr(P.shape,g),X=P;P=Pn({inputs:{x:P},backend:t,attrs:{shape:z}}),t.disposeIntermediateTensorInfo(X)}return t.disposeIntermediateTensorInfo(h),y!=null&&t.disposeIntermediateTensorInfo(C),P}const b7={kernelName:dc,backendName:"cpu",kernelFunc:qf};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function w7(n){const{inputs:e,backend:t,attrs:s}=n,{equation:i}=s,o=e,{allDims:c,summedDims:h,idDims:f}=uy(i,o.length);hy(c.length,f,o);const{path:g,steps:y}=dy(h,f),I=y.length;let C=null,k=c.length;const N=[];for(let R=0;R<I;++R){for(const P of y[R]){const{permutationIndices:L,expandDims:F}=cy(k,f[P]);let W;fy(L)?W=o[P]:(W=$s({inputs:{x:o[P]},backend:t,attrs:{perm:L}}),N.push(W));const z=W.shape.slice();for(let X=0;X<F.length;++X)z.splice(F[X],0,1);se(W.shape,z)||(W=Pn({inputs:{x:W},backend:t,attrs:{shape:z}}),N.push(W)),C===null?C=W:(C=b1({inputs:{a:W,b:C},backend:t}),N.push(C))}R<I-1&&(g[R]>=0&&(C=qf({inputs:{x:C},backend:t,attrs:{axis:g[R]-(c.length-k),keepDims:!1}}),N.push(C)),k--)}for(const R of N)R!==C&&t.disposeIntermediateTensorInfo(R);return C}const v7={kernelName:Vn,backendName:"cpu",kernelFunc:w7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function I7(n){const{inputs:e,backend:t}=n,{dy:s,y:i}=e;ft([s,i],"eluGrad");const o=new Float32Array(H(i.shape)),c=t.data.get(i.dataId).values,h=t.data.get(s.dataId).values;for(let f=0;f<c.length;++f){const g=c[f];g>=0?o[f]=h[f]:o[f]=h[f]*(g+1)}return t.makeTensorInfo(i.shape,"float32",o)}const C7={kernelName:hf,backendName:"cpu",kernelFunc:I7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const S7=ty,T7=ny,k7=ry,E7=sy,N7=iy,A7=ay,R7=xn(Jt,n=>{const e=Math.sign(n),t=Math.abs(n),s=1/(1+S7*t);return e*(1-((((A7*s+N7)*s+E7)*s+k7)*s+T7)*s*Math.exp(-t*t))}),M7={kernelName:Jt,backendName:"cpu",kernelFunc:R7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function I1(n){const{inputs:e,backend:t,attrs:s}=n,{input:i}=e,{dim:o}=s,c=i.shape.length,h=i.shape.slice();let f=o;return o<0&&(D(-(c+1)<=o,()=>`Axis must be in the interval [${-(c+1)}, ${c}]`),f=c+o+1),h.splice(f,0,1),Pn({inputs:{x:i},backend:t,attrs:{shape:h}})}const L7={kernelName:Dl,backendName:"cpu",kernelFunc:I1};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const D7=br((n,e)=>n/e),lb=Gr(nc,D7),ub={kernelName:nc,backendName:"cpu",kernelFunc:lb};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function JE(n,e,t){const s=n.shape,i=s[0],o=s[1],c=t.data.get(n.dataId),h=c.complexTensorInfos.real,f=c.complexTensorInfos.imag,g=[i,o],y=H(g),I=ue("float32",y),C=ue("float32",y);for(let P=0;P<i;P++){const L=Xc({inputs:{x:h},backend:t,attrs:{begin:[P,0],size:[1,o]}}),F=Xc({inputs:{x:f},backend:t,attrs:{begin:[P,0],size:[1,o]}}),W=ui({inputs:{real:L,imag:F},backend:t}),{real:z,imag:X}=O7(W,e,t),Q=sl(z,X);for(let J=0;J<o;J++){const te=oy(Q,J);I[P*o+J]=te.real,C[P*o+J]=te.imag}t.disposeIntermediateTensorInfo(L),t.disposeIntermediateTensorInfo(F),t.disposeIntermediateTensorInfo(W)}const k=t.makeTensorInfo(g,"float32",I),N=t.makeTensorInfo(g,"float32",C),R=ui({inputs:{real:k,imag:N},backend:t});return t.disposeIntermediateTensorInfo(k),t.disposeIntermediateTensorInfo(N),R}function O7(n,e,t){const s=H(n.shape),i=t.data.get(n.dataId),o=t.data.get(i.complexTensorInfos.real.dataId).values,c=t.data.get(i.complexTensorInfos.imag.dataId).values;if(P7(s)){const h=cb(o,c,s,e,t),f=[n.shape[0],n.shape[1]];if(e){const g=t.makeTensorInfo(f,"float32",h.real),y=t.makeTensorInfo(f,"float32",h.imag),I=t.makeTensorInfo([],"float32",Hl(s,"float32")),C=xo({inputs:{x:I},backend:t}),k=ub.kernelFunc({inputs:{a:g,b:I},backend:t}),N=ub.kernelFunc({inputs:{a:y,b:C},backend:t}),R=t.data.get(k.dataId).values,P=t.data.get(N.dataId).values;return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(I),t.disposeIntermediateTensorInfo(C),t.disposeIntermediateTensorInfo(k),t.disposeIntermediateTensorInfo(N),{real:R,imag:P}}return h}else{const h=sl(o,c),f=F7(h,s,e);return RS(f)}}function P7(n){return(n&n-1)===0}function cb(n,e,t,s,i){if(t===1)return{real:n,imag:e};const o=sl(n,e),c=t/2,h=MS(o),f=h.real,g=h.imag,y=[f.length],I=i.makeTensorInfo(y,"float32",f),C=i.makeTensorInfo(y,"float32",g),k=ui({inputs:{real:I,imag:C},backend:i}),N=LS(o),R=N.real,P=N.imag,L=[R.length],F=i.makeTensorInfo(L,"float32",R),W=i.makeTensorInfo(L,"float32",P),z=ui({inputs:{real:F,imag:W},backend:i}),X=cb(f,g,c,s,i),Q=X.real,J=X.imag,te=[Q.length],ie=i.makeTensorInfo(te,"float32",Q),oe=i.makeTensorInfo(te,"float32",J),Ce=ui({inputs:{real:ie,imag:oe},backend:i}),Se=cb(R,P,c,s,i),Te=Se.real,Le=Se.imag,Me=[Te.length],Oe=i.makeTensorInfo(Me,"float32",Te),Ve=i.makeTensorInfo(Me,"float32",Le),_e=ui({inputs:{real:Oe,imag:Ve},backend:i}),Be=OS(t,s),He=[Be.real.length],$e=i.makeTensorInfo(He,"float32",Be.real),Qe=i.makeTensorInfo(He,"float32",Be.imag),qe=ui({inputs:{real:$e,imag:Qe},backend:i}),nt=b1({inputs:{a:qe,b:_e},backend:i}),st=ld({inputs:{a:Ce,b:nt},backend:i}),St=ab({inputs:{a:Ce,b:nt},backend:i}),vt=Wc({inputs:{input:st},backend:i}),Tt=Wc({inputs:{input:St},backend:i}),Mt=ud({inputs:{input:st},backend:i}),Dt=ud({inputs:{input:St},backend:i}),Ut=cd({inputs:[vt,Tt],backend:i,attrs:{axis:0}}),ln=cd({inputs:[Mt,Dt],backend:i,attrs:{axis:0}}),nr=i.data.get(Ut.dataId).values,Xn=i.data.get(ln.dataId).values;return i.disposeIntermediateTensorInfo(I),i.disposeIntermediateTensorInfo(C),i.disposeIntermediateTensorInfo(k),i.disposeIntermediateTensorInfo(F),i.disposeIntermediateTensorInfo(W),i.disposeIntermediateTensorInfo(z),i.disposeIntermediateTensorInfo(ie),i.disposeIntermediateTensorInfo(oe),i.disposeIntermediateTensorInfo(Ce),i.disposeIntermediateTensorInfo(Oe),i.disposeIntermediateTensorInfo(Ve),i.disposeIntermediateTensorInfo(_e),i.disposeIntermediateTensorInfo($e),i.disposeIntermediateTensorInfo(Qe),i.disposeIntermediateTensorInfo(qe),i.disposeIntermediateTensorInfo(nt),i.disposeIntermediateTensorInfo(st),i.disposeIntermediateTensorInfo(St),i.disposeIntermediateTensorInfo(vt),i.disposeIntermediateTensorInfo(Mt),i.disposeIntermediateTensorInfo(Tt),i.disposeIntermediateTensorInfo(Dt),i.disposeIntermediateTensorInfo(Ut),i.disposeIntermediateTensorInfo(ln),{real:nr,imag:Xn}}function F7(n,e,t){const s=new Float32Array(e*2);for(let i=0;i<e;i++){let o=0,c=0;for(let h=0;h<e;h++){const f=PS(i*h,e,t),g=oy(n,h);o+=g.real*f.real-g.imag*f.imag,c+=g.real*f.imag+g.imag*f.real}t&&(o/=e,c/=e),DS(s,o,c,i)}return s}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function G7(n){const{inputs:e,backend:t}=n,{input:s}=e,i=H(s.shape),o=s.shape[s.shape.length-1],c=i/o,h=Pn({inputs:{x:s},backend:t,attrs:{shape:[c,o]}}),f=JE(h,!1,t),g=Pn({inputs:{x:f},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(f),g}const _7={kernelName:rc,backendName:"cpu",kernelFunc:G7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hb(n){const{backend:e,attrs:t}=n,{shape:s,value:i,dtype:o}=t,c=o||ut(i),h=we(c,H(s));return B7(h,i),e.makeTensorInfo(s,c,h)}const V7={kernelName:sr,backendName:"cpu",kernelFunc:hb};function B7(n,e,t){n.fill(e)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const W7={kernelName:ji,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,i=t,o=ue(s.dtype,H(s.shape)),[c,h,f,g]=s.shape,y=i.data.get(s.dataId).values;for(let I=0;I<c;I++){const C=I*f*h*g;for(let k=0;k<h;k++){const N=k*(f*g);for(let R=0;R<f;R++){const P=R*g;for(let L=0;L<g;L++){const F=Math.round(f-R-1),W=C+N+P+L;let z=y[W];if(F>=0&&F<f){const X=F*g,Q=C+N+X+L;z=y[Q]}o[W]=z}}}}return{dataId:i.write(o,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function z7(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,filter:o,bias:c,preluActivationWeights:h}=e,{strides:f,pad:g,dataFormat:y,dilations:I,dimRoundingMode:C,activation:k,leakyreluAlpha:N}=s;let R=YE({inputs:{x:i,filter:o},backend:t,attrs:{strides:f,pad:g,dataFormat:y,dilations:I,dimRoundingMode:C}});if(c){const P=R;if(y==="NCHW"&&c.shape.length===1&&c.shape[0]!==1){const L=Pn({inputs:{x:c},backend:t,attrs:{shape:[c.shape[0],1,1]}});R=ld({inputs:{a:R,b:L},backend:t}),t.disposeIntermediateTensorInfo(L)}else R=ld({inputs:{a:R,b:c},backend:t});t.disposeIntermediateTensorInfo(P)}if(k){const P=R;if(y==="NCHW"&&k==="prelu"&&h.shape.length===1&&h.shape[0]!==1){const L=Pn({inputs:{x:h},backend:t,attrs:{shape:[h.shape[0],1,1]}});R=v1(t,R,k,L,N),t.disposeIntermediateTensorInfo(L)}else R=v1(t,R,k,h,N);t.disposeIntermediateTensorInfo(P)}return R}const X7={kernelName:G,backendName:"cpu",kernelFunc:z7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Z7(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,filter:o,bias:c,preluActivationWeights:h}=e,{strides:f,pad:g,dataFormat:y,dilations:I,dimRoundingMode:C,activation:k,leakyreluAlpha:N}=s;let R=QE({inputs:{x:i,filter:o},backend:t,attrs:{strides:f,pad:g,dataFormat:y,dilations:I,dimRoundingMode:C}});if(c){const P=R;R=ld({inputs:{a:R,b:c},backend:t}),t.disposeIntermediateTensorInfo(P)}if(k){const P=R;R=v1(t,R,k,h,N),t.disposeIntermediateTensorInfo(P)}return R}const K7={kernelName:B,backendName:"cpu",kernelFunc:Z7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function $7(n){const{inputs:e,backend:t}=n,{params:s,indices:i}=e,o=H(s.shape),c=i.shape,h=c[c.length-1],[f,g,y,I]=Xx(s,i);if(g===0)return t.makeTensorInfo(f,s.dtype,[]);const C=t.data.get(i.dataId).values,k=t.bufferSync(s),N=sE(C,k,s.dtype,g,h,y,I,s.shape,o);return t.makeTensorInfo(f,s.dtype,N.values)}const U7={kernelName:zo,backendName:"cpu",kernelFunc:$7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function H7(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,indices:o}=e,{axis:c,batchDims:h}=s;ft([i,o],"gatherV2");const f=be(c,i.shape)[0],g=t.data.get(o.dataId).values,y=i.shape[f];for(let z=0;z<g.length;++z){const X=g[z];D(X<=y-1&&X>=0,()=>`GatherV2: the index value ${X} is not in [0, ${y-1}]`)}let I=h;h==null&&(I=0);const C=H(o.shape),k=gy(i,o,f,I),N=Pn({inputs:{x:i},backend:t,attrs:{shape:[k.batchSize,k.outerSize,k.dimSize,k.sliceSize]}}),R=Pn({inputs:{x:o},backend:t,attrs:{shape:[k.batchSize,C/k.batchSize]}}),P=[k.batchSize,k.outerSize,C/k.batchSize,k.sliceSize],L=t.bufferSync(R),F=t.bufferSync(N),W=iE(F,L,P);return t.disposeIntermediateTensorInfo(N),t.disposeIntermediateTensorInfo(R),t.makeTensorInfo(k.outputShape,W.dtype,W.values)}const j7={kernelName:Nh,backendName:"cpu",kernelFunc:H7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Y7(n){const{inputs:e,backend:t}=n,{input:s}=e,i=H(s.shape),o=s.shape[s.shape.length-1],c=i/o,h=Pn({inputs:{x:s},backend:t,attrs:{shape:[c,o]}}),f=JE(h,!0,t),g=Pn({inputs:{x:f},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(f),g}const Q7={kernelName:q,backendName:"cpu",kernelFunc:Y7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const J7=xn(qn,n=>Number.isFinite(n)?1:0,"bool"),q7={kernelName:qn,backendName:"cpu",kernelFunc:J7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const eK=xn(Jr,n=>Math.abs(n)===1/0?1:0,"bool"),tK={kernelName:Jr,backendName:"cpu",kernelFunc:eK};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const nK=xn(ic,n=>Number.isNaN(n)?1:0,"bool"),rK={kernelName:ic,backendName:"cpu",kernelFunc:nK};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sK(n){const{backend:e,attrs:t}=n,{start:s,stop:i,num:o}=t,c=cE(s,i,o);return e.makeTensorInfo([c.length],"float32",c)}const iK={kernelName:Bn,backendName:"cpu",kernelFunc:sK};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const aK=xn(ac,n=>Math.log1p(n)),oK={kernelName:ac,backendName:"cpu",kernelFunc:aK};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const lK=br((n,e)=>n&&e),uK=Gr(Fl,lK,null,"bool"),cK={kernelName:Fl,backendName:"cpu",kernelFunc:uK};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const hK=xn(Xo,n=>n?0:1,"bool"),dK={kernelName:Xo,backendName:"cpu",kernelFunc:hK};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const fK=br((n,e)=>n||e),pK=Gr(Gl,fK,null,"bool"),mK={kernelName:Gl,backendName:"cpu",kernelFunc:pK};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function gK(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{depthRadius:o,bias:c,alpha:h,beta:f}=s;ft(i,"LRN");const g=i.shape[3],y=g-1,I=t.data.get(i.dataId).values,C=H(i.shape),k=new Float32Array(C);function N(R){const P=R%g;let L=R-P+Math.max(0,P-o);const F=R-P+Math.min(P+o,y);let W=0;for(;L<=F;L++){const z=I[L];W+=z*z}return W}for(let R=0;R<C;R++){const P=N(R),L=I[R]*Math.pow(c+h*P,-f);k[R]=L}return t.makeTensorInfo(i.shape,i.dtype,k)}const xK={kernelName:ir,backendName:"cpu",kernelFunc:gK};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yK(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,y:o,dy:c}=e,{depthRadius:h,bias:f,alpha:g,beta:y}=s;ft(c,"LRNGrad");const I=H(c.shape),C=c.shape[3],k=t.data.get(c.dataId).values,N=t.data.get(i.dataId).values,R=t.data.get(o.dataId).values,P=new Float32Array(I),L=I;for(let F=0;F<L;F++){const W=F%C,z=F-W+Math.max(0,W-h),X=F-W+Math.min(C,W+h+1);let Q=0;for(let J=z;J<X;J++)Q+=Math.pow(N[J],2);Q=g*Q+f;for(let J=z;J<X;J++){let te=-2*g*y*N[J]*R[F]/Q;F===J&&(te+=Math.pow(Q,-y)),te*=k[F],P[J]+=te}}return t.makeTensorInfo(c.shape,i.dtype,P)}const bK={kernelName:Zo,backendName:"cpu",kernelFunc:yK};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function qE(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{reductionIndices:o,keepDims:c}=s,h=t;let f=i.shape;const g=f.length,y=be(o,f);let I=y;const C=er(I,g);let k=h.data.get(i.dataId).values;if(C!=null){const z=new Array(g);for(let X=0;X<z.length;X++)z[X]=f[C[X]];k=sb(k,f,i.dtype,C,z),I=gr(I.length,g),f=z}ft(i,"max"),rs("max",I,g);const[N,R]=Xr(f,I),P=H(R),L=dE(k,P,N,i.dtype),F=h.write(L,N,i.dtype);let W=N;return c&&(W=kr(N,y)),{dataId:F,shape:W,dtype:i.dtype}}const wK={kernelName:yi,backendName:"cpu",kernelFunc:qE};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vK(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e;ft(i,"maxPool");const{filterSize:o,strides:c,pad:h,dimRoundingMode:f}=s,g=1;D(ds(c,g),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${c} and dilations '${g}'`);const y=qi(i.shape,o,c,g,h,f);let I;if(y.filterWidth===1&&y.filterHeight===1&&se(y.inShape,y.outShape))I=xo({inputs:{x:i},backend:t});else{const C=t.data.get(i.dataId).values,k=We(i.shape),N=ob(C,i.shape,i.dtype,k,y,"max");I=t.makeTensorInfo(y.outShape,i.dtype,N.values)}return I}const IK={kernelName:Ah,backendName:"cpu",kernelFunc:vK};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function CK(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{filterSize:o,strides:c,pad:h,dimRoundingMode:f,dataFormat:g}=s;ft(i,"maxPool3d");const y=el(i.shape,o,c,1,h,f,g),I=t.data.get(i.dataId).values,C=jE(I,i.shape,i.dtype,We(i.shape),y,"max");return t.makeTensorInfo(C.shape,"float32",C.values)}const SK={kernelName:pr,backendName:"cpu",kernelFunc:CK};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function TK(n){const{inputs:e,backend:t,attrs:s}=n,{dy:i,input:o}=e,{filterSize:c,strides:h,pad:f,dimRoundingMode:g}=s;ft([i,o],"maxPool3DGrad");const y=el(o.shape,c,h,1,f,g),I=t.bufferSync(o),C=pZ(I,y),k=y.strideDepth,N=y.strideHeight,R=y.strideWidth,P=y.dilationDepth,L=y.dilationHeight,F=y.dilationWidth,W=y.effectiveFilterDepth,z=y.effectiveFilterHeight,X=y.effectiveFilterWidth,Q=W-1-y.padInfo.front,J=X-1-y.padInfo.left,te=z-1-y.padInfo.top,ie=Xt(o.shape,"float32"),oe=t.bufferSync(i);for(let Ce=0;Ce<y.batchSize;++Ce)for(let Se=0;Se<y.inChannels;++Se)for(let Te=0;Te<y.inDepth;++Te)for(let Le=0;Le<y.inHeight;++Le)for(let Me=0;Me<y.inWidth;++Me){const Oe=Te-Q,Ve=Le-te,_e=Me-J;let Be=0;for(let He=0;He<W;He+=P){const $e=(Oe+He)/k;if(!($e<0||$e>=y.outDepth||Math.floor($e)!==$e))for(let Qe=0;Qe<z;Qe+=L){const qe=(Ve+Qe)/N;if(!(qe<0||qe>=y.outHeight||Math.floor(qe)!==qe))for(let nt=0;nt<X;nt+=F){const st=(_e+nt)/R;if(st<0||st>=y.outWidth||Math.floor(st)!==st)continue;const St=W*z*X-1-C.get(Ce,$e,qe,st,Se),vt=He*z*X+Qe*X+nt,Tt=St===vt?1:0;if(Tt===0)continue;const Mt=oe.get(Ce,$e,qe,st,Se);Be+=Mt*Tt}}}ie.set(Be,Ce,Te,Le,Me,Se)}return t.makeTensorInfo(ie.shape,ie.dtype,ie.values)}const kK={kernelName:df,backendName:"cpu",kernelFunc:TK};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function EK(n){const{inputs:e,backend:t,attrs:s}=n,{dy:i,input:o,output:c}=e,h=o;ft([o,c],"maxPoolGrad");const{filterSize:f,strides:g,pad:y,dimRoundingMode:I}=s,C=qi(h.shape,f,g,1,y,I),k=t.data.get(h.dataId).values,N=Xt(C.outShape,h.dtype,HE(k,h.shape,h.dtype,C).values),R=C.strideHeight,P=C.strideWidth,L=C.dilationHeight,F=C.dilationWidth,W=C.effectiveFilterHeight,z=C.effectiveFilterWidth,X=z-1-C.padInfo.left,Q=W-1-C.padInfo.top,J=Xt(h.shape,"float32"),te=t.data.get(i.dataId).values,ie=Xt(i.shape,"float32",te);for(let oe=0;oe<C.batchSize;++oe)for(let Ce=0;Ce<C.inChannels;++Ce)for(let Se=0;Se<C.inHeight;++Se)for(let Te=0;Te<C.inWidth;++Te){const Le=Se-Q,Me=Te-X;let Oe=0;for(let Ve=0;Ve<W;Ve+=L){const _e=(Le+Ve)/R;if(!(_e<0||_e>=C.outHeight||Math.floor(_e)!==_e))for(let Be=0;Be<z;Be+=F){const He=(Me+Be)/P;if(He<0||He>=C.outWidth||Math.floor(He)!==He)continue;const $e=W*z-1-N.get(oe,_e,He,Ce),Qe=Ve*z+Be,qe=$e===Qe?1:0;if(qe===0)continue;const nt=ie.get(oe,_e,He,Ce);Oe+=nt*qe}}J.set(Oe,oe,Se,Te,Ce)}return t.makeTensorInfo(J.shape,J.dtype,J.values)}const NK={kernelName:Ot,backendName:"cpu",kernelFunc:EK};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function AK(n,e,t,s,i){const o=We(e),c=ob(n,e,t,o,i,"max"),h=HE(n,e,t,i,!0,s);return[c.values,h.values]}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const RK={kernelName:Rh,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:i,strides:o,pad:c,includeBatchInIndex:h}=e,f=t;ft(s,"MaxPoolWithArgmax");const g=f.data.get(s.dataId).values,y=qi(s.shape,i,o,[1,1],c),[I,C]=AK(g,s.shape,s.dtype,h,y),k=f.write(I,y.outShape,s.dtype),N=f.write(C,y.outShape,s.dtype);return[{dataId:k,shape:y.outShape,dtype:s.dtype},{dataId:N,shape:y.outShape,dtype:"int32"}]}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function MK(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{axis:o,keepDims:c}=s,h=be(o,i.shape),f=Xr(i.shape,h)[1],g=H(f),y=[],I=t.makeTensorInfo([],"float32",new Float32Array([g]));y.push(I);const C=du({inputs:{x:i},backend:t,attrs:{dtype:"float32"}});y.push(C);const k=lb({inputs:{a:C,b:I},backend:t});y.push(k);const N=qf({inputs:{x:k},backend:t,attrs:{axis:o,keepDims:c}});return y.forEach(R=>t.disposeIntermediateTensorInfo(R)),N}const LK={kernelName:oc,backendName:"cpu",kernelFunc:MK};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function DK(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{axis:o,keepDims:c}=s;ft(i,"min");const h=be(o,i.shape);let f=h;const g=er(f,i.shape.length);let y=i;g!=null&&(y=$s({inputs:{x:i},backend:t,attrs:{perm:g}}),f=gr(f.length,i.shape.length)),rs("min",f,y.shape.length);const[I,C]=Xr(y.shape,f),k=H(C),N=$n(H(I),y.dtype),R=t.data.get(y.dataId).values;for(let L=0;L<N.length;++L){const F=L*k;let W=R[F];for(let z=0;z<k;++z){const X=R[F+z];(Number.isNaN(X)||X<W)&&(W=X)}N[L]=W}g!=null&&t.disposeIntermediateTensorInfo(y);const P=t.makeTensorInfo(I,y.dtype,N);if(c){const L=kr(I,h),F=Pn({inputs:{x:P},backend:t,attrs:{shape:L}});return t.disposeIntermediateTensorInfo(P),F}return P}const OK={kernelName:Yi,backendName:"cpu",kernelFunc:DK};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function PK(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{paddings:o,mode:c}=s;ft(i,"mirrorPad");const h=o.map((F,W)=>F[0]+i.shape[W]+F[1]),f=o.map(F=>F[0]),g=o.map((F,W)=>F[0]+i.shape[W]),y=c==="reflect"?0:1,I=t.data.get(i.dataId).values,C=i.shape.length,k=We(i.shape),N=H(h),R=h.length,P=We(h),L=ue(i.dtype,N);for(let F=0;F<N;F++){let W=Bi(F,R,P);for(let X=0;X<R;X++)W[X]<f[X]?W[X]=f[X]*2-W[X]-y:W[X]>=g[X]&&(W[X]=(g[X]-1)*2-W[X]+y);W=W.map((X,Q)=>X-f[Q]);const z=bn(W,C,k);L[F]=I[z]}return{dataId:t.write(L,h,i.dtype),shape:h,dtype:i.dtype}}const FK={kernelName:eo,backendName:"cpu",kernelFunc:PK};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const GK=br((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e}),_K=Gr(wa,GK),VK={kernelName:wa,backendName:"cpu",kernelFunc:_K};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function eN(n){const{inputs:e,backend:t,attrs:s}=n,{logits:i}=e,{dim:o}=s,c=i.shape.length;let h=o;if(h===-1&&(h=c-1),h!==c-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${c} and dim was ${h}`);const f=be([h],i.shape),g=qE({inputs:{x:i},backend:t,attrs:{reductionIndices:f,keepDims:!1}}),y=kr(g.shape,f),I=Pn({inputs:{x:g},backend:t,attrs:{shape:y}}),C=ab({inputs:{a:i,b:I},backend:t}),k=eE({inputs:{x:C},backend:t}),N=qf({inputs:{x:k},backend:t,attrs:{axis:f,keepDims:!1}}),R=Pn({inputs:{x:N},backend:t,attrs:{shape:y}}),P=lb({inputs:{a:k,b:R},backend:t});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(I),t.disposeIntermediateTensorInfo(C),t.disposeIntermediateTensorInfo(k),t.disposeIntermediateTensorInfo(N),t.disposeIntermediateTensorInfo(R),P}const BK={kernelName:Zl,backendName:"cpu",kernelFunc:eN};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function WK(n){const{inputs:e,backend:t,attrs:s}=n,{logits:i}=e,{numSamples:o,seed:c,normalized:h}=s;ft(i,"multinomial");const f=h?i:eN({inputs:{logits:i},backend:t,attrs:{dim:-1}}),g=f.shape[0],y=f.shape[1],I=t.data.get(f.dataId).values,C=[g,o],k=$n(H(C),"int32");for(let N=0;N<g;++N){const R=N*y,P=new Float32Array(y-1);P[0]=I[R];for(let W=1;W<P.length;++W)P[W]=P[W-1]+I[R+W];const L=Ex.alea(c.toString()),F=N*o;for(let W=0;W<o;++W){const z=L();k[F+W]=P.length;for(let X=0;X<P.length;X++)if(z<P[X]){k[F+W]=X;break}}}return h||t.disposeIntermediateTensorInfo(f),t.makeTensorInfo(C,"int32",k)}const zK={kernelName:_l,backendName:"cpu",kernelFunc:WK};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const XK=_x;function ZK(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:i,scores:o}=e,{maxOutputSize:c,iouThreshold:h,scoreThreshold:f}=s;ft(i,"NonMaxSuppression");const g=t.data.get(i.dataId).values,y=t.data.get(o.dataId).values,{selectedIndices:I}=XK(g,y,c,h,f);return t.makeTensorInfo([I.length],"int32",new Int32Array(I))}const KK={kernelName:qr,backendName:"cpu",kernelFunc:ZK};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const $K=Vx;function UK(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:i,scores:o}=e,{maxOutputSize:c,iouThreshold:h,scoreThreshold:f,padToMaxOutputSize:g}=s;ft(i,"NonMaxSuppressionPadded");const y=t.data.get(i.dataId).values,I=t.data.get(o.dataId).values,{selectedIndices:C,validOutputs:k}=$K(y,I,c,h,f,g);return[t.makeTensorInfo([C.length],"int32",new Int32Array(C)),t.makeTensorInfo([],"int32",new Int32Array([k]))]}const HK={kernelName:Mh,backendName:"cpu",kernelFunc:UK};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const jK=Bx;function YK(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:i,scores:o}=e,{maxOutputSize:c,iouThreshold:h,scoreThreshold:f,softNmsSigma:g}=s;ft(i,"NonMaxSuppressionWithScore");const y=t.data.get(i.dataId).values,I=t.data.get(o.dataId).values,C=c,k=h,N=f,R=g,{selectedIndices:P,selectedScores:L}=jK(y,I,C,k,N,R);return[t.makeTensorInfo([P.length],"int32",new Int32Array(P)),t.makeTensorInfo([L.length],"float32",new Float32Array(L))]}const QK={kernelName:Lh,backendName:"cpu",kernelFunc:YK};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function JK(n){const{inputs:e,backend:t,attrs:s}=n,{indices:i}=e,{dtype:o,depth:c,onValue:h,offValue:f}=s;ft(i,"oneHot");const g=H(i.shape),y=new Float32Array(g*c);y.fill(f);const I=t.data.get(i.dataId).values;for(let C=0;C<g;++C)I[C]>=0&&I[C]<c&&(y[C*c+I[C]]=h);return t.makeTensorInfo([...i.shape,c],o,y)}const qK={kernelName:Dh,backendName:"cpu",kernelFunc:JK};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function C1(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const i=Wc({inputs:{input:s},backend:t}),o=C1({inputs:{x:i},backend:t}),c=ud({inputs:{input:s},backend:t}),h=C1({inputs:{x:c},backend:t}),f=ui({inputs:{real:o,imag:h},backend:t});return t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(h),f}else return hb({backend:t,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const e$={kernelName:b,backendName:"cpu",kernelFunc:C1};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tN(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const i=Wc({inputs:{input:s},backend:t}),o=tN({inputs:{x:i},backend:t}),c=ud({inputs:{input:s},backend:t}),h=C1({inputs:{x:c},backend:t}),f=ui({inputs:{real:o,imag:h},backend:t});return t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(h),f}else return hb({backend:t,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const t$={kernelName:uc,backendName:"cpu",kernelFunc:tN};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function nN(n){const{inputs:e,backend:t,attrs:s}=n,{axis:i}=s;if(e.length===1)return I1({inputs:{input:e[0]},backend:t,attrs:{dim:i}});const o=e[0].shape,c=e[0].dtype;e.forEach(y=>{$(o,y.shape,"All tensors passed to stack must have matching shapes"),D(c===y.dtype,()=>"All tensors passed to stack must have matching dtypes")});const h=[],f=e.map(y=>{const I=I1({inputs:{input:y},backend:t,attrs:{dim:i}});return h.push(I),I}),g=cd({inputs:f,backend:t,attrs:{axis:i}});return h.forEach(y=>t.disposeIntermediateTensorInfo(y)),g}const n$={kernelName:Oh,backendName:"cpu",kernelFunc:nN};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function r$(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{paddings:o,constantValue:c}=s;ft(i,"pad");const h=o.map((L,F)=>L[0]+i.shape[F]+L[1]),f=o.map(L=>L[0]),g=t.data.get(i.dataId).values,y=H(i.shape),I=i.shape.length,C=We(i.shape),k=H(h),N=h.length,R=We(h),P=ue(i.dtype,k);c!==0&&P.fill(c);for(let L=0;L<y;L++){const F=Bi(L,I,C).map((z,X)=>z+f[X]),W=bn(F,N,R);P[W]=g[L]}return{dataId:t.write(P,h,i.dtype),shape:h,dtype:i.dtype}}const rN={kernelName:Ph,backendName:"cpu",kernelFunc:r$};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const s$=br((n,e)=>Math.pow(n,e)),i$=Gr(rn,s$),a$={kernelName:rn,backendName:"cpu",kernelFunc:i$};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function o$(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:i,paramsDenseValues:o,indices:c}=e,h=i.map(P=>t.data.get(P.dataId).values),f=i.map(P=>P.shape),g=t.data.get(o.dataId).values,y=t.data.get(c.dataId).values,[I,C,k]=bE(h,f,g,o.shape,o.dtype,y,c.shape),N=I.map(P=>t.makeTensorInfo([P.length],"int32",P)),R=t.makeTensorInfo(k,o.dtype,C);return N.concat([R])}const l$={kernelName:va,backendName:"cpu",kernelFunc:o$};/**
* @license
* Copyright 2022 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function u$(n){const{inputs:e,backend:t}=n,{starts:s,limits:i,deltas:o}=e,c=t.data.get(s.dataId).values,h=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,[g,y]=vE(c,s.shape,s.dtype,h,i.shape,f,o.shape),I=t.makeTensorInfo([g.length],"int32",g),C=t.makeTensorInfo([y.length],s.dtype,y);return[I,C]}const c$={kernelName:C0,backendName:"cpu",kernelFunc:u$};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function h$(n){const{inputs:e,backend:t,attrs:s}=n,{shape:i,values:o,defaultValue:c,rowPartitionTensors:h}=e,{rowPartitionTypes:f}=s,g=t.data.get(i.dataId).values,y=t.data.get(o.dataId).values,I=t.data.get(c.dataId).values,C=h.map(P=>t.data.get(P.dataId).values),k=h.map(P=>P.shape),[N,R]=SE(g,i.shape,y,o.shape,o.dtype,I,c.shape,C,k,f);return t.makeTensorInfo(N,o.dtype,R)}const d$={kernelName:Ae,backendName:"cpu",kernelFunc:h$};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function f$(n){const{backend:e,attrs:t}=n,{start:s,stop:i,dtype:o,step:c}=t,h=TE(s,i,c,o);return e.makeTensorInfo([h.length],o,h)}const p$={kernelName:Gt,backendName:"cpu",kernelFunc:f$};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const m$=xn(ro,n=>1/n),g$={kernelName:ro,backendName:"cpu",kernelFunc:m$};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function x$(n){const{inputs:e,backend:t,attrs:s}=n,{images:i}=e,{alignCorners:o,halfPixelCenters:c,size:h}=s;ft(i,"resizeBilinear");const f=We(i.shape),[g,y]=h,[I,C,k,N]=i.shape,R=t.data.get(i.dataId).values,P=new Float32Array(H([I,g,y,N])),L=[o&&g>1?C-1:C,o&&y>1?k-1:k],F=[o&&g>1?g-1:g,o&&y>1?y-1:y];let W=0;const z=L[0]/F[0],X=L[1]/F[1];for(let Q=0;Q<I;Q++)for(let J=0;J<g;J++){let te;c?te=z*(J+.5)-.5:te=z*J;const ie=Math.max(0,Math.floor(te)),oe=te-ie,Ce=Math.min(C-1,Math.ceil(te)),Se=Q*f[0]+ie*f[1],Te=Q*f[0]+Ce*f[1];for(let Le=0;Le<y;Le++){let Me;c?Me=X*(Le+.5)-.5:Me=X*Le;const Oe=Math.max(0,Math.floor(Me)),Ve=Me-Oe,_e=Math.min(k-1,Math.ceil(Me)),Be=Se+Oe*f[2],He=Te+Oe*f[2],$e=Se+_e*f[2],Qe=Te+_e*f[2];for(let qe=0;qe<N;qe++){const nt=R[Be+qe],st=R[He+qe],St=R[$e+qe],vt=R[Qe+qe],Tt=nt+(St-nt)*Ve,Mt=st+(vt-st)*Ve,Dt=Tt+(Mt-Tt)*oe;P[W++]=Dt}}}return t.makeTensorInfo([I,g,y,N],"float32",P)}const y$={kernelName:Wl,backendName:"cpu",kernelFunc:x$};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function b$(n){const{inputs:e,backend:t,attrs:s}=n,{images:i,dy:o}=e,{alignCorners:c}=s;ft([o,i],"resizeBilinearGrad");const h=We(i.shape),[f,g,y,I]=i.shape,[,C,k]=o.shape,N=new Float32Array(f*g*y*I),R=[c&&C>1?g-1:g,c&&k>1?y-1:y],P=[c&&C>1?C-1:C,c&&k>1?k-1:k],L=R[0]/P[0],F=R[1]/P[1],W=t.data.get(o.dataId).values;let z=0;for(let X=0;X<f;X++){const Q=X*h[0];for(let J=0;J<C;J++){const te=J*L,ie=Math.floor(te),oe=Math.min(Math.ceil(te),g-1),Ce=Q+ie*h[1],Se=Q+oe*h[1],Te=te-ie,Le=1-Te;for(let Me=0;Me<k;Me++){const Oe=Me*F,Ve=Math.floor(Oe),_e=Math.min(Math.ceil(Oe),y-1),Be=Oe-Ve,He=1-Be,$e=Ce+Ve*h[2],Qe=Ce+_e*h[2],qe=Se+Ve*h[2],nt=Se+_e*h[2],st=Le*He,St=Le*Be,vt=Te*He,Tt=Te*Be;for(let Mt=0;Mt<I;Mt++){const Dt=W[z++];N[$e+Mt]+=Dt*st,N[Qe+Mt]+=Dt*St,N[qe+Mt]+=Dt*vt,N[nt+Mt]+=Dt*Tt}}}}return t.makeTensorInfo([f,y,g,I],"float32",N)}const w$={kernelName:ar,backendName:"cpu",kernelFunc:b$};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function v$(n){const{inputs:e,backend:t,attrs:s}=n,{images:i}=e,{alignCorners:o,halfPixelCenters:c,size:h}=s;ft(i,"resizeNearestNeighbor");const f=We(i.shape),[g,y]=h,[I,C,k,N]=i.shape,R=t.data.get(i.dataId).values,P=new Float32Array(I*g*y*N),L=[o&&g>1?C-1:C,o&&y>1?k-1:k],F=[o&&g>1?g-1:g,o&&y>1?y-1:y],W=L[0]/F[0],z=L[1]/F[1];let X=0;for(let Q=0;Q<I;Q++){const J=Q*f[0];for(let te=0;te<g;te++){const ie=c?W*(te+.5):W*te;let oe=Math.min(C-1,o?Math.round(ie):Math.floor(ie));c&&(oe=Math.max(0,oe));const Ce=J+oe*f[1];for(let Se=0;Se<y;Se++){const Te=c?z*(Se+.5):z*Se;let Le=Math.min(k-1,o?Math.round(Te):Math.floor(Te));c&&(Le=Math.max(0,Le));const Me=Ce+Le*f[2];for(let Oe=0;Oe<N;Oe++){const Ve=R[Me+Oe];P[X++]=Ve}}}}return t.makeTensorInfo([I,g,y,N],i.dtype,P)}const I$={kernelName:Gh,backendName:"cpu",kernelFunc:v$};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function C$(n){const{inputs:e,backend:t,attrs:s}=n,{images:i,dy:o}=e,{alignCorners:c}=s;ft([o,i],"resizeNearestNeighborGrad");const h=We(i.shape),f=We(o.shape),[g,y,I,C]=i.shape,[,k,N]=o.shape,R=new Float32Array(g*y*I*C),P=t.data.get(o.dataId).values,L=[c&&k>1?y-1:y,c&&N>1?I-1:I],F=[c&&k>1?k-1:k,c&&N>1?N-1:N],W=L[0]/F[0],z=L[1]/F[1],X=1/W,Q=1/z,J=Math.ceil(X)*2+2,te=Math.ceil(Q)*2+2;for(let ie=0;ie<g;ie++){const oe=ie*h[0];for(let Ce=0;Ce<y;Ce++){const Se=oe+Ce*h[1],Te=Math.floor(Ce*X),Le=Math.floor(Te-J/2);for(let Me=0;Me<I;Me++){const Oe=Se+Me*h[2],Ve=Math.floor(Me*Q),_e=Math.floor(Ve-te/2);for(let Be=0;Be<C;Be++){let He=0;for(let $e=0;$e<J;$e++){const Qe=$e+Le;if(Qe<0||Qe>=k)continue;const qe=oe+Qe*f[1],nt=Qe*W,st=Math.min(y-1,c?Math.round(nt):Math.floor(nt));if(Ce===st)for(let St=0;St<te;St++){const vt=St+_e;if(vt<0||vt>=N)continue;const Tt=qe+vt*f[2],Mt=vt*z,Dt=Math.min(I-1,c?Math.round(Mt):Math.floor(Mt));Me===Dt&&(He+=P[Tt+Be])}}R[Oe+Be]=He}}}}return t.makeTensorInfo(i.shape,i.dtype,R)}const S$={kernelName:ff,backendName:"cpu",kernelFunc:C$};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function T$(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{dims:o}=s;ft(i,"reverse");const c=i.shape.length,h=be(o,i.shape);if(c===0)return xo({inputs:{x:i},backend:t});const f=new ts(i.shape,i.dtype),g=t.bufferSync(i);for(let y=0;y<f.size;y++){const I=f.indexToLoc(y),C=I.slice();h.forEach(k=>C[k]=i.shape[k]-1-C[k]),f.set(g.get(...C),...I)}return t.makeTensorInfo(f.shape,f.dtype,f.values)}const k$={kernelName:Mn,backendName:"cpu",kernelFunc:T$};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const E$={kernelName:E,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:i,fillValue:o,center:c}=e,h=t,f=ue(s.dtype,H(s.shape)),[g,y,I,C]=s.shape,[k,N]=Jx(c,y,I),R=255,P=Math.sin(i),L=Math.cos(i),F=h.data.get(s.dataId).values;for(let W=0;W<g;W++){const z=W*I*y*C;for(let X=0;X<y;X++){const Q=X*(I*C);for(let J=0;J<I;J++){const te=J*C;for(let ie=0;ie<C;ie++){const oe=[g,X,J,ie],Ce=oe[2],Se=oe[1];let Te=(Ce-k)*L-(Se-N)*P,Le=(Ce-k)*P+(Se-N)*L;Te=Math.round(Te+k),Le=Math.round(Le+N);let Me=o;if(typeof o!="number"&&(ie===3?Me=R:Me=o[ie]),Te>=0&&Te<I&&Le>=0&&Le<y){const Ve=Le*(I*C),_e=Te*C,Be=z+Ve+_e+ie;Me=F[Be]}const Oe=z+Q+te+ie;f[Oe]=Me}}}}return{dataId:h.write(f,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const N$=xn(so,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),A$={kernelName:so,backendName:"cpu",kernelFunc:N$};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function R$(n){const{inputs:e,backend:t,attrs:s}=n,{indices:i,updates:o}=e,{shape:c}=s,{sliceRank:h,numUpdates:f,sliceSize:g,strides:y,outputSize:I}=Mc(o,i,c),C=!0,k=t.bufferSync(i),N=t.bufferSync(o),R=zc(k,N,c,I,g,f,h,y,0,C);return t.makeTensorInfo(c,R.dtype,R.values)}const M$={kernelName:pn,backendName:"cpu",kernelFunc:R$};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function L$(n,e){let t=0,s=n.length,i=0;for(;t<s;)i=Math.floor((t+s)/2),n[i]<e?t=i+1:s=i;return s}function D$(n,e){let t=0,s=n.length,i=0;for(;t<s;)i=Math.floor((t+s)/2),n[i]<=e?t=i+1:s=i;return s}function O$(n,e,t,s,i,o){const c=we("int32",t*i);for(let h=0;h<t;++h){const f=n.slice(h*s,(h+1)*s),g=h*i;for(let y=0;y<i;++y)c[g+y]=o==="left"?L$(f,e[y+g]):D$(f,e[y+g])}return c}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function P$(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:i,values:o}=e,{side:c}=s,h=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,g=O$(h,f,i.shape[0],i.shape[1],o.shape[1],c);return t.makeTensorInfo(o.shape,"int32",g)}const F$={kernelName:S0,backendName:"cpu",kernelFunc:P$};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function G$(n){const{inputs:e,backend:t}=n,{condition:s,t:i,e:o}=e;ft([s,i,o],"select");const c=s.shape.length,h=t.data.get(s.dataId).values,f=t.data.get(i.dataId).values,g=t.data.get(o.dataId).values,y=ai(i.dtype,o.dtype),I=$n(H(i.shape),y);let C=0;const k=c===0||c>1||i.shape.length===1?1:H(i.shape.slice(1));for(let N=0;N<h.length;N++)for(let R=0;R<k;R++)h[N]===1?I[C++]=f[N]:I[C++]=g[N];return t.makeTensorInfo(i.shape,y,I)}const _$={kernelName:mn,backendName:"cpu",kernelFunc:G$};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const V$=$0,B$=U0,W$=xn(wi,n=>n>=0?B$*n:V$*(Math.exp(n)-1)),z$={kernelName:wi,backendName:"cpu",kernelFunc:W$};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const X$=xn(Uo,n=>n<0?-1:n>0?1:0),Z$={kernelName:Uo,backendName:"cpu",kernelFunc:X$};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const K$=xn(hc,n=>Math.sin(n)),$$={kernelName:hc,backendName:"cpu",kernelFunc:K$};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const U$=xn(vs,n=>Math.sinh(n)),H$={kernelName:vs,backendName:"cpu",kernelFunc:U$};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const sN=Math.log(11920928955078125e-23)+2,j$=xn(Ho,n=>{const e=n>-sN,t=n<sN,s=Math.exp(n);let i;return t?i=s:e?i=n:i=Math.log(1+s),i}),Y$={kernelName:Ho,backendName:"cpu",kernelFunc:j$};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Q$(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{blockShape:o,paddings:c}=s;ft([i],"spaceToBatchND");const h=H(o),f=[[0,0]];f.push(...c);for(let P=1+o.length;P<i.shape.length;++P)f.push([0,0]);const g=rN.kernelFunc({inputs:{x:i},backend:t,attrs:{paddings:f,constantValue:0}}),y=Df(g.shape,o,h,!1),I=Of(y.length,o.length,!1),C=Pf(g.shape,o,h,!1),k=Pn({inputs:{x:g},backend:t,attrs:{shape:y}}),N=$s({inputs:{x:k},backend:t,attrs:{perm:I}}),R=Pn({inputs:{x:N},backend:t,attrs:{shape:C}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(k),t.disposeIntermediateTensorInfo(N),R}const J$={kernelName:_h,backendName:"cpu",kernelFunc:Q$};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function q$(n){const{inputs:e,backend:t}=n,{indices:s,values:i,denseShape:o,defaultValue:c}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(i.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${i.shape}`);if(c.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${c.shape}`);const h=t.data.get(s.dataId).values,f=t.data.get(i.dataId).values,g=t.data.get(o.dataId).values,y=t.data.get(c.dataId).values[0],[I,C,k,N,R]=AE(h,s.shape,s.dtype,f,i.dtype,g,y);return[t.makeTensorInfo(C,s.dtype,I),t.makeTensorInfo([C[0]],i.dtype,k),t.makeTensorInfo([N.length],"bool",new Uint8Array(N.map(P=>Number(P)))),t.makeTensorInfo([R.length],s.dtype,new Int32Array(R))]}const eU={kernelName:T0,backendName:"cpu",kernelFunc:q$};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tU(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:i,newShape:o}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(i.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${i.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const c=Array.from(t.data.get(i.dataId).values),h=t.data.get(s.dataId).values,f=Array.from(t.data.get(o.dataId).values),[g,y,I]=RE(h,s.shape,s.dtype,c,f);return[t.makeTensorInfo(y,s.dtype,g),t.makeTensorInfo([I.length],o.dtype,new Int32Array(I))]}const nU={kernelName:Kl,backendName:"cpu",kernelFunc:tU};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function rU(n){const{inputs:e,backend:t}=n,{data:s,indices:i,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${i.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${o.shape}`);if(i.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const c=t.data.get(s.dataId).values,h=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,[g,y]=ib(c,s.shape,s.dtype,h,f,!0);return t.makeTensorInfo(y,s.dtype,g)}const sU={kernelName:k0,backendName:"cpu",kernelFunc:rU};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function iU(n){const{inputs:e,backend:t}=n,{data:s,indices:i,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${i.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${o.shape}`);if(i.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const c=t.data.get(s.dataId).values,h=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,[g,y]=ib(c,s.shape,s.dtype,h,f);return t.makeTensorInfo(y,s.dtype,g)}const aU={kernelName:Sa,backendName:"cpu",kernelFunc:iU};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function oU(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:i,sparseValues:o,defaultValue:c}=e,{outputShape:h}=s,{sliceRank:f,numUpdates:g,sliceSize:y,strides:I,outputSize:C}=Mc(o,i,h),k=!1,N=t.bufferSync(i);let R;switch(o.dtype){case"bool":{const P=t.bufferSync(o),L=!!t.data.get(c.dataId).values[0];R=zc(N,P,h,C,y,g,f,I,L,k);break}case"float32":{const P=t.bufferSync(o),L=t.data.get(c.dataId).values[0];R=zc(N,P,h,C,y,g,f,I,L,k);break}case"int32":{const P=t.bufferSync(o),L=t.data.get(c.dataId).values[0];R=zc(N,P,h,C,y,g,f,I,L,k);break}case"string":{const P=t.bufferSync(o),L=Yl(t.data.get(c.dataId).values[0]);R=zc(N,P,h,C,y,g,f,I,L,k);break}default:throw new Error(`Unsupported type ${o.dtype}`)}return t.makeTensorInfo(h,R.dtype,R.values)}const lU={kernelName:fc,backendName:"cpu",kernelFunc:oU};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function uU(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{numOrSizeSplits:o,axis:c}=s,h=be(c,i.shape)[0],f=py(i,o,h),g=new Array(i.shape.length).fill(0),y=i.shape.slice();return f.map(I=>{const C=[...y];C[h]=I;const k=Xc({inputs:{x:i},backend:t,attrs:{begin:g,size:C}});return g[h]+=I,k})}const cU={kernelName:Ca,backendName:"cpu",kernelFunc:uU};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const hU={kernelName:Vh,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,s=e;ft(t,"square");const i=s.data.get(t.dataId).values,o=new Float32Array(i.length);for(let c=0;c<i.length;++c){const h=i[c];o[c]=h*h}return{dataId:s.write(o,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const dU=xn(w,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),fU={kernelName:w,backendName:"cpu",kernelFunc:dU};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function pU(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{begin:o,end:c,strides:h,beginMask:f,endMask:g,ellipsisMask:y,newAxisMask:I,shrinkAxisMask:C}=s;ft(i,"stridedSlice");const{finalShapeSparse:k,finalShape:N,isIdentity:R,sliceDim0:P,isSimpleSlice:L,begin:F,end:W,strides:z}=jx(i.shape,o,c,h,f,g,y,I,C);let X;if(R)X=Pn({inputs:{x:i},backend:t,attrs:{shape:N}});else if(P||L){D(i.shape.length>=1,()=>`Input must have rank at least 1, got: ${i.shape.length}`);const Q=$x(F,W,z),J=Xc({inputs:{x:i},backend:t,attrs:{begin:F,size:Q}});X=Pn({inputs:{x:J},backend:t,attrs:{shape:N}}),t.disposeIntermediateTensorInfo(J)}else{const Q=t.bufferSync(i),J=DE(k,Q,z,F);X=t.makeTensorInfo(N,J.dtype,J.values)}return X}const mU={kernelName:pf,backendName:"cpu",kernelFunc:pU};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function gU(n){const{inputs:e,backend:t,attrs:s}=n,{separator:i,nGramWidths:o,leftPad:c,rightPad:h,padWidth:f,preserveShortSequences:g}=s,{data:y,dataSplits:I}=e,C=t.data.get(y.dataId).values,k=t.data.get(I.dataId).values,[N,R]=OE(C,k,i,o,c,h,f,g);return[t.makeTensorInfo([N.length],"string",N),t.makeTensorInfo(I.shape,"int32",R)]}const xU={kernelName:Bh,backendName:"cpu",kernelFunc:gU};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yU(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:i}=s,{input:o,delimiter:c}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(c.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${c.shape}`);const h=t.data.get(o.dataId).values,f=t.data.get(c.dataId).values[0],[g,y,I]=PE(h,f,i),C=y.length;return[t.makeTensorInfo([C,2],"int32",g),t.makeTensorInfo([C],"string",y),t.makeTensorInfo([2],"int32",new Int32Array(I))]}const bU={kernelName:E0,backendName:"cpu",kernelFunc:yU};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function wU(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:i}=s,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const c=t.data.get(o.dataId).values,h=FE(c,i);return t.makeTensorInfo(o.shape,"int32",h)}const vU={kernelName:mf,backendName:"cpu",kernelFunc:wU};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const IU=xn(pc,n=>Math.tan(n)),CU={kernelName:pc,backendName:"cpu",kernelFunc:IU};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const SU=xn(jo,n=>Math.tanh(n)),TU={kernelName:jo,backendName:"cpu",kernelFunc:SU};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function kU(n){const{inputs:e,backend:t}=n,{tensor:s,indices:i,updates:o}=e,{sliceRank:c,numUpdates:h,sliceSize:f,strides:g,outputSize:y}=Mc(o,i,s.shape),I=!1,C=t.bufferSync(i),k=t.bufferSync(o),N=t.bufferSync(s),R=zc(C,k,s.shape,y,f,h,c,g,N,I);return t.makeTensorInfo(s.shape,R.dtype,R.values)}const EU={kernelName:kt,backendName:"cpu",kernelFunc:kU};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function NU(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{reps:o}=s;ft(i,"tile");const c=_E(t.bufferSync(i),o);return t.makeTensorInfo(c.shape,c.dtype,c.values)}const AU={kernelName:Ta,backendName:"cpu",kernelFunc:NU};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function RU(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{k:o,sorted:c}=s;ft(i,"topk");const h=t.data.get(i.dataId).values,[f,g]=BE(h,i.shape,i.dtype,o,c);return[t.makeTensorInfo(f.shape,f.dtype,f.values),t.makeTensorInfo(g.shape,g.dtype,g.values)]}const MU={kernelName:jt,backendName:"cpu",kernelFunc:RU};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function LU(n){const{inputs:e,attrs:t,backend:s}=n,{image:i,transforms:o}=e,{interpolation:c,fillMode:h,fillValue:f,outputShape:g}=t,[y,I,C,k]=i.shape,[N,R]=g??[I,C],P=[y,N,R,k],L=We(i.shape),F=L[0],W=L[1],z=L[2],X=We(P),Q=X[0],J=X[1],te=X[2],ie=ue(i.dtype,H(P));ie.fill(f);const oe=s.data.get(i.dataId).values,Ce=s.data.get(o.dataId).values;for(let Se=0;Se<y;++Se){const Te=o.shape[0]===1?Ce:Ce.subarray(Se*8,Se*8+8);for(let Le=0;Le<N;++Le)for(let Me=0;Me<R;++Me)for(let Oe=0;Oe<k;++Oe){let Ve;const _e=Te[6]*Me+Te[7]*Le+1;if(_e===0)continue;const Be=(Te[0]*Me+Te[1]*Le+Te[2])/_e,He=(Te[3]*Me+Te[4]*Le+Te[5])/_e,$e=iN(Be,C,h),Qe=iN(He,I,h);switch(c){case"nearest":Ve=_U(oe,I,C,F,W,z,Se,Qe,$e,Oe,f);break;case"bilinear":Ve=VU(oe,I,C,F,W,z,Se,Qe,$e,Oe,f);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${c}`)}const qe=Se*Q+Le*J+Me*te+Oe;ie[qe]=Ve}return s.makeTensorInfo(P,i.dtype,ie)}return{dataId:s.write(ie,P,i.dtype),shape:i.shape,dtype:i.dtype}}const DU={kernelName:$l,backendName:"cpu",kernelFunc:LU};function iN(n,e,t){switch(t){case"reflect":return OU(n,e);case"wrap":return PU(n,e);case"nearest":return GU(n,e);case"constant":default:return FU(n)}}function OU(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=2*e;t<s&&(t=s*Math.trunc(-t/s)+t),t=t<-e?t+s:-t-1}else if(t>e-1)if(e<=1)t=0;else{const s=2*e;t-=s*Math.trunc(t/s),t>=e&&(t=s-t-1)}return M(0,t,e-1)}function PU(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=e-1;t+=e*(Math.trunc(-t/s)+1)}else if(t>e-1)if(e<=1)t=0;else{const s=e-1;t-=e*Math.trunc(t/s)}return M(0,t,e-1)}function FU(n,e){return n}function GU(n,e){return M(0,n,e-1)}function ep(n,e,t,s,i,o,c,h,f,g,y){const I=c*s+h*i+f*o+g;return 0<=h&&h<e&&0<=f&&f<t?n[I]:y}function _U(n,e,t,s,i,o,c,h,f,g,y){const I=Math.round(h),C=Math.round(f);return ep(n,e,t,s,i,o,c,I,C,g,y)}function VU(n,e,t,s,i,o,c,h,f,g,y){const I=Math.floor(h),C=Math.floor(f),k=I+1,N=C+1,R=(N-f)*ep(n,e,t,s,i,o,c,I,C,g,y)+(f-C)*ep(n,e,t,s,i,o,c,I,N,g,y),P=(N-f)*ep(n,e,t,s,i,o,c,k,C,g,y)+(f-C)*ep(n,e,t,s,i,o,c,k,N,g,y);return(k-h)*R+(h-I)*P}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function BU(n){const{inputs:e,attrs:t,backend:s}=n,{axis:i}=t,{x:o}=e;ft(o,"unique");const c=s.data.get(o.dataId).values,{outputValues:h,outputShape:f,indices:g}=WE(c,i,o.shape,o.dtype);return[s.makeTensorInfo(f,o.dtype,h),s.makeTensorInfo([g.length],"int32",g)]}const WU={kernelName:u,backendName:"cpu",kernelFunc:BU};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function zU(n){const{inputs:e,backend:t,attrs:s}=n,{value:i}=e;let{axis:o}=s;o<0&&(o+=i.shape.length);const c=i.shape.length,h=i.shape[o],f=new Array(c-1);let g=0;for(let k=0;k<c;k++)k!==o&&(f[g++]=i.shape[k]);const y=new Array(c).fill(0),I=i.shape.slice();I[o]=1;const C=new Array(h);for(let k=0;k<C.length;k++){y[o]=k;const N=Xc({inputs:{x:i},backend:t,attrs:{begin:y,size:I}});C[k]=Pn({inputs:{x:N},backend:t,attrs:{shape:f}}),t.disposeIntermediateTensorInfo(N)}return C}const XU={kernelName:d,backendName:"cpu",kernelFunc:zU};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ZU(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,segmentIds:o}=e,{numSegments:c}=s;ft(i,"unsortedSegmentSum");const h=i.shape.length,f=o.shape.length,g=[],y=[],I=h-f;let C=o;for(let N=0;N<I;++N){const R=I1({inputs:{input:C},backend:t,attrs:{dim:N+1}});C=R,y.push(R)}for(let N=0;N<c;++N){const R=Hl(N,"int32"),P=t.makeTensorInfo([],"int32",R),L=J3({inputs:{a:P,b:C},backend:t}),F=du({inputs:{x:L},backend:t,attrs:{dtype:"float32"}}),W=b1({inputs:{a:F,b:i},backend:t}),z=qf({inputs:{x:W},backend:t,attrs:{axis:0,keepDims:!1}});g.push(z),y.push(P),y.push(L),y.push(F),y.push(W),y.push(z)}const k=nN({inputs:g,backend:t,attrs:{axis:0}});return y.forEach(N=>t.disposeIntermediateTensorInfo(N)),k}const KU={kernelName:m,backendName:"cpu",kernelFunc:ZU};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const $U=[zX,I6,ZX,$X,N6,HX,YX,JX,eZ,nZ,sZ,aZ,lZ,hZ,fZ,gZ,yZ,wZ,IZ,BX,SZ,kZ,NZ,R6,RZ,k6,L6,LZ,C6,DZ,PZ,FZ,_Z,BZ,zZ,ZZ,$Z,HZ,YZ,JZ,e7,n7,s7,a7,o7,u7,h7,f7,p7,m7,g7,y7,v7,DX,C7,D6,M7,O6,L7,F6,_7,V7,W7,_6,B6,X7,K7,U7,j7,z6,Z6,S6,Q7,OZ,q7,tK,rK,OX,$6,H6,iK,Y6,oK,cK,dK,mK,xK,bK,wK,J6,IK,SK,kK,NK,RK,LK,OK,eX,FK,VK,zK,nX,sX,KK,HK,QK,aX,qK,t$,n$,rN,a$,FX,uX,l$,c$,d$,p$,T6,ub,g$,GX,_X,VX,y$,w$,I$,S$,k$,E$,A$,xX,M$,F$,_$,z$,bX,Z$,$$,H$,wX,BK,Y$,J$,eU,nU,sU,aU,lU,cU,CX,hU,TX,EX,fU,mU,xU,bU,vU,MX,b7,CU,TU,EU,AU,MU,DU,oX,WU,XU,KU,e$];for(const n of $U)Xe(n);/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Zc={},S1={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function UU(n,e){Zc[n]=e}function Ga(n,e){if(!(n in Zc)||e!=null){const s=jU(n,e);if(s!==null)Zc[n]=s;else return console.log("Could not get context for WebGL version",n),null}const t=Zc[n];return t==null||t.isContextLost()?(delete Zc[n],Ga(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Zc[n])}function HU(n){if(!ke().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function jU(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??HU(n);return t.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete Zc[n]},!1),ke().getBool("SOFTWARE_WEBGL_ENABLED")&&(S1.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",S1)||t.getContext("experimental-webgl",S1):t.getContext("webgl2",S1)}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var tp;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(tp||(tp={}));var Ni;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(Ni||(Ni={}));var ss;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(ss||(ss={}));function np(n,e){return[e,n]}function YU(n,e){return n*e}function T1(n){const e=H(n),t=Math.ceil(e/4);return ee(t)}function hd(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function QU(n,e){const[t,s]=hd(n,e);return t*s*4}function db(n,e){const t=n;let s,i,o,c,h,f,g,y,I,C;return ke().getNumber("WEBGL_VERSION")===2?(s=t.R32F,i=t.R16F,o=t.RGBA16F,c=t.RGBA32F,h=t.RED,g=4,y=1,I=t.HALF_FLOAT,C=t.FLOAT,f=t.RGBA8):(s=n.RGBA,i=n.RGBA,o=n.RGBA,c=t.RGBA,h=n.RGBA,g=4,y=4,I=e!=null?e.HALF_FLOAT_OES:null,C=n.FLOAT,f=n.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:i,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:c,textureFormatFloat:h,downloadTextureFormat:f,downloadUnpackNumChannels:g,defaultNumChannels:y,textureTypeHalfFloat:I,textureTypeFloat:C}}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ot(n,e){const t=e();return ke().getBool("DEBUG")&&JU(n),t}function JU(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+nH(n,e))}const qU=596e-10,eH=65504;function tH(n){return!!(ke().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||qU<Math.abs(n)&&Math.abs(n)<eH)}function nH(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function k1(n,e){return ul(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function rH(n,e){const t=ul(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(ot(n,()=>n.shaderSource(t,e)),ot(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function sH(n,e){const t=ul(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(ot(n,()=>n.shaderSource(t,e)),ot(n,()=>n.compileShader(t)),ke().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw aN(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const iH=/ERROR: [0-9]+:([0-9]+):/g;function aN(n,e){const t=iH.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const s=+t[1],i=n.split(`
`),o=i.length.toString().length+2,c=i.map((I,C)=>Y((C+1).toString(),o)+I);let h=0;for(let I=0;I<c.length;I++)h=Math.max(c[I].length,h);const f=c.slice(0,s-1),g=c.slice(s-1,s),y=c.slice(s);console.log(f.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${Y(g[0],h)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(y.join(`
`))}function aH(n){return ul(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function oH(n,e){if(ot(n,()=>n.linkProgram(e)),!ke().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function fb(n,e){if(ot(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function lH(n,e){const t=ul(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return ot(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),ot(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function uH(n,e){const t=ul(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return ot(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),ot(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function cH(n){return ul(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function hH(n,e){const t=ke().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const s=`[${n}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(n>t||e>t){const s=`[${n}x${e}]`,i=`[${t}x${t}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+i+".")}}function dH(n){return ul(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function oN(n,e,t,s,i,o,c){const h=n.getAttribLocation(e,t);return h===-1?!1:(ot(n,()=>n.bindBuffer(n.ARRAY_BUFFER,s)),ot(n,()=>n.vertexAttribPointer(h,i,n.FLOAT,!1,o,c)),ot(n,()=>n.enableVertexAttribArray(h)),!0)}function fH(n,e,t){yH(n,t),ot(n,()=>n.activeTexture(n.TEXTURE0+t)),ot(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function pH(n,e,t){return ul(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function mH(n,e,t){return n.getUniformLocation(e,t)}function gH(n,e,t,s){ot(n,()=>fH(n,e,s)),ot(n,()=>n.uniform1i(t,s))}function pb(n,e,t){ot(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),ot(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function lN(n,e){ot(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),ot(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function E1(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+xH(n,e))}function xH(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function ul(n,e,t){const s=ot(n,()=>e());if(s==null)throw new Error(t);return s}function yH(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+n.TEXTURE0;if(s<n.TEXTURE0||s>t){const i=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${i}.`)}}function dd(n,e=2){return H(n.slice(0,n.length-e))}function fd(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function N1(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[dd(n),...fd(n)]),e}function bH(n,e=!1){let t=ke().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=ke().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&ke().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=t/2),e&&(t=t*2,s=s*2,n=n.map((h,f)=>f>=n.length-2?_(n[f]):n[f]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=Fe(n).newShape);let i=H(n),o=null;n.length<=1&&i<=t?o=[1,i]:n.length===2&&n[0]<=t&&n[1]<=t?o=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?o=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?o=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?o=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(o=[n[0],n[1]*n[2]*n[3]]);const c=o!=null&&Math.max(...o)>s&&Math.min(...o)<=(e?2:1)&&Math.min(...o)>0;if(o==null||c)if(e){const h=dd(n);let f=2,g=2;n.length&&([f,g]=fd(n)),i=h*(f/2)*(g/2),o=ee(i).map(y=>y*2)}else o=ee(i);return o}function A1(n){return n%2===0}function R1(n,e){if(n=n.slice(-2),e=e.slice(-2),se(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n[n.length-1],s=e[e.length-1];if(t===s||A1(t)&&A1(s)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&A1(n[0])&&A1(e[0])}let mb,gb;function wH(n){if(mb==null){const e=Ga(n);mb=e.getParameter(e.MAX_TEXTURE_SIZE)}return mb}function vH(n){if(gb==null){const e=Ga(n);gb=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,gb)}function IH(n){if(n===0)return 0;let e;const t=Ga(n);return oa(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:oa(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function oa(n,e){return n.getExtension(e)!=null}function uN(n){try{if(Ga(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function CH(n){if(n===0)return!1;const e=Ga(n);if(n===1){if(!oa(e,"OES_texture_float"))return!1}else if(!oa(e,"EXT_color_buffer_float"))return!1;return xb(e)}function SH(n){if(n===0)return!1;const e=Ga(n);if(n===1){if(!oa(e,"OES_texture_float")||!oa(e,"WEBGL_color_buffer_float"))return!1}else{if(oa(e,"EXT_color_buffer_float"))return xb(e);const t="EXT_color_buffer_half_float";if(oa(e,t)){const s=e.getExtension(t);return TH(e,s)}return!1}return xb(e)}function xb(n){const e=db(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const s=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,s),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(s),i}function TH(n,e){const t=db(n,e),s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0);const o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(s),n.deleteFramebuffer(i),o}function kH(n){return n!==2?!1:Ga(n).fenceSync!=null}function rp(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&D(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const pt=ke();pt.registerFlag("HAS_WEBGL",()=>pt.getNumber("WEBGL_VERSION")>0),pt.registerFlag("WEBGL_VERSION",()=>uN(2)?2:uN(1)?1:0),pt.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1),pt.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>pt.get("WEBGL_VERSION")===2),pt.registerFlag("WEBGL_CPU_FORWARD",()=>!0),pt.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1),pt.registerFlag("WEBGL_PACK",()=>pt.getBool("HAS_WEBGL")),pt.registerFlag("WEBGL_PACK_NORMALIZATION",()=>pt.getBool("WEBGL_PACK")),pt.registerFlag("WEBGL_PACK_CLIP",()=>pt.getBool("WEBGL_PACK")),pt.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>pt.getBool("WEBGL_PACK")),pt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>pt.getBool("WEBGL_PACK")),pt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>pt.getBool("WEBGL_PACK")),pt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>pt.getBool("WEBGL_PACK")),pt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>pt.getBool("WEBGL_PACK")),pt.registerFlag("WEBGL_PACK_REDUCE",()=>pt.getBool("WEBGL_PACK")),pt.registerFlag("WEBGL_LAZILY_UNPACK",()=>pt.getBool("WEBGL_PACK")),pt.registerFlag("WEBGL_CONV_IM2COL",()=>pt.getBool("WEBGL_PACK")),pt.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>pt.getBool("WEBGL_PACK")),pt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>wH(pt.getNumber("WEBGL_VERSION"))),pt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>vH(pt.getNumber("WEBGL_VERSION"))),pt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=pt.getNumber("WEBGL_VERSION");return n===0?0:IH(n)}),pt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>pt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!aC()),pt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>CH(pt.getNumber("WEBGL_VERSION"))),pt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>pt.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:pt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")),pt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>SH(pt.getNumber("WEBGL_VERSION"))),pt.registerFlag("WEBGL_FENCE_API_ENABLED",()=>kH(pt.getNumber("WEBGL_VERSION"))),pt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>pt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0),pt.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)}),pt.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>aC()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)}),pt.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128),pt.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1),pt.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5),pt.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128),pt.registerFlag("WEBGL_EXP_CONV",()=>!1),pt.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>pt.getBool("IS_TEST")),pt.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0),pt.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1),pt.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1),pt.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function As(){let n,e,t,s,i,o,c,h,f,g;return ke().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",s="in",i="texture",o="outputColor",c="out vec4 outputColor;",h=ke().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",f="",g=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",s="varying",i="texture2D",o="gl_FragColor",c="",h=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,f=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,g=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:s,texture2D:i,output:o,defineOutput:c,defineSpecialNaN:h,defineSpecialInf:f,defineRound:g}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Kc(n,e,t="index"){const s=We(e);return s.map((i,o)=>{const c=`int ${n[o]} = ${t} / ${i}`,h=o===s.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * ${i}`:`index -= ${n[o]} * ${i}`;return`${c}; ${h};`}).join("")}function M1(n,e,t="index"){const s=We(e);return s.map((i,o)=>{const c=`int ${n[o]} = ${t} / outShapeStrides[${o}]`,h=o===s.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * outShapeStrides[${o}]`:`index -= ${n[o]} * outShapeStrides[${o}]`;return`${c}; ${h};`}).join("")}function EH(n,e){const t=n.length,s=n.map(o=>`${e}[${o}]`),i=new Array(t-1);i[t-2]=s[t-1];for(let o=t-3;o>=0;--o)i[o]=`(${i[o+1]} * ${s[o+1]})`;return i}function NH(n,e,t="index"){const s=n.map((o,c)=>c),i=EH(s,e);return i.map((o,c)=>{const h=`int ${n[c]} = ${t} / ${i[c]}`,f=c===i.length-1?`int ${n[c+1]} = ${t} - ${n[c]} * ${i[c]}`:`index -= ${n[c]} * ${i[c]}`;return`${h}; ${f};`}).join("")}function yb(n){const e=We(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function bb(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const cN=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const{getBroadcastDims:hN}=CB;function AH(n,e,t){const s=[];if(n.forEach(C=>{const k=H(C.shapeInfo.logicalShape);if(C.shapeInfo.isUniform?s.push(`uniform float ${C.name}${k>1?`[${k}]`:""};`):(s.push(`uniform sampler2D ${C.name};`),s.push(`uniform int offset${C.name};`)),t.enableShapeUniforms){const{uniformShape:N}=wb(t.packedInputs,C.shapeInfo.logicalShape,C.shapeInfo.texShape);switch(N.length){case 1:s.push(`uniform int ${C.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${C.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${C.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${C.name}Shape;`);break}s.push(`uniform ivec2 ${C.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(C=>{s.push(`uniform ${C.type} ${C.name}${C.arrayIndex?`[${C.arrayIndex}]`:""};`)});const i=s.join(`
`),o=n.map(C=>RH(C,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),c=e.texShape,h=As(),f=DH(h);let g,y,I=FH(h);return e.isPacked?(g=MH(e.logicalShape,c,t.enableShapeUniforms),y=PH(h)):(g=LH(e.logicalShape,c,t.enableShapeUniforms),y=OH(h)),t.packedInputs&&(I+=BH),[I,f,y,i,g,o,t.userCode].join(`
`)}function pd(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return JH(n,e);case 1:return ej(n,e);case 2:return nj(n,e);case 3:return sj(n,e);case 4:return aj(n,e);case 5:return oj(n);case 6:return lj(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function dN(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return QH(n);case 1:return qH(n,e);case 2:return tj(n,e);case 3:return rj(n,e);default:return ij(n,e)}}function RH(n,e,t=!1,s){let i="";t?i+=dN(n,s):i+=pd(n,s);const o=n.shapeInfo.logicalShape,c=e.logicalShape;return o.length<=c.length&&(t?i+=uj(n,e):i+=cj(n,e)),i}function MH(n,e,t){switch(n.length){case 0:return fN();case 1:return WH(n,e,t);case 2:return jH(n,e,t);case 3:return XH(n,e,t);default:return KH(n,e,t)}}function LH(n,e,t){switch(n.length){case 0:return fN();case 1:return zH(n,e,t);case 2:return YH(n,e,t);case 3:return ZH(n,e,t);case 4:return $H(n,e,t);case 5:return UH(n,e);case 6:return HH(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function DH(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function OH(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function PH(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function FH(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${GH}
    ${_H}
    ${VH}
  `}const GH=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,_H=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,VH=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,BH=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function fN(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function WH(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function zH(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function XH(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],i=Math.ceil(n[2]/2),o=i*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec3(b, r, c);
    }
  `}function ZH(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${M1(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const s=Kc(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function KH(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],i=Math.ceil(n[n.length-1]/2),o=i*Math.ceil(n[n.length-2]/2);let c=o,h="",f="b, r, c";for(let g=2;g<n.length-1;g++)c*=n[n.length-g-1],h=`
      int b${g} = index / ${c};
      index -= b${g} * ${c};
    `+h,f=`b${g}, `+f;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${h}

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec${n.length}(${f});
    }
  `}function $H(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${M1(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const s=Kc(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function UH(n,e){const t=Kc(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function HH(n,e){const t=Kc(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function jH(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(se(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const i=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec2(r, c);
    }
  `}function YH(n,e,t){return se(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function $c(n){return`offset${n}`}function QH(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),s=As();return`
    vec4 ${t}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function JH(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${s}() {return ${t};}`;const[i,o]=n.shapeInfo.texShape;if(i===1&&o===1)return`
      float ${s}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const c=$c(t);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${c});
      return sampleTexture(${t}, uv);
    }
  `;const[h,f]=n.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${h}, ${f}, ${c});
      return sampleTexture(${t}, uv);
    }
  `}function qH(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),i=n.shapeInfo.texShape,o=As();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${o.texture2D}(${t}, uv);
    }
  `;const c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${c[0]}, ${c[1]}, index);
      return ${o.texture2D}(${t}, uv);
    }
  `}function ej(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${md(n)}
      }
    `;const i=n.shapeInfo.texShape,o=i[0],c=i[1];if(c===1&&o===1)return`
      float ${s}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const h=$c(t);return c===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${h}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${h}) + 0.5) / ${o}.0);
        return sampleTexture(${t}, uv);
      }
    `:o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${h}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${h}) + 0.5) / ${c}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${h});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${o}, ${c}, index + ${h});
      return sampleTexture(${t}, uv);
    }
  `}function tj(n,e){const t=n.shapeInfo.logicalShape,s=n.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape,c=o[0],h=o[1],f=As();if(o!=null&&se(t,o))return e?`
      vec4 ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${f.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${h}.0, ${c}.0);

        return ${f.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${i}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${f.texture2D}(${s}, uv);
    }
  `;const g=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],y=Math.ceil(t[1]/2);return`
    vec4 ${i}(int row, int col) {
      vec2 uv = packedUVfrom2D(${y}, ${g[0]}, ${g[1]}, row, col);
      return ${f.texture2D}(${s}, uv);
    }
  `}function nj(n,e){const t=n.shapeInfo.logicalShape,s=n.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape;if(o!=null&&se(t,o)){if(e)return`
      float ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const C=o[0],k=o[1];return`
    float ${i}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${k}.0, ${C}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:c,keptDims:h}=Fe(t),f=c;if(f.length<t.length){const C=gd(n,f),k=["row","col"];return`
      ${pd(C,e)}
      float ${i}(int row, int col) {
        return ${i}(${xd(k,h)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${i}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${md(n)}
      }
    `;const g=o[0],y=o[1],I=$c(s);return y===1?e?`
      float ${i}(int row, int col) {
        float index = dot(vec3(row, col, ${I}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${i}(int row, int col) {
      float index = dot(vec3(row, col, ${I}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${g}.0);
      return sampleTexture(${s}, uv);
    }
  `:g===1?e?`
      float ${i}(int row, int col) {
        float index = dot(vec3(row, col, ${I}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${i}(int row, int col) {
      float index = dot(vec3(row, col, ${I}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${y}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${i}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${I};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${i}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${I};
    vec2 uv = uvFromFlat(${g}, ${y}, index);
    return sampleTexture(${s}, uv);
  }
`}function rj(n,e){const t=n.shapeInfo.logicalShape,s=n.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape,c=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(t[0]===1){const C=t.slice(1),k=[1,2],N=gd(n,C),R=["b","row","col"];return`
        ${dN(N,e)}
        vec4 ${i}(int b, int row, int col) {
          return ${i}(${xd(R,k)});
        }
      `}const h=As();if(e)return`
    vec4 ${i}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${h.texture2D}(${s}, uv);
    }
  `;const f=c[0],g=c[1],y=Math.ceil(t[2]/2),I=y*Math.ceil(t[1]/2);return`
    vec4 ${i}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${f}, ${g}, ${I}, ${y}, b, row, col);
      return ${h.texture2D}(${s}, uv);
    }
  `}function sj(n,e){const t=n.shapeInfo.logicalShape,s=n.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t[1]*t[2],c=t[2],{newShape:h,keptDims:f}=Fe(t),g=h;if(g.length<t.length){const R=gd(n,g),P=["row","col","depth"];return`
        ${pd(R,e)}
        float ${i}(int row, int col, int depth) {
          return ${i}(${xd(P,f)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${o}, ${c}, 1)));
        ${md(n)}
      }
    `;const y=n.shapeInfo.texShape,I=y[0],C=y[1],k=n.shapeInfo.flatOffset;if(C===o&&k==null)return e?`
      float ${i}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${i}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${c}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${C}.0, ${I}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(C===c&&k==null)return e?`
      float ${i}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${i}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${C}.0, ${I}.0);
      return sampleTexture(${s}, uv);
    }
  `;const N=$c(s);return e?`
    float ${i}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${N};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${i}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${o} + col * ${c} + depth + ${N};
        vec2 uv = uvFromFlat(${I}, ${C}, index);
        return sampleTexture(${s}, uv);
      }
  `}function ij(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),i=As();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${i.texture2D}(${t}, uv);
    }
  `;const o=n.shapeInfo.logicalShape,c=o.length,h=n.shapeInfo.texShape,f=[Math.ceil(h[0]/2),Math.ceil(h[1]/2)],g=f[0],y=f[1],I=Math.ceil(o[c-1]/2);let C=I*Math.ceil(o[c-2]/2),k="int b, int row, int col",N=`b * ${C} + (row / 2) * ${I} + (col / 2)`;for(let R=2;R<c-1;R++)k=`int b${R}, `+k,C*=o[c-R-1],N=`b${R} * ${C} + `+N;return`
    vec4 ${s}(${k}) {
      int index = ${N};
      int texR = index / ${y};
      int texC = index - texR * ${y};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${y}, ${g});
      return ${i.texture2D}(${t}, uv);
    }
  `}function aj(n,e){const t=n.shapeInfo.logicalShape,s=n.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t[3],c=t[2]*o,h=t[1]*c,{newShape:f,keptDims:g}=Fe(t);if(f.length<t.length){const F=gd(n,f),W=["row","col","depth","depth2"];return`
      ${pd(F,e)}
      float ${i}(int row, int col, int depth, int depth2) {
        return ${i}(${xd(W,g)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${h}, ${c}, ${o}, 1)));
        ${md(n)}
      }
    `;const y=n.shapeInfo.flatOffset,I=n.shapeInfo.texShape,C=I[0],k=I[1],N=`int stride2 = ${s}Shape[3];`,R=`int stride1 = ${s}Shape[2] * stride2;`,P=`int stride0 = ${s}Shape[1] * stride1;`;if(k===h&&y==null)return e?`
      float ${i}(int row, int col, int depth, int depth2) {
        ${N}
        ${R}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${c}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${k}.0, ${C}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(k===o&&y==null)return e?`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${k}.0, ${C}.0);
        return sampleTexture(${s}, uv);
      }
    `;const L=$c(s);return e?`
    float ${i}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${N}
      ${R}
      ${P}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${L});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${i}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${h} + col * ${c} +
          depth * ${o} + depth2;
      vec2 uv = uvFromFlat(${C}, ${k}, index + ${L});
      return sampleTexture(${s}, uv);
    }
  `}function oj(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),i=e[4],o=e[3]*i,c=e[2]*o,h=e[1]*c,{newShape:f,keptDims:g}=Fe(e);if(f.length<e.length){const R=gd(n,f),P=["row","col","depth","depth2","depth3"];return`
      ${pd(R)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${xd(P,g)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${h}, ${c}, ${o}, ${i})) +
          depth3;
        ${md(n)}
      }
    `;const y=n.shapeInfo.flatOffset,I=n.shapeInfo.texShape,C=I[0],k=I[1];if(k===h&&y==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${c}, ${o}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${k}.0, ${C}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(k===i&&y==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${k}.0, ${C}.0);
        return sampleTexture(${t}, uv);
      }
    `;const N=$c(t);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${h} + col * ${c} + depth * ${o} +
          depth2 * ${i} + depth3 + ${N};
      vec2 uv = uvFromFlat(${C}, ${k}, index);
      return sampleTexture(${t}, uv);
    }
  `}function lj(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:i,keptDims:o}=Fe(e);if(i.length<e.length){const P=gd(n,i),L=["row","col","depth","depth2","depth3","depth4"];return`
      ${pd(P)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${xd(L,o)});
      }
    `}const c=e[5],h=e[4]*c,f=e[3]*h,g=e[2]*f,y=e[1]*g;if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${y}, ${g}, ${f}, ${h})) +
          dot(
            vec2(depth3, depth4),
            vec2(${c}, 1)));
        ${md(n)}
      }
    `;const I=n.shapeInfo.flatOffset,C=n.shapeInfo.texShape,k=C[0],N=C[1];if(N===y&&I==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${g}, ${f}, ${h}, ${c})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${N}.0, ${k}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(N===c&&I==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${N}.0, ${k}.0);
        return sampleTexture(${t}, uv);
      }
    `;const R=$c(t);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${y} + col * ${g} + depth * ${f} +
          depth2 * ${h} + depth3 * ${c} + depth4 + ${R};
      vec2 uv = uvFromFlat(${k}, ${N}, index);
      return sampleTexture(${t}, uv);
    }
  `}function md(n){const e=n.name,t=H(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function uj(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),i="get"+s+"AtOutCoords",o=n.shapeInfo.logicalShape.length,c=e.logicalShape.length,h=hN(n.shapeInfo.logicalShape,e.logicalShape),f=wn(c),g=c-o;let y;const I=["x","y","z","w","u","v"];o===0?y="":c<2&&h.length>=1?y="coords = 0;":y=h.map(P=>`coords.${I[P+g]} = 0;`).join(`
`);let C="";c<2&&o>0?C="coords":C=n.shapeInfo.logicalShape.map((P,L)=>`coords.${I[L+g]}`).join(", ");let k="return outputValue;";const N=H(n.shapeInfo.logicalShape)===1,R=H(e.logicalShape)===1;if(o===1&&!N&&!R)k=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(N&&!R)c===1?k=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:k=`
        return vec4(outputValue.x);
      `;else if(h.length){const P=o-2,L=o-1;h.indexOf(P)>-1&&h.indexOf(L)>-1?k="return vec4(outputValue.x);":h.indexOf(P)>-1?k="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":h.indexOf(L)>-1&&(k="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${i}() {
      ${f} coords = getOutputCoords();
      ${y}
      vec4 outputValue = get${s}(${C});
      ${k}
    }
  `}function cj(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),i="get"+s+"AtOutCoords",o=e.texShape,c=n.shapeInfo.texShape,h=n.shapeInfo.logicalShape.length,f=e.logicalShape.length;if(!n.shapeInfo.isUniform&&h===f&&n.shapeInfo.flatOffset==null&&se(c,o))return`
      float ${i}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const g=wn(f),y=hN(n.shapeInfo.logicalShape,e.logicalShape),I=f-h;let C;const k=["x","y","z","w","u","v"];h===0?C="":f<2&&y.length>=1?C="coords = 0;":C=y.map(R=>`coords.${k[R+I]} = 0;`).join(`
`);let N="";return f<2&&h>0?N="coords":N=n.shapeInfo.logicalShape.map((R,P)=>`coords.${k[P+I]}`).join(", "),`
    float ${i}() {
      ${g} coords = getOutputCoords();
      ${C}
      return get${s}(${N});
    }
  `}function wn(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function wb(n,e,t){const{newShape:s,keptDims:i}=Fe(e),o=e.length,c=n&&o===3&&e[0]===1,h=c?e.slice(1):s,f=!n&&o>1&&!se(e,t)&&s.length<o||c;return{useSqueezeShape:f,uniformShape:f?h:e,keptDims:i}}function gd(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function xd(n,e){return e.map(t=>n[t]).join(", ")}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hj(n,e,t,s){const i=t.map((y,I)=>{const C={logicalShape:y.shape,texShape:y.isUniform?null:y.texData.texShape,isUniform:y.isUniform,isPacked:y.isUniform?!1:y.texData.isPacked,flatOffset:null};return y.texData!=null&&y.texData.slice!=null&&y.texData.slice.flatOffset>0&&(C.flatOffset=y.texData.slice.flatOffset),{name:e.variableNames[I],shapeInfo:C}}),o=i.map(y=>y.shapeInfo),c={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},h=AH(i,c,e),f=sH(n.gl,h),g=n.createProgram(f);return ke().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:f,source:h,webGLProgram:g,inShapeInfos:o,outShapeInfo:c,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(g),Object.assign({program:e,fragmentShader:f,source:h,webGLProgram:g,inShapeInfos:o,outShapeInfo:c},pN(n,e,g)))}function pN(n,e,t){const s=[],i=[];let o,c,h,f=null,g=null;g=n.getUniformLocation(t,"NAN",!1),ke().getNumber("WEBGL_VERSION")===1&&(f=n.getUniformLocation(t,"INFINITY",!1));const y=!1;for(const I of e.variableNames){const C={name:I,uniform:n.getUniformLocation(t,I,y),offset:n.getUniformLocation(t,`offset${I}`,y)};e.enableShapeUniforms&&(C.shape=n.getUniformLocation(t,`${I}Shape`,y),C.texShape=n.getUniformLocation(t,`${I}TexShape`,y)),s.push(C)}if(e.enableShapeUniforms&&(o=n.getUniformLocation(t,"outShape",y),h=n.getUniformLocation(t,"outShapeStrides",y),c=n.getUniformLocation(t,"outTexShape",y)),e.customUniforms)for(const I of e.customUniforms)i.push(n.getUniformLocation(t,I.name,y));return{variablesLocations:s,customUniformLocations:i,infLoc:f,nanLoc:g,outShapeLocation:o,outShapeStridesLocation:h,outTexShapeLocation:c}}function mN(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,s)=>{const i=t.logicalShape,o=e[s],c=o.shape;if(!se(i,c))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${i} and ${c} must match`);if(t.isUniform&&o.isUniform)return;const h=t.texShape,f=o.isUniform?null:o.texData.texShape;if(!se(h,f))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${h} and ${f} must match`)})}function dj(n,e,t,s,i){e.program.enableShapeUniforms||(mN(e.inShapeInfos,t),mN([e.outShapeInfo],[s]));const o=s.texData.texture,c=s.texData.texShape;s.texData.isPacked?n.setOutputPackedMatrixTexture(o.texture,c[0],c[1]):n.setOutputMatrixTexture(o.texture,c[0],c[1]),n.setProgram(e.webGLProgram),n.bindVertexArray(e.webGLProgram.vao),ke().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN);for(let f=0;f<t.length;++f){const g=t[f],{uniform:y,offset:I,shape:C,texShape:k}=e.variablesLocations[f];if(C){const{uniformShape:N}=wb(e.program.packedInputs,g.shape,g.texData.texShape);switch(N.length){case 1:n.gl.uniform1iv(C,new Int32Array(N));break;case 2:n.gl.uniform2iv(C,new Int32Array(N));break;case 3:n.gl.uniform3iv(C,new Int32Array(N));break;case 4:n.gl.uniform4iv(C,new Int32Array(N));break}}if(k&&n.gl.uniform2i(k,g.texData.texShape[0],g.texData.texShape[1]),y!=null){if(g.isUniform){if(H(g.shape)<2)n.gl.uniform1f(y,g.uniformValues[0]);else{let N=g.uniformValues;N instanceof Float32Array||(N=new Float32Array(N)),n.gl.uniform1fv(y,N)}continue}g.texData.slice!=null&&I!=null&&n.gl.uniform1i(I,g.texData.slice.flatOffset),n.setInputMatrixTexture(g.texData.texture.texture,y,f)}}const h=e.outShapeLocation;if(h)switch(s.shape.length){case 1:n.gl.uniform1iv(h,new Int32Array(s.shape));break;case 2:n.gl.uniform2iv(h,new Int32Array(s.shape));break;case 3:n.gl.uniform3iv(h,new Int32Array(s.shape));break;case 4:n.gl.uniform4iv(h,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const f=We(s.shape);switch(s.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(f));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(f));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(f));break}}if(e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&i)for(let f=0;f<e.program.customUniforms.length;++f){const g=e.program.customUniforms[f],y=e.customUniformLocations[f],I=i[f];if(g.type==="float")n.gl.uniform1fv(y,I);else if(g.type==="vec2")n.gl.uniform2fv(y,I);else if(g.type==="vec3")n.gl.uniform3fv(y,I);else if(g.type==="vec4")n.gl.uniform4fv(y,I);else if(g.type==="int")n.gl.uniform1iv(y,I);else if(g.type==="ivec2")n.gl.uniform2iv(y,I);else if(g.type==="ivec3")n.gl.uniform3iv(y,I);else if(g.type==="ivec4")n.gl.uniform4iv(y,I);else throw Error(`uniform type ${g.type} is not supported yet.`)}n.executeProgram()}function fj(n,e,t){let s="";e.concat(t).forEach(c=>{const h=c.texData!=null&&c.texData.slice!=null&&c.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!c.isUniform){const f=c.texData.texShape,{useSqueezeShape:g,uniformShape:y,keptDims:I}=wb(n.packedInputs,c.shape,f);let C="",k="",N="";if(y.length===1&&n.packedInputs){const X=[Math.ceil(f[0]/2),Math.ceil(f[1]/2)];C=`${X[0]>1}_${X[1]>1}`}else if(y.length===2&&!n.packedInputs)k=`${y[0]>1}_${y[1]>1}`;else if(y.length>2&&!n.packedInputs){const X=We(y);N=`${X[0]===f[1]}_${X[X.length-1]===f[1]}`}const R=c.shape.length,P=y.length===2&&se(c.shape,f),L=H(c.shape)===1,F=Yh(c.shape,t.shape),W=!n.packedInputs&&R===t.shape.length&&se(f,t.texData.texShape),z=n.packedInputs||y.length>2?"":`${f[0]>1}_${f[1]>1}`;s+=`${R}_${W}_${g?I:""}_${y.length}_${L}_${F}_${P}_${C}_${k}_${N}_${z}_${h}`}else{const f=c.isUniform?"uniform":c.texData.texShape;s+=`${c.shape}_${f}_${h}`}});const i=n.userCode;let o=n.constructor.name;return o+="_"+s+"_"+i+`${ke().getNumber("WEBGL_VERSION")}`,o}function fs(n){return ke().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class pj{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=tp.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=As();this.outputShape=e,this.enableShapeUniforms=fs(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?M1(["r","c","d"],e):Kc(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class mj{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=tp.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=As();this.outputShape=e,this.enableShapeUniforms=fs(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?M1(["r","c","d"],e):Kc(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class gj{constructor(e){this.variableNames=["A"],this.outTexUsage=Ni.DOWNLOAD;const t=As();this.outputShape=e,this.userCode=`
      ${cN}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class xj{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Ni.DOWNLOAD;const t=As();this.outputShape=e,this.userCode=`
      ${cN}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const yj={R:0,G:1,B:2,A:3};class gN{constructor(e,t=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const i=As();this.outputShape=e,this.enableShapeUniforms=fs(this.outputShape.length);let o="result";t&&(o="floor(result * 255. + 0.5)");let c="";for(let h=0;h<s.length;h++){const f=s[h];c+=`
          if(offset == ${h}) {
            result = values[${yj[f]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?bb():yb(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${i.texture2D}(A, uv);
          ${c}
        }
        ${i.output} = vec4(${o}, 0., 0., 0.);
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class bj{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=As();this.outputShape=e,this.enableShapeUniforms=fs(this.outputShape.length);let i="",o="result";t&&(o="floor(result * 255. + 0.5)");for(let c=0;c<=1;c++)for(let h=0;h<=1;h++){const f=c*2+h;i+=`
          localCoords = coords;
          if(localCoords[2] + ${h} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${h};
          if (localCoords[1] + ${c} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${c};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${f}] = values[0];
            } else if (offset == 1) {
              result[${f}] = values[1];
            } else if (offset == 2) {
              result[${f}] = values[2];
            } else {
              result[${f}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?bb():yb(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${i}

          ${s.output} = ${o};
        }
    `}}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function wj(n){const e=As(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return rH(n,t)}function vj(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return lH(n,e)}function Ij(n){const e=new Uint16Array([0,1,2,2,1,3]);return uH(n,e)}function sp(n,e,t,s,i,o){hH(e,t);const c=cH(n),h=n.TEXTURE_2D;return ot(n,()=>n.bindTexture(h,c)),ot(n,()=>n.texParameteri(h,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),ot(n,()=>n.texParameteri(h,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),ot(n,()=>n.texParameteri(h,n.TEXTURE_MIN_FILTER,n.NEAREST)),ot(n,()=>n.texParameteri(h,n.TEXTURE_MAG_FILTER,n.NEAREST)),ke().getNumber("WEBGL_VERSION")===1?ot(n,()=>n.texImage2D(h,0,s,e,t,0,i,o,null)):ot(n,()=>n.texStorage2D(h,1,s,e,t)),ot(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:c,texShape:[t,e]}}function xN(n){return n.internalFormatFloat}function Cj(n,e,t,s){const[i,o]=np(e,t);return sp(n,i,o,xN(s),s.textureFormatFloat,n.FLOAT)}function yN(n){return n.internalFormatHalfFloat}function Sj(n,e,t,s){const[i,o]=np(e,t);return sp(n,i,o,yN(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function bN(n){return n.downloadTextureFormat}function Tj(n,e,t,s){const[i,o]=np(e,t);return sp(n,i,o,bN(s),n.RGBA,n.UNSIGNED_BYTE)}function wN(n){return n.internalFormatPackedFloat}function kj(n,e,t,s){const[i,o]=hd(e,t);return sp(n,i,o,wN(s),n.RGBA,n.FLOAT)}function vN(n){return n.internalFormatPackedHalfFloat}function Ej(n,e,t,s){const[i,o]=hd(e,t);return sp(n,i,o,vN(s),n.RGBA,s.textureTypeHalfFloat)}function Nj(n,e,t){return ot(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),oN(n,e,"clipSpacePos",t,3,20,0)&&oN(n,e,"uv",t,2,20,12)}function Aj(n,e,t,s,i,o){ot(n,()=>n.bindTexture(n.TEXTURE_2D,e));let c,h,f;i instanceof Uint8Array?(c=new Uint8Array(t*s*4),h=n.UNSIGNED_BYTE,f=n.RGBA):(c=new Float32Array(t*s*4),h=n.FLOAT,f=o.internalFormatPackedFloat),c.set(i),ke().getNumber("WEBGL_VERSION")===2?ot(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,s,n.RGBA,h,c)):ot(n,()=>n.texImage2D(n.TEXTURE_2D,0,f,t,s,0,n.RGBA,h,c)),ot(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function Rj(n,e,t){ot(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?ke().getNumber("WEBGL_VERSION")===2?ot(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):ot(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):ke().getNumber("WEBGL_VERSION")===2?ot(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):ot(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),ot(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function Mj(n,e,t,s){const i=n.createBuffer();ot(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,i));const o=4*4*e*t;return ot(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,o,n.STREAM_READ)),ot(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),ot(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),i}function Lj(n,e,t){const s=n,i=new Float32Array(t);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,i),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),i}function Dj(n,e,t,s){const[i,o]=np(e,t),c=4,h=new Uint8Array(YU(e*t,c));return ot(n,()=>n.readPixels(0,0,i,o,s.downloadTextureFormat,n.UNSIGNED_BYTE,h)),new Float32Array(h.buffer)}function Oj(n,e,t,s,i,o,c,h){const f=n,g=new Float32Array(QU(o,c));return f.bindBuffer(f.PIXEL_PACK_BUFFER,e),f.getBufferSubData(f.PIXEL_PACK_BUFFER,0,g),f.bindBuffer(f.PIXEL_PACK_BUFFER,null),g}function Pj(n,e,t){const s=new Float32Array(e*t*4);return ot(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,s)),s}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class vb{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=ke().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,UU(t,e)):this.gl=Ga(t),e=this.gl,ke().getNumber("WEBGL_VERSION")===2){const o=e;this.createVertexArray=()=>ot(o,()=>o.createVertexArray()),this.bindVertexArray=c=>ot(o,()=>o.bindVertexArray(c)),this.deleteVertexArray=c=>ot(o,()=>o.deleteVertexArray(c)),this.getVertexArray=()=>ot(o,()=>o.getParameter(o.VERTEX_ARRAY_BINDING))}else if(e!=null){const o=e.getExtension("OES_vertex_array_object");if(o==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>ot(e,()=>o.createVertexArrayOES()),this.bindVertexArray=c=>ot(e,()=>o.bindVertexArrayOES(c)),this.deleteVertexArray=c=>ot(e,()=>o.deleteVertexArrayOES(c)),this.getVertexArray=()=>ot(e,()=>e.getParameter(o.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const i="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),ke().getNumber("WEBGL_VERSION")===1){const o="OES_texture_float",c="OES_texture_half_float";if(this.textureFloatExtension=k1(this.gl,o),oa(this.gl,c))this.textureHalfFloatExtension=k1(this.gl,c);else if(ke().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),oa(this.gl,i))this.colorBufferHalfFloatExtension=k1(this.gl,i);else if(ke().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",oa(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(oa(this.gl,i))this.colorBufferHalfFloatExtension=this.gl.getExtension(i);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=vj(this.gl),this.indexBuffer=Ij(this.gl),this.framebuffer=dH(this.gl),this.textureConfig=db(this.gl,this.textureHalfFloatExtension)}get debug(){return ke().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;ot(e,()=>e.finish()),ot(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),ot(e,()=>e.deleteFramebuffer(this.framebuffer)),ot(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),ot(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),ot(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),Cj(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),Sj(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),Tj(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),Rj(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,s,i){this.throwIfDisposed(),Aj(this.gl,e,t,s,i,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),Ej(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),kj(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(lN(this.gl,this.framebuffer),this.outputTexture=null),ot(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,s){return this.downloadMatrixDriver(e,()=>Dj(this.gl,t,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,s,i,o,c){return Oj(this.gl,e,t,s,i,o,c,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return Lj(this.gl,e,t)}createBufferFromTexture(e,t,s){this.bindTextureToFrameBuffer(e);const i=Mj(this.gl,t,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),i}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,s;if(ke().getBool("WEBGL_FENCE_API_ENABLED")){const i=e,o=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const c=i.clientWaitSync(o,0,0);return c===i.ALREADY_SIGNALED||c===i.CONDITION_SATISFIED},t=o}else ke().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(t,ke().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:t,isFencePassed:s}}downloadMatrixFromPackedTexture(e,t,s){return this.downloadMatrixDriver(e,()=>Pj(this.gl,t,s))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=wj(t));const s=aH(t);ot(t,()=>t.attachShader(s,this.vertexShader)),ot(t,()=>t.attachShader(s,e)),oH(t,s);const i=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&fb(t,i),i}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;ot(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),Nj(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(ot(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&fb(this.gl,this.program),ot(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,s=!0){return this.throwIfDisposed(),s?pH(this.gl,e,t):mH(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),ot(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,s){this.throwIfDisposed(),this.throwIfNoProgram(),gH(this.gl,e,t,s)}setOutputMatrixTexture(e,t,s){this.setOutputMatrixTextureDriver(e,s,t)}setOutputPackedMatrixTexture(e,t,s){this.throwIfDisposed();const[i,o]=hd(t,s);this.setOutputMatrixTextureDriver(e,i,o)}setOutputMatrixWriteRegion(e,t,s,i){this.setOutputMatrixWriteRegionDriver(s,e,i,t)}setOutputPackedMatrixWriteRegion(e,t,s,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&fb(this.gl,this.program),E1(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}ot(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),ot(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=k1(this.gl,ke().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(ke().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=s.createQuery();return s.beginQuery(i.TIME_ELAPSED_EXT,o),o}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(ke().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,s=this.getQueryTimerExtensionWebGL2();t.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await j(()=>this.disposed||this.isQueryAvailable(e,ke().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,ke().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const s=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),i=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),i&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=Fj(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:s}=this.itemsToPoll[t];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in ke().platform&&(s=ke().platform.setTimeoutCustom.bind(ke().platform)),j(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),pb(this.gl,e,this.framebuffer),this.debug&&E1(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(pb(this.gl,this.outputTexture,this.framebuffer),this.debug&&E1(this.gl)):lN(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const s=t();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,t,s){this.throwIfDisposed();const i=this.gl;pb(i,e,this.framebuffer),this.debug&&E1(i),this.outputTexture=e,ot(i,()=>i.viewport(0,0,t,s)),ot(i,()=>i.scissor(0,0,t,s))}setOutputMatrixWriteRegionDriver(e,t,s,i){this.throwIfDisposed(),ot(this.gl,()=>this.gl.scissor(e,t,s,i))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function Fj(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const{addImpl:Gj,bincountImpl:IN,bincountReduceImpl:_j,bitwiseAndImpl:Vj,castImpl:Bj,ceilImpl:Wj,concatImpl:zj,equalImpl:Xj,expImpl:Zj,expm1Impl:Kj,floorImpl:$j,gatherNdImpl:Uj,gatherV2Impl:Hj,greaterImpl:jj,greaterEqualImpl:Yj,lessImpl:Qj,lessEqualImpl:Jj,linSpaceImpl:qj,logImpl:eY,maxImpl:tY,maximumImpl:nY,minimumImpl:rY,multiplyImpl:sY,negImpl:iY,notEqualImpl:aY,prodImpl:oY,raggedGatherImpl:lY,raggedRangeImpl:uY,raggedTensorToTensorImpl:cY,rangeImpl:hY,rsqrtImpl:dY,scatterImpl:fY,sigmoidImpl:pY,simpleAbsImpl:CN,sliceImpl:mY,sparseFillEmptyRowsImpl:gY,sparseReshapeImpl:xY,sparseSegmentReductionImpl:SN,sqrtImpl:yY,staticRegexReplaceImpl:bY,stridedSliceImpl:wY,stringNGramsImpl:vY,stringSplitImpl:IY,stringToHashBucketFastImpl:CY,subImpl:SY,tileImpl:TY,topKImpl:kY,transposeImpl:Ib,uniqueImpl:EY}=LX;/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function TN(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function Rs(n,e){return e===1?[n]:TN(n,e)}function NY(n,e){if(n===1)return"rc";let t="";for(let s=0;s<n;s++)t+=e[s],s<n-1&&(t+=",");return t}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class AY{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=fs(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=Rs("rc",this.rank),s=wn(this.rank),i=this.getOutOfBoundsCondition(t),o=this.getSetup(t),c=this.getOutput(t);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${i}) {
            setOutput(vec4(0));
          } else {
            ${o}

            setOutput(vec4(${c}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let s=0;s<=1;s++)for(let i=0;i<=1;i++){let o=`${s===0?"r":"rp1"}, ${i===0?"c":"cp1"}`;for(let c=2;c<this.rank;c++)o=`${e[e.length-1-c]},`+o;t.push(o)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let s=this.rank-2;s<this.rank;s++)t+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],i=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${i};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class kN{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=fs(this.outputShape.length);let s="";for(let i=0;i<4;i++){let o="thisRC = rc;";i%2===1&&(o+="thisRC.z += 1;"),i>1&&(o+="thisRC.y += 1;"),s+=`
        ${o}
        ${i>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${i}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${i>0?"}":""}
      `}this.userCode=`
      ${RY(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?bb():yb(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function RY(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?NH(["r","c","d"],"inputShape"):Kc(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class MY{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,s){const i=NN(t,s),o=AN(e,i,s);o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]);const c=EN(e,i,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=c,this.log();const f=this.freeTextures[o].pop();return this.usedTextures[o].push(f),f}let h;return i===ss.PACKED_2X2_FLOAT32?h=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):i===ss.PACKED_2X2_FLOAT16?h=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):i===ss.UNPACKED_FLOAT32?h=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):i===ss.UNPACKED_FLOAT16?h=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):i===ss.PACKED_4X1_UNSIGNED_BYTE&&(h=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(h),this.numUsedTextures++,this._numBytesAllocated+=c,this.log(),h}releaseTexture(e,t,s,i){if(this.freeTextures==null)return;const o=NN(s,i),c=AN(t,o,i);c in this.freeTextures||(this.freeTextures[c]=[]);const h=EN(t,o,this.gpgpu.gl,this.gpgpu.textureConfig,i),f=ke().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");f!==-1&&this._numBytesAllocated>f?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=h):(this.freeTextures[c].push(e),this.numFreeTextures++,this._numBytesFree+=h),this.numUsedTextures--;const g=this.usedTextures[c],y=g&&g.indexOf(e);if(y==null||y<0)throw new Error("Cannot release a texture that was never provided by this texture manager");g[y]=g[g.length-1],g.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function LY(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F||e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function EN(n,e,t,s,i){const o=DY(e,s);let c;if(i){const[f,g]=hd(n[0],n[1]);c=f*g}else{const[f,g]=np(n[0],n[1]);c=f*g}const h=LY(t,o);return c*h}function DY(n,e){switch(n){case ss.PACKED_2X2_FLOAT32:return wN(e);case ss.PACKED_2X2_FLOAT16:return vN(e);case ss.UNPACKED_FLOAT32:return xN(e);case ss.UNPACKED_FLOAT16:return yN(e);case ss.PACKED_4X1_UNSIGNED_BYTE:return bN(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function OY(n){return ke().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?ss.PACKED_2X2_FLOAT32:ss.UNPACKED_FLOAT32:n?ss.PACKED_2X2_FLOAT16:ss.UNPACKED_FLOAT16}function NN(n,e){if(n===Ni.UPLOAD)return ss.PACKED_2X2_FLOAT32;if(n===Ni.RENDER||n==null)return OY(e);if(n===Ni.DOWNLOAD||n===Ni.PIXELS)return ss.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function AN(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class bo{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=fs(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const la="if (isnan(x)) return x;",PY="return x;",RN="return abs(x);",FY="return (x >= 0.0) ? x : (exp(x) - 1.0);",GY=la+`
  return (x < 0.0) ? 0.0 : x;
`,_Y=la+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,pu="return x;",VY="return 1.0 / (1.0 + exp(-1.0 * x));";/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const BY="return x;",WY=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,zY=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,XY=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,ZY="return 1.0 / (1.0 + exp(-1.0 * x));";class mu{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=fs(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class KY{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=fs(this.outputShape.length);const t=e.length,s=Rs("rc",t),i=wn(t),o=NY(t,s),c=s.slice(-2),h=t<=1?"rc":`vec2(${c.join(",")})`;this.userCode=`
      void main() {
        ${i} rc = getOutputCoords();
        vec4 packedInput = getA(${o});

        setOutput(getChannel(packedInput, ${h}));
      }
    `}}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const $Y=iS,UY=1e-7,HY=1e-4,Cb={};function jY(n){return n in Cb||(Cb[n]={}),Cb[n]}const YY=ke().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),QY=600;function JY(){return ke().global.screen==null?1024:ke().global.screen.height*ke().global.screen.width*window.devicePixelRatio*QY/1024/1024}class L1 extends x{nextDataId(){return L1.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!ke().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof vb)t=e;else{const s=Ga(ke().getNumber("WEBGL_VERSION"),e);t=new vb(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=Ga(ke().getNumber("WEBGL_VERSION"));t=new vb(s),this.binaryCache=jY(ke().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new MY(this.gpgpu),this.numMBBeforeWarning=JY(),this.texData=new p(this,Dn())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,s,i,o,c){const h=this.makeTensorInfo(t,s),f=this.texData.get(h.dataId);f.isPacked=!1,f.texture={texture:e,texShape:[i,o]},f.texShape=[i,o];const g=N1(t),y=new gN(g,!1,c),I=this.runWebGLProgram(y,[h],s,[[i,o]]);return I.shape=t,f.texture=null,this.disposeIntermediateTensorInfo(h),I.dataId}write(e,t,s){if((ke().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||ke().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const i={id:this.nextDataId()};return this.texData.set(i,{shape:t,dtype:s,values:e,usage:Ni.UPLOAD,refCount:1}),i}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,s,i,o){if(ke().getBool("DEBUG")&&this.checkNumericalProblems(t),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:i,values:t,usage:Ni.UPLOAD,refCount:o})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:s,dtype:i,complexTensorInfos:o,slice:c,shape:h,isPacked:f}=t;if(c!=null){let C;f?C=new mu(h,pu):C=new bo(h,pu);const k=this.runWebGLProgram(C,[{dataId:e,shape:h,dtype:i}],i),N=this.readSync(k.dataId);return this.disposeIntermediateTensorInfo(k),N}if(s!=null)return this.convertAndCacheOnCPU(e);if(i==="string")return s;const g=this.activeTimers!=null;let y;g&&(y=Vs());let I;if(i==="complex64"){const C=this.readSync(o.real.dataId),k=this.readSync(o.imag.dataId);I=sl(C,k)}else I=this.getValuesFromTexture(e);return g&&(this.downloadWaitMs+=Vs()-y),this.convertAndCacheOnCPU(e,I)}async read(e){if(this.pendingRead.has(e)){const N=this.pendingRead.get(e);return new Promise(R=>N.push(R))}const t=this.texData.get(e),{values:s,shape:i,slice:o,dtype:c,complexTensorInfos:h,isPacked:f}=t;if(o!=null){let N;f?N=new mu(i,pu):N=new bo(i,pu);const R=this.runWebGLProgram(N,[{dataId:e,shape:i,dtype:c}],c),P=this.read(R.dataId);return this.disposeIntermediateTensorInfo(R),P}if(s!=null)return this.convertAndCacheOnCPU(e);if(ke().getBool("DEBUG")&&!ke().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&ke().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let g=null,y;if(c!=="complex64"&&ke().get("WEBGL_BUFFER_SUPPORTED")){y=this.decode(e);const N=this.texData.get(y.dataId);g=this.gpgpu.createBufferFromTexture(N.texture.texture,...T1(i))}this.pendingRead.set(e,[]),c!=="complex64"&&await this.gpgpu.createAndWaitForFence();let I;if(c==="complex64"){const N=await Promise.all([this.read(h.real.dataId),this.read(h.imag.dataId)]),R=N[0],P=N[1];I=sl(R,P)}else if(g==null)I=this.getValuesFromTexture(e);else{const N=H(i);I=this.gpgpu.downloadFloat32MatrixFromBuffer(g,N)}if(y!=null&&this.disposeIntermediateTensorInfo(y),g!=null){const N=this.gpgpu.gl;ot(N,()=>N.deleteBuffer(g))}const C=this.convertAndCacheOnCPU(e,I),k=this.pendingRead.get(e);return this.pendingRead.delete(e),k.forEach(N=>N(C)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Dn().removeDataId(e,this),this.pendingDeletes--),C}readToGPU(e,t={}){const s=this.texData.get(e),{values:i,shape:o,slice:c,dtype:h,isPacked:f,texture:g}=s;if(h==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(c!=null){let k;f?k=new mu(o,pu):k=new bo(o,pu);const N=this.runWebGLProgram(k,[{dataId:e,shape:o,dtype:h}],h),R=this.readToGPU(N,t);return this.disposeIntermediateTensorInfo(N),R}if(g==null)throw i!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const y=this.decode(e,t.customTexShape),I=Dn().makeTensorFromTensorInfo(y),C=this.texData.get(y.dataId);return Object.assign({tensorRef:I},C.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(i=>Yl(i));return Xt(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Xt(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const s=e[t];if(!tH(s))throw ke().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:s,isPacked:i}=this.texData.get(e),o=H(t);if(ke().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const C=this.decode(e),k=this.texData.get(C.dataId),N=this.gpgpu.downloadMatrixFromPackedTexture(k.texture.texture,...T1(t)).subarray(0,o);return this.disposeIntermediateTensorInfo(C),N}const c=ke().getBool("WEBGL_PACK")&&i===!0,h=c?N1(t):t,f=c?new xj(h):new gj(h),g=this.runWebGLProgram(f,[{shape:h,dtype:s,dataId:e}],"float32"),y=this.texData.get(g.dataId),I=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(y.texture.texture,y.texShape[0],y.texShape[1]).subarray(0,o);return this.disposeIntermediateTensorInfo(g),I}timerAvailable(){return ke().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,s=[];let i=!1;this.programTimersStack==null?(this.programTimersStack=s,i=!0):this.activeTimers.push(s),this.activeTimers=s,e();const o=bc(this.activeTimers.map(f=>f.query)).filter(f=>f!=null),c=bc(this.activeTimers.map(f=>f.name)).filter(f=>f!=null);this.activeTimers=t,i&&(this.programTimersStack=null);const h={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(ke().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const f=await Promise.all(o);h.kernelMs=V(f),h.getExtraProfileInfo=()=>f.map((g,y)=>({name:c[y],ms:g})).map(g=>`${g.name}: ${g.ms}`).join(", ")}else h.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,h})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return ke().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Vs(),endMs:null}}endTimer(e){return ke().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Vs(),e)}async getQueryTime(e){if(ke().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,t),this.disposeData(s.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:s,texShape:i,usage:o,isPacked:c,slice:h}=this.texData.get(e),f=h&&h.origDataId||e,g=this.dataRefCount.get(f);g>1?this.dataRefCount.set(f,g-1):(this.dataRefCount.delete(f),t!=null&&(this.numBytesInGPU-=this.computeBytes(i,s),this.textureManager.releaseTexture(t,i,o,c)));const y=this.texData.get(e);y.texture=null,y.texShape=null,y.isPacked=!1,y.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=YY){return ke().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&H(s.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){Z("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return $Y(e.shape,t)}packedUnaryOp(e,t,s){const i=new mu(e.shape,t),o=this.compileAndRun(i,[e],s);return Dn().makeTensorFromTensorInfo(o)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const i=CN(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,i)}if(ke().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,RN,e.dtype);const t=new bo(e.shape,RN),s=this.compileAndRun(t,[e]);return Dn().makeTensorFromTensorInfo(s)}makeTensorInfo(e,t,s){let i;if(t==="string"&&s!=null&&s.length>0&&fn(s[0])){const o=s.map(c=>jl(c));i=this.write(o,e,t)}else i=this.write(s,e,t);return this.texData.get(i).usage=null,{dataId:i,shape:e,dtype:t}}makeOutput(e,t,s){return Dn().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,s),this)}unpackTensor(e){const t=new KY(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new AY(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const s=[dd(e.shape),...fd(e.shape)],i={dtype:e.dtype,shape:s,dataId:e.dataId},o=[dd(t),...fd(t)],c=new kN(o,s),h=!0,f=[s],g=this.runWebGLProgram(c,[i],e.dtype,f,h);return{dataId:g.dataId,shape:t,dtype:g.dtype}}decode(e,t){const s=this.texData.get(e),{isPacked:i,shape:o,dtype:c}=s;if(t!=null){const C=H(o),k=t[0]*t[1]*4;D(C<=k,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const h=N1(o);let f;i?f=new mj(h):f=new pj(h);const g=!0,y=[t??T1(h)],I=this.runWebGLProgram(f,[{shape:h,dtype:c,dataId:e}],c,y,g,t);return{dtype:c,shape:o,dataId:I.dataId}}runWebGLProgram(e,t,s,i,o=!1,c){const h=this.makeTensorInfo(e.outputShape,s),f=this.texData.get(h.dataId);if(e.packedOutput&&(f.isPacked=!0),e.outPackingScheme===tp.DENSE){const L=c??T1(e.outputShape);f.texShape=L.map(F=>F*2)}if(e.outTexUsage!=null&&(f.usage=e.outTexUsage),H(h.shape)===0)return f.values=ue(h.dtype,0),h;const g=[],y=t.map(L=>{if(L.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let F=this.texData.get(L.dataId);if(F.texture==null){if(!e.packedInputs&&H(L.shape)<=ke().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:L.shape,texData:null,isUniform:!0,uniformValues:F.values};e.packedInputs&&(F.isPacked=!0,F.shape=L.shape)}if(this.uploadToGPU(L.dataId),!!F.isPacked!=!!e.packedInputs)L=F.isPacked?this.unpackTensor(L):this.packTensor(L),g.push(L),F=this.texData.get(L.dataId);else if(F.isPacked&&!R1(F.shape,L.shape)){const W=L,z=L.shape;L.shape=F.shape,L=this.packedReshape(L,z),g.push(L),F=this.texData.get(L.dataId),W.shape=z}return{shape:L.shape,texData:F,isUniform:!1}});this.uploadToGPU(h.dataId);const I={shape:h.shape,texData:f,isUniform:!1},C=fj(e,y,I),k=this.getAndSaveBinary(C,()=>hj(this.gpgpu,e,y,I)),N=this.activeTimers!=null;let R;N&&(R=this.startTimer()),ke().get("ENGINE_COMPILE_ONLY")||dj(this.gpgpu,k,y,I,i),g.forEach(L=>this.disposeIntermediateTensorInfo(L)),N&&(R=this.endTimer(R),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(R)}));const P=ke().getNumber("WEBGL_FLUSH_THRESHOLD");if(P>0){const L=Vs();L-this.lastGlFlushTime>P&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=L)}if(!ke().getBool("WEBGL_LAZILY_UNPACK")&&f.isPacked&&o===!1){const L=this.unpackTensor(h);return this.disposeIntermediateTensorInfo(h),L}return h}compileAndRun(e,t,s,i,o=!1){return s=s||t[0].dtype,this.runWebGLProgram(e,t,s,i,o)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(ke().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ye(()=>{if(!ke().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=ke().getBool("DEBUG");ke().set("DEBUG",!1);const t=this.abs(hn(1e-8)).dataSync()[0];if(ke().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?UY:HY}uploadToGPU(e){const t=this.texData.get(e),{shape:s,dtype:i,values:o,texture:c,usage:h,isPacked:f}=t;if(c!=null)return;const g=this.activeTimers!=null;let y;g&&(y=Vs());let I=t.texShape;if(I==null&&(I=bH(s,f),t.texShape=I),o!=null){const C=N1(s);let k,N=I[1],R=I[0];const P=o instanceof Uint8Array||o instanceof Uint8ClampedArray;(f||!P)&&([N,R]=hd(I[0],I[1])),f?k=new bj(C,P):k=new gN(C,P);const L=P?[R,N]:I,F=this.makeTensorInfo(L,i),W=this.texData.get(F.dataId);P?W.usage=Ni.PIXELS:W.usage=Ni.UPLOAD,W.texShape=L,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(F.dataId),N,R,o);const z=[[R,N]],X=this.runWebGLProgram(k,[F],i,z,!0),Q=this.texData.get(X.dataId);t.texShape=Q.texShape,t.isPacked=Q.isPacked,t.usage=Q.usage,ke().get("ENGINE_COMPILE_ONLY")?this.disposeData(X.dataId):(t.texture=Q.texture,t.values=null,this.texData.delete(X.dataId)),this.disposeIntermediateTensorInfo(F),g&&(this.uploadWaitMs+=Vs()-y)}else{const C=this.acquireTexture(I,h,i,f);t.texture=C}}convertAndCacheOnCPU(e,t){const s=this.texData.get(e),{dtype:i}=s;return t!=null&&(s.values=qY(t,i)),s.values}acquireTexture(e,t,s,i){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${o} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,i)}computeBytes(e,t){return e[0]*e[1]*ht(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const s=new Promise(i=>{try{this.checkCompletion_(t),i(!0)}catch(o){throw o}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await Z0(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(aN(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:s,infLoc:i,nanLoc:o,outShapeLocation:c,outShapeStridesLocation:h,outTexShapeLocation:f}=pN(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=s,e.infLoc=i,e.nanLoc=o,e.outShapeLocation=c,e.outShapeStridesLocation=h,e.outTexShapeLocation=f}}createTensorFromGPUData(e,t,s){e.channels=e.channels||"RGBA";const{texture:i,height:o,width:c,channels:h}=e,f=Dn().backend;if(!f.gpgpu.gl.isTexture(i))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const g=f.writeTexture(i,t,s,o,c,h);return Dn().makeTensorFromDataId(g,t,s,f)}}L1.nextDataId=0;function qY(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let s=0;s<t.length;++s)t[s]=Math.round(n[s]);return t}else throw new Error(`Unknown dtype ${e}`)}/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/oC()&&hC("webgl",()=>new L1,2);/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Sb=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Uc{constructor(e,t,s){this.variableNames=["A","B"],this.outputShape=Ft(t,s),this.enableShapeUniforms=fs(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Hc=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class yd{constructor(e,t,s,i=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ft(t,s);const o=this.outputShape.length;this.enableShapeUniforms=fs(o);let c="";if(i)if(o===0||H(this.outputShape)===1)c=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(c=`
          ${wn(o)} coords = getOutputCoords();
        `,o===1)this.enableShapeUniforms?c+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:c+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const h=Rs("coords",o);this.enableShapeUniforms?c+=`
            bool nextRowOutOfBounds =
              (${h[o-2]} + 1) >= outShape[${o} - 2];
            bool nextColOutOfBounds =
              (${h[o-1]} + 1) >= outShape[${o} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:c+=`
            bool nextRowOutOfBounds =
              (${h[o-2]} + 1) >= ${this.outputShape[o-2]};
            bool nextColOutOfBounds =
              (${h[o-1]} + 1) >= ${this.outputShape[o-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${c}

        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ci(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const eQ={kernelName:Ie,backendName:"webgl",kernelFunc:ci};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function gu(n){const{inputs:e,backend:t}=n,{real:s,imag:i}=e,o=t.makeTensorInfo(s.shape,"complex64"),c=t.texData.get(o.dataId),h=ci({inputs:{x:s},backend:t}),f=ci({inputs:{x:i},backend:t});return c.complexTensorInfos={real:h,imag:f},o}const tQ={kernelName:ei,backendName:"webgl",kernelFunc:gu};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const MN="return (a < 0.) ? b * a : a;",LN=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function nQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{alpha:o}=s,c=t.makeTensorInfo([],"float32",Hl(o,"float32")),h=ke().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new yd(LN,i.shape,c.shape):new Uc(MN,i.shape,c.shape),f=t.runWebGLProgram(h,[i,c],"float32");return t.disposeIntermediateTensorInfo(c),f}const rQ={kernelName:Ol,backendName:"webgl",kernelFunc:nQ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const DN="return (a < 0.) ? b * a : a;",ON=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function sQ(n){const{inputs:e,backend:t}=n,{x:s,alpha:i}=e,o=ke().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new yd(ON,s.shape,i.shape):new Uc(DN,s.shape,i.shape);return t.runWebGLProgram(o,[s,i],"float32")}const iQ={kernelName:cc,backendName:"webgl",kernelFunc:sQ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const bd="if (isnan(x)) return x;";function nn({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:s}){return({inputs:i,backend:o})=>{const{x:c}=i,h=o,f=s||c.dtype;if(h.shouldExecuteOnCPU([c])&&t!=null){const I=h.texData.get(c.dataId),C=t(I.values,f);return h.makeTensorInfo(c.shape,f,C)}const g=ke().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let y;return g?y=new mu(c.shape,e):y=new bo(c.shape,n),h.runWebGLProgram(y,[c],f)}}function is({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:s=!1,cpuKernelImpl:i,dtype:o}){return({inputs:c,backend:h})=>{const{a:f,b:g}=c,y=h;if(s&&f.dtype==="complex64"){const N=y.texData.get(f.dataId),R=y.texData.get(g.dataId),[P,L]=[[N.complexTensorInfos.real,R.complexTensorInfos.real],[N.complexTensorInfos.imag,R.complexTensorInfos.imag]].map(W=>{const[z,X]=W,Q={dataId:z.dataId,dtype:z.dtype,shape:f.shape},J={dataId:X.dataId,dtype:X.dtype,shape:g.shape},te=new Uc(n,f.shape,g.shape);return y.runWebGLProgram(te,[Q,J],ai(z.dtype,X.dtype))}),F=gu({inputs:{real:P,imag:L},backend:y});return y.disposeIntermediateTensorInfo(P),y.disposeIntermediateTensorInfo(L),F}const I=o||ai(f.dtype,g.dtype);if((f.dtype==="string"||g.dtype==="string"||y.shouldExecuteOnCPU([f,g]))&&i!=null){const N=y.texData.get(f.dataId).values,R=y.texData.get(g.dataId).values,P=f.dtype==="string"?il(N):N,L=f.dtype==="string"?il(R):R,[F,W]=i(f.shape,g.shape,P,L,I),z=y.makeTensorInfo(W,I),X=y.texData.get(z.dataId);return X.values=F,z}const C=ke().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let k;return C?k=new yd(e,f.shape,g.shape,t):k=new Uc(n,f.shape,g.shape),y.runWebGLProgram(k,[f,g],I)}}function ip(n,e=!1){if(n==="linear")return e?BY:PY;if(n==="relu")return e?zY:GY;if(n==="elu")return e?WY:FY;if(n==="relu6")return e?XY:_Y;if(n==="prelu")return e?ON:DN;if(n==="leakyrelu")return e?LN:MN;if(n==="sigmoid")return e?ZY:VY;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class PN{constructor(e,t,s,i=!1,o=!1,c=!1,h=null,f=!1,g=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=fs(this.outputShape.length);const y=i?e[1]:e[2],I=Math.ceil(y/2),C=i?"i * 2, rc.y":"rc.y, i * 2",k=o?"rc.z, i * 2":"i * 2, rc.z",N=i?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],R=o?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let P="",L="";h&&(f?P=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${h}
        }`:g?P=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${h}
        }`:P=`vec4 activation(vec4 x) {
          ${h}
        }`,L="result = activation(result);");const F=c?"result += getBiasAtOutCoords();":"";c&&this.variableNames.push("bias"),f&&this.variableNames.push("preluActivationWeights"),g&&this.variableNames.push("leakyreluAlpha");let W="rc.x",z="rc.x";e[0]<t[0]?W=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(z=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${P}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${I}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${W};
        int batchB = ${z};
        for (int i = 0; i < ${I}; i++) {
          vec4 a = getMatrixA(batchA, ${C});
          vec4 b = getMatrixB(batchB, ${k});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${N[0]} * ${R[0]});
          result += (${N[1]} * ${R[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${F}

        ${L}

        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const FN={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class GN{constructor(e,t,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ft(t,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const _N="return a * b;";function Tb(n){const{inputs:e,backend:t}=n,{a:s,b:i}=e,o=ai(s.dtype,i.dtype);if(s.dtype==="complex64"){const h=t.texData.get(s.dataId),f=t.texData.get(i.dataId),g=new GN(FN.REAL,s.shape,i.shape),y=new GN(FN.IMAG,s.shape,i.shape),I=[{dataId:h.complexTensorInfos.real.dataId,dtype:h.complexTensorInfos.real.dtype,shape:s.shape},{dataId:h.complexTensorInfos.imag.dataId,dtype:h.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:f.complexTensorInfos.real.dataId,dtype:f.complexTensorInfos.real.dtype,shape:i.shape},{dataId:f.complexTensorInfos.imag.dataId,dtype:f.complexTensorInfos.imag.dtype,shape:i.shape}],C=t.runWebGLProgram(g,I,"float32"),k=t.runWebGLProgram(y,I,"float32"),N=gu({inputs:{real:C,imag:k},backend:t});return t.disposeIntermediateTensorInfo(C),t.disposeIntermediateTensorInfo(k),N}if(t.shouldExecuteOnCPU([s,i])){const h=t.texData.get(s.dataId),f=t.texData.get(i.dataId),[g,y]=sY(s.shape,i.shape,h.values,f.values,o),I=t.makeTensorInfo(y,o),C=t.texData.get(I.dataId);return C.values=g,I}let c;return ke().getBool("WEBGL_PACK_BINARY_OPERATIONS")?c=new yd(_N,s.shape,i.shape):c=new Uc(_N,s.shape,i.shape),t.runWebGLProgram(c,[s,i],o)}const aQ={kernelName:Vl,backendName:"webgl",kernelFunc:Tb};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function oQ(n,e,t){const s=[dd(n.shape),...fd(n.shape)],i={dtype:n.dtype,shape:s,dataId:n.dataId},o=[dd(e),...fd(e)],c=new kN(o,s),h=!0,f=[s],g=t.runWebGLProgram(c,[i],n.dtype,f,h);return{dataId:g.dataId,shape:e,dtype:g.dtype}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tt(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{shape:o}=s,c=t,h=H(i.shape),f=fe(o,h),g=H(f);D(h===g,()=>`The new shape (${f}) has ${g} elements and the old shape (${i.shape}) has ${h} elements. The new shape and old shape must have the same number of elements.`);const y=c.texData.get(i.dataId);return y.isPacked&&!R1(i.shape,f)&&!(y.texture!==null&&R1(y.shape,f))?oQ(i,f,c):(c.incRef(i.dataId),{dataId:i.dataId,shape:f,dtype:i.dtype})}const lQ={kernelName:Fh,backendName:"webgl",kernelFunc:tt};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class VN{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:i,inSize:o,outSize:c}=e;this.outputShape=[i,c];const h=Math.floor(s/4)*4,f=s%4;let g="sumValue += dot(values, ones);";if(t!=null){const I=1/t;g=`sumValue += dot(values * ${Ee(I)?I.toPrecision(2):I}, ones);`}let y="";o%s>0&&(y=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${y}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${h}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${g}
        }

        int inIdx = inOffset + ${h};
        if (${f===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${g}
        } else if (${f===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${g}
        } else if (${f===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${g}
        }
        setOutput(sumValue);
      }
    `}}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class uQ{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:i,inSize:o,outSize:c}=e;this.outputShape=[i,c];let h="0.0",f="";t==="prod"?h="1.0":t==="min"?(h="1.0 / 1e-20",f="min"):t==="max"&&(h="-1.0 / 1e-20",f="max");let g=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?g="sumValue":t==="prod"?g="prodValue":t==="all"?g="allValue":t==="any"&&(g="anyValue");const y=Math.floor(s/4)*4,I=s%4;let C=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${f}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${f}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,k="vec4";t==="all"?(h="1.0",C=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,k="bvec4"):t==="any"&&(h="0.0",C=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,k="bvec4");let N="";o%s>0&&(N=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${h};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${N}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${h});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${y}; i += 4) {
          int inIdx = inOffset + i;
          ${k} values = ${k}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${C}
        }

        int inIdx = inOffset + ${y};
        if (${I===1}) {
          ${k} values = ${k}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${C}
        } else if (${I===2}) {
          ${k} values = ${k}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${C}
        } else if (${I===3}) {
          ${k} values = ${k}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${C}
        }
        setOutput(${g});
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cQ(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],s=K0(t);e.push({inSize:t,windowSize:s,outSize:Math.ceil(t/s)})}return e}function jc(n,e,t,s){const i=cQ(n.shape);let o=n;for(let c=0;c<i.length;c++){const{inSize:h,windowSize:f,outSize:g}=i[c];let y,I;t==="mean"?y=c===0?new VN({windowSize:f,inSize:h,batchSize:n.shape[0],outSize:g},h):new VN({windowSize:f,inSize:h,batchSize:n.shape[0],outSize:g}):y=new uQ({windowSize:f,inSize:h,batchSize:n.shape[0],outSize:g},t),I=o,o=s.runWebGLProgram(y,[o],e),I.dataId!==n.dataId&&s.disposeIntermediateTensorInfo(I)}return o}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class hQ{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let c=0;c<s.length;c++)s[c]=e[t[c]];this.outputShape=s,this.rank=s.length;const i=wn(this.rank),o=dQ(t);this.userCode=`
    void main() {
      ${i} resRC = getOutputCoords();
      setOutput(getA(${o}));
    }
    `}}function dQ(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let i=0;i<n.length;i++)s[n[i]]=t[i];return s.join()}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class fQ{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let y=0;y<s.length;y++)s[y]=e[t[y]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const i=wn(this.rank),o=TN("rc",this.rank),c=new Array(this.rank);for(let y=0;y<t.length;y++)c[t[y]]=o[y];const h=`vec2(${c.slice(-2).join()})`,f=`++${o[this.rank-1]} < ${s[this.rank-1]}`,g=`getChannel(getA(${c.join()}), ${h})`;this.userCode=`
    void main() {
      ${i} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${g};
      if(${f}) {
        result[1] = ${g};
      }
      --${o[this.rank-1]};
      if(++${o[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${g};
        if(${f}) {
          result[3] = ${g};
        }
      }
      setOutput(result);
    }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function D1(n,e,t){const s=ke().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new fQ(n.shape,e):new hQ(n.shape,e);return t.runWebGLProgram(s,[n],n.dtype)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function pQ(n,e,t,s){const i=e,o=n.shape.length,c=be(i,n.shape);let h=c;const f=er(h,o),g=f!=null;let y=n;g&&(y=D1(n,f,s),h=gr(h.length,o)),rs("sum",h,o);const[I,C]=Xr(y.shape,h);let k=I;t&&(k=kr(I,c));const N=H(C),R=H(n.shape)/N,P=tt({inputs:{x:y},attrs:{shape:[R,N]},backend:s}),L=qg(n.dtype),F=jc(P,L,"sum",s),W=tt({inputs:{x:F},attrs:{shape:k},backend:s});return s.disposeIntermediateTensorInfo(P),s.disposeIntermediateTensorInfo(F),g&&s.disposeIntermediateTensorInfo(y),W}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function O1(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{axis:o,keepDims:c}=s;return pQ(i,o,c,t)}const mQ={kernelName:dc,backendName:"webgl",kernelFunc:O1};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ms(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{perm:o}=s,c=t,h=i.shape.length,f=new Array(h);for(let y=0;y<f.length;y++)f[y]=i.shape[o[y]];let g;if(c.shouldExecuteOnCPU([i])){const y=c.texData.get(i.dataId).values,I=Ib(y,i.shape,i.dtype,o,f);g=c.makeTensorInfo(f,i.dtype);const C=c.texData.get(g.dataId);C.values=I}else g=D1(i,o,c);return g}const gQ={kernelName:K,backendName:"webgl",kernelFunc:Ms};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const BN=1e3;function P1({a:n,b:e,transposeA:t,transposeB:s,backend:i,bias:o=null,preluActivationWeights:c=null,leakyreluAlpha:h=0,activation:f=null}){const g=n.shape.length,y=e.shape.length,I=t?n.shape[g-2]:n.shape[g-1],C=s?e.shape[y-1]:e.shape[y-2],k=t?n.shape[g-1]:n.shape[g-2],N=s?e.shape[y-2]:e.shape[y-1],R=n.shape.slice(0,-2),P=e.shape.slice(0,-2),L=H(R),F=H(P),W=Ft(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([k,N]);D(I===C,()=>`Error in matMul: inner shapes (${I}) and (${C}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${s} must match.`);const z=t?[L,I,k]:[L,k,I],X=s?[F,N,C]:[F,C,N],Q=tt({inputs:{x:n},backend:i,attrs:{shape:z}}),J=tt({inputs:{x:e},backend:i,attrs:{shape:X}}),te=[Q,J],ie=Math.max(L,F),oe=t?Q.shape[1]:Q.shape[2],Ce=o!=null,Se=c!=null,Te=f==="leakyrelu",Le=f!=null?ip(f,!0):null,Me=Ce||Se||Te||Le!=null;let Oe;if((k===1||N===1)&&oe>BN&&Me===!1){let _e=Q,Be=J;t&&(_e=Ms({inputs:{x:Q},backend:i,attrs:{perm:[0,2,1]}}),te.push(_e)),s&&(Be=Ms({inputs:{x:J},backend:i,attrs:{perm:[0,2,1]}}),te.push(Be));const He=N!==1,$e=N===1;let Qe=_e;He&&(Qe=tt({inputs:{x:_e},backend:i,attrs:{shape:[ie,oe,1]}}),te.push(Qe));const qe=N===1?2:1;let nt=Be;$e&&(nt=tt({inputs:{x:Be},backend:i,attrs:{shape:[ie,1,oe]}}),te.push(nt));const st=Tb({inputs:{a:Qe,b:nt},backend:i});Oe=O1({inputs:{x:st},backend:i,attrs:{axis:qe,keepDims:!0}}),te.push(st)}else{const _e=ai(n.dtype,e.dtype),Be=new PN(z,X,[ie,k,N],t,s,Ce,Le,Se,Te),He=[Q,J];if(o!=null&&He.push(o),Se&&He.push(c),Te){const $e=i.makeTensorInfo([],"float32",Hl(h,"float32"));He.push($e),te.push($e)}Oe=i.runWebGLProgram(Be,He,_e)}const Ve=tt({inputs:{x:Oe},backend:i,attrs:{shape:W}});te.push(Oe);for(const _e of te)i.disposeIntermediateTensorInfo(_e);return Ve}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xQ(n){const{inputs:e,backend:t,attrs:s}=n,{a:i,b:o,bias:c,preluActivationWeights:h}=e,{transposeA:f,transposeB:g,activation:y,leakyreluAlpha:I}=s;return P1({a:i,b:o,transposeA:f,transposeB:g,backend:t,bias:c,preluActivationWeights:h,leakyreluAlpha:I,activation:y})}const yQ={kernelName:A,backendName:"webgl",kernelFunc:xQ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const WN="return abs(x);";function bQ(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const o=t.texData.get(s.dataId),c=CN(o.values);return t.makeTensorInfo(s.shape,s.dtype,c)}let i;return ke().getBool("WEBGL_PACK_UNARY_OPERATIONS")?i=new mu(s.shape,WN):i=new bo(s.shape,WN),t.runWebGLProgram(i,[s],s.dtype)}const wQ={kernelName:Qu,backendName:"webgl",kernelFunc:bQ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const vQ=la+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,IQ=nn({opSnippet:vQ}),CQ={kernelName:_s,backendName:"webgl",kernelFunc:IQ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const SQ=la+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,TQ=nn({opSnippet:SQ}),kQ={kernelName:Fo,backendName:"webgl",kernelFunc:TQ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const zN="return a + b;",EQ=is({opSnippet:zN,packedOpSnippet:zN,supportsComplex:!0,cpuKernelImpl:Gj}),NQ={kernelName:Yr,backendName:"webgl",kernelFunc:EQ};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class AQ{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((o,c)=>`T${c}`);const s=[];this.variableNames.forEach(o=>{s.push(`float v${o} = get${o}AtOutCoords();`)});const i=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${i};
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class RQ{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((o,c)=>`T${c}`);const s=[];this.variableNames.forEach(o=>{s.push(`vec4 v${o} = get${o}AtOutCoords();`)});const i=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${i};
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function F1(n){const{inputs:e,backend:t}=n,s=e;if(s.length===1)return ci({inputs:{x:s[0]},backend:t});if(s.length>ke().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const h=Math.floor(s.length/2),f=F1({inputs:s.slice(0,h),backend:t}),g=F1({inputs:s.slice(h),backend:t});return F1({inputs:[f,g],backend:t})}const i=s.map(h=>h.dtype).reduce((h,f)=>ai(h,f)),o=s.map(h=>h.shape),c=ke().getBool("WEBGL_PACK")?new RQ(s[0].shape,o):new AQ(s[0].shape,o);return t.runWebGLProgram(c,s,i)}const MQ={kernelName:vh,backendName:"webgl",kernelFunc:F1};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function LQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{axis:o,keepDims:c}=s,h=i.shape.length,f=be(o,i.shape);let g=f;const y=er(g,h);let I=i;y!=null&&(I=Ms({inputs:{x:i},backend:t,attrs:{perm:y}}),g=gr(g.length,h)),rs("all",g,h);const[C,k]=Xr(I.shape,g),N=H(k),R=tt({inputs:{x:I},backend:t,attrs:{shape:[-1,N]}}),P=jc(R,R.dtype,"all",t);let L;if(c){const F=kr(C,f);L=tt({inputs:{x:P},backend:t,attrs:{shape:F}})}else L=tt({inputs:{x:P},backend:t,attrs:{shape:C}});return t.disposeIntermediateTensorInfo(R),t.disposeIntermediateTensorInfo(P),y!=null&&t.disposeIntermediateTensorInfo(I),L}const DQ={kernelName:zi,backendName:"webgl",kernelFunc:LQ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function OQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{axis:o,keepDims:c}=s,h=i.shape.length,f=be(o,i.shape);let g=f;const y=er(g,h);let I=i;y!=null&&(I=Ms({inputs:{x:i},backend:t,attrs:{perm:y}}),g=gr(g.length,h)),rs("any",g,h);const[C,k]=Xr(I.shape,g),N=H(k),R=tt({inputs:{x:I},backend:t,attrs:{shape:[-1,N]}}),P=jc(R,R.dtype,"any",t);let L;if(c){const F=kr(C,f);L=tt({inputs:{x:P},backend:t,attrs:{shape:F}})}else L=tt({inputs:{x:P},backend:t,attrs:{shape:C}});return t.disposeIntermediateTensorInfo(R),t.disposeIntermediateTensorInfo(P),y!=null&&t.disposeIntermediateTensorInfo(I),L}const PQ={kernelName:Br,backendName:"webgl",kernelFunc:OQ};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class FQ{constructor(e,t,s){this.variableNames=["A"];const{windowSize:i,batchSize:o,outSize:c}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[o,c];const h=t==="max"?">":"<",f=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${i};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${i}; i++) {
          int inIdx = ${f};
          float candidate = getA(batch, inIdx);
          if (candidate ${h} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class GQ{constructor(e,t,s,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,D(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const o=e[e.length-1],c=Math.ceil(o/t);this.outputShape=e.slice(0,-1),c>1&&this.outputShape.push(c),i||this.variableNames.push("bestIndicesA");const h=this.outputShape,f=h.length,g=wn(f),y=Rs("coords",f);let I,C;if(c===1){C=f+1;const te=wn(C);I=`
        ${te} sourceLocR = ${te}(${y.join()}, 0);
        ++${y[f-1]};
        ${te} sourceLocG = ${te}(${y.join()}, 0);
        ++${y[f-2]};
        ${te} sourceLocA = ${te}(${y.join()}, 0);
        --${y[f-1]};
        ${te} sourceLocB = ${te}(${y.join()}, 0);
        --${y[f-2]};`}else C=f,I=`
        ${g} sourceLocR = coords;
        ++${y[f-1]};
        ${g} sourceLocG = coords;
        ++${y[f-2]};
        ${g} sourceLocA = coords;
        --${y[f-1]};
        ${g} sourceLocB = coords;
        --${y[f-2]};`;const k=["x","y","z","w","u","v"].slice(0,C),N="."+k[C-1],R=k.map(te=>"int "+te),P=Rs("sourceLocR",C-1).concat("inIdx.r"),L=Rs("sourceLocG",C-1).concat("inIdx.g"),F=Rs("sourceLocB",C-1).concat("inIdx.b"),W=Rs("sourceLocA",C-1).concat("inIdx.a"),z=s==="max"?"greaterThan":"lessThan",X=i?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${P.join()}),
                             getBestIndicesAChannel(${L.join()}),
                             getBestIndicesAChannel(${F.join()}),
                             getBestIndicesAChannel(${W.join()})));`,Q=`vec4(
            getAChannel(${P.join()}),
            hasNextCol ? getAChannel(${L.join()}) : 0.,
            hasNextRow ? getAChannel(${F.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${W.join()}) : 0.)`,J=i?"":`
      float getBestIndicesAChannel(${R.join()}) {
        return getChannel(getBestIndicesA(${k.join()}),
                                          vec2(${k.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${R.join()}) {
        return getChannel(getA(${k.join()}),
                               vec2(${k.slice(-2).join()}));
      }
      ${J}
      void main() {
        ${g} coords = getOutputCoords();
        bool hasNextCol = ${y[f-1]} < ${h[f-1]-1};
        bool hasNextRow = ${y[f-2]} < ${h[f-2]-1};
        ${I}
        ivec4 srcIdx = ivec4(sourceLocR${N}, sourceLocG${N},
          sourceLocB${N}, sourceLocA${N}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${Q};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${X}
          vec4 candidate = ${Q};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${z}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function XN(n,e,t,s=null){let i=e.shape[0],o=e.shape[1];s!=null&&(i=s.shape[0],o=s.shape[1]);const c=K0(o),h={windowSize:c,inSize:o,batchSize:i,outSize:Math.ceil(o/c)},f=new FQ(h,t,s==null),g=[e];s!=null&&g.push(s);const y=n.runWebGLProgram(f,g,"int32");if(y.shape[1]===1)return y;const I=XN(n,e,t,y);return n.disposeIntermediateTensorInfo(y),I}function ZN(n,e,t,s=null){const i=s!=null?s.shape:e.shape,o=i[i.length-1],c=K0(o),h=new GQ(i,c,t,s==null),f=s==null?[e]:[e,s],g=n.runWebGLProgram(h,f,"int32");if(g.shape.length===e.shape.length){const y=ZN(n,e,t,g);return n.disposeIntermediateTensorInfo(g),y}return g}function KN(n,e,t,s){const i=[t];if(rs("arg"+s.charAt(0).toUpperCase()+s.slice(1),i,e.shape.length),!ke().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const o=[],c=n.texData.get(e.dataId),h=c!==null&&c.isPacked;let f=e;h&&(f=n.unpackTensor(e),o.push(f));const[g,y]=Xr(f.shape,i),I=H(y),C=tt({inputs:{x:f},backend:n,attrs:{shape:[-1,I]}});o.push(C);const k=XN(n,C,s);o.push(k);const N=tt({inputs:{x:k},backend:n,attrs:{shape:g}});return o.forEach(R=>n.disposeIntermediateTensorInfo(R)),N}return ZN(n,e,s)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _Q(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{axis:o}=s;let c=be(o,i.shape);const h=er(c,i.shape.length);let f=i;const g=[];h!=null&&(f=Ms({inputs:{x:i},backend:t,attrs:{perm:h}}),g.push(f),c=gr(c.length,f.shape.length)),rs("argMax",[c[0]],f.shape.length);const y=KN(t,f,c[0],"max");return g.forEach(I=>t.disposeIntermediateTensorInfo(I)),y}const VQ={kernelName:Ju,backendName:"webgl",kernelFunc:_Q};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function BQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{axis:o}=s;let c=be(o,i.shape);const h=er(c,i.shape.length);let f=i;const g=[];h!=null&&(f=Ms({inputs:{x:i},backend:t,attrs:{perm:h}}),g.push(f),c=gr(c.length,f.shape.length)),rs("argMin",[c[0]],f.shape.length);const y=KN(t,f,c[0],"min");return g.forEach(I=>t.disposeIntermediateTensorInfo(I)),y}const WQ={kernelName:Go,backendName:"webgl",kernelFunc:BQ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const zQ=la+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,XQ=nn({opSnippet:zQ}),ZQ={kernelName:qu,backendName:"webgl",kernelFunc:XQ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const KQ=la+"return log(x + sqrt(x * x + 1.0));",$Q=nn({opSnippet:KQ}),UQ={kernelName:_n,backendName:"webgl",kernelFunc:$Q};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const HQ=la+`
  return atan(x);
`,jQ=nn({opSnippet:HQ}),YQ={kernelName:et,backendName:"webgl",kernelFunc:jQ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const QQ=Sb+`
  return atan(a, b);
`,JQ=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Hc+`
  return result;
`,qQ=is({opSnippet:QQ,packedOpSnippet:JQ}),eJ={kernelName:on,backendName:"webgl",kernelFunc:qQ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const tJ=la+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,nJ=nn({opSnippet:tJ}),rJ={kernelName:Un,backendName:"webgl",kernelFunc:nJ};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class ap{constructor(e,t,s,i=!1,o=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const c=e.filterWidth,h=e.strideHeight,f=e.strideWidth,g=e.dilationHeight,y=e.dilationWidth,I=e.effectiveFilterHeight,C=e.effectiveFilterWidth,k=e.padInfo.top,N=e.padInfo.left;this.outputShape=e.outShape;const R=t==="avg",P=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,L=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let F="0.0";if(R||(F="-1.0 / 1e-20"),s){const te=">=";this.userCode=`
        const ivec2 strides = ivec2(${h}, ${f});
        const ivec2 pads = ivec2(${k}, ${N});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${I};
              wR += ${g}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${C};
                wC += ${y}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${te} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${i?o?P:L:`wR * ${C} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const W="max";let z=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(z="avgValue / max(count, 1.0)");const X=Math.floor(c/4)*4,Q=c%4,J=`
      if (${R}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${W}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${h}, ${f});
      const ivec2 pads = ivec2(${k}, ${N});
      const float initializationValue = ${F};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${F});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${I};
            wR += ${g}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${X}; wC += 4) {
            int xC = xCCorner + wC * ${y};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${y}, d),
              getValue(batch, xR, xC + 2 * ${y}, d),
              getValue(batch, xR, xC + 3 * ${y}, d)
            );

            ${J}
          }

          int xC = xCCorner + ${X};
          if (${Q===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${J}
          } else if (${Q===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${y}, d),
              initializationValue,
              initializationValue
            );

            ${J}
          } else if (${Q===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${y}, d),
              getValue(batch, xR, xC + 2 * ${y}, d),
              initializationValue
            );

            ${J}
          }
        }
        setOutput(${z});
      }
    `}}class kb{constructor(e,t,s,i=!1,o=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const c=e.filterWidth,h=e.strideDepth,f=e.strideHeight,g=e.strideWidth,y=e.dilationDepth,I=e.dilationHeight,C=e.dilationWidth,k=e.effectiveFilterDepth,N=e.effectiveFilterHeight,R=e.effectiveFilterWidth,P=e.padInfo.front,L=e.padInfo.top,F=e.padInfo.left;this.outputShape=e.outShape;const W=t==="avg";let z="0.0";if(W||(z="-1.0 / 1e-20"),s){const oe=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${h}, ${f}, ${g});
        const ivec3 pads = ivec3(${P}, ${L}, ${F});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${k};
              wD += ${y}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${N};
                wR += ${I}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${R};
                  wC += ${C}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${oe} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${i?o?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${N} * ${R} +
                      wR * ${R} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const X="max";let Q=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(Q="avgValue / max(count, 1.0)");const J=Math.floor(c/4)*4,te=c%4,ie=`
      if (${W}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${X}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${h}, ${f}, ${g});
      const ivec3 pads = ivec3(${P}, ${L}, ${F});
      const float initializationValue = ${z};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${z});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${k};
            wD += ${y}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${N};
            wR += ${I}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${J}; wC += 4) {
              int xC = xCCorner + wC * ${C};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${C}, ch),
                getValue(batch, xD, xR, xC + 2 * ${C}, ch),
                getValue(batch, xD, xR, xC + 3 * ${C}, ch)
              );

              ${ie}
            }

            int xC = xCCorner + ${J};
            if (${te===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${ie}
            } else if (${te===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${C}, ch),
                initializationValue,
                initializationValue
              );

              ${ie}
            } else if (${te===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${C}, ch),
                getValue(batch, xD, xR, xC + 2 * ${C}, ch),
                initializationValue
              );

              ${ie}
            }
          }
        }
        setOutput(${Q});
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sJ(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e;rp(i,"avgPool");const{filterSize:o,strides:c,pad:h,dimRoundingMode:f}=s,g=1;D(ds(c,g),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${c} and dilations '${g}'`);const y=qi(i.shape,o,c,g,h,f);if(y.filterWidth===1&&y.filterHeight===1&&se(y.inShape,y.outShape))return ci({inputs:{x:i},backend:t});const I=new ap(y,"avg",!1);return t.runWebGLProgram(I,[i],"float32")}const iJ={kernelName:Nn,backendName:"webgl",kernelFunc:sJ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function aJ(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{filterSize:o,strides:c,pad:h,dimRoundingMode:f,dataFormat:g}=s,y=[1,1,1],I=el(i.shape,o,c,y,h,f,g),C=new kb(I,"avg",!1);return t.runWebGLProgram(C,[i],"float32")}const oJ={kernelName:Rl,backendName:"webgl",kernelFunc:aJ};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class lJ{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,i=e.strideHeight,o=e.strideWidth,c=e.dilationHeight,h=e.dilationWidth,f=e.effectiveFilterHeight,g=e.effectiveFilterWidth,y=f-1-e.padInfo.top,I=g-1-e.padInfo.left,C=1/(t*s);this.userCode=`
      const ivec2 pads = ivec2(${y}, ${I});
      const float avgMultiplier = float(${C});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${f};
            wR += ${c}) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${g};
            wC+= ${h}) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class uJ{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,i=e.filterWidth,o=e.strideDepth,c=e.strideHeight,h=e.strideWidth,f=e.dilationDepth,g=e.dilationHeight,y=e.dilationWidth,I=e.effectiveFilterDepth,C=e.effectiveFilterHeight,k=e.effectiveFilterWidth,N=I-1-e.padInfo.front,R=C-1-e.padInfo.top,P=k-1-e.padInfo.left,L=1/(t*s*i);this.userCode=`
      const ivec3 pads = ivec3(${N}, ${R}, ${P});
      const float avgMultiplier = float(${L});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${I};
            wD += ${f}) {
          float dyD = float(dyDCorner + wD) / ${o}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${C};
              wR += ${g}) {
            float dyR = float(dyRCorner + wR) / ${c}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${k};
                wC += ${y}) {
              float dyC = float(dyCCorner + wC) / ${h}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cJ(n){const{inputs:e,backend:t,attrs:s}=n,{dy:i,input:o}=e,c=o,{filterSize:h,strides:f,pad:g,dimRoundingMode:y}=s,I=[1,1,1],C=el(c.shape,h,f,I,g,y),k=new uJ(C);return t.runWebGLProgram(k,[i],c.dtype)}const hJ={kernelName:Ih,backendName:"webgl",kernelFunc:cJ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function dJ(n){const{inputs:e,backend:t,attrs:s}=n,{dy:i,input:o}=e,c=o;rp([i,o],"avgPoolGrad");const{filterSize:h,strides:f,pad:g}=s,y=qi(c.shape,h,f,1,g),I=new lJ(y);return t.runWebGLProgram(I,[i],c.dtype)}const fJ={kernelName:_o,backendName:"webgl",kernelFunc:dJ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function pJ(n){const{inputs:e,backend:t,attrs:s}=n,{a:i,b:o}=e,{transposeA:c,transposeB:h}=s;return P1({a:i,b:o,transposeA:c,transposeB:h,backend:t})}const mJ={kernelName:Qt,backendName:"webgl",kernelFunc:pJ};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class gJ{constructor(e,t,s,i,o,c){this.outputShape=[],this.variableNames=["x","mean","variance"],Ft(e,t),Ft(e,s);let h="0.0";i!=null&&(Ft(e,i),this.variableNames.push("offset"),h="getOffsetAtOutCoords()");let f="1.0";o!=null&&(Ft(e,o),this.variableNames.push("scale"),f="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${h};
        float scale = ${f};
        float inv = scale * inversesqrt(variance + float(${c}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class xJ{constructor(e,t,s,i,o,c){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ft(e,t),Ft(e,s);let h="vec4(0.0)";i!=null&&(Ft(e,i),this.variableNames.push("offset"),h="getOffsetAtOutCoords()");let f="vec4(1.0)";o!=null&&(Ft(e,o),this.variableNames.push("scale"),f="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${h};
        vec4 scale = ${f};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${c}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const yJ={kernelName:xi,backendName:"webgl",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,mean:i,variance:o,offset:c,scale:h}=n;D(i.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),D(c==null||i.shape.length===c.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),D(h==null||i.shape.length===h.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:f}=t;f==null&&(f=.001);const g=[s,i,o];let y=null;c!=null&&(y=c.shape,g.push(c));let I=null;h!=null&&(I=h.shape,g.push(h));const C=ke().getBool("WEBGL_PACK_NORMALIZATION")?new xJ(s.shape,i.shape,o.shape,y,I,f):new gJ(s.shape,i.shape,o.shape,y,I,f);return e.runWebGLProgram(C,g,g[0].dtype)}};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class bJ{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=wn(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=wJ(this.rank);let i;const o=e.map((c,h)=>`sourceLoc.${Eb[h]} = start[${h}] + coords.${Eb[h]};`);i=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${o.join(`
`)}
      `,this.userCode=`
      void main() {
        ${i}
        setOutput(getSource(${s}));
      }
    `}}const Eb=["x","y","z","w","u","v"];function wJ(n){if(n===1)return"sourceLoc";if(n<=6)return Eb.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class vJ{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=wn(this.rank),s=Rs("coords",this.rank),i=Rs("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":`vec2(${i.slice(-2).join()})`,c=`getChannel(getSource(${i.join()}), ${o})`,h=`
      result.x = ${c};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${i[this.rank-1]};
        result.y = ${c};
        --${i[this.rank-1]};
      }
    `,f=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${i[this.rank-2]};
        result.z = ${c};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${i[this.rank-1]};
          result.w = ${c};
        }
      }
    `,g=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((y,I)=>`start[${I}]`).join()});`:e.map((y,I)=>`${i[I]} = ${s[I]} + start[${I}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${g}
        vec4 result = vec4(0.);
        ${h}
        ${f}
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function IJ(n,e,t,s){const i=s.texData.get(n.dataId),o=s.makeTensorInfo(t,n.dtype),c=s.texData.get(o.dataId);Object.assign(c,i),c.refCount=1,c.shape=t,c.dtype=n.dtype;let h=Hx(e,We(n.shape));i.slice&&(h+=i.slice.flatOffset),c.slice={flatOffset:h,origDataId:i.slice&&i.slice.origDataId||n.dataId};const f=s.dataRefCount.get(c.slice.origDataId)||1;return s.dataRefCount.set(c.slice.origDataId,f+1),o}function wd(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{begin:o,size:c}=s,[h,f]=X0(i,o,c);if(Kx(i,h,f),H(f)===0)return t.makeTensorInfo(f,i.dtype,[]);if(t.shouldExecuteOnCPU([i])||i.dtype==="string"){const I=t.texData.get(i.dataId),C=mY(I.values,h,f,i.shape,i.dtype);return t.makeTensorInfo(f,i.dtype,C)}const{isPacked:g}=t.texData.get(i.dataId),y=Ux(i.shape,h,f);if(g||!y){const I=ke().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new vJ(f):new bJ(f),C=[h];return t.runWebGLProgram(I,[i],i.dtype,C)}return t.uploadToGPU(i.dataId),IJ(i,h,f,t)}const CJ={kernelName:Ia,backendName:"webgl",kernelFunc:wd};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const SJ={kernelName:Xi,backendName:"webgl",kernelFunc:n=>{const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{blockShape:o,crops:c}=s;D(i.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const h=o.reduce((F,W)=>F*W),f=Df(i.shape,o,h),g=Of(f.length,o.length),y=Pf(i.shape,o,h),I=qx(c,o.length),C=ey(y,c,o.length),k=[],N=tt({inputs:{x:i},backend:t,attrs:{shape:f}}),R=Ms({inputs:{x:N},backend:t,attrs:{perm:g}}),P=tt({inputs:{x:R},backend:t,attrs:{shape:y}}),L=wd({inputs:{x:P},backend:t,attrs:{begin:I,size:C}});return k.push(N),k.push(R),k.push(P),k.forEach(F=>t.disposeIntermediateTensorInfo(F)),L}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function TJ(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,weights:o}=e,{size:c}=s,h=t.readSync(i.dataId),f=t.readSync(o.dataId),g=IN(h,f,o.dtype,o.shape,c);return t.makeTensorInfo([c],o.dtype,g)}const kJ={kernelName:Ch,backendName:"webgl",kernelFunc:TJ};/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const EJ=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,NJ=`
  return float(int(a.r) & int(b.r));
`;function AJ(n){const{inputs:e,backend:t}=n,{a:s,b:i}=e,o=ke().getBool("WEBGL_PACK_BINARY_OPERATIONS"),c=ke().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([s,i])||c===1){const f=t.texData.get(s.dataId).values,g=t.texData.get(i.dataId).values,[y,I]=Vj(s.shape,i.shape,f,g,s.dtype),C=t.makeTensorInfo(I,s.dtype),k=t.texData.get(C.dataId);return k.values=y,C}let h;return o?h=new yd(EJ,s.shape,i.shape,!1):h=new Uc(NJ,s.shape,i.shape),t.runWebGLProgram(h,[s,i],s.dtype)}const RJ={kernelName:Sh,backendName:"webgl",kernelFunc:AJ};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function MJ(n){const{inputs:e,backend:t}=n,{s0:s,s1:i}=e,o=t.readSync(s.dataId),c=t.readSync(i.dataId),h=Ft(Array.from(o),Array.from(c));return t.makeTensorInfo([h.length],"int32",Int32Array.from(h))}const LJ={kernelName:Th,backendName:"webgl",kernelFunc:MJ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const $N=is({opSnippet:"return float(a != b);",cpuKernelImpl:aY,dtype:"bool"}),DJ={kernelName:no,backendName:"webgl",kernelFunc:$N};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function op(n){const{inputs:e,backend:t}=n,{input:s}=e,i=t.texData.get(s.dataId);return ci({inputs:{x:i.complexTensorInfos.real},backend:t})}const OJ={kernelName:Tr,backendName:"webgl",kernelFunc:op};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const PJ="return float(int(x));";function FJ(n,e){const t=new bo(n.shape,PJ),s=e.runWebGLProgram(t,[n],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Nb(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{dtype:o}=s;if(o==="complex64"){if(i.dtype==="complex64")return ci({inputs:{x:i},backend:t});const c=Zr(i.shape),h=Nb({inputs:{x:i},backend:t,attrs:{dtype:"float32"}}),f=gu({inputs:{real:h,imag:c},backend:t});return c.dispose(),t.disposeIntermediateTensorInfo(h),f}if(i.dtype==="complex64"){const c=op({inputs:{input:i},backend:t}),h=Nb({inputs:{x:c},backend:t,attrs:{dtype:o}});return t.disposeIntermediateTensorInfo(c),h}if(!Bt(i.dtype,o)){const c=ci({inputs:{x:i},backend:t});return{dataId:c.dataId,shape:c.shape,dtype:o}}if(t.shouldExecuteOnCPU([i])){const c=t.texData.get(i.dataId).values,[h,f,g]=Bj(c,i.shape,i.dtype,o);return t.makeTensorInfo(h,f,g)}if(o==="int32")return FJ(i,t);if(o==="bool"){const c=t.makeTensorInfo([],"bool",ue("bool",1)),h=$N({inputs:{a:i,b:c},backend:t});return t.disposeIntermediateTensorInfo(c),h}throw new Error(`Error in Cast: failed to cast ${i.dtype} to ${o}`)}const GJ={kernelName:dr,backendName:"webgl",kernelFunc:Nb};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const UN="return ceil(x);",_J=nn({opSnippet:UN,packedOpSnippet:UN,cpuKernelImpl:Wj}),VJ={kernelName:Zi,backendName:"webgl",kernelFunc:_J};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class BJ{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class WJ{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function zJ(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{clipValueMin:o,clipValueMax:c}=s;let h;ke().getBool("WEBGL_PACK_CLIP")?h=new WJ(i.shape):h=new BJ(i.shape);const f=[[o],[c]];return t.runWebGLProgram(h,[i],i.dtype,f)}const XJ={kernelName:Qa,backendName:"webgl",kernelFunc:zJ};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class ZJ{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function HN(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function KJ(n){const{inputs:e,backend:t}=n,{x:s}=e,i=t.texData.get(s.dataId),o=new ZJ(s.shape),c=[HN(s,i.complexTensorInfos.real),HN(s,i.complexTensorInfos.imag)];return t.runWebGLProgram(o,c,c[0].dtype)}const $J={kernelName:kh,backendName:"webgl",kernelFunc:KJ};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class UJ{constructor(e){this.outputShape=[],this.outputShape=co(e,1),this.variableNames=e.map((c,h)=>`T${h}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let c=1;c<t.length;c++)t[c]=t[c-1]+e[c][1];const s=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let c=1;c<t.length;c++){const h=t[c-1];s.push(`else if (yC < ${t[c]}) setOutput(getT${c}(yR, yC-${h}));`)}const i=t.length,o=t[t.length-1];s.push(`else setOutput(getT${i}(yR, yC-${o}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class HJ{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=co(e,t);const s=this.outputShape,i=s.length,o=wn(i),c=Rs("coords",i),h=["x","y","z","w","u","v"].slice(0,i);this.variableNames=e.map((R,P)=>`T${P}`);const f=new Array(e.length-1);f[0]=e[0][t];for(let R=1;R<f.length;R++)f[R]=f[R-1]+e[R][t];const g=h[t],y=h.slice(-2),I=h.join();let C=`if (${g} < ${f[0]}) {
        return getChannel(
            getT0(${I}), vec2(${y.join()}));
        }`;for(let R=1;R<f.length;R++){const P=f[R-1];C+=`
        if (${g} < ${f[R]}  && ${g} >= ${f[R-1]}) {
          return getChannel(
            getT${R}(${G1(h,g,P)}),
            vec2(${G1(y,g,P)}));
        }`}const k=f.length,N=f[f.length-1];C+=`
        return getChannel(
          getT${k}(${G1(h,g,N)}),
          vec2(${G1(y,g,N)}));`,this.userCode=`
      float getValue(${h.map(R=>"int "+R)}) {
        ${C}
      }

      void main() {
        ${o} coords = getOutputCoords();
        vec4 result = vec4(getValue(${c}), 0., 0., 0.);

        ${c[i-1]} = ${c[i-1]} + 1;
        if (${c[i-1]} < ${s[i-1]}) {
          result.g = getValue(${c});
        }

        ${c[i-2]} = ${c[i-2]} + 1;
        if (${c[i-2]} < ${s[i-2]}) {
          result.a = getValue(${c});
        }

        ${c[i-1]} = ${c[i-1]} - 1;
        if (${c[i-2]} < ${s[i-2]} &&
            ${c[i-1]} < ${s[i-1]}) {
          result.b = getValue(${c});
        }
        setOutput(result);
      }
    `}}function G1(n,e,t){const s=n.indexOf(e);return n.map((i,o)=>o===s?`${i} - ${t}`:i).join()}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _1(n){const{inputs:e,backend:t}=n,{input:s}=e,i=t.texData.get(s.dataId);return ci({inputs:{x:i.complexTensorInfos.imag},backend:t})}const jJ={kernelName:bt,backendName:"webgl",kernelFunc:_1};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function lp(n,e,t){const s=n[0].dtype;if(s==="complex64"){const k=n.map(F=>op({inputs:{input:F},backend:t})),N=n.map(F=>_1({inputs:{input:F},backend:t})),R=lp(k,e,t),P=lp(N,e,t),L=gu({inputs:{real:R,imag:P},backend:t});return k.forEach(F=>t.disposeIntermediateTensorInfo(F)),N.forEach(F=>t.disposeIntermediateTensorInfo(F)),t.disposeIntermediateTensorInfo(R),t.disposeIntermediateTensorInfo(P),L}let i=t.shouldExecuteOnCPU(n);if(s==="string"&&(i=!0),i){const k=n.map(z=>{const X=[-1,H(z.shape.slice(e))];return tt({inputs:{x:z},backend:t,attrs:{shape:X}})}),N=k.map(z=>({vals:t.readSync(z.dataId),shape:z.shape})),R=co(k.map(z=>z.shape),1),P=k[0].shape[0]===1,L=zj(N,R,s,P),F=co(n.map(z=>z.shape),e),W=t.makeTensorInfo(F,s,L);return k.forEach(z=>t.disposeIntermediateTensorInfo(z)),W}const o=n.filter(k=>H(k.shape)>0),c=ke().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&o[0].shape.length>1;if(o.length===1){const k=c?new bo(n[0].shape,pu):new mu(n[0].shape,pu);return t.runWebGLProgram(k,n,s)}const h=ke().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(o.length>h){const k=[];for(let R=0;R<o.length;R+=h){const P=o.slice(R,R+h);k.push(lp(P,e,t))}const N=lp(k,e,t);for(const R of k)t.disposeIntermediateTensorInfo(R);return N}if(c){const k=new HJ(o.map(N=>N.shape),e);return t.runWebGLProgram(k,o,s)}const{tensors2D:f,outShape:g}=YJ(o,e,t),y=new UJ(f.map(k=>k.shape)),I=t.runWebGLProgram(y,f,s);f.forEach(k=>t.disposeIntermediateTensorInfo(k));const C=tt({inputs:{x:I},attrs:{shape:g},backend:t});return t.disposeIntermediateTensorInfo(I),C}function YJ(n,e,t){const s=co(n.map(i=>i.shape),e);return{tensors2D:n.map(i=>tt({inputs:{x:i},attrs:{shape:[-1,H(i.shape.slice(e))]},backend:t})),outShape:s}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function jN(n){const{inputs:e,backend:t,attrs:s}=n,{axis:i}=s,o=be(i,e[0].shape)[0],c=e.map(g=>g.shape);Yx(c,o);const h=co(e.map(g=>g.shape),o);if(H(h)===0)return t.makeTensorInfo(h,e[0].dtype,[]);const f=e.filter(g=>H(g.shape)>0);return f.length===1?ci({inputs:{x:f[0]},backend:t}):lp(f,o,t)}const QJ={kernelName:Ki,backendName:"webgl",kernelFunc:jN};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class YN{constructor(e,t=!1,s=null,i=!1,o=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const c=e.padInfo.top,h=e.padInfo.left,f=e.strideHeight,g=e.strideWidth,y=e.dilationHeight,I=e.dilationWidth,C=e.filterHeight,k=e.filterWidth,N=Math.floor(e.inChannels/4)*4,R=e.inChannels%4,P=e.dataFormat==="channelsLast",L=P?1:2,F=P?2:3,W=P?3:1;let z="",X="";s&&(i?z=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?z=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:z=`
          float activation(float x) {
            ${s}
          }
        `,X="result = activation(result);");const Q=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${z}

      const ivec2 strides = ivec2(${f}, ${g});
      const ivec2 pads = ivec2(${c}, ${h});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${W}];

        ivec2 xRCCorner =
            ivec2(coords[${L}], coords[${F}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${C}; wR++) {
          int xR = xRCorner + wR * ${y};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${k}; wC++) {
            int xC = xCCorner + wC * ${I};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${N}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${P}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${R===1}) {

              if (${P}) {
                dotProd +=
                    getX(batch, xR, xC, ${N}) *
                    getW(wR, wC, ${N}, d2);
              } else {
                dotProd +=
                    getX(batch, ${N}, xR, xC) *
                    getW(wR, wC, ${N}, d2);
              }

            } else if (${R===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${N}, d2),
                getW(wR, wC, ${N} + 1, d2)
              );

              if (${P}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${N}),
                  getX(batch, xR, xC, ${N} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${N}, xR, xC),
                  getX(batch, ${N} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${R===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${N}, d2),
                getW(wR, wC, ${N} + 1, d2),
                getW(wR, wC, ${N} + 2, d2)
              );

              if (${P}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${N}),
                  getX(batch, xR, xC, ${N} + 1),
                  getX(batch, xR, xC, ${N} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${N}, xR, xC),
                  getX(batch, ${N} + 1, xR, xC),
                  getX(batch, ${N} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${Q}
        ${X}
        setOutput(result);
      }
    `}}class JJ{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,s=e.padInfo.top,i=e.padInfo.left,o=e.strideDepth,c=e.strideHeight,h=e.strideWidth,f=e.dilationDepth,g=e.dilationHeight,y=e.dilationWidth,I=e.filterDepth,C=e.filterHeight,k=e.filterWidth,N=Math.floor(e.inChannels/4)*4,R=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${o}, ${c}, ${h});
      const ivec3 pads = ivec3(${t}, ${s}, ${i});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${I}; wF++) {
          int xF = xFCorner + wF * ${f};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${C}; wR++) {
            int xR = xRCorner + wR * ${g};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${k}; wC++) {
              int xC = xCCorner + wC * ${y};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${N}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${R===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${N}) *
                  getW(wF, wR, wC, ${N}, d2);
              } else if (${R===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${N}),
                  getX(batch, xF, xR, xC, ${N} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${N}, d2),
                  getW(wF, wR, wC, ${N} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${R===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${N}),
                  getX(batch, xF, xR, xC, ${N} + 1),
                  getX(batch, xF, xR, xC, ${N} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${N}, d2),
                  getW(wF, wR, wC, ${N} + 1, d2),
                  getW(wF, wR, wC, ${N} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class QN{constructor(e,t=!1,s=null,i=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=fs(this.outputShape.length);const c=e.padInfo.left,h=e.strideWidth,f=e.dilationWidth,g=e.filterHeight,y=e.filterWidth,I=y;let C=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let P=0;P<y;P++)C+=`
           vec4 xTexelC${P*2};
           int xTexelC${P*2}Ready;
           vec4 xTexelC${P*2+1};
           int xTexelC${P*2+1}Ready;
           vec4 xC${P};`;C+=`
     for (int r = 0; r < ${g}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let P=0;P<y;P++)C+=`
           xTexelC${P*2} = vec4(0.0);
           xTexelC${P*2}Ready = 0;
           xTexelC${P*2+1} = vec4(0.0);
           xTexelC${P*2+1}Ready = 0;
           xC${P} = vec4(0.0);`;C+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let P=0;P<(I+1)/2;P++){const L=P*2;if(C+=`
           xC = xCCorner + ${L*f};
           `,h===1){if(L<y&&(c%2===1?(C+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${L}Ready == 0) {
                   xTexelC${L} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${L}.zw = vec2(0.0);
                   }
                   xTexelC${L}Ready = 1;
                 }
               `,f===1&&L>0?C+=`
                 xC${L} = vec4(xTexelC${L-2}.zw, xTexelC${L}.xy);
                 `:C+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${L} = vec4(previous.zw, xTexelC${L}.xy);
                   } else {
                     xC${L} = vec4(0.0, 0.0, xTexelC${L}.xy);
                   }
                   `):C+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${L}Ready == 0) {
                   xTexelC${L} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${L}.zw = vec2(0.0);
                   }
                   xTexelC${L}Ready = 1;
                 }

                 xC${L} = xTexelC${L};
                 `,L+1<y)){const F=c%2===0?_(f):f;f%2===0&&c%2===1||f%2!==0&&c%2!==1?(C+=`
                   xCOffset = xC + imod(pads[1], 2) + ${F};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${L+1}Ready == 0) {
                     xTexelC${L+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${L+1}.zw = vec2(0.0);
                     }
                     xTexelC${L+1}Ready = 1;
                   }
                   `,f>1?C+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${L+1} = vec4(previous.zw, xTexelC${L+1}.xy);
                     } else {
                      xC${L+1} = vec4(0.0, 0.0, xTexelC${L+1}.xy);
                     }
                     `:C+=`
                     xC${L+1} = vec4(xTexelC${L}.zw, xTexelC${L+1}.xy);
                     `):F===1?C+=`
                     xC${L+1} = xTexelC${L};
                     `:C+=`
                     xCOffset = xC + ${F};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${L+1}Ready == 0) {
                       xTexelC${L+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${L+1}.zw = vec2(0.0);
                       }
                       xTexelC${L+1}Ready = 1;
                     }

                     xC${L+1} = xTexelC${L+1};
                     `}}else L<y&&(c%2===1?(C+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${L}Ready == 0) {
                   xTexelC${L} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${L}.zw = vec2(0.0);
                   }
                   xTexelC${L}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${L+1}Ready == 0) {
                   xTexelC${L+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${L+1}.zw = vec2(0.0);
                   }
                   xTexelC${L+1}Ready = 1;
                 }

                 xC${L} = vec4(xTexelC${L}.zw, xTexelC${L+1}.zw);
               `,L+1<y&&(C+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${L+1} = vec4(xTexelC${L+1}.xy, final.xy);
                 `)):(C+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${L}Ready == 0) {
                   xTexelC${L} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${L}.zw = vec2(0.0);
                   }
                   xTexelC${L}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${L+1}Ready == 0) {
                   xTexelC${L+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${L+1}.zw = vec2(0.);
                   }
                   xTexelC${L+1}Ready = 1;
                 }

                 xC${L} = vec4(
                   xTexelC${L}.xy, xTexelC${L+1}.xy);
               `,L+1<y&&(C+=`
                   xC${L+1} = vec4(xTexelC${L}.zw, xTexelC${L+1}.zw);
                 `)));L<y&&(C+=`
             wTexel = getW(r, ${L}, d1, d2);
             dotProd += xC${L}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${L}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,L+1<y&&(C+=`
               wTexel = getW(r, ${L+1}, d1, d2);
               dotProd += xC${L+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${L+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}C+=`
     }
   `,C+=`
     }
   `,C+=`
     }
   `;let k="",N="";s&&(i?k=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:o?k=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:k=`vec4 activation(vec4 x) {
           ${s}
         }`,N="result = activation(result);");const R=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${k}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${C}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${R}
         ${N}
         setOutput(result);
       }
     `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class qJ{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=fs(this.outputShape.length);const{dataFormat:s}=t,i=As(),o=s==="channelsLast",c=o?1:2,h=o?2:3,f=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let g="";for(let y=0;y<=1;y++)for(let I=0;I<=1;I++)g+=`
          blockIndex = rc.z + ${I};
          pos = rc.y + ${y};

          ${f}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${c}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${h}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${o}) {
                  innerDims = vec2(d1, ch);
                  result[${y*2+I}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${y*2+I}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${g}

        ${i.output} = result;
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function V1(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function JN({x:n,filter:e,convInfo:t,backend:s,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:c=0,activation:h=null}){const f=n.shape,g=s.texData.get(n.dataId),y=t.inChannels,I=f[0]*f[1]*f[2],C=t.outChannels,k=t.dataFormat==="channelsLast",N=!1,R=!1;let P;const L=[];if(o!=null){const F=V1(o.shape,k);F!=null&&(o=tt({inputs:{x:o},backend:s,attrs:{shape:F}}),L.push(o))}if(i!=null){const F=V1(i.shape,k);F!=null&&(i=tt({inputs:{x:i},backend:s,attrs:{shape:F}}),L.push(i))}if(!((I===1||C===1)&&y>BN)&&g.isPacked&&k&&g.texture!=null&&f[2]%2!==0&&se(g.shape.slice(-3),f.slice(-3))){const F=f[0]*f[1]*(f[2]+1),W={dataId:n.dataId,shape:[1,F,t.inChannels],dtype:n.dtype},z=g.shape;g.shape=g.shape.slice(),g.shape[g.shape.length-2]++,D(R1(g.shape,W.shape),()=>`packed reshape ${g.shape} to ${W.shape} isn't free`);const X=tt({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}});L.push(X);const Q=P1({a:W,b:X,backend:s,transposeA:N,transposeB:R,bias:i,activation:h,preluActivationWeights:o,leakyreluAlpha:c}),J=s.texData.get(Q.dataId);D(J.isPacked,()=>"batchMatMul result is expected to be packed"),g.shape=z,J.shape=t.outShape,P=ci({inputs:{x:Q},backend:s}),P.shape=t.outShape,L.push(Q)}else{const F=t.outHeight*t.outWidth,W=tt({inputs:{x:n},backend:s,attrs:{shape:k?[t.batchSize,F,t.inChannels]:[t.batchSize,t.inChannels,F]}}),z=tt({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}}),X=P1({a:k?W:z,b:k?z:W,transposeA:!k,transposeB:R,backend:s,bias:i,activation:h,preluActivationWeights:o,leakyreluAlpha:c});P=tt({inputs:{x:X},backend:s,attrs:{shape:t.outShape}}),L.push(W),L.push(z),L.push(X)}for(const F of L)s.disposeIntermediateTensorInfo(F);return P}function qN({x:n,filter:e,convInfo:t,backend:s,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:c=0,activation:h=null}){const{filterWidth:f,filterHeight:g,inChannels:y,outWidth:I,outHeight:C,dataFormat:k}=t,N=k==="channelsLast",R=f*g*y,P=C*I,L=[t.batchSize,R,P],F=!0,W=!1,z=[];if(o!=null){const _e=V1(o.shape,N);_e!=null&&(o=tt({inputs:{x:o},backend:s,attrs:{shape:_e}}),z.push(o))}if(i!=null){const _e=V1(i.shape,N);_e!=null&&(i=tt({inputs:{x:i},backend:s,attrs:{shape:_e}}),z.push(i))}const X=tt({inputs:{x:e},backend:s,attrs:{shape:[1,R,H(e.shape)/R]}});z.push(X);const Q=new qJ(L,t),J=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],te=s.runWebGLProgram(Q,[n],"float32",J),ie=tt({inputs:{x:te},backend:s,attrs:{shape:L}});z.push(te),z.push(ie);const oe=i!=null,Ce=o!=null,Se=h==="leakyrelu",Te=h?ip(h,!0):null,Le=new PN(N?ie.shape:X.shape,N?X.shape:ie.shape,N?[t.batchSize,P,t.outChannels]:[t.batchSize,t.outChannels,P],F,W,oe,Te,Ce,Se),Me=N?[ie,X]:[X,ie];if(i&&Me.push(i),Ce&&Me.push(o),Se){const _e=s.makeTensorInfo([],"float32",Hl(c,"float32"));Me.push(_e),z.push(_e)}const Oe=s.runWebGLProgram(Le,Me,"float32"),Ve=tt({inputs:{x:Oe},backend:s,attrs:{shape:t.outShape}});z.push(Oe);for(const _e of z)s.disposeIntermediateTensorInfo(_e);return Ve}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function eq(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,filter:o}=e,{strides:c,pad:h,dataFormat:f,dilations:g,dimRoundingMode:y}=s,I=tl(f),C=ns(i.shape,o.shape,c,g,h,y,!1,I);let k;if(C.filterHeight===1&&C.filterWidth===1&&C.dilationHeight===1&&C.dilationWidth===1&&C.strideHeight===1&&C.strideWidth===1&&(C.padInfo.type==="SAME"||C.padInfo.type==="VALID"))k=JN({x:i,filter:o,convInfo:C,backend:t});else if(C.strideWidth<=2&&I==="channelsLast"&&ke().getBool("WEBGL_EXP_CONV")){const R=new QN(C),P=[[C.padInfo.top,C.padInfo.left],[C.strideHeight,C.strideWidth],[C.dilationHeight,C.dilationWidth],[C.inHeight,C.inWidth]];k=t.runWebGLProgram(R,[i,o],"float32",P)}else if(ke().getBool("WEBGL_CONV_IM2COL"))k=qN({x:i,filter:o,convInfo:C,backend:t});else{const R=new YN(C);k=t.runWebGLProgram(R,[i,o],"float32")}const N=tt({inputs:{x:k},backend:t,attrs:{shape:C.outShape}});return t.disposeIntermediateTensorInfo(k),N}const tq={kernelName:Ml,backendName:"webgl",kernelFunc:eq};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class nq{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,i=e.padInfo.top,o=e.padInfo.left,c=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${i};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${c?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class rq{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,i=e.strideHeight,o=e.strideWidth,c=e.dataFormat==="channelsLast",h=t-1-e.padInfo.top,f=s-1-e.padInfo.left,g=c?1:2,y=c?2:3,I=c?3:1;this.userCode=`
      const ivec2 pads = ivec2(${h}, ${f});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${I}];

        ivec2 dyCorner = ivec2(coords[${g}], coords[${y}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${c}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class sq{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,s=e.strideHeight,i=e.strideWidth,o=e.padInfo.front,c=e.padInfo.top,h=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${o};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${c};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${i} - ${h};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class iq{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,i=e.filterWidth,o=e.strideDepth,c=e.strideHeight,h=e.strideWidth,f=t-1-e.padInfo.front,g=s-1-e.padInfo.top,y=i-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${f}, ${g}, ${y});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${o}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${c}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${i}; wC++) {
              float dyC = float(dyCCorner + wC) / ${h}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${i} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function aq(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,dy:o}=e,{strides:c,pad:h,dataFormat:f,dimRoundingMode:g,filterShape:y}=s,I=tl(f),C=ns(i.shape,y,c,1,h,g,!1,I),k=new nq(C);return t.runWebGLProgram(k,[i,o],"float32")}const oq={kernelName:Qr,backendName:"webgl",kernelFunc:aq};/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class lq{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=fs(this.outputShape.length);const t=e.filterHeight,s=e.filterWidth,i=t-1-e.padInfo.top,o=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function uq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:i,filter:o}=e,{inputShape:c,strides:h,pad:f,dataFormat:g,dimRoundingMode:y}=s,I=tl(g),C=ns(c,o.shape,h,1,f,y,!1,I);if(ke().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&I==="channelsLast"){const k=[[C.strideHeight,C.strideWidth]],N=new lq(C);return t.runWebGLProgram(N,[i,o],"float32",k)}else{const k=new rq(C);return t.runWebGLProgram(k,[i,o],"float32")}}const cq={kernelName:$i,backendName:"webgl",kernelFunc:uq};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hq(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,filter:o}=e,{strides:c,pad:h,dilations:f}=s,g=ql(i.shape,o.shape,c,f,h),y=new JJ(g);return t.runWebGLProgram(y,[i,o],"float32")}const dq={kernelName:us,backendName:"webgl",kernelFunc:hq};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function fq(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,dy:o}=e,{strides:c,pad:h,filterShape:f}=s,g=ql(i.shape,f,c,1,h),y=new sq(g);return t.runWebGLProgram(y,[i,o],"float32")}const pq={kernelName:lt,backendName:"webgl",kernelFunc:fq};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:i,filter:o}=e,{pad:c,strides:h,inputShape:f}=s,g=ql(f,o.shape,h,1,c),y=new iq(g);return t.runWebGLProgram(y,[i,o],"float32")}const gq={kernelName:Ja,backendName:"webgl",kernelFunc:mq};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const xq=bd+`
  return cos(x);
`,yq=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Hc}
  return result;
`,bq=nn({opSnippet:xq,packedOpSnippet:yq}),wq={kernelName:Vo,backendName:"webgl",kernelFunc:bq};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const vq=nn({opSnippet:`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`}),Iq={kernelName:Rr,backendName:"webgl",kernelFunc:vq};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Cq{constructor(e,t,s,i,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[c,h,f,g]=e,[y]=t,[I,C]=s;this.outputShape=[y,I,C,g];const k=i==="bilinear"?1:0,[N,R]=[`${h-1}.0`,`${f-1}.0`],[P,L,F]=I>1?[`${(h-1)/(I-1)}`,"(y2-y1) * height_ratio",`y1*${N} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${N}`],[W,z,X]=C>1?[`${(f-1)/(C-1)}`,"(x2-x1) * width_ratio",`x1*${R} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${R}`];this.userCode=`
      const float height_ratio = float(${P});
      const float width_ratio = float(${W});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${c}) {
          return;
        }

        float height_scale = ${L};
        float width_scale = ${z};

        float in_y = ${F};
        if( in_y < 0.0 || in_y > ${N} ) {
          setOutput(float(${o}));
          return;
        }
        float in_x = ${X};
        if( in_x < 0.0 || in_x > ${R} ) {
          setOutput(float(${o}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${k} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Sq={kernelName:Ll,backendName:"webgl",kernelFunc:n=>{const{inputs:e,backend:t,attrs:s}=n,{image:i,boxes:o,boxInd:c}=e,{cropSize:h,method:f,extrapolationValue:g}=s,y=new Cq(i.shape,o.shape,h,f,g);return t.runWebGLProgram(y,[i,o,c],"float32")}};var up;(function(n){n.Prod="*",n.Sum="+"})(up||(up={}));class eA{constructor(e,t,s,i){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const o=this.outputShape.length,c=this.op===up.Prod?"1.0":"0.0",h=s?c:`getX(${tA(o,"coords",this.op)})`,f=this.outputShape[this.outputShape.length-1];let g="",y="";s?(g=i?`end != ${f-1}`:"end != 0",y=i?"end + 1":"end - 1"):(g=i?`end + pow2 < ${f}`:"end >= pow2",y=i?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${wn(o)} coords = getOutputCoords();
        int end = ${nA(o,"coords",this.op)};
        float val = ${h};
        int pow2 = int(pow(2.0, index));
        if (${g}) {
          int idx = ${y};
          ${nA(o,"coords",this.op)} = idx;
          val ${this.op}= getX(${tA(o,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function tA(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function nA(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function rA(n,e,t,s,i,o){const c=e.shape.length,h=er([s],c);let f=e;h!=null&&(f=Ms({inputs:{x:e},backend:t,attrs:{perm:h}}));const g=gr(1,c)[0];if(g!==c-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const y=f.shape[g];let I=ci({inputs:{x:f},backend:t});for(let C=0;C<=Math.ceil(Math.log2(y))-1;C++){const k=new eA(n,f.shape,!1,o),N=[[C]],R=I;I=t.runWebGLProgram(k,[I],I.dtype,N),t.disposeIntermediateTensorInfo(R)}if(i){const C=new eA(n,f.shape,i,o),k=I;I=t.runWebGLProgram(C,[I],I.dtype),t.disposeIntermediateTensorInfo(k)}if(h!=null){const C=eu(h),k=Ms({inputs:{x:I},backend:t,attrs:{perm:C}});return t.disposeIntermediateTensorInfo(I),t.disposeIntermediateTensorInfo(f),k}return I}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Tq(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{axis:o,exclusive:c,reverse:h}=s;return rA(up.Prod,i,t,o,c,h)}const kq={kernelName:qa,backendName:"webgl",kernelFunc:Tq};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Eq(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{axis:o,exclusive:c,reverse:h}=s;return rA(up.Sum,i,t,o,c,h)}const Nq={kernelName:Bo,backendName:"webgl",kernelFunc:Eq};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Aq(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,weights:o}=e,{size:c,binaryOutput:h}=s;if(i.shape.length===1){const f=t.readSync(i.dataId),g=t.readSync(o.dataId),y=IN(f,g,o.dtype,o.shape,c);return t.makeTensorInfo([c],o.dtype,y)}else if(i.shape.length===2){const f=t.bufferSync(i),g=t.bufferSync(o),y=_j(f,g,c,h);return t.makeTensorInfo(y.shape,o.dtype,y.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}const Rq={kernelName:ti,backendName:"webgl",kernelFunc:Aq};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Mq{constructor(e,t,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Lq(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{blockSize:o,dataFormat:c}=s,h=i.shape[0],f=c==="NHWC"?i.shape[1]:i.shape[2],g=c==="NHWC"?i.shape[2]:i.shape[3],y=c==="NHWC"?i.shape[3]:i.shape[1],I=f*o,C=g*o,k=y/(o*o),N=c==="NHWC"?[h,I,C,k]:[h,k,I,C],R=new Mq(N,o,c);return t.runWebGLProgram(R,[i],i.dtype)}const Dq={kernelName:cf,backendName:"webgl",kernelFunc:Lq};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class sA{constructor(e,t=!1,s=null,i=!1,o=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=fs(this.outputShape.length);const c=e.filterHeight,h=e.filterWidth,f=e.outChannels/e.inChannels;let g="",y="";s&&(i?g=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?g=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:g=`
          float activation(float x) {
            ${s}
          }
        `,y="result = activation(result);");const I=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${g}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${f};
        int q = d2 - d1 * ${f};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${c}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${h}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${I}
        ${y}
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class iA{constructor(e,t=!1,s=null,i=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=fs(this.outputShape.length);const c=e.outChannels/e.inChannels,h=e.padInfo.left,f=e.strideWidth,g=e.dilationWidth,y=e.filterHeight,I=e.filterWidth,C=I;let k=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let L=0;L<I;L++)k+=`
          vec4 xTexelC${L*2};
          int xTexelC${L*2}Ready;
          vec4 xTexelC${L*2+1};
          int xTexelC${L*2+1}Ready;
          vec4 xC${L};`;k+=`
    for (int r = 0; r < ${y}; r++) {
      `;for(let L=0;L<I;L++)k+=`
          xTexelC${L*2} = vec4(0.0);
          xTexelC${L*2}Ready = 0;
          xTexelC${L*2+1} = vec4(0.0);
          xTexelC${L*2+1}Ready = 0;
          xC${L} = vec4(0.0);`;k+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let L=0;L<(C+1)/2;L++){const F=L*2;if(k+=`
          xC = xCCorner + ${F*g};
          `,f===1){if(F<I&&(h%2===1?(k+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${F}Ready == 0) {
                  xTexelC${F} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${F}.zw = vec2(0.0);
                  }
                  xTexelC${F}Ready = 1;
                }
              `,g===1&&F>0?k+=`
                xC${F} = vec4(xTexelC${F-2}.zw, xTexelC${F}.xy);
                `:k+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${F} = vec4(previous.zw, xTexelC${F}.xy);
                  } else {
                    xC${F} = vec4(0.0, 0.0, xTexelC${F}.xy);
                  }
                  `):k+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${F}Ready == 0) {
                  xTexelC${F} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${F}.zw = vec2(0.0);
                  }
                  xTexelC${F}Ready = 1;
                }

                xC${F} = xTexelC${F};
                `,F+1<I)){const W=h%2===0?_(g):g;g%2===0&&h%2===1||g%2!==0&&h%2!==1?(k+=`
                  xCOffset = xC + imod(pads[1], 2) + ${W};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${F+1}Ready == 0) {
                    xTexelC${F+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${F+1}.zw = vec2(0.0);
                    }
                    xTexelC${F+1}Ready = 1;
                  }
                  `,g>1?k+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${F+1} = vec4(previous.zw, xTexelC${F+1}.xy);
                    } else {
                     xC${F+1} = vec4(0.0, 0.0, xTexelC${F+1}.xy);
                    }
                    `:k+=`
                    xC${F+1} = vec4(xTexelC${F}.zw, xTexelC${F+1}.xy);
                    `):W===1?k+=`
                    xC${F+1} = xTexelC${F};
                    `:k+=`
                    xCOffset = xC + ${W};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${F+1}Ready == 0) {
                      xTexelC${F+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${F+1}.zw = vec2(0.0);
                      }
                      xTexelC${F+1}Ready = 1;
                    }

                    xC${F+1} = xTexelC${F+1};
                    `}}else F<I&&(h%2===1?(k+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${F}Ready == 0) {
                  xTexelC${F} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${F}.zw = vec2(0.0);
                  }
                  xTexelC${F}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${F+1}Ready == 0) {
                  xTexelC${F+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${F+1}.zw = vec2(0.0);
                  }
                  xTexelC${F+1}Ready = 1;
                }

                xC${F} = vec4(xTexelC${F}.zw, xTexelC${F+1}.zw);
              `,F+1<I&&(k+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${F+1} = vec4(xTexelC${F+1}.xy, final.xy);
                `)):(k+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${F}Ready == 0) {
                  xTexelC${F} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${F}.zw = vec2(0.0);
                  }
                  xTexelC${F}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${F+1}Ready == 0) {
                  xTexelC${F+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${F+1}.zw = vec2(0.);
                  }
                  xTexelC${F+1}Ready = 1;
                }

                xC${F} = vec4(
                  xTexelC${F}.xy, xTexelC${F+1}.xy);
              `,F+1<I&&(k+=`
                  xC${F+1} = vec4(xTexelC${F}.zw, xTexelC${F+1}.zw);
                `)));F<I&&(k+=`
            wTexel = getW(r, ${F}, d1, q);
            dotProd += xC${F} * vec4(wTexel.xz, wTexel.xz);
          `,F+1<I&&(k+=`
              wTexel = getW(r, ${F+1}, d1, q);
              dotProd += xC${F+1} * vec4(wTexel.xz, wTexel.xz);
            `))}k+=`
    }
  `,k+=`
      }
    `;let N="",R="";s&&(i?N=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?N=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:N=`vec4 activation(vec4 x) {
          ${s}
        }`,R="result = activation(result);");const P=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${N}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${c};
        int q = d2 - d1 * ${c};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${k}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${P}
        ${R}
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Oq(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,filter:o}=e,{strides:c,pad:h,dilations:f,dimRoundingMode:g}=s;let y=f;y==null&&(y=[1,1]),D(ds(c,y),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${c} and dilations '${y}'`);const I=ns(i.shape,o.shape,c,y,h,g,!0);let C;ke().getBool("WEBGL_PACK_DEPTHWISECONV")&&I.strideWidth<=2&&I.outChannels/I.inChannels===1?C=new iA(I):C=new sA(I);const k=[[I.padInfo.top,I.padInfo.left],[I.strideHeight,I.strideWidth],[I.dilationHeight,I.dilationWidth],[I.inHeight,I.inWidth]];return t.runWebGLProgram(C,[i,o],"float32",k)}const Pq={kernelName:Eh,backendName:"webgl",kernelFunc:Oq};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Fq{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,i=e.padInfo.top,o=e.padInfo.left,c=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${c} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${i};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Gq{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,i=e.strideHeight,o=e.strideWidth,c=t-1-e.padInfo.top,h=s-1-e.padInfo.left,f=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${c}, ${h});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${f}; dm++) {
              int d2 = d1 * ${f} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _q(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,dy:o}=e,{strides:c,dilations:h,pad:f,dimRoundingMode:g,filterShape:y}=s,I=ns(i.shape,y,c,h,f,g,!0),C=new Fq(I);return t.runWebGLProgram(C,[i,o],"float32")}const Vq={kernelName:ni,backendName:"webgl",kernelFunc:_q};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Bq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:i,filter:o}=e,{strides:c,dilations:h,pad:f,dimRoundingMode:g,inputShape:y}=s,I=ns(y,o.shape,c,h,f,g,!0),C=new Gq(I);return t.runWebGLProgram(C,[i,o],"float32")}const Wq={kernelName:Wr,backendName:"webgl",kernelFunc:Bq};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class zq{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Xq(n){const{inputs:e,backend:t}=n,{x:s}=e,i=[...s.shape,...s.shape],o=H(s.shape),c=tt({inputs:{x:s},backend:t,attrs:{shape:[o]}}),h=new zq(o),f=t.runWebGLProgram(h,[c],c.dtype),g=tt({inputs:{x:f},backend:t,attrs:{shape:i}});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(f),g}const Zq={kernelName:An,backendName:"webgl",kernelFunc:Xq};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Kq{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:s,padInfo:i,strideHeight:o,strideWidth:c,filterHeight:h,filterWidth:f,dilationHeight:g,dilationWidth:y}=e,{top:I,left:C}=i;this.userCode=`
      const ivec2 strides = ivec2(${o}, ${c});
      const ivec2 pads = ivec2(${I}, ${C});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${h}; h++) {
          int hIn = hBeg + h * ${g};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${f}; w++) {
              int wIn = wBeg + w * ${y};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function $q(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,filter:o}=e,{strides:c,pad:h,dilations:f}=s,g=If(i.shape,o.shape,c,h,"NHWC",f);let y;const I=new Kq(g);y=t.runWebGLProgram(I,[i,o],"float32");const C=tt({inputs:{x:y},backend:t,attrs:{shape:g.outShape}});return t.disposeIntermediateTensorInfo(y),C}const Uq={kernelName:ec,backendName:"webgl",kernelFunc:$q};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Hq(n){const{inputs:e,backend:t,attrs:s}=n,{equation:i}=s,o=e,{allDims:c,summedDims:h,idDims:f}=uy(i,o.length);hy(c.length,f,o);const{path:g,steps:y}=dy(h,f),I=y.length;let C=null,k=c.length;const N=[];for(let R=0;R<I;++R){for(const P of y[R]){const{permutationIndices:L,expandDims:F}=cy(k,f[P]);let W;fy(L)?W=o[P]:(W=Ms({inputs:{x:o[P]},backend:t,attrs:{perm:L}}),N.push(W));const z=W.shape.slice();for(let X=0;X<F.length;++X)z.splice(F[X],0,1);se(W.shape,z)||(W=tt({inputs:{x:W},backend:t,attrs:{shape:z}}),N.push(W)),C===null?C=W:(C=Tb({inputs:{a:W,b:C},backend:t}),N.push(C))}R<I-1&&(g[R]>=0&&(C=O1({inputs:{x:C},backend:t,attrs:{axis:g[R]-(c.length-k),keepDims:!1}}),N.push(C)),k--)}for(const R of N)R!==C&&t.disposeIntermediateTensorInfo(R);return C}const jq={kernelName:Vn,backendName:"webgl",kernelFunc:Hq};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Yq=nn({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`}),Qq={kernelName:Hi,backendName:"webgl",kernelFunc:Yq};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Jq="return (b >= 0.0) ? a : a * (b + 1.0);",qq=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,eee={kernelName:hf,backendName:"webgl",kernelFunc:n=>{const{inputs:e,backend:t}=n,{dy:s,y:i}=e,o=ke().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new yd(qq,s.shape,i.shape):new Uc(Jq,s.shape,i.shape);return t.runWebGLProgram(o,[s,i],s.dtype)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const tee=is({opSnippet:"return float(a == b);",packedOpSnippet:`
  return vec4(equal(a, b));
`,dtype:"bool",cpuKernelImpl:Xj}),nee={kernelName:qt,backendName:"webgl",kernelFunc:tee};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ree=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${ty};
  float a1 = ${ny};
  float a2 = ${ry};
  float a3 = ${sy};
  float a4 = ${iy};
  float a5 = ${ay};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,see=nn({opSnippet:ree}),iee={kernelName:Jt,backendName:"webgl",kernelFunc:see};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const aee=bd+`
  return exp(x);
`,aA=nn({opSnippet:aee,packedOpSnippet:`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cpuKernelImpl:Zj,dtype:"float32"}),oee={kernelName:Wt,backendName:"webgl",kernelFunc:aA};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ab(n){const{inputs:e,attrs:t,backend:s}=n,{dim:i}=t,{input:o}=e,c=o.shape.length,h=o.shape.slice();let f=i;return i<0&&(D(-(c+1)<=i,()=>`Axis must be in the interval [${-(c+1)}, ${c}]`),f=c+i+1),h.splice(f,0,1),tt({inputs:{x:o},backend:s,attrs:{shape:h}})}const lee={kernelName:Dl,backendName:"webgl",kernelFunc:Ab};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const oA="return exp(x) - 1.0;",uee=nn({opSnippet:oA,packedOpSnippet:oA,cpuKernelImpl:Kj}),cee={kernelName:Wo,backendName:"webgl",kernelFunc:uee};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class lA{constructor(e,t,s){this.variableNames=["real","imag"];const i=t[1];this.outputShape=t;const o=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,c=s?`${i}.0`:"1.0";let h;if(e==="real")h="return real * expR - imag * expI;";else if(e==="imag")h="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${o};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${h}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${i});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${i}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${c};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function uA(n,e,t){const s=t.texData.get(n.dataId),i=H(n.shape),o=n.shape[n.shape.length-1],c=i/o,h=tt({inputs:{x:n},backend:t,attrs:{shape:[c,o]}}),f=h.shape,g=new lA("real",f,e),y=new lA("imag",f,e),I=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:f},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:f}],C=t.runWebGLProgram(g,I,"float32"),k=t.runWebGLProgram(y,I,"float32"),N=gu({inputs:{real:C,imag:k},backend:t});t.disposeIntermediateTensorInfo(C),t.disposeIntermediateTensorInfo(k);const R=tt({inputs:{x:N},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(N),R}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hee(n){const{inputs:e,backend:t}=n,{input:s}=e;return uA(s,!1,t)}const dee={kernelName:rc,backendName:"webgl",kernelFunc:hee};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class fee{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cp(n){const{backend:e,attrs:t}=n,{shape:s,value:i}=t;let{dtype:o}=t;if(o=o||ut(i),o==="string"){const c=we(o,H(s));return c.fill(i),e.makeTensorInfo(s,o,c)}else{const c=new fee(s,i),h=[[i]];return e.runWebGLProgram(c,[],o,h)}}const pee={kernelName:sr,backendName:"webgl",kernelFunc:cp};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class mee{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const gee={kernelName:ji,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,s=e,i=new mee(t.shape);return s.runWebGLProgram(i,[t],t.dtype)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const cA="return floor(x);",xee=nn({opSnippet:cA,packedOpSnippet:cA,cpuKernelImpl:$j}),yee={kernelName:sc,backendName:"webgl",kernelFunc:xee};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const bee=is({opSnippet:`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,packedOpSnippet:`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,dtype:"int32"}),wee={kernelName:Rn,backendName:"webgl",kernelFunc:bee};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class vee{constructor(e){this.variableNames=["A"];const t=As(),[s,i]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${i}.0, ${s}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Iee{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=As(),[s,i]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${i}.0, ${s}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Cee={kernelName:S,backendName:"webgl",kernelFunc:See};let vd,Rb=ke().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function See(n){const{inputs:e,backend:t,attrs:s}=n;let{pixels:i}=e;const{numChannels:o}=s,c=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement,h=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,[f,g]=c?[i.videoWidth,i.videoHeight]:[i.width,i.height],y=[g,f],I=[g,f,o];if(h||c){const R=ke().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(vd==null||R!==Rb)&&(Rb=R,vd=document.createElement("canvas").getContext("2d",{willReadFrequently:Rb})),vd.canvas.width=f,vd.canvas.height=g,vd.drawImage(i,0,0,f,g),i=vd.canvas}const C=t.makeTensorInfo(y,"int32");t.texData.get(C.dataId).usage=Ni.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(C.dataId),i);const k=ke().getBool("WEBGL_PACK")?new Iee(I):new vee(I),N=t.runWebGLProgram(k,[C],"int32");return t.disposeData(C.dataId),N}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Tee(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,filter:o,bias:c,preluActivationWeights:h}=e,{strides:f,pad:g,dataFormat:y,dilations:I,dimRoundingMode:C,activation:k,leakyreluAlpha:N}=s,R=tl(y),P=ns(i.shape,o.shape,f,I,g,C,!1,R);let L;const F=[],W=c!=null,z=h!=null,X=k==="leakyrelu",Q=()=>{const te=[i,o],ie=(oe,Ce)=>{if(Ce==="NCHW"&&oe.shape.length===1&&oe.shape[0]!==1){const Se=tt({inputs:{x:oe},backend:t,attrs:{shape:[oe.shape[0],1,1]}});return F.push(Se),Se}return oe};if(W&&te.push(ie(c,y)),z&&te.push(ie(h,y)),X){const oe=t.makeTensorInfo([],"float32",Hl(N,"float32"));te.push(oe),F.push(oe)}return te};if(P.filterHeight===1&&P.filterWidth===1&&P.dilationHeight===1&&P.dilationWidth===1&&P.strideHeight===1&&P.strideWidth===1&&(P.padInfo.type==="SAME"||P.padInfo.type==="VALID"))L=JN({x:i,filter:o,convInfo:P,backend:t,bias:c,activation:k,preluActivationWeights:h,leakyreluAlpha:N});else if(P.strideWidth<=2&&R==="channelsLast"&&ke().getBool("WEBGL_EXP_CONV")){const te=k?ip(k,!0):null,ie=new QN(P,W,te,z,X),oe=[[P.padInfo.top,P.padInfo.left],[P.strideHeight,P.strideWidth],[P.dilationHeight,P.dilationWidth],[P.inHeight,P.inWidth]],Ce=Q();L=t.runWebGLProgram(ie,Ce,"float32",oe)}else if(ke().getBool("WEBGL_CONV_IM2COL"))L=qN({x:i,filter:o,convInfo:P,backend:t,bias:c,activation:k,preluActivationWeights:h,leakyreluAlpha:N});else{const te=k?ip(k,!1):null,ie=new YN(P,W,te,z,X),oe=Q();L=t.runWebGLProgram(ie,oe,"float32")}const J=tt({inputs:{x:L},backend:t,attrs:{shape:P.outShape}});return F.push(L),F.forEach(te=>t.disposeIntermediateTensorInfo(te)),J}const kee={kernelName:G,backendName:"webgl",kernelFunc:Tee};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Eee(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,filter:o,bias:c,preluActivationWeights:h}=e,{strides:f,pad:g,dilations:y,dimRoundingMode:I,activation:C,leakyreluAlpha:k}=s,N=[];let R=y;R==null&&(R=[1,1]),D(ds(f,R),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${f} and dilations '${R}'`);const P=ns(i.shape,o.shape,f,R,g,I,!0),L=ke().getBool("WEBGL_PACK_DEPTHWISECONV")&&P.strideWidth<=2&&P.outChannels/P.inChannels===1,F=C?ip(C,L):null,W=[i,o],z=c!=null,X=h!=null,Q=C==="leakyrelu";if(z&&W.push(c),X&&W.push(h),Q){const oe=t.makeTensorInfo([],"float32",Hl(k,"float32"));W.push(oe),N.push(oe)}let J;L?J=new iA(P,z,F,X,Q):J=new sA(P,z,F,X,Q);const te=[[P.padInfo.top,P.padInfo.left],[P.strideHeight,P.strideWidth],[P.dilationHeight,P.dilationWidth],[P.inHeight,P.inWidth]],ie=t.runWebGLProgram(J,W,"float32",te);return N.forEach(oe=>t.disposeIntermediateTensorInfo(oe)),ie}const Nee={kernelName:B,backendName:"webgl",kernelFunc:Eee};class Aee{constructor(e,t,s,i){this.sliceDim=e,this.strides=t,this.paramsShape=i,this.variableNames=["x","indices"],this.outputShape=s;const o=wn(s.length);let c=`
    int index;`;for(let h=0;h<this.sliceDim;h++)c+=`
          index = round(getIndices(coords[0], ${h}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[h]};
          flattenIndex += index * ${this.strides[h]};`;this.userCode=`
         void main() {
          ${o} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${c}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ree(n){const{inputs:e,backend:t}=n,{params:s,indices:i}=e,o=i.shape,c=o[o.length-1],h=H(s.shape),[f,g,y,I]=Xx(s,i),C=tt({inputs:{x:i},backend:t,attrs:{shape:[g,c]}}),k=tt({inputs:{x:s},backend:t,attrs:{shape:[H(s.shape)/y,y]}});if(t.shouldExecuteOnCPU([s,i])||s.dtype==="string"){const L=t.readSync(i.dataId),F=t.bufferSync(s),W=Uj(L,F,s.dtype,g,c,y,I,s.shape,h);return t.makeTensorInfo(f,s.dtype,W.values)}const N=new Aee(c,I,[g,y],s.shape),R=t.runWebGLProgram(N,[k,C],k.dtype),P=tt({inputs:{x:R},backend:t,attrs:{shape:f}});return t.disposeIntermediateTensorInfo(C),t.disposeIntermediateTensorInfo(k),t.disposeIntermediateTensorInfo(R),P}const Mee={kernelName:zo,backendName:"webgl",kernelFunc:Ree};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Lee{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const s=wn(this.rank),i=Dee(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${i}));
      }
    `}}function Dee(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let i=0;i<n.length;i++)i===2?s.push("index"):s.push(`${t[i]}`);return s.join()}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hA(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,indices:o}=e,{axis:c,batchDims:h}=s,f=be(c,i.shape)[0];if(ke().get("DEBUG")){const F=t.readSync(o.dataId),W=i.shape[f];for(let z=0;z<F.length;++z){const X=F[z];D(X<=W-1&&X>=0,()=>`GatherV2: the index value ${X} is not in [0, ${W-1}]`)}}const g=gy(i,o,f,h),y=H(o.shape),I=[],C=tt({inputs:{x:i},backend:t,attrs:{shape:[g.batchSize,g.outerSize,g.dimSize,g.sliceSize]}}),k=tt({inputs:{x:o},backend:t,attrs:{shape:[g.batchSize,y/g.batchSize]}});I.push(C),I.push(k);const N=[g.batchSize,g.outerSize,y/g.batchSize,g.sliceSize];if(t.shouldExecuteOnCPU([i,o])||i.dtype==="string"){const F=t.bufferSync(k),W=t.bufferSync(C),z=Hj(W,F,N);return I.forEach(X=>t.disposeIntermediateTensorInfo(X)),t.makeTensorInfo(g.outputShape,z.dtype,z.values)}const R=new Lee(C.shape,N),P=t.runWebGLProgram(R,[C,k],C.dtype);I.push(P);const L=tt({inputs:{x:P},backend:t,attrs:{shape:g.outputShape}});return I.forEach(F=>t.disposeIntermediateTensorInfo(F)),L}const Oee={kernelName:Nh,backendName:"webgl",kernelFunc:hA};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Pee=is({opSnippet:"return float(a > b);",packedOpSnippet:`
  return vec4(greaterThan(a, b));
`,cpuKernelImpl:jj,dtype:"bool"}),Fee={kernelName:dn,backendName:"webgl",kernelFunc:Pee};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Gee=is({opSnippet:"return float(a >= b);",packedOpSnippet:`
  return vec4(greaterThanEqual(a, b));
`,dtype:"bool",cpuKernelImpl:Yj}),_ee={kernelName:fr,backendName:"webgl",kernelFunc:Gee};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Vee(n){const{inputs:e,backend:t}=n,{input:s}=e;return uA(s,!0,t)}const Bee={kernelName:q,backendName:"webgl",kernelFunc:Vee};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Wee=nn({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),zee={kernelName:qn,backendName:"webgl",kernelFunc:Wee};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Xee=nn({opSnippet:"return float(isinf(x));",dtype:"bool"}),Zee={kernelName:Jr,backendName:"webgl",kernelFunc:Xee};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Kee=nn({opSnippet:"return float(isnan(x));",dtype:"bool"}),$ee={kernelName:ic,backendName:"webgl",kernelFunc:Kee};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Uee=is({opSnippet:"return float(a < b);",packedOpSnippet:`
  return vec4(lessThan(a, b));
`,cpuKernelImpl:Qj,dtype:"bool"}),Hee={kernelName:cs,backendName:"webgl",kernelFunc:Uee};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const jee=is({opSnippet:"return float(a <= b);",packedOpSnippet:`
  return vec4(lessThanEqual(a, b));
`,cpuKernelImpl:Jj,dtype:"bool"}),Yee={kernelName:wt,backendName:"webgl",kernelFunc:jee};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Qee(n){const{backend:e,attrs:t}=n,{start:s,stop:i,num:o}=t,c=qj(s,i,o);return e.makeTensorInfo([c.length],"float32",c)}const Jee={kernelName:Bn,backendName:"webgl",kernelFunc:Qee};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const qee=bd+`
  return x < 0.0 ? 0./0. : log(x);
`,ete=nn({opSnippet:qee,packedOpSnippet:`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,cpuKernelImpl:eY}),tte={kernelName:Pl,backendName:"webgl",kernelFunc:ete};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const nte=bd+`
  return log(1.0 + x);
`,rte=nn({opSnippet:nte}),ste={kernelName:ac,backendName:"webgl",kernelFunc:rte};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ite=is({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,dtype:"bool"}),ate={kernelName:Fl,backendName:"webgl",kernelFunc:ite};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ote=nn({opSnippet:"return float(!(x >= 1.0));"}),lte={kernelName:Xo,backendName:"webgl",kernelFunc:ote};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ute=is({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,dtype:"bool"}),cte={kernelName:Gl,backendName:"webgl",kernelFunc:ute};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class hte{constructor(e,t,s,i,o){this.variableNames=["x"],this.outputShape=[];const c=t,h=e[3]-1;this.outputShape=e;let f;const g=`float(${s}) + float(${i}) * sum`;o===.5?f=`inversesqrt(${g})`:o===1?f=`1.0/(${g})`:f=`exp(log(${g}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${c}; j <= ${c}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${h}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${f};
        setOutput(val);
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class dte{constructor(e,t,s,i,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const c=t,h=e[3]-1;this.outputShape=e;let f;const g=`float(${s}) + float(${i}) * sum`;o===.5?f=`inversesqrt(${g})`:o===1?f=`1.0/(${g})`:f=`exp(log(${g}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${c};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${c}; j <= ${c}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${h}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${f};
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const fte={kernelName:ir,backendName:"webgl",kernelFunc:n=>{const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{depthRadius:o,bias:c,alpha:h,beta:f}=s,g=ke().getBool("WEBGL_PACK_NORMALIZATION")?new dte(i.shape,o,c,h,f):new hte(i.shape,o,c,h,f);return t.runWebGLProgram(g,[i],i.dtype)}};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class pte{constructor(e,t,s,i,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=s,this.alpha=i,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${i}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${i})
                * float(${o})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${o});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const mte={kernelName:Zo,backendName:"webgl",kernelFunc:n=>{const{inputs:e,backend:t,attrs:s}=n,{x:i,y:o,dy:c}=e,{depthRadius:h,bias:f,alpha:g,beta:y}=s,I=new pte(i.shape,h,f,g,y);return t.runWebGLProgram(I,[i,o,c],i.dtype)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function gte(n,e,t,s){const i=H(e),o=H(n.shape)/i,c=tt({inputs:{x:n},attrs:{shape:[o,i]},backend:s}),h=jc(c,n.dtype,"max",s),f=tt({inputs:{x:h},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(c),s.disposeIntermediateTensorInfo(h),f}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function dA(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{reductionIndices:o,keepDims:c}=s,h=i.shape.length,f=be(o,i.shape);let g=f;const y=er(g,h),I=y!=null,C=t.shouldExecuteOnCPU([i]);let k=i;if(I){if(C){const F=t.texData.get(k.dataId).values,W=new Array(h);for(let Q=0;Q<W.length;Q++)W[Q]=i.shape[y[Q]];const z=Ib(F,i.shape,i.dtype,y,W);k=t.makeTensorInfo(W,i.dtype);const X=t.texData.get(k.dataId);X.values=z}else k=D1(i,y,t);g=gr(g.length,h)}rs("max",g,h);const[N,R]=Xr(k.shape,g);let P=N;c&&(P=kr(N,f));let L;if(C){const F=t.texData.get(k.dataId).values,W=tY(F,H(R),P,i.dtype);L=t.makeTensorInfo(P,i.dtype);const z=t.texData.get(L.dataId);z.values=W}else L=gte(k,R,P,t);return I&&t.disposeIntermediateTensorInfo(k),L}const xte={kernelName:yi,backendName:"webgl",kernelFunc:dA};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const yte=Sb+`
  return max(a, b);
`,bte=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Hc+`
  return result;
`,wte=is({opSnippet:yte,packedOpSnippet:bte,cpuKernelImpl:nY}),vte={kernelName:Ct,backendName:"webgl",kernelFunc:wte};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ite(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e;rp(i,"maxPool");const{filterSize:o,strides:c,pad:h,dimRoundingMode:f}=s,g=1;D(ds(c,g),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${c} and dilations '${g}'`);const y=qi(i.shape,o,c,g,h,f);if(y.filterWidth===1&&y.filterHeight===1&&se(y.inShape,y.outShape))return ci({inputs:{x:i},backend:t});const I=new ap(y,"max",!1);return t.runWebGLProgram(I,[i],i.dtype)}const Cte={kernelName:Ah,backendName:"webgl",kernelFunc:Ite};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ste(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{filterSize:o,strides:c,pad:h,dataFormat:f,dimRoundingMode:g}=s,y=[1,1,1],I=el(i.shape,o,c,y,h,g,f),C=new kb(I,"max",!1);return t.runWebGLProgram(C,[i],i.dtype)}const Tte={kernelName:pr,backendName:"webgl",kernelFunc:Ste};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class kte{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,s=e.strideWidth,i=e.dilationHeight,o=e.effectiveFilterHeight,c=e.effectiveFilterWidth,h=o-1-e.padInfo.top,f=c-1-e.padInfo.left,g=o*c-1;this.userCode=`
      const ivec2 pads = ivec2(${h}, ${f});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${o};
          wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${g} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${c} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class Ete{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,s=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,c=e.dilationHeight,h=e.dilationWidth,f=e.effectiveFilterDepth,g=e.effectiveFilterHeight,y=e.effectiveFilterWidth,I=f-1-e.padInfo.front,C=g-1-e.padInfo.top,k=y-1-e.padInfo.left,N=f*g*y-1;this.userCode=`
      const ivec3 pads = ivec3(${I}, ${C}, ${k});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${f};
           wD += ${o}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${g};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${y};
                wC += ${h}) {
              float dyC = float(dyCCorner + wC) / ${i}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${N} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${g} * ${y} +
                  wR * ${y} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Nte(n){const{inputs:e,backend:t,attrs:s}=n,{dy:i,input:o}=e,c=o,{filterSize:h,strides:f,pad:g,dimRoundingMode:y}=s,I=[1,1,1],C=el(c.shape,h,f,I,g,y),k=new kb(C,"max",!0),N=t.runWebGLProgram(k,[c],c.dtype),R=new Ete(C),P=t.runWebGLProgram(R,[i,N],c.dtype);return t.disposeIntermediateTensorInfo(N),P}const Ate={kernelName:df,backendName:"webgl",kernelFunc:Nte};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Rte(n){const{inputs:e,backend:t,attrs:s}=n,{dy:i,input:o,output:c}=e,h=o;rp([o,c],"maxPoolGrad");const{filterSize:f,strides:g,pad:y,dimRoundingMode:I}=s,C=qi(h.shape,f,g,1,y,I),k=!0,N=new ap(C,"max",k),R=t.runWebGLProgram(N,[h],h.dtype),P=new kte(C),L=t.runWebGLProgram(P,[i,R],h.dtype);return t.disposeIntermediateTensorInfo(R),L}const Mte={kernelName:Ot,backendName:"webgl",kernelFunc:Rte};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Lte(n,e,t,s){let i=new ap(t,"max",!1);const o=s.runWebGLProgram(i,[n],"float32");i=new ap(t,"max",!0,!0,e);const c=s.runWebGLProgram(i,[n],"float32");return[o,c]}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Dte={kernelName:Rh,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:i,strides:o,pad:c,includeBatchInIndex:h}=e,f=t;D(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const g=[1,1];D(ds(o,g),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${g}'`);const y=qi(s.shape,i,o,g,c),[I,C]=Lte(s,h,y,f);return[I,C]}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ote(n,e,t,s){const i=H(e),o=H(n.shape)/i,c=tt({inputs:{x:n},attrs:{shape:[o,i]},backend:s}),h=jc(c,"float32","mean",s),f=tt({inputs:{x:h},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(c),s.disposeIntermediateTensorInfo(h),f}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Pte={kernelName:oc,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{keepDims:i,axis:o}=e,c=t,h=s.shape.length,f=be(o,s.shape);let g=f;const y=er(g,h),I=y!=null,C=c.shouldExecuteOnCPU([s]),k=[];let N=s;if(I){if(C){const W=c.texData.get(N.dataId).values,z=new Array(h);for(let J=0;J<z.length;J++)z[J]=s.shape[y[J]];const X=Ib(W,s.shape,s.dtype,y,z);N=c.makeTensorInfo(z,s.dtype);const Q=c.texData.get(N.dataId);Q.values=X}else N=D1(s,y,c);k.push(N),g=gr(g.length,h)}rs("sum",g,h);const[R,P]=Xr(N.shape,g);let L=R;i&&(L=kr(R,f));const F=Ote(N,P,L,c);for(const W of k)c.disposeIntermediateTensorInfo(W);return F}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Fte(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{axis:o,keepDims:c}=s,h=i.shape.length,f=be(o,i.shape);let g=f;const y=er(g,h);let I=i;y!=null&&(I=Ms({inputs:{x:i},backend:t,attrs:{perm:y}}),g=gr(g.length,i.shape.length)),rs("min",g,h);const[C,k]=Xr(I.shape,g),N=H(k),R=tt({inputs:{x:I},backend:t,attrs:{shape:[-1,N]}}),P=jc(R,R.dtype,"min",t);let L;if(c){const F=kr(C,f);L=tt({inputs:{x:P},backend:t,attrs:{shape:F}})}else L=tt({inputs:{x:P},backend:t,attrs:{shape:C}});return t.disposeIntermediateTensorInfo(R),t.disposeIntermediateTensorInfo(P),y!=null&&t.disposeIntermediateTensorInfo(I),L}const Gte={kernelName:Yi,backendName:"webgl",kernelFunc:Fte};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const _te=Sb+`
  return min(a, b);
`,Vte=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Hc+`
  return result;
`,Bte=is({opSnippet:_te,packedOpSnippet:Vte,cpuKernelImpl:rY}),Wte={kernelName:lc,backendName:"webgl",kernelFunc:Bte};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class zte{constructor(e,t,s){this.variableNames=["x"],this.outputShape=t.map((y,I)=>y[0]+e[I]+y[1]);const i=e.length,o=wn(i),c=t.map(y=>y[0]).join(","),h=t.map((y,I)=>y[0]+e[I]).join(","),f=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i),g=s==="reflect"?0:1;if(i===1){this.userCode=`
        int start = ${c};
        int end = ${h};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${g};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${g};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${c});
      ${o} end = ${o}(${h});

      void main() {
        ${o} outC = getOutputCoords();
        for (int i = 0; i < ${i}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${g};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${g};
          }
        }
        ${o} coords = outC - start;
        setOutput(getX(${f}));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Xte{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((N,R)=>N[0]+e[R]+N[1]);const i=e.length,o=wn(i),c=t.map(N=>N[0]).join(","),h=t.map((N,R)=>N[0]+e[R]).join(","),f=Rs("rc",i),g=Rs("source",i),y=`${f[i-1]} < ${this.outputShape[i-1]}`,I=i===1?"source":`vec2(${g.slice(-2).join()})`,C=s==="reflect"?0:1;let k="";if(i===1){const N=`
        ${o} source = rc;
        if (source < start) {
          source = start * 2 - source - ${C};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${C};
        }
        source -= start;
      `;k=`
        ${o} rc = outputLoc;
        ${N}
        result[0] = getChannel(getX(${g.join()}), ${I});
        ${f[i-1]} += 1;
        if(${y}) {
          ${N}
          result[1] = getChannel(getX(${g.join()}), ${I});
        }
      `}else{const N=`
        ${o} source = rc;
        ${o} lt = ${o}(lessThan(source, start));
        ${o} gte = ${o}(greaterThanEqual(source, end));
        ${o} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${C}) +
                gte * ((end - 1) * 2 - source + ${C});
        source -= start;
      `;k=`
        ${o} rc = outputLoc;
        ${N}
        result[0] = getChannel(getX(${g.join()}), ${I});
        ${f[i-1]} += 1;
        if(${y}) {
          ${N}
          result[1] = getChannel(getX(${g.join()}), ${I});
        }
        rc = outputLoc;
        ${f[i-2]} += 1;
        if(${f[i-2]} < ${this.outputShape[i-2]}) {
          ${N}
          result[2] = getChannel(getX(${g.join()}), ${I});
          ${f[i-1]} += 1;
          if(${y}) {
            ${N}
            result[3] = getChannel(getX(${g.join()}), ${I});
          }
        }
      `}this.userCode=`
      const ${o} start = ${o}(${c});
      const ${o} end = ${o}(${h});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${k}
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Zte={kernelName:eo,backendName:"webgl",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s}=n,{paddings:i,mode:o}=t,c=ke().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Xte(s.shape,i,o):new zte(s.shape,i,o);return e.runWebGLProgram(c,[s],s.dtype)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Kte=`if (b == 0.0) return NAN;
  return mod(a, b);`,$te=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Hc+`
  return result;
`,Ute=is({opSnippet:Kte,packedOpSnippet:$te}),Hte={kernelName:wa,backendName:"webgl",kernelFunc:Ute};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class jte{constructor(e,t,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const fA=is({opSnippet:`
if (a == b) {
  return 1.0;
};
return a / b;`,packedOpSnippet:`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,checkOutOfBounds:!0}),Yte={kernelName:nc,backendName:"webgl",kernelFunc:fA};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const pA="return a - b;",mA=is({opSnippet:pA,packedOpSnippet:pA,supportsComplex:!0,cpuKernelImpl:SY}),Qte={kernelName:Is,backendName:"webgl",kernelFunc:mA};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function gA(n){const{inputs:e,backend:t,attrs:s}=n,{logits:i}=e,{dim:o}=s,c=be([o],i.shape),h=dA({inputs:{x:i},backend:t,attrs:{reductionIndices:c,keepDims:!1}}),f=kr(h.shape,c),g=tt({inputs:{x:h},backend:t,attrs:{shape:f}}),y=mA({inputs:{a:i,b:g},backend:t}),I=aA({inputs:{x:y},backend:t}),C=O1({inputs:{x:I},backend:t,attrs:{axis:c,keepDims:!1}}),k=tt({inputs:{x:C},backend:t,attrs:{shape:f}}),N=fA({inputs:{a:I,b:k},backend:t});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(I),t.disposeIntermediateTensorInfo(C),t.disposeIntermediateTensorInfo(k),N}const Jte={kernelName:Zl,backendName:"webgl",kernelFunc:gA};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function qte(n){const{inputs:e,backend:t,attrs:s}=n,{logits:i}=e,{numSamples:o,seed:c,normalized:h}=s,f=h?i:gA({inputs:{logits:i},backend:t,attrs:{dim:i.shape.length-1}}),g=f.shape[0],y=f.shape[1],I=new jte(g,y,o),C=[[c]],k=t.runWebGLProgram(I,[f],"int32",C);return h||t.disposeIntermediateTensorInfo(f),k}const ene={kernelName:_l,backendName:"webgl",kernelFunc:qte};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const tne=la+`
  return -x;
`,nne=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function rne(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])){const o=t.texData.get(s.dataId),[c,h]=iY(o.values,s.shape,s.dtype);return t.makeTensorInfo(h,s.dtype,c)}let i;return ke().getBool("WEBGL_PACK_UNARY_OPERATIONS")?i=new mu(s.shape,nne):i=new bo(s.shape,tne),t.runWebGLProgram(i,[s],s.dtype)}const sne={kernelName:to,backendName:"webgl",kernelFunc:rne};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ine=_x;function ane(n){Z("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:i,scores:o}=e,{maxOutputSize:c,iouThreshold:h,scoreThreshold:f}=s,g=t.readSync(i.dataId),y=t.readSync(o.dataId),{selectedIndices:I}=ine(g,y,c,h,f);return t.makeTensorInfo([I.length],"int32",new Int32Array(I))}const one={kernelName:qr,backendName:"webgl",kernelFunc:ane};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const lne=Vx;function une(n){Z("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:i,scores:o}=e,{maxOutputSize:c,iouThreshold:h,scoreThreshold:f,padToMaxOutputSize:g}=s,y=t.readSync(i.dataId),I=t.readSync(o.dataId),{selectedIndices:C,validOutputs:k}=lne(y,I,c,h,f,g);return[t.makeTensorInfo([C.length],"int32",new Int32Array(C)),t.makeTensorInfo([],"int32",new Int32Array([k]))]}const cne={kernelName:Mh,backendName:"webgl",kernelFunc:une};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const hne=Bx;function dne(n){Z("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:i,scores:o}=e,{maxOutputSize:c,iouThreshold:h,scoreThreshold:f,softNmsSigma:g}=s,y=t.readSync(i.dataId),I=t.readSync(o.dataId),C=c,k=h,N=f,R=g,{selectedIndices:P,selectedScores:L}=hne(y,I,C,k,N,R);return[t.makeTensorInfo([P.length],"int32",new Int32Array(P)),t.makeTensorInfo([L.length],"float32",new Float32Array(L))]}const fne={kernelName:Lh,backendName:"webgl",kernelFunc:dne};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class pne{constructor(e,t,s,i){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${i}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const mne={kernelName:Dh,backendName:"webgl",kernelFunc:n=>{const{inputs:e,backend:t,attrs:s}=n,{indices:i}=e,{dtype:o,depth:c,onValue:h,offValue:f}=s,g=H(i.shape),y=new pne(g,c,h,f),I=tt({inputs:{x:i},backend:t,attrs:{shape:[g]}}),C=t.runWebGLProgram(y,[I],o);t.disposeIntermediateTensorInfo(I);const k=[...i.shape,c],N=tt({inputs:{x:C},backend:t,attrs:{shape:k}});return t.disposeIntermediateTensorInfo(C),N}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function B1(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="complex64"){const i=op({inputs:{input:s},backend:t}),o=B1({inputs:{x:i},backend:t}),c=_1({inputs:{input:s},backend:t}),h=B1({inputs:{x:c},backend:t}),f=gu({inputs:{real:o,imag:h},backend:t});return t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(h),f}else return cp({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:t})}const gne={kernelName:b,backendName:"webgl",kernelFunc:B1};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xA(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const i=op({inputs:{input:s},backend:t}),o=xA({inputs:{x:i},backend:t}),c=_1({inputs:{input:s},backend:t}),h=B1({inputs:{x:c},backend:t}),f=gu({inputs:{real:o,imag:h},backend:t});return t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(h),f}else return cp({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:t})}const xne={kernelName:uc,backendName:"webgl",kernelFunc:xA};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yne(n){const{inputs:e,backend:t,attrs:s}=n,{axis:i}=s;if(e.length===1)return Ab({inputs:{input:e[0]},backend:t,attrs:{dim:i}});const o=e[0].shape,c=e[0].dtype;e.forEach(y=>{$(o,y.shape,"All tensors passed to stack must have matching shapes"),D(c===y.dtype,()=>"All tensors passed to stack must have matching dtypes")});const h=[],f=e.map(y=>{const I=Ab({inputs:{input:y},backend:t,attrs:{dim:i}});return h.push(I),I}),g=jN({inputs:f,backend:t,attrs:{axis:i}});return h.forEach(y=>t.disposeIntermediateTensorInfo(y)),g}const bne={kernelName:Oh,backendName:"webgl",kernelFunc:yne};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class wne{constructor(e,t,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((g,y)=>g[0]+e[y]+g[1]);const i=e.length,o=wn(i),c=t.map(g=>g[0]).join(","),h=t.map((g,y)=>g[0]+e[y]).join(","),f=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i);if(i===1){this.userCode=`
        int start = ${c};
        int end = ${h};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${c});
      ${o} end = ${o}(${h});

      void main() {
        ${o} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${o} coords = outC - start;
          setOutput(getX(${f}));
        }
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class vne{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((R,P)=>R[0]+e[P]+R[1]);const i=e.length,o=wn(i),c=t.map(R=>R[0]).join(","),h=t.map((R,P)=>R[0]+e[P]).join(","),f=Rs("rc",i),g=Rs("source",i),y=`${f[i-1]} < ${this.outputShape[i-1]}`,I=i===1?"source":`vec2(${g.slice(-2).join()})`,C=[`${o} rc = outputLoc;`,`${f[i-1]} += 1;
       if(${y}) {
      `,i===1?"":`}
       rc = outputLoc;
       ${f[i-2]} += 1;
       if(${f[i-2]} < ${this.outputShape[i-2]}) {`,i===1?"":`  ${f[i-1]} += 1;
         if(${y}) {`],k=i===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let N="";for(let R=0,P=i===1?2:4;R<P;R++)N+=`
        ${C[R]}
        if (${k}) {
          result[${R}] = float(value);
        } else {
          ${o} source = rc - start;
          result[${R}] = getChannel(getX(${g.join()}), ${I});
        }
      `;N+=i===1?"} ":"}}",this.userCode=`
      const ${o} start = ${o}(${c});
      const ${o} end = ${o}(${h});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${N}
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const yA=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{paddings:o,constantValue:c}=s;if(H(i.shape)===0){const g=o.map((y,I)=>y[0]+i.shape[I]+y[1]);return cp({backend:t,attrs:{shape:g,value:c,dtype:i.dtype}})}const h=ke().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new vne(i.shape,o,c):new wne(i.shape,o,c),f=[[c]];return t.runWebGLProgram(h,[i],i.dtype,f)},Ine={kernelName:Ph,backendName:"webgl",kernelFunc:yA};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Cne=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,Sne=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Hc+`
  return result;
`,Tne=is({opSnippet:Cne,packedOpSnippet:Sne}),kne={kernelName:rn,backendName:"webgl",kernelFunc:Tne};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ene(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{axis:o,keepDims:c}=s,h=i.shape.length,f=[],g=be(o,i.shape);let y=g;const I=er(y,h);let C=i;I!=null&&(C=Ms({inputs:{x:i},backend:t,attrs:{perm:I}}),y=gr(y.length,h),f.push(C)),rs("prod",y,h);let k;if(t.shouldExecuteOnCPU([C])){const N=t.texData.get(C.dataId).values,{outVals:R,outShape:P,outDtype:L}=oY(C.shape,C.dtype,N,y);k=t.makeTensorInfo(P,L,R)}else{const[N,R]=Xr(C.shape,y),P=H(R),L=tt({inputs:{x:C},backend:t,attrs:{shape:[-1,P]}}),F=qg(i.dtype),W=jc(L,F,"prod",t);k=tt({inputs:{x:W},backend:t,attrs:{shape:N}}),f.push(L),f.push(W)}if(c){f.push(k);const N=kr(k.shape,g);k=tt({inputs:{x:k},backend:t,attrs:{shape:N}})}return f.forEach(N=>t.disposeIntermediateTensorInfo(N)),k}const Nne={kernelName:Ko,backendName:"webgl",kernelFunc:Ene};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ane(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:i,paramsDenseValues:o,indices:c}=e,{outputRaggedRank:h}=s,f=i.map(L=>t.readSync(L.dataId)),g=i.map(L=>L.shape),y=t.readSync(o.dataId),I=t.readSync(c.dataId),[C,k,N]=lY(f,g,y,o.shape,o.dtype,I,c.shape,h),R=C.map(L=>t.makeTensorInfo([L.length],"int32",L)),P=t.makeTensorInfo(N,o.dtype,k);return R.concat([P])}const Rne={kernelName:va,backendName:"webgl",kernelFunc:Ane};/**
* @license
* Copyright 2022 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Mne(n){const{inputs:e,backend:t}=n,{starts:s,limits:i,deltas:o}=e,c=t.readSync(s.dataId),h=t.readSync(i.dataId),f=t.readSync(o.dataId),[g,y]=uY(c,s.shape,s.dtype,h,i.shape,f,o.shape),I=t.makeTensorInfo([g.length],"int32",g),C=t.makeTensorInfo([y.length],s.dtype,y);return[I,C]}const Lne={kernelName:C0,backendName:"webgl",kernelFunc:Mne};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Dne(n){const{inputs:e,backend:t,attrs:s}=n,{shape:i,values:o,defaultValue:c,rowPartitionTensors:h}=e,{rowPartitionTypes:f}=s,g=t.readSync(i.dataId),y=t.readSync(o.dataId),I=t.readSync(c.dataId),C=h.map(P=>t.readSync(P.dataId)),k=h.map(P=>P.shape),[N,R]=cY(g,i.shape,y,o.shape,o.dtype,I,c.shape,C,k,f);return t.makeTensorInfo(N,o.dtype,R)}const One={kernelName:Ae,backendName:"webgl",kernelFunc:Dne};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const bA=n=>{const{backend:e,attrs:t}=n,{start:s,stop:i,step:o,dtype:c}=t,h=hY(s,i,o,c);return e.makeTensorInfo([h.length],c,h)},Pne={kernelName:Gt,backendName:"webgl",kernelFunc:bA};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Fne=nn({opSnippet:"return 1.0 / x;"}),Gne={kernelName:ro,backendName:"webgl",kernelFunc:Fne};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const _ne=la+`
  return (x < 0.0) ? 0.0 : x;
`,Vne=nn({opSnippet:_ne,packedOpSnippet:`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`}),Bne={kernelName:Bl,backendName:"webgl",kernelFunc:Vne};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Wne=la+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,zne=nn({opSnippet:Wne,packedOpSnippet:`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`}),Xne={kernelName:$o,backendName:"webgl",kernelFunc:zne};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Zne{constructor(e,t,s,i,o){this.variableNames=["A"],this.outputShape=[];const[c,h,f,g]=e;this.outputShape=[c,t,s,g];const y=[i&&t>1?h-1:h,i&&s>1?f-1:f],I=[i&&t>1?t-1:t,i&&s>1?s-1:s];let C;o?C="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":C="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${y[0]/I[0]},
          ${y[1]/I[1]});
      const vec2 inputShapeRC = vec2(${h}.0, ${f}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${C};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Kne{constructor(e,t,s,i,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[c,h,f,g]=e;this.outputShape=[c,t,s,g];const y=[i&&t>1?h-1:h,i&&s>1?f-1:f],I=[i&&t>1?t-1:t,i&&s>1?s-1:s];let C;o?C="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":C="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${y[0]/I[0]},
          ${y[1]/I[1]},
          ${y[1]/I[1]});
      const vec3 inputShapeRC = vec3(${h}.0, ${f}.0,
                                     ${f}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${C};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${g-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function $ne(n){const{inputs:e,backend:t,attrs:s}=n,{images:i}=e,{alignCorners:o,halfPixelCenters:c,size:h}=s,[f,g]=h,y=ke().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Kne(i.shape,f,g,o,c):new Zne(i.shape,f,g,o,c);return t.runWebGLProgram(y,[i],"float32")}const Une={kernelName:Wl,backendName:"webgl",kernelFunc:$ne};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Hne{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,i,o]=t,[,c,h]=e,f=[s&&c>1?i-1:i,s&&h>1?o-1:o],g=[s&&c>1?c-1:c,s&&h>1?h-1:h],y=f[0]/g[0],I=f[1]/g[1],C=1/y,k=1/I,N=Math.ceil(C)*2+2,R=Math.ceil(k)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${y});
        const float widthScale = float(${I});

        const float invHeightScale = float(${C});
        const float invWidthScale = float(${k});

        const int winHeight = int(${N});
        const int winWidth = int(${R});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${c}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${h}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${i-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${o-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function jne(n){const{inputs:e,backend:t,attrs:s}=n,{images:i,dy:o}=e,{alignCorners:c}=s,h=new Hne(o.shape,i.shape,c);return t.runWebGLProgram(h,[o],o.dtype)}const Yne={kernelName:ar,backendName:"webgl",kernelFunc:jne};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Qne{constructor(e,t,s,i,o){this.variableNames=["A"],this.outputShape=[];const[c,h,f,g]=e;this.outputShape=[c,t,s,g];const y=[i&&t>1?h-1:h,i&&s>1?f-1:f],I=[i&&t>1?t-1:t,i&&s>1?s-1:s],C=i?"0.5":"0.0";let k;o?k="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":k="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${y[0]/I[0]},
          ${y[1]/I[1]});
      const vec2 inputShapeRC = vec2(${h}.0, ${f}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${k};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${C})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Jne{constructor(e,t,s,i,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[c,h,f,g]=e;this.outputShape=[c,t,s,g];const y=[i&&t>1?h-1:h,i&&s>1?f-1:f],I=[i&&t>1?t-1:t,i&&s>1?s-1:s],C=i?"0.5":"0.0";let k;o?k="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":k="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${y[0]/I[0]},
          ${y[1]/I[1]},
          ${y[1]/I[1]});
      const vec3 inputShapeRC = vec3(${h}.0, ${f}.0,
                                     ${f}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${k};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${C})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${g-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function qne(n){const{inputs:e,backend:t,attrs:s}=n,{images:i}=e,{alignCorners:o,halfPixelCenters:c,size:h}=s,[f,g]=h,y=ke().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Jne(i.shape,f,g,o,c):new Qne(i.shape,f,g,o,c);return t.runWebGLProgram(y,[i],i.dtype)}const ere={kernelName:Gh,backendName:"webgl",kernelFunc:qne};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class tre{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,i,o]=t,[,c,h]=e,f=[s&&c>1?i-1:i,s&&h>1?o-1:o],g=[s&&c>1?c-1:c,s&&h>1?h-1:h],y=f[0]/g[0],I=f[1]/g[1],C=1/y,k=1/I,N=Math.ceil(C)*2+2,R=Math.ceil(k)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${y});
        const float widthScale = float(${I});

        const float invHeightScale = float(${C});
        const float invWidthScale = float(${k});

        const int winHeight = int(${N});
        const int winWidth = int(${R});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${c}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${h}) {
              continue;
            }

            float sourceFracRow =
              float(${f[0]}) *
                (float(dyR) / float(${g[0]}));

            float sourceFracCol =
                float(${f[1]}) *
                  (float(dyC) / float(${g[1]}));

            int sourceNearestRow = int(min(
                float(int(${i}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${o}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function nre(n){const{inputs:e,backend:t,attrs:s}=n,{images:i,dy:o}=e,{alignCorners:c}=s,h=new tre(o.shape,i.shape,c);return t.runWebGLProgram(h,[o],o.dtype)}const rre={kernelName:ff,backendName:"webgl",kernelFunc:nre};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class sre{constructor(e,t){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const i=h=>t.indexOf(h)!==-1&&e[h]!==1?`${e[h]} - coords[${h}] - 1`:`coords[${h}]`,o=e.map((h,f)=>i(f)).join(","),c=wn(s);this.userCode=`
      void main() {
        ${c} coords = getOutputCoords();
        setOutput(getX(${o}));
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class ire{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const i=Rs("rc",s),o=`${i[s-1]} + 1 < ${this.outputShape[s-1]}`,c=`${i[s-2]} + 1 < ${this.outputShape[s-2]}`,h=wn(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${o}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${h} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${f(i.slice())};
          if(${o}){
            result.g = ${g(i.slice())};
          }
          if(${c}) {
            result.b = ${y(i.slice())};
            if(${o}) {
              result.a = ${I(i.slice())};
            }
          }
          setOutput(result);
        }
    `;function f(N){return C(N)}function g(N){return N[s-1]="("+N[s-1]+" + 1)",C(N)}function y(N){return N[s-2]="("+N[s-2]+" + 1)",C(N)}function I(N){return N[s-1]="("+N[s-1]+" + 1)",N[s-2]="("+N[s-2]+" + 1)",C(N)}function C(N){const R=e.map((F,W)=>k(W,N)),P=R.join(","),L=R.slice(-2).join(",");return`getChannel(getX(${P}), vec2(${L}))`}function k(N,R){return t.indexOf(N)!==-1&&e[N]!==1?`${e[N]} - ${R[N]} - 1`:`${R[N]}`}}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function are(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{dims:o}=s,c=i.shape.length,h=be(o,i.shape);if(c===0)return ci({inputs:{x:i},backend:t});const f=ke().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ire(i.shape,h):new sre(i.shape,h);return t.runWebGLProgram(f,[i],i.dtype)}const ore={kernelName:Mn,backendName:"webgl",kernelFunc:are};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class lre{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],i=e[2];this.outputShape=e;let o="";typeof t=="number"?o=`float outputValue = ${t.toFixed(2)};`:o=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${o}
          if(coordX >= 0 && coordX < ${i} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ure={kernelName:E,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:i,fillValue:o,center:c}=e,h=t,f=new lre(s.shape,o),[g,y]=Jx(c,s.shape[1],s.shape[2]),I=[[g,y,Math.sin(i),Math.cos(i)]];return h.runWebGLProgram(f,[s],s.dtype,I)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const cre=nn({opSnippet:`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`}),hre={kernelName:so,backendName:"webgl",kernelFunc:cre};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const dre=nn({opSnippet:"return inversesqrt(x);",cpuKernelImpl:dY}),fre={kernelName:bi,backendName:"webgl",kernelFunc:dre};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Mb{constructor(e,t,s,i,o,c,h=!0,f=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=c;const g=wn(o.length),y=wn(c.length);let I="";s===1?I="i":s===2&&(I="i, j");const C=`getIndices(${I})`;let k="";i===1?k="i":i===2&&(k="i, coords[1]");const N=`getUpdates(${k})`;let R="";f&&(R="coords[0], coords[1]");const P=`getDefaultValue(${R})`,L=t>1?"strides[j]":"strides";this.userCode=`
        ${g} strides = ${g}(${o});

        void main() {
          ${y} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${C});
              flattenedIndex += index * ${L};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${N};
              found = true;
            }
          }
          setOutput(mix(${P}, sum, float(found)));
        }
      `}}/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class pre{constructor(e,t,s,i,o,c,h=!0,f=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=c;const g=wn(o.length),y=wn(c.length);let I="";s===1?I="i":s===2&&(I="i, j");const C=`getIndices(${I})`;let k="";i===1?k="i":i===2&&(k="i, coords[1]");const N=`getUpdates(${k})`;let R="";f&&(R="coords[0], coords[1]");const P=`getDefaultValue(${R})`,L=t>1?"strides[j]":"strides",F=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${g} strides = ${g}(${o});

        void main() {
          ${y} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${C});
              flattenedIndex += index.xz * ${L};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${F};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${N};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${P}, sum, found));
        }
      `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mre(n){const{inputs:e,backend:t,attrs:s}=n,{indices:i,updates:o}=e,{shape:c}=s,{sliceRank:h,numUpdates:f,sliceSize:g,strides:y,outputSize:I}=Mc(o,i,c),C=[I/g,g];if(I===0)return t.makeTensorInfo(c,i.dtype);const k=tt({inputs:{x:i},backend:t,attrs:{shape:[f,h]}}),N=tt({inputs:{x:o},backend:t,attrs:{shape:[f,g]}}),R=t.makeTensorInfo([],"float32",new Float32Array([0]));let P;ke().getBool("WEBGL_PACK")?P=new pre(f,h,k.shape.length,N.shape.length,y,C):P=new Mb(f,h,k.shape.length,N.shape.length,y,C);const L=t.runWebGLProgram(P,[N,k,R],N.dtype),F=tt({inputs:{x:L},backend:t,attrs:{shape:c}});return t.disposeIntermediateTensorInfo(k),t.disposeIntermediateTensorInfo(N),t.disposeIntermediateTensorInfo(L),t.disposeIntermediateTensorInfo(R),F}const gre={kernelName:pn,backendName:"webgl",kernelFunc:mre};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class xre{constructor(e,t,s,i){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const o="while (left < right) {",c=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,h=ke().getNumber("WEBGL_VERSION")===2?o:c,f=i==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${h}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${f} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yre(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:i,values:o}=e,{side:c}=s,h=new xre(i.shape[0],i.shape[1],o.shape[1],c),f=[[i.shape[1]]];return t.runWebGLProgram(h,[i,o],"int32",f)}const bre={kernelName:S0,backendName:"webgl",kernelFunc:yre};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class wre{constructor(e,t,s){this.variableNames=["c","a","b"],this.outputShape=t;let i,o;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)o="resRC",i="resRC";else{const h=["resRC.x","resRC.y","resRC.z","resRC.w"],f=[],g=[];for(let y=0;y<t.length;y++)g.push(`${h[y]}`),y<e&&f.push(`${h[y]}`);i=f.join(),o=g.join()}const c=wn(s);this.userCode=`
      void main() {
        ${c} resRC = getOutputCoords();
        float cVal = getC(${i});
        if (cVal >= 1.0) {
          setOutput(getA(${o}));
        } else {
          setOutput(getB(${o}));
        }
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vre(n){const{inputs:e,backend:t}=n,{condition:s,t:i,e:o}=e,c=new wre(s.shape.length,i.shape,i.shape.length);return t.runWebGLProgram(c,[s,i,o],ai(i.dtype,o.dtype))}const Ire={kernelName:mn,backendName:"webgl",kernelFunc:vre};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Cre=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${$0};
  float scale = ${U0};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Sre=nn({opSnippet:Cre}),Tre={kernelName:wi,backendName:"webgl",kernelFunc:Sre};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const kre=bd+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,Ere=nn({opSnippet:kre,packedOpSnippet:`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cpuKernelImpl:pY}),Nre={kernelName:zl,backendName:"webgl",kernelFunc:Ere};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Are=nn({opSnippet:`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`}),Rre={kernelName:Uo,backendName:"webgl",kernelFunc:Are};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Mre=bd+`
  return sin(x);
`,Lre=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Hc}
  return result;
`,Dre=nn({opSnippet:Mre,packedOpSnippet:Lre}),Ore={kernelName:hc,backendName:"webgl",kernelFunc:Dre};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Pre=nn({opSnippet:`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`}),Fre={kernelName:vs,backendName:"webgl",kernelFunc:Pre};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Gre=nn({opSnippet:`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`}),_re={kernelName:Ho,backendName:"webgl",kernelFunc:Gre};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Vre={kernelName:_h,backendName:"webgl",kernelFunc:n=>{const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{blockShape:o,paddings:c}=s;D(i.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const h=o.reduce((L,F)=>L*F),f=[[0,0]];f.push(...c);for(let L=1+o.length;L<i.shape.length;++L)f.push([0,0]);const g=[],y=yA({inputs:{x:i},backend:t,attrs:{paddings:f,constantValue:0}}),I=Df(y.shape,o,h,!1),C=Of(I.length,o.length,!1),k=Pf(y.shape,o,h,!1),N=tt({inputs:{x:y},backend:t,attrs:{shape:I}}),R=Ms({inputs:{x:N},backend:t,attrs:{perm:C}}),P=tt({inputs:{x:R},backend:t,attrs:{shape:k}});return g.push(y),g.push(N),g.push(R),g.forEach(L=>t.disposeIntermediateTensorInfo(L)),P}};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Bre(n){const{inputs:e,backend:t}=n,{indices:s,values:i,denseShape:o,defaultValue:c}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(i.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${i.shape}`);if(c.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${c.shape}`);const h=t.readSync(s.dataId),f=t.readSync(i.dataId),g=t.readSync(o.dataId),y=t.readSync(c.dataId)[0],[I,C,k,N,R]=gY(h,s.shape,s.dtype,f,i.dtype,g,y);return[t.makeTensorInfo(C,s.dtype,I),t.makeTensorInfo([C[0]],i.dtype,k),t.makeTensorInfo([N.length],"bool",new Uint8Array(N.map(P=>Number(P)))),t.makeTensorInfo([R.length],s.dtype,new Int32Array(R))]}const Wre={kernelName:T0,backendName:"webgl",kernelFunc:Bre};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function zre(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:i,newShape:o}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(i.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${i.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const c=Array.from(t.readSync(i.dataId)),h=t.readSync(s.dataId),f=Array.from(t.readSync(o.dataId)),[g,y,I]=xY(h,s.shape,s.dtype,c,f);return[t.makeTensorInfo(y,s.dtype,g),t.makeTensorInfo([I.length],o.dtype,new Int32Array(I))]}const Xre={kernelName:Kl,backendName:"webgl",kernelFunc:zre};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Zre(n){const{inputs:e,backend:t}=n,{data:s,indices:i,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${i.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${o.shape}`);const c=t.readSync(s.dataId),h=t.readSync(i.dataId),f=t.readSync(o.dataId),[g,y]=SN(c,s.shape,s.dtype,h,f,!0);return t.makeTensorInfo(y,s.dtype,g)}const Kre={kernelName:k0,backendName:"webgl",kernelFunc:Zre};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function $re(n){const{inputs:e,backend:t}=n,{data:s,indices:i,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${i.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${o.shape}`);const c=t.readSync(s.dataId),h=t.readSync(i.dataId),f=t.readSync(o.dataId),[g,y]=SN(c,s.shape,s.dtype,h,f);return t.makeTensorInfo(y,s.dtype,g)}const Ure={kernelName:Sa,backendName:"webgl",kernelFunc:$re};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Hre(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:i,sparseValues:o,defaultValue:c}=e,{outputShape:h}=s,{sliceRank:f,numUpdates:g,sliceSize:y,strides:I,outputSize:C}=Mc(o,i,h),k=!1;if(o.dtype==="string"){const L=t.bufferSync(i),F=t.bufferSync(o),W=Yl(t.readSync(c.dataId)[0]),z=fY(L,F,h,C,y,g,f,I,W,k);return t.makeTensorInfo(h,z.dtype,z.values)}const N=new Mb(g,f,i.shape.length,o.shape.length,I,[C,1],k),R=t.runWebGLProgram(N,[o,i,c],o.dtype),P=tt({inputs:{x:R},backend:t,attrs:{shape:h}});return t.disposeIntermediateTensorInfo(R),P}const jre={kernelName:fc,backendName:"webgl",kernelFunc:Hre};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Yre(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{numOrSizeSplits:o,axis:c}=s,h=be(c,i.shape)[0],f=py(i,o,h),g=i.shape.length,y=new Array(g).fill(0),I=i.shape.slice();return f.map(C=>{const k=[...I];k[h]=C;const N=wd({inputs:{x:i},backend:t,attrs:{begin:y,size:k}});return y[h]+=C,N})}const Qre={kernelName:Ca,backendName:"webgl",kernelFunc:Yre};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const wA="return sqrt(x);",Jre=nn({opSnippet:wA,packedOpSnippet:wA,cpuKernelImpl:yY}),qre={kernelName:Xl,backendName:"webgl",kernelFunc:Jre};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ese=nn({opSnippet:"return x * x;"}),tse={kernelName:Vh,backendName:"webgl",kernelFunc:ese};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const vA="return (a - b) * (a - b);",nse=is({opSnippet:vA,packedOpSnippet:vA}),rse={kernelName:es,backendName:"webgl",kernelFunc:nse};/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sse(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");const o=t.readSync(i.dataId),c=il(o),h=bY(c,"string",s);return t.makeTensorInfo(i.shape,"string",h)}const ise={kernelName:ri,backendName:"webgl",kernelFunc:sse};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ase({inputs:n,attrs:e,backend:t}){const{x:s}=n,i=la+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,o=new bo(s.shape,i);return t.runWebGLProgram(o,[s],s.dtype)}const ose={kernelName:w,backendName:"webgl",kernelFunc:ase};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class lse{constructor(e,t,s){this.variableNames=["x"],this.outputShape=s;const i=s.length,o=wn(s.length),c=wn(s.length);let h="";if(i===1)h="coords * strides + begin";else{let f=0;h=s.map((g,y)=>(f++,s.length===1?`coords * strides[${y}] + begin[${y}]`:`coords[${f-1}] * strides[${y}] + begin[${y}]`)).join(",")}this.userCode=`
      ${o} begin = ${o}(${e});
      ${o} strides = ${o}(${t});

      void main() {
        ${c} coords = getOutputCoords();
        setOutput(getX(${h}));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function use(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{begin:o,end:c,strides:h,beginMask:f,endMask:g,ellipsisMask:y,newAxisMask:I,shrinkAxisMask:C}=s,{finalShapeSparse:k,finalShape:N,isIdentity:R,sliceDim0:P,isSimpleSlice:L,begin:F,end:W,strides:z}=jx(i.shape,o,c,h,f,g,y,I,C);let X;if(R)X=tt({inputs:{x:i},backend:t,attrs:{shape:N}});else if(P||L){D(i.shape.length>=1,()=>`Input must have rank at least 1, got: ${i.shape.length}`);const J=$x(F,W,z),te=wd({inputs:{x:i},backend:t,attrs:{begin:F,size:J}});X=tt({inputs:{x:te},backend:t,attrs:{shape:N}}),t.disposeIntermediateTensorInfo(te)}else if(t.shouldExecuteOnCPU([i])){const J=t.readSync(i.dataId),te=Xt(i.shape,i.dtype,J),ie=wY(k,te,z,F);X=t.makeTensorInfo(N,i.dtype,ie.values)}else{const J=new lse(F,z,k);X=t.runWebGLProgram(J,[i],i.dtype)}const Q=tt({inputs:{x:X},backend:t,attrs:{shape:N}});return t.disposeIntermediateTensorInfo(X),Q}const cse={kernelName:pf,backendName:"webgl",kernelFunc:use};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hse(n){const{inputs:e,backend:t,attrs:s}=n,{separator:i,nGramWidths:o,leftPad:c,rightPad:h,padWidth:f,preserveShortSequences:g}=s,{data:y,dataSplits:I}=e,C=t.readSync(y.dataId),k=t.readSync(I.dataId),[N,R]=vY(C,k,i,o,c,h,f,g);return[t.makeTensorInfo([N.length],"string",N),t.makeTensorInfo(I.shape,"int32",R)]}const dse={kernelName:Bh,backendName:"webgl",kernelFunc:hse};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function fse(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:i}=s,{input:o,delimiter:c}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(c.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${c.shape}`);const h=t.readSync(o.dataId),f=t.readSync(c.dataId)[0],[g,y,I]=IY(h,f,i),C=y.length;return[t.makeTensorInfo([C,2],"int32",g),t.makeTensorInfo([C],"string",y),t.makeTensorInfo([2],"int32",new Int32Array(I))]}const pse={kernelName:E0,backendName:"webgl",kernelFunc:fse};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mse(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:i}=s,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const c=t.readSync(o.dataId),h=CY(c,i);return t.makeTensorInfo(o.shape,"int32",h)}const gse={kernelName:mf,backendName:"webgl",kernelFunc:mse};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const xse=nn({opSnippet:"return tan(x);"}),yse={kernelName:pc,backendName:"webgl",kernelFunc:xse};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const bse=nn({opSnippet:`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`}),wse={kernelName:jo,backendName:"webgl",kernelFunc:bse};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vse(n){const{inputs:e,backend:t,attrs:s}=n,{tensor:i,indices:o,updates:c}=e,{sliceRank:h,numUpdates:f,sliceSize:g,strides:y,outputSize:I}=Mc(c,o,i.shape),C=[I/g,g];if(I===0)return t.makeTensorInfo(i.shape,o.dtype);const k=tt({inputs:{x:o},backend:t,attrs:{shape:[f,h]}}),N=tt({inputs:{x:c},backend:t,attrs:{shape:[f,g]}}),R=tt({inputs:{x:i},backend:t,attrs:{shape:C}}),P=new Mb(f,h,k.shape.length,N.shape.length,y,C,!1,!0),L=t.runWebGLProgram(P,[N,k,R],R.dtype),F=tt({inputs:{x:L},backend:t,attrs:{shape:i.shape}});return t.disposeIntermediateTensorInfo(k),t.disposeIntermediateTensorInfo(N),t.disposeIntermediateTensorInfo(R),t.disposeIntermediateTensorInfo(L),F}const Ise={kernelName:kt,backendName:"webgl",kernelFunc:vse};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Cse{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let c=0;c<s.length;c++)s[c]=e[c]*t[c];this.outputShape=s,this.rank=s.length;const i=wn(this.rank),o=Sse(e);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        setOutput(getA(${o}));
      }
    `}}function Sse(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let i=0;i<n.length;i++)s.push(`imod(${t[i]}, ${n[i]})`);return s.join()}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function IA(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{reps:o}=s;if(i.dtype==="string"||i.shape.length>5){const h=t.readSync(i.dataId),f=i.dtype==="string"?h.map(I=>Yl(I)):h,g=Xt(i.shape,i.dtype,f),y=TY(g,o);return t.makeTensorInfo(y.shape,y.dtype,y.values)}const c=new Cse(i.shape,o);return t.runWebGLProgram(c,[i],i.dtype)}const Tse={kernelName:Ta,backendName:"webgl",kernelFunc:IA};class kse{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class Ese{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Yc(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function CA(n){let e=1;for(;e<n;)e*=2;return e}function Nse(n){const{inputs:e,backend:t,attrs:s}=n,{x:i}=e,{k:o,sorted:c}=s,h=ke().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),f=ke().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),g=i.shape,y=g[g.length-1];if(t.shouldExecuteOnCPU([i])||y<h||o>f){const ie=t.readSync(i.dataId),[oe,Ce]=kY(ie,g,i.dtype,o,c);return[t.makeTensorInfo(oe.shape,oe.dtype,oe.values),t.makeTensorInfo(Ce.shape,Ce.dtype,Ce.values)]}if(o===0)return g[g.length-1]=0,[t.makeTensorInfo(g,i.dtype,[]),t.makeTensorInfo(g,"int32",[])];if(y===1)return[i,cp({attrs:{shape:g,dtype:"int32",value:0},backend:t})];const I=t.texData.get(i.dataId),C=I!==null&&I.isPacked,k=C?t.unpackTensor(i):i,N=H(g)/y,R=tt({inputs:{x:k},attrs:{shape:[N,y]},backend:t});C&&Yc(t,k);const P=CA(o),L=CA(y);let F=null;const W=()=>F===null?[R,R]:[R,F],z=(ie,oe,Ce)=>{const Se=W(),Te=new kse(Ce),Le=[[y],[F===null?1:0],[Number.NEGATIVE_INFINITY],[ie],[oe]],Me=F;F=t.runWebGLProgram(Te,Se,"int32",Le),Yc(t,Me)};for(let ie=1;ie<P;ie*=2){const oe=ie*2;for(let Ce=ie;Ce>=1;Ce/=2)z(oe,Ce,[N,L])}for(let ie=L;ie>P;ie/=2){const oe=W(),Ce=new Ese([N,ie/2]),Se=[[y],[F===null?1:0],[P]],Te=F;F=t.runWebGLProgram(Ce,oe,"int32",Se),Yc(t,Te);const Le=P/2,Me=Le*2;for(let Oe=Le;Oe>=1;Oe/=2)z(Me,Oe,F.shape)}let X=F;F=wd({inputs:{x:F},backend:t,attrs:{begin:0,size:[N,o]}}),Yc(t,X);let Q=hA({inputs:{x:R,indices:F},backend:t,attrs:{axis:1,batchDims:1}});Yc(t,R);const J=g.slice(0,-1);J.push(o),X=F,F=tt({inputs:{x:F},attrs:{shape:J},backend:t}),Yc(t,X);const te=Q;return Q=tt({inputs:{x:Q},attrs:{shape:J},backend:t}),Yc(t,te),[Q,F]}const Ase={kernelName:jt,backendName:"webgl",kernelFunc:Nse};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Rse{constructor(e,t,s,i,o,c){this.variableNames=["Image","Transforms"],this.outputShape=c;const h=s==="nearest"?1:2;let f;switch(i){case"constant":f=1;break;case"reflect":f=2;break;case"wrap":f=3;break;case"nearest":f=4;break;default:f=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${f} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${f} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${f} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${o});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${o});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${h} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Mse(n){const{inputs:e,backend:t,attrs:s}=n,{image:i,transforms:o}=e,{interpolation:c,fillMode:h,fillValue:f,outputShape:g}=s,[y,I,C,k]=i.shape,[N,R]=g??[I,C],P=[y,N,R,k],L=new Rse(I,C,c,h,f,P);return t.runWebGLProgram(L,[i,o],"float32")}const Lse={kernelName:$l,backendName:"webgl",kernelFunc:Mse};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Dse(n){const{inputs:e,attrs:t,backend:s}=n,{axis:i}=t,{x:o}=e;rp(o,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const c=s.readSync(o.dataId),{outputValues:h,outputShape:f,indices:g}=EY(c,i,o.shape,o.dtype);return[s.makeTensorInfo(f,o.dtype,h),s.makeTensorInfo([g.length],"int32",g)]}const Ose={kernelName:u,backendName:"webgl",kernelFunc:Dse};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Pse(n){const{inputs:e,backend:t,attrs:s}=n,{value:i}=e;let{axis:o}=s;o<0&&(o+=i.shape.length);const c=i,h=c.shape.length,f=i.shape[o],g=new Array(h-1);let y=0;for(let R=0;R<h;R++)R!==o&&(g[y++]=c.shape[R]);const I=[],C=new Array(h).fill(0),k=c.shape.slice();k[o]=1;const N=new Array(f);for(let R=0;R<N.length;R++){C[o]=R;const P=wd({inputs:{x:c},backend:t,attrs:{begin:C,size:k}}),L=tt({inputs:{x:P},backend:t,attrs:{shape:g}});N[R]=L,I.push(P)}return I.forEach(R=>t.disposeIntermediateTensorInfo(R)),N}const Fse={kernelName:d,backendName:"webgl",kernelFunc:Pse};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Gse{constructor(e,t){this.variableNames=["x","segmentIds"];const s=e.windowSize,i=e.batchSize,o=e.inSize,c=e.numSegments,h=c*Math.ceil(o/s);this.outputShape=[i,h];const f="0.0",g="sumValue",y=Math.floor(s/4)*4,I=s%4,C=`
        sumValue += dot(values, segFilter);
    `;let k="";o%s>0&&(k=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `);let N="";o%s>0&&(N=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${f};

      float getValue(int batch, int inIdx) {
        ${k}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${N}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${c})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${c})));

        float sumValue = 0.0;

        for (int i = 0; i < ${y}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${C}
        }

        int inIdx = inOffset + ${y};
        if (${I===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${C}
        } else if (${I===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${C}
        } else if (${I===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${C}
        }
        setOutput(${g});
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _se(n){const{inputs:e,backend:t,attrs:s}=n,{x:i,segmentIds:o}=e,{numSegments:c}=s,h=i.shape.length,f=[];let g=0;const y=er([g],h);let I=i;y!=null&&(I=Ms({inputs:{x:i},backend:t,attrs:{perm:y}}),f.push(I),g=gr(1,h)[0]);const C=YS(I.shape,g,c),k=H([I.shape[g]]),N=tt({inputs:{x:I},backend:t,attrs:{shape:[-1,k]}});f.push(N);const R=qg(i.dtype),P=(z,X,Q,J,te)=>{const ie=z.shape[0],oe=z.shape[1],Ce=jS(oe,te),Se={windowSize:Ce,inSize:oe,batchSize:ie,numSegments:te},Te=new Gse(Se,X),Le=t.compileAndRun(Te,[z,Q],J);if(f.push(Le),Le.shape[1]===te)return Le;const Me=bA({backend:t,attrs:{start:0,stop:te,step:1,dtype:"float32"}}),Oe=IA({inputs:{x:Me},backend:t,attrs:{reps:[oe/Ce]}});return f.push(Me),f.push(Oe),P(Le,X,Oe,J,te)},L=P(N,"unsortedSegmentSum",o,R,c),F=tt({inputs:{x:L},backend:t,attrs:{shape:C}});let W=F;if(y!=null){f.push(F);const z=eu(y);W=Ms({inputs:{x:W},backend:t,attrs:{perm:z}})}return f.forEach(z=>t.disposeIntermediateTensorInfo(z)),W}const Vse={kernelName:m,backendName:"webgl",kernelFunc:_se};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Bse=[yQ,wQ,CQ,kQ,NQ,MQ,DQ,PQ,VQ,WQ,ZQ,UQ,YQ,eJ,rJ,iJ,oJ,hJ,fJ,mJ,yJ,SJ,kJ,RJ,LJ,GJ,VJ,XJ,tQ,$J,QJ,tq,oq,cq,dq,pq,gq,wq,Iq,Sq,kq,Nq,Rq,Dq,Pq,Vq,Wq,Zq,Uq,jq,Qq,eee,nee,iee,oee,lee,cee,dee,pee,gee,yee,wee,Cee,kee,Nee,Mee,Oee,Fee,_ee,eQ,Bee,jJ,zee,Zee,$ee,rQ,Hee,Yee,Jee,tte,ste,ate,lte,cte,fte,mte,xte,vte,Cte,Tte,Ate,Mte,Dte,Pte,Gte,Wte,Zte,Hte,ene,aQ,sne,one,cne,fne,DJ,mne,xne,bne,Ine,kne,iQ,Nne,Rne,Lne,One,Pne,OJ,Yte,Gne,Bne,Xne,lQ,Une,Yne,ere,rre,ore,ure,hre,fre,gre,bre,Ire,Tre,Nre,Rre,Ore,Fre,CJ,Jte,_re,Vre,Wre,Xre,Kre,Ure,jre,Qre,qre,tse,rse,ise,ose,cse,dse,pse,gse,Qte,mQ,yse,wse,Ise,Tse,Ase,Lse,gQ,Ose,Fse,Vse,gne];for(const n of Bse)Xe(n);const SA="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NsYXNzIFd0e2NvbnN0cnVjdG9yKG49W10sZT1RdCl7aWYodGhpcy5kYXRhPW4sdGhpcy5sZW5ndGg9dGhpcy5kYXRhLmxlbmd0aCx0aGlzLmNvbXBhcmU9ZSx0aGlzLmxlbmd0aD4wKWZvcihsZXQgdD0odGhpcy5sZW5ndGg+PjEpLTE7dD49MDt0LS0pdGhpcy5fZG93bih0KX1wdXNoKG4pe3RoaXMuZGF0YS5wdXNoKG4pLHRoaXMubGVuZ3RoKyssdGhpcy5fdXAodGhpcy5sZW5ndGgtMSl9cG9wKCl7aWYodGhpcy5sZW5ndGg9PT0wKXJldHVybjtjb25zdCBuPXRoaXMuZGF0YVswXSxlPXRoaXMuZGF0YS5wb3AoKTtyZXR1cm4gdGhpcy5sZW5ndGgtLSx0aGlzLmxlbmd0aD4wJiYodGhpcy5kYXRhWzBdPWUsdGhpcy5fZG93bigwKSksbn1wZWVrKCl7cmV0dXJuIHRoaXMuZGF0YVswXX1fdXAobil7Y29uc3R7ZGF0YTplLGNvbXBhcmU6dH09dGhpcyxzPWVbbl07Zm9yKDtuPjA7KXtjb25zdCByPW4tMT4+MSxpPWVbcl07aWYodChzLGkpPj0wKWJyZWFrO2Vbbl09aSxuPXJ9ZVtuXT1zfV9kb3duKG4pe2NvbnN0e2RhdGE6ZSxjb21wYXJlOnR9PXRoaXMscz10aGlzLmxlbmd0aD4+MSxyPWVbbl07Zm9yKDtuPHM7KXtsZXQgaT0objw8MSkrMSxoPWVbaV07Y29uc3QgbD1pKzE7aWYobDx0aGlzLmxlbmd0aCYmdChlW2xdLGgpPDAmJihpPWwsaD1lW2xdKSx0KGgscik+PTApYnJlYWs7ZVtuXT1oLG49aX1lW25dPXJ9fWZ1bmN0aW9uIFF0KG8sbil7cmV0dXJuIG88bj8tMTpvPm4/MTowfWNvbnN0IHl0PW89Pntjb25zdHt2MTpuLHYyOmV9PW87bGV0IHQ9MDtmb3IobGV0IHM9MDtzPG4ubGVuZ3RoO3MrKyl7bGV0IHI9KG5bc11eZVtzXSk+Pj4wO3QrPVp0KHIpfXJldHVybiB0fSxadD1vPT57dmFyIG49by0obz4+MSYxNDMxNjU1NzY1KTtyZXR1cm4gbj0obj4+MiY4NTg5OTM0NTkpKyhuJjg1ODk5MzQ1OSksbj0obj4+NCkrbiYyNTI2NDUxMzUsbj0obj4+OCkrbiYxNjcxMTkzNSxuPShuPj4xNikrbiY2NTUzNSxufSxjdD0xLHZ0PW89Pntjb25zdHtrZXl3aWR0aDpuLGtleWhlaWdodDplLHF1ZXJ5d2lkdGg6dCxxdWVyeWhlaWdodDpzLG1hdGNoZXM6cn09byxpPXQqMS4yLGg9LWksbD1zKjEuMix1PS1sLGY9MTIsZz0xMCxhPS0xLGo9MSx5PTEvTWF0aC5sb2coMTApLG09TWF0aC5tYXgobixlKSxNPU1hdGguZmxvb3Iobi8yKSxUPU1hdGguZmxvb3IoZS8yKSxFPVtdO2ZvcihsZXQgTj0wO048ci5sZW5ndGg7TisrKXtjb25zdCAkPXJbTl0ucXVlcnlwb2ludC5zY2FsZSxLPXJbTl0ua2V5cG9pbnQuc2NhbGU7Sz09MCYmY29uc29sZS5sb2coIkVSUk9SIGRpdmlkZSB6ZXJvIik7Y29uc3Qgdj0kL0s7RS5wdXNoKHYqbSl9RS5zb3J0KChOLCQpPT5OLSQpO2NvbnN0IFI9LjI1KkVbTWF0aC5mbG9vcihFLmxlbmd0aC8yKS0oRS5sZW5ndGglMj09MD8xOjApLTFdLHE9TWF0aC5tYXgoNSxNYXRoLmNlaWwoKGktaCkvUikpLEk9TWF0aC5tYXgoNSxNYXRoLmNlaWwoKGwtdSkvUikpLHo9cSpJLEI9eipmLGM9W10scD1bXSxTPXt9O2ZvcihsZXQgTj0wO048ci5sZW5ndGg7TisrKXtjb25zdCAkPXJbTl0ucXVlcnlwb2ludCxLPXJbTl0ua2V5cG9pbnQse3g6dix5OlYsc2NhbGU6TCxhbmdsZTpDfT14dCh7cXVlcnlwb2ludDokLGtleXBvaW50Okssa2V5Y2VudGVyWDpNLGtleWNlbnRlclk6VCxzY2FsZU9uZU92ZXJMb2dLOnl9KTtpZih2PGh8fHY+PWl8fFY8dXx8Vj49bHx8Qzw9LU1hdGguUEl8fEM+TWF0aC5QSXx8TDxhfHxMPj1qKXtjW05dPSExO2NvbnRpbnVlfWxldCBYPXEqKHYtaCkvKGktaCksd3Q9SSooVi11KS8obC11KSxwdD1mKihDK01hdGguUEkpLygyKk1hdGguUEkpLGR0PWcqKEwtYSkvKGotYSk7cFtOXT17YmluWDpYLGJpblk6d3QsYmluQW5nbGU6cHQsYmluU2NhbGU6ZHR9O2xldCBpdD1NYXRoLmZsb29yKFgtLjUpLGx0PU1hdGguZmxvb3Iod3QtLjUpLGh0PU1hdGguZmxvb3IoZHQtLjUpLGp0PShNYXRoLmZsb29yKHB0LS41KStmKSVmO2lmKGl0PDB8fGl0KzE+PXF8fGx0PDB8fGx0KzE+PUl8fGh0PDB8fGh0KzE+PWcpe2NbTl09ITE7Y29udGludWV9Zm9yKGxldCB1dD0wO3V0PDI7dXQrKyl7bGV0IGt0PWl0K3V0O2ZvcihsZXQgYnQ9MDtidDwyO2J0Kyspe2xldCB1bj1sdCtidDtmb3IobGV0IEl0PTA7SXQ8MjtJdCsrKXtsZXQgY249KGp0K0l0KSVmO2ZvcihsZXQgUnQ9MDtSdDwyO1J0Kyspe2xldCBmbj1odCtSdDtjb25zdCBOdD1rdCt1bipxK2NuKnorZm4qQjtTW050XT09PXZvaWQgMCYmKFNbTnRdPTApLFNbTnRdKz0xfX19fWNbTl09ITB9bGV0IGQ9MCxEPS0xO2lmKE9iamVjdC5rZXlzKFMpLmZvckVhY2goTj0+e1NbTl0+ZCYmKGQ9U1tOXSxEPU4pfSksZDwzKXJldHVybltdO2NvbnN0IFU9TWF0aC5mbG9vcihEJUIleiVxKSxGPU1hdGguZmxvb3IoKEQtVSklQiV6L3EpLFA9TWF0aC5mbG9vcigoRC1VLUYqcSklQi96KSxZPU1hdGguZmxvb3IoKEQtVS1GKnEtUCp6KS9CKSxHPVtdO2ZvcihsZXQgTj0wO048ci5sZW5ndGg7TisrKXtpZighY1tOXSljb250aW51ZTtjb25zdCAkPXBbTl07aWYoTWF0aC5hYnMoJC5iaW5YLShVKy41KSk+PWN0fHxNYXRoLmFicygkLmJpblktKEYrLjUpKT49Y3R8fE1hdGguYWJzKCQuYmluU2NhbGUtKFkrLjUpKT49Y3QpY29udGludWU7Y29uc3QgTD1NYXRoLmFicygkLmJpbkFuZ2xlLShQKy41KSk7TWF0aC5taW4oTCxmLUwpPj1jdHx8Ry5wdXNoKHJbTl0pfXJldHVybiBHfSx4dD0oe3F1ZXJ5cG9pbnQ6byxrZXlwb2ludDpuLGtleWNlbnRlclg6ZSxrZXljZW50ZXJZOnQsc2NhbGVPbmVPdmVyTG9nSzpzfSk9PntsZXQgcj1vLmFuZ2xlLW4uYW5nbGU7cjw9LU1hdGguUEk/cis9MipNYXRoLlBJOnI+TWF0aC5QSSYmKHItPTIqTWF0aC5QSSk7Y29uc3QgaT1vLnNjYWxlL24uc2NhbGUsaD1pKk1hdGguY29zKHIpLGw9aSpNYXRoLnNpbihyKSx1PVtoLC1sLGwsaF0sZj1bdVswXSpuLngrdVsxXSpuLnksdVsyXSpuLngrdVszXSpuLnldLGc9by54LWZbMF0sYT1vLnktZlsxXTtyZXR1cm57eDp1WzBdKmUrdVsxXSp0K2cseTp1WzJdKmUrdVszXSp0K2EsYW5nbGU6cixzY2FsZTpNYXRoLmxvZyhpKSpzfX0sQXQ9T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZztmdW5jdGlvbiBXKG8pe3JldHVybiBBdC5jYWxsKG8pLmVuZHNXaXRoKCJBcnJheV0iKX1mdW5jdGlvbiB0ZShvKXt2YXIgbj1hcmd1bWVudHMubGVuZ3RoPjEmJmFyZ3VtZW50c1sxXSE9PXZvaWQgMD9hcmd1bWVudHNbMV06e307aWYoIVcobykpdGhyb3cgbmV3IFR5cGVFcnJvcigiaW5wdXQgbXVzdCBiZSBhbiBhcnJheSIpO2lmKG8ubGVuZ3RoPT09MCl0aHJvdyBuZXcgVHlwZUVycm9yKCJpbnB1dCBtdXN0IG5vdCBiZSBlbXB0eSIpO3ZhciBlPW4uZnJvbUluZGV4LHQ9ZT09PXZvaWQgMD8wOmUscz1uLnRvSW5kZXgscj1zPT09dm9pZCAwP28ubGVuZ3RoOnM7aWYodDwwfHx0Pj1vLmxlbmd0aHx8IU51bWJlci5pc0ludGVnZXIodCkpdGhyb3cgbmV3IEVycm9yKCJmcm9tSW5kZXggbXVzdCBiZSBhIHBvc2l0aXZlIGludGVnZXIgc21hbGxlciB0aGFuIGxlbmd0aCIpO2lmKHI8PXR8fHI+by5sZW5ndGh8fCFOdW1iZXIuaXNJbnRlZ2VyKHIpKXRocm93IG5ldyBFcnJvcigidG9JbmRleCBtdXN0IGJlIGFuIGludGVnZXIgZ3JlYXRlciB0aGFuIGZyb21JbmRleCBhbmQgYXQgbW9zdCBlcXVhbCB0byBsZW5ndGgiKTtmb3IodmFyIGk9b1t0XSxoPXQrMTtoPHI7aCsrKW9baF0+aSYmKGk9b1toXSk7cmV0dXJuIGl9ZnVuY3Rpb24gZWUobyl7dmFyIG49YXJndW1lbnRzLmxlbmd0aD4xJiZhcmd1bWVudHNbMV0hPT12b2lkIDA/YXJndW1lbnRzWzFdOnt9O2lmKCFXKG8pKXRocm93IG5ldyBUeXBlRXJyb3IoImlucHV0IG11c3QgYmUgYW4gYXJyYXkiKTtpZihvLmxlbmd0aD09PTApdGhyb3cgbmV3IFR5cGVFcnJvcigiaW5wdXQgbXVzdCBub3QgYmUgZW1wdHkiKTt2YXIgZT1uLmZyb21JbmRleCx0PWU9PT12b2lkIDA/MDplLHM9bi50b0luZGV4LHI9cz09PXZvaWQgMD9vLmxlbmd0aDpzO2lmKHQ8MHx8dD49by5sZW5ndGh8fCFOdW1iZXIuaXNJbnRlZ2VyKHQpKXRocm93IG5ldyBFcnJvcigiZnJvbUluZGV4IG11c3QgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyIHNtYWxsZXIgdGhhbiBsZW5ndGgiKTtpZihyPD10fHxyPm8ubGVuZ3RofHwhTnVtYmVyLmlzSW50ZWdlcihyKSl0aHJvdyBuZXcgRXJyb3IoInRvSW5kZXggbXVzdCBiZSBhbiBpbnRlZ2VyIGdyZWF0ZXIgdGhhbiBmcm9tSW5kZXggYW5kIGF0IG1vc3QgZXF1YWwgdG8gbGVuZ3RoIik7Zm9yKHZhciBpPW9bdF0saD10KzE7aDxyO2grKylvW2hdPGkmJihpPW9baF0pO3JldHVybiBpfWZ1bmN0aW9uIHF0KG8pe3ZhciBuPWFyZ3VtZW50cy5sZW5ndGg+MSYmYXJndW1lbnRzWzFdIT09dm9pZCAwP2FyZ3VtZW50c1sxXTp7fTtpZihXKG8pKXtpZihvLmxlbmd0aD09PTApdGhyb3cgbmV3IFR5cGVFcnJvcigiaW5wdXQgbXVzdCBub3QgYmUgZW1wdHkiKX1lbHNlIHRocm93IG5ldyBUeXBlRXJyb3IoImlucHV0IG11c3QgYmUgYW4gYXJyYXkiKTt2YXIgZTtpZihuLm91dHB1dCE9PXZvaWQgMCl7aWYoIVcobi5vdXRwdXQpKXRocm93IG5ldyBUeXBlRXJyb3IoIm91dHB1dCBvcHRpb24gbXVzdCBiZSBhbiBhcnJheSBpZiBzcGVjaWZpZWQiKTtlPW4ub3V0cHV0fWVsc2UgZT1uZXcgQXJyYXkoby5sZW5ndGgpO3ZhciB0PWVlKG8pLHM9dGUobyk7aWYodD09PXMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIm1pbmltdW0gYW5kIG1heGltdW0gaW5wdXQgdmFsdWVzIGFyZSBlcXVhbC4gQ2Fubm90IHJlc2NhbGUgYSBjb25zdGFudCBhcnJheSIpO3ZhciByPW4ubWluLGk9cj09PXZvaWQgMD9uLmF1dG9NaW5NYXg/dDowOnIsaD1uLm1heCxsPWg9PT12b2lkIDA/bi5hdXRvTWluTWF4P3M6MTpoO2lmKGk+PWwpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIm1pbiBvcHRpb24gbXVzdCBiZSBzbWFsbGVyIHRoYW4gbWF4IG9wdGlvbiIpO2Zvcih2YXIgdT0obC1pKS8ocy10KSxmPTA7ZjxvLmxlbmd0aDtmKyspZVtmXT0ob1tmXS10KSp1K2k7cmV0dXJuIGV9Y29uc3QgZnQ9IiAiLnJlcGVhdCgyKSxfdD0iICIucmVwZWF0KDQpO2Z1bmN0aW9uIG5lKCl7cmV0dXJuIFR0KHRoaXMpfWZ1bmN0aW9uIFR0KG8sbj17fSl7Y29uc3R7bWF4Um93czplPTE1LG1heENvbHVtbnM6dD0xMCxtYXhOdW1TaXplOnM9OCxwYWRNaW51czpyPSJhdXRvIn09bjtyZXR1cm5gJHtvLmNvbnN0cnVjdG9yLm5hbWV9IHsKJHtmdH1bCiR7X3R9JHtzZShvLGUsdCxzLHIpfQoke2Z0fV0KJHtmdH1yb3dzOiAke28ucm93c30KJHtmdH1jb2x1bW5zOiAke28uY29sdW1uc30KfWB9ZnVuY3Rpb24gc2UobyxuLGUsdCxzKXtjb25zdHtyb3dzOnIsY29sdW1uczppfT1vLGg9TWF0aC5taW4ocixuKSxsPU1hdGgubWluKGksZSksdT1bXTtpZihzPT09ImF1dG8iKXtzPSExO3Q6Zm9yKGxldCBmPTA7ZjxoO2YrKylmb3IobGV0IGc9MDtnPGw7ZysrKWlmKG8uZ2V0KGYsZyk8MCl7cz0hMDticmVhayB0fX1mb3IobGV0IGY9MDtmPGg7ZisrKXtsZXQgZz1bXTtmb3IobGV0IGE9MDthPGw7YSsrKWcucHVzaChvZShvLmdldChmLGEpLHQscykpO3UucHVzaChgJHtnLmpvaW4oIiAiKX1gKX1yZXR1cm4gbCE9PWkmJih1W3UubGVuZ3RoLTFdKz1gIC4uLiAke2ktZX0gbW9yZSBjb2x1bW5zYCksaCE9PXImJnUucHVzaChgLi4uICR7ci1ufSBtb3JlIHJvd3NgKSx1LmpvaW4oYAoke190fWApfWZ1bmN0aW9uIG9lKG8sbixlKXtyZXR1cm4obz49MCYmZT9gICR7enQobyxuLTEpfWA6enQobyxuKSkucGFkRW5kKG4pfWZ1bmN0aW9uIHp0KG8sbil7bGV0IGU9by50b1N0cmluZygpO2lmKGUubGVuZ3RoPD1uKXJldHVybiBlO2xldCB0PW8udG9GaXhlZChuKTtpZih0Lmxlbmd0aD5uJiYodD1vLnRvRml4ZWQoTWF0aC5tYXgoMCxuLSh0Lmxlbmd0aC1uKSkpKSx0Lmxlbmd0aDw9biYmIXQuc3RhcnRzV2l0aCgiMC4wMDAiKSYmIXQuc3RhcnRzV2l0aCgiLTAuMDAwIikpcmV0dXJuIHQ7bGV0IHM9by50b0V4cG9uZW50aWFsKG4pO3JldHVybiBzLmxlbmd0aD5uJiYocz1vLnRvRXhwb25lbnRpYWwoTWF0aC5tYXgoMCxuLShzLmxlbmd0aC1uKSkpKSxzLnNsaWNlKDApfWZ1bmN0aW9uIHJlKG8sbil7by5wcm90b3R5cGUuYWRkPWZ1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdD09Im51bWJlciI/dGhpcy5hZGRTKHQpOnRoaXMuYWRkTSh0KX0sby5wcm90b3R5cGUuYWRkUz1mdW5jdGlvbih0KXtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpK3QpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5hZGRNPWZ1bmN0aW9uKHQpe2lmKHQ9bi5jaGVja01hdHJpeCh0KSx0aGlzLnJvd3MhPT10LnJvd3N8fHRoaXMuY29sdW1ucyE9PXQuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiTWF0cmljZXMgZGltZW5zaW9ucyBtdXN0IGJlIGVxdWFsIik7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKSt0LmdldChzLHIpKTtyZXR1cm4gdGhpc30sby5hZGQ9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IG4odCkuYWRkKHMpfSxvLnByb3RvdHlwZS5zdWI9ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0PT0ibnVtYmVyIj90aGlzLnN1YlModCk6dGhpcy5zdWJNKHQpfSxvLnByb3RvdHlwZS5zdWJTPWZ1bmN0aW9uKHQpe2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMsciktdCk7cmV0dXJuIHRoaXN9LG8ucHJvdG90eXBlLnN1Yk09ZnVuY3Rpb24odCl7aWYodD1uLmNoZWNrTWF0cml4KHQpLHRoaXMucm93cyE9PXQucm93c3x8dGhpcy5jb2x1bW5zIT09dC5jb2x1bW5zKXRocm93IG5ldyBSYW5nZUVycm9yKCJNYXRyaWNlcyBkaW1lbnNpb25zIG11c3QgYmUgZXF1YWwiKTtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpLXQuZ2V0KHMscikpO3JldHVybiB0aGlzfSxvLnN1Yj1mdW5jdGlvbih0LHMpe3JldHVybiBuZXcgbih0KS5zdWIocyl9LG8ucHJvdG90eXBlLnN1YnRyYWN0PW8ucHJvdG90eXBlLnN1YixvLnByb3RvdHlwZS5zdWJ0cmFjdFM9by5wcm90b3R5cGUuc3ViUyxvLnByb3RvdHlwZS5zdWJ0cmFjdE09by5wcm90b3R5cGUuc3ViTSxvLnN1YnRyYWN0PW8uc3ViLG8ucHJvdG90eXBlLm11bD1mdW5jdGlvbih0KXtyZXR1cm4gdHlwZW9mIHQ9PSJudW1iZXIiP3RoaXMubXVsUyh0KTp0aGlzLm11bE0odCl9LG8ucHJvdG90eXBlLm11bFM9ZnVuY3Rpb24odCl7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKSp0KTtyZXR1cm4gdGhpc30sby5wcm90b3R5cGUubXVsTT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscikqdC5nZXQocyxyKSk7cmV0dXJuIHRoaXN9LG8ubXVsPWZ1bmN0aW9uKHQscyl7cmV0dXJuIG5ldyBuKHQpLm11bChzKX0sby5wcm90b3R5cGUubXVsdGlwbHk9by5wcm90b3R5cGUubXVsLG8ucHJvdG90eXBlLm11bHRpcGx5Uz1vLnByb3RvdHlwZS5tdWxTLG8ucHJvdG90eXBlLm11bHRpcGx5TT1vLnByb3RvdHlwZS5tdWxNLG8ubXVsdGlwbHk9by5tdWwsby5wcm90b3R5cGUuZGl2PWZ1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdD09Im51bWJlciI/dGhpcy5kaXZTKHQpOnRoaXMuZGl2TSh0KX0sby5wcm90b3R5cGUuZGl2Uz1mdW5jdGlvbih0KXtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpL3QpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5kaXZNPWZ1bmN0aW9uKHQpe2lmKHQ9bi5jaGVja01hdHJpeCh0KSx0aGlzLnJvd3MhPT10LnJvd3N8fHRoaXMuY29sdW1ucyE9PXQuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiTWF0cmljZXMgZGltZW5zaW9ucyBtdXN0IGJlIGVxdWFsIik7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKS90LmdldChzLHIpKTtyZXR1cm4gdGhpc30sby5kaXY9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IG4odCkuZGl2KHMpfSxvLnByb3RvdHlwZS5kaXZpZGU9by5wcm90b3R5cGUuZGl2LG8ucHJvdG90eXBlLmRpdmlkZVM9by5wcm90b3R5cGUuZGl2UyxvLnByb3RvdHlwZS5kaXZpZGVNPW8ucHJvdG90eXBlLmRpdk0sby5kaXZpZGU9by5kaXYsby5wcm90b3R5cGUubW9kPWZ1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdD09Im51bWJlciI/dGhpcy5tb2RTKHQpOnRoaXMubW9kTSh0KX0sby5wcm90b3R5cGUubW9kUz1mdW5jdGlvbih0KXtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpJXQpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5tb2RNPWZ1bmN0aW9uKHQpe2lmKHQ9bi5jaGVja01hdHJpeCh0KSx0aGlzLnJvd3MhPT10LnJvd3N8fHRoaXMuY29sdW1ucyE9PXQuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiTWF0cmljZXMgZGltZW5zaW9ucyBtdXN0IGJlIGVxdWFsIik7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKSV0LmdldChzLHIpKTtyZXR1cm4gdGhpc30sby5tb2Q9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IG4odCkubW9kKHMpfSxvLnByb3RvdHlwZS5tb2R1bHVzPW8ucHJvdG90eXBlLm1vZCxvLnByb3RvdHlwZS5tb2R1bHVzUz1vLnByb3RvdHlwZS5tb2RTLG8ucHJvdG90eXBlLm1vZHVsdXNNPW8ucHJvdG90eXBlLm1vZE0sby5tb2R1bHVzPW8ubW9kLG8ucHJvdG90eXBlLmFuZD1mdW5jdGlvbih0KXtyZXR1cm4gdHlwZW9mIHQ9PSJudW1iZXIiP3RoaXMuYW5kUyh0KTp0aGlzLmFuZE0odCl9LG8ucHJvdG90eXBlLmFuZFM9ZnVuY3Rpb24odCl7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKSZ0KTtyZXR1cm4gdGhpc30sby5wcm90b3R5cGUuYW5kTT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscikmdC5nZXQocyxyKSk7cmV0dXJuIHRoaXN9LG8uYW5kPWZ1bmN0aW9uKHQscyl7cmV0dXJuIG5ldyBuKHQpLmFuZChzKX0sby5wcm90b3R5cGUub3I9ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0PT0ibnVtYmVyIj90aGlzLm9yUyh0KTp0aGlzLm9yTSh0KX0sby5wcm90b3R5cGUub3JTPWZ1bmN0aW9uKHQpe2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscil8dCk7cmV0dXJuIHRoaXN9LG8ucHJvdG90eXBlLm9yTT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscil8dC5nZXQocyxyKSk7cmV0dXJuIHRoaXN9LG8ub3I9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IG4odCkub3Iocyl9LG8ucHJvdG90eXBlLnhvcj1mdW5jdGlvbih0KXtyZXR1cm4gdHlwZW9mIHQ9PSJudW1iZXIiP3RoaXMueG9yUyh0KTp0aGlzLnhvck0odCl9LG8ucHJvdG90eXBlLnhvclM9ZnVuY3Rpb24odCl7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKV50KTtyZXR1cm4gdGhpc30sby5wcm90b3R5cGUueG9yTT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMsciledC5nZXQocyxyKSk7cmV0dXJuIHRoaXN9LG8ueG9yPWZ1bmN0aW9uKHQscyl7cmV0dXJuIG5ldyBuKHQpLnhvcihzKX0sby5wcm90b3R5cGUubGVmdFNoaWZ0PWZ1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdD09Im51bWJlciI/dGhpcy5sZWZ0U2hpZnRTKHQpOnRoaXMubGVmdFNoaWZ0TSh0KX0sby5wcm90b3R5cGUubGVmdFNoaWZ0Uz1mdW5jdGlvbih0KXtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpPDx0KTtyZXR1cm4gdGhpc30sby5wcm90b3R5cGUubGVmdFNoaWZ0TT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscik8PHQuZ2V0KHMscikpO3JldHVybiB0aGlzfSxvLmxlZnRTaGlmdD1mdW5jdGlvbih0LHMpe3JldHVybiBuZXcgbih0KS5sZWZ0U2hpZnQocyl9LG8ucHJvdG90eXBlLnNpZ25Qcm9wYWdhdGluZ1JpZ2h0U2hpZnQ9ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0PT0ibnVtYmVyIj90aGlzLnNpZ25Qcm9wYWdhdGluZ1JpZ2h0U2hpZnRTKHQpOnRoaXMuc2lnblByb3BhZ2F0aW5nUmlnaHRTaGlmdE0odCl9LG8ucHJvdG90eXBlLnNpZ25Qcm9wYWdhdGluZ1JpZ2h0U2hpZnRTPWZ1bmN0aW9uKHQpe2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscik+PnQpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5zaWduUHJvcGFnYXRpbmdSaWdodFNoaWZ0TT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscik+PnQuZ2V0KHMscikpO3JldHVybiB0aGlzfSxvLnNpZ25Qcm9wYWdhdGluZ1JpZ2h0U2hpZnQ9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IG4odCkuc2lnblByb3BhZ2F0aW5nUmlnaHRTaGlmdChzKX0sby5wcm90b3R5cGUucmlnaHRTaGlmdD1mdW5jdGlvbih0KXtyZXR1cm4gdHlwZW9mIHQ9PSJudW1iZXIiP3RoaXMucmlnaHRTaGlmdFModCk6dGhpcy5yaWdodFNoaWZ0TSh0KX0sby5wcm90b3R5cGUucmlnaHRTaGlmdFM9ZnVuY3Rpb24odCl7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKT4+PnQpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5yaWdodFNoaWZ0TT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscik+Pj50LmdldChzLHIpKTtyZXR1cm4gdGhpc30sby5yaWdodFNoaWZ0PWZ1bmN0aW9uKHQscyl7cmV0dXJuIG5ldyBuKHQpLnJpZ2h0U2hpZnQocyl9LG8ucHJvdG90eXBlLnplcm9GaWxsUmlnaHRTaGlmdD1vLnByb3RvdHlwZS5yaWdodFNoaWZ0LG8ucHJvdG90eXBlLnplcm9GaWxsUmlnaHRTaGlmdFM9by5wcm90b3R5cGUucmlnaHRTaGlmdFMsby5wcm90b3R5cGUuemVyb0ZpbGxSaWdodFNoaWZ0TT1vLnByb3RvdHlwZS5yaWdodFNoaWZ0TSxvLnplcm9GaWxsUmlnaHRTaGlmdD1vLnJpZ2h0U2hpZnQsby5wcm90b3R5cGUubm90PWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsfnRoaXMuZ2V0KHQscykpO3JldHVybiB0aGlzfSxvLm5vdD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkubm90KCl9LG8ucHJvdG90eXBlLmFicz1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguYWJzKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5hYnM9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmFicygpfSxvLnByb3RvdHlwZS5hY29zPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5hY29zKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5hY29zPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5hY29zKCl9LG8ucHJvdG90eXBlLmFjb3NoPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5hY29zaCh0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8uYWNvc2g9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmFjb3NoKCl9LG8ucHJvdG90eXBlLmFzaW49ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmFzaW4odGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmFzaW49ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmFzaW4oKX0sby5wcm90b3R5cGUuYXNpbmg9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmFzaW5oKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5hc2luaD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkuYXNpbmgoKX0sby5wcm90b3R5cGUuYXRhbj1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguYXRhbih0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8uYXRhbj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkuYXRhbigpfSxvLnByb3RvdHlwZS5hdGFuaD1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguYXRhbmgodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmF0YW5oPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5hdGFuaCgpfSxvLnByb3RvdHlwZS5jYnJ0PWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5jYnJ0KHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5jYnJ0PWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5jYnJ0KCl9LG8ucHJvdG90eXBlLmNlaWw9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmNlaWwodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmNlaWw9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmNlaWwoKX0sby5wcm90b3R5cGUuY2x6MzI9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmNsejMyKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5jbHozMj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkuY2x6MzIoKX0sby5wcm90b3R5cGUuY29zPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5jb3ModGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmNvcz1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkuY29zKCl9LG8ucHJvdG90eXBlLmNvc2g9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmNvc2godGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmNvc2g9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmNvc2goKX0sby5wcm90b3R5cGUuZXhwPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5leHAodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmV4cD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkuZXhwKCl9LG8ucHJvdG90eXBlLmV4cG0xPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5leHBtMSh0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8uZXhwbTE9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmV4cG0xKCl9LG8ucHJvdG90eXBlLmZsb29yPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5mbG9vcih0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8uZmxvb3I9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmZsb29yKCl9LG8ucHJvdG90eXBlLmZyb3VuZD1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguZnJvdW5kKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5mcm91bmQ9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmZyb3VuZCgpfSxvLnByb3RvdHlwZS5sb2c9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmxvZyh0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8ubG9nPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5sb2coKX0sby5wcm90b3R5cGUubG9nMXA9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmxvZzFwKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5sb2cxcD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkubG9nMXAoKX0sby5wcm90b3R5cGUubG9nMTA9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmxvZzEwKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5sb2cxMD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkubG9nMTAoKX0sby5wcm90b3R5cGUubG9nMj1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGgubG9nMih0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8ubG9nMj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkubG9nMigpfSxvLnByb3RvdHlwZS5yb3VuZD1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGgucm91bmQodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLnJvdW5kPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5yb3VuZCgpfSxvLnByb3RvdHlwZS5zaWduPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5zaWduKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5zaWduPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5zaWduKCl9LG8ucHJvdG90eXBlLnNpbj1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguc2luKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5zaW49ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLnNpbigpfSxvLnByb3RvdHlwZS5zaW5oPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5zaW5oKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5zaW5oPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5zaW5oKCl9LG8ucHJvdG90eXBlLnNxcnQ9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLnNxcnQodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLnNxcnQ9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLnNxcnQoKX0sby5wcm90b3R5cGUudGFuPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC50YW4odGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLnRhbj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkudGFuKCl9LG8ucHJvdG90eXBlLnRhbmg9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLnRhbmgodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLnRhbmg9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLnRhbmgoKX0sby5wcm90b3R5cGUudHJ1bmM9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLnRydW5jKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby50cnVuYz1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkudHJ1bmMoKX0sby5wb3c9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IG4odCkucG93KHMpfSxvLnByb3RvdHlwZS5wb3c9ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0PT0ibnVtYmVyIj90aGlzLnBvd1ModCk6dGhpcy5wb3dNKHQpfSxvLnByb3RvdHlwZS5wb3dTPWZ1bmN0aW9uKHQpe2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLE1hdGgucG93KHRoaXMuZ2V0KHMsciksdCkpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5wb3dNPWZ1bmN0aW9uKHQpe2lmKHQ9bi5jaGVja01hdHJpeCh0KSx0aGlzLnJvd3MhPT10LnJvd3N8fHRoaXMuY29sdW1ucyE9PXQuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiTWF0cmljZXMgZGltZW5zaW9ucyBtdXN0IGJlIGVxdWFsIik7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsTWF0aC5wb3codGhpcy5nZXQocyxyKSx0LmdldChzLHIpKSk7cmV0dXJuIHRoaXN9fWZ1bmN0aW9uIFEobyxuLGUpe2xldCB0PWU/by5yb3dzOm8ucm93cy0xO2lmKG48MHx8bj50KXRocm93IG5ldyBSYW5nZUVycm9yKCJSb3cgaW5kZXggb3V0IG9mIHJhbmdlIil9ZnVuY3Rpb24gWihvLG4sZSl7bGV0IHQ9ZT9vLmNvbHVtbnM6by5jb2x1bW5zLTE7aWYobjwwfHxuPnQpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkNvbHVtbiBpbmRleCBvdXQgb2YgcmFuZ2UiKX1mdW5jdGlvbiB0dChvLG4pe2lmKG4udG8xREFycmF5JiYobj1uLnRvMURBcnJheSgpKSxuLmxlbmd0aCE9PW8uY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigidmVjdG9yIHNpemUgbXVzdCBiZSB0aGUgc2FtZSBhcyB0aGUgbnVtYmVyIG9mIGNvbHVtbnMiKTtyZXR1cm4gbn1mdW5jdGlvbiBldChvLG4pe2lmKG4udG8xREFycmF5JiYobj1uLnRvMURBcnJheSgpKSxuLmxlbmd0aCE9PW8ucm93cyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigidmVjdG9yIHNpemUgbXVzdCBiZSB0aGUgc2FtZSBhcyB0aGUgbnVtYmVyIG9mIHJvd3MiKTtyZXR1cm4gbn1mdW5jdGlvbiBpZShvLG4pe2lmKCFXKG4pKXRocm93IG5ldyBUeXBlRXJyb3IoInJvdyBpbmRpY2VzIG11c3QgYmUgYW4gYXJyYXkiKTtmb3IobGV0IGU9MDtlPG4ubGVuZ3RoO2UrKylpZihuW2VdPDB8fG5bZV0+PW8ucm93cyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigicm93IGluZGljZXMgYXJlIG91dCBvZiByYW5nZSIpfWZ1bmN0aW9uIGxlKG8sbil7aWYoIVcobikpdGhyb3cgbmV3IFR5cGVFcnJvcigiY29sdW1uIGluZGljZXMgbXVzdCBiZSBhbiBhcnJheSIpO2ZvcihsZXQgZT0wO2U8bi5sZW5ndGg7ZSsrKWlmKG5bZV08MHx8bltlXT49by5jb2x1bW5zKXRocm93IG5ldyBSYW5nZUVycm9yKCJjb2x1bW4gaW5kaWNlcyBhcmUgb3V0IG9mIHJhbmdlIil9ZnVuY3Rpb24gRnQobyxuLGUsdCxzKXtpZihhcmd1bWVudHMubGVuZ3RoIT09NSl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiZXhwZWN0ZWQgNCBhcmd1bWVudHMiKTtpZihhdCgic3RhcnRSb3ciLG4pLGF0KCJlbmRSb3ciLGUpLGF0KCJzdGFydENvbHVtbiIsdCksYXQoImVuZENvbHVtbiIscyksbj5lfHx0PnN8fG48MHx8bj49by5yb3dzfHxlPDB8fGU+PW8ucm93c3x8dDwwfHx0Pj1vLmNvbHVtbnN8fHM8MHx8cz49by5jb2x1bW5zKXRocm93IG5ldyBSYW5nZUVycm9yKCJTdWJtYXRyaXggaW5kaWNlcyBhcmUgb3V0IG9mIHJhbmdlIil9ZnVuY3Rpb24gZ3QobyxuPTApe2xldCBlPVtdO2ZvcihsZXQgdD0wO3Q8bzt0KyspZS5wdXNoKG4pO3JldHVybiBlfWZ1bmN0aW9uIGF0KG8sbil7aWYodHlwZW9mIG4hPSJudW1iZXIiKXRocm93IG5ldyBUeXBlRXJyb3IoYCR7b30gbXVzdCBiZSBhIG51bWJlcmApfWZ1bmN0aW9uIG50KG8pe2lmKG8uaXNFbXB0eSgpKXRocm93IG5ldyBFcnJvcigiRW1wdHkgbWF0cml4IGhhcyBubyBlbGVtZW50cyB0byBpbmRleCIpfWZ1bmN0aW9uIGhlKG8pe2xldCBuPWd0KG8ucm93cyk7Zm9yKGxldCBlPTA7ZTxvLnJvd3M7KytlKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zOysrdCluW2VdKz1vLmdldChlLHQpO3JldHVybiBufWZ1bmN0aW9uIHVlKG8pe2xldCBuPWd0KG8uY29sdW1ucyk7Zm9yKGxldCBlPTA7ZTxvLnJvd3M7KytlKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zOysrdCluW3RdKz1vLmdldChlLHQpO3JldHVybiBufWZ1bmN0aW9uIGNlKG8pe2xldCBuPTA7Zm9yKGxldCBlPTA7ZTxvLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zO3QrKyluKz1vLmdldChlLHQpO3JldHVybiBufWZ1bmN0aW9uIGZlKG8pe2xldCBuPWd0KG8ucm93cywxKTtmb3IobGV0IGU9MDtlPG8ucm93czsrK2UpZm9yKGxldCB0PTA7dDxvLmNvbHVtbnM7Kyt0KW5bZV0qPW8uZ2V0KGUsdCk7cmV0dXJuIG59ZnVuY3Rpb24gZ2Uobyl7bGV0IG49Z3Qoby5jb2x1bW5zLDEpO2ZvcihsZXQgZT0wO2U8by5yb3dzOysrZSlmb3IobGV0IHQ9MDt0PG8uY29sdW1uczsrK3Qpblt0XSo9by5nZXQoZSx0KTtyZXR1cm4gbn1mdW5jdGlvbiBhZShvKXtsZXQgbj0xO2ZvcihsZXQgZT0wO2U8by5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PG8uY29sdW1uczt0Kyspbio9by5nZXQoZSx0KTtyZXR1cm4gbn1mdW5jdGlvbiBtZShvLG4sZSl7Y29uc3QgdD1vLnJvd3Mscz1vLmNvbHVtbnMscj1bXTtmb3IobGV0IGk9MDtpPHQ7aSsrKXtsZXQgaD0wLGw9MCx1PTA7Zm9yKGxldCBmPTA7ZjxzO2YrKyl1PW8uZ2V0KGksZiktZVtpXSxoKz11LGwrPXUqdTtuP3IucHVzaCgobC1oKmgvcykvKHMtMSkpOnIucHVzaCgobC1oKmgvcykvcyl9cmV0dXJuIHJ9ZnVuY3Rpb24gd2UobyxuLGUpe2NvbnN0IHQ9by5yb3dzLHM9by5jb2x1bW5zLHI9W107Zm9yKGxldCBpPTA7aTxzO2krKyl7bGV0IGg9MCxsPTAsdT0wO2ZvcihsZXQgZj0wO2Y8dDtmKyspdT1vLmdldChmLGkpLWVbaV0saCs9dSxsKz11KnU7bj9yLnB1c2goKGwtaCpoL3QpLyh0LTEpKTpyLnB1c2goKGwtaCpoL3QpL3QpfXJldHVybiByfWZ1bmN0aW9uIHBlKG8sbixlKXtjb25zdCB0PW8ucm93cyxzPW8uY29sdW1ucyxyPXQqcztsZXQgaT0wLGg9MCxsPTA7Zm9yKGxldCB1PTA7dTx0O3UrKylmb3IobGV0IGY9MDtmPHM7ZisrKWw9by5nZXQodSxmKS1lLGkrPWwsaCs9bCpsO3JldHVybiBuPyhoLWkqaS9yKS8oci0xKTooaC1pKmkvcikvcn1mdW5jdGlvbiBkZShvLG4pe2ZvcihsZXQgZT0wO2U8by5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PG8uY29sdW1uczt0Kyspby5zZXQoZSx0LG8uZ2V0KGUsdCktbltlXSl9ZnVuY3Rpb24geWUobyxuKXtmb3IobGV0IGU9MDtlPG8ucm93cztlKyspZm9yKGxldCB0PTA7dDxvLmNvbHVtbnM7dCsrKW8uc2V0KGUsdCxvLmdldChlLHQpLW5bdF0pfWZ1bmN0aW9uIE1lKG8sbil7Zm9yKGxldCBlPTA7ZTxvLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zO3QrKylvLnNldChlLHQsby5nZXQoZSx0KS1uKX1mdW5jdGlvbiBFZShvKXtjb25zdCBuPVtdO2ZvcihsZXQgZT0wO2U8by5yb3dzO2UrKyl7bGV0IHQ9MDtmb3IobGV0IHM9MDtzPG8uY29sdW1ucztzKyspdCs9TWF0aC5wb3coby5nZXQoZSxzKSwyKS8oby5jb2x1bW5zLTEpO24ucHVzaChNYXRoLnNxcnQodCkpfXJldHVybiBufWZ1bmN0aW9uIFNlKG8sbil7Zm9yKGxldCBlPTA7ZTxvLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zO3QrKylvLnNldChlLHQsby5nZXQoZSx0KS9uW2VdKX1mdW5jdGlvbiBqZShvKXtjb25zdCBuPVtdO2ZvcihsZXQgZT0wO2U8by5jb2x1bW5zO2UrKyl7bGV0IHQ9MDtmb3IobGV0IHM9MDtzPG8ucm93cztzKyspdCs9TWF0aC5wb3coby5nZXQocyxlKSwyKS8oby5yb3dzLTEpO24ucHVzaChNYXRoLnNxcnQodCkpfXJldHVybiBufWZ1bmN0aW9uIGtlKG8sbil7Zm9yKGxldCBlPTA7ZTxvLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zO3QrKylvLnNldChlLHQsby5nZXQoZSx0KS9uW3RdKX1mdW5jdGlvbiBiZShvKXtjb25zdCBuPW8uc2l6ZS0xO2xldCBlPTA7Zm9yKGxldCB0PTA7dDxvLmNvbHVtbnM7dCsrKWZvcihsZXQgcz0wO3M8by5yb3dzO3MrKyllKz1NYXRoLnBvdyhvLmdldChzLHQpLDIpL247cmV0dXJuIE1hdGguc3FydChlKX1mdW5jdGlvbiBJZShvLG4pe2ZvcihsZXQgZT0wO2U8by5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PG8uY29sdW1uczt0Kyspby5zZXQoZSx0LG8uZ2V0KGUsdCkvbil9Y2xhc3MgX3tzdGF0aWMgZnJvbTFEQXJyYXkobixlLHQpe2lmKG4qZSE9PXQubGVuZ3RoKXRocm93IG5ldyBSYW5nZUVycm9yKCJkYXRhIGxlbmd0aCBkb2VzIG5vdCBtYXRjaCBnaXZlbiBkaW1lbnNpb25zIik7bGV0IHI9bmV3IGIobixlKTtmb3IobGV0IGk9MDtpPG47aSsrKWZvcihsZXQgaD0wO2g8ZTtoKyspci5zZXQoaSxoLHRbaSplK2hdKTtyZXR1cm4gcn1zdGF0aWMgcm93VmVjdG9yKG4pe2xldCBlPW5ldyBiKDEsbi5sZW5ndGgpO2ZvcihsZXQgdD0wO3Q8bi5sZW5ndGg7dCsrKWUuc2V0KDAsdCxuW3RdKTtyZXR1cm4gZX1zdGF0aWMgY29sdW1uVmVjdG9yKG4pe2xldCBlPW5ldyBiKG4ubGVuZ3RoLDEpO2ZvcihsZXQgdD0wO3Q8bi5sZW5ndGg7dCsrKWUuc2V0KHQsMCxuW3RdKTtyZXR1cm4gZX1zdGF0aWMgemVyb3MobixlKXtyZXR1cm4gbmV3IGIobixlKX1zdGF0aWMgb25lcyhuLGUpe3JldHVybiBuZXcgYihuLGUpLmZpbGwoMSl9c3RhdGljIHJhbmQobixlLHQ9e30pe2lmKHR5cGVvZiB0IT0ib2JqZWN0Iil0aHJvdyBuZXcgVHlwZUVycm9yKCJvcHRpb25zIG11c3QgYmUgYW4gb2JqZWN0Iik7Y29uc3R7cmFuZG9tOnM9TWF0aC5yYW5kb219PXQ7bGV0IHI9bmV3IGIobixlKTtmb3IobGV0IGk9MDtpPG47aSsrKWZvcihsZXQgaD0wO2g8ZTtoKyspci5zZXQoaSxoLHMoKSk7cmV0dXJuIHJ9c3RhdGljIHJhbmRJbnQobixlLHQ9e30pe2lmKHR5cGVvZiB0IT0ib2JqZWN0Iil0aHJvdyBuZXcgVHlwZUVycm9yKCJvcHRpb25zIG11c3QgYmUgYW4gb2JqZWN0Iik7Y29uc3R7bWluOnM9MCxtYXg6cj0xZTMscmFuZG9tOmk9TWF0aC5yYW5kb219PXQ7aWYoIU51bWJlci5pc0ludGVnZXIocykpdGhyb3cgbmV3IFR5cGVFcnJvcigibWluIG11c3QgYmUgYW4gaW50ZWdlciIpO2lmKCFOdW1iZXIuaXNJbnRlZ2VyKHIpKXRocm93IG5ldyBUeXBlRXJyb3IoIm1heCBtdXN0IGJlIGFuIGludGVnZXIiKTtpZihzPj1yKXRocm93IG5ldyBSYW5nZUVycm9yKCJtaW4gbXVzdCBiZSBzbWFsbGVyIHRoYW4gbWF4Iik7bGV0IGg9ci1zLGw9bmV3IGIobixlKTtmb3IobGV0IHU9MDt1PG47dSsrKWZvcihsZXQgZj0wO2Y8ZTtmKyspe2xldCBnPXMrTWF0aC5yb3VuZChpKCkqaCk7bC5zZXQodSxmLGcpfXJldHVybiBsfXN0YXRpYyBleWUobixlLHQpe2U9PT12b2lkIDAmJihlPW4pLHQ9PT12b2lkIDAmJih0PTEpO2xldCBzPU1hdGgubWluKG4sZSkscj10aGlzLnplcm9zKG4sZSk7Zm9yKGxldCBpPTA7aTxzO2krKylyLnNldChpLGksdCk7cmV0dXJuIHJ9c3RhdGljIGRpYWcobixlLHQpe2xldCBzPW4ubGVuZ3RoO2U9PT12b2lkIDAmJihlPXMpLHQ9PT12b2lkIDAmJih0PWUpO2xldCByPU1hdGgubWluKHMsZSx0KSxpPXRoaXMuemVyb3MoZSx0KTtmb3IobGV0IGg9MDtoPHI7aCsrKWkuc2V0KGgsaCxuW2hdKTtyZXR1cm4gaX1zdGF0aWMgbWluKG4sZSl7bj10aGlzLmNoZWNrTWF0cml4KG4pLGU9dGhpcy5jaGVja01hdHJpeChlKTtsZXQgdD1uLnJvd3Mscz1uLmNvbHVtbnMscj1uZXcgYih0LHMpO2ZvcihsZXQgaT0wO2k8dDtpKyspZm9yKGxldCBoPTA7aDxzO2grKylyLnNldChpLGgsTWF0aC5taW4obi5nZXQoaSxoKSxlLmdldChpLGgpKSk7cmV0dXJuIHJ9c3RhdGljIG1heChuLGUpe249dGhpcy5jaGVja01hdHJpeChuKSxlPXRoaXMuY2hlY2tNYXRyaXgoZSk7bGV0IHQ9bi5yb3dzLHM9bi5jb2x1bW5zLHI9bmV3IHRoaXModCxzKTtmb3IobGV0IGk9MDtpPHQ7aSsrKWZvcihsZXQgaD0wO2g8cztoKyspci5zZXQoaSxoLE1hdGgubWF4KG4uZ2V0KGksaCksZS5nZXQoaSxoKSkpO3JldHVybiByfXN0YXRpYyBjaGVja01hdHJpeChuKXtyZXR1cm4gXy5pc01hdHJpeChuKT9uOm5ldyBiKG4pfXN0YXRpYyBpc01hdHJpeChuKXtyZXR1cm4gbiE9bnVsbCYmbi5rbGFzcz09PSJNYXRyaXgifWdldCBzaXplKCl7cmV0dXJuIHRoaXMucm93cyp0aGlzLmNvbHVtbnN9YXBwbHkobil7aWYodHlwZW9mIG4hPSJmdW5jdGlvbiIpdGhyb3cgbmV3IFR5cGVFcnJvcigiY2FsbGJhY2sgbXVzdCBiZSBhIGZ1bmN0aW9uIik7Zm9yKGxldCBlPTA7ZTx0aGlzLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyluLmNhbGwodGhpcyxlLHQpO3JldHVybiB0aGlzfXRvMURBcnJheSgpe2xldCBuPVtdO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0Kyspbi5wdXNoKHRoaXMuZ2V0KGUsdCkpO3JldHVybiBufXRvMkRBcnJheSgpe2xldCBuPVtdO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKyl7bi5wdXNoKFtdKTtmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspbltlXS5wdXNoKHRoaXMuZ2V0KGUsdCkpfXJldHVybiBufXRvSlNPTigpe3JldHVybiB0aGlzLnRvMkRBcnJheSgpfWlzUm93VmVjdG9yKCl7cmV0dXJuIHRoaXMucm93cz09PTF9aXNDb2x1bW5WZWN0b3IoKXtyZXR1cm4gdGhpcy5jb2x1bW5zPT09MX1pc1ZlY3Rvcigpe3JldHVybiB0aGlzLnJvd3M9PT0xfHx0aGlzLmNvbHVtbnM9PT0xfWlzU3F1YXJlKCl7cmV0dXJuIHRoaXMucm93cz09PXRoaXMuY29sdW1uc31pc0VtcHR5KCl7cmV0dXJuIHRoaXMucm93cz09PTB8fHRoaXMuY29sdW1ucz09PTB9aXNTeW1tZXRyaWMoKXtpZih0aGlzLmlzU3F1YXJlKCkpe2ZvcihsZXQgbj0wO248dGhpcy5yb3dzO24rKylmb3IobGV0IGU9MDtlPD1uO2UrKylpZih0aGlzLmdldChuLGUpIT09dGhpcy5nZXQoZSxuKSlyZXR1cm4hMTtyZXR1cm4hMH1yZXR1cm4hMX1pc0VjaGVsb25Gb3JtKCl7bGV0IG49MCxlPTAsdD0tMSxzPSEwLHI9ITE7Zm9yKDtuPHRoaXMucm93cyYmczspe2ZvcihlPTAscj0hMTtlPHRoaXMuY29sdW1ucyYmcj09PSExOyl0aGlzLmdldChuLGUpPT09MD9lKys6dGhpcy5nZXQobixlKT09PTEmJmU+dD8ocj0hMCx0PWUpOihzPSExLHI9ITApO24rK31yZXR1cm4gc31pc1JlZHVjZWRFY2hlbG9uRm9ybSgpe2xldCBuPTAsZT0wLHQ9LTEscz0hMCxyPSExO2Zvcig7bjx0aGlzLnJvd3MmJnM7KXtmb3IoZT0wLHI9ITE7ZTx0aGlzLmNvbHVtbnMmJnI9PT0hMTspdGhpcy5nZXQobixlKT09PTA/ZSsrOnRoaXMuZ2V0KG4sZSk9PT0xJiZlPnQ/KHI9ITAsdD1lKToocz0hMSxyPSEwKTtmb3IobGV0IGk9ZSsxO2k8dGhpcy5yb3dzO2krKyl0aGlzLmdldChuLGkpIT09MCYmKHM9ITEpO24rK31yZXR1cm4gc31lY2hlbG9uRm9ybSgpe2xldCBuPXRoaXMuY2xvbmUoKSxlPTAsdD0wO2Zvcig7ZTxuLnJvd3MmJnQ8bi5jb2x1bW5zOyl7bGV0IHM9ZTtmb3IobGV0IHI9ZTtyPG4ucm93cztyKyspbi5nZXQocix0KT5uLmdldChzLHQpJiYocz1yKTtpZihuLmdldChzLHQpPT09MCl0Kys7ZWxzZXtuLnN3YXBSb3dzKGUscyk7bGV0IHI9bi5nZXQoZSx0KTtmb3IobGV0IGk9dDtpPG4uY29sdW1ucztpKyspbi5zZXQoZSxpLG4uZ2V0KGUsaSkvcik7Zm9yKGxldCBpPWUrMTtpPG4ucm93cztpKyspe2xldCBoPW4uZ2V0KGksdCkvbi5nZXQoZSx0KTtuLnNldChpLHQsMCk7Zm9yKGxldCBsPXQrMTtsPG4uY29sdW1ucztsKyspbi5zZXQoaSxsLG4uZ2V0KGksbCktbi5nZXQoZSxsKSpoKX1lKyssdCsrfX1yZXR1cm4gbn1yZWR1Y2VkRWNoZWxvbkZvcm0oKXtsZXQgbj10aGlzLmVjaGVsb25Gb3JtKCksZT1uLmNvbHVtbnMsdD1uLnJvd3Mscz10LTE7Zm9yKDtzPj0wOylpZihuLm1heFJvdyhzKT09PTApcy0tO2Vsc2V7bGV0IHI9MCxpPSExO2Zvcig7cjx0JiZpPT09ITE7KW4uZ2V0KHMscik9PT0xP2k9ITA6cisrO2ZvcihsZXQgaD0wO2g8cztoKyspe2xldCBsPW4uZ2V0KGgscik7Zm9yKGxldCB1PXI7dTxlO3UrKyl7bGV0IGY9bi5nZXQoaCx1KS1sKm4uZ2V0KHMsdSk7bi5zZXQoaCx1LGYpfX1zLS19cmV0dXJuIG59c2V0KCl7dGhyb3cgbmV3IEVycm9yKCJzZXQgbWV0aG9kIGlzIHVuaW1wbGVtZW50ZWQiKX1nZXQoKXt0aHJvdyBuZXcgRXJyb3IoImdldCBtZXRob2QgaXMgdW5pbXBsZW1lbnRlZCIpfXJlcGVhdChuPXt9KXtpZih0eXBlb2YgbiE9Im9iamVjdCIpdGhyb3cgbmV3IFR5cGVFcnJvcigib3B0aW9ucyBtdXN0IGJlIGFuIG9iamVjdCIpO2NvbnN0e3Jvd3M6ZT0xLGNvbHVtbnM6dD0xfT1uO2lmKCFOdW1iZXIuaXNJbnRlZ2VyKGUpfHxlPD0wKXRocm93IG5ldyBUeXBlRXJyb3IoInJvd3MgbXVzdCBiZSBhIHBvc2l0aXZlIGludGVnZXIiKTtpZighTnVtYmVyLmlzSW50ZWdlcih0KXx8dDw9MCl0aHJvdyBuZXcgVHlwZUVycm9yKCJjb2x1bW5zIG11c3QgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyIik7bGV0IHM9bmV3IGIodGhpcy5yb3dzKmUsdGhpcy5jb2x1bW5zKnQpO2ZvcihsZXQgcj0wO3I8ZTtyKyspZm9yKGxldCBpPTA7aTx0O2krKylzLnNldFN1Yk1hdHJpeCh0aGlzLHRoaXMucm93cypyLHRoaXMuY29sdW1ucyppKTtyZXR1cm4gc31maWxsKG4pe2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5zZXQoZSx0LG4pO3JldHVybiB0aGlzfW5lZygpe3JldHVybiB0aGlzLm11bFMoLTEpfWdldFJvdyhuKXtRKHRoaXMsbik7bGV0IGU9W107Zm9yKGxldCB0PTA7dDx0aGlzLmNvbHVtbnM7dCsrKWUucHVzaCh0aGlzLmdldChuLHQpKTtyZXR1cm4gZX1nZXRSb3dWZWN0b3Iobil7cmV0dXJuIGIucm93VmVjdG9yKHRoaXMuZ2V0Um93KG4pKX1zZXRSb3cobixlKXtRKHRoaXMsbiksZT10dCh0aGlzLGUpO2ZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChuLHQsZVt0XSk7cmV0dXJuIHRoaXN9c3dhcFJvd3MobixlKXtRKHRoaXMsbiksUSh0aGlzLGUpO2ZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl7bGV0IHM9dGhpcy5nZXQobix0KTt0aGlzLnNldChuLHQsdGhpcy5nZXQoZSx0KSksdGhpcy5zZXQoZSx0LHMpfXJldHVybiB0aGlzfWdldENvbHVtbihuKXtaKHRoaXMsbik7bGV0IGU9W107Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWUucHVzaCh0aGlzLmdldCh0LG4pKTtyZXR1cm4gZX1nZXRDb2x1bW5WZWN0b3Iobil7cmV0dXJuIGIuY29sdW1uVmVjdG9yKHRoaXMuZ2V0Q29sdW1uKG4pKX1zZXRDb2x1bW4obixlKXtaKHRoaXMsbiksZT1ldCh0aGlzLGUpO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKyl0aGlzLnNldCh0LG4sZVt0XSk7cmV0dXJuIHRoaXN9c3dhcENvbHVtbnMobixlKXtaKHRoaXMsbiksWih0aGlzLGUpO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKyl7bGV0IHM9dGhpcy5nZXQodCxuKTt0aGlzLnNldCh0LG4sdGhpcy5nZXQodCxlKSksdGhpcy5zZXQodCxlLHMpfXJldHVybiB0aGlzfWFkZFJvd1ZlY3RvcihuKXtuPXR0KHRoaXMsbik7Zm9yKGxldCBlPTA7ZTx0aGlzLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChlLHQsdGhpcy5nZXQoZSx0KStuW3RdKTtyZXR1cm4gdGhpc31zdWJSb3dWZWN0b3Iobil7bj10dCh0aGlzLG4pO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5zZXQoZSx0LHRoaXMuZ2V0KGUsdCktblt0XSk7cmV0dXJuIHRoaXN9bXVsUm93VmVjdG9yKG4pe249dHQodGhpcyxuKTtmb3IobGV0IGU9MDtlPHRoaXMucm93cztlKyspZm9yKGxldCB0PTA7dDx0aGlzLmNvbHVtbnM7dCsrKXRoaXMuc2V0KGUsdCx0aGlzLmdldChlLHQpKm5bdF0pO3JldHVybiB0aGlzfWRpdlJvd1ZlY3RvcihuKXtuPXR0KHRoaXMsbik7Zm9yKGxldCBlPTA7ZTx0aGlzLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChlLHQsdGhpcy5nZXQoZSx0KS9uW3RdKTtyZXR1cm4gdGhpc31hZGRDb2x1bW5WZWN0b3Iobil7bj1ldCh0aGlzLG4pO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5zZXQoZSx0LHRoaXMuZ2V0KGUsdCkrbltlXSk7cmV0dXJuIHRoaXN9c3ViQ29sdW1uVmVjdG9yKG4pe249ZXQodGhpcyxuKTtmb3IobGV0IGU9MDtlPHRoaXMucm93cztlKyspZm9yKGxldCB0PTA7dDx0aGlzLmNvbHVtbnM7dCsrKXRoaXMuc2V0KGUsdCx0aGlzLmdldChlLHQpLW5bZV0pO3JldHVybiB0aGlzfW11bENvbHVtblZlY3RvcihuKXtuPWV0KHRoaXMsbik7Zm9yKGxldCBlPTA7ZTx0aGlzLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChlLHQsdGhpcy5nZXQoZSx0KSpuW2VdKTtyZXR1cm4gdGhpc31kaXZDb2x1bW5WZWN0b3Iobil7bj1ldCh0aGlzLG4pO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5zZXQoZSx0LHRoaXMuZ2V0KGUsdCkvbltlXSk7cmV0dXJuIHRoaXN9bXVsUm93KG4sZSl7USh0aGlzLG4pO2ZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChuLHQsdGhpcy5nZXQobix0KSplKTtyZXR1cm4gdGhpc31tdWxDb2x1bW4obixlKXtaKHRoaXMsbik7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKXRoaXMuc2V0KHQsbix0aGlzLmdldCh0LG4pKmUpO3JldHVybiB0aGlzfW1heChuKXtpZih0aGlzLmlzRW1wdHkoKSlyZXR1cm4gTmFOO3N3aXRjaChuKXtjYXNlInJvdyI6e2NvbnN0IGU9bmV3IEFycmF5KHRoaXMucm93cykuZmlsbChOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkpO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5nZXQodCxzKT5lW3RdJiYoZVt0XT10aGlzLmdldCh0LHMpKTtyZXR1cm4gZX1jYXNlImNvbHVtbiI6e2NvbnN0IGU9bmV3IEFycmF5KHRoaXMuY29sdW1ucykuZmlsbChOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkpO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5nZXQodCxzKT5lW3NdJiYoZVtzXT10aGlzLmdldCh0LHMpKTtyZXR1cm4gZX1jYXNlIHZvaWQgMDp7bGV0IGU9dGhpcy5nZXQoMCwwKTtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuZ2V0KHQscyk+ZSYmKGU9dGhpcy5nZXQodCxzKSk7cmV0dXJuIGV9ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgb3B0aW9uOiAke259YCl9fW1heEluZGV4KCl7bnQodGhpcyk7bGV0IG49dGhpcy5nZXQoMCwwKSxlPVswLDBdO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5nZXQodCxzKT5uJiYobj10aGlzLmdldCh0LHMpLGVbMF09dCxlWzFdPXMpO3JldHVybiBlfW1pbihuKXtpZih0aGlzLmlzRW1wdHkoKSlyZXR1cm4gTmFOO3N3aXRjaChuKXtjYXNlInJvdyI6e2NvbnN0IGU9bmV3IEFycmF5KHRoaXMucm93cykuZmlsbChOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5nZXQodCxzKTxlW3RdJiYoZVt0XT10aGlzLmdldCh0LHMpKTtyZXR1cm4gZX1jYXNlImNvbHVtbiI6e2NvbnN0IGU9bmV3IEFycmF5KHRoaXMuY29sdW1ucykuZmlsbChOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5nZXQodCxzKTxlW3NdJiYoZVtzXT10aGlzLmdldCh0LHMpKTtyZXR1cm4gZX1jYXNlIHZvaWQgMDp7bGV0IGU9dGhpcy5nZXQoMCwwKTtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuZ2V0KHQscyk8ZSYmKGU9dGhpcy5nZXQodCxzKSk7cmV0dXJuIGV9ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgb3B0aW9uOiAke259YCl9fW1pbkluZGV4KCl7bnQodGhpcyk7bGV0IG49dGhpcy5nZXQoMCwwKSxlPVswLDBdO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5nZXQodCxzKTxuJiYobj10aGlzLmdldCh0LHMpLGVbMF09dCxlWzFdPXMpO3JldHVybiBlfW1heFJvdyhuKXtpZihRKHRoaXMsbiksdGhpcy5pc0VtcHR5KCkpcmV0dXJuIE5hTjtsZXQgZT10aGlzLmdldChuLDApO2ZvcihsZXQgdD0xO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLmdldChuLHQpPmUmJihlPXRoaXMuZ2V0KG4sdCkpO3JldHVybiBlfW1heFJvd0luZGV4KG4pe1EodGhpcyxuKSxudCh0aGlzKTtsZXQgZT10aGlzLmdldChuLDApLHQ9W24sMF07Zm9yKGxldCBzPTE7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuZ2V0KG4scyk+ZSYmKGU9dGhpcy5nZXQobixzKSx0WzFdPXMpO3JldHVybiB0fW1pblJvdyhuKXtpZihRKHRoaXMsbiksdGhpcy5pc0VtcHR5KCkpcmV0dXJuIE5hTjtsZXQgZT10aGlzLmdldChuLDApO2ZvcihsZXQgdD0xO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLmdldChuLHQpPGUmJihlPXRoaXMuZ2V0KG4sdCkpO3JldHVybiBlfW1pblJvd0luZGV4KG4pe1EodGhpcyxuKSxudCh0aGlzKTtsZXQgZT10aGlzLmdldChuLDApLHQ9W24sMF07Zm9yKGxldCBzPTE7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuZ2V0KG4scyk8ZSYmKGU9dGhpcy5nZXQobixzKSx0WzFdPXMpO3JldHVybiB0fW1heENvbHVtbihuKXtpZihaKHRoaXMsbiksdGhpcy5pc0VtcHR5KCkpcmV0dXJuIE5hTjtsZXQgZT10aGlzLmdldCgwLG4pO2ZvcihsZXQgdD0xO3Q8dGhpcy5yb3dzO3QrKyl0aGlzLmdldCh0LG4pPmUmJihlPXRoaXMuZ2V0KHQsbikpO3JldHVybiBlfW1heENvbHVtbkluZGV4KG4pe1oodGhpcyxuKSxudCh0aGlzKTtsZXQgZT10aGlzLmdldCgwLG4pLHQ9WzAsbl07Zm9yKGxldCBzPTE7czx0aGlzLnJvd3M7cysrKXRoaXMuZ2V0KHMsbik+ZSYmKGU9dGhpcy5nZXQocyxuKSx0WzBdPXMpO3JldHVybiB0fW1pbkNvbHVtbihuKXtpZihaKHRoaXMsbiksdGhpcy5pc0VtcHR5KCkpcmV0dXJuIE5hTjtsZXQgZT10aGlzLmdldCgwLG4pO2ZvcihsZXQgdD0xO3Q8dGhpcy5yb3dzO3QrKyl0aGlzLmdldCh0LG4pPGUmJihlPXRoaXMuZ2V0KHQsbikpO3JldHVybiBlfW1pbkNvbHVtbkluZGV4KG4pe1oodGhpcyxuKSxudCh0aGlzKTtsZXQgZT10aGlzLmdldCgwLG4pLHQ9WzAsbl07Zm9yKGxldCBzPTE7czx0aGlzLnJvd3M7cysrKXRoaXMuZ2V0KHMsbik8ZSYmKGU9dGhpcy5nZXQocyxuKSx0WzBdPXMpO3JldHVybiB0fWRpYWcoKXtsZXQgbj1NYXRoLm1pbih0aGlzLnJvd3MsdGhpcy5jb2x1bW5zKSxlPVtdO2ZvcihsZXQgdD0wO3Q8bjt0KyspZS5wdXNoKHRoaXMuZ2V0KHQsdCkpO3JldHVybiBlfW5vcm0obj0iZnJvYmVuaXVzIil7bGV0IGU9MDtpZihuPT09Im1heCIpcmV0dXJuIHRoaXMubWF4KCk7aWYobj09PSJmcm9iZW5pdXMiKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKWU9ZSt0aGlzLmdldCh0LHMpKnRoaXMuZ2V0KHQscyk7cmV0dXJuIE1hdGguc3FydChlKX1lbHNlIHRocm93IG5ldyBSYW5nZUVycm9yKGB1bmtub3duIG5vcm0gdHlwZTogJHtufWApfWN1bXVsYXRpdmVTdW0oKXtsZXQgbj0wO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0Kyspbis9dGhpcy5nZXQoZSx0KSx0aGlzLnNldChlLHQsbik7cmV0dXJuIHRoaXN9ZG90KG4pe18uaXNNYXRyaXgobikmJihuPW4udG8xREFycmF5KCkpO2xldCBlPXRoaXMudG8xREFycmF5KCk7aWYoZS5sZW5ndGghPT1uLmxlbmd0aCl0aHJvdyBuZXcgUmFuZ2VFcnJvcigidmVjdG9ycyBkbyBub3QgaGF2ZSB0aGUgc2FtZSBzaXplIik7bGV0IHQ9MDtmb3IobGV0IHM9MDtzPGUubGVuZ3RoO3MrKyl0Kz1lW3NdKm5bc107cmV0dXJuIHR9bW11bChuKXtuPWIuY2hlY2tNYXRyaXgobik7bGV0IGU9dGhpcy5yb3dzLHQ9dGhpcy5jb2x1bW5zLHM9bi5jb2x1bW5zLHI9bmV3IGIoZSxzKSxpPW5ldyBGbG9hdDY0QXJyYXkodCk7Zm9yKGxldCBoPTA7aDxzO2grKyl7Zm9yKGxldCBsPTA7bDx0O2wrKylpW2xdPW4uZ2V0KGwsaCk7Zm9yKGxldCBsPTA7bDxlO2wrKyl7bGV0IHU9MDtmb3IobGV0IGY9MDtmPHQ7ZisrKXUrPXRoaXMuZ2V0KGwsZikqaVtmXTtyLnNldChsLGgsdSl9fXJldHVybiByfXN0cmFzc2VuMngyKG4pe249Yi5jaGVja01hdHJpeChuKTtsZXQgZT1uZXcgYigyLDIpO2NvbnN0IHQ9dGhpcy5nZXQoMCwwKSxzPW4uZ2V0KDAsMCkscj10aGlzLmdldCgwLDEpLGk9bi5nZXQoMCwxKSxoPXRoaXMuZ2V0KDEsMCksbD1uLmdldCgxLDApLHU9dGhpcy5nZXQoMSwxKSxmPW4uZ2V0KDEsMSksZz0odCt1KSoocytmKSxhPShoK3UpKnMsaj10KihpLWYpLHc9dSoobC1zKSx5PSh0K3IpKmYsbT0oaC10KSoocytpKSxNPShyLXUpKihsK2YpLFQ9Zyt3LXkrTSxFPWoreSxrPWErdyxSPWctYStqK207cmV0dXJuIGUuc2V0KDAsMCxUKSxlLnNldCgwLDEsRSksZS5zZXQoMSwwLGspLGUuc2V0KDEsMSxSKSxlfXN0cmFzc2VuM3gzKG4pe249Yi5jaGVja01hdHJpeChuKTtsZXQgZT1uZXcgYigzLDMpO2NvbnN0IHQ9dGhpcy5nZXQoMCwwKSxzPXRoaXMuZ2V0KDAsMSkscj10aGlzLmdldCgwLDIpLGk9dGhpcy5nZXQoMSwwKSxoPXRoaXMuZ2V0KDEsMSksbD10aGlzLmdldCgxLDIpLHU9dGhpcy5nZXQoMiwwKSxmPXRoaXMuZ2V0KDIsMSksZz10aGlzLmdldCgyLDIpLGE9bi5nZXQoMCwwKSxqPW4uZ2V0KDAsMSksdz1uLmdldCgwLDIpLHk9bi5nZXQoMSwwKSxtPW4uZ2V0KDEsMSksTT1uLmdldCgxLDIpLFQ9bi5nZXQoMiwwKSxFPW4uZ2V0KDIsMSksaz1uLmdldCgyLDIpLFI9KHQrcytyLWktaC1mLWcpKm0scT0odC1pKSooLWorbSksST1oKigtYStqK3ktbS1NLVQrayksej0oLXQraStoKSooYS1qK20pLEI9KGkraCkqKC1hK2opLGM9dCphLHA9KC10K3UrZikqKGEtdytNKSxTPSgtdCt1KSoody1NKSxkPSh1K2YpKigtYSt3KSxEPSh0K3Mrci1oLWwtdS1mKSpNLFU9ZiooLWErdyt5LW0tTS1UK0UpLEY9KC1yK2YrZykqKG0rVC1FKSxQPShyLWcpKihtLUUpLFk9cipULEc9KGYrZykqKC1UK0UpLE49KC1yK2grbCkqKE0rVC1rKSwkPShyLWwpKihNLWspLEs9KGgrbCkqKC1UK2spLHY9cyp5LFY9bCpFLEw9aSp3LEM9dSpqLFg9ZyprLHd0PWMrWSt2LHB0PVIreitCK2MrRitZK0csZHQ9YytwK2QrRCtZK04rSyxpdD1xK0kreitjK1krTiskLGx0PXEreitCK2MrVixodD1ZK04rJCtLK0wsanQ9YytwK1MrVStGK1ArWSx1dD1GK1ArWStHK0Msa3Q9YytwK1MrZCtYO3JldHVybiBlLnNldCgwLDAsd3QpLGUuc2V0KDAsMSxwdCksZS5zZXQoMCwyLGR0KSxlLnNldCgxLDAsaXQpLGUuc2V0KDEsMSxsdCksZS5zZXQoMSwyLGh0KSxlLnNldCgyLDAsanQpLGUuc2V0KDIsMSx1dCksZS5zZXQoMiwyLGt0KSxlfW1tdWxTdHJhc3NlbihuKXtuPWIuY2hlY2tNYXRyaXgobik7bGV0IGU9dGhpcy5jbG9uZSgpLHQ9ZS5yb3dzLHM9ZS5jb2x1bW5zLHI9bi5yb3dzLGk9bi5jb2x1bW5zO3MhPT1yJiZjb25zb2xlLndhcm4oYE11bHRpcGx5aW5nICR7dH0geCAke3N9IGFuZCAke3J9IHggJHtpfSBtYXRyaXg6IGRpbWVuc2lvbnMgZG8gbm90IG1hdGNoLmApO2Z1bmN0aW9uIGgoZyxhLGope2xldCB3PWcucm93cyx5PWcuY29sdW1ucztpZih3PT09YSYmeT09PWopcmV0dXJuIGc7e2xldCBtPV8uemVyb3MoYSxqKTtyZXR1cm4gbT1tLnNldFN1Yk1hdHJpeChnLDAsMCksbX19bGV0IGw9TWF0aC5tYXgodCxyKSx1PU1hdGgubWF4KHMsaSk7ZT1oKGUsbCx1KSxuPWgobixsLHUpO2Z1bmN0aW9uIGYoZyxhLGosdyl7aWYoajw9NTEyfHx3PD01MTIpcmV0dXJuIGcubW11bChhKTtqJTI9PT0xJiZ3JTI9PT0xPyhnPWgoZyxqKzEsdysxKSxhPWgoYSxqKzEsdysxKSk6aiUyPT09MT8oZz1oKGcsaisxLHcpLGE9aChhLGorMSx3KSk6dyUyPT09MSYmKGc9aChnLGosdysxKSxhPWgoYSxqLHcrMSkpO2xldCB5PXBhcnNlSW50KGcucm93cy8yLDEwKSxtPXBhcnNlSW50KGcuY29sdW1ucy8yLDEwKSxNPWcuc3ViTWF0cml4KDAseS0xLDAsbS0xKSxUPWEuc3ViTWF0cml4KDAseS0xLDAsbS0xKSxFPWcuc3ViTWF0cml4KDAseS0xLG0sZy5jb2x1bW5zLTEpLGs9YS5zdWJNYXRyaXgoMCx5LTEsbSxhLmNvbHVtbnMtMSksUj1nLnN1Yk1hdHJpeCh5LGcucm93cy0xLDAsbS0xKSxxPWEuc3ViTWF0cml4KHksYS5yb3dzLTEsMCxtLTEpLEk9Zy5zdWJNYXRyaXgoeSxnLnJvd3MtMSxtLGcuY29sdW1ucy0xKSx6PWEuc3ViTWF0cml4KHksYS5yb3dzLTEsbSxhLmNvbHVtbnMtMSksQj1mKF8uYWRkKE0sSSksXy5hZGQoVCx6KSx5LG0pLGM9ZihfLmFkZChSLEkpLFQseSxtKSxwPWYoTSxfLnN1YihrLHopLHksbSksUz1mKEksXy5zdWIocSxUKSx5LG0pLGQ9ZihfLmFkZChNLEUpLHoseSxtKSxEPWYoXy5zdWIoUixNKSxfLmFkZChULGspLHksbSksVT1mKF8uc3ViKEUsSSksXy5hZGQocSx6KSx5LG0pLEY9Xy5hZGQoQixTKTtGLnN1YihkKSxGLmFkZChVKTtsZXQgUD1fLmFkZChwLGQpLFk9Xy5hZGQoYyxTKSxHPV8uc3ViKEIsYyk7Ry5hZGQocCksRy5hZGQoRCk7bGV0IE49Xy56ZXJvcygyKkYucm93cywyKkYuY29sdW1ucyk7cmV0dXJuIE49Ti5zZXRTdWJNYXRyaXgoRiwwLDApLE49Ti5zZXRTdWJNYXRyaXgoUCxGLnJvd3MsMCksTj1OLnNldFN1Yk1hdHJpeChZLDAsRi5jb2x1bW5zKSxOPU4uc2V0U3ViTWF0cml4KEcsRi5yb3dzLEYuY29sdW1ucyksTi5zdWJNYXRyaXgoMCxqLTEsMCx3LTEpfXJldHVybiBmKGUsbixsLHUpfXNjYWxlUm93cyhuPXt9KXtpZih0eXBlb2YgbiE9Im9iamVjdCIpdGhyb3cgbmV3IFR5cGVFcnJvcigib3B0aW9ucyBtdXN0IGJlIGFuIG9iamVjdCIpO2NvbnN0e21pbjplPTAsbWF4OnQ9MX09bjtpZighTnVtYmVyLmlzRmluaXRlKGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIm1pbiBtdXN0IGJlIGEgbnVtYmVyIik7aWYoIU51bWJlci5pc0Zpbml0ZSh0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJtYXggbXVzdCBiZSBhIG51bWJlciIpO2lmKGU+PXQpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIm1pbiBtdXN0IGJlIHNtYWxsZXIgdGhhbiBtYXgiKTtsZXQgcz1uZXcgYih0aGlzLnJvd3MsdGhpcy5jb2x1bW5zKTtmb3IobGV0IHI9MDtyPHRoaXMucm93cztyKyspe2NvbnN0IGk9dGhpcy5nZXRSb3cocik7aS5sZW5ndGg+MCYmcXQoaSx7bWluOmUsbWF4OnQsb3V0cHV0Oml9KSxzLnNldFJvdyhyLGkpfXJldHVybiBzfXNjYWxlQ29sdW1ucyhuPXt9KXtpZih0eXBlb2YgbiE9Im9iamVjdCIpdGhyb3cgbmV3IFR5cGVFcnJvcigib3B0aW9ucyBtdXN0IGJlIGFuIG9iamVjdCIpO2NvbnN0e21pbjplPTAsbWF4OnQ9MX09bjtpZighTnVtYmVyLmlzRmluaXRlKGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIm1pbiBtdXN0IGJlIGEgbnVtYmVyIik7aWYoIU51bWJlci5pc0Zpbml0ZSh0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJtYXggbXVzdCBiZSBhIG51bWJlciIpO2lmKGU+PXQpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIm1pbiBtdXN0IGJlIHNtYWxsZXIgdGhhbiBtYXgiKTtsZXQgcz1uZXcgYih0aGlzLnJvd3MsdGhpcy5jb2x1bW5zKTtmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspe2NvbnN0IGk9dGhpcy5nZXRDb2x1bW4ocik7aS5sZW5ndGgmJnF0KGkse21pbjplLG1heDp0LG91dHB1dDppfSkscy5zZXRDb2x1bW4ocixpKX1yZXR1cm4gc31mbGlwUm93cygpe2NvbnN0IG49TWF0aC5jZWlsKHRoaXMuY29sdW1ucy8yKTtmb3IobGV0IGU9MDtlPHRoaXMucm93cztlKyspZm9yKGxldCB0PTA7dDxuO3QrKyl7bGV0IHM9dGhpcy5nZXQoZSx0KSxyPXRoaXMuZ2V0KGUsdGhpcy5jb2x1bW5zLTEtdCk7dGhpcy5zZXQoZSx0LHIpLHRoaXMuc2V0KGUsdGhpcy5jb2x1bW5zLTEtdCxzKX1yZXR1cm4gdGhpc31mbGlwQ29sdW1ucygpe2NvbnN0IG49TWF0aC5jZWlsKHRoaXMucm93cy8yKTtmb3IobGV0IGU9MDtlPHRoaXMuY29sdW1ucztlKyspZm9yKGxldCB0PTA7dDxuO3QrKyl7bGV0IHM9dGhpcy5nZXQodCxlKSxyPXRoaXMuZ2V0KHRoaXMucm93cy0xLXQsZSk7dGhpcy5zZXQodCxlLHIpLHRoaXMuc2V0KHRoaXMucm93cy0xLXQsZSxzKX1yZXR1cm4gdGhpc31rcm9uZWNrZXJQcm9kdWN0KG4pe249Yi5jaGVja01hdHJpeChuKTtsZXQgZT10aGlzLnJvd3MsdD10aGlzLmNvbHVtbnMscz1uLnJvd3Mscj1uLmNvbHVtbnMsaT1uZXcgYihlKnMsdCpyKTtmb3IobGV0IGg9MDtoPGU7aCsrKWZvcihsZXQgbD0wO2w8dDtsKyspZm9yKGxldCB1PTA7dTxzO3UrKylmb3IobGV0IGY9MDtmPHI7ZisrKWkuc2V0KHMqaCt1LHIqbCtmLHRoaXMuZ2V0KGgsbCkqbi5nZXQodSxmKSk7cmV0dXJuIGl9a3JvbmVja2VyU3VtKG4pe2lmKG49Yi5jaGVja01hdHJpeChuKSwhdGhpcy5pc1NxdWFyZSgpfHwhbi5pc1NxdWFyZSgpKXRocm93IG5ldyBFcnJvcigiS3JvbmVja2VyIFN1bSBuZWVkcyB0d28gU3F1YXJlIE1hdHJpY2VzIik7bGV0IGU9dGhpcy5yb3dzLHQ9bi5yb3dzLHM9dGhpcy5rcm9uZWNrZXJQcm9kdWN0KGIuZXllKHQsdCkpLHI9Yi5leWUoZSxlKS5rcm9uZWNrZXJQcm9kdWN0KG4pO3JldHVybiBzLmFkZChyKX10cmFuc3Bvc2UoKXtsZXQgbj1uZXcgYih0aGlzLmNvbHVtbnMsdGhpcy5yb3dzKTtmb3IobGV0IGU9MDtlPHRoaXMucm93cztlKyspZm9yKGxldCB0PTA7dDx0aGlzLmNvbHVtbnM7dCsrKW4uc2V0KHQsZSx0aGlzLmdldChlLHQpKTtyZXR1cm4gbn1zb3J0Um93cyhuPVB0KXtmb3IobGV0IGU9MDtlPHRoaXMucm93cztlKyspdGhpcy5zZXRSb3coZSx0aGlzLmdldFJvdyhlKS5zb3J0KG4pKTtyZXR1cm4gdGhpc31zb3J0Q29sdW1ucyhuPVB0KXtmb3IobGV0IGU9MDtlPHRoaXMuY29sdW1ucztlKyspdGhpcy5zZXRDb2x1bW4oZSx0aGlzLmdldENvbHVtbihlKS5zb3J0KG4pKTtyZXR1cm4gdGhpc31zdWJNYXRyaXgobixlLHQscyl7RnQodGhpcyxuLGUsdCxzKTtsZXQgcj1uZXcgYihlLW4rMSxzLXQrMSk7Zm9yKGxldCBpPW47aTw9ZTtpKyspZm9yKGxldCBoPXQ7aDw9cztoKyspci5zZXQoaS1uLGgtdCx0aGlzLmdldChpLGgpKTtyZXR1cm4gcn1zdWJNYXRyaXhSb3cobixlLHQpe2lmKGU9PT12b2lkIDAmJihlPTApLHQ9PT12b2lkIDAmJih0PXRoaXMuY29sdW1ucy0xKSxlPnR8fGU8MHx8ZT49dGhpcy5jb2x1bW5zfHx0PDB8fHQ+PXRoaXMuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiQXJndW1lbnQgb3V0IG9mIHJhbmdlIik7bGV0IHM9bmV3IGIobi5sZW5ndGgsdC1lKzEpO2ZvcihsZXQgcj0wO3I8bi5sZW5ndGg7cisrKWZvcihsZXQgaT1lO2k8PXQ7aSsrKXtpZihuW3JdPDB8fG5bcl0+PXRoaXMucm93cyl0aHJvdyBuZXcgUmFuZ2VFcnJvcihgUm93IGluZGV4IG91dCBvZiByYW5nZTogJHtuW3JdfWApO3Muc2V0KHIsaS1lLHRoaXMuZ2V0KG5bcl0saSkpfXJldHVybiBzfXN1Yk1hdHJpeENvbHVtbihuLGUsdCl7aWYoZT09PXZvaWQgMCYmKGU9MCksdD09PXZvaWQgMCYmKHQ9dGhpcy5yb3dzLTEpLGU+dHx8ZTwwfHxlPj10aGlzLnJvd3N8fHQ8MHx8dD49dGhpcy5yb3dzKXRocm93IG5ldyBSYW5nZUVycm9yKCJBcmd1bWVudCBvdXQgb2YgcmFuZ2UiKTtsZXQgcz1uZXcgYih0LWUrMSxuLmxlbmd0aCk7Zm9yKGxldCByPTA7cjxuLmxlbmd0aDtyKyspZm9yKGxldCBpPWU7aTw9dDtpKyspe2lmKG5bcl08MHx8bltyXT49dGhpcy5jb2x1bW5zKXRocm93IG5ldyBSYW5nZUVycm9yKGBDb2x1bW4gaW5kZXggb3V0IG9mIHJhbmdlOiAke25bcl19YCk7cy5zZXQoaS1lLHIsdGhpcy5nZXQoaSxuW3JdKSl9cmV0dXJuIHN9c2V0U3ViTWF0cml4KG4sZSx0KXtpZihuPWIuY2hlY2tNYXRyaXgobiksbi5pc0VtcHR5KCkpcmV0dXJuIHRoaXM7bGV0IHM9ZStuLnJvd3MtMSxyPXQrbi5jb2x1bW5zLTE7RnQodGhpcyxlLHMsdCxyKTtmb3IobGV0IGk9MDtpPG4ucm93cztpKyspZm9yKGxldCBoPTA7aDxuLmNvbHVtbnM7aCsrKXRoaXMuc2V0KGUraSx0K2gsbi5nZXQoaSxoKSk7cmV0dXJuIHRoaXN9c2VsZWN0aW9uKG4sZSl7aWUodGhpcyxuKSxsZSh0aGlzLGUpO2xldCB0PW5ldyBiKG4ubGVuZ3RoLGUubGVuZ3RoKTtmb3IobGV0IHM9MDtzPG4ubGVuZ3RoO3MrKyl7bGV0IHI9bltzXTtmb3IobGV0IGk9MDtpPGUubGVuZ3RoO2krKyl7bGV0IGg9ZVtpXTt0LnNldChzLGksdGhpcy5nZXQocixoKSl9fXJldHVybiB0fXRyYWNlKCl7bGV0IG49TWF0aC5taW4odGhpcy5yb3dzLHRoaXMuY29sdW1ucyksZT0wO2ZvcihsZXQgdD0wO3Q8bjt0KyspZSs9dGhpcy5nZXQodCx0KTtyZXR1cm4gZX1jbG9uZSgpe2xldCBuPW5ldyBiKHRoaXMucm93cyx0aGlzLmNvbHVtbnMpO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0Kyspbi5zZXQoZSx0LHRoaXMuZ2V0KGUsdCkpO3JldHVybiBufXN1bShuKXtzd2l0Y2gobil7Y2FzZSJyb3ciOnJldHVybiBoZSh0aGlzKTtjYXNlImNvbHVtbiI6cmV0dXJuIHVlKHRoaXMpO2Nhc2Ugdm9pZCAwOnJldHVybiBjZSh0aGlzKTtkZWZhdWx0OnRocm93IG5ldyBFcnJvcihgaW52YWxpZCBvcHRpb246ICR7bn1gKX19cHJvZHVjdChuKXtzd2l0Y2gobil7Y2FzZSJyb3ciOnJldHVybiBmZSh0aGlzKTtjYXNlImNvbHVtbiI6cmV0dXJuIGdlKHRoaXMpO2Nhc2Ugdm9pZCAwOnJldHVybiBhZSh0aGlzKTtkZWZhdWx0OnRocm93IG5ldyBFcnJvcihgaW52YWxpZCBvcHRpb246ICR7bn1gKX19bWVhbihuKXtjb25zdCBlPXRoaXMuc3VtKG4pO3N3aXRjaChuKXtjYXNlInJvdyI6e2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKyllW3RdLz10aGlzLmNvbHVtbnM7cmV0dXJuIGV9Y2FzZSJjb2x1bW4iOntmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspZVt0XS89dGhpcy5yb3dzO3JldHVybiBlfWNhc2Ugdm9pZCAwOnJldHVybiBlL3RoaXMuc2l6ZTtkZWZhdWx0OnRocm93IG5ldyBFcnJvcihgaW52YWxpZCBvcHRpb246ICR7bn1gKX19dmFyaWFuY2UobixlPXt9KXtpZih0eXBlb2Ygbj09Im9iamVjdCImJihlPW4sbj12b2lkIDApLHR5cGVvZiBlIT0ib2JqZWN0Iil0aHJvdyBuZXcgVHlwZUVycm9yKCJvcHRpb25zIG11c3QgYmUgYW4gb2JqZWN0Iik7Y29uc3R7dW5iaWFzZWQ6dD0hMCxtZWFuOnM9dGhpcy5tZWFuKG4pfT1lO2lmKHR5cGVvZiB0IT0iYm9vbGVhbiIpdGhyb3cgbmV3IFR5cGVFcnJvcigidW5iaWFzZWQgbXVzdCBiZSBhIGJvb2xlYW4iKTtzd2l0Y2gobil7Y2FzZSJyb3ciOntpZighVyhzKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJtZWFuIG11c3QgYmUgYW4gYXJyYXkiKTtyZXR1cm4gbWUodGhpcyx0LHMpfWNhc2UiY29sdW1uIjp7aWYoIVcocykpdGhyb3cgbmV3IFR5cGVFcnJvcigibWVhbiBtdXN0IGJlIGFuIGFycmF5Iik7cmV0dXJuIHdlKHRoaXMsdCxzKX1jYXNlIHZvaWQgMDp7aWYodHlwZW9mIHMhPSJudW1iZXIiKXRocm93IG5ldyBUeXBlRXJyb3IoIm1lYW4gbXVzdCBiZSBhIG51bWJlciIpO3JldHVybiBwZSh0aGlzLHQscyl9ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgb3B0aW9uOiAke259YCl9fXN0YW5kYXJkRGV2aWF0aW9uKG4sZSl7dHlwZW9mIG49PSJvYmplY3QiJiYoZT1uLG49dm9pZCAwKTtjb25zdCB0PXRoaXMudmFyaWFuY2UobixlKTtpZihuPT09dm9pZCAwKXJldHVybiBNYXRoLnNxcnQodCk7Zm9yKGxldCBzPTA7czx0Lmxlbmd0aDtzKyspdFtzXT1NYXRoLnNxcnQodFtzXSk7cmV0dXJuIHR9Y2VudGVyKG4sZT17fSl7aWYodHlwZW9mIG49PSJvYmplY3QiJiYoZT1uLG49dm9pZCAwKSx0eXBlb2YgZSE9Im9iamVjdCIpdGhyb3cgbmV3IFR5cGVFcnJvcigib3B0aW9ucyBtdXN0IGJlIGFuIG9iamVjdCIpO2NvbnN0e2NlbnRlcjp0PXRoaXMubWVhbihuKX09ZTtzd2l0Y2gobil7Y2FzZSJyb3ciOntpZighVyh0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJjZW50ZXIgbXVzdCBiZSBhbiBhcnJheSIpO3JldHVybiBkZSh0aGlzLHQpLHRoaXN9Y2FzZSJjb2x1bW4iOntpZighVyh0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJjZW50ZXIgbXVzdCBiZSBhbiBhcnJheSIpO3JldHVybiB5ZSh0aGlzLHQpLHRoaXN9Y2FzZSB2b2lkIDA6e2lmKHR5cGVvZiB0IT0ibnVtYmVyIil0aHJvdyBuZXcgVHlwZUVycm9yKCJjZW50ZXIgbXVzdCBiZSBhIG51bWJlciIpO3JldHVybiBNZSh0aGlzLHQpLHRoaXN9ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgb3B0aW9uOiAke259YCl9fXNjYWxlKG4sZT17fSl7aWYodHlwZW9mIG49PSJvYmplY3QiJiYoZT1uLG49dm9pZCAwKSx0eXBlb2YgZSE9Im9iamVjdCIpdGhyb3cgbmV3IFR5cGVFcnJvcigib3B0aW9ucyBtdXN0IGJlIGFuIG9iamVjdCIpO2xldCB0PWUuc2NhbGU7c3dpdGNoKG4pe2Nhc2Uicm93Ijp7aWYodD09PXZvaWQgMCl0PUVlKHRoaXMpO2Vsc2UgaWYoIVcodCkpdGhyb3cgbmV3IFR5cGVFcnJvcigic2NhbGUgbXVzdCBiZSBhbiBhcnJheSIpO3JldHVybiBTZSh0aGlzLHQpLHRoaXN9Y2FzZSJjb2x1bW4iOntpZih0PT09dm9pZCAwKXQ9amUodGhpcyk7ZWxzZSBpZighVyh0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJzY2FsZSBtdXN0IGJlIGFuIGFycmF5Iik7cmV0dXJuIGtlKHRoaXMsdCksdGhpc31jYXNlIHZvaWQgMDp7aWYodD09PXZvaWQgMCl0PWJlKHRoaXMpO2Vsc2UgaWYodHlwZW9mIHQhPSJudW1iZXIiKXRocm93IG5ldyBUeXBlRXJyb3IoInNjYWxlIG11c3QgYmUgYSBudW1iZXIiKTtyZXR1cm4gSWUodGhpcyx0KSx0aGlzfWRlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKGBpbnZhbGlkIG9wdGlvbjogJHtufWApfX10b1N0cmluZyhuKXtyZXR1cm4gVHQodGhpcyxuKX19Xy5wcm90b3R5cGUua2xhc3M9Ik1hdHJpeCIsdHlwZW9mIFN5bWJvbDwidSImJihfLnByb3RvdHlwZVtTeW1ib2wuZm9yKCJub2RlanMudXRpbC5pbnNwZWN0LmN1c3RvbSIpXT1uZSk7ZnVuY3Rpb24gUHQobyxuKXtyZXR1cm4gby1ufWZ1bmN0aW9uIFJlKG8pe3JldHVybiBvLmV2ZXJ5KG49PnR5cGVvZiBuPT0ibnVtYmVyIil9Xy5yYW5kb209Xy5yYW5kLF8ucmFuZG9tSW50PV8ucmFuZEludCxfLmRpYWdvbmFsPV8uZGlhZyxfLnByb3RvdHlwZS5kaWFnb25hbD1fLnByb3RvdHlwZS5kaWFnLF8uaWRlbnRpdHk9Xy5leWUsXy5wcm90b3R5cGUubmVnYXRlPV8ucHJvdG90eXBlLm5lZyxfLnByb3RvdHlwZS50ZW5zb3JQcm9kdWN0PV8ucHJvdG90eXBlLmtyb25lY2tlclByb2R1Y3Q7Y2xhc3MgYiBleHRlbmRzIF97Y29uc3RydWN0b3IobixlKXtpZihzdXBlcigpLGIuaXNNYXRyaXgobikpcmV0dXJuIG4uY2xvbmUoKTtpZihOdW1iZXIuaXNJbnRlZ2VyKG4pJiZuPj0wKWlmKHRoaXMuZGF0YT1bXSxOdW1iZXIuaXNJbnRlZ2VyKGUpJiZlPj0wKWZvcihsZXQgdD0wO3Q8bjt0KyspdGhpcy5kYXRhLnB1c2gobmV3IEZsb2F0NjRBcnJheShlKSk7ZWxzZSB0aHJvdyBuZXcgVHlwZUVycm9yKCJuQ29sdW1ucyBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlciIpO2Vsc2UgaWYoVyhuKSl7Y29uc3QgdD1uO2lmKG49dC5sZW5ndGgsZT1uP3RbMF0ubGVuZ3RoOjAsdHlwZW9mIGUhPSJudW1iZXIiKXRocm93IG5ldyBUeXBlRXJyb3IoIkRhdGEgbXVzdCBiZSBhIDJEIGFycmF5IHdpdGggYXQgbGVhc3Qgb25lIGVsZW1lbnQiKTt0aGlzLmRhdGE9W107Zm9yKGxldCBzPTA7czxuO3MrKyl7aWYodFtzXS5sZW5ndGghPT1lKXRocm93IG5ldyBSYW5nZUVycm9yKCJJbmNvbnNpc3RlbnQgYXJyYXkgZGltZW5zaW9ucyIpO2lmKCFSZSh0W3NdKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnB1dCBkYXRhIGNvbnRhaW5zIG5vbi1udW1lcmljIHZhbHVlcyIpO3RoaXMuZGF0YS5wdXNoKEZsb2F0NjRBcnJheS5mcm9tKHRbc10pKX19ZWxzZSB0aHJvdyBuZXcgVHlwZUVycm9yKCJGaXJzdCBhcmd1bWVudCBtdXN0IGJlIGEgcG9zaXRpdmUgbnVtYmVyIG9yIGFuIGFycmF5Iik7dGhpcy5yb3dzPW4sdGhpcy5jb2x1bW5zPWV9c2V0KG4sZSx0KXtyZXR1cm4gdGhpcy5kYXRhW25dW2VdPXQsdGhpc31nZXQobixlKXtyZXR1cm4gdGhpcy5kYXRhW25dW2VdfXJlbW92ZVJvdyhuKXtyZXR1cm4gUSh0aGlzLG4pLHRoaXMuZGF0YS5zcGxpY2UobiwxKSx0aGlzLnJvd3MtPTEsdGhpc31hZGRSb3cobixlKXtyZXR1cm4gZT09PXZvaWQgMCYmKGU9bixuPXRoaXMucm93cyksUSh0aGlzLG4sITApLGU9RmxvYXQ2NEFycmF5LmZyb20odHQodGhpcyxlKSksdGhpcy5kYXRhLnNwbGljZShuLDAsZSksdGhpcy5yb3dzKz0xLHRoaXN9cmVtb3ZlQ29sdW1uKG4pe1oodGhpcyxuKTtmb3IobGV0IGU9MDtlPHRoaXMucm93cztlKyspe2NvbnN0IHQ9bmV3IEZsb2F0NjRBcnJheSh0aGlzLmNvbHVtbnMtMSk7Zm9yKGxldCBzPTA7czxuO3MrKyl0W3NdPXRoaXMuZGF0YVtlXVtzXTtmb3IobGV0IHM9bisxO3M8dGhpcy5jb2x1bW5zO3MrKyl0W3MtMV09dGhpcy5kYXRhW2VdW3NdO3RoaXMuZGF0YVtlXT10fXJldHVybiB0aGlzLmNvbHVtbnMtPTEsdGhpc31hZGRDb2x1bW4obixlKXt0eXBlb2YgZT4idSImJihlPW4sbj10aGlzLmNvbHVtbnMpLFoodGhpcyxuLCEwKSxlPWV0KHRoaXMsZSk7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKXtjb25zdCBzPW5ldyBGbG9hdDY0QXJyYXkodGhpcy5jb2x1bW5zKzEpO2xldCByPTA7Zm9yKDtyPG47cisrKXNbcl09dGhpcy5kYXRhW3RdW3JdO2ZvcihzW3IrK109ZVt0XTtyPHRoaXMuY29sdW1ucysxO3IrKylzW3JdPXRoaXMuZGF0YVt0XVtyLTFdO3RoaXMuZGF0YVt0XT1zfXJldHVybiB0aGlzLmNvbHVtbnMrPTEsdGhpc319cmUoXyxiKTtjbGFzcyBzdCBleHRlbmRzIF97Y29uc3RydWN0b3Iobil7c3VwZXIoKSx0aGlzLmRhdGE9bix0aGlzLnJvd3M9bi5sZW5ndGgsdGhpcy5jb2x1bW5zPW5bMF0ubGVuZ3RofXNldChuLGUsdCl7cmV0dXJuIHRoaXMuZGF0YVtuXVtlXT10LHRoaXN9Z2V0KG4sZSl7cmV0dXJuIHRoaXMuZGF0YVtuXVtlXX19Y2xhc3MgTmV7Y29uc3RydWN0b3Iobil7bj1zdC5jaGVja01hdHJpeChuKTtsZXQgZT1uLmNsb25lKCksdD1lLnJvd3Mscz1lLmNvbHVtbnMscj1uZXcgRmxvYXQ2NEFycmF5KHQpLGk9MSxoLGwsdSxmLGcsYSxqLHcseTtmb3IoaD0wO2g8dDtoKyspcltoXT1oO2Zvcih3PW5ldyBGbG9hdDY0QXJyYXkodCksbD0wO2w8cztsKyspe2ZvcihoPTA7aDx0O2grKyl3W2hdPWUuZ2V0KGgsbCk7Zm9yKGg9MDtoPHQ7aCsrKXtmb3IoeT1NYXRoLm1pbihoLGwpLGc9MCx1PTA7dTx5O3UrKylnKz1lLmdldChoLHUpKndbdV07d1toXS09ZyxlLnNldChoLGwsd1toXSl9Zm9yKGY9bCxoPWwrMTtoPHQ7aCsrKU1hdGguYWJzKHdbaF0pPk1hdGguYWJzKHdbZl0pJiYoZj1oKTtpZihmIT09bCl7Zm9yKHU9MDt1PHM7dSsrKWE9ZS5nZXQoZix1KSxlLnNldChmLHUsZS5nZXQobCx1KSksZS5zZXQobCx1LGEpO2o9cltmXSxyW2ZdPXJbbF0scltsXT1qLGk9LWl9aWYobDx0JiZlLmdldChsLGwpIT09MClmb3IoaD1sKzE7aDx0O2grKyllLnNldChoLGwsZS5nZXQoaCxsKS9lLmdldChsLGwpKX10aGlzLkxVPWUsdGhpcy5waXZvdFZlY3Rvcj1yLHRoaXMucGl2b3RTaWduPWl9aXNTaW5ndWxhcigpe2xldCBuPXRoaXMuTFUsZT1uLmNvbHVtbnM7Zm9yKGxldCB0PTA7dDxlO3QrKylpZihuLmdldCh0LHQpPT09MClyZXR1cm4hMDtyZXR1cm4hMX1zb2x2ZShuKXtuPWIuY2hlY2tNYXRyaXgobik7bGV0IGU9dGhpcy5MVTtpZihlLnJvd3MhPT1uLnJvd3MpdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIG1hdHJpeCBkaW1lbnNpb25zIik7aWYodGhpcy5pc1Npbmd1bGFyKCkpdGhyb3cgbmV3IEVycm9yKCJMVSBtYXRyaXggaXMgc2luZ3VsYXIiKTtsZXQgcz1uLmNvbHVtbnMscj1uLnN1Yk1hdHJpeFJvdyh0aGlzLnBpdm90VmVjdG9yLDAscy0xKSxpPWUuY29sdW1ucyxoLGwsdTtmb3IodT0wO3U8aTt1KyspZm9yKGg9dSsxO2g8aTtoKyspZm9yKGw9MDtsPHM7bCsrKXIuc2V0KGgsbCxyLmdldChoLGwpLXIuZ2V0KHUsbCkqZS5nZXQoaCx1KSk7Zm9yKHU9aS0xO3U+PTA7dS0tKXtmb3IobD0wO2w8cztsKyspci5zZXQodSxsLHIuZ2V0KHUsbCkvZS5nZXQodSx1KSk7Zm9yKGg9MDtoPHU7aCsrKWZvcihsPTA7bDxzO2wrKylyLnNldChoLGwsci5nZXQoaCxsKS1yLmdldCh1LGwpKmUuZ2V0KGgsdSkpfXJldHVybiByfWdldCBkZXRlcm1pbmFudCgpe2xldCBuPXRoaXMuTFU7aWYoIW4uaXNTcXVhcmUoKSl0aHJvdyBuZXcgRXJyb3IoIk1hdHJpeCBtdXN0IGJlIHNxdWFyZSIpO2xldCBlPXRoaXMucGl2b3RTaWduLHQ9bi5jb2x1bW5zO2ZvcihsZXQgcz0wO3M8dDtzKyspZSo9bi5nZXQocyxzKTtyZXR1cm4gZX1nZXQgbG93ZXJUcmlhbmd1bGFyTWF0cml4KCl7bGV0IG49dGhpcy5MVSxlPW4ucm93cyx0PW4uY29sdW1ucyxzPW5ldyBiKGUsdCk7Zm9yKGxldCByPTA7cjxlO3IrKylmb3IobGV0IGk9MDtpPHQ7aSsrKXI+aT9zLnNldChyLGksbi5nZXQocixpKSk6cj09PWk/cy5zZXQocixpLDEpOnMuc2V0KHIsaSwwKTtyZXR1cm4gc31nZXQgdXBwZXJUcmlhbmd1bGFyTWF0cml4KCl7bGV0IG49dGhpcy5MVSxlPW4ucm93cyx0PW4uY29sdW1ucyxzPW5ldyBiKGUsdCk7Zm9yKGxldCByPTA7cjxlO3IrKylmb3IobGV0IGk9MDtpPHQ7aSsrKXI8PWk/cy5zZXQocixpLG4uZ2V0KHIsaSkpOnMuc2V0KHIsaSwwKTtyZXR1cm4gc31nZXQgcGl2b3RQZXJtdXRhdGlvblZlY3Rvcigpe3JldHVybiBBcnJheS5mcm9tKHRoaXMucGl2b3RWZWN0b3IpfX1mdW5jdGlvbiB4KG8sbil7bGV0IGU9MDtyZXR1cm4gTWF0aC5hYnMobyk+TWF0aC5hYnMobik/KGU9bi9vLE1hdGguYWJzKG8pKk1hdGguc3FydCgxK2UqZSkpOm4hPT0wPyhlPW8vbixNYXRoLmFicyhuKSpNYXRoLnNxcnQoMStlKmUpKTowfWNsYXNzIHZle2NvbnN0cnVjdG9yKG4pe249c3QuY2hlY2tNYXRyaXgobik7bGV0IGU9bi5jbG9uZSgpLHQ9bi5yb3dzLHM9bi5jb2x1bW5zLHI9bmV3IEZsb2F0NjRBcnJheShzKSxpLGgsbCx1O2ZvcihsPTA7bDxzO2wrKyl7bGV0IGY9MDtmb3IoaT1sO2k8dDtpKyspZj14KGYsZS5nZXQoaSxsKSk7aWYoZiE9PTApe2ZvcihlLmdldChsLGwpPDAmJihmPS1mKSxpPWw7aTx0O2krKyllLnNldChpLGwsZS5nZXQoaSxsKS9mKTtmb3IoZS5zZXQobCxsLGUuZ2V0KGwsbCkrMSksaD1sKzE7aDxzO2grKyl7Zm9yKHU9MCxpPWw7aTx0O2krKyl1Kz1lLmdldChpLGwpKmUuZ2V0KGksaCk7Zm9yKHU9LXUvZS5nZXQobCxsKSxpPWw7aTx0O2krKyllLnNldChpLGgsZS5nZXQoaSxoKSt1KmUuZ2V0KGksbCkpfX1yW2xdPS1mfXRoaXMuUVI9ZSx0aGlzLlJkaWFnPXJ9c29sdmUobil7bj1iLmNoZWNrTWF0cml4KG4pO2xldCBlPXRoaXMuUVIsdD1lLnJvd3M7aWYobi5yb3dzIT09dCl0aHJvdyBuZXcgRXJyb3IoIk1hdHJpeCByb3cgZGltZW5zaW9ucyBtdXN0IGFncmVlIik7aWYoIXRoaXMuaXNGdWxsUmFuaygpKXRocm93IG5ldyBFcnJvcigiTWF0cml4IGlzIHJhbmsgZGVmaWNpZW50Iik7bGV0IHM9bi5jb2x1bW5zLHI9bi5jbG9uZSgpLGk9ZS5jb2x1bW5zLGgsbCx1LGY7Zm9yKHU9MDt1PGk7dSsrKWZvcihsPTA7bDxzO2wrKyl7Zm9yKGY9MCxoPXU7aDx0O2grKylmKz1lLmdldChoLHUpKnIuZ2V0KGgsbCk7Zm9yKGY9LWYvZS5nZXQodSx1KSxoPXU7aDx0O2grKylyLnNldChoLGwsci5nZXQoaCxsKStmKmUuZ2V0KGgsdSkpfWZvcih1PWktMTt1Pj0wO3UtLSl7Zm9yKGw9MDtsPHM7bCsrKXIuc2V0KHUsbCxyLmdldCh1LGwpL3RoaXMuUmRpYWdbdV0pO2ZvcihoPTA7aDx1O2grKylmb3IobD0wO2w8cztsKyspci5zZXQoaCxsLHIuZ2V0KGgsbCktci5nZXQodSxsKSplLmdldChoLHUpKX1yZXR1cm4gci5zdWJNYXRyaXgoMCxpLTEsMCxzLTEpfWlzRnVsbFJhbmsoKXtsZXQgbj10aGlzLlFSLmNvbHVtbnM7Zm9yKGxldCBlPTA7ZTxuO2UrKylpZih0aGlzLlJkaWFnW2VdPT09MClyZXR1cm4hMTtyZXR1cm4hMH1nZXQgdXBwZXJUcmlhbmd1bGFyTWF0cml4KCl7bGV0IG49dGhpcy5RUixlPW4uY29sdW1ucyx0PW5ldyBiKGUsZSkscyxyO2ZvcihzPTA7czxlO3MrKylmb3Iocj0wO3I8ZTtyKyspczxyP3Quc2V0KHMscixuLmdldChzLHIpKTpzPT09cj90LnNldChzLHIsdGhpcy5SZGlhZ1tzXSk6dC5zZXQocyxyLDApO3JldHVybiB0fWdldCBvcnRob2dvbmFsTWF0cml4KCl7bGV0IG49dGhpcy5RUixlPW4ucm93cyx0PW4uY29sdW1ucyxzPW5ldyBiKGUsdCkscixpLGgsbDtmb3IoaD10LTE7aD49MDtoLS0pe2ZvcihyPTA7cjxlO3IrKylzLnNldChyLGgsMCk7Zm9yKHMuc2V0KGgsaCwxKSxpPWg7aTx0O2krKylpZihuLmdldChoLGgpIT09MCl7Zm9yKGw9MCxyPWg7cjxlO3IrKylsKz1uLmdldChyLGgpKnMuZ2V0KHIsaSk7Zm9yKGw9LWwvbi5nZXQoaCxoKSxyPWg7cjxlO3IrKylzLnNldChyLGkscy5nZXQocixpKStsKm4uZ2V0KHIsaCkpfX1yZXR1cm4gc319Y2xhc3MgRHR7Y29uc3RydWN0b3IobixlPXt9KXtpZihuPXN0LmNoZWNrTWF0cml4KG4pLG4uaXNFbXB0eSgpKXRocm93IG5ldyBFcnJvcigiTWF0cml4IG11c3QgYmUgbm9uLWVtcHR5Iik7bGV0IHQ9bi5yb3dzLHM9bi5jb2x1bW5zO2NvbnN0e2NvbXB1dGVMZWZ0U2luZ3VsYXJWZWN0b3JzOnI9ITAsY29tcHV0ZVJpZ2h0U2luZ3VsYXJWZWN0b3JzOmk9ITAsYXV0b1RyYW5zcG9zZTpoPSExfT1lO2xldCBsPSEhcix1PSEhaSxmPSExLGc7aWYodDxzKWlmKCFoKWc9bi5jbG9uZSgpLGNvbnNvbGUud2FybigiQ29tcHV0aW5nIFNWRCBvbiBhIG1hdHJpeCB3aXRoIG1vcmUgY29sdW1ucyB0aGFuIHJvd3MuIENvbnNpZGVyIGVuYWJsaW5nIGF1dG9UcmFuc3Bvc2UiKTtlbHNle2c9bi50cmFuc3Bvc2UoKSx0PWcucm93cyxzPWcuY29sdW1ucyxmPSEwO2xldCBjPWw7bD11LHU9Y31lbHNlIGc9bi5jbG9uZSgpO2xldCBhPU1hdGgubWluKHQscyksaj1NYXRoLm1pbih0KzEscyksdz1uZXcgRmxvYXQ2NEFycmF5KGopLHk9bmV3IGIodCxhKSxtPW5ldyBiKHMscyksTT1uZXcgRmxvYXQ2NEFycmF5KHMpLFQ9bmV3IEZsb2F0NjRBcnJheSh0KSxFPW5ldyBGbG9hdDY0QXJyYXkoaik7Zm9yKGxldCBjPTA7YzxqO2MrKylFW2NdPWM7bGV0IGs9TWF0aC5taW4odC0xLHMpLFI9TWF0aC5tYXgoMCxNYXRoLm1pbihzLTIsdCkpLHE9TWF0aC5tYXgoayxSKTtmb3IobGV0IGM9MDtjPHE7YysrKXtpZihjPGspe3dbY109MDtmb3IobGV0IHA9YztwPHQ7cCsrKXdbY109eCh3W2NdLGcuZ2V0KHAsYykpO2lmKHdbY10hPT0wKXtnLmdldChjLGMpPDAmJih3W2NdPS13W2NdKTtmb3IobGV0IHA9YztwPHQ7cCsrKWcuc2V0KHAsYyxnLmdldChwLGMpL3dbY10pO2cuc2V0KGMsYyxnLmdldChjLGMpKzEpfXdbY109LXdbY119Zm9yKGxldCBwPWMrMTtwPHM7cCsrKXtpZihjPGsmJndbY10hPT0wKXtsZXQgUz0wO2ZvcihsZXQgZD1jO2Q8dDtkKyspUys9Zy5nZXQoZCxjKSpnLmdldChkLHApO1M9LVMvZy5nZXQoYyxjKTtmb3IobGV0IGQ9YztkPHQ7ZCsrKWcuc2V0KGQscCxnLmdldChkLHApK1MqZy5nZXQoZCxjKSl9TVtwXT1nLmdldChjLHApfWlmKGwmJmM8aylmb3IobGV0IHA9YztwPHQ7cCsrKXkuc2V0KHAsYyxnLmdldChwLGMpKTtpZihjPFIpe01bY109MDtmb3IobGV0IHA9YysxO3A8cztwKyspTVtjXT14KE1bY10sTVtwXSk7aWYoTVtjXSE9PTApe01bYysxXTwwJiYoTVtjXT0wLU1bY10pO2ZvcihsZXQgcD1jKzE7cDxzO3ArKylNW3BdLz1NW2NdO01bYysxXSs9MX1pZihNW2NdPS1NW2NdLGMrMTx0JiZNW2NdIT09MCl7Zm9yKGxldCBwPWMrMTtwPHQ7cCsrKVRbcF09MDtmb3IobGV0IHA9YysxO3A8dDtwKyspZm9yKGxldCBTPWMrMTtTPHM7UysrKVRbcF0rPU1bU10qZy5nZXQocCxTKTtmb3IobGV0IHA9YysxO3A8cztwKyspe2xldCBTPS1NW3BdL01bYysxXTtmb3IobGV0IGQ9YysxO2Q8dDtkKyspZy5zZXQoZCxwLGcuZ2V0KGQscCkrUypUW2RdKX19aWYodSlmb3IobGV0IHA9YysxO3A8cztwKyspbS5zZXQocCxjLE1bcF0pfX1sZXQgST1NYXRoLm1pbihzLHQrMSk7aWYoazxzJiYod1trXT1nLmdldChrLGspKSx0PEkmJih3W0ktMV09MCksUisxPEkmJihNW1JdPWcuZ2V0KFIsSS0xKSksTVtJLTFdPTAsbCl7Zm9yKGxldCBjPWs7YzxhO2MrKyl7Zm9yKGxldCBwPTA7cDx0O3ArKyl5LnNldChwLGMsMCk7eS5zZXQoYyxjLDEpfWZvcihsZXQgYz1rLTE7Yz49MDtjLS0paWYod1tjXSE9PTApe2ZvcihsZXQgcD1jKzE7cDxhO3ArKyl7bGV0IFM9MDtmb3IobGV0IGQ9YztkPHQ7ZCsrKVMrPXkuZ2V0KGQsYykqeS5nZXQoZCxwKTtTPS1TL3kuZ2V0KGMsYyk7Zm9yKGxldCBkPWM7ZDx0O2QrKyl5LnNldChkLHAseS5nZXQoZCxwKStTKnkuZ2V0KGQsYykpfWZvcihsZXQgcD1jO3A8dDtwKyspeS5zZXQocCxjLC15LmdldChwLGMpKTt5LnNldChjLGMsMSt5LmdldChjLGMpKTtmb3IobGV0IHA9MDtwPGMtMTtwKyspeS5zZXQocCxjLDApfWVsc2V7Zm9yKGxldCBwPTA7cDx0O3ArKyl5LnNldChwLGMsMCk7eS5zZXQoYyxjLDEpfX1pZih1KWZvcihsZXQgYz1zLTE7Yz49MDtjLS0pe2lmKGM8UiYmTVtjXSE9PTApZm9yKGxldCBwPWMrMTtwPHM7cCsrKXtsZXQgUz0wO2ZvcihsZXQgZD1jKzE7ZDxzO2QrKylTKz1tLmdldChkLGMpKm0uZ2V0KGQscCk7Uz0tUy9tLmdldChjKzEsYyk7Zm9yKGxldCBkPWMrMTtkPHM7ZCsrKW0uc2V0KGQscCxtLmdldChkLHApK1MqbS5nZXQoZCxjKSl9Zm9yKGxldCBwPTA7cDxzO3ArKyltLnNldChwLGMsMCk7bS5zZXQoYyxjLDEpfWxldCB6PUktMSxCPU51bWJlci5FUFNJTE9OO2Zvcig7ST4wOyl7bGV0IGMscDtmb3IoYz1JLTI7Yz49LTEmJmMhPT0tMTtjLS0pe2NvbnN0IFM9TnVtYmVyLk1JTl9WQUxVRStCKk1hdGguYWJzKHdbY10rTWF0aC5hYnMod1tjKzFdKSk7aWYoTWF0aC5hYnMoTVtjXSk8PVN8fE51bWJlci5pc05hTihNW2NdKSl7TVtjXT0wO2JyZWFrfX1pZihjPT09SS0yKXA9NDtlbHNle2xldCBTO2ZvcihTPUktMTtTPj1jJiZTIT09YztTLS0pe2xldCBkPShTIT09ST9NYXRoLmFicyhNW1NdKTowKSsoUyE9PWMrMT9NYXRoLmFicyhNW1MtMV0pOjApO2lmKE1hdGguYWJzKHdbU10pPD1CKmQpe3dbU109MDticmVha319Uz09PWM/cD0zOlM9PT1JLTE/cD0xOihwPTIsYz1TKX1zd2l0Y2goYysrLHApe2Nhc2UgMTp7bGV0IFM9TVtJLTJdO01bSS0yXT0wO2ZvcihsZXQgZD1JLTI7ZD49YztkLS0pe2xldCBEPXgod1tkXSxTKSxVPXdbZF0vRCxGPVMvRDtpZih3W2RdPUQsZCE9PWMmJihTPS1GKk1bZC0xXSxNW2QtMV09VSpNW2QtMV0pLHUpZm9yKGxldCBQPTA7UDxzO1ArKylEPVUqbS5nZXQoUCxkKStGKm0uZ2V0KFAsSS0xKSxtLnNldChQLEktMSwtRiptLmdldChQLGQpK1UqbS5nZXQoUCxJLTEpKSxtLnNldChQLGQsRCl9YnJlYWt9Y2FzZSAyOntsZXQgUz1NW2MtMV07TVtjLTFdPTA7Zm9yKGxldCBkPWM7ZDxJO2QrKyl7bGV0IEQ9eCh3W2RdLFMpLFU9d1tkXS9ELEY9Uy9EO2lmKHdbZF09RCxTPS1GKk1bZF0sTVtkXT1VKk1bZF0sbClmb3IobGV0IFA9MDtQPHQ7UCsrKUQ9VSp5LmdldChQLGQpK0YqeS5nZXQoUCxjLTEpLHkuc2V0KFAsYy0xLC1GKnkuZ2V0KFAsZCkrVSp5LmdldChQLGMtMSkpLHkuc2V0KFAsZCxEKX1icmVha31jYXNlIDM6e2NvbnN0IFM9TWF0aC5tYXgoTWF0aC5hYnMod1tJLTFdKSxNYXRoLmFicyh3W0ktMl0pLE1hdGguYWJzKE1bSS0yXSksTWF0aC5hYnMod1tjXSksTWF0aC5hYnMoTVtjXSkpLGQ9d1tJLTFdL1MsRD13W0ktMl0vUyxVPU1bSS0yXS9TLEY9d1tjXS9TLFA9TVtjXS9TLFk9KChEK2QpKihELWQpK1UqVSkvMixHPWQqVSooZCpVKTtsZXQgTj0wOyhZIT09MHx8RyE9PTApJiYoWTwwP049MC1NYXRoLnNxcnQoWSpZK0cpOk49TWF0aC5zcXJ0KFkqWStHKSxOPUcvKFkrTikpO2xldCAkPShGK2QpKihGLWQpK04sSz1GKlA7Zm9yKGxldCB2PWM7djxJLTE7disrKXtsZXQgVj14KCQsSyk7Vj09PTAmJihWPU51bWJlci5NSU5fVkFMVUUpO2xldCBMPSQvVixDPUsvVjtpZih2IT09YyYmKE1bdi0xXT1WKSwkPUwqd1t2XStDKk1bdl0sTVt2XT1MKk1bdl0tQyp3W3ZdLEs9Qyp3W3YrMV0sd1t2KzFdPUwqd1t2KzFdLHUpZm9yKGxldCBYPTA7WDxzO1grKylWPUwqbS5nZXQoWCx2KStDKm0uZ2V0KFgsdisxKSxtLnNldChYLHYrMSwtQyptLmdldChYLHYpK0wqbS5nZXQoWCx2KzEpKSxtLnNldChYLHYsVik7aWYoVj14KCQsSyksVj09PTAmJihWPU51bWJlci5NSU5fVkFMVUUpLEw9JC9WLEM9Sy9WLHdbdl09ViwkPUwqTVt2XStDKndbdisxXSx3W3YrMV09LUMqTVt2XStMKndbdisxXSxLPUMqTVt2KzFdLE1bdisxXT1MKk1bdisxXSxsJiZ2PHQtMSlmb3IobGV0IFg9MDtYPHQ7WCsrKVY9TCp5LmdldChYLHYpK0MqeS5nZXQoWCx2KzEpLHkuc2V0KFgsdisxLC1DKnkuZ2V0KFgsdikrTCp5LmdldChYLHYrMSkpLHkuc2V0KFgsdixWKX1NW0ktMl09JDticmVha31jYXNlIDQ6e2lmKHdbY108PTAmJih3W2NdPXdbY108MD8td1tjXTowLHUpKWZvcihsZXQgUz0wO1M8PXo7UysrKW0uc2V0KFMsYywtbS5nZXQoUyxjKSk7Zm9yKDtjPHomJiEod1tjXT49d1tjKzFdKTspe2xldCBTPXdbY107aWYod1tjXT13W2MrMV0sd1tjKzFdPVMsdSYmYzxzLTEpZm9yKGxldCBkPTA7ZDxzO2QrKylTPW0uZ2V0KGQsYysxKSxtLnNldChkLGMrMSxtLmdldChkLGMpKSxtLnNldChkLGMsUyk7aWYobCYmYzx0LTEpZm9yKGxldCBkPTA7ZDx0O2QrKylTPXkuZ2V0KGQsYysxKSx5LnNldChkLGMrMSx5LmdldChkLGMpKSx5LnNldChkLGMsUyk7YysrfUktLTticmVha319fWlmKGYpe2xldCBjPW07bT15LHk9Y310aGlzLm09dCx0aGlzLm49cyx0aGlzLnM9dyx0aGlzLlU9eSx0aGlzLlY9bX1zb2x2ZShuKXtsZXQgZT1uLHQ9dGhpcy50aHJlc2hvbGQscz10aGlzLnMubGVuZ3RoLHI9Yi56ZXJvcyhzLHMpO2ZvcihsZXQgYT0wO2E8czthKyspTWF0aC5hYnModGhpcy5zW2FdKTw9dD9yLnNldChhLGEsMCk6ci5zZXQoYSxhLDEvdGhpcy5zW2FdKTtsZXQgaT10aGlzLlUsaD10aGlzLnJpZ2h0U2luZ3VsYXJWZWN0b3JzLGw9aC5tbXVsKHIpLHU9aC5yb3dzLGY9aS5yb3dzLGc9Yi56ZXJvcyh1LGYpO2ZvcihsZXQgYT0wO2E8dTthKyspZm9yKGxldCBqPTA7ajxmO2orKyl7bGV0IHc9MDtmb3IobGV0IHk9MDt5PHM7eSsrKXcrPWwuZ2V0KGEseSkqaS5nZXQoaix5KTtnLnNldChhLGosdyl9cmV0dXJuIGcubW11bChlKX1zb2x2ZUZvckRpYWdvbmFsKG4pe3JldHVybiB0aGlzLnNvbHZlKGIuZGlhZyhuKSl9aW52ZXJzZSgpe2xldCBuPXRoaXMuVixlPXRoaXMudGhyZXNob2xkLHQ9bi5yb3dzLHM9bi5jb2x1bW5zLHI9bmV3IGIodCx0aGlzLnMubGVuZ3RoKTtmb3IobGV0IGY9MDtmPHQ7ZisrKWZvcihsZXQgZz0wO2c8cztnKyspTWF0aC5hYnModGhpcy5zW2ddKT5lJiZyLnNldChmLGcsbi5nZXQoZixnKS90aGlzLnNbZ10pO2xldCBpPXRoaXMuVSxoPWkucm93cyxsPWkuY29sdW1ucyx1PW5ldyBiKHQsaCk7Zm9yKGxldCBmPTA7Zjx0O2YrKylmb3IobGV0IGc9MDtnPGg7ZysrKXtsZXQgYT0wO2ZvcihsZXQgaj0wO2o8bDtqKyspYSs9ci5nZXQoZixqKSppLmdldChnLGopO3Uuc2V0KGYsZyxhKX1yZXR1cm4gdX1nZXQgY29uZGl0aW9uKCl7cmV0dXJuIHRoaXMuc1swXS90aGlzLnNbTWF0aC5taW4odGhpcy5tLHRoaXMubiktMV19Z2V0IG5vcm0yKCl7cmV0dXJuIHRoaXMuc1swXX1nZXQgcmFuaygpe2xldCBuPU1hdGgubWF4KHRoaXMubSx0aGlzLm4pKnRoaXMuc1swXSpOdW1iZXIuRVBTSUxPTixlPTAsdD10aGlzLnM7Zm9yKGxldCBzPTAscj10Lmxlbmd0aDtzPHI7cysrKXRbc10+biYmZSsrO3JldHVybiBlfWdldCBkaWFnb25hbCgpe3JldHVybiBBcnJheS5mcm9tKHRoaXMucyl9Z2V0IHRocmVzaG9sZCgpe3JldHVybiBOdW1iZXIuRVBTSUxPTi8yKk1hdGgubWF4KHRoaXMubSx0aGlzLm4pKnRoaXMuc1swXX1nZXQgbGVmdFNpbmd1bGFyVmVjdG9ycygpe3JldHVybiB0aGlzLlV9Z2V0IHJpZ2h0U2luZ3VsYXJWZWN0b3JzKCl7cmV0dXJuIHRoaXMuVn1nZXQgZGlhZ29uYWxNYXRyaXgoKXtyZXR1cm4gYi5kaWFnKHRoaXMucyl9fWZ1bmN0aW9uIE10KG8sbj0hMSl7cmV0dXJuIG89c3QuY2hlY2tNYXRyaXgobyksbj9uZXcgRHQobykuaW52ZXJzZSgpOnFlKG8sYi5leWUoby5yb3dzKSl9ZnVuY3Rpb24gcWUobyxuLGU9ITEpe3JldHVybiBvPXN0LmNoZWNrTWF0cml4KG8pLG49c3QuY2hlY2tNYXRyaXgobiksZT9uZXcgRHQobykuc29sdmUobik6by5pc1NxdWFyZSgpP25ldyBOZShvKS5zb2x2ZShuKTpuZXcgdmUobykuc29sdmUobil9Y29uc3QgX2U9MTIzNCxUZT0oKT0+KHtzZWVkOl9lLGFycmF5U2h1ZmZsZShuKXtjb25zdHthcnI6ZSxzYW1wbGVTaXplOnR9PW47Zm9yKGxldCBzPTA7czx0O3MrKyl7dGhpcy5zZWVkPSgyMTQwMTMqdGhpcy5zZWVkKzI1MzEwMTEpJS0yMTQ3NDgzNjQ4O2xldCByPXRoaXMuc2VlZD4+MTYmMzI3Njc7cj1yJWUubGVuZ3RoO2xldCBpPWVbc107ZVtzXT1lW3JdLGVbcl09aX19LG5leHRJbnQobil7dGhpcy5zZWVkPSgyMTQwMTMqdGhpcy5zZWVkKzI1MzEwMTEpJS0yMTQ3NDgzNjQ4O2xldCBlPXRoaXMuc2VlZD4+MTYmMzI3Njc7cmV0dXJuIGU9ZSVuLGV9fSksSj0obyxuLGUpPT4oblswXS1vWzBdKSooZVsxXS1vWzFdKS0oblsxXS1vWzFdKSooZVswXS1vWzBdKSx6ZT0obyxuLGUsdCxzLHIsaSxoKT0+IShKKG8sbixlKT4wIT1KKHMscixpKT4wfHxKKG4sZSx0KT4wIT1KKHIsaSxoKT4wfHxKKGUsdCxvKT4wIT1KKGksaCxzKT4wfHxKKHQsbyxuKT4wIT1KKGgscyxyKT4wKSxGZT0obyxuLGUsdCxzLHIpPT5KKG8sbixlKT4wPT1KKHQscyxyKT4wLFBlPW89Pntjb25zdCBuPW9bNF0qb1s4XS1vWzVdKm9bN10sZT1vWzNdKm9bOF0tb1s1XSpvWzZdLHQ9b1szXSpvWzddLW9bNF0qb1s2XTtyZXR1cm4gb1swXSpuLW9bMV0qZStvWzJdKnR9LEJ0PShvLG4pPT57Y29uc3QgZT1QZShvKTtpZihNYXRoLmFicyhlKTw9bilyZXR1cm4gbnVsbDtjb25zdCB0PTEvZTtyZXR1cm5bKG9bNF0qb1s4XS1vWzVdKm9bN10pKnQsKG9bMl0qb1s3XS1vWzFdKm9bOF0pKnQsKG9bMV0qb1s1XS1vWzJdKm9bNF0pKnQsKG9bNV0qb1s2XS1vWzNdKm9bOF0pKnQsKG9bMF0qb1s4XS1vWzJdKm9bNl0pKnQsKG9bMl0qb1szXS1vWzBdKm9bNV0pKnQsKG9bM10qb1s3XS1vWzRdKm9bNl0pKnQsKG9bMV0qb1s2XS1vWzBdKm9bN10pKnQsKG9bMF0qb1s0XS1vWzFdKm9bM10pKnRdfSxvdD0obyxuKT0+e2NvbnN0IGU9bls2XSpvWzBdK25bN10qb1sxXStuWzhdLHQ9W107cmV0dXJuIHRbMF09KG5bMF0qb1swXStuWzFdKm9bMV0rblsyXSkvZSx0WzFdPShuWzNdKm9bMF0rbls0XSpvWzFdK25bNV0pL2UsdH0sRGU9KG8sbixlLHQpPT57Y29uc3Qgcz1ydChuLG8pLHI9cnQoZSxvKSxpPXJ0KHQsbyksaD1ydChuLGUpLGw9cnQodCxlKSx1PW10KHMsciksZj1tdChyLGkpLGc9bXQocyxpKSxhPW10KGgsbCk7cmV0dXJuIE1hdGgubWluKE1hdGgubWluKE1hdGgubWluKHUsZiksZyksYSl9LEJlPShvLG4sZSx0KT0+e2NvbnN0IHM9SihvLG4sZSk8PTA7cmV0dXJuIShKKG4sZSx0KTw9MCE9PXN8fEooZSx0LG8pPD0wIT09c3x8Sih0LG8sbik8PTAhPT1zKX0scnQ9KG8sbik9PltvWzBdLW5bMF0sb1sxXS1uWzFdXSxtdD0obyxuKT0+e2NvbnN0IGU9b1swXSpuWzFdLW9bMV0qblswXTtyZXR1cm4gTWF0aC5hYnMoZSkqLjV9LFZ0PShvLG4pPT57Y29uc3R7bm9ybVBvaW50czplLHBhcmFtOnR9PVh0KG8pLHtub3JtUG9pbnRzOnMscGFyYW06cn09WHQobiksaT1zLmxlbmd0aCxoPVtdLGw9W107Zm9yKGxldCB1PTA7dTxpO3UrKyl7Y29uc3QgZj1bZVt1XVswXSxlW3VdWzFdLDEsMCwwLDAsLShlW3VdWzBdKnNbdV1bMF0pLC0oZVt1XVsxXSpzW3VdWzBdKV0sZz1bMCwwLDAsZVt1XVswXSxlW3VdWzFdLDEsLShlW3VdWzBdKnNbdV1bMV0pLC0oZVt1XVsxXSpzW3VdWzFdKV07aC5wdXNoKGYpLGgucHVzaChnKSxsLnB1c2goW3NbdV1bMF1dKSxsLnB1c2goW3NbdV1bMV1dKX10cnl7Y29uc3QgdT1uZXcgYihoKSxmPW5ldyBiKGwpLGc9dS50cmFuc3Bvc2UoKSxhPWcubW11bCh1KSxqPWcubW11bChmKSx5PU10KGEpLm1tdWwoaikudG8xREFycmF5KCk7cmV0dXJuIFZlKHksdCxyKX1jYXRjaHtyZXR1cm4gbnVsbH19LFh0PW89PntsZXQgbj0wLGU9MDtmb3IobGV0IGw9MDtsPG8ubGVuZ3RoO2wrKyluKz1vW2xdWzBdLGUrPW9bbF1bMV07bGV0IHQ9bi9vLmxlbmd0aCxzPWUvby5sZW5ndGgscj0wO2ZvcihsZXQgbD0wO2w8by5sZW5ndGg7bCsrKXtjb25zdCB1PW9bbF1bMF0tdCxmPW9bbF1bMV0tcztyKz1NYXRoLnNxcnQodSp1K2YqZil9bGV0IGk9TWF0aC5zcXJ0KDIpKm8ubGVuZ3RoL3I7Y29uc3QgaD1bXTtmb3IobGV0IGw9MDtsPG8ubGVuZ3RoO2wrKyloLnB1c2goWyhvW2xdWzBdLXQpKmksKG9bbF1bMV0tcykqaV0pO3JldHVybntub3JtUG9pbnRzOmgscGFyYW06e21lYW5YOnQsbWVhblk6cyxzOml9fX0sVmU9KG8sbixlKT0+e2NvbnN0IHQ9ZS5zKmUubWVhblgscz1lLnMqZS5tZWFuWSxyPVtvWzBdK3Qqb1s2XSxvWzFdK3Qqb1s3XSwob1swXSt0Km9bNl0pKi1uLm1lYW5YKyhvWzFdK3Qqb1s3XSkqLW4ubWVhblkrKG9bMl0rdCkvbi5zLG9bM10rcypvWzZdLG9bNF0rcypvWzddLChvWzNdK3Mqb1s2XSkqLW4ubWVhblgrKG9bNF0rcypvWzddKSotbi5tZWFuWSsob1s1XStzKS9uLnMsZS5zKm9bNl0sZS5zKm9bN10sZS5zKm9bNl0qLW4ubWVhblgrZS5zKm9bN10qLW4ubWVhblkrZS5zL24uc107Zm9yKGxldCBpPTA7aTw5O2krKylyW2ldPXJbaV0vcls4XTtyZXR1cm4gcn0sWGU9LjAxLFVlPTEwLCRlPTIwLExlPTEwLFV0PW89Pntjb25zdHtzcmNQb2ludHM6bixkc3RQb2ludHM6ZSxrZXlmcmFtZTp0LHF1aWNrTW9kZTpzfT1vLHI9W1swLDBdLFt0LndpZHRoLDBdLFt0LndpZHRoLHQuaGVpZ2h0XSxbMCx0LmhlaWdodF1dLGk9NDtpZihuLmxlbmd0aDxpKXJldHVybiBudWxsO2NvbnN0IGg9WGUsbD0xLyhoKmgpLHU9TWF0aC5taW4oVWUsbi5sZW5ndGgpLGY9VGUoKSxnPVtdO2ZvcihsZXQgRT0wO0U8bi5sZW5ndGg7RSsrKWdbRV09RTtmLmFycmF5U2h1ZmZsZSh7YXJyOmcsc2FtcGxlU2l6ZTpnLmxlbmd0aH0pO2NvbnN0IGE9cz9MZTokZSxqPWEqMjtsZXQgdz0wO2NvbnN0IHk9W107Zm9yKDt3PGomJnkubGVuZ3RoPGE7KXtpZih3Kz0xLGYuYXJyYXlTaHVmZmxlKHthcnI6ZyxzYW1wbGVTaXplOml9KSwhemUobltnWzBdXSxuW2dbMV1dLG5bZ1syXV0sbltnWzNdXSxlW2dbMF1dLGVbZ1sxXV0sZVtnWzJdXSxlW2dbM11dKSljb250aW51ZTtjb25zdCBFPVZ0KFtuW2dbMF1dLG5bZ1sxXV0sbltnWzJdXSxuW2dbM11dXSxbZVtnWzBdXSxlW2dbMV1dLGVbZ1syXV0sZVtnWzNdXV0pO0UhPT1udWxsJiZIZSh7SDpFLHRlc3RQb2ludHM6cn0pJiZ5LnB1c2goRSl9aWYoeS5sZW5ndGg9PT0wKXJldHVybiBudWxsO2NvbnN0IG09W107Zm9yKGxldCBFPTA7RTx5Lmxlbmd0aDtFKyspbS5wdXNoKHtIOnlbRV0sY29zdDowfSk7bGV0IE09dTtmb3IobGV0IEU9MDtFPG4ubGVuZ3RoJiZtLmxlbmd0aD4yO0UrPU0pe009TWF0aC5taW4odSxuLmxlbmd0aC1FKTtsZXQgaz1FK007Zm9yKGxldCBSPTA7UjxtLmxlbmd0aDtSKyspZm9yKGxldCBxPUU7cTxrO3ErKyl7Y29uc3QgST1DZSh7SDptW1JdLkgsc3JjUG9pbnQ6bltxXSxkc3RQb2ludDplW3FdLG9uZU92ZXJTY2FsZTI6bH0pO21bUl0uY29zdCs9SX1tLnNvcnQoKFIscSk9PlIuY29zdC1xLmNvc3QpLG0uc3BsaWNlKC1NYXRoLmZsb29yKChtLmxlbmd0aCsxKS8yKSl9bGV0IFQ9bnVsbDtmb3IobGV0IEU9MDtFPG0ubGVuZ3RoO0UrKyl7Y29uc3Qgaz1ZZSh7aW5IOm1bRV0uSH0pO2lmKE9lKHtIOmssdGVzdFBvaW50czpyLGtleWZyYW1lOnR9KSl7VD1rO2JyZWFrfX1yZXR1cm4gVH0sT2U9KHtIOm8sdGVzdFBvaW50czpuLGtleWZyYW1lOmV9KT0+e2NvbnN0IHQ9QnQobywxZS01KTtpZih0PT09bnVsbClyZXR1cm4hMTtjb25zdCBzPVtdO2ZvcihsZXQgaT0wO2k8bi5sZW5ndGg7aSsrKXMucHVzaChvdChuW2ldLHQpKTtyZXR1cm4hKERlKHNbMF0sc1sxXSxzWzJdLHNbM10pPGUud2lkdGgqZS5oZWlnaHQqMWUtNHx8IUJlKHNbMF0sc1sxXSxzWzJdLHNbM10pKX0sWWU9KHtpbkg6b30pPT57Y29uc3Qgbj0xL29bOF0sZT1bXTtmb3IobGV0IHQ9MDt0PDg7dCsrKWVbdF09b1t0XSpuO3JldHVybiBlWzhdPTEsZX0sQ2U9KHtIOm8sc3JjUG9pbnQ6bixkc3RQb2ludDplLG9uZU92ZXJTY2FsZTI6dH0pPT57Y29uc3Qgcz1vdChuLG8pLHI9W3NbMF0tZVswXSxzWzFdLWVbMV1dO3JldHVybiBNYXRoLmxvZygxKyhyWzBdKnJbMF0rclsxXSpyWzFdKSp0KX0sSGU9KHtIOm8sdGVzdFBvaW50czpufSk9Pntjb25zdCBlPVtdO2ZvcihsZXQgdD0wO3Q8bi5sZW5ndGg7dCsrKWVbdF09b3Qoblt0XSxvKTtmb3IobGV0IHQ9MDt0PG4ubGVuZ3RoO3QrKyl7Y29uc3Qgcz10LHI9KHQrMSklbi5sZW5ndGgsaT0odCsyKSVuLmxlbmd0aDtpZighRmUobltzXSxuW3JdLG5baV0sZVtzXSxlW3JdLGVbaV0pKXJldHVybiExfXJldHVybiEwfSwkdD0zLEx0PTYsS2U9OCxPdD0uNyxKZT0oe2tleWZyYW1lOm8scXVlcnlwb2ludHM6bixxdWVyeXdpZHRoOmUscXVlcnloZWlnaHQ6dCxkZWJ1Z01vZGU6c30pPT57bGV0IHI9e307Y29uc3QgaT1bXTtmb3IobGV0IG09MDttPG4ubGVuZ3RoO20rKyl7Y29uc3QgTT1uW21dLFQ9TS5tYXhpbWE/by5tYXhpbWFQb2ludHM6by5taW5pbWFQb2ludHM7aWYoVC5sZW5ndGg9PT0wKWNvbnRpbnVlO2NvbnN0IEU9TS5tYXhpbWE/by5tYXhpbWFQb2ludHNDbHVzdGVyLnJvb3ROb2RlOm8ubWluaW1hUG9pbnRzQ2x1c3Rlci5yb290Tm9kZSxrPVtdLFI9bmV3IFd0KFtdLChCLGMpPT5CLmQtYy5kKTtFdCh7bm9kZTpFLGtleXBvaW50czpULHF1ZXJ5cG9pbnQ6TSxxdWV1ZTpSLGtleXBvaW50SW5kZXhlczprLG51bVBvcDowfSk7bGV0IHE9LTEsST1OdW1iZXIuTUFYX1NBRkVfSU5URUdFUix6PU51bWJlci5NQVhfU0FGRV9JTlRFR0VSO2ZvcihsZXQgQj0wO0I8ay5sZW5ndGg7QisrKXtjb25zdCBjPVRba1tCXV0scD15dCh7djE6Yy5kZXNjcmlwdG9ycyx2MjpNLmRlc2NyaXB0b3JzfSk7cDxJPyh6PUksST1wLHE9a1tCXSk6cDx6JiYoej1wKX1xIT09LTEmJih6PT09TnVtYmVyLk1BWF9TQUZFX0lOVEVHRVJ8fDEqSS96PE90KSYmaS5wdXNoKHtxdWVyeXBvaW50Ok0sa2V5cG9pbnQ6VFtxXX0pfWlmKHMmJihyLm1hdGNoZXM9aSksaS5sZW5ndGg8THQpcmV0dXJue2RlYnVnRXh0cmE6cn07Y29uc3QgaD12dCh7a2V5d2lkdGg6by53aWR0aCxrZXloZWlnaHQ6by5oZWlnaHQscXVlcnl3aWR0aDplLHF1ZXJ5aGVpZ2h0OnQsbWF0Y2hlczppfSk7cyYmKHIuaG91Z2hNYXRjaGVzPWgpO2NvbnN0IGw9VXQoe3NyY1BvaW50czpoLm1hcChtPT5bbS5rZXlwb2ludC54LG0ua2V5cG9pbnQueV0pLGRzdFBvaW50czpoLm1hcChtPT5bbS5xdWVyeXBvaW50LngsbS5xdWVyeXBvaW50LnldKSxrZXlmcmFtZTpvfSk7aWYobD09PW51bGwpcmV0dXJue2RlYnVnRXh0cmE6cn07Y29uc3QgdT1ZdCh7SDpsLG1hdGNoZXM6aCx0aHJlc2hvbGQ6JHR9KTtpZihzJiYoci5pbmxpZXJNYXRjaGVzPXUpLHUubGVuZ3RoPEx0KXJldHVybntkZWJ1Z0V4dHJhOnJ9O2NvbnN0IGY9QnQobCwxZS01KSxnPTEwKjEwLGE9W107Zm9yKGxldCBtPTA7bTxuLmxlbmd0aDttKyspe2NvbnN0IE09blttXSxUPW90KFtNLngsTS55XSxmKTtsZXQgRT0tMSxrPU51bWJlci5NQVhfU0FGRV9JTlRFR0VSLFI9TnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7Y29uc3QgcT1NLm1heGltYT9vLm1heGltYVBvaW50czpvLm1pbmltYVBvaW50cztmb3IobGV0IEk9MDtJPHEubGVuZ3RoO0krKyl7Y29uc3Qgej1xW0ldO2lmKCh6LngtVFswXSkqKHoueC1UWzBdKSsoei55LVRbMV0pKih6LnktVFsxXSk+Zyljb250aW51ZTtjb25zdCBjPXl0KHt2MTp6LmRlc2NyaXB0b3JzLHYyOk0uZGVzY3JpcHRvcnN9KTtjPGs/KFI9ayxrPWMsRT1JKTpjPFImJihSPWMpfUUhPT0tMSYmKFI9PT1OdW1iZXIuTUFYX1NBRkVfSU5URUdFUnx8MSprL1I8T3QpJiZhLnB1c2goe3F1ZXJ5cG9pbnQ6TSxrZXlwb2ludDpxW0VdfSl9cyYmKHIubWF0Y2hlczI9YSk7Y29uc3Qgaj12dCh7a2V5d2lkdGg6by53aWR0aCxrZXloZWlnaHQ6by5oZWlnaHQscXVlcnl3aWR0aDplLHF1ZXJ5aGVpZ2h0OnQsbWF0Y2hlczphfSk7cyYmKHIuaG91Z2hNYXRjaGVzMj1qKTtjb25zdCB3PVV0KHtzcmNQb2ludHM6ai5tYXAobT0+W20ua2V5cG9pbnQueCxtLmtleXBvaW50LnldKSxkc3RQb2ludHM6ai5tYXAobT0+W20ucXVlcnlwb2ludC54LG0ucXVlcnlwb2ludC55XSksa2V5ZnJhbWU6b30pO2lmKHc9PT1udWxsKXJldHVybntkZWJ1Z0V4dHJhOnJ9O2NvbnN0IHk9WXQoe0g6dyxtYXRjaGVzOmosdGhyZXNob2xkOiR0fSk7cmV0dXJuIHMmJihyLmlubGllck1hdGNoZXMyPXkpLHtIOncsbWF0Y2hlczp5LGRlYnVnRXh0cmE6cn19LEV0PSh7bm9kZTpvLGtleXBvaW50czpuLHF1ZXJ5cG9pbnQ6ZSxxdWV1ZTp0LGtleXBvaW50SW5kZXhlczpzLG51bVBvcDpyfSk9PntpZihvLmxlYWYpe2ZvcihsZXQgbD0wO2w8by5wb2ludEluZGV4ZXMubGVuZ3RoO2wrKylzLnB1c2goby5wb2ludEluZGV4ZXNbbF0pO3JldHVybn1jb25zdCBpPVtdO2ZvcihsZXQgbD0wO2w8by5jaGlsZHJlbi5sZW5ndGg7bCsrKXtjb25zdCBmPW8uY2hpbGRyZW5bbF0uY2VudGVyUG9pbnRJbmRleCxnPXl0KHt2MTpuW2ZdLmRlc2NyaXB0b3JzLHYyOmUuZGVzY3JpcHRvcnN9KTtpLnB1c2goZyl9bGV0IGg9TnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7Zm9yKGxldCBsPTA7bDxvLmNoaWxkcmVuLmxlbmd0aDtsKyspaD1NYXRoLm1pbihoLGlbbF0pO2ZvcihsZXQgbD0wO2w8by5jaGlsZHJlbi5sZW5ndGg7bCsrKWlbbF0hPT1oJiZ0LnB1c2goe25vZGU6by5jaGlsZHJlbltsXSxkOmlbbF19KTtmb3IobGV0IGw9MDtsPG8uY2hpbGRyZW4ubGVuZ3RoO2wrKylpW2xdPT09aCYmRXQoe25vZGU6by5jaGlsZHJlbltsXSxrZXlwb2ludHM6bixxdWVyeXBvaW50OmUscXVldWU6dCxrZXlwb2ludEluZGV4ZXM6cyxudW1Qb3A6cn0pO2lmKHI8S2UmJnQubGVuZ3RoPjApe2NvbnN0e25vZGU6bCxkOnV9PXQucG9wKCk7cis9MSxFdCh7bm9kZTpsLGtleXBvaW50czpuLHF1ZXJ5cG9pbnQ6ZSxxdWV1ZTp0LGtleXBvaW50SW5kZXhlczpzLG51bVBvcDpyfSl9fSxZdD1vPT57Y29uc3R7SDpuLG1hdGNoZXM6ZSx0aHJlc2hvbGQ6dH09byxzPXQqdCxyPVtdO2ZvcihsZXQgaT0wO2k8ZS5sZW5ndGg7aSsrKXtjb25zdCBoPWVbaV0ucXVlcnlwb2ludCxsPWVbaV0ua2V5cG9pbnQsdT1vdChbbC54LGwueV0sbik7KHVbMF0taC54KSoodVswXS1oLngpKyh1WzFdLWgueSkqKHVbMV0taC55KTw9cyYmci5wdXNoKGVbaV0pfXJldHVybiByfTtjbGFzcyBHZXtjb25zdHJ1Y3RvcihuLGUsdD0hMSl7dGhpcy5xdWVyeVdpZHRoPW4sdGhpcy5xdWVyeUhlaWdodD1lLHRoaXMuZGVidWdNb2RlPXR9bWF0Y2hEZXRlY3Rpb24obixlKXtsZXQgdD17ZnJhbWVzOltdfSxzPW51bGw7Zm9yKGxldCBsPTA7bDxuLmxlbmd0aDtsKyspe2NvbnN0e0g6dSxtYXRjaGVzOmYsZGVidWdFeHRyYTpnfT1KZSh7a2V5ZnJhbWU6bltsXSxxdWVyeXBvaW50czplLHF1ZXJ5d2lkdGg6dGhpcy5xdWVyeVdpZHRoLHF1ZXJ5aGVpZ2h0OnRoaXMucXVlcnlIZWlnaHQsZGVidWdNb2RlOnRoaXMuZGVidWdNb2RlfSk7dC5mcmFtZXMucHVzaChnKSx1JiYocz09PW51bGx8fHMubWF0Y2hlcy5sZW5ndGg8Zi5sZW5ndGgpJiYocz17a2V5ZnJhbWVJbmRleDpsLEg6dSxtYXRjaGVzOmZ9KX1pZihzPT09bnVsbClyZXR1cm57a2V5ZnJhbWVJbmRleDotMSxkZWJ1Z0V4dHJhOnR9O2NvbnN0IHI9W10saT1bXSxoPW5bcy5rZXlmcmFtZUluZGV4XTtmb3IobGV0IGw9MDtsPHMubWF0Y2hlcy5sZW5ndGg7bCsrKXtjb25zdCB1PXMubWF0Y2hlc1tsXS5xdWVyeXBvaW50LGY9cy5tYXRjaGVzW2xdLmtleXBvaW50O3IucHVzaCh7eDp1LngseTp1Lnl9KSxpLnB1c2goe3g6KGYueCsuNSkvaC5zY2FsZSx5OihmLnkrLjUpL2guc2NhbGUsejowfSl9cmV0dXJue3NjcmVlbkNvb3JkczpyLHdvcmxkQ29vcmRzOmksa2V5ZnJhbWVJbmRleDpzLmtleWZyYW1lSW5kZXgsZGVidWdFeHRyYTp0fX19Y29uc3QgV2U9KHtzY3JlZW5Db29yZHM6byx3b3JsZENvb3JkczpuLHByb2plY3Rpb25UcmFuc2Zvcm06ZX0pPT57Y29uc3QgdD1WdChuLm1hcChtPT5bbS54LG0ueV0pLG8ubWFwKG09PlttLngsbS55XSkpLHM9bmV3IGIoW1t0WzBdLHRbMV0sdFsyXV0sW3RbM10sdFs0XSx0WzVdXSxbdFs2XSx0WzddLHRbOF1dXSkscj1uZXcgYihlKSxsPU10KHIpLm1tdWwocykudG8xREFycmF5KCksdT1NYXRoLnNxcnQobFswXSpsWzBdK2xbM10qbFszXStsWzZdKmxbNl0pLGY9TWF0aC5zcXJ0KGxbMV0qbFsxXStsWzRdKmxbNF0rbFs3XSpsWzddKSxnPSh1K2YpLzIsYT1bXTthWzBdPWxbMF0vdSxhWzNdPWxbM10vdSxhWzZdPWxbNl0vdSxhWzFdPWxbMV0vZixhWzRdPWxbNF0vZixhWzddPWxbN10vZixhWzJdPWFbM10qYVs3XS1hWzZdKmFbNF0sYVs1XT1hWzZdKmFbMV0tYVswXSphWzddLGFbOF09YVswXSphWzRdLWFbMV0qYVszXTtjb25zdCBqPU1hdGguc3FydChhWzJdKmFbMl0rYVs1XSphWzVdK2FbOF0qYVs4XSk7YVsyXS89aixhWzVdLz1qLGFbOF0vPWo7Y29uc3Qgdz1bXTtyZXR1cm4gd1swXT1sWzJdL2csd1sxXT1sWzVdL2csd1syXT1sWzhdL2csW1thWzBdLGFbMV0sYVsyXSx3WzBdXSxbYVszXSxhWzRdLGFbNV0sd1sxXV0sW2FbNl0sYVs3XSxhWzhdLHdbMl1dXX0sUWU9KG8sbik9Pltbb1swXVswXSpuWzBdWzBdK29bMF1bMl0qblsyXVswXSxvWzBdWzBdKm5bMF1bMV0rb1swXVsyXSpuWzJdWzFdLG9bMF1bMF0qblswXVsyXStvWzBdWzJdKm5bMl1bMl0sb1swXVswXSpuWzBdWzNdK29bMF1bMl0qblsyXVszXV0sW29bMV1bMV0qblsxXVswXStvWzFdWzJdKm5bMl1bMF0sb1sxXVsxXSpuWzFdWzFdK29bMV1bMl0qblsyXVsxXSxvWzFdWzFdKm5bMV1bMl0rb1sxXVsyXSpuWzJdWzJdLG9bMV1bMV0qblsxXVszXStvWzFdWzJdKm5bMl1bM11dLFtuWzJdWzBdLG5bMl1bMV0sblsyXVsyXSxuWzJdWzNdXV0sQ3Q9KG8sbixlLHQpPT57Y29uc3Qgcz1vWzBdWzBdKm4rb1swXVsxXSplK29bMF1bM10scj1vWzFdWzBdKm4rb1sxXVsxXSplK29bMV1bM10saT1vWzJdWzBdKm4rb1syXVsxXSplK29bMl1bM107cmV0dXJue3g6cyx5OnIsejppfX0sWmU9KG8sbixlLHQpPT57Y29uc3R7eDpzLHk6cix6Oml9PUN0KG8sbixlKTtyZXR1cm57eDpzL2kseTpyL2l9fSx4ZT01LEFlPTQsSHQ9MTAsdG49LjEsZW49Ljk5O2xldCBIPVtbXSxbXSxbXV0sQT1bW10sW11dLE89W1tdLFtdLFtdXTtjb25zdCBubj0oe2luaXRpYWxNb2RlbFZpZXdUcmFuc2Zvcm06byxwcm9qZWN0aW9uVHJhbnNmb3JtOm4sd29ybGRDb29yZHM6ZSxzY3JlZW5Db29yZHM6dH0pPT57bGV0IHM9MCxyPTA7Zm9yKGxldCBnPTA7ZzxlLmxlbmd0aDtnKyspcys9ZVtnXS54LHIrPWVbZ10ueTtzLz1lLmxlbmd0aCxyLz1lLmxlbmd0aDtjb25zdCBpPVtdO2ZvcihsZXQgZz0wO2c8ZS5sZW5ndGg7ZysrKWkucHVzaCh7eDplW2ddLngtcyx5OmVbZ10ueS1yLHo6ZVtnXS56fSk7Y29uc3QgaD1bW10sW10sW11dO2ZvcihsZXQgZz0wO2c8MztnKyspZm9yKGxldCBhPTA7YTwzO2ErKyloW2ddW2FdPW9bZ11bYV07aFswXVszXT1vWzBdWzBdKnMrb1swXVsxXSpyK29bMF1bM10saFsxXVszXT1vWzFdWzBdKnMrb1sxXVsxXSpyK29bMV1bM10saFsyXVszXT1vWzJdWzBdKnMrb1syXVsxXSpyK29bMl1bM107Y29uc3QgbD1bMSwuOCwuNiwuNCwwXTtsZXQgdT1oLGY9bnVsbDtmb3IobGV0IGc9MDtnPGwubGVuZ3RoO2crKyl7Y29uc3QgYT1zbih7aW5pdGlhbE1vZGVsVmlld1RyYW5zZm9ybTp1LHByb2plY3Rpb25UcmFuc2Zvcm06bix3b3JsZENvb3JkczppLHNjcmVlbkNvb3Jkczp0LGlubGllclByb2I6bFtnXX0pO2lmKHU9YS5tb2RlbFZpZXdUcmFuc2Zvcm0sYS5lcnI8eGUpe2Y9dTticmVha319cmV0dXJuIGY9PT1udWxsP251bGw6KGZbMF1bM109ZlswXVszXS1mWzBdWzBdKnMtZlswXVsxXSpyLGZbMV1bM109ZlsxXVszXS1mWzFdWzBdKnMtZlsxXVsxXSpyLGZbMl1bM109ZlsyXVszXS1mWzJdWzBdKnMtZlsyXVsxXSpyLGYpfSxzbj0oe2luaXRpYWxNb2RlbFZpZXdUcmFuc2Zvcm06byxwcm9qZWN0aW9uVHJhbnNmb3JtOm4sd29ybGRDb29yZHM6ZSxzY3JlZW5Db29yZHM6dCxpbmxpZXJQcm9iOnN9KT0+e2NvbnN0IHI9czwxO2xldCBpPW8saD0wLGw9MCx1PW5ldyBBcnJheShlLmxlbmd0aCksZj1uZXcgQXJyYXkoZS5sZW5ndGgpLGc9bmV3IEFycmF5KGUubGVuZ3RoKSxhPW5ldyBBcnJheShlLmxlbmd0aCk7Zm9yKGxldCBqPTA7ajw9SHQ7aisrKXtjb25zdCB3PVFlKG4saSk7Zm9yKGxldCBFPTA7RTxlLmxlbmd0aDtFKyspe2NvbnN0IGs9WmUodyxlW0VdLngsZVtFXS55LGVbRV0ueiksUj10W0VdLngtay54LHE9dFtFXS55LWsueTtnW0VdPVIsYVtFXT1xLHVbRV09UipSK3EqcX1sZXQgeTtpZihsPTAscil7Y29uc3QgRT1NYXRoLm1heCgzLE1hdGguZmxvb3IoZS5sZW5ndGgqcyktMSk7Zm9yKGxldCBrPTA7azxlLmxlbmd0aDtrKyspZltrXT11W2tdO2Yuc29ydCgoayxSKT0+ay1SKSx5PU1hdGgubWF4KGZbRV0qQWUsMTYpO2ZvcihsZXQgaz0wO2s8ZS5sZW5ndGg7aysrKWZba10+eT9sKz15LzY6bCs9eS82KigxLSgxLWZba10veSkqKDEtZltrXS95KSooMS1mW2tdL3kpKX1lbHNlIGZvcihsZXQgRT0wO0U8ZS5sZW5ndGg7RSsrKWwrPXVbRV07aWYobC89ZS5sZW5ndGgsbDx0bnx8aj4wJiZsL2g+ZW58fGo9PT1IdClicmVhaztoPWw7Y29uc3QgbT1bXSxNPVtdO2ZvcihsZXQgRT0wO0U8ZS5sZW5ndGg7RSsrKXtpZihyJiZ1W0VdPnkpY29udGludWU7Y29uc3Qgaz1sbih7bW9kZWxWaWV3UHJvamVjdGlvblRyYW5zZm9ybTp3LG1vZGVsVmlld1RyYW5zZm9ybTppLHByb2plY3Rpb25UcmFuc2Zvcm06bix3b3JsZENvb3JkOmVbRV19KTtpZihyKXtjb25zdCBSPSgxLXVbRV0veSkqKDEtdVtFXS95KTtmb3IobGV0IHE9MDtxPDI7cSsrKWZvcihsZXQgST0wO0k8NjtJKyspa1txXVtJXSo9UjttLnB1c2goW2dbRV0qUl0pLG0ucHVzaChbYVtFXSpSXSl9ZWxzZSBtLnB1c2goW2dbRV1dKSxtLnB1c2goW2FbRV1dKTtmb3IobGV0IFI9MDtSPGsubGVuZ3RoO1IrKylNLnB1c2goa1tSXSl9Y29uc3QgVD1ybih7ZFU6bSxKX1VfUzpNfSk7aWYoVD09PW51bGwpYnJlYWs7aT1vbih7bW9kZWxWaWV3VHJhbnNmb3JtOmksZFM6VH0pfXJldHVybnttb2RlbFZpZXdUcmFuc2Zvcm06aSxlcnI6bH19LG9uPSh7bW9kZWxWaWV3VHJhbnNmb3JtOm8sZFM6bn0pPT57bGV0IGU9blswXSpuWzBdK25bMV0qblsxXStuWzJdKm5bMl0sdCxzLHI7ZTwxZS02Pyh0PTEscz0wLHI9MCxlPTApOihlPU1hdGguc3FydChlKSx0PW5bMF0vZSxzPW5bMV0vZSxyPW5bMl0vZSk7Y29uc3QgaT1NYXRoLmNvcyhlKSxoPU1hdGguc2luKGUpLGw9MS1pO0hbMF1bMF09dCp0KmwraSxIWzBdWzFdPXQqcypsLXIqaCxIWzBdWzJdPXQqcipsK3MqaCxIWzBdWzNdPW5bM10sSFsxXVswXT1zKnQqbCtyKmgsSFsxXVsxXT1zKnMqbCtpLEhbMV1bMl09cypyKmwtdCpoLEhbMV1bM109bls0XSxIWzJdWzBdPXIqdCpsLXMqaCxIWzJdWzFdPXIqcypsK3QqaCxIWzJdWzJdPXIqcipsK2ksSFsyXVszXT1uWzVdO2NvbnN0IHU9W1tdLFtdLFtdXTtmb3IobGV0IGY9MDtmPDM7ZisrKXtmb3IobGV0IGc9MDtnPDQ7ZysrKXVbZl1bZ109b1tmXVswXSpIWzBdW2ddK29bZl1bMV0qSFsxXVtnXStvW2ZdWzJdKkhbMl1bZ107dVtmXVszXSs9b1tmXVszXX1yZXR1cm4gdX0scm49KHtkVTpvLEpfVV9TOm59KT0+e2NvbnN0IGU9bmV3IGIobiksdD1uZXcgYihvKSxzPWUudHJhbnNwb3NlKCkscj1zLm1tdWwoZSksaT1zLm1tdWwodCk7bGV0IGg7dHJ5e2g9TXQocil9Y2F0Y2h7cmV0dXJuIG51bGx9cmV0dXJuIGgubW11bChpKS50bzFEQXJyYXkoKX0sbG49KHttb2RlbFZpZXdQcm9qZWN0aW9uVHJhbnNmb3JtOm8sbW9kZWxWaWV3VHJhbnNmb3JtOm4scHJvamVjdGlvblRyYW5zZm9ybTplLHdvcmxkQ29vcmQ6dH0pPT57Y29uc3Qgcz1uLHt4OnIseTppLHo6aH09dCxsPUN0KG8scixpKSx1PWwueipsLno7QVswXVswXT1lWzBdWzBdKmwuei91LEFbMF1bMV09ZVswXVsxXSpsLnovdSxBWzBdWzJdPShlWzBdWzJdKmwuei1lWzJdWzJdKmwueCkvdSxBWzFdWzBdPWVbMV1bMF0qbC56L3UsQVsxXVsxXT1lWzFdWzFdKmwuei91LEFbMV1bMl09KGVbMV1bMl0qbC56LWVbMl1bMl0qbC55KS91LE9bMF1bMF09c1swXVsyXSppLE9bMF1bMV09LXNbMF1bMl0qcixPWzBdWzJdPXNbMF1bMV0qci1zWzBdWzBdKmksT1swXVszXT1zWzBdWzBdLE9bMF1bNF09c1swXVsxXSxPWzBdWzVdPXNbMF1bMl0sT1sxXVswXT1zWzFdWzJdKmksT1sxXVsxXT0tc1sxXVsyXSpyLE9bMV1bMl09c1sxXVsxXSpyLXNbMV1bMF0qaSxPWzFdWzNdPXNbMV1bMF0sT1sxXVs0XT1zWzFdWzFdLE9bMV1bNV09c1sxXVsyXSxPWzJdWzBdPXNbMl1bMl0qaSxPWzJdWzFdPS1zWzJdWzJdKnIsT1syXVsyXT1zWzJdWzFdKnItc1syXVswXSppLE9bMl1bM109c1syXVswXSxPWzJdWzRdPXNbMl1bMV0sT1syXVs1XT1zWzJdWzJdO2NvbnN0IGY9W1tdLFtdXTtmb3IobGV0IGc9MDtnPDI7ZysrKWZvcihsZXQgYT0wO2E8NjthKyspe2ZbZ11bYV09MDtmb3IobGV0IGo9MDtqPDM7aisrKWZbZ11bYV0rPUFbZ11bal0qT1tqXVthXX1yZXR1cm4gZn07Y2xhc3MgaG57Y29uc3RydWN0b3Iobil7dGhpcy5wcm9qZWN0aW9uVHJhbnNmb3JtPW59ZXN0aW1hdGUoe3NjcmVlbkNvb3JkczpuLHdvcmxkQ29vcmRzOmV9KXtyZXR1cm4gV2Uoe3NjcmVlbkNvb3JkczpuLHdvcmxkQ29vcmRzOmUscHJvamVjdGlvblRyYW5zZm9ybTp0aGlzLnByb2plY3Rpb25UcmFuc2Zvcm19KX1yZWZpbmVFc3RpbWF0ZSh7aW5pdGlhbE1vZGVsVmlld1RyYW5zZm9ybTpuLHdvcmxkQ29vcmRzOmUsc2NyZWVuQ29vcmRzOnR9KXtyZXR1cm4gbm4oe2luaXRpYWxNb2RlbFZpZXdUcmFuc2Zvcm06bix3b3JsZENvb3JkczplLHNjcmVlbkNvb3Jkczp0LHByb2plY3Rpb25UcmFuc2Zvcm06dGhpcy5wcm9qZWN0aW9uVHJhbnNmb3JtfSl9fWxldCBLdD1udWxsLEp0PSExLEd0PW51bGwsU3Q9bnVsbDtvbm1lc3NhZ2U9bz0+e2NvbnN0e2RhdGE6bn09bztzd2l0Y2gobi50eXBlKXtjYXNlInNldHVwIjpuLnByb2plY3Rpb25UcmFuc2Zvcm0sS3Q9bi5tYXRjaGluZ0RhdGFMaXN0LEp0PW4uZGVidWdNb2RlLEd0PW5ldyBHZShuLmlucHV0V2lkdGgsbi5pbnB1dEhlaWdodCxKdCksU3Q9bmV3IGhuKG4ucHJvamVjdGlvblRyYW5zZm9ybSk7YnJlYWs7Y2FzZSJtYXRjaCI6Y29uc3QgZT1uLnRhcmdldEluZGV4ZXM7bGV0IHQ9LTEscz1udWxsLHI9bnVsbDtmb3IobGV0IGY9MDtmPGUubGVuZ3RoO2YrKyl7Y29uc3QgZz1lW2ZdLHtrZXlmcmFtZUluZGV4OmEsc2NyZWVuQ29vcmRzOmosd29ybGRDb29yZHM6dyxkZWJ1Z0V4dHJhOnl9PUd0Lm1hdGNoRGV0ZWN0aW9uKEt0W2ddLG4uZmVhdHVyZVBvaW50cyk7aWYocj15LGEhPT0tMSl7Y29uc3QgbT1TdC5lc3RpbWF0ZSh7c2NyZWVuQ29vcmRzOmosd29ybGRDb29yZHM6d30pO20mJih0PWcscz1tKTticmVha319cG9zdE1lc3NhZ2Uoe3R5cGU6Im1hdGNoRG9uZSIsdGFyZ2V0SW5kZXg6dCxtb2RlbFZpZXdUcmFuc2Zvcm06cyxkZWJ1Z0V4dHJhOnJ9KTticmVhaztjYXNlInRyYWNrVXBkYXRlIjpjb25zdHttb2RlbFZpZXdUcmFuc2Zvcm06aSx3b3JsZENvb3JkczpoLHNjcmVlbkNvb3JkczpsfT1uLHU9U3QucmVmaW5lRXN0aW1hdGUoe2luaXRpYWxNb2RlbFZpZXdUcmFuc2Zvcm06aSx3b3JsZENvb3JkczpoLHNjcmVlbkNvb3JkczpsfSk7cG9zdE1lc3NhZ2Uoe3R5cGU6InRyYWNrVXBkYXRlRG9uZSIsbW9kZWxWaWV3VHJhbnNmb3JtOnV9KTticmVhaztjYXNlImRpc3Bvc2UiOmNsb3NlKCk7YnJlYWs7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgbWVzc2FnZSB0eXBlICcke24udHlwZX0nYCl9fX0pKCk7Cg==",TA=typeof window<"u"&&window.Blob&&new Blob([atob(SA)],{type:"text/javascript;charset=utf-8"});function Wse(n){let e;try{if(e=TA&&(window.URL||window.webkitURL).createObjectURL(TA),!e)throw"";const t=new Worker(e,{name:n==null?void 0:n.name});return t.addEventListener("error",()=>{(window.URL||window.webkitURL).revokeObjectURL(e)}),t}catch{return new Worker("data:application/javascript;base64,"+SA,{name:n==null?void 0:n.name})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}const zse=(n,e)=>[[n[0][0]*e[0][0]+n[0][2]*e[2][0],n[0][0]*e[0][1]+n[0][2]*e[2][1],n[0][0]*e[0][2]+n[0][2]*e[2][2],n[0][0]*e[0][3]+n[0][2]*e[2][3]],[n[1][1]*e[1][0]+n[1][2]*e[2][0],n[1][1]*e[1][1]+n[1][2]*e[2][1],n[1][1]*e[1][2]+n[1][2]*e[2][2],n[1][1]*e[1][3]+n[1][2]*e[2][3]],[e[2][0],e[2][1],e[2][2],e[2][3]]],Xse=(n,e,t,s)=>{const i=n[0][0]*e+n[0][1]*t+n[0][3],o=n[1][0]*e+n[1][1]*t+n[1][3],c=n[2][0]*e+n[2][1]*t+n[2][3];return{x:i,y:o,z:c}},Zse=(n,e,t,s)=>{const{x:i,y:o,z:c}=Xse(n,e,t);return{x:i/c,y:o/c}},Kse=6,$se=1,Use=10,Hse=1,jse=.8,Yse=1,wo=1e3;class Qse{constructor(e,t,s,i,o,c=!1){this.markerDimensions=e,this.trackingDataList=t,this.projectionTransform=s,this.debugMode=c,this.trackingKeyframeList=[];for(let f=0;f<t.length;f++)this.trackingKeyframeList.push(t[f][Yse]);let h=0;for(let f=0;f<this.trackingKeyframeList.length;f++)h=Math.max(h,this.trackingKeyframeList[f].points.length);this.featurePointsListT=[],this.imagePixelsListT=[],this.imagePropertiesListT=[];for(let f=0;f<this.trackingKeyframeList.length;f++){const{featurePoints:g,imagePixels:y,imageProperties:I}=this._prebuild(this.trackingKeyframeList[f],h);this.featurePointsListT[f]=g,this.imagePixelsListT[f]=y,this.imagePropertiesListT[f]=I}this.kernelCaches={}}dummyRun(e){let t=[[1,1,1,1],[1,1,1,1],[1,1,1,1]];for(let s=0;s<this.featurePointsListT.length;s++)this.track(e,t,s)}track(e,t,s){let i={};const o=zse(this.projectionTransform,t),c=this._buildAdjustedModelViewTransform(o);this.markerDimensions[s][0],this.markerDimensions[s][1],this.trackingKeyframeList[s].width,this.trackingKeyframeList[s].height;const h=this.featurePointsListT[s],f=this.imagePixelsListT[s],g=this.imagePropertiesListT[s],y=this._computeProjection(c,e,s),{matchingPointsT:I,simT:C}=this._computeMatching(h,f,g,y),k=I.arraySync(),N=C.arraySync(),R=this.trackingKeyframeList[s],P=[],L=[],F=[];for(let W=0;W<k.length;W++)if(N[W]>jse&&W<R.points.length){F.push(W);const z=Zse(o,k[W][0],k[W][1]);L.push(z),P.push({x:R.points[W].x/R.scale,y:R.points[W].y/R.scale,z:0})}return this.debugMode&&(i={projectedImage:y.arraySync(),matchingPoints:I.arraySync(),goodTrack:F,trackedPoints:L}),c.dispose(),y.dispose(),I.dispose(),C.dispose(),{worldCoords:P,screenCoords:L,debugExtra:i}}_computeMatching(e,t,s,i){const o=Kse,c=o*2+1,h=Use*$se,f=Hse,g=h*2+1,y=i.shape[0],I=i.shape[1],C=e.shape[0];if(!this.kernelCaches.computeMatching){const k={variableNames:["features","markerPixels","markerProperties","targetPixels"],outputShape:[C,g*g],userCode:`
	  void main() {
	    ivec2 coords = getOutputCoords();

	    int featureIndex = coords[0];
	    int searchOffsetIndex = coords[1];

	    int markerWidth = int(getMarkerProperties(0));
	    int markerHeight = int(getMarkerProperties(1));
	    float markerScale = getMarkerProperties(2);

	    int searchOffsetX = imod(searchOffsetIndex, ${g}) * ${f};
	    int searchOffsetY = searchOffsetIndex / ${g} * ${f};

	    int sCenterX = int(getFeatures(featureIndex, 0) * markerScale);
	    int sCenterY = int(getFeatures(featureIndex, 1) * markerScale);

	    int sx = sCenterX + searchOffsetX - ${h};
	    int sy = sCenterY + searchOffsetY - ${h};

	    if (sx < ${o} || sx >= (${I} - ${o}) || sy < ${o} || sy >= (${y} - ${o})) {
	      setOutput(-2.);
	    } 
	    else {
	      float sumPoint = 0.;
	      float sumPointSquare = 0.;
	      float sumTemplate = 0.;
	      float sumTemplateSquare = 0.;
	      float sumPointTemplate = 0.;

	      for (int templateOffsetY = 0; templateOffsetY < ${c}; templateOffsetY++) {
		for (int templateOffsetX = 0; templateOffsetX < ${c}; templateOffsetX++) {
		  int fx2 = sCenterX + templateOffsetX - ${o};
		  int fy2 = sCenterY + templateOffsetY - ${o};

		  int sx2 = sx + templateOffsetX - ${o};
		  int sy2 = sy + templateOffsetY - ${o};

		  int markerPixelIndex = fy2 * markerWidth + fx2;
		  float markerPixel = getMarkerPixels(markerPixelIndex);
		  float targetPixel = getTargetPixels(sy2, sx2);

		  sumTemplate += markerPixel;
		  sumTemplateSquare += markerPixel * markerPixel;
		  sumPoint += targetPixel;
		  sumPointSquare += targetPixel * targetPixel;
		  sumPointTemplate += targetPixel * markerPixel;
		}
	      }

	      // Normalized cross-correlation
	      // !important divide first avoid overflow (e.g. sumPoint / count * sumPoint)
	      float count = float(${c} * ${c});
	      float pointVariance = sqrt(sumPointSquare - sumPoint / count * sumPoint);
	      float templateVariance = sqrt(sumTemplateSquare - sumTemplate / count * sumTemplate);

	      if (pointVariance < 0.0000001) {
		setOutput(-3.);
	      } else if (templateVariance < 0.0000001) {
		//setOutput(sumTemplate);
		setOutput(-4.);
	      } else {
		sumPointTemplate -= sumPoint / count * sumTemplate;
		float sim = sumPointTemplate / pointVariance / templateVariance;  
		setOutput(sim);
	      }
	    }
	  }
	`},N={variableNames:["featurePoints","markerProperties","maxIndex"],outputShape:[C,2],userCode:`
	  void main() {
	    ivec2 coords = getOutputCoords();

	    float markerScale = getMarkerProperties(2);

	    int featureIndex = coords[0];

	    int maxIndex = int(getMaxIndex(featureIndex));
	    int searchLocationIndex = maxIndex / ${g*g};
	    int searchOffsetIndex = imod(maxIndex, ${g*g});

	    if (coords[1] == 0) {
	      int searchOffsetX = imod(searchOffsetIndex, ${g}) * ${f};
	      setOutput(getFeaturePoints(featureIndex, 0) + float(searchOffsetX - ${h}) / markerScale);
	    }
	    else if (coords[1] == 1) {
	      int searchOffsetY = searchOffsetIndex / ${g} * ${f};
	      setOutput(getFeaturePoints(featureIndex, 1) + float(searchOffsetY - ${h}) / markerScale);
	    }
	  }
	`},R={variableNames:["sims","maxIndex"],outputShape:[C],userCode:`
	  void main() {
	    int featureIndex = getOutputCoords();
	    int maxIndex = int(getMaxIndex(featureIndex));
	    setOutput(getSims(featureIndex, maxIndex));
	  }
	`};this.kernelCaches.computeMatching=[k,N,R]}return ye(()=>{const k=this.kernelCaches.computeMatching,N=this._compileAndRun(k[0],[e,t,s,i]),R=N.argMax(1),P=this._compileAndRun(k[1],[e,s,R]),L=this._compileAndRun(k[2],[N,R]);return{matchingPointsT:P,simT:L}})}_computeProjection(e,t,s){const i=this.trackingKeyframeList[s].width,o=this.trackingKeyframeList[s].height,c=this.trackingKeyframeList[s].scale,h=i+"-"+o+"-"+c;if(this.kernelCaches.computeProjection||(this.kernelCaches.computeProjection={}),!this.kernelCaches.computeProjection[h]){const f={variableNames:["M","pixel"],outputShape:[o,i],userCode:`
	  void main() {
	      ivec2 coords = getOutputCoords();

	      float m00 = getM(0, 0) * ${wo}.;
	      float m01 = getM(0, 1) * ${wo}.;
	      float m03 = getM(0, 3) * ${wo}.;
	      float m10 = getM(1, 0) * ${wo}.;
	      float m11 = getM(1, 1) * ${wo}.;
	      float m13 = getM(1, 3) * ${wo}.;
	      float m20 = getM(2, 0) * ${wo}.;
	      float m21 = getM(2, 1) * ${wo}.;
	      float m23 = getM(2, 3) * ${wo}.;

	      float y = float(coords[0]) / float(${c});
	      float x = float(coords[1]) / float(${c});
	      float uz = (x * m20) + (y * m21) + m23;
	      float oneOverUz = 1. / uz;

	      float ux = (x * m00) + (y * m01) + m03;
	      float uy = (x * m10) + (y * m11) + m13;

	      ux = floor(ux * oneOverUz + 0.5);
	      uy = floor(uy * oneOverUz + 0.5);
	      setOutput(getPixel(int(uy), int(ux)));
	    }
	`};this.kernelCaches.computeProjection[h]=f}return ye(()=>{const f=this.kernelCaches.computeProjection[h];return this._compileAndRun(f,[e,t])})}_buildAdjustedModelViewTransform(e){return ye(()=>{let t=[];for(let s=0;s<e.length;s++){t.push([]);for(let i=0;i<e[s].length;i++)t[s].push(e[s][i]/wo)}return Ii(t,[3,4])})}_prebuild(e,t){return ye(()=>{const s=e.scale,i=[];for(let h=0;h<t;h++)h<e.points.length?i.push([e.points[h].x/s,e.points[h].y/s]):i.push([-1,-1]);const o=Ii(e.data,[e.width*e.height]),c=Ii([e.width,e.height,e.scale],[3]);return{featurePoints:Ii(i,[i.length,2],"float32"),imagePixels:o,imageProperties:c}})}_compileAndRun(e,t){const s=Ql().compileAndRun(e,t);return Dn().makeTensorFromDataId(s.dataId,s.shape,s.dtype)}}const W1=[{sigma:.55,points:[[-1,0],[-.5,-.866025],[.5,-.866025],[1,-0],[.5,.866025],[-.5,.866025]]},{sigma:.475,points:[[0,.930969],[-.806243,.465485],[-.806243,-.465485],[-0,-.930969],[.806243,-.465485],[.806243,.465485]]},{sigma:.4,points:[[.847306,-0],[.423653,.733789],[-.423653,.733789],[-.847306,0],[-.423653,-.733789],[.423653,-.733789]]},{sigma:.325,points:[[-0,-.741094],[.641806,-.370547],[.641806,.370547],[0,.741094],[-.641806,.370547],[-.641806,-.370547]]},{sigma:.25,points:[[-.595502,0],[-.297751,-.51572],[.297751,-.51572],[.595502,-0],[.297751,.51572],[-.297751,.51572]]},{sigma:.175,points:[[0,.362783],[-.314179,.181391],[-.314179,-.181391],[-0,-.362783],[.314179,-.181391],[.314179,.181391]]},{sigma:.1,points:[[0,0]]}],Qc=[];for(let n=0;n<W1.length;n++){const e=W1[n].sigma;for(let t=0;t<W1[n].points.length;t++){const s=W1[n].points[t];Qc.push([e,s[0],s[1]])}}const Lb={};function Jse(n){const e=n.shape[1],t=n.shape[0],s="w"+e+"h"+t;if(!Lb.hasOwnProperty(s)){const i={variableNames:["p"],outputShape:[t,e],userCode:`
        void main() {
          ivec2 coords = getOutputCoords();

          float sum = getP(coords[0], coords[1]-2);
          sum += getP(coords[0], coords[1]-1) * 4.;
          sum += getP(coords[0], coords[1]) * 6.;
          sum += getP(coords[0], coords[1]+1) * 4.;
          sum += getP(coords[0], coords[1]+2);
          setOutput(sum);
        }
      `},o={variableNames:["p"],outputShape:[t,e],userCode:`
        void main() {
          ivec2 coords = getOutputCoords();

          float sum = getP(coords[0]-2, coords[1]);
          sum += getP(coords[0]-1, coords[1]) * 4.;
          sum += getP(coords[0], coords[1]) * 6.;
          sum += getP(coords[0]+1, coords[1]) * 4.;
          sum += getP(coords[0]+2, coords[1]);
          sum /= 256.;
          setOutput(sum);
        }
      `};Lb[s]=[i,o]}return Lb[s]}const qse={kernelName:"BinomialFilter",backendName:"webgl",kernelFunc:n=>{const e=n.inputs.image,t=n.backend,[s,i]=Jse(e),o=t.runWebGLProgram(s,[e],e.dtype),c=t.runWebGLProgram(i,[o],e.dtype);return t.disposeIntermediateTensorInfo(o),c}},z1=7,kA=3,eie=kA*kA,Db=4,tie=(Db+1)*(Db+1)/Db,Ob={};function nie(n){const e=n.shape[1],t=n.shape[0],s="w"+e+"h"+t;if(!Ob.hasOwnProperty(s)){const i={variableNames:["image0","image1","image2"],outputShape:[t,e],userCode:`
        void main() {
          ivec2 coords = getOutputCoords();
    
          int y = coords[0];
          int x = coords[1];
    
          float value = getImage1(y, x);
    
          // Step 1: find local maxima/minima
          if (value * value < ${eie}.) {
            setOutput(0.);
            return;
          }
          if (y < ${z1} || y > ${t-1-z1}) {
            setOutput(0.);
            return;
          }
          if (x < ${z1} || x > ${e-1-z1}) {
            setOutput(0.);
            return;
          }
    
          bool isMax = true;
          bool isMin = true;
          for (int dy = -1; dy <= 1; dy++) {
            for (int dx = -1; dx <= 1; dx++) {
              float value0 = getImage0(y+dy, x+dx);
              float value1 = getImage1(y+dy, x+dx);
              float value2 = getImage2(y+dy, x+dx);
    
        if (value < value0 || value < value1 || value < value2) {
          isMax = false;
        }
        if (value > value0 || value > value1 || value > value2) {
          isMin = false;
        }
            }
          }
    
          if (!isMax && !isMin) {
            setOutput(0.);
            return;
          }
    
          // compute edge score and reject based on threshold
          float dxx = getImage1(y, x+1) + getImage1(y, x-1) - 2. * getImage1(y, x);
          float dyy = getImage1(y+1, x) + getImage1(y-1, x) - 2. * getImage1(y, x);
          float dxy = 0.25 * (getImage1(y-1,x-1) + getImage1(y+1,x+1) - getImage1(y-1,x+1) - getImage1(y+1,x-1));
    
          float det = (dxx * dyy) - (dxy * dxy);
    
          if (abs(det) < 0.0001) { // determinant undefined. no solution
            setOutput(0.);
            return;
          }
    
          float edgeScore = (dxx + dyy) * (dxx + dyy) / det;
    
          if (abs(edgeScore) >= ${tie} ) {
            setOutput(0.);
            return;
          }
          setOutput(getImage1(y,x));
        }
      `};Ob[s]=i}return Ob[s]}const rie={kernelName:"BuildExtremas",backendName:"webgl",kernelFunc:n=>{let{image0:e,image1:t,image2:s}=n.inputs;const i=n.backend,o=nie(t);return e=Dn().runKernel("DownsampleBilinear",{image:e}),s=Dn().runKernel("UpsampleBilinear",{image:s,targetImage:t}),i.runWebGLProgram(o,[e,t,s],t.dtype)}},hp=36,Pb={};function sie(n){const e=n.shape[0];if(!Pb.hasOwnProperty(e)){const t={variableNames:["histogram"],outputShape:[n.shape[0]],userCode:`
            void main() {
                int featureIndex = getOutputCoords();

                int maxIndex = 0;
                for (int i = 1; i < ${hp}; i++) {
                    if (getHistogram(featureIndex, i) > getHistogram(featureIndex, maxIndex)) {
                        maxIndex = i;
                    }
                }

                int prev = imod(maxIndex - 1 + ${hp}, ${hp});
                int next = imod(maxIndex + 1, ${hp});

                /**
                 * Fit a quatratic to 3 points. The system of equations is:
                 *
                 * y0 = A*x0^2 + B*x0 + C
                 * y1 = A*x1^2 + B*x1 + C
                 * y2 = A*x2^2 + B*x2 + C
                 *
                 * This system of equations is solved for A,B,C.
                 */
                float p10 = float(maxIndex - 1);
                float p11 = getHistogram(featureIndex, prev); 
                float p20 = float(maxIndex);
                float p21 = getHistogram(featureIndex, maxIndex); 
                float p30 = float(maxIndex + 1);
                float p31 = getHistogram(featureIndex, next); 

                float d1 = (p30-p20)*(p30-p10);
                float d2 = (p10-p20)*(p30-p10);
                float d3 = p10-p20;

                // If any of the denominators are zero then, just use maxIndex.
                    float fbin = float(maxIndex);
                if ( abs(d1) > 0.00001 && abs(d2) > 0.00001 && abs(d3) > 0.00001) {
                float a = p10*p10;
                float b = p20*p20;

                // Solve for the coefficients A,B,C
                float A = ((p31-p21)/d1)-((p11-p21)/d2);
                float B = ((p11-p21)+(A*(b-a)))/d3;
                float C = p11-(A*a)-(B*p10);
                fbin = -B / (2. * A);
                }

                float an = 2.0 *${Math.PI} * (fbin + 0.5) / ${hp}. - ${Math.PI};
                setOutput(an);
            }
            `};Pb[e]=t}return Pb[e]}const iie={kernelName:"ComputeExtremaAngles",backendName:"webgl",kernelFunc:n=>{const{histograms:e}=n.inputs,t=n.backend,s=sie(e);return t.runWebGLProgram(s,[e],e.dtype)}},EA=7,Fb={};function aie(n,e){const t=`${n}|${e.shape[0]}`;if(!Fb.hasOwnProperty(t)){const s=[];for(let c=1;c<n;c++)s.push("image"+c);let i="float getPixel(int octave, int y, int x) {";for(let c=1;c<n;c++)i+=`
  if (octave == ${c}) {
	return getImage${c}(y, x);
  }
`;i+="}";const o={variableNames:[...s,"extrema","angles","freakPoints"],outputShape:[e.shape[0],Qc.length],userCode:`
  ${i}
  void main() {
	ivec2 coords = getOutputCoords();
	int featureIndex = coords[0];
	int freakIndex = coords[1];

	float freakSigma = getFreakPoints(freakIndex, 0);
	float freakX = getFreakPoints(freakIndex, 1);
	float freakY = getFreakPoints(freakIndex, 2);

	int octave = int(getExtrema(featureIndex, 1));
	float inputY = getExtrema(featureIndex, 2);
	float inputX = getExtrema(featureIndex, 3);
	float inputAngle = getAngles(featureIndex);
	float cos = ${EA}. * cos(inputAngle);
	float sin = ${EA}. * sin(inputAngle);

	float yp = inputY + freakX * sin + freakY * cos;
	float xp = inputX + freakX * cos + freakY * -sin;

	int x0 = int(floor(xp));
	int x1 = x0 + 1;
	int y0 = int(floor(yp));
	int y1 = y0 + 1;

	float f1 = getPixel(octave, y0, x0);
	float f2 = getPixel(octave, y0, x1);
	float f3 = getPixel(octave, y1, x0);
	float f4 = getPixel(octave, y1, x1);

	float x1f = float(x1);
	float y1f = float(y1);
	float x0f = float(x0);
	float y0f = float(y0);

	// ratio for interpolation between four neighbouring points
	float value = (x1f - xp) * (y1f - yp) * f1
		+ (xp - x0f) * (y1f - yp) * f2
		+ (x1f - xp) * (yp - y0f) * f3
		+ (xp - x0f) * (yp - y0f) * f4;

	setOutput(value);
  }
`};Fb[t]=o}return Fb[t]}const oie={kernelName:"ComputeExtremaFreak",backendName:"webgl",kernelFunc:n=>{const{gaussianImagesT:e,prunedExtremas:t,prunedExtremasAngles:s,freakPointsT:i,pyramidImagesLength:o}=n.inputs,c=n.backend,h=aie(o,t);return c.runWebGLProgram(h,[...e,t,s,i],"float32")}},NA=(Qc.length-1)*Qc.length/2,lie=Math.ceil(NA/8),Gb={};function uie(n){const e=`${n.shape[0]}`;if(!Gb.hasOwnProperty(e)){const t={variableNames:["freak","p"],outputShape:[n.shape[0],lie],userCode:`
  void main() {
    ivec2 coords = getOutputCoords();
    int featureIndex = coords[0];
    int descIndex = coords[1] * 8;

    int sum = 0;
    for (int i = 0; i < 8; i++) {
      if (descIndex + i >= ${NA}) {
        continue;
      }

      int p1 = int(getP(descIndex + i, 0));
      int p2 = int(getP(descIndex + i, 1));

      float v1 = getFreak(featureIndex, p1);
      float v2 = getFreak(featureIndex, p2);

      if (v1 < v2 + 0.01) {
        sum += int(pow(2.0, float(7 - i)));
      }
    }
    setOutput(float(sum));
  }
`};Gb[e]=t}return Gb[e]}const cie={kernelName:"ComputeFreakDescriptors",backendName:"webgl",kernelFunc:n=>{const{extremaFreaks:e,positionT:t}=n.inputs,{backend:s}=n,i=uie(e);return s.runWebGLProgram(i,[e,t],"int32")}},_b={};function hie(n,e){const t=`${n}|${e}`;if(!_b.hasOwnProperty(t)){const s=[];let i="float getPixel(int octave, int y, int x) {";for(let o=1;o<n;o++)s.push("image"+o),i+=`
				if (octave == ${o}) {
					return getImage${o}(y, x);
				}
			`;i+="}",_b[t]={variableNames:[...s,"extrema"],outputShape:[e,3,3],userCode:`
			${i}
		
			void main() {
				ivec3 coords = getOutputCoords();
				int featureIndex = coords[0];
				float score = getExtrema(featureIndex, 0);
				if (score == 0.0) {
					return;
				}
		
				int dy = coords[1]-1;
				int dx = coords[2]-1;
				int octave = int(getExtrema(featureIndex, 1));
				int y = int(getExtrema(featureIndex, 2));
				int x = int(getExtrema(featureIndex, 3));
				setOutput(getPixel(octave, y+dy, x+dx));
			}
			`}}return _b[t]}const die={kernelName:"ComputeLocalization",backendName:"webgl",kernelFunc:n=>{const{prunedExtremasList:e,dogPyramidImagesT:t}=n.inputs,s=n.backend,i=hie(t.length,e.length),o=Ii(e,[e.length,e[0].length],"int32");return s.runWebGLProgram(i,[...t.slice(1),o],t[0].dtype)}},fie=.159154943091895,Id=36,Vb={};function pie(n,e,t){const s=`${t}|${n.shape[0]}|${e.shape[0]}`;if(!Vb.hasOwnProperty(s)){const i=[];for(let f=1;f<t;f++)i.push("image"+f);let o="float getPixel(int octave, int y, int x) {";for(let f=1;f<t;f++)o+=`
            if (octave == ${f}) {
                return getImage${f}(y, x);
            }
            `;o+="}";const c={variableNames:[...i,"extrema","radial"],outputShape:[n.shape[0],e.shape[0],2],userCode:`
                ${o}

                void main() {
                    ivec3 coords = getOutputCoords();
                    int featureIndex = coords[0];
                    int radialIndex = coords[1];
                    int propertyIndex = coords[2];

                    int radialY = int(getRadial(radialIndex, 0));
                    int radialX = int(getRadial(radialIndex, 1));
                    float radialW = getRadial(radialIndex, 2);

                    int octave = int(getExtrema(featureIndex, 1));
                    int y = int(getExtrema(featureIndex, 2));
                    int x = int(getExtrema(featureIndex, 3));

                    int xp = x + radialX;
                    int yp = y + radialY;

                    float dy = getPixel(octave, yp+1, xp) - getPixel(octave, yp-1, xp);
                    float dx = getPixel(octave, yp, xp+1) - getPixel(octave, yp, xp-1);

                    if (propertyIndex == 0) {
                    // be careful that atan(0, 0) gives 1.57 instead of 0 (different from js), but doesn't matter here, coz magnitude is 0
                    
                    float angle = atan(dy, dx) + ${Math.PI};
                    float fbin = angle * ${Id}. * ${fie};
                    setOutput(fbin);
                    return;
                    }

                    if (propertyIndex == 1) {
                        float mag = sqrt(dx * dx + dy * dy);
                        float magnitude = radialW * mag;
                        setOutput(magnitude);
                        return;
                    }
                }

                `},h={variableNames:["fbinMag"],outputShape:[n.shape[0],Id],userCode:`
            void main() {
                ivec2 coords = getOutputCoords();
                int featureIndex = coords[0];
                int binIndex = coords[1];

                float sum = 0.;
                for (int i = 0; i < ${e.shape[0]}; i++) {
                    float fbin = getFbinMag(featureIndex, i, 0);
                    int bin = int(floor(fbin - 0.5));
                    int b1 = imod(bin + ${Id}, ${Id});
                    int b2 = imod(bin + 1 + ${Id}, ${Id});

                    if (b1 == binIndex || b2 == binIndex) {
                        float magnitude = getFbinMag(featureIndex, i, 1);
                        float w2 = fbin - float(bin) - 0.5;
                        float w1 = w2 * -1. + 1.;

                        if (b1 == binIndex) {
                            sum += w1 * magnitude;
                        }
                        if (b2 == binIndex) {
                            sum += w2 * magnitude;
                        }
                    }
                }
                setOutput(sum);
            }
            `};Vb[s]=[c,h]}return Vb[s]}const mie={kernelName:"ComputeOrientationHistograms",backendName:"webgl",kernelFunc:n=>{const{gaussianImagesT:e,prunedExtremasT:t,radialPropertiesT:s,pyramidImagesLength:i}=n.inputs,o=n.backend,[c,h]=pie(t,s,i),f=o.runWebGLProgram(c,[...e,t,s],s.dtype),g=o.runWebGLProgram(h,[f],s.dtype);return o.disposeIntermediateTensorInfo(f),g}},Bb={};function gie(n){const e=n.shape[1],t=n.shape[0],s="w"+e+"h"+t;if(!Bb.hasOwnProperty(s)){const i={variableNames:["p"],outputShape:[Math.floor(t/2),Math.floor(e/2)],userCode:`
            void main() {
                ivec2 coords = getOutputCoords();
                int y = coords[0] * 2;
                int x = coords[1] * 2;
        
                float sum = getP(y, x) * 0.25;
                sum += getP(y+1,x) * 0.25; 
                sum += getP(y, x+1) * 0.25; 
                sum += getP(y+1,x+1) * 0.25;
                setOutput(sum);
            }
            `};Bb[s]=i}return Bb[s]}const xie={kernelName:"DownsampleBilinear",backendName:"webgl",kernelFunc:n=>{const e=n.inputs.image,t=n.backend,s=gie(e);return t.runWebGLProgram(s,[e],e.dtype)}},yie={kernelName:"ExtremaReduction",backendName:"webgl",kernelFunc:n=>{const{extremasResultT:e}=n.inputs,t=n.backend,s=e.shape[0],i=e.shape[1],o={variableNames:["extrema"],outputShape:[Math.floor(s/2),Math.floor(i/2)],userCode:`
		  void main() {
			ivec2 coords = getOutputCoords();
			int y = coords[0] * 2;
			int x = coords[1] * 2;
  
			float location = 0.0;
			float values = getExtrema(y, x);
  
			if (getExtrema(y+1, x) != 0.0) {
			  location = 1.0;
		  values = getExtrema(y+1, x);
			}
			else if (getExtrema(y, x+1) != 0.0) {
			  location = 2.0;
		  values = getExtrema(y, x+1);
			}
			else if (getExtrema(y+1, x+1) != 0.0) {
			  location = 3.0;
		  values = getExtrema(y+1, x+1);
			}
  
			if (values < 0.0) {
			  setOutput(location * -1000.0 + values);
			} else {
			  setOutput(location * 1000.0 + values);
			}
		  }
		`};return t.runWebGLProgram(o,[e],e.dtype)}},X1=36,bie=5,Wb={};function wie(n){const e=`h${n.shape[0]}`;if(!Wb.hasOwnProperty(e)){const t={variableNames:["histogram"],outputShape:[n.shape[0],X1],userCode:`
            void main() {
                ivec2 coords = getOutputCoords();

                int featureIndex = coords[0];
                int binIndex = coords[1];

                int prevBin = imod(binIndex - 1 + ${X1}, ${X1});
                int nextBin = imod(binIndex + 1, ${X1});
                float result = 0.274068619061197 * getHistogram(featureIndex, prevBin) + 0.451862761877606 * getHistogram(featureIndex, binIndex) + 0.274068619061197 * getHistogram(featureIndex, nextBin);

                setOutput(result);
            }
            `};Wb[e]=t}return Wb[e]}const vie={kernelName:"SmoothHistograms",backendName:"webgl",kernelFunc:n=>{let{histograms:e}=n.inputs;const t=n.backend,s=wie(e);for(let i=0;i<bie;i++){const o=e;e=t.runWebGLProgram(s,[e],e.dtype),i>0&&t.disposeIntermediateTensorInfo(o)}return e}},zb={};function Iie(n,e){const t=e.shape[1],s=e.shape[0],i="w"+t+"h"+s;if(!zb.hasOwnProperty(i)){const o={variableNames:["p"],outputShape:[s,t],userCode:`
              void main() {
                ivec2 coords = getOutputCoords();
                int j = coords[0];
                int i = coords[1];
        
                float sj = 0.5 * float(j) - 0.25; 
                float si = 0.5 * float(i) - 0.25;
        
                float sj0 = floor(sj);
                float sj1 = ceil(sj);
                float si0 = floor(si);
                float si1 = ceil(si);
        
                int sj0I = int(sj0);
                int sj1I = int(sj1);
                int si0I = int(si0);
                int si1I = int(si1);
        
                float sum = 0.0;
                sum += getP(sj0I, si0I) * (si1 - si) * (sj1 - sj);
                sum += getP(sj1I, si0I) * (si1 - si) * (sj - sj0);
                sum += getP(sj0I, si1I) * (si - si0) * (sj1 - sj);
                sum += getP(sj1I, si1I) * (si - si0) * (sj - sj0);
                setOutput(sum);
              }
            `};zb[i]=o}return zb[i]}const Cie={kernelName:"UpsampleBilinear",backendName:"webgl",kernelFunc:n=>{const{image:e,targetImage:t}=n.inputs,s=n.backend,i=Iie(e,t);return s.runWebGLProgram(i,[e],e.dtype)}};Xe(qse),Xe(rie),Xe(iie),Xe(oie),Xe(cie),Xe(die),Xe(mie),Xe(xie),Xe(yie),Xe(vie),Xe(Cie);const AA=8,Sie=5,dp=10,Tie=5,Xb=3,kie=1.5;(Qc.length-1)*Qc.length/2;class RA{constructor(e,t,s=!1){this.debugMode=s,this.width=e,this.height=t;let i=0;for(;e>=AA&&t>=AA&&(e/=2,t/=2,i++,i!==Sie););this.numOctaves=i,this.tensorCaches={},this.kernelCaches={}}detectImageData(e){const t=new Uint8ClampedArray(4*e.length);for(let i=0;i<e.length;i++)t[4*i]=e[i],t[4*i+1]=e[i],t[4*i+2]=e[i],t[4*i+3]=255;const s=new ImageData(t,this.width,this.height);return this.detect(s)}detect(e){let t=null;const s=[];for(let L=0;L<this.numOctaves;L++){let F,W;L===0?F=this._applyFilter(e):F=this._downsampleBilinear(s[L-1][s[L-1].length-1]),W=this._applyFilter(F),s.push([F,W])}const i=[];for(let L=0;L<this.numOctaves;L++){let F=this._differenceImageBinomial(s[L][0],s[L][1]);i.push(F)}const o=[];for(let L=1;L<this.numOctaves-1;L++){const F=this._buildExtremas(i[L-1],i[L],i[L+1]);o.push(F)}const c=this._applyPrune(o),h=this._computeLocalization(c,i),f=this._computeOrientationHistograms(h,s),g=this._smoothHistograms(f),y=this._computeExtremaAngles(g),I=this._computeExtremaFreak(s,h,y),C=this._computeFreakDescriptors(I),k=h.arraySync(),N=y.arraySync(),R=C.arraySync();this.debugMode&&(t={pyramidImages:s.map(L=>L.map(F=>F.arraySync())),dogPyramidImages:i.map(L=>L?L.arraySync():null),extremasResults:o.map(L=>L.arraySync()),extremaAngles:y.arraySync(),prunedExtremas:c,localizedExtremas:h.arraySync()}),s.forEach(L=>L.forEach(F=>F.dispose())),i.forEach(L=>L&&L.dispose()),o.forEach(L=>L.dispose()),h.dispose(),f.dispose(),g.dispose(),y.dispose(),I.dispose(),C.dispose();const P=[];for(let L=0;L<k.length;L++){if(k[L][0]==0)continue;const F=[];for(let te=0;te<R[L].length;te+=4){const ie=R[L][te],oe=R[L][te+1],Ce=R[L][te+2],Se=R[L][te+3];let Te=ie*16777216+oe*65536+Ce*256+Se;F.push(Te)}const W=k[L][1],z=k[L][2],X=k[L][3]*Math.pow(2,W)+Math.pow(2,W-1)-.5,Q=z*Math.pow(2,W)+Math.pow(2,W-1)-.5,J=Math.pow(2,W);P.push({maxima:k[L][0]>0,x:X,y:Q,scale:J,angle:N[L],descriptors:F})}return{featurePoints:P,debugExtra:t}}_computeFreakDescriptors(e){if(!this.tensorCaches.computeFreakDescriptors){const s=[],i=[];for(let h=0;h<e.shape[1];h++)for(let f=h+1;f<e.shape[1];f++)s.push(h),i.push(f);const o=Ii(s,[s.length]).cast("int32"),c=Ii(i,[i.length]).cast("int32");this.tensorCaches.computeFreakDescriptors={positionT:Ci(uo([o,c],1))}}const{positionT:t}=this.tensorCaches.computeFreakDescriptors;return ye(()=>Dn().runKernel("ComputeFreakDescriptors",{extremaFreaks:e,positionT:t}))}_computeExtremaFreak(e,t,s){this.tensorCaches._computeExtremaFreak||ye(()=>{const c=Ii(Qc);this.tensorCaches._computeExtremaFreak={freakPointsT:Ci(c)}});const{freakPointsT:i}=this.tensorCaches._computeExtremaFreak,o=[];for(let c=1;c<e.length;c++)o.push(e[c][1]);return ye(()=>Dn().runKernel("ComputeExtremaFreak",{gaussianImagesT:o,prunedExtremas:t,prunedExtremasAngles:s,freakPointsT:i,pyramidImagesLength:e.length}))}_computeExtremaAngles(e){return ye(()=>Dn().runKernel("ComputeExtremaAngles",{histograms:e}))}_computeOrientationHistograms(e,t){const s=[];for(let o=1;o<t.length;o++)s.push(t[o][1]);this.tensorCaches.orientationHistograms||ye(()=>{const o=-1/(2*Xb*Xb),c=Xb*kie,h=Math.ceil(c),f=[];for(let g=-h;g<=h;g++)for(let y=-h;y<=h;y++){const I=y*y+g*g;if(I<=c*c){const C=I*o;let k=(720+C*(720+C*(360+C*(120+C*(30+C*(6+C))))))*.0013888888;f.push([g,y,k])}}this.tensorCaches.orientationHistograms={radialPropertiesT:Ci(Ii(f,[f.length,3]))}});const{radialPropertiesT:i}=this.tensorCaches.orientationHistograms;return ye(()=>Dn().runKernel("ComputeOrientationHistograms",{gaussianImagesT:s,prunedExtremasT:e,radialPropertiesT:i,pyramidImagesLength:t.length}))}_smoothHistograms(e){return ye(()=>Dn().runKernel("SmoothHistograms",{histograms:e}))}_computeLocalization(e,t){return ye(()=>{const s=Dn().runKernel("ComputeLocalization",{prunedExtremasList:e,dogPyramidImagesT:t}).arraySync(),i=[];for(let c=0;c<s.length;c++){i.push([]);for(let h=0;h<s[c].length;h++)i[c].push([])}const o=[];for(let c=0;c<e.length;c++)o[c]=[e[c][0],e[c][1],e[c][2],e[c][3]];for(let c=0;c<o.length;c++){if(o[c][0]===0)continue;const h=s[c],f=.5*(h[1][2]-h[1][0]),g=.5*(h[2][1]-h[0][1]),y=h[1][2]+h[1][0]-2*h[1][1],I=h[2][1]+h[0][1]-2*h[1][1],C=.25*(h[0][0]+h[2][2]-h[0][2]-h[2][0]),k=y*I-C*C,N=(I*-f+-C*-g)/k,R=(-C*-f+y*-g)/k,P=o[c][2]+R,L=o[c][3]+N;Math.abs(k)<1e-4||(o[c][2]=P,o[c][3]=L)}return Ii(o,[o.length,o[0].length],"float32")})}_applyPrune(e){const t=dp*dp,s=Tie,i=[],o=[];for(let h=0;h<t;h++){o.push([]),i.push([]);for(let f=0;f<s;f++)o[h].push([0,0,0,0]),i[h].push(0)}ye(()=>{for(let h=0;h<e.length;h++){const f=Dn().runKernel("ExtremaReduction",{extremasResultT:e[h]}),g=h+1,y=f.arraySync(),I=f.shape[0],C=f.shape[1],k=C*2/dp,N=I*2/dp;for(let R=0;R<I;R++)for(let P=0;P<C;P++){const L=y[R][P];if(L==0)continue;const F=L%1e3,W=Math.floor(Math.abs(L)/1e3),z=P*2+(W===2||W===3?1:0),X=R*2+(W===1||W===3?1:0),Q=Math.floor(z/k),J=Math.floor(X/N)*dp+Q,te=Math.abs(F);let ie=s;for(;ie>=1&&te>i[J][ie-1];)ie-=1;if(ie<s){for(let oe=s-1;oe>=ie+1;oe--)i[J][oe]=i[J][oe-1],o[J][oe][0]=o[J][oe-1][0],o[J][oe][1]=o[J][oe-1][1],o[J][oe][2]=o[J][oe-1][2],o[J][oe][3]=o[J][oe-1][3];i[J][ie]=te,o[J][ie][0]=F,o[J][ie][1]=g,o[J][ie][2]=X,o[J][ie][3]=z}}}});const c=[];for(let h=0;h<t;h++)for(let f=0;f<s;f++)c.push(o[h][f]);return c}_buildExtremas(e,t,s){return ye(()=>Dn().runKernel("BuildExtremas",{image0:e,image1:t,image2:s}))}_differenceImageBinomial(e,t){return ye(()=>e.sub(t))}_applyFilter(e){return ye(()=>Dn().runKernel("BinomialFilter",{image:e}))}_downsampleBilinear(e){return ye(()=>Dn().runKernel("DownsampleBilinear",{image:e}))}_compileAndRun(e,t){const s=Ql().compileAndRun(e,t);return Dn().makeTensorFromDataId(s.dataId,s.shape,s.dtype)}_runWebGLProgram(e,t,s){const i=Ql().runWebGLProgram(e,t,s);return Dn().makeTensorFromDataId(i.dataId,i.shape,i.dtype)}}class Eie{constructor(e,t,s=!1){this.debugMode=s,this.width=e,this.height=t;let i=Math.min(e,t)/2,o=Math.pow(2,Math.round(Math.log(i)/Math.log(2)));this.cropSize=o,this.detector=new RA(o,o,s),this.kernelCaches={},this.lastRandomIndex=4}detect(e){const t=Math.floor(this.height/2-this.cropSize/2),s=Math.floor(this.width/2-this.cropSize/2),i=this._detect(e,s,t);return this.debugMode&&(i.debugExtra.crop={startX:s,startY:t,cropSize:this.cropSize}),i}detectMoving(e){const t=this.lastRandomIndex%3,s=Math.floor(this.lastRandomIndex/3);let i=Math.floor(this.height/2-this.cropSize+s*this.cropSize/2),o=Math.floor(this.width/2-this.cropSize+t*this.cropSize/2);return o<0&&(o=0),i<0&&(i=0),o>=this.width-this.cropSize&&(o=this.width-this.cropSize-1),i>=this.height-this.cropSize&&(i=this.height-this.cropSize-1),this.lastRandomIndex=(this.lastRandomIndex+1)%9,this._detect(e,o,i)}_detect(e,t,s){const i=e.slice([s,t],[this.cropSize,this.cropSize]),{featurePoints:o,debugExtra:c}=this.detector.detect(i);return o.forEach(h=>{h.x+=t,h.y+=s}),this.debugMode&&(c.projectedImage=i.arraySync()),i.dispose(),{featurePoints:o,debugExtra:c}}}const MA=({image:n,ratio:e})=>{const t=Math.round(n.width*e),s=Math.round(n.height*e),i=new Uint8Array(t*s);for(let o=0;o<t;o++){let c=Math.round(1*o/e),h=Math.round(1*(o+1)/e)-1;h>=n.width&&(h=n.width-1);for(let f=0;f<s;f++){let g=Math.round(1*f/e),y=Math.round(1*(f+1)/e)-1;y>=n.height&&(y=n.height-1);let I=0,C=0;for(let k=c;k<=h;k++)for(let N=g;N<=y;N++)I+=1*n.data[N*n.width+k],C+=1;i[f*t+o]=Math.floor(I/C)}}return{data:i,width:t,height:s}},Nie=100,Aie=n=>{const e=Nie/Math.min(n.width,n.height),t=[];let s=e;for(;;)if(t.push(s),s*=Math.pow(2,1/3),s>=.95){s=1;break}t.push(s),t.reverse();const i=[];for(let o=0;o<t.length;o++)n.width*t[o],n.height*t[o],i.push(Object.assign(MA({image:n,ratio:t[o]}),{scale:t[o]}));return i},Rie=n=>{const e=Math.min(n.width,n.height),t=[],s=[];t.push(256/e),t.push(128/e);for(let i=0;i<t.length;i++)s.push(Object.assign(MA({image:n,ratio:t[i]}),{scale:t[i]}));return s},Mie=n=>{const{v1:e,v2:t}=n;let s=0;for(let i=0;i<e.length;i++){let o=(e[i]^t[i])>>>0;s+=Lie(o)}return s},Lie=n=>{var e=n-(n>>1&1431655765);return e=(e>>2&858993459)+(e&858993459),e=(e>>4)+e&252645135,e=(e>>8)+e&16711935,e=(e>>16)+e&65535,e},Die=1234,Oie=()=>({seed:Die,arrayShuffle(n){const{arr:e,sampleSize:t}=n;for(let s=0;s<t;s++){this.seed=(214013*this.seed+2531011)%-2147483648;let i=this.seed>>16&32767;i=i%e.length;let o=e[s];e[s]=e[i],e[i]=o}},nextInt(n){this.seed=(214013*this.seed+2531011)%-2147483648;let e=this.seed>>16&32767;return e=e%n,e}}),Pie=16,Fie=128,Zb=8,Gie=n=>{const{points:e,pointIndexes:t,randomizer:s}=n,i=[];for(let f=0;f<t.length;f++)i.push(f);let o=Number.MAX_SAFE_INTEGER,c=-1;const h=[];for(let f=0;f<Fie;f++){s.arrayShuffle({arr:i,sampleSize:Zb});let g=0;const y=[];for(let I=0;I<t.length;I++){let C=Number.MAX_SAFE_INTEGER;for(let k=0;k<Zb;k++){const N=t[i[k]],R=Mie({v1:e[t[I]].descriptors,v2:e[N].descriptors});R<C&&(y[I]=i[k],C=R)}g+=C}h.push(y),g<o&&(o=g,c=f)}return h[c]},LA=({points:n})=>{const e=[];for(let s=0;s<n.length;s++)e.push(s);const t=Oie();return{rootNode:DA({points:n,pointIndexes:e,centerPointIndex:null,randomizer:t})}},DA=n=>{const{points:e,pointIndexes:t,centerPointIndex:s,randomizer:i}=n;let o=!1;(t.length<=Zb||t.length<=Pie)&&(o=!0);const c={};if(!o){const f=Gie({points:e,pointIndexes:t,randomizer:i});for(let g=0;g<f.length;g++)c[t[f[g]]]===void 0&&(c[t[f[g]]]=[]),c[t[f[g]]].push(t[g])}Object.keys(c).length===1&&(o=!0);const h={centerPointIndex:s};if(o){h.leaf=!0,h.pointIndexes=[];for(let f=0;f<t.length;f++)h.pointIndexes.push(t[f]);return h}return h.leaf=!1,h.children=[],Object.keys(c).forEach(f=>{h.children.push(DA({points:e,pointIndexes:c[f],centerPointIndex:f,randomizer:i}))}),h};var Jc=4294967295;function _ie(n,e,t){var s=t/4294967296,i=t;n.setUint32(e,s),n.setUint32(e+4,i)}function OA(n,e,t){var s=Math.floor(t/4294967296),i=t;n.setUint32(e,s),n.setUint32(e+4,i)}function PA(n,e){var t=n.getInt32(e),s=n.getUint32(e+4);return t*4294967296+s}function Vie(n,e){var t=n.getUint32(e),s=n.getUint32(e+4);return t*4294967296+s}var Kb,$b,Ub,Z1=(typeof process>"u"||((Kb=process==null?void 0:T2)===null||Kb===void 0?void 0:Kb.TEXT_ENCODING)!=="never")&&typeof TextEncoder<"u"&&typeof TextDecoder<"u";function FA(n){for(var e=n.length,t=0,s=0;s<e;){var i=n.charCodeAt(s++);if(i&4294967168)if(!(i&4294965248))t+=2;else{if(i>=55296&&i<=56319&&s<e){var o=n.charCodeAt(s);(o&64512)===56320&&(++s,i=((i&1023)<<10)+(o&1023)+65536)}i&4294901760?t+=4:t+=3}else{t++;continue}}return t}function Bie(n,e,t){for(var s=n.length,i=t,o=0;o<s;){var c=n.charCodeAt(o++);if(c&4294967168)if(!(c&4294965248))e[i++]=c>>6&31|192;else{if(c>=55296&&c<=56319&&o<s){var h=n.charCodeAt(o);(h&64512)===56320&&(++o,c=((c&1023)<<10)+(h&1023)+65536)}c&4294901760?(e[i++]=c>>18&7|240,e[i++]=c>>12&63|128,e[i++]=c>>6&63|128):(e[i++]=c>>12&15|224,e[i++]=c>>6&63|128)}else{e[i++]=c;continue}e[i++]=c&63|128}}var K1=Z1?new TextEncoder:void 0,Wie=Z1?typeof process<"u"&&(($b=process==null?void 0:T2)===null||$b===void 0?void 0:$b.TEXT_ENCODING)!=="force"?200:0:Jc;function zie(n,e,t){e.set(K1.encode(n),t)}function Xie(n,e,t){K1.encodeInto(n,e.subarray(t))}var Zie=K1!=null&&K1.encodeInto?Xie:zie,Kie=4096;function GA(n,e,t){for(var s=e,i=s+t,o=[],c="";s<i;){var h=n[s++];if(!(h&128))o.push(h);else if((h&224)===192){var f=n[s++]&63;o.push((h&31)<<6|f)}else if((h&240)===224){var f=n[s++]&63,g=n[s++]&63;o.push((h&31)<<12|f<<6|g)}else if((h&248)===240){var f=n[s++]&63,g=n[s++]&63,y=n[s++]&63,I=(h&7)<<18|f<<12|g<<6|y;I>65535&&(I-=65536,o.push(I>>>10&1023|55296),I=56320|I&1023),o.push(I)}else o.push(h);o.length>=Kie&&(c+=String.fromCharCode.apply(String,o),o.length=0)}return o.length>0&&(c+=String.fromCharCode.apply(String,o)),c}var $ie=Z1?new TextDecoder:null,Uie=Z1?typeof process<"u"&&((Ub=process==null?void 0:T2)===null||Ub===void 0?void 0:Ub.TEXT_DECODER)!=="force"?200:0:Jc;function Hie(n,e,t){var s=n.subarray(e,e+t);return $ie.decode(s)}var $1=function(){function n(e,t){this.type=e,this.data=t}return n}(),jie=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,i){s.__proto__=i}||function(s,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(s[o]=i[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function s(){this.constructor=e}e.prototype=t===null?Object.create(t):(s.prototype=t.prototype,new s)}}(),vo=function(n){jie(e,n);function e(t){var s=n.call(this,t)||this,i=Object.create(e.prototype);return Object.setPrototypeOf(s,i),Object.defineProperty(s,"name",{configurable:!0,enumerable:!1,value:e.name}),s}return e}(Error),Yie=-1,Qie=4294967296-1,Jie=17179869184-1;function qie(n){var e=n.sec,t=n.nsec;if(e>=0&&t>=0&&e<=Jie)if(t===0&&e<=Qie){var s=new Uint8Array(4),i=new DataView(s.buffer);return i.setUint32(0,e),s}else{var o=e/4294967296,c=e&4294967295,s=new Uint8Array(8),i=new DataView(s.buffer);return i.setUint32(0,t<<2|o&3),i.setUint32(4,c),s}else{var s=new Uint8Array(12),i=new DataView(s.buffer);return i.setUint32(0,t),OA(i,4,e),s}}function eae(n){var e=n.getTime(),t=Math.floor(e/1e3),s=(e-t*1e3)*1e6,i=Math.floor(s/1e9);return{sec:t+i,nsec:s-i*1e9}}function tae(n){if(n instanceof Date){var e=eae(n);return qie(e)}else return null}function nae(n){var e=new DataView(n.buffer,n.byteOffset,n.byteLength);switch(n.byteLength){case 4:{var t=e.getUint32(0),s=0;return{sec:t,nsec:s}}case 8:{var i=e.getUint32(0),o=e.getUint32(4),t=(i&3)*4294967296+o,s=i>>>2;return{sec:t,nsec:s}}case 12:{var t=PA(e,4),s=e.getUint32(0);return{sec:t,nsec:s}}default:throw new vo("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(n.length))}}function rae(n){var e=nae(n);return new Date(e.sec*1e3+e.nsec/1e6)}var sae={type:Yie,encode:tae,decode:rae},_A=function(){function n(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(sae)}return n.prototype.register=function(e){var t=e.type,s=e.encode,i=e.decode;if(t>=0)this.encoders[t]=s,this.decoders[t]=i;else{var o=1+t;this.builtInEncoders[o]=s,this.builtInDecoders[o]=i}},n.prototype.tryToEncode=function(e,t){for(var s=0;s<this.builtInEncoders.length;s++){var i=this.builtInEncoders[s];if(i!=null){var o=i(e,t);if(o!=null){var c=-1-s;return new $1(c,o)}}}for(var s=0;s<this.encoders.length;s++){var i=this.encoders[s];if(i!=null){var o=i(e,t);if(o!=null){var c=s;return new $1(c,o)}}}return e instanceof $1?e:null},n.prototype.decode=function(e,t,s){var i=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return i?i(e,t,s):new $1(t,e)},n.defaultCodec=new n,n}();function U1(n){return n instanceof Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n instanceof ArrayBuffer?new Uint8Array(n):Uint8Array.from(n)}function iae(n){if(n instanceof ArrayBuffer)return new DataView(n);var e=U1(n);return new DataView(e.buffer,e.byteOffset,e.byteLength)}var aae=100,oae=2048,lae=function(){function n(e,t,s,i,o,c,h,f){e===void 0&&(e=_A.defaultCodec),t===void 0&&(t=void 0),s===void 0&&(s=aae),i===void 0&&(i=oae),o===void 0&&(o=!1),c===void 0&&(c=!1),h===void 0&&(h=!1),f===void 0&&(f=!1),this.extensionCodec=e,this.context=t,this.maxDepth=s,this.initialBufferSize=i,this.sortKeys=o,this.forceFloat32=c,this.ignoreUndefined=h,this.forceIntegerToFloat=f,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return n.prototype.reinitializeState=function(){this.pos=0},n.prototype.encodeSharedRef=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)},n.prototype.encode=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)},n.prototype.doEncode=function(e,t){if(t>this.maxDepth)throw new Error("Too deep objects in depth ".concat(t));e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.encodeObject(e,t)},n.prototype.ensureBufferSizeToWrite=function(e){var t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(t*2)},n.prototype.resizeBuffer=function(e){var t=new ArrayBuffer(e),s=new Uint8Array(t),i=new DataView(t);s.set(this.bytes),this.view=i,this.bytes=s},n.prototype.encodeNil=function(){this.writeU8(192)},n.prototype.encodeBoolean=function(e){e===!1?this.writeU8(194):this.writeU8(195)},n.prototype.encodeNumber=function(e){Number.isSafeInteger(e)&&!this.forceIntegerToFloat?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):(this.writeU8(211),this.writeI64(e)):this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))},n.prototype.writeStringHeader=function(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error("Too long string: ".concat(e," bytes in UTF-8"))},n.prototype.encodeString=function(e){var t=5,s=e.length;if(s>Wie){var i=FA(e);this.ensureBufferSizeToWrite(t+i),this.writeStringHeader(i),Zie(e,this.bytes,this.pos),this.pos+=i}else{var i=FA(e);this.ensureBufferSizeToWrite(t+i),this.writeStringHeader(i),Bie(e,this.bytes,this.pos),this.pos+=i}},n.prototype.encodeObject=function(e,t){var s=this.extensionCodec.tryToEncode(e,this.context);if(s!=null)this.encodeExtension(s);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,t);else throw new Error("Unrecognized object: ".concat(Object.prototype.toString.apply(e)))},n.prototype.encodeBinary=function(e){var t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else if(t<4294967296)this.writeU8(198),this.writeU32(t);else throw new Error("Too large binary: ".concat(t));var s=U1(e);this.writeU8a(s)},n.prototype.encodeArray=function(e,t){var s=e.length;if(s<16)this.writeU8(144+s);else if(s<65536)this.writeU8(220),this.writeU16(s);else if(s<4294967296)this.writeU8(221),this.writeU32(s);else throw new Error("Too large array: ".concat(s));for(var i=0,o=e;i<o.length;i++){var c=o[i];this.doEncode(c,t+1)}},n.prototype.countWithoutUndefined=function(e,t){for(var s=0,i=0,o=t;i<o.length;i++){var c=o[i];e[c]!==void 0&&s++}return s},n.prototype.encodeMap=function(e,t){var s=Object.keys(e);this.sortKeys&&s.sort();var i=this.ignoreUndefined?this.countWithoutUndefined(e,s):s.length;if(i<16)this.writeU8(128+i);else if(i<65536)this.writeU8(222),this.writeU16(i);else if(i<4294967296)this.writeU8(223),this.writeU32(i);else throw new Error("Too large map object: ".concat(i));for(var o=0,c=s;o<c.length;o++){var h=c[o],f=e[h];this.ignoreUndefined&&f===void 0||(this.encodeString(h),this.doEncode(f,t+1))}},n.prototype.encodeExtension=function(e){var t=e.data.length;if(t===1)this.writeU8(212);else if(t===2)this.writeU8(213);else if(t===4)this.writeU8(214);else if(t===8)this.writeU8(215);else if(t===16)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else if(t<4294967296)this.writeU8(201),this.writeU32(t);else throw new Error("Too large extension object: ".concat(t));this.writeI8(e.type),this.writeU8a(e.data)},n.prototype.writeU8=function(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++},n.prototype.writeU8a=function(e){var t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t},n.prototype.writeI8=function(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++},n.prototype.writeU16=function(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2},n.prototype.writeI16=function(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2},n.prototype.writeU32=function(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4},n.prototype.writeI32=function(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4},n.prototype.writeF32=function(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4},n.prototype.writeF64=function(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8},n.prototype.writeU64=function(e){this.ensureBufferSizeToWrite(8),_ie(this.view,this.pos,e),this.pos+=8},n.prototype.writeI64=function(e){this.ensureBufferSizeToWrite(8),OA(this.view,this.pos,e),this.pos+=8},n}(),uae={};function cae(n,e){e===void 0&&(e=uae);var t=new lae(e.extensionCodec,e.context,e.maxDepth,e.initialBufferSize,e.sortKeys,e.forceFloat32,e.ignoreUndefined,e.forceIntegerToFloat);return t.encodeSharedRef(n)}function Hb(n){return"".concat(n<0?"-":"","0x").concat(Math.abs(n).toString(16).padStart(2,"0"))}var hae=16,dae=16,fae=function(){function n(e,t){e===void 0&&(e=hae),t===void 0&&(t=dae),this.maxKeyLength=e,this.maxLengthPerKey=t,this.hit=0,this.miss=0,this.caches=[];for(var s=0;s<this.maxKeyLength;s++)this.caches.push([])}return n.prototype.canBeCached=function(e){return e>0&&e<=this.maxKeyLength},n.prototype.find=function(e,t,s){var i=this.caches[s-1];e:for(var o=0,c=i;o<c.length;o++){for(var h=c[o],f=h.bytes,g=0;g<s;g++)if(f[g]!==e[t+g])continue e;return h.str}return null},n.prototype.store=function(e,t){var s=this.caches[e.length-1],i={bytes:e,str:t};s.length>=this.maxLengthPerKey?s[Math.random()*s.length|0]=i:s.push(i)},n.prototype.decode=function(e,t,s){var i=this.find(e,t,s);if(i!=null)return this.hit++,i;this.miss++;var o=GA(e,t,s),c=Uint8Array.prototype.slice.call(e,t,t+s);return this.store(c,o),o},n}(),pae=function(n,e,t,s){function i(o){return o instanceof t?o:new t(function(c){c(o)})}return new(t||(t=Promise))(function(o,c){function h(y){try{g(s.next(y))}catch(I){c(I)}}function f(y){try{g(s.throw(y))}catch(I){c(I)}}function g(y){y.done?o(y.value):i(y.value).then(h,f)}g((s=s.apply(n,[])).next())})},jb=function(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},s,i,o,c;return c={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function h(g){return function(y){return f([g,y])}}function f(g){if(s)throw new TypeError("Generator is already executing.");for(;t;)try{if(s=1,i&&(o=g[0]&2?i.return:g[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,g[1])).done)return o;switch(i=0,o&&(g=[g[0]&2,o.value]),g[0]){case 0:case 1:o=g;break;case 4:return t.label++,{value:g[1],done:!1};case 5:t.label++,i=g[1],g=[0];continue;case 7:g=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){t=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){t.label=g[1];break}if(g[0]===6&&t.label<o[1]){t.label=o[1],o=g;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(g);break}o[2]&&t.ops.pop(),t.trys.pop();continue}g=e.call(n,t)}catch(y){g=[6,y],i=0}finally{s=o=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},VA=function(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof __values=="function"?__values(n):n[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(o){t[o]=n[o]&&function(c){return new Promise(function(h,f){c=n[o](c),i(h,f,c.done,c.value)})}}function i(o,c,h,f){Promise.resolve(f).then(function(g){o({value:g,done:h})},c)}},Cd=function(n){return this instanceof Cd?(this.v=n,this):new Cd(n)},mae=function(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=t.apply(n,e||[]),i,o=[];return i={},c("next"),c("throw"),c("return"),i[Symbol.asyncIterator]=function(){return this},i;function c(C){s[C]&&(i[C]=function(k){return new Promise(function(N,R){o.push([C,k,N,R])>1||h(C,k)})})}function h(C,k){try{f(s[C](k))}catch(N){I(o[0][3],N)}}function f(C){C.value instanceof Cd?Promise.resolve(C.value.v).then(g,y):I(o[0][2],C)}function g(C){h("next",C)}function y(C){h("throw",C)}function I(C,k){C(k),o.shift(),o.length&&h(o[0][0],o[0][1])}},gae=function(n){var e=typeof n;return e==="string"||e==="number"},fp=-1,Yb=new DataView(new ArrayBuffer(0)),xae=new Uint8Array(Yb.buffer),Qb=function(){try{Yb.getInt8(0)}catch(n){return n.constructor}throw new Error("never reached")}(),BA=new Qb("Insufficient data"),yae=new fae,bae=function(){function n(e,t,s,i,o,c,h,f){e===void 0&&(e=_A.defaultCodec),t===void 0&&(t=void 0),s===void 0&&(s=Jc),i===void 0&&(i=Jc),o===void 0&&(o=Jc),c===void 0&&(c=Jc),h===void 0&&(h=Jc),f===void 0&&(f=yae),this.extensionCodec=e,this.context=t,this.maxStrLength=s,this.maxBinLength=i,this.maxArrayLength=o,this.maxMapLength=c,this.maxExtLength=h,this.keyDecoder=f,this.totalPos=0,this.pos=0,this.view=Yb,this.bytes=xae,this.headByte=fp,this.stack=[]}return n.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=fp,this.stack.length=0},n.prototype.setBuffer=function(e){this.bytes=U1(e),this.view=iae(this.bytes),this.pos=0},n.prototype.appendBuffer=function(e){if(this.headByte===fp&&!this.hasRemaining(1))this.setBuffer(e);else{var t=this.bytes.subarray(this.pos),s=U1(e),i=new Uint8Array(t.length+s.length);i.set(t),i.set(s,t.length),this.setBuffer(i)}},n.prototype.hasRemaining=function(e){return this.view.byteLength-this.pos>=e},n.prototype.createExtraByteError=function(e){var t=this,s=t.view,i=t.pos;return new RangeError("Extra ".concat(s.byteLength-i," of ").concat(s.byteLength," byte(s) found at buffer[").concat(e,"]"))},n.prototype.decode=function(e){this.reinitializeState(),this.setBuffer(e);var t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t},n.prototype.decodeMulti=function(e){return jb(this,function(t){switch(t.label){case 0:this.reinitializeState(),this.setBuffer(e),t.label=1;case 1:return this.hasRemaining(1)?[4,this.doDecodeSync()]:[3,3];case 2:return t.sent(),[3,1];case 3:return[2]}})},n.prototype.decodeAsync=function(e){var t,s,i,o;return pae(this,void 0,void 0,function(){var c,h,f,g,y,I,C,k;return jb(this,function(N){switch(N.label){case 0:c=!1,N.label=1;case 1:N.trys.push([1,6,7,12]),t=VA(e),N.label=2;case 2:return[4,t.next()];case 3:if(s=N.sent(),!!s.done)return[3,5];if(f=s.value,c)throw this.createExtraByteError(this.totalPos);this.appendBuffer(f);try{h=this.doDecodeSync(),c=!0}catch(R){if(!(R instanceof Qb))throw R}this.totalPos+=this.pos,N.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return g=N.sent(),i={error:g},[3,12];case 7:return N.trys.push([7,,10,11]),s&&!s.done&&(o=t.return)?[4,o.call(t)]:[3,9];case 8:N.sent(),N.label=9;case 9:return[3,11];case 10:if(i)throw i.error;return[7];case 11:return[7];case 12:if(c){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,h]}throw y=this,I=y.headByte,C=y.pos,k=y.totalPos,new RangeError("Insufficient data in parsing ".concat(Hb(I)," at ").concat(k," (").concat(C," in the current buffer)"))}})})},n.prototype.decodeArrayStream=function(e){return this.decodeMultiAsync(e,!0)},n.prototype.decodeStream=function(e){return this.decodeMultiAsync(e,!1)},n.prototype.decodeMultiAsync=function(e,t){return mae(this,arguments,function(){var s,i,o,c,h,f,g,y,I;return jb(this,function(C){switch(C.label){case 0:s=t,i=-1,C.label=1;case 1:C.trys.push([1,13,14,19]),o=VA(e),C.label=2;case 2:return[4,Cd(o.next())];case 3:if(c=C.sent(),!!c.done)return[3,12];if(h=c.value,t&&i===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(h),s&&(i=this.readArraySize(),s=!1,this.complete()),C.label=4;case 4:C.trys.push([4,9,,10]),C.label=5;case 5:return[4,Cd(this.doDecodeSync())];case 6:return[4,C.sent()];case 7:return C.sent(),--i===0?[3,8]:[3,5];case 8:return[3,10];case 9:if(f=C.sent(),!(f instanceof Qb))throw f;return[3,10];case 10:this.totalPos+=this.pos,C.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return g=C.sent(),y={error:g},[3,19];case 14:return C.trys.push([14,,17,18]),c&&!c.done&&(I=o.return)?[4,Cd(I.call(o))]:[3,16];case 15:C.sent(),C.label=16;case 16:return[3,18];case 17:if(y)throw y.error;return[7];case 18:return[7];case 19:return[2]}})})},n.prototype.doDecodeSync=function(){e:for(;;){var e=this.readHeadByte(),t=void 0;if(e>=224)t=e-256;else if(e<192)if(e<128)t=e;else if(e<144){var s=e-128;if(s!==0){this.pushMapState(s),this.complete();continue e}else t={}}else if(e<160){var s=e-144;if(s!==0){this.pushArrayState(s),this.complete();continue e}else t=[]}else{var i=e-160;t=this.decodeUtf8String(i,0)}else if(e===192)t=null;else if(e===194)t=!1;else if(e===195)t=!0;else if(e===202)t=this.readF32();else if(e===203)t=this.readF64();else if(e===204)t=this.readU8();else if(e===205)t=this.readU16();else if(e===206)t=this.readU32();else if(e===207)t=this.readU64();else if(e===208)t=this.readI8();else if(e===209)t=this.readI16();else if(e===210)t=this.readI32();else if(e===211)t=this.readI64();else if(e===217){var i=this.lookU8();t=this.decodeUtf8String(i,1)}else if(e===218){var i=this.lookU16();t=this.decodeUtf8String(i,2)}else if(e===219){var i=this.lookU32();t=this.decodeUtf8String(i,4)}else if(e===220){var s=this.readU16();if(s!==0){this.pushArrayState(s),this.complete();continue e}else t=[]}else if(e===221){var s=this.readU32();if(s!==0){this.pushArrayState(s),this.complete();continue e}else t=[]}else if(e===222){var s=this.readU16();if(s!==0){this.pushMapState(s),this.complete();continue e}else t={}}else if(e===223){var s=this.readU32();if(s!==0){this.pushMapState(s),this.complete();continue e}else t={}}else if(e===196){var s=this.lookU8();t=this.decodeBinary(s,1)}else if(e===197){var s=this.lookU16();t=this.decodeBinary(s,2)}else if(e===198){var s=this.lookU32();t=this.decodeBinary(s,4)}else if(e===212)t=this.decodeExtension(1,0);else if(e===213)t=this.decodeExtension(2,0);else if(e===214)t=this.decodeExtension(4,0);else if(e===215)t=this.decodeExtension(8,0);else if(e===216)t=this.decodeExtension(16,0);else if(e===199){var s=this.lookU8();t=this.decodeExtension(s,1)}else if(e===200){var s=this.lookU16();t=this.decodeExtension(s,2)}else if(e===201){var s=this.lookU32();t=this.decodeExtension(s,4)}else throw new vo("Unrecognized type byte: ".concat(Hb(e)));this.complete();for(var o=this.stack;o.length>0;){var c=o[o.length-1];if(c.type===0)if(c.array[c.position]=t,c.position++,c.position===c.size)o.pop(),t=c.array;else continue e;else if(c.type===1){if(!gae(t))throw new vo("The type of key must be string or number but "+typeof t);if(t==="__proto__")throw new vo("The key __proto__ is not allowed");c.key=t,c.type=2;continue e}else if(c.map[c.key]=t,c.readCount++,c.readCount===c.size)o.pop(),t=c.map;else{c.key=null,c.type=1;continue e}}return t}},n.prototype.readHeadByte=function(){return this.headByte===fp&&(this.headByte=this.readU8()),this.headByte},n.prototype.complete=function(){this.headByte=fp},n.prototype.readArraySize=function(){var e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new vo("Unrecognized array type byte: ".concat(Hb(e)))}}},n.prototype.pushMapState=function(e){if(e>this.maxMapLength)throw new vo("Max length exceeded: map length (".concat(e,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:1,size:e,key:null,readCount:0,map:{}})},n.prototype.pushArrayState=function(e){if(e>this.maxArrayLength)throw new vo("Max length exceeded: array length (".concat(e,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:0,size:e,array:new Array(e),position:0})},n.prototype.decodeUtf8String=function(e,t){var s;if(e>this.maxStrLength)throw new vo("Max length exceeded: UTF-8 byte length (".concat(e,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+t+e)throw BA;var i=this.pos+t,o;return this.stateIsMapKey()&&!((s=this.keyDecoder)===null||s===void 0)&&s.canBeCached(e)?o=this.keyDecoder.decode(this.bytes,i,e):e>Uie?o=Hie(this.bytes,i,e):o=GA(this.bytes,i,e),this.pos+=t+e,o},n.prototype.stateIsMapKey=function(){if(this.stack.length>0){var e=this.stack[this.stack.length-1];return e.type===1}return!1},n.prototype.decodeBinary=function(e,t){if(e>this.maxBinLength)throw new vo("Max length exceeded: bin length (".concat(e,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining(e+t))throw BA;var s=this.pos+t,i=this.bytes.subarray(s,s+e);return this.pos+=t+e,i},n.prototype.decodeExtension=function(e,t){if(e>this.maxExtLength)throw new vo("Max length exceeded: ext length (".concat(e,") > maxExtLength (").concat(this.maxExtLength,")"));var s=this.view.getInt8(this.pos+t),i=this.decodeBinary(e,t+1);return this.extensionCodec.decode(i,s,this.context)},n.prototype.lookU8=function(){return this.view.getUint8(this.pos)},n.prototype.lookU16=function(){return this.view.getUint16(this.pos)},n.prototype.lookU32=function(){return this.view.getUint32(this.pos)},n.prototype.readU8=function(){var e=this.view.getUint8(this.pos);return this.pos++,e},n.prototype.readI8=function(){var e=this.view.getInt8(this.pos);return this.pos++,e},n.prototype.readU16=function(){var e=this.view.getUint16(this.pos);return this.pos+=2,e},n.prototype.readI16=function(){var e=this.view.getInt16(this.pos);return this.pos+=2,e},n.prototype.readU32=function(){var e=this.view.getUint32(this.pos);return this.pos+=4,e},n.prototype.readI32=function(){var e=this.view.getInt32(this.pos);return this.pos+=4,e},n.prototype.readU64=function(){var e=Vie(this.view,this.pos);return this.pos+=8,e},n.prototype.readI64=function(){var e=PA(this.view,this.pos);return this.pos+=8,e},n.prototype.readF32=function(){var e=this.view.getFloat32(this.pos);return this.pos+=4,e},n.prototype.readF64=function(){var e=this.view.getFloat64(this.pos);return this.pos+=8,e},n}(),wae={};function vae(n,e){e===void 0&&(e=wae);var t=new bae(e.extensionCodec,e.context,e.maxStrLength,e.maxBinLength,e.maxArrayLength,e.maxMapLength,e.maxExtLength);return t.decode(n)}const WA=2;class Iae{constructor(){this.data=null}compileImageTargets(e,t){return new Promise(async(s,i)=>{const o=[];for(let g=0;g<e.length;g++){const y=e[g],I=this.createProcessCanvas(y).getContext("2d");I.drawImage(y,0,0,y.width,y.height);const C=I.getImageData(0,0,y.width,y.height),k=new Uint8Array(y.width*y.height);for(let R=0;R<k.length;R++){const P=R*4;k[R]=Math.floor((C.data[P]+C.data[P+1]+C.data[P+2])/3)}const N={data:k,height:y.height,width:y.width};o.push(N)}const c=50/o.length;let h=0;this.data=[];for(let g=0;g<o.length;g++){const y=o[g],I=Aie(y),C=c/I.length,k=await Cae(I,()=>{h+=C,t(h)});this.data.push({targetImage:y,imageList:I,matchingData:k})}for(let g=0;g<o.length;g++){const y=Rie(o[g]);this.data[g].trackingImageList=y}const f=await this.compileTrack({progressCallback:t,targetImages:o,basePercent:50});for(let g=0;g<o.length;g++)this.data[g].trackingData=f[g];s(this.data)})}exportData(){const e=[];for(let t=0;t<this.data.length;t++)e.push({targetImage:{width:this.data[t].targetImage.width,height:this.data[t].targetImage.height},trackingData:this.data[t].trackingData,matchingData:this.data[t].matchingData});return cae({v:WA,dataList:e})}importData(e){const t=vae(new Uint8Array(e));if(!t.v||t.v!==WA)return console.error("Your compiled .mind might be outdated. Please recompile"),[];const{dataList:s}=t;this.data=[];for(let i=0;i<s.length;i++)this.data.push({targetImage:s[i].targetImage,trackingData:s[i].trackingData,matchingData:s[i].matchingData});return this.data}createProcessCanvas(e){console.warn("missing createProcessCanvas implementation")}compileTrack({progressCallback:e,targetImages:t,basePercent:s}){console.warn("missing compileTrack implementation")}}const Cae=async(n,e)=>{const t=[];for(let s=0;s<n.length;s++){const i=n[s],o=new RA(i.width,i.height);await Z0(),ye(()=>{const c=Ii(i.data,[i.data.length],"float32").reshape([i.height,i.width]),{featurePoints:h}=o.detect(c),f=h.filter(C=>C.maxima),g=h.filter(C=>!C.maxima),y=LA({points:f}),I=LA({points:g});t.push({maximaPoints:f,minimaPoints:g,maximaPointsCluster:y,minimaPointsCluster:I,width:i.width,height:i.height,scale:i.scale}),e(s)})}return t},zA="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NsYXNzIHp7Y29uc3RydWN0b3Iocyx0LG8pe3RoaXMuY3Vtc3VtPVtdO2ZvcihsZXQgZT0wO2U8bztlKyspe3RoaXMuY3Vtc3VtLnB1c2goW10pO2ZvcihsZXQgbj0wO248dDtuKyspdGhpcy5jdW1zdW1bZV0ucHVzaCgwKX10aGlzLmN1bXN1bVswXVswXT1zWzBdO2ZvcihsZXQgZT0xO2U8dDtlKyspdGhpcy5jdW1zdW1bMF1bZV09dGhpcy5jdW1zdW1bMF1bZS0xXStzW2VdO2ZvcihsZXQgZT0xO2U8bztlKyspdGhpcy5jdW1zdW1bZV1bMF09dGhpcy5jdW1zdW1bZS0xXVswXStzW2UqdF07Zm9yKGxldCBlPTE7ZTxvO2UrKylmb3IobGV0IG49MTtuPHQ7bisrKXRoaXMuY3Vtc3VtW2VdW25dPXNbZSp0K25dK3RoaXMuY3Vtc3VtW2UtMV1bbl0rdGhpcy5jdW1zdW1bZV1bbi0xXS10aGlzLmN1bXN1bVtlLTFdW24tMV19cXVlcnkocyx0LG8sZSl7bGV0IG49dGhpcy5jdW1zdW1bZV1bb107cmV0dXJuIHQ+MCYmKG4tPXRoaXMuY3Vtc3VtW3QtMV1bb10pLHM+MCYmKG4tPXRoaXMuY3Vtc3VtW2VdW3MtMV0pLHM+MCYmdD4wJiYobis9dGhpcy5jdW1zdW1bdC0xXVtzLTFdKSxufX1jb25zdCBDPTEwLGI9MixNPTYsRj01LEk9Ljk1LEw9LjksTz0uMixaPTgsTj0yNCoyLzMsVT1yPT57Y29uc3R7ZGF0YTpzLHdpZHRoOnQsaGVpZ2h0Om8sc2NhbGU6ZX09cixuPVt0Km9dO2ZvcihsZXQgaT0wO2k8bi5sZW5ndGg7aSsrKW5baV09ITE7Y29uc3QgYT1uZXcgRmxvYXQzMkFycmF5KHMubGVuZ3RoKTtmb3IobGV0IGk9MDtpPHQ7aSsrKWFbaV09LTEsYVt0KihvLTEpK2ldPS0xO2ZvcihsZXQgaT0wO2k8bztpKyspYVtpKnRdPS0xLGFbaSp0K3QtMV09LTE7Zm9yKGxldCBpPTE7aTx0LTE7aSsrKWZvcihsZXQgcD0xO3A8by0xO3ArKyl7bGV0IGY9aSt0KnAsaD0wLGM9MDtmb3IobGV0IHU9LTE7dTw9MTt1KyspaCs9c1tmK3QqdSsxXS1zW2YrdCp1LTFdLGMrPXNbZit0K3VdLXNbZi10K3VdO2gvPTMqMjU2LGMvPTMqMjU2LGFbZl09TWF0aC5zcXJ0KChoKmgrYypjKS8yKX1jb25zdCBnPW5ldyBVaW50MzJBcnJheSgxZTMpO2ZvcihsZXQgaT0wO2k8MWUzO2krKylnW2ldPTA7Y29uc3QgZD1bLTEsMSwtdCx0XTtmb3IobGV0IGk9MTtpPHQtMTtpKyspZm9yKGxldCBwPTE7cDxvLTE7cCsrKXtsZXQgZj1pK3QqcCxoPSEwO2ZvcihsZXQgYz0wO2M8ZC5sZW5ndGg7YysrKWlmKGFbZl08PWFbZitkW2NdXSl7aD0hMTticmVha31pZihoKXtsZXQgYz1NYXRoLmZsb29yKGFbZl0qMWUzKTtjPjk5OSYmKGM9OTk5KSxjPDAmJihjPTApLGdbY10rPTEsbltmXT0hMH19Y29uc3Qgdz0uMDIqdCpvO2xldCBqPTk5OSxFPTA7Zm9yKDtqPj0wJiYoRSs9Z1tqXSwhKEU+dykpOylqLS07Zm9yKGxldCBpPTA7aTxuLmxlbmd0aDtpKyspbltpXSYmYVtpXSoxZTM8aiYmKG5baV09ITEpO2NvbnN0IGw9W107Zm9yKGxldCBpPTA7aTxzLmxlbmd0aDtpKyspbFtpXT1zW2ldKnNbaV07Y29uc3QgUz1uZXcgeihzLHQsbyksRD1uZXcgeihsLHQsbyksaz1uZXcgRmxvYXQzMkFycmF5KHMubGVuZ3RoKTtmb3IobGV0IGk9MDtpPHQ7aSsrKWZvcihsZXQgcD0wO3A8bztwKyspe2NvbnN0IGY9cCp0K2k7aWYoIW5bZl0pe2tbZl09MTtjb250aW51ZX1jb25zdCBoPVAoe2ltYWdlOnIsY3g6aSxjeTpwLHNkVGhyZXNoOkYsaW1hZ2VEYXRhQ3Vtc3VtOlMsaW1hZ2VEYXRhU3FyQ3Vtc3VtOkR9KTtpZihoPT09bnVsbCl7a1tmXT0xO2NvbnRpbnVlfWxldCBjPS0xO2ZvcihsZXQgdT0tQzt1PD1DO3UrKyl7Zm9yKGxldCBtPS1DO208PUM7bSsrKXtpZihtKm0rdSp1PD1iKmIpY29udGludWU7Y29uc3QgeD1SKHtpbWFnZTpyLGN4OmkrbSxjeTpwK3UsdmxlbjpoLHR4OmksdHk6cCxpbWFnZURhdGFDdW1zdW06UyxpbWFnZURhdGFTcXJDdW1zdW06RH0pO2lmKHghPT1udWxsJiZ4PmMmJihjPXgsYz5JKSlicmVha31pZihjPkkpYnJlYWt9a1tmXT1jfXJldHVybiBWKHtpbWFnZTpyLGZlYXR1cmVNYXA6ayx0ZW1wbGF0ZVNpemU6TSxzZWFyY2hTaXplOmIsb2NjU2l6ZTpOLG1heFNpbVRocmVzaDpMLG1pblNpbVRocmVzaDpPLHNkVGhyZXNoOlosaW1hZ2VEYXRhQ3Vtc3VtOlMsaW1hZ2VEYXRhU3FyQ3Vtc3VtOkR9KX0sVj1yPT57bGV0e2ltYWdlOnMsZmVhdHVyZU1hcDp0LHRlbXBsYXRlU2l6ZTpvLHNlYXJjaFNpemU6ZSxvY2NTaXplOm4sbWF4U2ltVGhyZXNoOmEsbWluU2ltVGhyZXNoOmcsc2RUaHJlc2g6ZCxpbWFnZURhdGFDdW1zdW06dyxpbWFnZURhdGFTcXJDdW1zdW06an09cjtjb25zdHtkYXRhOkUsd2lkdGg6bCxoZWlnaHQ6UyxzY2FsZTpEfT1zO249TWF0aC5mbG9vcihNYXRoLm1pbihzLndpZHRoLHMuaGVpZ2h0KS8xMCk7Y29uc3Qgaz0obyoyKzEpKjMsQT1NYXRoLmZsb29yKGwvayksaT1NYXRoLmZsb29yKFMvayk7bGV0IHA9TWF0aC5mbG9vcihsL24pKk1hdGguZmxvb3IoUy9uKStBKmk7Y29uc3QgZj1bXSxoPW5ldyBGbG9hdDMyQXJyYXkoRS5sZW5ndGgpO2ZvcihsZXQgdT0wO3U8aC5sZW5ndGg7dSsrKWhbdV09dFt1XTtsZXQgYz0wO2Zvcig7YzxwOyl7bGV0IHU9YSxtPS0xLHg9LTE7Zm9yKGxldCB5PTA7eTxTO3krKylmb3IobGV0IFQ9MDtUPGw7VCsrKWhbeSpsK1RdPHUmJih1PWhbeSpsK1RdLG09VCx4PXkpO2lmKG09PT0tMSlicmVhaztjb25zdCB2PVAoe2ltYWdlOnMsY3g6bSxjeTp4LHNkVGhyZXNoOjAsaW1hZ2VEYXRhQ3Vtc3VtOncsaW1hZ2VEYXRhU3FyQ3Vtc3VtOmp9KTtpZih2PT09bnVsbCl7aFt4KmwrbV09MTtjb250aW51ZX1pZih2LyhvKjIrMSk8ZCl7aFt4KmwrbV09MTtjb250aW51ZX1sZXQgcT0xLF89LTE7Zm9yKGxldCB5PS1lO3k8PWU7eSsrKXtmb3IobGV0IFQ9LWU7VDw9ZTtUKyspe2lmKFQqVCt5Knk+ZSplfHxUPT09MCYmeT09PTApY29udGludWU7Y29uc3QgSD1SKHtpbWFnZTpzLHZsZW46dixjeDptK1QsY3k6eCt5LHR4Om0sdHk6eCxpbWFnZURhdGFDdW1zdW06dyxpbWFnZURhdGFTcXJDdW1zdW06an0pO2lmKEghPT1udWxsJiYoSDxxJiYocT1ILHE8ZyYmcTx1KXx8SD5fJiYoXz1ILF8+Ljk5KSkpYnJlYWt9aWYocTxnJiZxPHV8fF8+Ljk5KWJyZWFrfWlmKHE8ZyYmcTx1fHxfPi45OSl7aFt4KmwrbV09MTtjb250aW51ZX1mLnB1c2goe3g6bSx5Onh9KSxjKz0xO2ZvcihsZXQgeT0tbjt5PD1uO3krKylmb3IobGV0IFQ9LW47VDw9bjtUKyspeCt5PDB8fHgreT49U3x8bStUPDB8fG0rVD49bHx8KGhbKHgreSkqbCsobStUKV09MSl9cmV0dXJuIGZ9LFA9KHtpbWFnZTpyLGN4OnMsY3k6dCxzZFRocmVzaDpvLGltYWdlRGF0YUN1bXN1bTplLGltYWdlRGF0YVNxckN1bXN1bTpufSk9PntpZihzLU08MHx8cytNPj1yLndpZHRofHx0LU08MHx8dCtNPj1yLmhlaWdodClyZXR1cm4gbnVsbDtjb25zdCBhPTIqTSsxLGc9YSphO2xldCBkPWUucXVlcnkocy1NLHQtTSxzK00sdCtNKTtkLz1nO2xldCB3PW4ucXVlcnkocy1NLHQtTSxzK00sdCtNKTtyZXR1cm4gdy09MipkKmUucXVlcnkocy1NLHQtTSxzK00sdCtNKSx3Kz1nKmQqZCx3L2c8bypvP251bGw6KHc9TWF0aC5zcXJ0KHcpLHcpfSxSPXI9Pntjb25zdHtpbWFnZTpzLGN4OnQsY3k6byx2bGVuOmUsdHg6bix0eTphLGltYWdlRGF0YUN1bXN1bTpnLGltYWdlRGF0YVNxckN1bXN1bTpkfT1yLHtkYXRhOncsd2lkdGg6aixoZWlnaHQ6RX09cyxsPU07aWYodC1sPDB8fHQrbD49anx8by1sPDB8fG8rbD49RSlyZXR1cm4gbnVsbDtjb25zdCBTPTIqbCsxO2xldCBEPWcucXVlcnkodC1sLG8tbCx0K2wsbytsKSxrPWQucXVlcnkodC1sLG8tbCx0K2wsbytsKSxBPTAsaT0oby1sKSpqKyh0LWwpLHA9KGEtbCkqaisobi1sKSxmPWotUztmb3IobGV0IG09MDttPFM7bSsrKXtmb3IobGV0IHg9MDt4PFM7eCsrKUErPXdbaV0qd1twXSxpKz0xLHArPTE7aSs9ZixwKz1mfWxldCBoPWcucXVlcnkobi1sLGEtbCxuK2wsYStsKTtoLz1TKlMsQS09aCpEO2xldCBjPWstRCpELyhTKlMpO3JldHVybiBjPT0wP251bGw6KGM9TWF0aC5zcXJ0KGMpLDEqQS8oZSpjKSl9LFc9KHIscyk9Pntjb25zdCB0PVtdO2ZvcihsZXQgbz0wO288ci5sZW5ndGg7bysrKXtjb25zdCBlPXJbb10sbj1VKGUpLGE9e2RhdGE6ZS5kYXRhLHNjYWxlOmUuc2NhbGUsd2lkdGg6ZS53aWR0aCxoZWlnaHQ6ZS5oZWlnaHQscG9pbnRzOm59O3QucHVzaChhKSxzKG8pfXJldHVybiB0fSxYPSh7aW1hZ2U6cixyYXRpbzpzfSk9Pntjb25zdCB0PU1hdGgucm91bmQoci53aWR0aCpzKSxvPU1hdGgucm91bmQoci5oZWlnaHQqcyksZT1uZXcgVWludDhBcnJheSh0Km8pO2ZvcihsZXQgbj0wO248dDtuKyspe2xldCBhPU1hdGgucm91bmQoMSpuL3MpLGc9TWF0aC5yb3VuZCgxKihuKzEpL3MpLTE7Zz49ci53aWR0aCYmKGc9ci53aWR0aC0xKTtmb3IobGV0IGQ9MDtkPG87ZCsrKXtsZXQgdz1NYXRoLnJvdW5kKDEqZC9zKSxqPU1hdGgucm91bmQoMSooZCsxKS9zKS0xO2o+PXIuaGVpZ2h0JiYoaj1yLmhlaWdodC0xKTtsZXQgRT0wLGw9MDtmb3IobGV0IFM9YTtTPD1nO1MrKylmb3IobGV0IEQ9dztEPD1qO0QrKylFKz0xKnIuZGF0YVtEKnIud2lkdGgrU10sbCs9MTtlW2QqdCtuXT1NYXRoLmZsb29yKEUvbCl9fXJldHVybntkYXRhOmUsd2lkdGg6dCxoZWlnaHQ6b319LFk9cj0+e2NvbnN0IHM9TWF0aC5taW4oci53aWR0aCxyLmhlaWdodCksdD1bXSxvPVtdO3QucHVzaCgyNTYvcyksdC5wdXNoKDEyOC9zKTtmb3IobGV0IGU9MDtlPHQubGVuZ3RoO2UrKylvLnB1c2goT2JqZWN0LmFzc2lnbihYKHtpbWFnZTpyLHJhdGlvOnRbZV19KSx7c2NhbGU6dFtlXX0pKTtyZXR1cm4gb307b25tZXNzYWdlPXI9Pntjb25zdHtkYXRhOnN9PXI7aWYocy50eXBlPT09ImNvbXBpbGUiKXtjb25zdHt0YXJnZXRJbWFnZXM6dH09cyxvPTEwMC90Lmxlbmd0aDtsZXQgZT0wO2NvbnN0IG49W107Zm9yKGxldCBhPTA7YTx0Lmxlbmd0aDthKyspe2NvbnN0IGc9dFthXSxkPVkoZyksdz1vL2QubGVuZ3RoLGo9VyhkLEU9PntlKz13LHBvc3RNZXNzYWdlKHt0eXBlOiJwcm9ncmVzcyIscGVyY2VudDplfSl9KTtuLnB1c2goail9cG9zdE1lc3NhZ2Uoe3R5cGU6ImNvbXBpbGVEb25lIixsaXN0Om59KX19fSkoKTsK",XA=typeof window<"u"&&window.Blob&&new Blob([atob(zA)],{type:"text/javascript;charset=utf-8"});function Sae(n){let e;try{if(e=XA&&(window.URL||window.webkitURL).createObjectURL(XA),!e)throw"";const t=new Worker(e,{name:n==null?void 0:n.name});return t.addEventListener("error",()=>{(window.URL||window.webkitURL).revokeObjectURL(e)}),t}catch{return new Worker("data:application/javascript;base64,"+zA,{name:n==null?void 0:n.name})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}class ZA extends Iae{createProcessCanvas(e){const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t}compileTrack({progressCallback:e,targetImages:t,basePercent:s}){return new Promise((i,o)=>{const c=new Sae;c.onmessage=h=>{h.data.type==="progress"?e(s+h.data.percent*s/100):h.data.type==="compileDone"&&i(h.data.list)},c.postMessage({type:"compile",targetImages:t})})}}class Tae{constructor(e,t){this.width=e,this.height=t,this.texShape=[t,e];const s=document.createElement("canvas").getContext("2d");s.canvas.width=e,s.canvas.height=t,this.context=s,this.program=this.buildProgram(e,t);const i=Ql();this.tempPixelHandle=i.makeTensorInfo(this.texShape,"float32"),i.texData.get(this.tempPixelHandle.dataId).usage=2}_loadInput(e){return ye(()=>{let t=dB(e);return t=t.mean(2),t})}loadInput(e){const t=this.context;if(t.clearRect(0,0,this.context.canvas.width,this.context.canvas.height),e.width===this.height&&e.height===this.width){let i=this.context.canvas.width/2,o=this.context.canvas.height/2;t.save(),t.translate(i,o),t.rotate(90*Math.PI/180),t.drawImage(e,-e.width/2,-e.height/2),t.restore()}else this.context.drawImage(e,0,0,e.width,e.height);const s=Ql();return s.gpgpu.uploadPixelDataToTexture(s.getTexture(this.tempPixelHandle.dataId),this.context.canvas),this._compileAndRun(this.program,[this.tempPixelHandle])}buildProgram(e,t){const s=ke().getNumber("WEBGL_VERSION")===2?"texture":"texture2D";return{variableNames:["A"],outputShape:this.texShape,userCode:`
	void main() {
	  ivec2 coords = getOutputCoords();
	  int texR = coords[0];
	  int texC = coords[1];
	  vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${e}.0, ${t}.0);

	  vec4 values = ${s}(A, uv);
	  setOutput((0.299 * values.r + 0.587 * values.g + 0.114 * values.b) * 255.0);
	}
      `}}_compileAndRun(e,t){const s=Ql().compileAndRun(e,t);return Dn().makeTensorFromDataId(s.dataId,s.shape,s.dtype)}_runWebGLProgram(e,t,s){const i=Ql().runWebGLProgram(e,t,s);return Dn().makeTensorFromDataId(i.dataId,i.shape,i.dtype)}}const KA=(n,e)=>{const t=2*Math.PI*e*n;return t/(t+1)},$A=(n,e,t)=>n*e+(1-n)*t;class kae{constructor({minCutOff:e,beta:t}){this.minCutOff=e,this.beta=t,this.dCutOff=.001,this.xPrev=null,this.dxPrev=null,this.tPrev=null,this.initialized=!1}reset(){this.initialized=!1}filter(e,t){if(!this.initialized)return this.initialized=!0,this.xPrev=t,this.dxPrev=t.map(()=>0),this.tPrev=e,t;const{xPrev:s,tPrev:i,dxPrev:o}=this,c=e-i,h=KA(c,this.dCutOff),f=[],g=[],y=[];for(let I=0;I<t.length;I++){f[I]=(t[I]-s[I])/c,g[I]=$A(h,f[I],o[I]);const C=this.minCutOff+this.beta*Math.abs(g[I]),k=KA(c,C);y[I]=$A(k,t[I],s[I])}return this.xPrev=y,this.dxPrev=g,this.tPrev=e,y}}const Jb={memory:tx,nextFrame:Z0},Eae=.001,Nae=1e3,Aae=5,Rae=5;class UA{constructor({inputWidth:e,inputHeight:t,onUpdate:s=null,debugMode:i=!1,maxTrack:o=1,warmupTolerance:c=null,missTolerance:h=null,filterMinCF:f=null,filterBeta:g=null}){this.inputWidth=e,this.inputHeight=t,this.maxTrack=o,this.filterMinCF=f===null?Eae:f,this.filterBeta=g===null?Nae:g,this.warmupTolerance=c===null?Aae:c,this.missTolerance=h===null?Rae:h,this.cropDetector=new Eie(this.inputWidth,this.inputHeight,i),this.inputLoader=new Tae(this.inputWidth,this.inputHeight),this.markerDimensions=null,this.onUpdate=s,this.debugMode=i,this.processingVideo=!1,this.interestedTargetIndex=-1,this.trackingStates=[];const y=10,I=1e5,C=45*Math.PI/180,k=this.inputHeight/2/Math.tan(C/2);this.projectionTransform=[[k,0,this.inputWidth/2],[0,k,this.inputHeight/2],[0,0,1]],this.projectionMatrix=this._glProjectionMatrix({projectionTransform:this.projectionTransform,width:this.inputWidth,height:this.inputHeight,near:y,far:I}),this.worker=new Wse,this.workerMatchDone=null,this.workerTrackDone=null,this.worker.onmessage=N=>{N.data.type==="matchDone"&&this.workerMatchDone!==null&&this.workerMatchDone(N.data),N.data.type==="trackUpdateDone"&&this.workerTrackDone!==null&&this.workerTrackDone(N.data)}}showTFStats(){console.log(Jb.memory().numTensors),console.table(Jb.memory())}addImageTargets(e){return new Promise(async(t,s)=>{const i=await(await fetch(e)).arrayBuffer(),o=this.addImageTargetsFromBuffer(i);t(o)})}addImageTargetsFromBuffer(e){const t=new ZA().importData(e),s=[],i=[],o=[];for(let c=0;c<t.length;c++)i.push(t[c].matchingData),s.push(t[c].trackingData),o.push([t[c].targetImage.width,t[c].targetImage.height]);return this.tracker=new Qse(o,s,this.projectionTransform,this.inputWidth,this.inputHeight,this.debugMode),this.worker.postMessage({type:"setup",inputWidth:this.inputWidth,inputHeight:this.inputHeight,projectionTransform:this.projectionTransform,debugMode:this.debugMode,matchingDataList:i}),this.markerDimensions=o,{dimensions:o,matchingDataList:i,trackingDataList:s}}dispose(){this.stopProcessVideo(),this.worker.postMessage({type:"dispose"})}dummyRun(e){const t=this.inputLoader.loadInput(e);this.cropDetector.detect(t),this.tracker.dummyRun(t),t.dispose()}getProjectionMatrix(){return this.projectionMatrix}getRotatedZ90Matrix(e){return[-e[1],e[0],e[2],e[3],-e[5],e[4],e[6],e[7],-e[9],e[8],e[10],e[11],-e[13],e[12],e[14],e[15]]}getWorldMatrix(e,t){return this._glModelViewMatrix(e,t)}async _detectAndMatch(e,t){const{featurePoints:s}=this.cropDetector.detectMoving(e),{targetIndex:i,modelViewTransform:o}=await this._workerMatch(s,t);return{targetIndex:i,modelViewTransform:o}}async _trackAndUpdate(e,t,s){const{worldCoords:i,screenCoords:o}=this.tracker.track(e,t,s);return i.length<4?null:await this._workerTrackUpdate(t,{worldCoords:i,screenCoords:o})}processVideo(e){if(!this.processingVideo){this.processingVideo=!0,this.trackingStates=[];for(let t=0;t<this.markerDimensions.length;t++)this.trackingStates.push({showing:!1,isTracking:!1,currentModelViewTransform:null,trackCount:0,trackMiss:0,filter:new kae({minCutOff:this.filterMinCF,beta:this.filterBeta})});(async()=>{for(;this.processingVideo;){const t=this.inputLoader.loadInput(e);if(this.trackingStates.reduce((s,i)=>s+(i.isTracking?1:0),0)<this.maxTrack){const s=[];for(let c=0;c<this.trackingStates.length;c++)this.trackingStates[c].isTracking!==!0&&(this.interestedTargetIndex!==-1&&this.interestedTargetIndex!==c||s.push(c));const{targetIndex:i,modelViewTransform:o}=await this._detectAndMatch(t,s);i!==-1&&(this.trackingStates[i].isTracking=!0,this.trackingStates[i].currentModelViewTransform=o)}for(let s=0;s<this.trackingStates.length;s++){const i=this.trackingStates[s];if(i.isTracking){let o=await this._trackAndUpdate(t,i.currentModelViewTransform,s);o===null?i.isTracking=!1:i.currentModelViewTransform=o}if(i.showing||i.isTracking&&(i.trackMiss=0,i.trackCount+=1,i.trackCount>this.warmupTolerance&&(i.showing=!0,i.trackingMatrix=null,i.filter.reset())),i.showing&&(i.isTracking?i.trackMiss=0:(i.trackCount=0,i.trackMiss+=1,i.trackMiss>this.missTolerance&&(i.showing=!1,i.trackingMatrix=null,this.onUpdate&&this.onUpdate({type:"updateMatrix",targetIndex:s,worldMatrix:null})))),i.showing){const o=this._glModelViewMatrix(i.currentModelViewTransform,s);i.trackingMatrix=i.filter.filter(Date.now(),o);let c=[];for(let h=0;h<i.trackingMatrix.length;h++)c[h]=i.trackingMatrix[h];e.width===this.inputHeight&&e.height===this.inputWidth&&(c=this.getRotatedZ90Matrix(c)),this.onUpdate&&this.onUpdate({type:"updateMatrix",targetIndex:s,worldMatrix:c})}}t.dispose(),this.onUpdate&&this.onUpdate({type:"processDone"}),await Jb.nextFrame()}})()}}stopProcessVideo(){this.processingVideo=!1}async detect(e){const t=this.inputLoader.loadInput(e),{featurePoints:s,debugExtra:i}=await this.cropDetector.detect(t);return t.dispose(),{featurePoints:s,debugExtra:i}}async match(e,t){const{modelViewTransform:s,debugExtra:i}=await this._workerMatch(e,[t]);return{modelViewTransform:s,debugExtra:i}}async track(e,t,s){const i=this.inputLoader.loadInput(e),o=this.tracker.track(i,t,s);return i.dispose(),o}async trackUpdate(e,t){return t.worldCoords.length<4?null:await this._workerTrackUpdate(e,t)}_workerMatch(e,t){return new Promise(async(s,i)=>{this.workerMatchDone=o=>{s({targetIndex:o.targetIndex,modelViewTransform:o.modelViewTransform,debugExtra:o.debugExtra})},this.worker.postMessage({type:"match",featurePoints:e,targetIndexes:t})})}_workerTrackUpdate(e,t){return new Promise(async(s,i)=>{this.workerTrackDone=h=>{s(h.modelViewTransform)};const{worldCoords:o,screenCoords:c}=t;this.worker.postMessage({type:"trackUpdate",modelViewTransform:e,worldCoords:o,screenCoords:c})})}_glModelViewMatrix(e,t){const s=this.markerDimensions[t][1];return[e[0][0],-e[1][0],-e[2][0],0,-e[0][1],e[1][1],e[2][1],0,-e[0][2],e[1][2],e[2][2],0,e[0][1]*s+e[0][3],-(e[1][1]*s+e[1][3]),-(e[2][1]*s+e[2][3]),1]}_glProjectionMatrix({projectionTransform:e,width:t,height:s,near:i,far:o}){const c=[[2*e[0][0]/t,0,-(2*e[0][2]/t-1),0],[0,2*e[1][1]/s,-(2*e[1][2]/s-1),0],[0,0,-(o+i)/(o-i),-2*o*i/(o-i)],[0,0,-1,0]],h=[];for(let f=0;f<4;f++)for(let g=0;g<4;g++)h.push(c[g][f]);return h}}const Mae=`<div class="mindar-ui-overlay mindar-ui-loading">
  <div class="loader"/>
</div>
`,Lae=`<div class="mindar-ui-overlay mindar-ui-compatibility">
  <div class="content">
    <h1>Failed to launch :(</h1>
    <p>
      Looks like your device/browser is not compatible.
    </p>

    <br/>
    <br/>
    <p>
      Please try the following recommended browsers:
    </p>
    <p>
      For Android device - Chrome
    </p>
    <p>
      For iOS device - Safari
    </p>
  </div>
</div>
`,Dae=`<div class="mindar-ui-overlay mindar-ui-scanning">
  <div class="scanning">
    <div class="inner">
      <div class="scanline"/>
    </div>
  </div>
</div>
`,Oae=".mindar-ui-overlay{display:flex;align-items:center;justify-content:center;position:absolute;left:0;right:0;top:0;bottom:0;background:transparent;z-index:2}.mindar-ui-overlay.hidden{display:none}.mindar-ui-loading .loader{border:16px solid #222;border-top:16px solid white;opacity:.8;border-radius:50%;width:120px;height:120px;animation:spin 2s linear infinite}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.mindar-ui-compatibility .content{background:black;color:#fff;opacity:.8;text-align:center;margin:20px;padding:20px;min-height:50vh}@media (min-aspect-ratio: 1/1){.mindar-ui-scanning .scanning{width:50vh;height:50vh}}@media (max-aspect-ratio: 1/1){.mindar-ui-scanning .scanning{width:80vw;height:80vw}}.mindar-ui-scanning .scanning .inner{position:relative;width:100%;height:100%;opacity:.8;background:linear-gradient(to right,white 10px,transparent 10px) 0 0,linear-gradient(to right,white 10px,transparent 10px) 0 100%,linear-gradient(to left,white 10px,transparent 10px) 100% 0,linear-gradient(to left,white 10px,transparent 10px) 100% 100%,linear-gradient(to bottom,white 10px,transparent 10px) 0 0,linear-gradient(to bottom,white 10px,transparent 10px) 100% 0,linear-gradient(to top,white 10px,transparent 10px) 0 100%,linear-gradient(to top,white 10px,transparent 10px) 100% 100%;background-repeat:no-repeat;background-size:40px 40px}.mindar-ui-scanning .scanning .inner .scanline{position:absolute;width:100%;height:10px;background:white;animation:move 2s linear infinite}@keyframes move{0%,to{top:0%}50%{top:calc(100% - 10px)}}";class HA{constructor({uiLoading:e,uiScanning:t,uiError:s}){const i=document.createElement("style");i.innerText=Oae,document.head.appendChild(i),e==="yes"?this.loadingModal=this._loadHTML(Mae):e!=="no"&&(this.loadingModal=document.querySelector(e)),s==="yes"?this.compatibilityModal=this._loadHTML(Lae):s!=="no"&&(this.compatibilityModal=document.querySelector(s)),t==="yes"?this.scanningMask=this._loadHTML(Dae):t!=="no"&&(this.scanningMask=document.querySelector(t)),this.hideLoading(),this.hideCompatibility(),this.hideScanning()}showLoading(){this.loadingModal&&this.loadingModal.classList.remove("hidden")}hideLoading(){this.loadingModal&&this.loadingModal.classList.add("hidden")}showCompatibility(){this.compatibilityModal&&this.compatibilityModal.classList.remove("hidden")}hideCompatibility(){this.compatibilityModal&&this.compatibilityModal.classList.add("hidden")}showScanning(){this.scanningMask&&this.scanningMask.classList.remove("hidden")}hideScanning(){this.scanningMask&&this.scanningMask.classList.add("hidden")}_loadHTML(e){const t=document.createElement("template");t.innerHTML=e.trim();const s=t.content.firstChild;return document.getElementsByTagName("body")[0].appendChild(s),s}}window.MINDAR||(window.MINDAR={}),window.MINDAR.IMAGE={Controller:UA,Compiler:ZA,UI:HA},AFRAME.registerSystem("mindar-image-system",{container:null,video:null,processingImage:!1,init:function(){this.anchorEntities=[]},tick:function(){},setup:function({imageTargetSrc:n,maxTrack:e,showStats:t,uiLoading:s,uiScanning:i,uiError:o,missTolerance:c,warmupTolerance:h,filterMinCF:f,filterBeta:g}){this.imageTargetSrc=n,this.maxTrack=e,this.filterMinCF=f,this.filterBeta=g,this.missTolerance=c,this.warmupTolerance=h,this.showStats=t,this.ui=new HA({uiLoading:s,uiScanning:i,uiError:o})},registerAnchor:function(n,e){this.anchorEntities.push({el:n,targetIndex:e})},start:function(){this.container=this.el.sceneEl.parentNode,this.showStats&&(this.mainStats=new Stats,this.mainStats.showPanel(0),this.mainStats.domElement.style.cssText="position:absolute;top:0px;left:0px;z-index:999",this.container.appendChild(this.mainStats.domElement)),this.ui.showLoading(),this._startVideo()},switchTarget:function(n){this.controller.interestedTargetIndex=n},stop:function(){this.pause(),this.video.srcObject.getTracks().forEach(function(n){n.stop()}),this.video.remove(),this.controller.dispose()},pause:function(n=!1){n||this.video.pause(),this.controller.stopProcessVideo()},unpause:function(){this.video.play(),this.controller.processVideo(this.video)},_startVideo:function(){if(this.video=document.createElement("video"),this.video.setAttribute("autoplay",""),this.video.setAttribute("muted",""),this.video.setAttribute("playsinline",""),this.video.style.position="absolute",this.video.style.top="0px",this.video.style.left="0px",this.video.style.zIndex="-2",this.container.appendChild(this.video),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){this.el.emit("arError",{error:"VIDEO_FAIL"}),this.ui.showCompatibility();return}navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}}).then(n=>{this.video.addEventListener("loadedmetadata",()=>{this.video.setAttribute("width",this.video.videoWidth),this.video.setAttribute("height",this.video.videoHeight),this._startAR()}),this.video.srcObject=n}).catch(n=>{console.log("getUserMedia error",n),this.el.emit("arError",{error:"VIDEO_FAIL"})})},_startAR:async function(){const n=this.video;this.container,this.controller=new UA({inputWidth:n.videoWidth,inputHeight:n.videoHeight,maxTrack:this.maxTrack,filterMinCF:this.filterMinCF,filterBeta:this.filterBeta,missTolerance:this.missTolerance,warmupTolerance:this.warmupTolerance,onUpdate:t=>{if(t.type==="processDone")this.mainStats&&this.mainStats.update();else if(t.type==="updateMatrix"){const{targetIndex:s,worldMatrix:i}=t;for(let o=0;o<this.anchorEntities.length;o++)this.anchorEntities[o].targetIndex===s&&this.anchorEntities[o].el.updateWorldMatrix(i);this.anchorEntities.reduce((o,c)=>o||c.el.el.object3D.visible,!1)?this.ui.hideScanning():this.ui.showScanning()}}}),this._resize(),window.addEventListener("resize",this._resize.bind(this));const{dimensions:e}=await this.controller.addImageTargets(this.imageTargetSrc);for(let t=0;t<this.anchorEntities.length;t++){const{el:s,targetIndex:i}=this.anchorEntities[t];i<e.length&&s.setupMarker(e[i])}await this.controller.dummyRun(this.video),this.el.emit("arReady"),this.ui.hideLoading(),this.ui.showScanning(),this.controller.processVideo(this.video)},_resize:function(){const n=this.video,e=this.container;let t,s;const i=n.videoWidth/n.videoHeight,o=e.clientWidth/e.clientHeight;i>o?(s=e.clientHeight,t=s*i):(t=e.clientWidth,s=t/i);const c=this.controller.getProjectionMatrix(),h=2*Math.atan(1/c[5]/s*e.clientHeight)*180/Math.PI,f=c[14]/(c[10]-1),g=c[14]/(c[10]+1);c[5]/c[0];const y=e.clientWidth/e.clientHeight,I=e.getElementsByTagName("a-camera")[0].getObject3D("camera");I.fov=h,I.aspect=y,I.near=f,I.far=g,I.updateProjectionMatrix(),this.video.style.top=-(s-e.clientHeight)/2+"px",this.video.style.left=-(t-e.clientWidth)/2+"px",this.video.style.width=t+"px",this.video.style.height=s+"px"}}),AFRAME.registerComponent("mindar-image",{dependencies:["mindar-image-system"],schema:{imageTargetSrc:{type:"string"},maxTrack:{type:"int",default:1},filterMinCF:{type:"number",default:-1},filterBeta:{type:"number",default:-1},missTolerance:{type:"int",default:-1},warmupTolerance:{type:"int",default:-1},showStats:{type:"boolean",default:!1},autoStart:{type:"boolean",default:!0},uiLoading:{type:"string",default:"yes"},uiScanning:{type:"string",default:"yes"},uiError:{type:"string",default:"yes"}},init:function(){const n=this.el.sceneEl.systems["mindar-image-system"];n.setup({imageTargetSrc:this.data.imageTargetSrc,maxTrack:this.data.maxTrack,filterMinCF:this.data.filterMinCF===-1?null:this.data.filterMinCF,filterBeta:this.data.filterBeta===-1?null:this.data.filterBeta,missTolerance:this.data.missTolerance===-1?null:this.data.missTolerance,warmupTolerance:this.data.warmupTolerance===-1?null:this.data.warmupTolerance,showStats:this.data.showStats,uiLoading:this.data.uiLoading,uiScanning:this.data.uiScanning,uiError:this.data.uiError}),this.data.autoStart&&this.el.sceneEl.addEventListener("renderstart",()=>{n.start()})},remove:function(){this.el.sceneEl.systems["mindar-image-system"].stop()}}),AFRAME.registerComponent("mindar-image-target",{dependencies:["mindar-image-system"],schema:{targetIndex:{type:"number"}},postMatrix:null,init:function(){this.el.sceneEl.systems["mindar-image-system"].registerAnchor(this,this.data.targetIndex),this.invisibleMatrix=new AFRAME.THREE.Matrix4().set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const n=this.el.object3D;n.visible=!1,n.matrixAutoUpdate=!1,n.matrix=this.invisibleMatrix},setupMarker([n,e]){const t=new AFRAME.THREE.Vector3,s=new AFRAME.THREE.Quaternion,i=new AFRAME.THREE.Vector3;t.x=n/2,t.y=n/2+(e-n)/2,i.x=n,i.y=n,i.z=n,this.postMatrix=new AFRAME.THREE.Matrix4,this.postMatrix.compose(t,s,i)},updateWorldMatrix(n){if(this.el.emit("targetUpdate"),!this.el.object3D.visible&&n!==null?this.el.emit("targetFound"):this.el.object3D.visible&&n===null&&this.el.emit("targetLost"),this.el.object3D.visible=n!==null,n===null){this.el.object3D.matrix=this.invisibleMatrix;return}var e=new AFRAME.THREE.Matrix4;e.elements=n,e.multiply(this.postMatrix),this.el.object3D.matrix=e}})})();const yue=({videoUrl:r,targetFile:a})=>{const l=Ge.useRef(null),p=Ge.useRef(null),[x,v]=Ge.useState(!1),[T,M]=Ge.useState(!1),_=Ge.useRef(null),O=Ge.useRef([]),V=Ge.useRef(null);Ge.useEffect(()=>()=>{l.current},[]);const D=()=>{const H=p.current;H&&(H.muted=!1,H.play().then(()=>{H.pause(),H.currentTime=0,v(!0)}).catch(se=>console.error("Start Error:",se)))},$=()=>{const se=l.current.querySelector("canvas.a-canvas"),Ee=document.querySelector("video");if(!se||!Ee)return alert("Kamera topilmadi!");const ee=se.width,Y=se.height,j=document.createElement("canvas");j.width=ee,j.height=Y;const fe=j.getContext("2d");V.current=j;const be=new Image;be.src="/logo.png",be.crossOrigin="Anonymous",M(!0);const Fe=j.captureStream(30);_.current=new MediaRecorder(Fe,{mimeType:"video/webm"}),O.current=[],_.current.ondataavailable=we=>{we.data.size>0&&O.current.push(we.data)},_.current.onstop=()=>{const we=new Blob(O.current,{type:"video/webm"}),Ne=URL.createObjectURL(we),it=document.createElement("a");it.href=Ne,it.download=`Pinhan-Memory-${Date.now()}.webm`,it.click(),M(!1)},_.current.start();const ue=()=>{if(_.current.state!=="inactive"){if(fe.drawImage(Ee,0,0,ee,Y),fe.drawImage(se,0,0,ee,Y),be.complete){const we=ee*.2,Ne=we*(be.naturalHeight/be.naturalWidth||1);fe.drawImage(be,ee-we-20,Y-Ne-20,we,Ne)}requestAnimationFrame(ue)}};ue()},re=()=>{_.current&&_.current.stop()};return xe.jsxs("div",{style:{width:"100%",height:"100%",position:"relative",overflow:"hidden",background:"#000"},children:[xe.jsx("style",{dangerouslySetInnerHTML:{__html:`
                video {
                    position: absolute !important;
                    top: 0 !important;
                    left: 0 !important;
                    width: 100% !important;
                    height: 100% !important;
                    object-fit: cover !important;
                    z-index: -2 !important;
                }
                .a-canvas {
                    z-index: -1 !important;
                }
            `}}),!x&&xe.jsxs("div",{style:qc.overlay,children:[xe.jsx("div",{style:qc.logoContainer,children:xe.jsx("img",{src:"/logo.png",alt:"Logo",style:qc.logo})}),xe.jsxs("button",{onClick:D,style:qc.startButton,children:[xe.jsx("span",{children:"START CAMERA"}),xe.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:[xe.jsx("path",{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}),xe.jsx("circle",{cx:"12",cy:"13",r:"4"})]})]}),xe.jsx("p",{style:qc.instruction,children:"Tayyor bo'lsangiz, tugmani bosing"})]}),x&&xe.jsx("div",{style:qc.recContainer,children:xe.jsx("button",{onClick:T?re:$,style:{...qc.recButton,backgroundColor:T?"#ff4444":"rgba(255,255,255,0.9)",color:T?"#fff":"#000"},children:T?"STOP":"REC"})}),xe.jsxs("a-scene",{ref:l,"mindar-image":`imageTargetSrc: ${a}; uiLoading: no; uiScanning: no; uiError: no; filterMinCF:0.0001; filterBeta: 0.001;`,"color-space":"sRGB",renderer:"colorManagement: true, physicallyCorrectLights: true","vr-mode-ui":"enabled: false","device-orientation-permission-ui":"enabled: false",style:{position:"absolute",top:0,left:0,zIndex:-1},children:[xe.jsx("a-assets",{children:xe.jsx("video",{ref:p,id:"ar-video",src:r,preload:"auto",loop:!0,crossOrigin:"anonymous",playsInline:!0,"webkit-playsinline":"true"})}),xe.jsx("a-camera",{position:"0 0 0","look-controls":"enabled: false"}),xe.jsx("a-entity",{"mindar-image-target":"targetIndex: 0",children:xe.jsx("a-plane",{src:"#ar-video",position:"0 0 0",height:"1",width:"1",rotation:"0 0 0"})})]})]})},qc={overlay:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(10, 10, 10, 0.95)",zIndex:9999,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:"20px",textAlign:"center"},logoContainer:{width:"100%",maxWidth:"280px",marginBottom:"40px"},logo:{width:"80%",height:"auto",borderRadius:"24px",boxShadow:"0 15px 45px rgba(0,0,0,0.6)"},startButton:{padding:"18px 45px",fontSize:"18px",fontWeight:"bold",background:"linear-gradient(135deg, #FFD700 0%, #FFA500 100%)",color:"#000",border:"none",borderRadius:"50px",cursor:"pointer",boxShadow:"0 10px 30px rgba(255, 215, 0, 0.3)",display:"flex",alignItems:"center",gap:"12px",letterSpacing:"1px"},instruction:{marginTop:"25px",color:"rgba(255,255,255,0.6)",fontSize:"14px",fontWeight:"300"},recContainer:{position:"fixed",bottom:"40px",left:"0",width:"100%",display:"flex",justifyContent:"center",zIndex:1e3,pointerEvents:"none"},recButton:{width:"75px",height:"75px",borderRadius:"50%",border:"5px solid #fff",pointerEvents:"auto",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",fontSize:"14px",boxShadow:"0 5px 20px rgba(0,0,0,0.4)",transition:"all 0.2s"}},bue=({stats:r})=>{if(!r)return xe.jsx("div",{className:"stats-grid",children:[1,2,3].map(x=>xe.jsxs("div",{className:"stat-card skeleton",children:[xe.jsx("div",{className:"skeleton-circle",style:{opacity:.2}}),xe.jsxs("div",{className:"stat-info",children:[xe.jsx("div",{className:"skeleton-text",style:{width:"80px",opacity:.2}}),xe.jsx("div",{className:"skeleton-text",style:{width:"40px",opacity:.4}})]})]},x))});const{totalGifts:a,totalScans:l,latestGifts:p}=r;return xe.jsxs("div",{className:"admin-dashboard",children:[xe.jsxs("div",{className:"stats-grid",children:[xe.jsxs("div",{className:"stat-card",children:[xe.jsx("div",{className:"stat-icon",children:""}),xe.jsxs("div",{className:"stat-info",children:[xe.jsx("h4",{children:"Jami Sovg'alar"}),xe.jsx("p",{children:a})]})]}),xe.jsxs("div",{className:"stat-card",children:[xe.jsx("div",{className:"stat-icon",children:""}),xe.jsxs("div",{className:"stat-info",children:[xe.jsx("h4",{children:"Jami Skanerlashlar"}),xe.jsx("p",{children:l})]})]}),xe.jsxs("div",{className:"stat-card",children:[xe.jsx("div",{className:"stat-icon",children:""}),xe.jsxs("div",{className:"stat-info",children:[xe.jsx("h4",{children:"Faollik"}),xe.jsx("p",{children:"Yuqori"})]})]})]}),xe.jsxs("section",{className:"recent-section",children:[xe.jsx("h3",{children:"Oxirgi qo'shilganlar"}),xe.jsx("div",{className:"recent-list",children:p==null?void 0:p.map(x=>xe.jsxs("div",{className:"recent-item",children:[xe.jsxs("div",{className:"recent-info",children:[xe.jsx("strong",{children:x.clientName||"Nomsiz"}),xe.jsx("span",{children:new Date(x.createdAt).toLocaleDateString()})]}),xe.jsxs("div",{className:"recent-scans",children:[x.scanCount||0," skan"]})]},x._id))})]})]})},wue=({gifts:r,onSelect:a,onReset:l,onDelete:p,isLoading:x})=>x?xe.jsx("div",{className:"gifts-grid",children:[1,2,3,4].map(v=>xe.jsx("div",{className:"gift-card skeleton-card skeleton"},v))}):xe.jsx("div",{className:"gifts-grid",children:r.map(v=>xe.jsxs("div",{className:"gift-card",children:[xe.jsxs("div",{className:"gift-card-header",children:[xe.jsx("span",{className:"pin-badge",children:v.pinCode}),xe.jsx("div",{className:`status-dot ${v.boundDeviceId?"locked":"unlocked"}`})]}),xe.jsxs("div",{className:"gift-card-body",children:[v.thumbnailUrl&&xe.jsx("div",{className:"gift-thumbnail",children:xe.jsx("img",{src:v.thumbnailUrl,alt:"Marker"})}),xe.jsx("h3",{children:v.clientName||"Mijoz nomi"}),xe.jsxs("p",{children:["Sana: ",new Date(v.createdAt).toLocaleDateString()]}),xe.jsx("div",{className:"gift-stats",children:xe.jsxs("span",{children:[" ",v.scanCount||0," marta ko'rilgan"]})})]}),xe.jsxs("div",{className:"gift-card-actions",children:[xe.jsx("button",{onClick:()=>a(v),className:"btn-icon",title:"QR Kod",children:""}),xe.jsx("button",{onClick:()=>l(v._id),className:"btn-icon",title:"Qulfni ochish",children:""}),xe.jsx("button",{onClick:()=>p(v._id),className:"btn-icon btn-danger",title:"O'chirish",children:""})]})]},v._id))}),vue=({password:r})=>{const[a,l]=Ge.useState({telegram:"",instagram:"",phone:""}),[p,x]=Ge.useState(!1);Ge.useEffect(()=>{fetch("/api/settings").then(T=>T.json()).then(T=>l(T))},[]);const v=async()=>{x(!0);try{(await fetch("/api/admin/settings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(a)})).ok&&alert("Sozlamalar saqlandi!")}catch{alert("Xatolik yuz berdi")}finally{x(!1)}};return xe.jsxs("div",{className:"settings-panel",children:[xe.jsx("h3",{children:"Kontaktlar va Sozlamalar"}),xe.jsxs("div",{className:"settings-form",children:[xe.jsxs("div",{className:"form-group",children:[xe.jsx("label",{children:"Telegram Username"}),xe.jsx("input",{value:a.telegram,onChange:T=>l({...a,telegram:T.target.value}),placeholder:"@username"})]}),xe.jsxs("div",{className:"form-group",children:[xe.jsx("label",{children:"Instagram Username"}),xe.jsx("input",{value:a.instagram,onChange:T=>l({...a,instagram:T.target.value}),placeholder:"username"})]}),xe.jsxs("div",{className:"form-group",children:[xe.jsx("label",{children:"Telefon Raqam"}),xe.jsx("input",{value:a.phone,onChange:T=>l({...a,phone:T.target.value}),placeholder:"+998..."})]}),xe.jsx("button",{onClick:v,disabled:p,className:"btn-save",children:p?"SAQLANMOQDA...":"SAQLASH"})]})]})};var Fg={},QD={exports:{}},Iue="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Cue=Iue,Sue=Cue;function JD(){}function qD(){}qD.resetWarningCache=JD;var Tue=function(){function r(p,x,v,T,M,_){if(_!==Sue){var O=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw O.name="Invariant Violation",O}}r.isRequired=r;function a(){return r}var l={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:a,element:r,elementType:r,instanceOf:a,node:r,objectOf:a,oneOf:a,oneOfType:a,shape:a,exact:a,checkPropTypes:qD,resetWarningCache:JD};return l.PropTypes=l,l};QD.exports=Tue();var eO=QD.exports,tO={L:1,M:0,Q:3,H:2},nO={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},kue=nO;function rO(r){this.mode=kue.MODE_8BIT_BYTE,this.data=r}rO.prototype={getLength:function(r){return this.data.length},write:function(r){for(var a=0;a<this.data.length;a++)r.put(this.data.charCodeAt(a),8)}};var Eue=rO,pm=tO;function No(r,a){this.totalCount=r,this.dataCount=a}No.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];No.getRSBlocks=function(r,a){var l=No.getRsBlockTable(r,a);if(l==null)throw new Error("bad rs block @ typeNumber:"+r+"/errorCorrectLevel:"+a);for(var p=l.length/3,x=new Array,v=0;v<p;v++)for(var T=l[v*3+0],M=l[v*3+1],_=l[v*3+2],O=0;O<T;O++)x.push(new No(M,_));return x};No.getRsBlockTable=function(r,a){switch(a){case pm.L:return No.RS_BLOCK_TABLE[(r-1)*4+0];case pm.M:return No.RS_BLOCK_TABLE[(r-1)*4+1];case pm.Q:return No.RS_BLOCK_TABLE[(r-1)*4+2];case pm.H:return No.RS_BLOCK_TABLE[(r-1)*4+3];default:return}};var Nue=No;function sO(){this.buffer=new Array,this.length=0}sO.prototype={get:function(r){var a=Math.floor(r/8);return(this.buffer[a]>>>7-r%8&1)==1},put:function(r,a){for(var l=0;l<a;l++)this.putBit((r>>>a-l-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(r){var a=Math.floor(this.length/8);this.buffer.length<=a&&this.buffer.push(0),r&&(this.buffer[a]|=128>>>this.length%8),this.length++}};var Aue=sO,Ua={glog:function(r){if(r<1)throw new Error("glog("+r+")");return Ua.LOG_TABLE[r]},gexp:function(r){for(;r<0;)r+=255;for(;r>=256;)r-=255;return Ua.EXP_TABLE[r]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)};for(var ys=0;ys<8;ys++)Ua.EXP_TABLE[ys]=1<<ys;for(var ys=8;ys<256;ys++)Ua.EXP_TABLE[ys]=Ua.EXP_TABLE[ys-4]^Ua.EXP_TABLE[ys-5]^Ua.EXP_TABLE[ys-6]^Ua.EXP_TABLE[ys-8];for(var ys=0;ys<255;ys++)Ua.LOG_TABLE[Ua.EXP_TABLE[ys]]=ys;var iO=Ua,eh=iO;function Om(r,a){if(r.length==null)throw new Error(r.length+"/"+a);for(var l=0;l<r.length&&r[l]==0;)l++;this.num=new Array(r.length-l+a);for(var p=0;p<r.length-l;p++)this.num[p]=r[p+l]}Om.prototype={get:function(r){return this.num[r]},getLength:function(){return this.num.length},multiply:function(r){for(var a=new Array(this.getLength()+r.getLength()-1),l=0;l<this.getLength();l++)for(var p=0;p<r.getLength();p++)a[l+p]^=eh.gexp(eh.glog(this.get(l))+eh.glog(r.get(p)));return new Om(a,0)},mod:function(r){if(this.getLength()-r.getLength()<0)return this;for(var a=eh.glog(this.get(0))-eh.glog(r.get(0)),l=new Array(this.getLength()),p=0;p<this.getLength();p++)l[p]=this.get(p);for(var p=0;p<r.getLength();p++)l[p]^=eh.gexp(eh.glog(r.get(p))+a);return new Om(l,0).mod(r)}};var aO=Om,ua=nO,iM=aO,Rue=iO,wu={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},ps={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(r){for(var a=r<<10;ps.getBCHDigit(a)-ps.getBCHDigit(ps.G15)>=0;)a^=ps.G15<<ps.getBCHDigit(a)-ps.getBCHDigit(ps.G15);return(r<<10|a)^ps.G15_MASK},getBCHTypeNumber:function(r){for(var a=r<<12;ps.getBCHDigit(a)-ps.getBCHDigit(ps.G18)>=0;)a^=ps.G18<<ps.getBCHDigit(a)-ps.getBCHDigit(ps.G18);return r<<12|a},getBCHDigit:function(r){for(var a=0;r!=0;)a++,r>>>=1;return a},getPatternPosition:function(r){return ps.PATTERN_POSITION_TABLE[r-1]},getMask:function(r,a,l){switch(r){case wu.PATTERN000:return(a+l)%2==0;case wu.PATTERN001:return a%2==0;case wu.PATTERN010:return l%3==0;case wu.PATTERN011:return(a+l)%3==0;case wu.PATTERN100:return(Math.floor(a/2)+Math.floor(l/3))%2==0;case wu.PATTERN101:return a*l%2+a*l%3==0;case wu.PATTERN110:return(a*l%2+a*l%3)%2==0;case wu.PATTERN111:return(a*l%3+(a+l)%2)%2==0;default:throw new Error("bad maskPattern:"+r)}},getErrorCorrectPolynomial:function(r){for(var a=new iM([1],0),l=0;l<r;l++)a=a.multiply(new iM([1,Rue.gexp(l)],0));return a},getLengthInBits:function(r,a){if(1<=a&&a<10)switch(r){case ua.MODE_NUMBER:return 10;case ua.MODE_ALPHA_NUM:return 9;case ua.MODE_8BIT_BYTE:return 8;case ua.MODE_KANJI:return 8;default:throw new Error("mode:"+r)}else if(a<27)switch(r){case ua.MODE_NUMBER:return 12;case ua.MODE_ALPHA_NUM:return 11;case ua.MODE_8BIT_BYTE:return 16;case ua.MODE_KANJI:return 10;default:throw new Error("mode:"+r)}else if(a<41)switch(r){case ua.MODE_NUMBER:return 14;case ua.MODE_ALPHA_NUM:return 13;case ua.MODE_8BIT_BYTE:return 16;case ua.MODE_KANJI:return 12;default:throw new Error("mode:"+r)}else throw new Error("type:"+a)},getLostPoint:function(r){for(var a=r.getModuleCount(),l=0,p=0;p<a;p++)for(var x=0;x<a;x++){for(var v=0,T=r.isDark(p,x),M=-1;M<=1;M++)if(!(p+M<0||a<=p+M))for(var _=-1;_<=1;_++)x+_<0||a<=x+_||M==0&&_==0||T==r.isDark(p+M,x+_)&&v++;v>5&&(l+=3+v-5)}for(var p=0;p<a-1;p++)for(var x=0;x<a-1;x++){var O=0;r.isDark(p,x)&&O++,r.isDark(p+1,x)&&O++,r.isDark(p,x+1)&&O++,r.isDark(p+1,x+1)&&O++,(O==0||O==4)&&(l+=3)}for(var p=0;p<a;p++)for(var x=0;x<a-6;x++)r.isDark(p,x)&&!r.isDark(p,x+1)&&r.isDark(p,x+2)&&r.isDark(p,x+3)&&r.isDark(p,x+4)&&!r.isDark(p,x+5)&&r.isDark(p,x+6)&&(l+=40);for(var x=0;x<a;x++)for(var p=0;p<a-6;p++)r.isDark(p,x)&&!r.isDark(p+1,x)&&r.isDark(p+2,x)&&r.isDark(p+3,x)&&r.isDark(p+4,x)&&!r.isDark(p+5,x)&&r.isDark(p+6,x)&&(l+=40);for(var V=0,x=0;x<a;x++)for(var p=0;p<a;p++)r.isDark(p,x)&&V++;var D=Math.abs(100*V/a/a-50)/5;return l+=D*10,l}},Mue=ps,Lue=Eue,oO=Nue,lO=Aue,Uu=Mue,Due=aO;function Ao(r,a){this.typeNumber=r,this.errorCorrectLevel=a,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}var Vi=Ao.prototype;Vi.addData=function(r){var a=new Lue(r);this.dataList.push(a),this.dataCache=null};Vi.isDark=function(r,a){if(r<0||this.moduleCount<=r||a<0||this.moduleCount<=a)throw new Error(r+","+a);return this.modules[r][a]};Vi.getModuleCount=function(){return this.moduleCount};Vi.make=function(){if(this.typeNumber<1){var r=1;for(r=1;r<40;r++){for(var a=oO.getRSBlocks(r,this.errorCorrectLevel),l=new lO,p=0,x=0;x<a.length;x++)p+=a[x].dataCount;for(var x=0;x<this.dataList.length;x++){var v=this.dataList[x];l.put(v.mode,4),l.put(v.getLength(),Uu.getLengthInBits(v.mode,r)),v.write(l)}if(l.getLengthInBits()<=p*8)break}this.typeNumber=r}this.makeImpl(!1,this.getBestMaskPattern())};Vi.makeImpl=function(r,a){this.moduleCount=this.typeNumber*4+17,this.modules=new Array(this.moduleCount);for(var l=0;l<this.moduleCount;l++){this.modules[l]=new Array(this.moduleCount);for(var p=0;p<this.moduleCount;p++)this.modules[l][p]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(r,a),this.typeNumber>=7&&this.setupTypeNumber(r),this.dataCache==null&&(this.dataCache=Ao.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,a)};Vi.setupPositionProbePattern=function(r,a){for(var l=-1;l<=7;l++)if(!(r+l<=-1||this.moduleCount<=r+l))for(var p=-1;p<=7;p++)a+p<=-1||this.moduleCount<=a+p||(0<=l&&l<=6&&(p==0||p==6)||0<=p&&p<=6&&(l==0||l==6)||2<=l&&l<=4&&2<=p&&p<=4?this.modules[r+l][a+p]=!0:this.modules[r+l][a+p]=!1)};Vi.getBestMaskPattern=function(){for(var r=0,a=0,l=0;l<8;l++){this.makeImpl(!0,l);var p=Uu.getLostPoint(this);(l==0||r>p)&&(r=p,a=l)}return a};Vi.createMovieClip=function(r,a,l){var p=r.createEmptyMovieClip(a,l),x=1;this.make();for(var v=0;v<this.modules.length;v++)for(var T=v*x,M=0;M<this.modules[v].length;M++){var _=M*x,O=this.modules[v][M];O&&(p.beginFill(0,100),p.moveTo(_,T),p.lineTo(_+x,T),p.lineTo(_+x,T+x),p.lineTo(_,T+x),p.endFill())}return p};Vi.setupTimingPattern=function(){for(var r=8;r<this.moduleCount-8;r++)this.modules[r][6]==null&&(this.modules[r][6]=r%2==0);for(var a=8;a<this.moduleCount-8;a++)this.modules[6][a]==null&&(this.modules[6][a]=a%2==0)};Vi.setupPositionAdjustPattern=function(){for(var r=Uu.getPatternPosition(this.typeNumber),a=0;a<r.length;a++)for(var l=0;l<r.length;l++){var p=r[a],x=r[l];if(this.modules[p][x]==null)for(var v=-2;v<=2;v++)for(var T=-2;T<=2;T++)v==-2||v==2||T==-2||T==2||v==0&&T==0?this.modules[p+v][x+T]=!0:this.modules[p+v][x+T]=!1}};Vi.setupTypeNumber=function(r){for(var a=Uu.getBCHTypeNumber(this.typeNumber),l=0;l<18;l++){var p=!r&&(a>>l&1)==1;this.modules[Math.floor(l/3)][l%3+this.moduleCount-8-3]=p}for(var l=0;l<18;l++){var p=!r&&(a>>l&1)==1;this.modules[l%3+this.moduleCount-8-3][Math.floor(l/3)]=p}};Vi.setupTypeInfo=function(r,a){for(var l=this.errorCorrectLevel<<3|a,p=Uu.getBCHTypeInfo(l),x=0;x<15;x++){var v=!r&&(p>>x&1)==1;x<6?this.modules[x][8]=v:x<8?this.modules[x+1][8]=v:this.modules[this.moduleCount-15+x][8]=v}for(var x=0;x<15;x++){var v=!r&&(p>>x&1)==1;x<8?this.modules[8][this.moduleCount-x-1]=v:x<9?this.modules[8][15-x-1+1]=v:this.modules[8][15-x-1]=v}this.modules[this.moduleCount-8][8]=!r};Vi.mapData=function(r,a){for(var l=-1,p=this.moduleCount-1,x=7,v=0,T=this.moduleCount-1;T>0;T-=2)for(T==6&&T--;;){for(var M=0;M<2;M++)if(this.modules[p][T-M]==null){var _=!1;v<r.length&&(_=(r[v]>>>x&1)==1);var O=Uu.getMask(a,p,T-M);O&&(_=!_),this.modules[p][T-M]=_,x--,x==-1&&(v++,x=7)}if(p+=l,p<0||this.moduleCount<=p){p-=l,l=-l;break}}};Ao.PAD0=236;Ao.PAD1=17;Ao.createData=function(r,a,l){for(var p=oO.getRSBlocks(r,a),x=new lO,v=0;v<l.length;v++){var T=l[v];x.put(T.mode,4),x.put(T.getLength(),Uu.getLengthInBits(T.mode,r)),T.write(x)}for(var M=0,v=0;v<p.length;v++)M+=p[v].dataCount;if(x.getLengthInBits()>M*8)throw new Error("code length overflow. ("+x.getLengthInBits()+">"+M*8+")");for(x.getLengthInBits()+4<=M*8&&x.put(0,4);x.getLengthInBits()%8!=0;)x.putBit(!1);for(;!(x.getLengthInBits()>=M*8||(x.put(Ao.PAD0,8),x.getLengthInBits()>=M*8));)x.put(Ao.PAD1,8);return Ao.createBytes(x,p)};Ao.createBytes=function(r,a){for(var l=0,p=0,x=0,v=new Array(a.length),T=new Array(a.length),M=0;M<a.length;M++){var _=a[M].dataCount,O=a[M].totalCount-_;p=Math.max(p,_),x=Math.max(x,O),v[M]=new Array(_);for(var V=0;V<v[M].length;V++)v[M][V]=255&r.buffer[V+l];l+=_;var D=Uu.getErrorCorrectPolynomial(O),$=new Due(v[M],D.getLength()-1),re=$.mod(D);T[M]=new Array(D.getLength()-1);for(var V=0;V<T[M].length;V++){var H=V+re.getLength()-T[M].length;T[M][V]=H>=0?re.get(H):0}}for(var se=0,V=0;V<a.length;V++)se+=a[V].totalCount;for(var Ee=new Array(se),ee=0,V=0;V<p;V++)for(var M=0;M<a.length;M++)V<v[M].length&&(Ee[ee++]=v[M][V]);for(var V=0;V<x;V++)for(var M=0;M<a.length;M++)V<T[M].length&&(Ee[ee++]=T[M][V]);return Ee};var Oue=Ao,rI={};Object.defineProperty(rI,"__esModule",{value:!0});var Pue=Object.assign||function(r){for(var a=1;a<arguments.length;a++){var l=arguments[a];for(var p in l)Object.prototype.hasOwnProperty.call(l,p)&&(r[p]=l[p])}return r},Fue=eO,ca=cO(Fue),uO=Ge,mm=cO(uO);function cO(r){return r&&r.__esModule?r:{default:r}}function Gue(r,a){var l={};for(var p in r)a.indexOf(p)>=0||Object.prototype.hasOwnProperty.call(r,p)&&(l[p]=r[p]);return l}var _ue={bgColor:ca.default.oneOfType([ca.default.object,ca.default.string]).isRequired,bgD:ca.default.string.isRequired,fgColor:ca.default.oneOfType([ca.default.object,ca.default.string]).isRequired,fgD:ca.default.string.isRequired,size:ca.default.number.isRequired,title:ca.default.string,viewBoxSize:ca.default.number.isRequired,xmlns:ca.default.string},sI=(0,uO.forwardRef)(function(r,a){var l=r.bgColor,p=r.bgD,x=r.fgD,v=r.fgColor,T=r.size,M=r.title,_=r.viewBoxSize,O=r.xmlns,V=O===void 0?"http://www.w3.org/2000/svg":O,D=Gue(r,["bgColor","bgD","fgD","fgColor","size","title","viewBoxSize","xmlns"]);return mm.default.createElement("svg",Pue({},D,{height:T,ref:a,viewBox:"0 0 "+_+" "+_,width:T,xmlns:V}),M?mm.default.createElement("title",null,M):null,mm.default.createElement("path",{d:p,fill:l}),mm.default.createElement("path",{d:x,fill:v}))});sI.displayName="QRCodeSvg";sI.propTypes=_ue;rI.default=sI;Object.defineProperty(Fg,"__esModule",{value:!0});Fg.QRCode=void 0;var Vue=Object.assign||function(r){for(var a=1;a<arguments.length;a++){var l=arguments[a];for(var p in l)Object.prototype.hasOwnProperty.call(l,p)&&(r[p]=l[p])}return r},Bue=eO,dl=x0(Bue),Wue=tO,zue=x0(Wue),Xue=Oue,Zue=x0(Xue),hO=Ge,Kue=x0(hO),$ue=rI,Uue=x0($ue);function x0(r){return r&&r.__esModule?r:{default:r}}function Hue(r,a){var l={};for(var p in r)a.indexOf(p)>=0||Object.prototype.hasOwnProperty.call(r,p)&&(l[p]=r[p]);return l}var jue={bgColor:dl.default.oneOfType([dl.default.object,dl.default.string]),fgColor:dl.default.oneOfType([dl.default.object,dl.default.string]),level:dl.default.string,size:dl.default.number,value:dl.default.string.isRequired},Gg=(0,hO.forwardRef)(function(r,a){var l=r.bgColor,p=l===void 0?"#FFFFFF":l,x=r.fgColor,v=x===void 0?"#000000":x,T=r.level,M=T===void 0?"L":T,_=r.size,O=_===void 0?256:_,V=r.value,D=Hue(r,["bgColor","fgColor","level","size","value"]),$=new Zue.default(-1,zue.default[M]);$.addData(V),$.make();var re=$.modules;return Kue.default.createElement(Uue.default,Vue({},D,{bgColor:p,bgD:re.map(function(H,se){return H.map(function(Ee,ee){return Ee?"":"M "+ee+" "+se+" l 1 0 0 1 -1 0 Z"}).join(" ")}).join(" "),fgColor:v,fgD:re.map(function(H,se){return H.map(function(Ee,ee){return Ee?"M "+ee+" "+se+" l 1 0 0 1 -1 0 Z":""}).join(" ")}).join(" "),ref:a,size:O,viewBoxSize:re.length}))});Fg.QRCode=Gg;Gg.displayName="QRCode";Gg.propTypes=jue;var Yue=Fg.default=Gg;const Que=()=>{const[r,a]=Ge.useState("dashboard"),[l,p]=Ge.useState([]),[x,v]=Ge.useState(null),[T,M]=Ge.useState(""),[_,O]=Ge.useState(!1),[V,D]=Ge.useState(!1),[$,re]=Ge.useState(!1),[H,se]=Ge.useState({clientName:"",videoUrl:"",targetFile:"",thumbnailUrl:"",pinCode:""}),[Ee,ee]=Ge.useState(null),Y=async ue=>{(await fetch("/api/admin/gifts",{headers:{Authorization:`Bearer ${ue}`}})).ok?(O(!0),localStorage.setItem("admin_pass",ue),j(ue)):ue&&alert("Parol noto'g'ri!")},j=async ue=>{re(!0);try{const we=ue||T,[Ne,it]=await Promise.all([fetch("/api/admin/gifts",{headers:{Authorization:`Bearer ${we}`}}),fetch("/api/admin/analytics",{headers:{Authorization:`Bearer ${we}`}})]);Ne.ok&&p(await Ne.json()),it.ok&&v(await it.json())}finally{re(!1)}};Ge.useEffect(()=>{const ue=localStorage.getItem("admin_pass");ue&&(M(ue),Y(ue))},[]);const fe=async(ue,we)=>{const Ne=ue.target.files[0];if(!Ne)return;D(!0);const it=new FormData;it.append("file",Ne);try{const ht=await(await fetch("/api/admin/upload",{method:"POST",headers:{Authorization:`Bearer ${T}`},body:it})).json();ht.url&&se(_t=>({..._t,[we]:ht.url}))}finally{D(!1)}},be=async()=>{(await fetch("/api/admin/gifts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${T}`},body:JSON.stringify(H)})).ok&&(se({clientName:"",videoUrl:"",targetFile:"",thumbnailUrl:"",pinCode:""}),j(),a("list"))},Fe=async ue=>{confirm("O'chirilsinmi?")&&(await fetch(`/api/admin/gifts/${ue}`,{method:"DELETE",headers:{Authorization:`Bearer ${T}`}}),j())};return _?xe.jsxs("div",{className:"admin-page",children:[xe.jsxs("header",{className:"admin-header",children:[xe.jsx("h1",{style:{color:"var(--primary)"},children:"PINHAN BOX"}),xe.jsx("button",{onClick:()=>{localStorage.removeItem("admin_pass"),O(!1)},className:"nav-btn",children:"Chiqish"})]}),xe.jsxs("nav",{className:"admin-nav",children:[xe.jsx("button",{onClick:()=>a("dashboard"),className:`nav-btn ${r==="dashboard"?"active":""}`,children:"DASHBOARD"}),xe.jsx("button",{onClick:()=>a("list"),className:`nav-btn ${r==="list"?"active":""}`,children:"SOVG'ALAR"}),xe.jsx("button",{onClick:()=>a("create"),className:`nav-btn ${r==="create"?"active":""}`,children:"YANGI QO'SHISH"}),xe.jsx("button",{onClick:()=>a("settings"),className:`nav-btn ${r==="settings"?"active":""}`,children:"SOZLAMALAR"})]}),xe.jsxs("main",{className:"admin-content",children:[r==="dashboard"&&xe.jsx(bue,{stats:x}),r==="list"&&xe.jsx(wue,{gifts:l,isLoading:$,onSelect:ee,onReset:()=>{},onDelete:Fe}),r==="create"&&xe.jsx("div",{style:{padding:"0 40px"},children:xe.jsxs("div",{className:"glass",style:{padding:"40px",maxWidth:"800px"},children:[xe.jsx("h3",{children:"Mijoz va Kontent"}),xe.jsxs("div",{className:"form-group",children:[xe.jsx("label",{children:"Mijoz Ismi"}),xe.jsx("input",{value:H.clientName,onChange:ue=>se({...H,clientName:ue.target.value})})]}),xe.jsxs("div",{className:"form-group",children:[xe.jsx("label",{children:"Video (.mp4)"}),xe.jsx("input",{type:"file",onChange:ue=>fe(ue,"videoUrl")}),H.videoUrl&&xe.jsx("p",{style:{color:"var(--success)",fontSize:"12px"},children:" Video tayyor"})]}),xe.jsxs("div",{className:"form-group",children:[xe.jsx("label",{children:"Marker Rasmi (.jpg/.png)"}),xe.jsx("input",{type:"file",accept:"image/*",onChange:ue=>fe(ue,"thumbnailUrl")}),H.thumbnailUrl&&xe.jsx("p",{style:{color:"var(--success)",fontSize:"12px"},children:" Rasm tayyor"})]}),xe.jsxs("div",{className:"form-group",children:[xe.jsx("label",{children:"Mind Fayl (.mind)"}),xe.jsx("input",{type:"file",accept:".mind",onChange:ue=>fe(ue,"targetFile")}),H.targetFile&&xe.jsx("p",{style:{color:"var(--success)",fontSize:"12px"},children:" Mind fayl tayyor"})]}),xe.jsx("button",{onClick:be,disabled:V,className:"btn-primary",children:V?"YUKLANMOQDA...":"SOVG'ANI YARATISH"})]})}),r==="settings"&&xe.jsx(vue,{password:T})]}),Ee&&xe.jsx("div",{className:"modal-overlay",onClick:()=>ee(null),children:xe.jsxs("div",{className:"modal-content",onClick:ue=>ue.stopPropagation(),children:[xe.jsx("h2",{style:{color:"#000",marginBottom:"20px"},children:"Sovg'ani Skanerlang"}),xe.jsx("div",{style:{background:"#fff",padding:"20px",borderRadius:"20px",display:"inline-block"},children:xe.jsx(Yue,{value:`${window.location.origin}?id=${Ee._id}`,size:256})}),xe.jsx("h1",{style:{color:"#000",fontSize:"48px",margin:"20px 0"},children:Ee.pinCode}),xe.jsx("button",{onClick:()=>window.print(),className:"btn-primary",children:"Chirib olish"}),xe.jsx("button",{onClick:()=>ee(null),className:"nav-btn",style:{marginLeft:"10px"},children:"Yopish"})]})})]}):xe.jsx("div",{className:"modal-overlay",children:xe.jsxs("div",{className:"modal-content glass",children:[xe.jsx("h2",{style:{color:"var(--primary)",marginBottom:"30px"},children:"Pinhan Box Admin"}),xe.jsx("div",{className:"form-group",children:xe.jsx("input",{type:"password",placeholder:"Parolni kiriting",value:T,onChange:ue=>M(ue.target.value)})}),xe.jsx("button",{onClick:()=>Y(T),className:"btn-primary",style:{width:"100%"},children:"KIRISH"})]})})};var ct;(function(r){r[r.QR_CODE=0]="QR_CODE",r[r.AZTEC=1]="AZTEC",r[r.CODABAR=2]="CODABAR",r[r.CODE_39=3]="CODE_39",r[r.CODE_93=4]="CODE_93",r[r.CODE_128=5]="CODE_128",r[r.DATA_MATRIX=6]="DATA_MATRIX",r[r.MAXICODE=7]="MAXICODE",r[r.ITF=8]="ITF",r[r.EAN_13=9]="EAN_13",r[r.EAN_8=10]="EAN_8",r[r.PDF_417=11]="PDF_417",r[r.RSS_14=12]="RSS_14",r[r.RSS_EXPANDED=13]="RSS_EXPANDED",r[r.UPC_A=14]="UPC_A",r[r.UPC_E=15]="UPC_E",r[r.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(ct||(ct={}));var aM=new Map([[ct.QR_CODE,"QR_CODE"],[ct.AZTEC,"AZTEC"],[ct.CODABAR,"CODABAR"],[ct.CODE_39,"CODE_39"],[ct.CODE_93,"CODE_93"],[ct.CODE_128,"CODE_128"],[ct.DATA_MATRIX,"DATA_MATRIX"],[ct.MAXICODE,"MAXICODE"],[ct.ITF,"ITF"],[ct.EAN_13,"EAN_13"],[ct.EAN_8,"EAN_8"],[ct.PDF_417,"PDF_417"],[ct.RSS_14,"RSS_14"],[ct.RSS_EXPANDED,"RSS_EXPANDED"],[ct.UPC_A,"UPC_A"],[ct.UPC_E,"UPC_E"],[ct.UPC_EAN_EXTENSION,"UPC_EAN_EXTENSION"]]),oM;(function(r){r[r.UNKNOWN=0]="UNKNOWN",r[r.URL=1]="URL"})(oM||(oM={}));function Jue(r){return Object.values(ct).includes(r)}var Wu;(function(r){r[r.SCAN_TYPE_CAMERA=0]="SCAN_TYPE_CAMERA",r[r.SCAN_TYPE_FILE=1]="SCAN_TYPE_FILE"})(Wu||(Wu={}));var Za=function(){function r(){}return r.GITHUB_PROJECT_URL="https://github.com/mebjas/html5-qrcode",r.SCAN_DEFAULT_FPS=2,r.DEFAULT_DISABLE_FLIP=!1,r.DEFAULT_REMEMBER_LAST_CAMERA_USED=!0,r.DEFAULT_SUPPORTED_SCAN_TYPE=[Wu.SCAN_TYPE_CAMERA,Wu.SCAN_TYPE_FILE],r}(),dO=function(){function r(a,l){this.format=a,this.formatName=l}return r.prototype.toString=function(){return this.formatName},r.create=function(a){if(!aM.has(a))throw"".concat(a," not in html5QrcodeSupportedFormatsTextMap");return new r(a,aM.get(a))},r}(),lM=function(){function r(){}return r.createFromText=function(a){var l={text:a};return{decodedText:a,result:l}},r.createFromQrcodeResult=function(a){return{decodedText:a.text,result:a}},r}(),Fw;(function(r){r[r.UNKWOWN_ERROR=0]="UNKWOWN_ERROR",r[r.IMPLEMENTATION_ERROR=1]="IMPLEMENTATION_ERROR",r[r.NO_CODE_FOUND_ERROR=2]="NO_CODE_FOUND_ERROR"})(Fw||(Fw={}));var fO=function(){function r(){}return r.createFrom=function(a){return{errorMessage:a,type:Fw.UNKWOWN_ERROR}},r}(),pO=function(){function r(a){this.verbose=a}return r.prototype.log=function(a){this.verbose&&console.log(a)},r.prototype.warn=function(a){this.verbose&&console.warn(a)},r.prototype.logError=function(a,l){(this.verbose||l===!0)&&console.error(a)},r.prototype.logErrors=function(a){if(a.length===0)throw"Logger#logError called without arguments";this.verbose&&console.error(a)},r}();function ko(r){return typeof r>"u"||r===null}function que(r,a,l){return r>l?l:r<a?a:r}var Gd=function(){function r(){}return r.codeParseError=function(a){return"QR code parse error, error = ".concat(a)},r.errorGettingUserMedia=function(a){return"Error getting userMedia, error = ".concat(a)},r.onlyDeviceSupportedError=function(){return"The device doesn't support navigator.mediaDevices , only supported cameraIdOrConfig in this case is deviceId parameter (string)."},r.cameraStreamingNotSupported=function(){return"Camera streaming not supported by the browser."},r.unableToQuerySupportedDevices=function(){return"Unable to query supported devices, unknown error."},r.insecureContextCameraQueryError=function(){return"Camera access is only supported in secure context like https or localhost."},r.scannerPaused=function(){return"Scanner paused"},r}(),vn=function(){function r(){}return r.scanningStatus=function(){return"Scanning"},r.idleStatus=function(){return"Idle"},r.errorStatus=function(){return"Error"},r.permissionStatus=function(){return"Permission"},r.noCameraFoundErrorStatus=function(){return"No Cameras"},r.lastMatch=function(a){return"Last Match: ".concat(a)},r.codeScannerTitle=function(){return"Code Scanner"},r.cameraPermissionTitle=function(){return"Request Camera Permissions"},r.cameraPermissionRequesting=function(){return"Requesting camera permissions..."},r.noCameraFound=function(){return"No camera found"},r.scanButtonStopScanningText=function(){return"Stop Scanning"},r.scanButtonStartScanningText=function(){return"Start Scanning"},r.torchOnButton=function(){return"Switch On Torch"},r.torchOffButton=function(){return"Switch Off Torch"},r.torchOnFailedMessage=function(){return"Failed to turn on torch"},r.torchOffFailedMessage=function(){return"Failed to turn off torch"},r.scanButtonScanningStarting=function(){return"Launching Camera..."},r.textIfCameraScanSelected=function(){return"Scan an Image File"},r.textIfFileScanSelected=function(){return"Scan using camera directly"},r.selectCamera=function(){return"Select Camera"},r.fileSelectionChooseImage=function(){return"Choose Image"},r.fileSelectionChooseAnother=function(){return"Choose Another"},r.fileSelectionNoImageSelected=function(){return"No image choosen"},r.anonymousCameraPrefix=function(){return"Anonymous Camera"},r.dragAndDropMessage=function(){return"Or drop an image to scan"},r.dragAndDropMessageOnlyImages=function(){return"Or drop an image to scan (other files not supported)"},r.zoom=function(){return"zoom"},r.loadingImage=function(){return"Loading image..."},r.cameraScanAltText=function(){return"Camera based scan"},r.fileScanAltText=function(){return"Fule based scan"},r}(),uM=function(){function r(){}return r.poweredBy=function(){return"Powered by "},r.reportIssues=function(){return"Report issues"},r}(),mO=function(){function r(){}return r.isMediaStreamConstraintsValid=function(a,l){if(typeof a!="object"){var p=typeof a;return l.logError("videoConstraints should be of type object, the "+"object passed is of type ".concat(p,"."),!0),!1}for(var x=["autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","volume"],v=new Set(x),T=Object.keys(a),M=0,_=T;M<_.length;M++){var O=_[M];if(v.has(O))return l.logError("".concat(O," is not supported videoConstaints."),!0),!1}return!0},r}(),Gw={exports:{}};(function(r,a){(function(l,p){p(a)})($a,function(l){function p(K){return K==null}var x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(K,u){K.__proto__=u}||function(K,u){for(var d in u)u.hasOwnProperty(d)&&(K[d]=u[d])};function v(K,u){x(K,u);function d(){this.constructor=K}K.prototype=u===null?Object.create(u):(d.prototype=u.prototype,new d)}function T(K,u){var d=Object.setPrototypeOf;d?d(K,u):K.__proto__=u}function M(K,u){u===void 0&&(u=K.constructor);var d=Error.captureStackTrace;d&&d(K,u)}var _=function(K){v(u,K);function u(d){var m=this.constructor,b=K.call(this,d)||this;return Object.defineProperty(b,"name",{value:m.name,enumerable:!1}),T(b,m.prototype),M(b),b}return u}(Error);class O extends _{constructor(u=void 0){super(u),this.message=u}getKind(){return this.constructor.kind}}O.kind="Exception";class V extends O{}V.kind="ArgumentException";class D extends O{}D.kind="IllegalArgumentException";class ${constructor(u){if(this.binarizer=u,u===null)throw new D("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(u,d){return this.binarizer.getBlackRow(u,d)}getBlackMatrix(){return(this.matrix===null||this.matrix===void 0)&&(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(u,d,m,b){const w=this.binarizer.getLuminanceSource().crop(u,d,m,b);return new $(this.binarizer.createBinarizer(w))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){const u=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new $(this.binarizer.createBinarizer(u))}rotateCounterClockwise45(){const u=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new $(this.binarizer.createBinarizer(u))}toString(){try{return this.getBlackMatrix().toString()}catch{return""}}}class re extends O{static getChecksumInstance(){return new re}}re.kind="ChecksumException";class H{constructor(u){this.source=u}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class se{static arraycopy(u,d,m,b,w){for(;w--;)m[b++]=u[d++]}static currentTimeMillis(){return Date.now()}}class Ee extends O{}Ee.kind="IndexOutOfBoundsException";class ee extends Ee{constructor(u=void 0,d=void 0){super(d),this.index=u,this.message=d}}ee.kind="ArrayIndexOutOfBoundsException";class Y{static fill(u,d){for(let m=0,b=u.length;m<b;m++)u[m]=d}static fillWithin(u,d,m,b){Y.rangeCheck(u.length,d,m);for(let w=d;w<m;w++)u[w]=b}static rangeCheck(u,d,m){if(d>m)throw new D("fromIndex("+d+") > toIndex("+m+")");if(d<0)throw new ee(d);if(m>u)throw new ee(m)}static asList(...u){return u}static create(u,d,m){return Array.from({length:u}).map(w=>Array.from({length:d}).fill(m))}static createInt32Array(u,d,m){return Array.from({length:u}).map(w=>Int32Array.from({length:d}).fill(m))}static equals(u,d){if(!u||!d||!u.length||!d.length||u.length!==d.length)return!1;for(let m=0,b=u.length;m<b;m++)if(u[m]!==d[m])return!1;return!0}static hashCode(u){if(u===null)return 0;let d=1;for(const m of u)d=31*d+m;return d}static fillUint8Array(u,d){for(let m=0;m!==u.length;m++)u[m]=d}static copyOf(u,d){return u.slice(0,d)}static copyOfUint8Array(u,d){if(u.length<=d){const m=new Uint8Array(d);return m.set(u),m}return u.slice(0,d)}static copyOfRange(u,d,m){const b=m-d,w=new Int32Array(b);return se.arraycopy(u,d,w,0,b),w}static binarySearch(u,d,m){m===void 0&&(m=Y.numberComparator);let b=0,w=u.length-1;for(;b<=w;){const S=w+b>>1,E=m(d,u[S]);if(E>0)b=S+1;else if(E<0)w=S-1;else return S}return-b-1}static numberComparator(u,d){return u-d}}class j{static numberOfTrailingZeros(u){let d;if(u===0)return 32;let m=31;return d=u<<16,d!==0&&(m-=16,u=d),d=u<<8,d!==0&&(m-=8,u=d),d=u<<4,d!==0&&(m-=4,u=d),d=u<<2,d!==0&&(m-=2,u=d),m-(u<<1>>>31)}static numberOfLeadingZeros(u){if(u===0)return 32;let d=1;return u>>>16||(d+=16,u<<=16),u>>>24||(d+=8,u<<=8),u>>>28||(d+=4,u<<=4),u>>>30||(d+=2,u<<=2),d-=u>>>31,d}static toHexString(u){return u.toString(16)}static toBinaryString(u){return String(parseInt(String(u),2))}static bitCount(u){return u=u-(u>>>1&1431655765),u=(u&858993459)+(u>>>2&858993459),u=u+(u>>>4)&252645135,u=u+(u>>>8),u=u+(u>>>16),u&63}static truncDivision(u,d){return Math.trunc(u/d)}static parseInt(u,d=void 0){return parseInt(u,d)}}j.MIN_VALUE_32_BITS=-2147483648,j.MAX_VALUE=Number.MAX_SAFE_INTEGER;class fe{constructor(u,d){u===void 0?(this.size=0,this.bits=new Int32Array(1)):(this.size=u,d==null?this.bits=fe.makeArray(u):this.bits=d)}getSize(){return this.size}getSizeInBytes(){return Math.floor((this.size+7)/8)}ensureCapacity(u){if(u>this.bits.length*32){const d=fe.makeArray(u);se.arraycopy(this.bits,0,d,0,this.bits.length),this.bits=d}}get(u){return(this.bits[Math.floor(u/32)]&1<<(u&31))!==0}set(u){this.bits[Math.floor(u/32)]|=1<<(u&31)}flip(u){this.bits[Math.floor(u/32)]^=1<<(u&31)}getNextSet(u){const d=this.size;if(u>=d)return d;const m=this.bits;let b=Math.floor(u/32),w=m[b];w&=~((1<<(u&31))-1);const S=m.length;for(;w===0;){if(++b===S)return d;w=m[b]}const E=b*32+j.numberOfTrailingZeros(w);return E>d?d:E}getNextUnset(u){const d=this.size;if(u>=d)return d;const m=this.bits;let b=Math.floor(u/32),w=~m[b];w&=~((1<<(u&31))-1);const S=m.length;for(;w===0;){if(++b===S)return d;w=~m[b]}const E=b*32+j.numberOfTrailingZeros(w);return E>d?d:E}setBulk(u,d){this.bits[Math.floor(u/32)]=d}setRange(u,d){if(d<u||u<0||d>this.size)throw new D;if(d===u)return;d--;const m=Math.floor(u/32),b=Math.floor(d/32),w=this.bits;for(let S=m;S<=b;S++){const E=S>m?0:u&31,G=(2<<(S<b?31:d&31))-(1<<E);w[S]|=G}}clear(){const u=this.bits.length,d=this.bits;for(let m=0;m<u;m++)d[m]=0}isRange(u,d,m){if(d<u||u<0||d>this.size)throw new D;if(d===u)return!0;d--;const b=Math.floor(u/32),w=Math.floor(d/32),S=this.bits;for(let E=b;E<=w;E++){const A=E>b?0:u&31,B=(2<<(E<w?31:d&31))-(1<<A)&4294967295;if((S[E]&B)!==(m?B:0))return!1}return!0}appendBit(u){this.ensureCapacity(this.size+1),u&&(this.bits[Math.floor(this.size/32)]|=1<<(this.size&31)),this.size++}appendBits(u,d){if(d<0||d>32)throw new D("Num bits must be between 0 and 32");this.ensureCapacity(this.size+d);for(let m=d;m>0;m--)this.appendBit((u>>m-1&1)===1)}appendBitArray(u){const d=u.size;this.ensureCapacity(this.size+d);for(let m=0;m<d;m++)this.appendBit(u.get(m))}xor(u){if(this.size!==u.size)throw new D("Sizes don't match");const d=this.bits;for(let m=0,b=d.length;m<b;m++)d[m]^=u.bits[m]}toBytes(u,d,m,b){for(let w=0;w<b;w++){let S=0;for(let E=0;E<8;E++)this.get(u)&&(S|=1<<7-E),u++;d[m+w]=S}}getBitArray(){return this.bits}reverse(){const u=new Int32Array(this.bits.length),d=Math.floor((this.size-1)/32),m=d+1,b=this.bits;for(let w=0;w<m;w++){let S=b[w];S=S>>1&1431655765|(S&1431655765)<<1,S=S>>2&858993459|(S&858993459)<<2,S=S>>4&252645135|(S&252645135)<<4,S=S>>8&16711935|(S&16711935)<<8,S=S>>16&65535|(S&65535)<<16,u[d-w]=S}if(this.size!==m*32){const w=m*32-this.size;let S=u[0]>>>w;for(let E=1;E<m;E++){const A=u[E];S|=A<<32-w,u[E-1]=S,S=A>>>w}u[m-1]=S}this.bits=u}static makeArray(u){return new Int32Array(Math.floor((u+31)/32))}equals(u){if(!(u instanceof fe))return!1;const d=u;return this.size===d.size&&Y.equals(this.bits,d.bits)}hashCode(){return 31*this.size+Y.hashCode(this.bits)}toString(){let u="";for(let d=0,m=this.size;d<m;d++)d&7||(u+=" "),u+=this.get(d)?"X":".";return u}clone(){return new fe(this.size,this.bits.slice())}}var be;(function(K){K[K.OTHER=0]="OTHER",K[K.PURE_BARCODE=1]="PURE_BARCODE",K[K.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",K[K.TRY_HARDER=3]="TRY_HARDER",K[K.CHARACTER_SET=4]="CHARACTER_SET",K[K.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",K[K.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",K[K.ASSUME_GS1=7]="ASSUME_GS1",K[K.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",K[K.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",K[K.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS"})(be||(be={}));var Fe=be;class ue extends O{static getFormatInstance(){return new ue}}ue.kind="FormatException";var we;(function(K){K[K.Cp437=0]="Cp437",K[K.ISO8859_1=1]="ISO8859_1",K[K.ISO8859_2=2]="ISO8859_2",K[K.ISO8859_3=3]="ISO8859_3",K[K.ISO8859_4=4]="ISO8859_4",K[K.ISO8859_5=5]="ISO8859_5",K[K.ISO8859_6=6]="ISO8859_6",K[K.ISO8859_7=7]="ISO8859_7",K[K.ISO8859_8=8]="ISO8859_8",K[K.ISO8859_9=9]="ISO8859_9",K[K.ISO8859_10=10]="ISO8859_10",K[K.ISO8859_11=11]="ISO8859_11",K[K.ISO8859_13=12]="ISO8859_13",K[K.ISO8859_14=13]="ISO8859_14",K[K.ISO8859_15=14]="ISO8859_15",K[K.ISO8859_16=15]="ISO8859_16",K[K.SJIS=16]="SJIS",K[K.Cp1250=17]="Cp1250",K[K.Cp1251=18]="Cp1251",K[K.Cp1252=19]="Cp1252",K[K.Cp1256=20]="Cp1256",K[K.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",K[K.UTF8=22]="UTF8",K[K.ASCII=23]="ASCII",K[K.Big5=24]="Big5",K[K.GB18030=25]="GB18030",K[K.EUC_KR=26]="EUC_KR"})(we||(we={}));class Ne{constructor(u,d,m,...b){this.valueIdentifier=u,this.name=m,typeof d=="number"?this.values=Int32Array.from([d]):this.values=d,this.otherEncodingNames=b,Ne.VALUE_IDENTIFIER_TO_ECI.set(u,this),Ne.NAME_TO_ECI.set(m,this);const w=this.values;for(let S=0,E=w.length;S!==E;S++){const A=w[S];Ne.VALUES_TO_ECI.set(A,this)}for(const S of b)Ne.NAME_TO_ECI.set(S,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(u){if(u<0||u>=900)throw new ue("incorect value");const d=Ne.VALUES_TO_ECI.get(u);if(d===void 0)throw new ue("incorect value");return d}static getCharacterSetECIByName(u){const d=Ne.NAME_TO_ECI.get(u);if(d===void 0)throw new ue("incorect value");return d}equals(u){if(!(u instanceof Ne))return!1;const d=u;return this.getName()===d.getName()}}Ne.VALUE_IDENTIFIER_TO_ECI=new Map,Ne.VALUES_TO_ECI=new Map,Ne.NAME_TO_ECI=new Map,Ne.Cp437=new Ne(we.Cp437,Int32Array.from([0,2]),"Cp437"),Ne.ISO8859_1=new Ne(we.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),Ne.ISO8859_2=new Ne(we.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),Ne.ISO8859_3=new Ne(we.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),Ne.ISO8859_4=new Ne(we.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),Ne.ISO8859_5=new Ne(we.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),Ne.ISO8859_6=new Ne(we.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),Ne.ISO8859_7=new Ne(we.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),Ne.ISO8859_8=new Ne(we.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),Ne.ISO8859_9=new Ne(we.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),Ne.ISO8859_10=new Ne(we.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),Ne.ISO8859_11=new Ne(we.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),Ne.ISO8859_13=new Ne(we.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),Ne.ISO8859_14=new Ne(we.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),Ne.ISO8859_15=new Ne(we.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),Ne.ISO8859_16=new Ne(we.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),Ne.SJIS=new Ne(we.SJIS,20,"SJIS","Shift_JIS"),Ne.Cp1250=new Ne(we.Cp1250,21,"Cp1250","windows-1250"),Ne.Cp1251=new Ne(we.Cp1251,22,"Cp1251","windows-1251"),Ne.Cp1252=new Ne(we.Cp1252,23,"Cp1252","windows-1252"),Ne.Cp1256=new Ne(we.Cp1256,24,"Cp1256","windows-1256"),Ne.UnicodeBigUnmarked=new Ne(we.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),Ne.UTF8=new Ne(we.UTF8,26,"UTF8","UTF-8"),Ne.ASCII=new Ne(we.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),Ne.Big5=new Ne(we.Big5,28,"Big5"),Ne.GB18030=new Ne(we.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),Ne.EUC_KR=new Ne(we.EUC_KR,30,"EUC_KR","EUC-KR");class it extends O{}it.kind="UnsupportedOperationException";class Bt{static decode(u,d){const m=this.encodingName(d);return this.customDecoder?this.customDecoder(u,m):typeof TextDecoder>"u"||this.shouldDecodeOnFallback(m)?this.decodeFallback(u,m):new TextDecoder(m).decode(u)}static shouldDecodeOnFallback(u){return!Bt.isBrowser()&&u==="ISO-8859-1"}static encode(u,d){const m=this.encodingName(d);return this.customEncoder?this.customEncoder(u,m):typeof TextEncoder>"u"?this.encodeFallback(u):new TextEncoder().encode(u)}static isBrowser(){return typeof window<"u"&&{}.toString.call(window)==="[object Window]"}static encodingName(u){return typeof u=="string"?u:u.getName()}static encodingCharacterSet(u){return u instanceof Ne?u:Ne.getCharacterSetECIByName(u)}static decodeFallback(u,d){const m=this.encodingCharacterSet(d);if(Bt.isDecodeFallbackSupported(m)){let b="";for(let w=0,S=u.length;w<S;w++){let E=u[w].toString(16);E.length<2&&(E="0"+E),b+="%"+E}return decodeURIComponent(b)}if(m.equals(Ne.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(u.buffer));throw new it(`Encoding ${this.encodingName(d)} not supported by fallback.`)}static isDecodeFallbackSupported(u){return u.equals(Ne.UTF8)||u.equals(Ne.ISO8859_1)||u.equals(Ne.ASCII)}static encodeFallback(u){const m=btoa(unescape(encodeURIComponent(u))).split(""),b=[];for(let w=0;w<m.length;w++)b.push(m[w].charCodeAt(0));return new Uint8Array(b)}}class ht{static castAsNonUtf8Char(u,d=null){const m=d?d.getName():this.ISO88591;return Bt.decode(new Uint8Array([u]),m)}static guessEncoding(u,d){if(d!=null&&d.get(Fe.CHARACTER_SET)!==void 0)return d.get(Fe.CHARACTER_SET).toString();const m=u.length;let b=!0,w=!0,S=!0,E=0,A=0,G=0,B=0,Z=0,U=0,ne=0,le=0,ce=0,ve=0,Re=0;const Xe=u.length>3&&u[0]===239&&u[1]===187&&u[2]===191;for(let Ye=0;Ye<m&&(b||w||S);Ye++){const Ke=u[Ye]&255;S&&(E>0?Ke&128?E--:S=!1:Ke&128&&(Ke&64?(E++,Ke&32?(E++,Ke&16?(E++,Ke&8?S=!1:B++):G++):A++):S=!1)),b&&(Ke>127&&Ke<160?b=!1:Ke>159&&(Ke<192||Ke===215||Ke===247)&&Re++),w&&(Z>0?Ke<64||Ke===127||Ke>252?w=!1:Z--:Ke===128||Ke===160||Ke>239?w=!1:Ke>160&&Ke<224?(U++,le=0,ne++,ne>ce&&(ce=ne)):Ke>127?(Z++,ne=0,le++,le>ve&&(ve=le)):(ne=0,le=0))}return S&&E>0&&(S=!1),w&&Z>0&&(w=!1),S&&(Xe||A+G+B>0)?ht.UTF8:w&&(ht.ASSUME_SHIFT_JIS||ce>=3||ve>=3)?ht.SHIFT_JIS:b&&w?ce===2&&U===2||Re*10>=m?ht.SHIFT_JIS:ht.ISO88591:b?ht.ISO88591:w?ht.SHIFT_JIS:S?ht.UTF8:ht.PLATFORM_DEFAULT_ENCODING}static format(u,...d){let m=-1;function b(S,E,A,G,B,Z){if(S==="%%")return"%";if(d[++m]===void 0)return;S=G?parseInt(G.substr(1)):void 0;let U=B?parseInt(B.substr(1)):void 0,ne;switch(Z){case"s":ne=d[m];break;case"c":ne=d[m][0];break;case"f":ne=parseFloat(d[m]).toFixed(S);break;case"p":ne=parseFloat(d[m]).toPrecision(S);break;case"e":ne=parseFloat(d[m]).toExponential(S);break;case"x":ne=parseInt(d[m]).toString(U||16);break;case"d":ne=parseFloat(parseInt(d[m],U||10).toPrecision(S)).toFixed(0);break}ne=typeof ne=="object"?JSON.stringify(ne):(+ne).toString(U);let le=parseInt(A),ce=A&&A[0]+""=="0"?"0":" ";for(;ne.length<le;)ne=E!==void 0?ne+ce:ce+ne;return ne}let w=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return u.replace(w,b)}static getBytes(u,d){return Bt.encode(u,d)}static getCharCode(u,d=0){return u.charCodeAt(d)}static getCharAt(u){return String.fromCharCode(u)}}ht.SHIFT_JIS=Ne.SJIS.getName(),ht.GB2312="GB2312",ht.ISO88591=Ne.ISO8859_1.getName(),ht.EUC_JP="EUC_JP",ht.UTF8=Ne.UTF8.getName(),ht.PLATFORM_DEFAULT_ENCODING=ht.UTF8,ht.ASSUME_SHIFT_JIS=!1;class _t{constructor(u=""){this.value=u}enableDecoding(u){return this.encoding=u,this}append(u){return typeof u=="string"?this.value+=u.toString():this.encoding?this.value+=ht.castAsNonUtf8Char(u,this.encoding):this.value+=String.fromCharCode(u),this}appendChars(u,d,m){for(let b=d;d<d+m;b++)this.append(u[b]);return this}length(){return this.value.length}charAt(u){return this.value.charAt(u)}deleteCharAt(u){this.value=this.value.substr(0,u)+this.value.substring(u+1)}setCharAt(u,d){this.value=this.value.substr(0,u)+d+this.value.substr(u+1)}substring(u,d){return this.value.substring(u,d)}setLengthToZero(){this.value=""}toString(){return this.value}insert(u,d){this.value=this.value.substr(0,u)+d+this.value.substr(u+d.length)}}class fn{constructor(u,d,m,b){if(this.width=u,this.height=d,this.rowSize=m,this.bits=b,d==null&&(d=u),this.height=d,u<1||d<1)throw new D("Both dimensions must be greater than 0");m==null&&(m=Math.floor((u+31)/32)),this.rowSize=m,b==null&&(this.bits=new Int32Array(this.rowSize*this.height))}static parseFromBooleanArray(u){const d=u.length,m=u[0].length,b=new fn(m,d);for(let w=0;w<d;w++){const S=u[w];for(let E=0;E<m;E++)S[E]&&b.set(E,w)}return b}static parseFromString(u,d,m){if(u===null)throw new D("stringRepresentation cannot be null");const b=new Array(u.length);let w=0,S=0,E=-1,A=0,G=0;for(;G<u.length;)if(u.charAt(G)===`
`||u.charAt(G)==="\r"){if(w>S){if(E===-1)E=w-S;else if(w-S!==E)throw new D("row lengths do not match");S=w,A++}G++}else if(u.substring(G,G+d.length)===d)G+=d.length,b[w]=!0,w++;else if(u.substring(G,G+m.length)===m)G+=m.length,b[w]=!1,w++;else throw new D("illegal character encountered: "+u.substring(G));if(w>S){if(E===-1)E=w-S;else if(w-S!==E)throw new D("row lengths do not match");A++}const B=new fn(E,A);for(let Z=0;Z<w;Z++)b[Z]&&B.set(Math.floor(Z%E),Math.floor(Z/E));return B}get(u,d){const m=d*this.rowSize+Math.floor(u/32);return(this.bits[m]>>>(u&31)&1)!==0}set(u,d){const m=d*this.rowSize+Math.floor(u/32);this.bits[m]|=1<<(u&31)&4294967295}unset(u,d){const m=d*this.rowSize+Math.floor(u/32);this.bits[m]&=~(1<<(u&31)&4294967295)}flip(u,d){const m=d*this.rowSize+Math.floor(u/32);this.bits[m]^=1<<(u&31)&4294967295}xor(u){if(this.width!==u.getWidth()||this.height!==u.getHeight()||this.rowSize!==u.getRowSize())throw new D("input matrix dimensions do not match");const d=new fe(Math.floor(this.width/32)+1),m=this.rowSize,b=this.bits;for(let w=0,S=this.height;w<S;w++){const E=w*m,A=u.getRow(w,d).getBitArray();for(let G=0;G<m;G++)b[E+G]^=A[G]}}clear(){const u=this.bits,d=u.length;for(let m=0;m<d;m++)u[m]=0}setRegion(u,d,m,b){if(d<0||u<0)throw new D("Left and top must be nonnegative");if(b<1||m<1)throw new D("Height and width must be at least 1");const w=u+m,S=d+b;if(S>this.height||w>this.width)throw new D("The region must fit inside the matrix");const E=this.rowSize,A=this.bits;for(let G=d;G<S;G++){const B=G*E;for(let Z=u;Z<w;Z++)A[B+Math.floor(Z/32)]|=1<<(Z&31)&4294967295}}getRow(u,d){d==null||d.getSize()<this.width?d=new fe(this.width):d.clear();const m=this.rowSize,b=this.bits,w=u*m;for(let S=0;S<m;S++)d.setBulk(S*32,b[w+S]);return d}setRow(u,d){se.arraycopy(d.getBitArray(),0,this.bits,u*this.rowSize,this.rowSize)}rotate180(){const u=this.getWidth(),d=this.getHeight();let m=new fe(u),b=new fe(u);for(let w=0,S=Math.floor((d+1)/2);w<S;w++)m=this.getRow(w,m),b=this.getRow(d-1-w,b),m.reverse(),b.reverse(),this.setRow(w,b),this.setRow(d-1-w,m)}getEnclosingRectangle(){const u=this.width,d=this.height,m=this.rowSize,b=this.bits;let w=u,S=d,E=-1,A=-1;for(let G=0;G<d;G++)for(let B=0;B<m;B++){const Z=b[G*m+B];if(Z!==0){if(G<S&&(S=G),G>A&&(A=G),B*32<w){let U=0;for(;!(Z<<31-U&4294967295);)U++;B*32+U<w&&(w=B*32+U)}if(B*32+31>E){let U=31;for(;!(Z>>>U);)U--;B*32+U>E&&(E=B*32+U)}}}return E<w||A<S?null:Int32Array.from([w,S,E-w+1,A-S+1])}getTopLeftOnBit(){const u=this.rowSize,d=this.bits;let m=0;for(;m<d.length&&d[m]===0;)m++;if(m===d.length)return null;const b=m/u;let w=m%u*32;const S=d[m];let E=0;for(;!(S<<31-E&4294967295);)E++;return w+=E,Int32Array.from([w,b])}getBottomRightOnBit(){const u=this.rowSize,d=this.bits;let m=d.length-1;for(;m>=0&&d[m]===0;)m--;if(m<0)return null;const b=Math.floor(m/u);let w=Math.floor(m%u)*32;const S=d[m];let E=31;for(;!(S>>>E);)E--;return w+=E,Int32Array.from([w,b])}getWidth(){return this.width}getHeight(){return this.height}getRowSize(){return this.rowSize}equals(u){if(!(u instanceof fn))return!1;const d=u;return this.width===d.width&&this.height===d.height&&this.rowSize===d.rowSize&&Y.equals(this.bits,d.bits)}hashCode(){let u=this.width;return u=31*u+this.width,u=31*u+this.height,u=31*u+this.rowSize,u=31*u+Y.hashCode(this.bits),u}toString(u="X ",d="  ",m=`
`){return this.buildToString(u,d,m)}buildToString(u,d,m){let b=new _t;for(let w=0,S=this.height;w<S;w++){for(let E=0,A=this.width;E<A;E++)b.append(this.get(E,w)?u:d);b.append(m)}return b.toString()}clone(){return new fn(this.width,this.height,this.rowSize,this.bits.slice())}}class Pe extends O{static getNotFoundInstance(){return new Pe}}Pe.kind="NotFoundException";class kn extends H{constructor(u){super(u),this.luminances=kn.EMPTY,this.buckets=new Int32Array(kn.LUMINANCE_BUCKETS)}getBlackRow(u,d){const m=this.getLuminanceSource(),b=m.getWidth();d==null||d.getSize()<b?d=new fe(b):d.clear(),this.initArrays(b);const w=m.getRow(u,this.luminances),S=this.buckets;for(let A=0;A<b;A++)S[(w[A]&255)>>kn.LUMINANCE_SHIFT]++;const E=kn.estimateBlackPoint(S);if(b<3)for(let A=0;A<b;A++)(w[A]&255)<E&&d.set(A);else{let A=w[0]&255,G=w[1]&255;for(let B=1;B<b-1;B++){const Z=w[B+1]&255;(G*4-A-Z)/2<E&&d.set(B),A=G,G=Z}}return d}getBlackMatrix(){const u=this.getLuminanceSource(),d=u.getWidth(),m=u.getHeight(),b=new fn(d,m);this.initArrays(d);const w=this.buckets;for(let A=1;A<5;A++){const G=Math.floor(m*A/5),B=u.getRow(G,this.luminances),Z=Math.floor(d*4/5);for(let U=Math.floor(d/5);U<Z;U++){const ne=B[U]&255;w[ne>>kn.LUMINANCE_SHIFT]++}}const S=kn.estimateBlackPoint(w),E=u.getMatrix();for(let A=0;A<m;A++){const G=A*d;for(let B=0;B<d;B++)(E[G+B]&255)<S&&b.set(B,A)}return b}createBinarizer(u){return new kn(u)}initArrays(u){this.luminances.length<u&&(this.luminances=new Uint8ClampedArray(u));const d=this.buckets;for(let m=0;m<kn.LUMINANCE_BUCKETS;m++)d[m]=0}static estimateBlackPoint(u){const d=u.length;let m=0,b=0,w=0;for(let B=0;B<d;B++)u[B]>w&&(b=B,w=u[B]),u[B]>m&&(m=u[B]);let S=0,E=0;for(let B=0;B<d;B++){const Z=B-b,U=u[B]*Z*Z;U>E&&(S=B,E=U)}if(b>S){const B=b;b=S,S=B}if(S-b<=d/16)throw new Pe;let A=S-1,G=-1;for(let B=S-1;B>b;B--){const Z=B-b,U=Z*Z*(S-B)*(m-u[B]);U>G&&(A=B,G=U)}return A<<kn.LUMINANCE_SHIFT}}kn.LUMINANCE_BITS=5,kn.LUMINANCE_SHIFT=8-kn.LUMINANCE_BITS,kn.LUMINANCE_BUCKETS=1<<kn.LUMINANCE_BITS,kn.EMPTY=Uint8ClampedArray.from([0]);class ut extends kn{constructor(u){super(u),this.matrix=null}getBlackMatrix(){if(this.matrix!==null)return this.matrix;const u=this.getLuminanceSource(),d=u.getWidth(),m=u.getHeight();if(d>=ut.MINIMUM_DIMENSION&&m>=ut.MINIMUM_DIMENSION){const b=u.getMatrix();let w=d>>ut.BLOCK_SIZE_POWER;d&ut.BLOCK_SIZE_MASK&&w++;let S=m>>ut.BLOCK_SIZE_POWER;m&ut.BLOCK_SIZE_MASK&&S++;const E=ut.calculateBlackPoints(b,w,S,d,m),A=new fn(d,m);ut.calculateThresholdForBlock(b,w,S,d,m,E,A),this.matrix=A}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(u){return new ut(u)}static calculateThresholdForBlock(u,d,m,b,w,S,E){const A=w-ut.BLOCK_SIZE,G=b-ut.BLOCK_SIZE;for(let B=0;B<m;B++){let Z=B<<ut.BLOCK_SIZE_POWER;Z>A&&(Z=A);const U=ut.cap(B,2,m-3);for(let ne=0;ne<d;ne++){let le=ne<<ut.BLOCK_SIZE_POWER;le>G&&(le=G);const ce=ut.cap(ne,2,d-3);let ve=0;for(let Xe=-2;Xe<=2;Xe++){const Ye=S[U+Xe];ve+=Ye[ce-2]+Ye[ce-1]+Ye[ce]+Ye[ce+1]+Ye[ce+2]}const Re=ve/25;ut.thresholdBlock(u,le,Z,Re,b,E)}}}static cap(u,d,m){return u<d?d:u>m?m:u}static thresholdBlock(u,d,m,b,w,S){for(let E=0,A=m*w+d;E<ut.BLOCK_SIZE;E++,A+=w)for(let G=0;G<ut.BLOCK_SIZE;G++)(u[A+G]&255)<=b&&S.set(d+G,m+E)}static calculateBlackPoints(u,d,m,b,w){const S=w-ut.BLOCK_SIZE,E=b-ut.BLOCK_SIZE,A=new Array(m);for(let G=0;G<m;G++){A[G]=new Int32Array(d);let B=G<<ut.BLOCK_SIZE_POWER;B>S&&(B=S);for(let Z=0;Z<d;Z++){let U=Z<<ut.BLOCK_SIZE_POWER;U>E&&(U=E);let ne=0,le=255,ce=0;for(let Re=0,Xe=B*b+U;Re<ut.BLOCK_SIZE;Re++,Xe+=b){for(let Ye=0;Ye<ut.BLOCK_SIZE;Ye++){const Ke=u[Xe+Ye]&255;ne+=Ke,Ke<le&&(le=Ke),Ke>ce&&(ce=Ke)}if(ce-le>ut.MIN_DYNAMIC_RANGE)for(Re++,Xe+=b;Re<ut.BLOCK_SIZE;Re++,Xe+=b)for(let Ye=0;Ye<ut.BLOCK_SIZE;Ye++)ne+=u[Xe+Ye]&255}let ve=ne>>ut.BLOCK_SIZE_POWER*2;if(ce-le<=ut.MIN_DYNAMIC_RANGE&&(ve=le/2,G>0&&Z>0)){const Re=(A[G-1][Z]+2*A[G][Z-1]+A[G-1][Z-1])/4;le<Re&&(ve=Re)}A[G][Z]=ve}}return A}}ut.BLOCK_SIZE_POWER=3,ut.BLOCK_SIZE=1<<ut.BLOCK_SIZE_POWER,ut.BLOCK_SIZE_MASK=ut.BLOCK_SIZE-1,ut.MINIMUM_DIMENSION=ut.BLOCK_SIZE*5,ut.MIN_DYNAMIC_RANGE=24;class Je{constructor(u,d){this.width=u,this.height=d}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(u,d,m,b){throw new it("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new it("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new it("This luminance source does not support rotation by 45 degrees.")}toString(){const u=new Uint8ClampedArray(this.width);let d=new _t;for(let m=0;m<this.height;m++){const b=this.getRow(m,u);for(let w=0;w<this.width;w++){const S=b[w]&255;let E;S<64?E="#":S<128?E="+":S<192?E=".":E=" ",d.append(E)}d.append(`
`)}return d.toString()}}class xt extends Je{constructor(u){super(u.getWidth(),u.getHeight()),this.delegate=u}getRow(u,d){const m=this.delegate.getRow(u,d),b=this.getWidth();for(let w=0;w<b;w++)m[w]=255-(m[w]&255);return m}getMatrix(){const u=this.delegate.getMatrix(),d=this.getWidth()*this.getHeight(),m=new Uint8ClampedArray(d);for(let b=0;b<d;b++)m[b]=255-(u[b]&255);return m}isCropSupported(){return this.delegate.isCropSupported()}crop(u,d,m,b){return new xt(this.delegate.crop(u,d,m,b))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new xt(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new xt(this.delegate.rotateCounterClockwise45())}}class We extends Je{constructor(u){super(u.width,u.height),this.canvas=u,this.tempCanvasElement=null,this.buffer=We.makeBufferFromCanvasImageData(u)}static makeBufferFromCanvasImageData(u){const d=u.getContext("2d").getImageData(0,0,u.width,u.height);return We.toGrayscaleBuffer(d.data,u.width,u.height)}static toGrayscaleBuffer(u,d,m){const b=new Uint8ClampedArray(d*m);for(let w=0,S=0,E=u.length;w<E;w+=4,S++){let A;if(u[w+3]===0)A=255;else{const B=u[w],Z=u[w+1],U=u[w+2];A=306*B+601*Z+117*U+512>>10}b[S]=A}return b}getRow(u,d){if(u<0||u>=this.getHeight())throw new D("Requested row is outside the image: "+u);const m=this.getWidth(),b=u*m;return d===null?d=this.buffer.slice(b,b+m):(d.length<m&&(d=new Uint8ClampedArray(m)),d.set(this.buffer.slice(b,b+m))),d}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(u,d,m,b){return super.crop(u,d,m,b),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(this.tempCanvasElement===null){const u=this.canvas.ownerDocument.createElement("canvas");u.width=this.canvas.width,u.height=this.canvas.height,this.tempCanvasElement=u}return this.tempCanvasElement}rotate(u){const d=this.getTempCanvasElement(),m=d.getContext("2d"),b=u*We.DEGREE_TO_RADIANS,w=this.canvas.width,S=this.canvas.height,E=Math.ceil(Math.abs(Math.cos(b))*w+Math.abs(Math.sin(b))*S),A=Math.ceil(Math.abs(Math.sin(b))*w+Math.abs(Math.cos(b))*S);return d.width=E,d.height=A,m.translate(E/2,A/2),m.rotate(b),m.drawImage(this.canvas,w/-2,S/-2),this.buffer=We.makeBufferFromCanvasImageData(d),this}invert(){return new xt(this)}}We.DEGREE_TO_RADIANS=Math.PI/180;class yn{constructor(u,d,m){this.deviceId=u,this.label=d,this.kind="videoinput",this.groupId=m||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var Lt=(globalThis||$a||self||window||void 0)&&(globalThis||$a||self||window||void 0).__awaiter||function(K,u,d,m){function b(w){return w instanceof d?w:new d(function(S){S(w)})}return new(d||(d=Promise))(function(w,S){function E(B){try{G(m.next(B))}catch(Z){S(Z)}}function A(B){try{G(m.throw(B))}catch(Z){S(Z)}}function G(B){B.done?w(B.value):b(B.value).then(E,A)}G((m=m.apply(K,u||[])).next())})};class qs{constructor(u,d=500,m){this.reader=u,this.timeBetweenScansMillis=d,this._hints=m,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return typeof navigator<"u"}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!!(this.isMediaDevicesSuported&&navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(u){this._timeBetweenDecodingAttempts=u<0?0:u}set hints(u){this._hints=u||null}get hints(){return this._hints}listVideoInputDevices(){return Lt(this,void 0,void 0,function*(){if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const u=yield navigator.mediaDevices.enumerateDevices(),d=[];for(const m of u){const b=m.kind==="video"?"videoinput":m.kind;if(b!=="videoinput")continue;const w=m.deviceId||m.id,S=m.label||`Video device ${d.length+1}`,E=m.groupId,A={deviceId:w,label:S,kind:b,groupId:E};d.push(A)}return d})}getVideoInputDevices(){return Lt(this,void 0,void 0,function*(){return(yield this.listVideoInputDevices()).map(d=>new yn(d.deviceId,d.label))})}findDeviceById(u){return Lt(this,void 0,void 0,function*(){const d=yield this.listVideoInputDevices();return d?d.find(m=>m.deviceId===u):null})}decodeFromInputVideoDevice(u,d){return Lt(this,void 0,void 0,function*(){return yield this.decodeOnceFromVideoDevice(u,d)})}decodeOnceFromVideoDevice(u,d){return Lt(this,void 0,void 0,function*(){this.reset();let m;u?m={deviceId:{exact:u}}:m={facingMode:"environment"};const b={video:m};return yield this.decodeOnceFromConstraints(b,d)})}decodeOnceFromConstraints(u,d){return Lt(this,void 0,void 0,function*(){const m=yield navigator.mediaDevices.getUserMedia(u);return yield this.decodeOnceFromStream(m,d)})}decodeOnceFromStream(u,d){return Lt(this,void 0,void 0,function*(){this.reset();const m=yield this.attachStreamToVideo(u,d);return yield this.decodeOnce(m)})}decodeFromInputVideoDeviceContinuously(u,d,m){return Lt(this,void 0,void 0,function*(){return yield this.decodeFromVideoDevice(u,d,m)})}decodeFromVideoDevice(u,d,m){return Lt(this,void 0,void 0,function*(){let b;u?b={deviceId:{exact:u}}:b={facingMode:"environment"};const w={video:b};return yield this.decodeFromConstraints(w,d,m)})}decodeFromConstraints(u,d,m){return Lt(this,void 0,void 0,function*(){const b=yield navigator.mediaDevices.getUserMedia(u);return yield this.decodeFromStream(b,d,m)})}decodeFromStream(u,d,m){return Lt(this,void 0,void 0,function*(){this.reset();const b=yield this.attachStreamToVideo(u,d);return yield this.decodeContinuously(b,m)})}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(u,d){return Lt(this,void 0,void 0,function*(){const m=this.prepareVideoElement(d);return this.addVideoSource(m,u),this.videoElement=m,this.stream=u,yield this.playVideoOnLoadAsync(m),m})}playVideoOnLoadAsync(u){return new Promise((d,m)=>this.playVideoOnLoad(u,()=>d()))}playVideoOnLoad(u,d){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(u),u.addEventListener("ended",this.videoEndedListener),u.addEventListener("canplay",this.videoCanPlayListener),u.addEventListener("playing",d),this.tryPlayVideo(u)}isVideoPlaying(u){return u.currentTime>0&&!u.paused&&!u.ended&&u.readyState>2}tryPlayVideo(u){return Lt(this,void 0,void 0,function*(){if(this.isVideoPlaying(u)){console.warn("Trying to play video that is already playing.");return}try{yield u.play()}catch{console.warn("It was not possible to play the video.")}})}getMediaElement(u,d){const m=document.getElementById(u);if(!m)throw new V(`element with id '${u}' not found`);if(m.nodeName.toLowerCase()!==d.toLowerCase())throw new V(`element with id '${u}' must be an ${d} element`);return m}decodeFromImage(u,d){if(!u&&!d)throw new V("either imageElement with a src set or an url must be provided");return d&&!u?this.decodeFromImageUrl(d):this.decodeFromImageElement(u)}decodeFromVideo(u,d){if(!u&&!d)throw new V("Either an element with a src set or an URL must be provided");return d&&!u?this.decodeFromVideoUrl(d):this.decodeFromVideoElement(u)}decodeFromVideoContinuously(u,d,m){if(u===void 0&&d===void 0)throw new V("Either an element with a src set or an URL must be provided");return d&&!u?this.decodeFromVideoUrlContinuously(d,m):this.decodeFromVideoElementContinuously(u,m)}decodeFromImageElement(u){if(!u)throw new V("An image element must be provided.");this.reset();const d=this.prepareImageElement(u);this.imageElement=d;let m;return this.isImageLoaded(d)?m=this.decodeOnce(d,!1,!0):m=this._decodeOnLoadImage(d),m}decodeFromVideoElement(u){const d=this._decodeFromVideoElementSetup(u);return this._decodeOnLoadVideo(d)}decodeFromVideoElementContinuously(u,d){const m=this._decodeFromVideoElementSetup(u);return this._decodeOnLoadVideoContinuously(m,d)}_decodeFromVideoElementSetup(u){if(!u)throw new V("A video element must be provided.");this.reset();const d=this.prepareVideoElement(u);return this.videoElement=d,d}decodeFromImageUrl(u){if(!u)throw new V("An URL must be provided.");this.reset();const d=this.prepareImageElement();this.imageElement=d;const m=this._decodeOnLoadImage(d);return d.src=u,m}decodeFromVideoUrl(u){if(!u)throw new V("An URL must be provided.");this.reset();const d=this.prepareVideoElement(),m=this.decodeFromVideoElement(d);return d.src=u,m}decodeFromVideoUrlContinuously(u,d){if(!u)throw new V("An URL must be provided.");this.reset();const m=this.prepareVideoElement(),b=this.decodeFromVideoElementContinuously(m,d);return m.src=u,b}_decodeOnLoadImage(u){return new Promise((d,m)=>{this.imageLoadedListener=()=>this.decodeOnce(u,!1,!0).then(d,m),u.addEventListener("load",this.imageLoadedListener)})}_decodeOnLoadVideo(u){return Lt(this,void 0,void 0,function*(){return yield this.playVideoOnLoadAsync(u),yield this.decodeOnce(u)})}_decodeOnLoadVideoContinuously(u,d){return Lt(this,void 0,void 0,function*(){yield this.playVideoOnLoadAsync(u),this.decodeContinuously(u,d)})}isImageLoaded(u){return!(!u.complete||u.naturalWidth===0)}prepareImageElement(u){let d;return typeof u>"u"&&(d=document.createElement("img"),d.width=200,d.height=200),typeof u=="string"&&(d=this.getMediaElement(u,"img")),u instanceof HTMLImageElement&&(d=u),d}prepareVideoElement(u){let d;return!u&&typeof document<"u"&&(d=document.createElement("video"),d.width=200,d.height=200),typeof u=="string"&&(d=this.getMediaElement(u,"video")),u instanceof HTMLVideoElement&&(d=u),d.setAttribute("autoplay","true"),d.setAttribute("muted","true"),d.setAttribute("playsinline","true"),d}decodeOnce(u,d=!0,m=!0){this._stopAsyncDecode=!1;const b=(w,S)=>{if(this._stopAsyncDecode){S(new Pe("Video stream has ended before any code could be detected.")),this._stopAsyncDecode=void 0;return}try{const E=this.decode(u);w(E)}catch(E){const A=d&&E instanceof Pe,B=(E instanceof re||E instanceof ue)&&m;if(A||B)return setTimeout(b,this._timeBetweenDecodingAttempts,w,S);S(E)}};return new Promise((w,S)=>b(w,S))}decodeContinuously(u,d){this._stopContinuousDecode=!1;const m=()=>{if(this._stopContinuousDecode){this._stopContinuousDecode=void 0;return}try{const b=this.decode(u);d(b,null),setTimeout(m,this.timeBetweenScansMillis)}catch(b){d(null,b);const w=b instanceof re||b instanceof ue,S=b instanceof Pe;(w||S)&&setTimeout(m,this._timeBetweenDecodingAttempts)}};m()}decode(u){const d=this.createBinaryBitmap(u);return this.decodeBitmap(d)}_isHTMLVideoElement(u){return u.videoWidth!==0}drawFrameOnCanvas(u,d,m){d||(d={sx:0,sy:0,sWidth:u.videoWidth,sHeight:u.videoHeight,dx:0,dy:0,dWidth:u.videoWidth,dHeight:u.videoHeight}),m||(m=this.captureCanvasContext),m.drawImage(u,d.sx,d.sy,d.sWidth,d.sHeight,d.dx,d.dy,d.dWidth,d.dHeight)}drawImageOnCanvas(u,d,m=this.captureCanvasContext){d||(d={sx:0,sy:0,sWidth:u.naturalWidth,sHeight:u.naturalHeight,dx:0,dy:0,dWidth:u.naturalWidth,dHeight:u.naturalHeight}),m||(m=this.captureCanvasContext),m.drawImage(u,d.sx,d.sy,d.sWidth,d.sHeight,d.dx,d.dy,d.dWidth,d.dHeight)}createBinaryBitmap(u){this.getCaptureCanvasContext(u),this._isHTMLVideoElement(u)?this.drawFrameOnCanvas(u):this.drawImageOnCanvas(u);const d=this.getCaptureCanvas(u),m=new We(d),b=new ut(m);return new $(b)}getCaptureCanvasContext(u){if(!this.captureCanvasContext){const m=this.getCaptureCanvas(u).getContext("2d");this.captureCanvasContext=m}return this.captureCanvasContext}getCaptureCanvas(u){if(!this.captureCanvas){const d=this.createCaptureCanvas(u);this.captureCanvas=d}return this.captureCanvas}decodeBitmap(u){return this.reader.decode(u,this._hints)}createCaptureCanvas(u){if(typeof document>"u")return this._destroyCaptureCanvas(),null;const d=document.createElement("canvas");let m,b;return typeof u<"u"&&(u instanceof HTMLVideoElement?(m=u.videoWidth,b=u.videoHeight):u instanceof HTMLImageElement&&(m=u.naturalWidth||u.width,b=u.naturalHeight||u.height)),d.style.width=m+"px",d.style.height=b+"px",d.width=m,d.height=b,d}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach(u=>u.stop()),this.stream=void 0),this._stopAsyncDecode===!1&&this.stopAsyncDecode(),this._stopContinuousDecode===!1&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){this.videoElement&&(typeof this.videoEndedListener<"u"&&this.videoElement.removeEventListener("ended",this.videoEndedListener),typeof this.videoPlayingEventListener<"u"&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),typeof this.videoCanPlayListener<"u"&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){this.imageElement&&(this.imageLoadedListener!==void 0&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(u,d){try{u.srcObject=d}catch{u.src=URL.createObjectURL(d)}}cleanVideoSource(u){try{u.srcObject=null}catch{u.src=""}this.videoElement.removeAttribute("src")}}class En{constructor(u,d,m=d==null?0:8*d.length,b,w,S=se.currentTimeMillis()){this.text=u,this.rawBytes=d,this.numBits=m,this.resultPoints=b,this.format=w,this.timestamp=S,this.text=u,this.rawBytes=d,m==null?this.numBits=d==null?0:8*d.length:this.numBits=m,this.resultPoints=b,this.format=w,this.resultMetadata=null,S==null?this.timestamp=se.currentTimeMillis():this.timestamp=S}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(u,d){this.resultMetadata===null&&(this.resultMetadata=new Map),this.resultMetadata.set(u,d)}putAllMetadata(u){u!==null&&(this.resultMetadata===null?this.resultMetadata=u:this.resultMetadata=new Map(u))}addResultPoints(u){const d=this.resultPoints;if(d===null)this.resultPoints=u;else if(u!==null&&u.length>0){const m=new Array(d.length+u.length);se.arraycopy(d,0,m,0,d.length),se.arraycopy(u,0,m,d.length,u.length),this.resultPoints=m}}getTimestamp(){return this.timestamp}toString(){return this.text}}var $n;(function(K){K[K.AZTEC=0]="AZTEC",K[K.CODABAR=1]="CODABAR",K[K.CODE_39=2]="CODE_39",K[K.CODE_93=3]="CODE_93",K[K.CODE_128=4]="CODE_128",K[K.DATA_MATRIX=5]="DATA_MATRIX",K[K.EAN_8=6]="EAN_8",K[K.EAN_13=7]="EAN_13",K[K.ITF=8]="ITF",K[K.MAXICODE=9]="MAXICODE",K[K.PDF_417=10]="PDF_417",K[K.QR_CODE=11]="QR_CODE",K[K.RSS_14=12]="RSS_14",K[K.RSS_EXPANDED=13]="RSS_EXPANDED",K[K.UPC_A=14]="UPC_A",K[K.UPC_E=15]="UPC_E",K[K.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})($n||($n={}));var yt=$n,jr;(function(K){K[K.OTHER=0]="OTHER",K[K.ORIENTATION=1]="ORIENTATION",K[K.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",K[K.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",K[K.ISSUE_NUMBER=4]="ISSUE_NUMBER",K[K.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",K[K.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",K[K.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",K[K.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",K[K.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",K[K.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY"})(jr||(jr={}));var bn=jr;class Bi{constructor(u,d,m,b,w=-1,S=-1){this.rawBytes=u,this.text=d,this.byteSegments=m,this.ecLevel=b,this.structuredAppendSequenceNumber=w,this.structuredAppendParity=S,this.numBits=u==null?0:8*u.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(u){this.numBits=u}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(u){this.errorsCorrected=u}getErasures(){return this.erasures}setErasures(u){this.erasures=u}getOther(){return this.other}setOther(u){this.other=u}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class Po{exp(u){return this.expTable[u]}log(u){if(u===0)throw new D;return this.logTable[u]}static addOrSubtract(u,d){return u^d}}class ls{constructor(u,d){if(d.length===0)throw new D;this.field=u;const m=d.length;if(m>1&&d[0]===0){let b=1;for(;b<m&&d[b]===0;)b++;b===m?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(m-b),se.arraycopy(d,b,this.coefficients,0,this.coefficients.length))}else this.coefficients=d}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(u){return this.coefficients[this.coefficients.length-1-u]}evaluateAt(u){if(u===0)return this.getCoefficient(0);const d=this.coefficients;let m;if(u===1){m=0;for(let S=0,E=d.length;S!==E;S++){const A=d[S];m=Po.addOrSubtract(m,A)}return m}m=d[0];const b=d.length,w=this.field;for(let S=1;S<b;S++)m=Po.addOrSubtract(w.multiply(u,m),d[S]);return m}addOrSubtract(u){if(!this.field.equals(u.field))throw new D("GenericGFPolys do not have same GenericGF field");if(this.isZero())return u;if(u.isZero())return this;let d=this.coefficients,m=u.coefficients;if(d.length>m.length){const S=d;d=m,m=S}let b=new Int32Array(m.length);const w=m.length-d.length;se.arraycopy(m,0,b,0,w);for(let S=w;S<m.length;S++)b[S]=Po.addOrSubtract(d[S-w],m[S]);return new ls(this.field,b)}multiply(u){if(!this.field.equals(u.field))throw new D("GenericGFPolys do not have same GenericGF field");if(this.isZero()||u.isZero())return this.field.getZero();const d=this.coefficients,m=d.length,b=u.coefficients,w=b.length,S=new Int32Array(m+w-1),E=this.field;for(let A=0;A<m;A++){const G=d[A];for(let B=0;B<w;B++)S[A+B]=Po.addOrSubtract(S[A+B],E.multiply(G,b[B]))}return new ls(E,S)}multiplyScalar(u){if(u===0)return this.field.getZero();if(u===1)return this;const d=this.coefficients.length,m=this.field,b=new Int32Array(d),w=this.coefficients;for(let S=0;S<d;S++)b[S]=m.multiply(w[S],u);return new ls(m,b)}multiplyByMonomial(u,d){if(u<0)throw new D;if(d===0)return this.field.getZero();const m=this.coefficients,b=m.length,w=new Int32Array(b+u),S=this.field;for(let E=0;E<b;E++)w[E]=S.multiply(m[E],d);return new ls(S,w)}divide(u){if(!this.field.equals(u.field))throw new D("GenericGFPolys do not have same GenericGF field");if(u.isZero())throw new D("Divide by 0");const d=this.field;let m=d.getZero(),b=this;const w=u.getCoefficient(u.getDegree()),S=d.inverse(w);for(;b.getDegree()>=u.getDegree()&&!b.isZero();){const E=b.getDegree()-u.getDegree(),A=d.multiply(b.getCoefficient(b.getDegree()),S),G=u.multiplyByMonomial(E,A),B=d.buildMonomial(E,A);m=m.addOrSubtract(B),b=b.addOrSubtract(G)}return[m,b]}toString(){let u="";for(let d=this.getDegree();d>=0;d--){let m=this.getCoefficient(d);if(m!==0){if(m<0?(u+=" - ",m=-m):u.length>0&&(u+=" + "),d===0||m!==1){const b=this.field.log(m);b===0?u+="1":b===1?u+="a":(u+="a^",u+=b)}d!==0&&(d===1?u+="x":(u+="x^",u+=d))}}return u}}class wh extends O{}wh.kind="ArithmeticException";class an extends Po{constructor(u,d,m){super(),this.primitive=u,this.size=d,this.generatorBase=m;const b=new Int32Array(d);let w=1;for(let E=0;E<d;E++)b[E]=w,w*=2,w>=d&&(w^=u,w&=d-1);this.expTable=b;const S=new Int32Array(d);for(let E=0;E<d-1;E++)S[b[E]]=E;this.logTable=S,this.zero=new ls(this,Int32Array.from([0])),this.one=new ls(this,Int32Array.from([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(u,d){if(u<0)throw new D;if(d===0)return this.zero;const m=new Int32Array(u+1);return m[0]=d,new ls(this,m)}inverse(u){if(u===0)throw new wh;return this.expTable[this.size-this.logTable[u]-1]}multiply(u,d){return u===0||d===0?0:this.expTable[(this.logTable[u]+this.logTable[d])%(this.size-1)]}getSize(){return this.size}getGeneratorBase(){return this.generatorBase}toString(){return"GF(0x"+j.toHexString(this.primitive)+","+this.size+")"}equals(u){return u===this}}an.AZTEC_DATA_12=new an(4201,4096,1),an.AZTEC_DATA_10=new an(1033,1024,1),an.AZTEC_DATA_6=new an(67,64,1),an.AZTEC_PARAM=new an(19,16,1),an.QR_CODE_FIELD_256=new an(285,256,0),an.DATA_MATRIX_FIELD_256=new an(301,256,1),an.AZTEC_DATA_8=an.DATA_MATRIX_FIELD_256,an.MAXICODE_FIELD_64=an.AZTEC_DATA_6;class Nl extends O{}Nl.kind="ReedSolomonException";class Wi extends O{}Wi.kind="IllegalStateException";class ke{constructor(u){this.field=u}decode(u,d){const m=this.field,b=new ls(m,u),w=new Int32Array(d);let S=!0;for(let ne=0;ne<d;ne++){const le=b.evaluateAt(m.exp(ne+m.getGeneratorBase()));w[w.length-1-ne]=le,le!==0&&(S=!1)}if(S)return;const E=new ls(m,w),A=this.runEuclideanAlgorithm(m.buildMonomial(d,1),E,d),G=A[0],B=A[1],Z=this.findErrorLocations(G),U=this.findErrorMagnitudes(B,Z);for(let ne=0;ne<Z.length;ne++){const le=u.length-1-m.log(Z[ne]);if(le<0)throw new Nl("Bad error location");u[le]=an.addOrSubtract(u[le],U[ne])}}runEuclideanAlgorithm(u,d,m){if(u.getDegree()<d.getDegree()){const ne=u;u=d,d=ne}const b=this.field;let w=u,S=d,E=b.getZero(),A=b.getOne();for(;S.getDegree()>=(m/2|0);){let ne=w,le=E;if(w=S,E=A,w.isZero())throw new Nl("r_{i-1} was zero");S=ne;let ce=b.getZero();const ve=w.getCoefficient(w.getDegree()),Re=b.inverse(ve);for(;S.getDegree()>=w.getDegree()&&!S.isZero();){const Xe=S.getDegree()-w.getDegree(),Ye=b.multiply(S.getCoefficient(S.getDegree()),Re);ce=ce.addOrSubtract(b.buildMonomial(Xe,Ye)),S=S.addOrSubtract(w.multiplyByMonomial(Xe,Ye))}if(A=ce.multiply(E).addOrSubtract(le),S.getDegree()>=w.getDegree())throw new Wi("Division algorithm failed to reduce polynomial?")}const G=A.getCoefficient(0);if(G===0)throw new Nl("sigmaTilde(0) was zero");const B=b.inverse(G),Z=A.multiplyScalar(B),U=S.multiplyScalar(B);return[Z,U]}findErrorLocations(u){const d=u.getDegree();if(d===1)return Int32Array.from([u.getCoefficient(1)]);const m=new Int32Array(d);let b=0;const w=this.field;for(let S=1;S<w.getSize()&&b<d;S++)u.evaluateAt(S)===0&&(m[b]=w.inverse(S),b++);if(b!==d)throw new Nl("Error locator degree does not match number of roots");return m}findErrorMagnitudes(u,d){const m=d.length,b=new Int32Array(m),w=this.field;for(let S=0;S<m;S++){const E=w.inverse(d[S]);let A=1;for(let G=0;G<m;G++)if(S!==G){const B=w.multiply(d[G],E),Z=B&1?B&-2:B|1;A=w.multiply(A,Z)}b[S]=w.multiply(u.evaluateAt(E),w.inverse(A)),w.getGeneratorBase()!==0&&(b[S]=w.multiply(b[S],E))}return b}}var Ar;(function(K){K[K.UPPER=0]="UPPER",K[K.LOWER=1]="LOWER",K[K.MIXED=2]="MIXED",K[K.DIGIT=3]="DIGIT",K[K.PUNCT=4]="PUNCT",K[K.BINARY=5]="BINARY"})(Ar||(Ar={}));class Cn{decode(u){this.ddata=u;let d=u.getBits(),m=this.extractBits(d),b=this.correctBits(m),w=Cn.convertBoolArrayToByteArray(b),S=Cn.getEncodedData(b),E=new Bi(w,S,null,null);return E.setNumBits(b.length),E}static highLevelDecode(u){return this.getEncodedData(u)}static getEncodedData(u){let d=u.length,m=Ar.UPPER,b=Ar.UPPER,w="",S=0;for(;S<d;)if(b===Ar.BINARY){if(d-S<5)break;let E=Cn.readCode(u,S,5);if(S+=5,E===0){if(d-S<11)break;E=Cn.readCode(u,S,11)+31,S+=11}for(let A=0;A<E;A++){if(d-S<8){S=d;break}const G=Cn.readCode(u,S,8);w+=ht.castAsNonUtf8Char(G),S+=8}b=m}else{let E=b===Ar.DIGIT?4:5;if(d-S<E)break;let A=Cn.readCode(u,S,E);S+=E;let G=Cn.getCharacter(b,A);G.startsWith("CTRL_")?(m=b,b=Cn.getTable(G.charAt(5)),G.charAt(6)==="L"&&(m=b)):(w+=G,b=m)}return w}static getTable(u){switch(u){case"L":return Ar.LOWER;case"P":return Ar.PUNCT;case"M":return Ar.MIXED;case"D":return Ar.DIGIT;case"B":return Ar.BINARY;case"U":default:return Ar.UPPER}}static getCharacter(u,d){switch(u){case Ar.UPPER:return Cn.UPPER_TABLE[d];case Ar.LOWER:return Cn.LOWER_TABLE[d];case Ar.MIXED:return Cn.MIXED_TABLE[d];case Ar.PUNCT:return Cn.PUNCT_TABLE[d];case Ar.DIGIT:return Cn.DIGIT_TABLE[d];default:throw new Wi("Bad table")}}correctBits(u){let d,m;this.ddata.getNbLayers()<=2?(m=6,d=an.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(m=8,d=an.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(m=10,d=an.AZTEC_DATA_10):(m=12,d=an.AZTEC_DATA_12);let b=this.ddata.getNbDatablocks(),w=u.length/m;if(w<b)throw new ue;let S=u.length%m,E=new Int32Array(w);for(let U=0;U<w;U++,S+=m)E[U]=Cn.readCode(u,S,m);try{new ke(d).decode(E,w-b)}catch(U){throw new ue(U)}let A=(1<<m)-1,G=0;for(let U=0;U<b;U++){let ne=E[U];if(ne===0||ne===A)throw new ue;(ne===1||ne===A-1)&&G++}let B=new Array(b*m-G),Z=0;for(let U=0;U<b;U++){let ne=E[U];if(ne===1||ne===A-1)B.fill(ne>1,Z,Z+m-1),Z+=m-1;else for(let le=m-1;le>=0;--le)B[Z++]=(ne&1<<le)!==0}return B}extractBits(u){let d=this.ddata.isCompact(),m=this.ddata.getNbLayers(),b=(d?11:14)+m*4,w=new Int32Array(b),S=new Array(this.totalBitsInLayer(m,d));if(d)for(let E=0;E<w.length;E++)w[E]=E;else{let E=b+1+2*j.truncDivision(j.truncDivision(b,2)-1,15),A=b/2,G=j.truncDivision(E,2);for(let B=0;B<A;B++){let Z=B+j.truncDivision(B,15);w[A-B-1]=G-Z-1,w[A+B]=G+Z+1}}for(let E=0,A=0;E<m;E++){let G=(m-E)*4+(d?9:12),B=E*2,Z=b-1-B;for(let U=0;U<G;U++){let ne=U*2;for(let le=0;le<2;le++)S[A+ne+le]=u.get(w[B+le],w[B+U]),S[A+2*G+ne+le]=u.get(w[B+U],w[Z-le]),S[A+4*G+ne+le]=u.get(w[Z-le],w[Z-U]),S[A+6*G+ne+le]=u.get(w[Z-U],w[B+le])}A+=G*8}return S}static readCode(u,d,m){let b=0;for(let w=d;w<d+m;w++)b<<=1,u[w]&&(b|=1);return b}static readByte(u,d){let m=u.length-d;return m>=8?Cn.readCode(u,d,8):Cn.readCode(u,d,m)<<8-m}static convertBoolArrayToByteArray(u){let d=new Uint8Array((u.length+7)/8);for(let m=0;m<d.length;m++)d[m]=Cn.readByte(u,8*m);return d}totalBitsInLayer(u,d){return((d?88:112)+16*u)*u}}Cn.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],Cn.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],Cn.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","	",`
`,"\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],Cn.PUNCT_TABLE=["","\r",`\r
`,". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],Cn.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"];class Ht{constructor(){}static round(u){return u===NaN?0:u<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:u>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:u+(u<0?-.5:.5)|0}static distance(u,d,m,b){const w=u-m,S=d-b;return Math.sqrt(w*w+S*S)}static sum(u){let d=0;for(let m=0,b=u.length;m!==b;m++){const w=u[m];d+=w}return d}}class Yu{static floatToIntBits(u){return u}}Yu.MAX_VALUE=Number.MAX_SAFE_INTEGER;class gt{constructor(u,d){this.x=u,this.y=d}getX(){return this.x}getY(){return this.y}equals(u){if(u instanceof gt){const d=u;return this.x===d.x&&this.y===d.y}return!1}hashCode(){return 31*Yu.floatToIntBits(this.x)+Yu.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(u){const d=this.distance(u[0],u[1]),m=this.distance(u[1],u[2]),b=this.distance(u[0],u[2]);let w,S,E;if(m>=d&&m>=b?(S=u[0],w=u[1],E=u[2]):b>=m&&b>=d?(S=u[1],w=u[0],E=u[2]):(S=u[2],w=u[0],E=u[1]),this.crossProductZ(w,S,E)<0){const A=w;w=E,E=A}u[0]=w,u[1]=S,u[2]=E}static distance(u,d){return Ht.distance(u.x,u.y,d.x,d.y)}static crossProductZ(u,d,m){const b=d.x,w=d.y;return(m.x-b)*(u.y-w)-(m.y-w)*(u.x-b)}}class Al{constructor(u,d){this.bits=u,this.points=d}getBits(){return this.bits}getPoints(){return this.points}}class Qu extends Al{constructor(u,d,m,b,w){super(u,d),this.compact=m,this.nbDatablocks=b,this.nbLayers=w}getNbLayers(){return this.nbLayers}getNbDatablocks(){return this.nbDatablocks}isCompact(){return this.compact}}class _s{constructor(u,d,m,b){this.image=u,this.height=u.getHeight(),this.width=u.getWidth(),d==null&&(d=_s.INIT_SIZE),m==null&&(m=u.getWidth()/2|0),b==null&&(b=u.getHeight()/2|0);const w=d/2|0;if(this.leftInit=m-w,this.rightInit=m+w,this.upInit=b-w,this.downInit=b+w,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new Pe}detect(){let u=this.leftInit,d=this.rightInit,m=this.upInit,b=this.downInit,w=!1,S=!0,E=!1,A=!1,G=!1,B=!1,Z=!1;const U=this.width,ne=this.height;for(;S;){S=!1;let le=!0;for(;(le||!A)&&d<U;)le=this.containsBlackPoint(m,b,d,!1),le?(d++,S=!0,A=!0):A||d++;if(d>=U){w=!0;break}let ce=!0;for(;(ce||!G)&&b<ne;)ce=this.containsBlackPoint(u,d,b,!0),ce?(b++,S=!0,G=!0):G||b++;if(b>=ne){w=!0;break}let ve=!0;for(;(ve||!B)&&u>=0;)ve=this.containsBlackPoint(m,b,u,!1),ve?(u--,S=!0,B=!0):B||u--;if(u<0){w=!0;break}let Re=!0;for(;(Re||!Z)&&m>=0;)Re=this.containsBlackPoint(u,d,m,!0),Re?(m--,S=!0,Z=!0):Z||m--;if(m<0){w=!0;break}S&&(E=!0)}if(!w&&E){const le=d-u;let ce=null;for(let Ye=1;ce===null&&Ye<le;Ye++)ce=this.getBlackPointOnSegment(u,b-Ye,u+Ye,b);if(ce==null)throw new Pe;let ve=null;for(let Ye=1;ve===null&&Ye<le;Ye++)ve=this.getBlackPointOnSegment(u,m+Ye,u+Ye,m);if(ve==null)throw new Pe;let Re=null;for(let Ye=1;Re===null&&Ye<le;Ye++)Re=this.getBlackPointOnSegment(d,m+Ye,d-Ye,m);if(Re==null)throw new Pe;let Xe=null;for(let Ye=1;Xe===null&&Ye<le;Ye++)Xe=this.getBlackPointOnSegment(d,b-Ye,d-Ye,b);if(Xe==null)throw new Pe;return this.centerEdges(Xe,ce,Re,ve)}else throw new Pe}getBlackPointOnSegment(u,d,m,b){const w=Ht.round(Ht.distance(u,d,m,b)),S=(m-u)/w,E=(b-d)/w,A=this.image;for(let G=0;G<w;G++){const B=Ht.round(u+G*S),Z=Ht.round(d+G*E);if(A.get(B,Z))return new gt(B,Z)}return null}centerEdges(u,d,m,b){const w=u.getX(),S=u.getY(),E=d.getX(),A=d.getY(),G=m.getX(),B=m.getY(),Z=b.getX(),U=b.getY(),ne=_s.CORR;return w<this.width/2?[new gt(Z-ne,U+ne),new gt(E+ne,A+ne),new gt(G-ne,B-ne),new gt(w+ne,S-ne)]:[new gt(Z+ne,U+ne),new gt(E+ne,A-ne),new gt(G-ne,B+ne),new gt(w-ne,S-ne)]}containsBlackPoint(u,d,m,b){const w=this.image;if(b){for(let S=u;S<=d;S++)if(w.get(S,m))return!0}else for(let S=u;S<=d;S++)if(w.get(m,S))return!0;return!1}}_s.INIT_SIZE=10,_s.CORR=1;class Fo{static checkAndNudgePoints(u,d){const m=u.getWidth(),b=u.getHeight();let w=!0;for(let S=0;S<d.length&&w;S+=2){const E=Math.floor(d[S]),A=Math.floor(d[S+1]);if(E<-1||E>m||A<-1||A>b)throw new Pe;w=!1,E===-1?(d[S]=0,w=!0):E===m&&(d[S]=m-1,w=!0),A===-1?(d[S+1]=0,w=!0):A===b&&(d[S+1]=b-1,w=!0)}w=!0;for(let S=d.length-2;S>=0&&w;S-=2){const E=Math.floor(d[S]),A=Math.floor(d[S+1]);if(E<-1||E>m||A<-1||A>b)throw new Pe;w=!1,E===-1?(d[S]=0,w=!0):E===m&&(d[S]=m-1,w=!0),A===-1?(d[S+1]=0,w=!0):A===b&&(d[S+1]=b-1,w=!0)}}}class Yr{constructor(u,d,m,b,w,S,E,A,G){this.a11=u,this.a21=d,this.a31=m,this.a12=b,this.a22=w,this.a32=S,this.a13=E,this.a23=A,this.a33=G}static quadrilateralToQuadrilateral(u,d,m,b,w,S,E,A,G,B,Z,U,ne,le,ce,ve){const Re=Yr.quadrilateralToSquare(u,d,m,b,w,S,E,A);return Yr.squareToQuadrilateral(G,B,Z,U,ne,le,ce,ve).times(Re)}transformPoints(u){const d=u.length,m=this.a11,b=this.a12,w=this.a13,S=this.a21,E=this.a22,A=this.a23,G=this.a31,B=this.a32,Z=this.a33;for(let U=0;U<d;U+=2){const ne=u[U],le=u[U+1],ce=w*ne+A*le+Z;u[U]=(m*ne+S*le+G)/ce,u[U+1]=(b*ne+E*le+B)/ce}}transformPointsWithValues(u,d){const m=this.a11,b=this.a12,w=this.a13,S=this.a21,E=this.a22,A=this.a23,G=this.a31,B=this.a32,Z=this.a33,U=u.length;for(let ne=0;ne<U;ne++){const le=u[ne],ce=d[ne],ve=w*le+A*ce+Z;u[ne]=(m*le+S*ce+G)/ve,d[ne]=(b*le+E*ce+B)/ve}}static squareToQuadrilateral(u,d,m,b,w,S,E,A){const G=u-m+w-E,B=d-b+S-A;if(G===0&&B===0)return new Yr(m-u,w-m,u,b-d,S-b,d,0,0,1);{const Z=m-w,U=E-w,ne=b-S,le=A-S,ce=Z*le-U*ne,ve=(G*le-U*B)/ce,Re=(Z*B-G*ne)/ce;return new Yr(m-u+ve*m,E-u+Re*E,u,b-d+ve*b,A-d+Re*A,d,ve,Re,1)}}static quadrilateralToSquare(u,d,m,b,w,S,E,A){return Yr.squareToQuadrilateral(u,d,m,b,w,S,E,A).buildAdjoint()}buildAdjoint(){return new Yr(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(u){return new Yr(this.a11*u.a11+this.a21*u.a12+this.a31*u.a13,this.a11*u.a21+this.a21*u.a22+this.a31*u.a23,this.a11*u.a31+this.a21*u.a32+this.a31*u.a33,this.a12*u.a11+this.a22*u.a12+this.a32*u.a13,this.a12*u.a21+this.a22*u.a22+this.a32*u.a23,this.a12*u.a31+this.a22*u.a32+this.a32*u.a33,this.a13*u.a11+this.a23*u.a12+this.a33*u.a13,this.a13*u.a21+this.a23*u.a22+this.a33*u.a23,this.a13*u.a31+this.a23*u.a32+this.a33*u.a33)}}class vh extends Fo{sampleGrid(u,d,m,b,w,S,E,A,G,B,Z,U,ne,le,ce,ve,Re,Xe,Ye){const Ke=Yr.quadrilateralToQuadrilateral(b,w,S,E,A,G,B,Z,U,ne,le,ce,ve,Re,Xe,Ye);return this.sampleGridWithTransform(u,d,m,Ke)}sampleGridWithTransform(u,d,m,b){if(d<=0||m<=0)throw new Pe;const w=new fn(d,m),S=new Float32Array(2*d);for(let E=0;E<m;E++){const A=S.length,G=E+.5;for(let B=0;B<A;B+=2)S[B]=B/2+.5,S[B+1]=G;b.transformPoints(S),Fo.checkAndNudgePoints(u,S);try{for(let B=0;B<A;B+=2)u.get(Math.floor(S[B]),Math.floor(S[B+1]))&&w.set(B/2,E)}catch{throw new Pe}}return w}}class zi{static setGridSampler(u){zi.gridSampler=u}static getInstance(){return zi.gridSampler}}zi.gridSampler=new vh;class Br{constructor(u,d){this.x=u,this.y=d}toResultPoint(){return new gt(this.getX(),this.getY())}getX(){return this.x}getY(){return this.y}}class Ju{constructor(u){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=u}detect(){return this.detectMirror(!1)}detectMirror(u){let d=this.getMatrixCenter(),m=this.getBullsEyeCorners(d);if(u){let S=m[0];m[0]=m[2],m[2]=S}this.extractParameters(m);let b=this.sampleGrid(this.image,m[this.shift%4],m[(this.shift+1)%4],m[(this.shift+2)%4],m[(this.shift+3)%4]),w=this.getMatrixCornerPoints(m);return new Qu(b,w,this.compact,this.nbDataBlocks,this.nbLayers)}extractParameters(u){if(!this.isValidPoint(u[0])||!this.isValidPoint(u[1])||!this.isValidPoint(u[2])||!this.isValidPoint(u[3]))throw new Pe;let d=2*this.nbCenterLayers,m=new Int32Array([this.sampleLine(u[0],u[1],d),this.sampleLine(u[1],u[2],d),this.sampleLine(u[2],u[3],d),this.sampleLine(u[3],u[0],d)]);this.shift=this.getRotation(m,d);let b=0;for(let S=0;S<4;S++){let E=m[(this.shift+S)%4];this.compact?(b<<=7,b+=E>>1&127):(b<<=10,b+=(E>>2&992)+(E>>1&31))}let w=this.getCorrectedParameterData(b,this.compact);this.compact?(this.nbLayers=(w>>6)+1,this.nbDataBlocks=(w&63)+1):(this.nbLayers=(w>>11)+1,this.nbDataBlocks=(w&2047)+1)}getRotation(u,d){let m=0;u.forEach((b,w,S)=>{let E=(b>>d-2<<1)+(b&1);m=(m<<3)+E}),m=((m&1)<<11)+(m>>1);for(let b=0;b<4;b++)if(j.bitCount(m^this.EXPECTED_CORNER_BITS[b])<=2)return b;throw new Pe}getCorrectedParameterData(u,d){let m,b;d?(m=7,b=2):(m=10,b=4);let w=m-b,S=new Int32Array(m);for(let A=m-1;A>=0;--A)S[A]=u&15,u>>=4;try{new ke(an.AZTEC_PARAM).decode(S,w)}catch{throw new Pe}let E=0;for(let A=0;A<b;A++)E=(E<<4)+S[A];return E}getBullsEyeCorners(u){let d=u,m=u,b=u,w=u,S=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let Z=this.getFirstDifferent(d,S,1,-1),U=this.getFirstDifferent(m,S,1,1),ne=this.getFirstDifferent(b,S,-1,1),le=this.getFirstDifferent(w,S,-1,-1);if(this.nbCenterLayers>2){let ce=this.distancePoint(le,Z)*this.nbCenterLayers/(this.distancePoint(w,d)*(this.nbCenterLayers+2));if(ce<.75||ce>1.25||!this.isWhiteOrBlackRectangle(Z,U,ne,le))break}d=Z,m=U,b=ne,w=le,S=!S}if(this.nbCenterLayers!==5&&this.nbCenterLayers!==7)throw new Pe;this.compact=this.nbCenterLayers===5;let E=new gt(d.getX()+.5,d.getY()-.5),A=new gt(m.getX()+.5,m.getY()+.5),G=new gt(b.getX()-.5,b.getY()+.5),B=new gt(w.getX()-.5,w.getY()-.5);return this.expandSquare([E,A,G,B],2*this.nbCenterLayers-3,2*this.nbCenterLayers)}getMatrixCenter(){let u,d,m,b;try{let E=new _s(this.image).detect();u=E[0],d=E[1],m=E[2],b=E[3]}catch{let A=this.image.getWidth()/2,G=this.image.getHeight()/2;u=this.getFirstDifferent(new Br(A+7,G-7),!1,1,-1).toResultPoint(),d=this.getFirstDifferent(new Br(A+7,G+7),!1,1,1).toResultPoint(),m=this.getFirstDifferent(new Br(A-7,G+7),!1,-1,1).toResultPoint(),b=this.getFirstDifferent(new Br(A-7,G-7),!1,-1,-1).toResultPoint()}let w=Ht.round((u.getX()+b.getX()+d.getX()+m.getX())/4),S=Ht.round((u.getY()+b.getY()+d.getY()+m.getY())/4);try{let E=new _s(this.image,15,w,S).detect();u=E[0],d=E[1],m=E[2],b=E[3]}catch{u=this.getFirstDifferent(new Br(w+7,S-7),!1,1,-1).toResultPoint(),d=this.getFirstDifferent(new Br(w+7,S+7),!1,1,1).toResultPoint(),m=this.getFirstDifferent(new Br(w-7,S+7),!1,-1,1).toResultPoint(),b=this.getFirstDifferent(new Br(w-7,S-7),!1,-1,-1).toResultPoint()}return w=Ht.round((u.getX()+b.getX()+d.getX()+m.getX())/4),S=Ht.round((u.getY()+b.getY()+d.getY()+m.getY())/4),new Br(w,S)}getMatrixCornerPoints(u){return this.expandSquare(u,2*this.nbCenterLayers,this.getDimension())}sampleGrid(u,d,m,b,w){let S=zi.getInstance(),E=this.getDimension(),A=E/2-this.nbCenterLayers,G=E/2+this.nbCenterLayers;return S.sampleGrid(u,E,E,A,A,G,A,G,G,A,G,d.getX(),d.getY(),m.getX(),m.getY(),b.getX(),b.getY(),w.getX(),w.getY())}sampleLine(u,d,m){let b=0,w=this.distanceResultPoint(u,d),S=w/m,E=u.getX(),A=u.getY(),G=S*(d.getX()-u.getX())/w,B=S*(d.getY()-u.getY())/w;for(let Z=0;Z<m;Z++)this.image.get(Ht.round(E+Z*G),Ht.round(A+Z*B))&&(b|=1<<m-Z-1);return b}isWhiteOrBlackRectangle(u,d,m,b){let w=3;u=new Br(u.getX()-w,u.getY()+w),d=new Br(d.getX()-w,d.getY()-w),m=new Br(m.getX()+w,m.getY()-w),b=new Br(b.getX()+w,b.getY()+w);let S=this.getColor(b,u);if(S===0)return!1;let E=this.getColor(u,d);return E!==S||(E=this.getColor(d,m),E!==S)?!1:(E=this.getColor(m,b),E===S)}getColor(u,d){let m=this.distancePoint(u,d),b=(d.getX()-u.getX())/m,w=(d.getY()-u.getY())/m,S=0,E=u.getX(),A=u.getY(),G=this.image.get(u.getX(),u.getY()),B=Math.ceil(m);for(let U=0;U<B;U++)E+=b,A+=w,this.image.get(Ht.round(E),Ht.round(A))!==G&&S++;let Z=S/m;return Z>.1&&Z<.9?0:Z<=.1===G?1:-1}getFirstDifferent(u,d,m,b){let w=u.getX()+m,S=u.getY()+b;for(;this.isValid(w,S)&&this.image.get(w,S)===d;)w+=m,S+=b;for(w-=m,S-=b;this.isValid(w,S)&&this.image.get(w,S)===d;)w+=m;for(w-=m;this.isValid(w,S)&&this.image.get(w,S)===d;)S+=b;return S-=b,new Br(w,S)}expandSquare(u,d,m){let b=m/(2*d),w=u[0].getX()-u[2].getX(),S=u[0].getY()-u[2].getY(),E=(u[0].getX()+u[2].getX())/2,A=(u[0].getY()+u[2].getY())/2,G=new gt(E+b*w,A+b*S),B=new gt(E-b*w,A-b*S);w=u[1].getX()-u[3].getX(),S=u[1].getY()-u[3].getY(),E=(u[1].getX()+u[3].getX())/2,A=(u[1].getY()+u[3].getY())/2;let Z=new gt(E+b*w,A+b*S),U=new gt(E-b*w,A-b*S);return[G,Z,B,U]}isValid(u,d){return u>=0&&u<this.image.getWidth()&&d>0&&d<this.image.getHeight()}isValidPoint(u){let d=Ht.round(u.getX()),m=Ht.round(u.getY());return this.isValid(d,m)}distancePoint(u,d){return Ht.distance(u.getX(),u.getY(),d.getX(),d.getY())}distanceResultPoint(u,d){return Ht.distance(u.getX(),u.getY(),d.getX(),d.getY())}getDimension(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(j.truncDivision(this.nbLayers-4,8)+1)+15}}class Go{decode(u,d=null){let m=null,b=new Ju(u.getBlackMatrix()),w=null,S=null;try{let B=b.detectMirror(!1);w=B.getPoints(),this.reportFoundResultPoints(d,w),S=new Cn().decode(B)}catch(B){m=B}if(S==null)try{let B=b.detectMirror(!0);w=B.getPoints(),this.reportFoundResultPoints(d,w),S=new Cn().decode(B)}catch(B){throw m??B}let E=new En(S.getText(),S.getRawBytes(),S.getNumBits(),w,yt.AZTEC,se.currentTimeMillis()),A=S.getByteSegments();A!=null&&E.putMetadata(bn.BYTE_SEGMENTS,A);let G=S.getECLevel();return G!=null&&E.putMetadata(bn.ERROR_CORRECTION_LEVEL,G),E}reportFoundResultPoints(u,d){if(u!=null){let m=u.get(Fe.NEED_RESULT_POINT_CALLBACK);m!=null&&d.forEach((b,w,S)=>{m.foundPossibleResultPoint(b)})}}reset(){}}class qu extends qs{constructor(u=500){super(new Go,u)}}class _n{decode(u,d){try{return this.doDecode(u,d)}catch{if(d&&d.get(Fe.TRY_HARDER)===!0&&u.isRotateSupported()){const w=u.rotateCounterClockwise(),S=this.doDecode(w,d),E=S.getResultMetadata();let A=270;E!==null&&E.get(bn.ORIENTATION)===!0&&(A=A+E.get(bn.ORIENTATION)%360),S.putMetadata(bn.ORIENTATION,A);const G=S.getResultPoints();if(G!==null){const B=w.getHeight();for(let Z=0;Z<G.length;Z++)G[Z]=new gt(B-G[Z].getY()-1,G[Z].getX())}return S}else throw new Pe}}reset(){}doDecode(u,d){const m=u.getWidth(),b=u.getHeight();let w=new fe(m);const S=d&&d.get(Fe.TRY_HARDER)===!0,E=Math.max(1,b>>(S?8:5));let A;S?A=b:A=15;const G=Math.trunc(b/2);for(let B=0;B<A;B++){const Z=Math.trunc((B+1)/2),U=(B&1)===0,ne=G+E*(U?Z:-Z);if(ne<0||ne>=b)break;try{w=u.getBlackRow(ne,w)}catch{continue}for(let le=0;le<2;le++){if(le===1&&(w.reverse(),d&&d.get(Fe.NEED_RESULT_POINT_CALLBACK)===!0)){const ce=new Map;d.forEach((ve,Re)=>ce.set(Re,ve)),ce.delete(Fe.NEED_RESULT_POINT_CALLBACK),d=ce}try{const ce=this.decodeRow(ne,w,d);if(le===1){ce.putMetadata(bn.ORIENTATION,180);const ve=ce.getResultPoints();ve!==null&&(ve[0]=new gt(m-ve[0].getX()-1,ve[0].getY()),ve[1]=new gt(m-ve[1].getX()-1,ve[1].getY()))}return ce}catch{}}}throw new Pe}static recordPattern(u,d,m){const b=m.length;for(let G=0;G<b;G++)m[G]=0;const w=u.getSize();if(d>=w)throw new Pe;let S=!u.get(d),E=0,A=d;for(;A<w;){if(u.get(A)!==S)m[E]++;else{if(++E===b)break;m[E]=1,S=!S}A++}if(!(E===b||E===b-1&&A===w))throw new Pe}static recordPatternInReverse(u,d,m){let b=m.length,w=u.get(d);for(;d>0&&b>=0;)u.get(--d)!==w&&(b--,w=!w);if(b>=0)throw new Pe;_n.recordPattern(u,d+1,m)}static patternMatchVariance(u,d,m){const b=u.length;let w=0,S=0;for(let G=0;G<b;G++)w+=u[G],S+=d[G];if(w<S)return Number.POSITIVE_INFINITY;const E=w/S;m*=E;let A=0;for(let G=0;G<b;G++){const B=u[G],Z=d[G]*E,U=B>Z?B-Z:Z-B;if(U>m)return Number.POSITIVE_INFINITY;A+=U}return A/w}}class et extends _n{static findStartPattern(u){const d=u.getSize(),m=u.getNextSet(0);let b=0,w=Int32Array.from([0,0,0,0,0,0]),S=m,E=!1;const A=6;for(let G=m;G<d;G++)if(u.get(G)!==E)w[b]++;else{if(b===A-1){let B=et.MAX_AVG_VARIANCE,Z=-1;for(let U=et.CODE_START_A;U<=et.CODE_START_C;U++){const ne=_n.patternMatchVariance(w,et.CODE_PATTERNS[U],et.MAX_INDIVIDUAL_VARIANCE);ne<B&&(B=ne,Z=U)}if(Z>=0&&u.isRange(Math.max(0,S-(G-S)/2),S,!1))return Int32Array.from([S,G,Z]);S+=w[0]+w[1],w=w.slice(2,w.length-1),w[b-1]=0,w[b]=0,b--}else b++;w[b]=1,E=!E}throw new Pe}static decodeCode(u,d,m){_n.recordPattern(u,m,d);let b=et.MAX_AVG_VARIANCE,w=-1;for(let S=0;S<et.CODE_PATTERNS.length;S++){const E=et.CODE_PATTERNS[S],A=this.patternMatchVariance(d,E,et.MAX_INDIVIDUAL_VARIANCE);A<b&&(b=A,w=S)}if(w>=0)return w;throw new Pe}decodeRow(u,d,m){const b=m&&m.get(Fe.ASSUME_GS1)===!0,w=et.findStartPattern(d),S=w[2];let E=0;const A=new Uint8Array(20);A[E++]=S;let G;switch(S){case et.CODE_START_A:G=et.CODE_CODE_A;break;case et.CODE_START_B:G=et.CODE_CODE_B;break;case et.CODE_START_C:G=et.CODE_CODE_C;break;default:throw new ue}let B=!1,Z=!1,U="",ne=w[0],le=w[1];const ce=Int32Array.from([0,0,0,0,0,0]);let ve=0,Re=0,Xe=S,Ye=0,Ke=!0,Kt=!1,At=!1;for(;!B;){const Qo=Z;switch(Z=!1,ve=Re,Re=et.decodeCode(d,ce,le),A[E++]=Re,Re!==et.CODE_STOP&&(Ke=!0),Re!==et.CODE_STOP&&(Ye++,Xe+=Ye*Re),ne=le,le+=ce.reduce((Jo,si)=>Jo+si,0),Re){case et.CODE_START_A:case et.CODE_START_B:case et.CODE_START_C:throw new ue}switch(G){case et.CODE_CODE_A:if(Re<64)At===Kt?U+=String.fromCharCode(32+Re):U+=String.fromCharCode(32+Re+128),At=!1;else if(Re<96)At===Kt?U+=String.fromCharCode(Re-64):U+=String.fromCharCode(Re+64),At=!1;else switch(Re!==et.CODE_STOP&&(Ke=!1),Re){case et.CODE_FNC_1:b&&(U.length===0?U+="]C1":U+="");break;case et.CODE_FNC_2:case et.CODE_FNC_3:break;case et.CODE_FNC_4_A:!Kt&&At?(Kt=!0,At=!1):Kt&&At?(Kt=!1,At=!1):At=!0;break;case et.CODE_SHIFT:Z=!0,G=et.CODE_CODE_B;break;case et.CODE_CODE_B:G=et.CODE_CODE_B;break;case et.CODE_CODE_C:G=et.CODE_CODE_C;break;case et.CODE_STOP:B=!0;break}break;case et.CODE_CODE_B:if(Re<96)At===Kt?U+=String.fromCharCode(32+Re):U+=String.fromCharCode(32+Re+128),At=!1;else switch(Re!==et.CODE_STOP&&(Ke=!1),Re){case et.CODE_FNC_1:b&&(U.length===0?U+="]C1":U+="");break;case et.CODE_FNC_2:case et.CODE_FNC_3:break;case et.CODE_FNC_4_B:!Kt&&At?(Kt=!0,At=!1):Kt&&At?(Kt=!1,At=!1):At=!0;break;case et.CODE_SHIFT:Z=!0,G=et.CODE_CODE_A;break;case et.CODE_CODE_A:G=et.CODE_CODE_A;break;case et.CODE_CODE_C:G=et.CODE_CODE_C;break;case et.CODE_STOP:B=!0;break}break;case et.CODE_CODE_C:if(Re<100)Re<10&&(U+="0"),U+=Re;else switch(Re!==et.CODE_STOP&&(Ke=!1),Re){case et.CODE_FNC_1:b&&(U.length===0?U+="]C1":U+="");break;case et.CODE_CODE_A:G=et.CODE_CODE_A;break;case et.CODE_CODE_B:G=et.CODE_CODE_B;break;case et.CODE_STOP:B=!0;break}break}Qo&&(G=G===et.CODE_CODE_A?et.CODE_CODE_B:et.CODE_CODE_A)}const Cs=le-ne;if(le=d.getNextUnset(le),!d.isRange(le,Math.min(d.getSize(),le+(le-ne)/2),!1))throw new Pe;if(Xe-=Ye*ve,Xe%103!==ve)throw new re;const vi=U.length;if(vi===0)throw new Pe;vi>0&&Ke&&(G===et.CODE_CODE_C?U=U.substring(0,vi-2):U=U.substring(0,vi-1));const hs=(w[1]+w[0])/2,zt=ne+Cs/2,Pt=A.length,Sn=new Uint8Array(Pt);for(let Qo=0;Qo<Pt;Qo++)Sn[Qo]=A[Qo];const Yo=[new gt(hs,u),new gt(zt,u)];return new En(U,Sn,0,Yo,yt.CODE_128,new Date().getTime())}}et.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],et.MAX_AVG_VARIANCE=.25,et.MAX_INDIVIDUAL_VARIANCE=.7,et.CODE_SHIFT=98,et.CODE_CODE_C=99,et.CODE_CODE_B=100,et.CODE_CODE_A=101,et.CODE_FNC_1=102,et.CODE_FNC_2=97,et.CODE_FNC_3=96,et.CODE_FNC_4_A=101,et.CODE_FNC_4_B=100,et.CODE_START_A=103,et.CODE_START_B=104,et.CODE_START_C=105,et.CODE_STOP=106;class Un extends _n{constructor(u=!1,d=!1){super(),this.usingCheckDigit=u,this.extendedMode=d,this.decodeRowResult="",this.counters=new Int32Array(9)}decodeRow(u,d,m){let b=this.counters;b.fill(0),this.decodeRowResult="";let w=Un.findAsteriskPattern(d,b),S=d.getNextSet(w[1]),E=d.getSize(),A,G;do{Un.recordPattern(d,S,b);let ce=Un.toNarrowWidePattern(b);if(ce<0)throw new Pe;A=Un.patternToChar(ce),this.decodeRowResult+=A,G=S;for(let ve of b)S+=ve;S=d.getNextSet(S)}while(A!=="*");this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let B=0;for(let ce of b)B+=ce;let Z=S-G-B;if(S!==E&&Z*2<B)throw new Pe;if(this.usingCheckDigit){let ce=this.decodeRowResult.length-1,ve=0;for(let Re=0;Re<ce;Re++)ve+=Un.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(Re));if(this.decodeRowResult.charAt(ce)!==Un.ALPHABET_STRING.charAt(ve%43))throw new re;this.decodeRowResult=this.decodeRowResult.substring(0,ce)}if(this.decodeRowResult.length===0)throw new Pe;let U;this.extendedMode?U=Un.decodeExtended(this.decodeRowResult):U=this.decodeRowResult;let ne=(w[1]+w[0])/2,le=G+B/2;return new En(U,null,0,[new gt(ne,u),new gt(le,u)],yt.CODE_39,new Date().getTime())}static findAsteriskPattern(u,d){let m=u.getSize(),b=u.getNextSet(0),w=0,S=b,E=!1,A=d.length;for(let G=b;G<m;G++)if(u.get(G)!==E)d[w]++;else{if(w===A-1){if(this.toNarrowWidePattern(d)===Un.ASTERISK_ENCODING&&u.isRange(Math.max(0,S-Math.floor((G-S)/2)),S,!1))return[S,G];S+=d[0]+d[1],d.copyWithin(0,2,2+w-1),d[w-1]=0,d[w]=0,w--}else w++;d[w]=1,E=!E}throw new Pe}static toNarrowWidePattern(u){let d=u.length,m=0,b;do{let w=2147483647;for(let A of u)A<w&&A>m&&(w=A);m=w,b=0;let S=0,E=0;for(let A=0;A<d;A++){let G=u[A];G>m&&(E|=1<<d-1-A,b++,S+=G)}if(b===3){for(let A=0;A<d&&b>0;A++){let G=u[A];if(G>m&&(b--,G*2>=S))return-1}return E}}while(b>3);return-1}static patternToChar(u){for(let d=0;d<Un.CHARACTER_ENCODINGS.length;d++)if(Un.CHARACTER_ENCODINGS[d]===u)return Un.ALPHABET_STRING.charAt(d);if(u===Un.ASTERISK_ENCODING)return"*";throw new Pe}static decodeExtended(u){let d=u.length,m="";for(let b=0;b<d;b++){let w=u.charAt(b);if(w==="+"||w==="$"||w==="%"||w==="/"){let S=u.charAt(b+1),E="\0";switch(w){case"+":if(S>="A"&&S<="Z")E=String.fromCharCode(S.charCodeAt(0)+32);else throw new ue;break;case"$":if(S>="A"&&S<="Z")E=String.fromCharCode(S.charCodeAt(0)-64);else throw new ue;break;case"%":if(S>="A"&&S<="E")E=String.fromCharCode(S.charCodeAt(0)-38);else if(S>="F"&&S<="J")E=String.fromCharCode(S.charCodeAt(0)-11);else if(S>="K"&&S<="O")E=String.fromCharCode(S.charCodeAt(0)+16);else if(S>="P"&&S<="T")E=String.fromCharCode(S.charCodeAt(0)+43);else if(S==="U")E="\0";else if(S==="V")E="@";else if(S==="W")E="`";else if(S==="X"||S==="Y"||S==="Z")E="";else throw new ue;break;case"/":if(S>="A"&&S<="O")E=String.fromCharCode(S.charCodeAt(0)-32);else if(S==="Z")E=":";else throw new ue;break}m+=E,b++}else m+=w}return m}}Un.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",Un.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],Un.ASTERISK_ENCODING=148;class on extends _n{constructor(){super(...arguments),this.narrowLineWidth=-1}decodeRow(u,d,m){let b=this.decodeStart(d),w=this.decodeEnd(d),S=new _t;on.decodeMiddle(d,b[1],w[0],S);let E=S.toString(),A=null;m!=null&&(A=m.get(Fe.ALLOWED_LENGTHS)),A==null&&(A=on.DEFAULT_ALLOWED_LENGTHS);let G=E.length,B=!1,Z=0;for(let le of A){if(G===le){B=!0;break}le>Z&&(Z=le)}if(!B&&G>Z&&(B=!0),!B)throw new ue;const U=[new gt(b[1],u),new gt(w[0],u)];return new En(E,null,0,U,yt.ITF,new Date().getTime())}static decodeMiddle(u,d,m,b){let w=new Int32Array(10),S=new Int32Array(5),E=new Int32Array(5);for(w.fill(0),S.fill(0),E.fill(0);d<m;){_n.recordPattern(u,d,w);for(let G=0;G<5;G++){let B=2*G;S[G]=w[B],E[G]=w[B+1]}let A=on.decodeDigit(S);b.append(A.toString()),A=this.decodeDigit(E),b.append(A.toString()),w.forEach(function(G){d+=G})}}decodeStart(u){let d=on.skipWhiteSpace(u),m=on.findGuardPattern(u,d,on.START_PATTERN);return this.narrowLineWidth=(m[1]-m[0])/4,this.validateQuietZone(u,m[0]),m}validateQuietZone(u,d){let m=this.narrowLineWidth*10;m=m<d?m:d;for(let b=d-1;m>0&&b>=0&&!u.get(b);b--)m--;if(m!==0)throw new Pe}static skipWhiteSpace(u){const d=u.getSize(),m=u.getNextSet(0);if(m===d)throw new Pe;return m}decodeEnd(u){u.reverse();try{let d=on.skipWhiteSpace(u),m;try{m=on.findGuardPattern(u,d,on.END_PATTERN_REVERSED[0])}catch(w){w instanceof Pe&&(m=on.findGuardPattern(u,d,on.END_PATTERN_REVERSED[1]))}this.validateQuietZone(u,m[0]);let b=m[0];return m[0]=u.getSize()-m[1],m[1]=u.getSize()-b,m}finally{u.reverse()}}static findGuardPattern(u,d,m){let b=m.length,w=new Int32Array(b),S=u.getSize(),E=!1,A=0,G=d;w.fill(0);for(let B=d;B<S;B++)if(u.get(B)!==E)w[A]++;else{if(A===b-1){if(_n.patternMatchVariance(w,m,on.MAX_INDIVIDUAL_VARIANCE)<on.MAX_AVG_VARIANCE)return[G,B];G+=w[0]+w[1],se.arraycopy(w,2,w,0,A-1),w[A-1]=0,w[A]=0,A--}else A++;w[A]=1,E=!E}throw new Pe}static decodeDigit(u){let d=on.MAX_AVG_VARIANCE,m=-1,b=on.PATTERNS.length;for(let w=0;w<b;w++){let S=on.PATTERNS[w],E=_n.patternMatchVariance(u,S,on.MAX_INDIVIDUAL_VARIANCE);E<d?(d=E,m=w):E===d&&(m=-1)}if(m>=0)return m%10;throw new Pe}}on.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],on.MAX_AVG_VARIANCE=.38,on.MAX_INDIVIDUAL_VARIANCE=.5,on.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],on.START_PATTERN=Int32Array.from([1,1,1,1]),on.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class Nn extends _n{constructor(){super(...arguments),this.decodeRowStringBuffer=""}static findStartGuardPattern(u){let d=!1,m,b=0,w=Int32Array.from([0,0,0]);for(;!d;){w=Int32Array.from([0,0,0]),m=Nn.findGuardPattern(u,b,!1,this.START_END_PATTERN,w);let S=m[0];b=m[1];let E=S-(b-S);E>=0&&(d=u.isRange(E,S,!1))}return m}static checkChecksum(u){return Nn.checkStandardUPCEANChecksum(u)}static checkStandardUPCEANChecksum(u){let d=u.length;if(d===0)return!1;let m=parseInt(u.charAt(d-1),10);return Nn.getStandardUPCEANChecksum(u.substring(0,d-1))===m}static getStandardUPCEANChecksum(u){let d=u.length,m=0;for(let b=d-1;b>=0;b-=2){let w=u.charAt(b).charCodeAt(0)-48;if(w<0||w>9)throw new ue;m+=w}m*=3;for(let b=d-2;b>=0;b-=2){let w=u.charAt(b).charCodeAt(0)-48;if(w<0||w>9)throw new ue;m+=w}return(1e3-m)%10}static decodeEnd(u,d){return Nn.findGuardPattern(u,d,!1,Nn.START_END_PATTERN,new Int32Array(Nn.START_END_PATTERN.length).fill(0))}static findGuardPatternWithoutCounters(u,d,m,b){return this.findGuardPattern(u,d,m,b,new Int32Array(b.length))}static findGuardPattern(u,d,m,b,w){let S=u.getSize();d=m?u.getNextUnset(d):u.getNextSet(d);let E=0,A=d,G=b.length,B=m;for(let Z=d;Z<S;Z++)if(u.get(Z)!==B)w[E]++;else{if(E===G-1){if(_n.patternMatchVariance(w,b,Nn.MAX_INDIVIDUAL_VARIANCE)<Nn.MAX_AVG_VARIANCE)return Int32Array.from([A,Z]);A+=w[0]+w[1];let U=w.slice(2,w.length-1);for(let ne=0;ne<E-1;ne++)w[ne]=U[ne];w[E-1]=0,w[E]=0,E--}else E++;w[E]=1,B=!B}throw new Pe}static decodeDigit(u,d,m,b){this.recordPattern(u,m,d);let w=this.MAX_AVG_VARIANCE,S=-1,E=b.length;for(let A=0;A<E;A++){let G=b[A],B=_n.patternMatchVariance(d,G,Nn.MAX_INDIVIDUAL_VARIANCE);B<w&&(w=B,S=A)}if(S>=0)return S;throw new Pe}}Nn.MAX_AVG_VARIANCE=.48,Nn.MAX_INDIVIDUAL_VARIANCE=.7,Nn.START_END_PATTERN=Int32Array.from([1,1,1]),Nn.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),Nn.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Nn.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])];class _o{constructor(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(u,d,m){let b=this.decodeRowStringBuffer,w=this.decodeMiddle(d,m,b),S=b.toString(),E=_o.parseExtensionString(S),A=[new gt((m[0]+m[1])/2,u),new gt(w,u)],G=new En(S,null,0,A,yt.UPC_EAN_EXTENSION,new Date().getTime());return E!=null&&G.putAllMetadata(E),G}decodeMiddle(u,d,m){let b=this.decodeMiddleCounters;b[0]=0,b[1]=0,b[2]=0,b[3]=0;let w=u.getSize(),S=d[1],E=0;for(let G=0;G<5&&S<w;G++){let B=Nn.decodeDigit(u,b,S,Nn.L_AND_G_PATTERNS);m+=String.fromCharCode(48+B%10);for(let Z of b)S+=Z;B>=10&&(E|=1<<4-G),G!==4&&(S=u.getNextSet(S),S=u.getNextUnset(S))}if(m.length!==5)throw new Pe;let A=this.determineCheckDigit(E);if(_o.extensionChecksum(m.toString())!==A)throw new Pe;return S}static extensionChecksum(u){let d=u.length,m=0;for(let b=d-2;b>=0;b-=2)m+=u.charAt(b).charCodeAt(0)-48;m*=3;for(let b=d-1;b>=0;b-=2)m+=u.charAt(b).charCodeAt(0)-48;return m*=3,m%10}determineCheckDigit(u){for(let d=0;d<10;d++)if(u===this.CHECK_DIGIT_ENCODINGS[d])return d;throw new Pe}static parseExtensionString(u){if(u.length!==5)return null;let d=_o.parseExtension5String(u);return d==null?null:new Map([[bn.SUGGESTED_PRICE,d]])}static parseExtension5String(u){let d;switch(u.charAt(0)){case"0":d="";break;case"5":d="$";break;case"9":switch(u){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}d="";break;default:d="";break}let m=parseInt(u.substring(1)),b=(m/100).toString(),w=m%100,S=w<10?"0"+w:w.toString();return d+b+"."+S}}class Rl{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(u,d,m){let b=this.decodeRowStringBuffer,w=this.decodeMiddle(d,m,b),S=b.toString(),E=Rl.parseExtensionString(S),A=[new gt((m[0]+m[1])/2,u),new gt(w,u)],G=new En(S,null,0,A,yt.UPC_EAN_EXTENSION,new Date().getTime());return E!=null&&G.putAllMetadata(E),G}decodeMiddle(u,d,m){let b=this.decodeMiddleCounters;b[0]=0,b[1]=0,b[2]=0,b[3]=0;let w=u.getSize(),S=d[1],E=0;for(let A=0;A<2&&S<w;A++){let G=Nn.decodeDigit(u,b,S,Nn.L_AND_G_PATTERNS);m+=String.fromCharCode(48+G%10);for(let B of b)S+=B;G>=10&&(E|=1<<1-A),A!==1&&(S=u.getNextSet(S),S=u.getNextUnset(S))}if(m.length!==2)throw new Pe;if(parseInt(m.toString())%4!==E)throw new Pe;return S}static parseExtensionString(u){return u.length!==2?null:new Map([[bn.ISSUE_NUMBER,parseInt(u)]])}}class Ih{static decodeRow(u,d,m){let b=Nn.findGuardPattern(d,m,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return new _o().decodeRow(u,d,b)}catch{return new Rl().decodeRow(u,d,b)}}}Ih.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class Qt extends Nn{constructor(){super(),this.decodeRowStringBuffer="",Qt.L_AND_G_PATTERNS=Qt.L_PATTERNS.map(u=>Int32Array.from(u));for(let u=10;u<20;u++){let d=Qt.L_PATTERNS[u-10],m=new Int32Array(d.length);for(let b=0;b<d.length;b++)m[b]=d[d.length-b-1];Qt.L_AND_G_PATTERNS[u]=m}}decodeRow(u,d,m){let b=Qt.findStartGuardPattern(d),w=m==null?null:m.get(Fe.NEED_RESULT_POINT_CALLBACK);if(w!=null){const Ke=new gt((b[0]+b[1])/2,u);w.foundPossibleResultPoint(Ke)}let S=this.decodeMiddle(d,b,this.decodeRowStringBuffer),E=S.rowOffset,A=S.resultString;if(w!=null){const Ke=new gt(E,u);w.foundPossibleResultPoint(Ke)}let G=this.decodeEnd(d,E);if(w!=null){const Ke=new gt((G[0]+G[1])/2,u);w.foundPossibleResultPoint(Ke)}let B=G[1],Z=B+(B-G[0]);if(Z>=d.getSize()||!d.isRange(B,Z,!1))throw new Pe;let U=A.toString();if(U.length<8)throw new ue;if(!Qt.checkChecksum(U))throw new re;let ne=(b[1]+b[0])/2,le=(G[1]+G[0])/2,ce=this.getBarcodeFormat(),ve=[new gt(ne,u),new gt(le,u)],Re=new En(U,null,0,ve,ce,new Date().getTime()),Xe=0;try{let Ke=Ih.decodeRow(u,d,G[1]);Re.putMetadata(bn.UPC_EAN_EXTENSION,Ke.getText()),Re.putAllMetadata(Ke.getResultMetadata()),Re.addResultPoints(Ke.getResultPoints()),Xe=Ke.getText().length}catch{}let Ye=m==null?null:m.get(Fe.ALLOWED_EAN_EXTENSIONS);if(Ye!=null){let Ke=!1;for(let Kt in Ye)if(Xe.toString()===Kt){Ke=!0;break}if(!Ke)throw new Pe}return Re}decodeEnd(u,d){return Qt.findGuardPattern(u,d,!1,Qt.START_END_PATTERN,new Int32Array(Qt.START_END_PATTERN.length).fill(0))}static checkChecksum(u){return Qt.checkStandardUPCEANChecksum(u)}static checkStandardUPCEANChecksum(u){let d=u.length;if(d===0)return!1;let m=parseInt(u.charAt(d-1),10);return Qt.getStandardUPCEANChecksum(u.substring(0,d-1))===m}static getStandardUPCEANChecksum(u){let d=u.length,m=0;for(let b=d-1;b>=0;b-=2){let w=u.charAt(b).charCodeAt(0)-48;if(w<0||w>9)throw new ue;m+=w}m*=3;for(let b=d-2;b>=0;b-=2){let w=u.charAt(b).charCodeAt(0)-48;if(w<0||w>9)throw new ue;m+=w}return(1e3-m)%10}}class Xi extends Qt{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(u,d,m){let b=this.decodeMiddleCounters;b[0]=0,b[1]=0,b[2]=0,b[3]=0;let w=u.getSize(),S=d[1],E=0;for(let G=0;G<6&&S<w;G++){let B=Qt.decodeDigit(u,b,S,Qt.L_AND_G_PATTERNS);m+=String.fromCharCode(48+B%10);for(let Z of b)S+=Z;B>=10&&(E|=1<<5-G)}m=Xi.determineFirstDigit(m,E),S=Qt.findGuardPattern(u,S,!0,Qt.MIDDLE_PATTERN,new Int32Array(Qt.MIDDLE_PATTERN.length).fill(0))[1];for(let G=0;G<6&&S<w;G++){let B=Qt.decodeDigit(u,b,S,Qt.L_PATTERNS);m+=String.fromCharCode(48+B);for(let Z of b)S+=Z}return{rowOffset:S,resultString:m}}getBarcodeFormat(){return yt.EAN_13}static determineFirstDigit(u,d){for(let m=0;m<10;m++)if(d===this.FIRST_DIGIT_ENCODINGS[m])return u=String.fromCharCode(48+m)+u,u;throw new Pe}}Xi.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26];class Ch extends Qt{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(u,d,m){const b=this.decodeMiddleCounters;b[0]=0,b[1]=0,b[2]=0,b[3]=0;let w=u.getSize(),S=d[1];for(let A=0;A<4&&S<w;A++){let G=Qt.decodeDigit(u,b,S,Qt.L_PATTERNS);m+=String.fromCharCode(48+G);for(let B of b)S+=B}S=Qt.findGuardPattern(u,S,!0,Qt.MIDDLE_PATTERN,new Int32Array(Qt.MIDDLE_PATTERN.length).fill(0))[1];for(let A=0;A<4&&S<w;A++){let G=Qt.decodeDigit(u,b,S,Qt.L_PATTERNS);m+=String.fromCharCode(48+G);for(let B of b)S+=B}return{rowOffset:S,resultString:m}}getBarcodeFormat(){return yt.EAN_8}}class Sh extends Qt{constructor(){super(...arguments),this.ean13Reader=new Xi}getBarcodeFormat(){return yt.UPC_A}decode(u,d){return this.maybeReturnResult(this.ean13Reader.decode(u))}decodeRow(u,d,m){return this.maybeReturnResult(this.ean13Reader.decodeRow(u,d,m))}decodeMiddle(u,d,m){return this.ean13Reader.decodeMiddle(u,d,m)}maybeReturnResult(u){let d=u.getText();if(d.charAt(0)==="0"){let m=new En(d.substring(1),null,null,u.getResultPoints(),yt.UPC_A);return u.getResultMetadata()!=null&&m.putAllMetadata(u.getResultMetadata()),m}else throw new Pe}reset(){this.ean13Reader.reset()}}class gi extends Qt{constructor(){super(),this.decodeMiddleCounters=new Int32Array(4)}decodeMiddle(u,d,m){const b=this.decodeMiddleCounters.map(G=>G);b[0]=0,b[1]=0,b[2]=0,b[3]=0;const w=u.getSize();let S=d[1],E=0;for(let G=0;G<6&&S<w;G++){const B=gi.decodeDigit(u,b,S,gi.L_AND_G_PATTERNS);m+=String.fromCharCode(48+B%10);for(let Z of b)S+=Z;B>=10&&(E|=1<<5-G)}let A=gi.determineNumSysAndCheckDigit(m,E);return{rowOffset:S,resultString:A}}decodeEnd(u,d){return gi.findGuardPatternWithoutCounters(u,d,!0,gi.MIDDLE_END_PATTERN)}checkChecksum(u){return Qt.checkChecksum(gi.convertUPCEtoUPCA(u))}static determineNumSysAndCheckDigit(u,d){for(let m=0;m<=1;m++)for(let b=0;b<10;b++)if(d===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[m][b]){let w=String.fromCharCode(48+m),S=String.fromCharCode(48+b);return w+u+S}throw Pe.getNotFoundInstance()}getBarcodeFormat(){return yt.UPC_E}static convertUPCEtoUPCA(u){const d=u.slice(1,7).split("").map(w=>w.charCodeAt(0)),m=new _t;m.append(u.charAt(0));let b=d[5];switch(b){case 0:case 1:case 2:m.appendChars(d,0,2),m.append(b),m.append("0000"),m.appendChars(d,2,3);break;case 3:m.appendChars(d,0,3),m.append("00000"),m.appendChars(d,3,2);break;case 4:m.appendChars(d,0,4),m.append("00000"),m.append(d[4]);break;default:m.appendChars(d,0,5),m.append("0000"),m.append(b);break}return u.length>=8&&m.append(u.charAt(7)),m.toString()}}gi.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),gi.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,26])];class Th extends _n{constructor(u){super();let d=u==null?null:u.get(Fe.POSSIBLE_FORMATS),m=[];p(d)?(m.push(new Xi),m.push(new Sh),m.push(new Ch),m.push(new gi)):(d.indexOf(yt.EAN_13)>-1&&m.push(new Xi),d.indexOf(yt.UPC_A)>-1&&m.push(new Sh),d.indexOf(yt.EAN_8)>-1&&m.push(new Ch),d.indexOf(yt.UPC_E)>-1&&m.push(new gi)),this.readers=m}decodeRow(u,d,m){for(let b of this.readers)try{const w=b.decodeRow(u,d,m),S=w.getBarcodeFormat()===yt.EAN_13&&w.getText().charAt(0)==="0",E=m==null?null:m.get(Fe.POSSIBLE_FORMATS),A=E==null||E.includes(yt.UPC_A);if(S&&A){const G=w.getRawBytes(),B=new En(w.getText().substring(1),G,G?G.length:null,w.getResultPoints(),yt.UPC_A);return B.putAllMetadata(w.getResultMetadata()),B}return w}catch{}throw new Pe}reset(){for(let u of this.readers)u.reset()}}class dr extends _n{constructor(){super(),this.decodeFinderCounters=new Int32Array(4),this.dataCharacterCounters=new Int32Array(8),this.oddRoundingErrors=new Array(4),this.evenRoundingErrors=new Array(4),this.oddCounts=new Array(this.dataCharacterCounters.length/2),this.evenCounts=new Array(this.dataCharacterCounters.length/2)}getDecodeFinderCounters(){return this.decodeFinderCounters}getDataCharacterCounters(){return this.dataCharacterCounters}getOddRoundingErrors(){return this.oddRoundingErrors}getEvenRoundingErrors(){return this.evenRoundingErrors}getOddCounts(){return this.oddCounts}getEvenCounts(){return this.evenCounts}parseFinderValue(u,d){for(let m=0;m<d.length;m++)if(_n.patternMatchVariance(u,d[m],dr.MAX_INDIVIDUAL_VARIANCE)<dr.MAX_AVG_VARIANCE)return m;throw new Pe}static count(u){return Ht.sum(new Int32Array(u))}static increment(u,d){let m=0,b=d[0];for(let w=1;w<u.length;w++)d[w]>b&&(b=d[w],m=w);u[m]++}static decrement(u,d){let m=0,b=d[0];for(let w=1;w<u.length;w++)d[w]<b&&(b=d[w],m=w);u[m]--}static isFinderPattern(u){let d=u[0]+u[1],m=d+u[2]+u[3],b=d/m;if(b>=dr.MIN_FINDER_PATTERN_RATIO&&b<=dr.MAX_FINDER_PATTERN_RATIO){let w=Number.MAX_SAFE_INTEGER,S=Number.MIN_SAFE_INTEGER;for(let E of u)E>S&&(S=E),E<w&&(w=E);return S<10*w}return!1}}dr.MAX_AVG_VARIANCE=.2,dr.MAX_INDIVIDUAL_VARIANCE=.45,dr.MIN_FINDER_PATTERN_RATIO=9.5/12,dr.MAX_FINDER_PATTERN_RATIO=12.5/14;class Zi{constructor(u,d){this.value=u,this.checksumPortion=d}getValue(){return this.value}getChecksumPortion(){return this.checksumPortion}toString(){return this.value+"("+this.checksumPortion+")"}equals(u){if(!(u instanceof Zi))return!1;const d=u;return this.value===d.value&&this.checksumPortion===d.checksumPortion}hashCode(){return this.value^this.checksumPortion}}class Qa{constructor(u,d,m,b,w){this.value=u,this.startEnd=d,this.value=u,this.startEnd=d,this.resultPoints=new Array,this.resultPoints.push(new gt(m,w)),this.resultPoints.push(new gt(b,w))}getValue(){return this.value}getStartEnd(){return this.startEnd}getResultPoints(){return this.resultPoints}equals(u){if(!(u instanceof Qa))return!1;const d=u;return this.value===d.value}hashCode(){return this.value}}class ei{constructor(){}static getRSSvalue(u,d,m){let b=0;for(let A of u)b+=A;let w=0,S=0,E=u.length;for(let A=0;A<E-1;A++){let G;for(G=1,S|=1<<A;G<u[A];G++,S&=~(1<<A)){let B=ei.combins(b-G-1,E-A-2);if(m&&S===0&&b-G-(E-A-1)>=E-A-1&&(B-=ei.combins(b-G-(E-A),E-A-2)),E-A-1>1){let Z=0;for(let U=b-G-(E-A-2);U>d;U--)Z+=ei.combins(b-G-U-1,E-A-3);B-=Z*(E-1-A)}else b-G>d&&B--;w+=B}b-=G}return w}static combins(u,d){let m,b;u-d>d?(b=d,m=u-d):(b=u-d,m=d);let w=1,S=1;for(let E=u;E>m;E--)w*=E,S<=b&&(w/=S,S++);for(;S<=b;)w/=S,S++;return w}}class kh{static buildBitArray(u){let d=u.length*2-1;u[u.length-1].getRightChar()==null&&(d-=1);let m=12*d,b=new fe(m),w=0,E=u[0].getRightChar().getValue();for(let A=11;A>=0;--A)E&1<<A&&b.set(w),w++;for(let A=1;A<u.length;++A){let G=u[A],B=G.getLeftChar().getValue();for(let Z=11;Z>=0;--Z)B&1<<Z&&b.set(w),w++;if(G.getRightChar()!=null){let Z=G.getRightChar().getValue();for(let U=11;U>=0;--U)Z&1<<U&&b.set(w),w++}}return b}}class Ki{constructor(u,d){d?this.decodedInformation=null:(this.finished=u,this.decodedInformation=d)}getDecodedInformation(){return this.decodedInformation}isFinished(){return this.finished}}class Ml{constructor(u){this.newPosition=u}getNewPosition(){return this.newPosition}}class Qr extends Ml{constructor(u,d){super(u),this.value=d}getValue(){return this.value}isFNC1(){return this.value===Qr.FNC1}}Qr.FNC1="$";class $i extends Ml{constructor(u,d,m){super(u),m?(this.remaining=!0,this.remainingValue=this.remainingValue):(this.remaining=!1,this.remainingValue=0),this.newString=d}getNewString(){return this.newString}isRemaining(){return this.remaining}getRemainingValue(){return this.remainingValue}}class us extends Ml{constructor(u,d,m){if(super(u),d<0||d>10||m<0||m>10)throw new ue;this.firstDigit=d,this.secondDigit=m}getFirstDigit(){return this.firstDigit}getSecondDigit(){return this.secondDigit}getValue(){return this.firstDigit*10+this.secondDigit}isFirstDigitFNC1(){return this.firstDigit===us.FNC1}isSecondDigitFNC1(){return this.secondDigit===us.FNC1}isAnyFNC1(){return this.firstDigit===us.FNC1||this.secondDigit===us.FNC1}}us.FNC1=10;class lt{constructor(){}static parseFieldsInGeneralPurpose(u){if(!u)return null;if(u.length<2)throw new Pe;let d=u.substring(0,2);for(let w of lt.TWO_DIGIT_DATA_LENGTH)if(w[0]===d)return w[1]===lt.VARIABLE_LENGTH?lt.processVariableAI(2,w[2],u):lt.processFixedAI(2,w[1],u);if(u.length<3)throw new Pe;let m=u.substring(0,3);for(let w of lt.THREE_DIGIT_DATA_LENGTH)if(w[0]===m)return w[1]===lt.VARIABLE_LENGTH?lt.processVariableAI(3,w[2],u):lt.processFixedAI(3,w[1],u);for(let w of lt.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH)if(w[0]===m)return w[1]===lt.VARIABLE_LENGTH?lt.processVariableAI(4,w[2],u):lt.processFixedAI(4,w[1],u);if(u.length<4)throw new Pe;let b=u.substring(0,4);for(let w of lt.FOUR_DIGIT_DATA_LENGTH)if(w[0]===b)return w[1]===lt.VARIABLE_LENGTH?lt.processVariableAI(4,w[2],u):lt.processFixedAI(4,w[1],u);throw new Pe}static processFixedAI(u,d,m){if(m.length<u)throw new Pe;let b=m.substring(0,u);if(m.length<u+d)throw new Pe;let w=m.substring(u,u+d),S=m.substring(u+d),E="("+b+")"+w,A=lt.parseFieldsInGeneralPurpose(S);return A==null?E:E+A}static processVariableAI(u,d,m){let b=m.substring(0,u),w;m.length<u+d?w=m.length:w=u+d;let S=m.substring(u,w),E=m.substring(w),A="("+b+")"+S,G=lt.parseFieldsInGeneralPurpose(E);return G==null?A:A+G}}lt.VARIABLE_LENGTH=[],lt.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",lt.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",lt.VARIABLE_LENGTH,20],["22",lt.VARIABLE_LENGTH,29],["30",lt.VARIABLE_LENGTH,8],["37",lt.VARIABLE_LENGTH,8],["90",lt.VARIABLE_LENGTH,30],["91",lt.VARIABLE_LENGTH,30],["92",lt.VARIABLE_LENGTH,30],["93",lt.VARIABLE_LENGTH,30],["94",lt.VARIABLE_LENGTH,30],["95",lt.VARIABLE_LENGTH,30],["96",lt.VARIABLE_LENGTH,30],["97",lt.VARIABLE_LENGTH,3],["98",lt.VARIABLE_LENGTH,30],["99",lt.VARIABLE_LENGTH,30]],lt.THREE_DIGIT_DATA_LENGTH=[["240",lt.VARIABLE_LENGTH,30],["241",lt.VARIABLE_LENGTH,30],["242",lt.VARIABLE_LENGTH,6],["250",lt.VARIABLE_LENGTH,30],["251",lt.VARIABLE_LENGTH,30],["253",lt.VARIABLE_LENGTH,17],["254",lt.VARIABLE_LENGTH,20],["400",lt.VARIABLE_LENGTH,30],["401",lt.VARIABLE_LENGTH,30],["402",17],["403",lt.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",lt.VARIABLE_LENGTH,20],["421",lt.VARIABLE_LENGTH,15],["422",3],["423",lt.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],lt.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",lt.VARIABLE_LENGTH,15],["391",lt.VARIABLE_LENGTH,18],["392",lt.VARIABLE_LENGTH,15],["393",lt.VARIABLE_LENGTH,18],["703",lt.VARIABLE_LENGTH,30]],lt.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",lt.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",lt.VARIABLE_LENGTH,20],["8003",lt.VARIABLE_LENGTH,30],["8004",lt.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",lt.VARIABLE_LENGTH,30],["8008",lt.VARIABLE_LENGTH,12],["8018",18],["8020",lt.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",lt.VARIABLE_LENGTH,70],["8200",lt.VARIABLE_LENGTH,70]];class Ja{constructor(u){this.buffer=new _t,this.information=u}decodeAllCodes(u,d){let m=d,b=null;do{let w=this.decodeGeneralPurposeField(m,b),S=lt.parseFieldsInGeneralPurpose(w.getNewString());if(S!=null&&u.append(S),w.isRemaining()?b=""+w.getRemainingValue():b=null,m===w.getNewPosition())break;m=w.getNewPosition()}while(!0);return u.toString()}isStillNumeric(u){if(u+7>this.information.getSize())return u+4<=this.information.getSize();for(let d=u;d<u+3;++d)if(this.information.get(d))return!0;return this.information.get(u+3)}decodeNumeric(u){if(u+7>this.information.getSize()){let w=this.extractNumericValueFromBitArray(u,4);return w===0?new us(this.information.getSize(),us.FNC1,us.FNC1):new us(this.information.getSize(),w-1,us.FNC1)}let d=this.extractNumericValueFromBitArray(u,7),m=(d-8)/11,b=(d-8)%11;return new us(u+7,m,b)}extractNumericValueFromBitArray(u,d){return Ja.extractNumericValueFromBitArray(this.information,u,d)}static extractNumericValueFromBitArray(u,d,m){let b=0;for(let w=0;w<m;++w)u.get(d+w)&&(b|=1<<m-w-1);return b}decodeGeneralPurposeField(u,d){this.buffer.setLengthToZero(),d!=null&&this.buffer.append(d),this.current.setPosition(u);let m=this.parseBlocks();return m!=null&&m.isRemaining()?new $i(this.current.getPosition(),this.buffer.toString(),m.getRemainingValue()):new $i(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let u,d;do{let m=this.current.getPosition();if(this.current.isAlpha()?(d=this.parseAlphaBlock(),u=d.isFinished()):this.current.isIsoIec646()?(d=this.parseIsoIec646Block(),u=d.isFinished()):(d=this.parseNumericBlock(),u=d.isFinished()),!(m!==this.current.getPosition())&&!u)break}while(!u);return d.getDecodedInformation()}parseNumericBlock(){for(;this.isStillNumeric(this.current.getPosition());){let u=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(u.getNewPosition()),u.isFirstDigitFNC1()){let d;return u.isSecondDigitFNC1()?d=new $i(this.current.getPosition(),this.buffer.toString()):d=new $i(this.current.getPosition(),this.buffer.toString(),u.getSecondDigit()),new Ki(!0,d)}if(this.buffer.append(u.getFirstDigit()),u.isSecondDigitFNC1()){let d=new $i(this.current.getPosition(),this.buffer.toString());return new Ki(!0,d)}this.buffer.append(u.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new Ki(!1)}parseIsoIec646Block(){for(;this.isStillIsoIec646(this.current.getPosition());){let u=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(u.getNewPosition()),u.isFNC1()){let d=new $i(this.current.getPosition(),this.buffer.toString());return new Ki(!0,d)}this.buffer.append(u.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new Ki(!1)}parseAlphaBlock(){for(;this.isStillAlpha(this.current.getPosition());){let u=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(u.getNewPosition()),u.isFNC1()){let d=new $i(this.current.getPosition(),this.buffer.toString());return new Ki(!0,d)}this.buffer.append(u.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new Ki(!1)}isStillIsoIec646(u){if(u+5>this.information.getSize())return!1;let d=this.extractNumericValueFromBitArray(u,5);if(d>=5&&d<16)return!0;if(u+7>this.information.getSize())return!1;let m=this.extractNumericValueFromBitArray(u,7);if(m>=64&&m<116)return!0;if(u+8>this.information.getSize())return!1;let b=this.extractNumericValueFromBitArray(u,8);return b>=232&&b<253}decodeIsoIec646(u){let d=this.extractNumericValueFromBitArray(u,5);if(d===15)return new Qr(u+5,Qr.FNC1);if(d>=5&&d<15)return new Qr(u+5,"0"+(d-5));let m=this.extractNumericValueFromBitArray(u,7);if(m>=64&&m<90)return new Qr(u+7,""+(m+1));if(m>=90&&m<116)return new Qr(u+7,""+(m+7));let b=this.extractNumericValueFromBitArray(u,8),w;switch(b){case 232:w="!";break;case 233:w='"';break;case 234:w="%";break;case 235:w="&";break;case 236:w="'";break;case 237:w="(";break;case 238:w=")";break;case 239:w="*";break;case 240:w="+";break;case 241:w=",";break;case 242:w="-";break;case 243:w=".";break;case 244:w="/";break;case 245:w=":";break;case 246:w=";";break;case 247:w="<";break;case 248:w="=";break;case 249:w=">";break;case 250:w="?";break;case 251:w="_";break;case 252:w=" ";break;default:throw new ue}return new Qr(u+8,w)}isStillAlpha(u){if(u+5>this.information.getSize())return!1;let d=this.extractNumericValueFromBitArray(u,5);if(d>=5&&d<16)return!0;if(u+6>this.information.getSize())return!1;let m=this.extractNumericValueFromBitArray(u,6);return m>=16&&m<63}decodeAlphanumeric(u){let d=this.extractNumericValueFromBitArray(u,5);if(d===15)return new Qr(u+5,Qr.FNC1);if(d>=5&&d<15)return new Qr(u+5,"0"+(d-5));let m=this.extractNumericValueFromBitArray(u,6);if(m>=32&&m<58)return new Qr(u+6,""+(m+33));let b;switch(m){case 58:b="*";break;case 59:b=",";break;case 60:b="-";break;case 61:b=".";break;case 62:b="/";break;default:throw new Wi("Decoding invalid alphanumeric value: "+m)}return new Qr(u+6,b)}isAlphaTo646ToAlphaLatch(u){if(u+1>this.information.getSize())return!1;for(let d=0;d<5&&d+u<this.information.getSize();++d)if(d===2){if(!this.information.get(u+2))return!1}else if(this.information.get(u+d))return!1;return!0}isAlphaOr646ToNumericLatch(u){if(u+3>this.information.getSize())return!1;for(let d=u;d<u+3;++d)if(this.information.get(d))return!1;return!0}isNumericToAlphaNumericLatch(u){if(u+1>this.information.getSize())return!1;for(let d=0;d<4&&d+u<this.information.getSize();++d)if(this.information.get(u+d))return!1;return!0}}class Vo{constructor(u){this.information=u,this.generalDecoder=new Ja(u)}getInformation(){return this.information}getGeneralDecoder(){return this.generalDecoder}}class Rr extends Vo{constructor(u){super(u)}encodeCompressedGtin(u,d){u.append("(01)");let m=u.length();u.append("9"),this.encodeCompressedGtinWithoutAI(u,d,m)}encodeCompressedGtinWithoutAI(u,d,m){for(let b=0;b<4;++b){let w=this.getGeneralDecoder().extractNumericValueFromBitArray(d+10*b,10);w/100===0&&u.append("0"),w/10===0&&u.append("0"),u.append(w)}Rr.appendCheckDigit(u,m)}static appendCheckDigit(u,d){let m=0;for(let b=0;b<13;b++){let w=u.charAt(b+d).charCodeAt(0)-48;m+=b&1?w:3*w}m=10-m%10,m===10&&(m=0),u.append(m)}}Rr.GTIN_SIZE=40;class qa extends Rr{constructor(u){super(u)}parseInformation(){let u=new _t;u.append("(01)");let d=u.length(),m=this.getGeneralDecoder().extractNumericValueFromBitArray(qa.HEADER_SIZE,4);return u.append(m),this.encodeCompressedGtinWithoutAI(u,qa.HEADER_SIZE+4,d),this.getGeneralDecoder().decodeAllCodes(u,qa.HEADER_SIZE+44)}}qa.HEADER_SIZE=4;class Bo extends Vo{constructor(u){super(u)}parseInformation(){let u=new _t;return this.getGeneralDecoder().decodeAllCodes(u,Bo.HEADER_SIZE)}}Bo.HEADER_SIZE=5;class Ll extends Rr{constructor(u){super(u)}encodeCompressedWeight(u,d,m){let b=this.getGeneralDecoder().extractNumericValueFromBitArray(d,m);this.addWeightCode(u,b);let w=this.checkWeight(b),S=1e5;for(let E=0;E<5;++E)w/S===0&&u.append("0"),S/=10;u.append(w)}}class ti extends Ll{constructor(u){super(u)}parseInformation(){if(this.getInformation().getSize()!=ti.HEADER_SIZE+Ll.GTIN_SIZE+ti.WEIGHT_SIZE)throw new Pe;let u=new _t;return this.encodeCompressedGtin(u,ti.HEADER_SIZE),this.encodeCompressedWeight(u,ti.HEADER_SIZE+Ll.GTIN_SIZE,ti.WEIGHT_SIZE),u.toString()}}ti.HEADER_SIZE=5,ti.WEIGHT_SIZE=15;class cf extends ti{constructor(u){super(u)}addWeightCode(u,d){u.append("(3103)")}checkWeight(u){return u}}class Eh extends ti{constructor(u){super(u)}addWeightCode(u,d){d<1e4?u.append("(3202)"):u.append("(3203)")}checkWeight(u){return u<1e4?u:u-1e4}}class ni extends Rr{constructor(u){super(u)}parseInformation(){if(this.getInformation().getSize()<ni.HEADER_SIZE+Rr.GTIN_SIZE)throw new Pe;let u=new _t;this.encodeCompressedGtin(u,ni.HEADER_SIZE);let d=this.getGeneralDecoder().extractNumericValueFromBitArray(ni.HEADER_SIZE+Rr.GTIN_SIZE,ni.LAST_DIGIT_SIZE);u.append("(392"),u.append(d),u.append(")");let m=this.getGeneralDecoder().decodeGeneralPurposeField(ni.HEADER_SIZE+Rr.GTIN_SIZE+ni.LAST_DIGIT_SIZE,null);return u.append(m.getNewString()),u.toString()}}ni.HEADER_SIZE=8,ni.LAST_DIGIT_SIZE=2;class Wr extends Rr{constructor(u){super(u)}parseInformation(){if(this.getInformation().getSize()<Wr.HEADER_SIZE+Rr.GTIN_SIZE)throw new Pe;let u=new _t;this.encodeCompressedGtin(u,Wr.HEADER_SIZE);let d=this.getGeneralDecoder().extractNumericValueFromBitArray(Wr.HEADER_SIZE+Rr.GTIN_SIZE,Wr.LAST_DIGIT_SIZE);u.append("(393"),u.append(d),u.append(")");let m=this.getGeneralDecoder().extractNumericValueFromBitArray(Wr.HEADER_SIZE+Rr.GTIN_SIZE+Wr.LAST_DIGIT_SIZE,Wr.FIRST_THREE_DIGITS_SIZE);m/100==0&&u.append("0"),m/10==0&&u.append("0"),u.append(m);let b=this.getGeneralDecoder().decodeGeneralPurposeField(Wr.HEADER_SIZE+Rr.GTIN_SIZE+Wr.LAST_DIGIT_SIZE+Wr.FIRST_THREE_DIGITS_SIZE,null);return u.append(b.getNewString()),u.toString()}}Wr.HEADER_SIZE=8,Wr.LAST_DIGIT_SIZE=2,Wr.FIRST_THREE_DIGITS_SIZE=10;class An extends Ll{constructor(u,d,m){super(u),this.dateCode=m,this.firstAIdigits=d}parseInformation(){if(this.getInformation().getSize()!=An.HEADER_SIZE+An.GTIN_SIZE+An.WEIGHT_SIZE+An.DATE_SIZE)throw new Pe;let u=new _t;return this.encodeCompressedGtin(u,An.HEADER_SIZE),this.encodeCompressedWeight(u,An.HEADER_SIZE+An.GTIN_SIZE,An.WEIGHT_SIZE),this.encodeCompressedDate(u,An.HEADER_SIZE+An.GTIN_SIZE+An.WEIGHT_SIZE),u.toString()}encodeCompressedDate(u,d){let m=this.getGeneralDecoder().extractNumericValueFromBitArray(d,An.DATE_SIZE);if(m==38400)return;u.append("("),u.append(this.dateCode),u.append(")");let b=m%32;m/=32;let w=m%12+1;m/=12;let S=m;S/10==0&&u.append("0"),u.append(S),w/10==0&&u.append("0"),u.append(w),b/10==0&&u.append("0"),u.append(b)}addWeightCode(u,d){u.append("("),u.append(this.firstAIdigits),u.append(d/1e5),u.append(")")}checkWeight(u){return u%1e5}}An.HEADER_SIZE=8,An.WEIGHT_SIZE=20,An.DATE_SIZE=16;function ec(K){try{if(K.get(1))return new qa(K);if(!K.get(2))return new Bo(K);switch(Ja.extractNumericValueFromBitArray(K,1,4)){case 4:return new cf(K);case 5:return new Eh(K)}switch(Ja.extractNumericValueFromBitArray(K,1,5)){case 12:return new ni(K);case 13:return new Wr(K)}switch(Ja.extractNumericValueFromBitArray(K,1,7)){case 56:return new An(K,"310","11");case 57:return new An(K,"320","11");case 58:return new An(K,"310","13");case 59:return new An(K,"320","13");case 60:return new An(K,"310","15");case 61:return new An(K,"320","15");case 62:return new An(K,"310","17");case 63:return new An(K,"320","17")}}catch(u){throw console.log(u),new Wi("unknown decoder: "+K)}}class Ui{constructor(u,d,m,b){this.leftchar=u,this.rightchar=d,this.finderpattern=m,this.maybeLast=b}mayBeLast(){return this.maybeLast}getLeftChar(){return this.leftchar}getRightChar(){return this.rightchar}getFinderPattern(){return this.finderpattern}mustBeLast(){return this.rightchar==null}toString(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(this.finderpattern==null?"null":this.finderpattern.getValue())+" ]"}static equals(u,d){return u instanceof Ui?Ui.equalsOrNull(u.leftchar,d.leftchar)&&Ui.equalsOrNull(u.rightchar,d.rightchar)&&Ui.equalsOrNull(u.finderpattern,d.finderpattern):!1}static equalsOrNull(u,d){return u===null?d===null:Ui.equals(u,d)}hashCode(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()}}class tc{constructor(u,d,m){this.pairs=u,this.rowNumber=d,this.wasReversed=m}getPairs(){return this.pairs}getRowNumber(){return this.rowNumber}isReversed(){return this.wasReversed}isEquivalent(u){return this.checkEqualitity(this,u)}toString(){return"{ "+this.pairs+" }"}equals(u,d){return u instanceof tc?this.checkEqualitity(u,d)&&u.wasReversed===d.wasReversed:!1}checkEqualitity(u,d){if(!u||!d)return;let m;return u.forEach((b,w)=>{d.forEach(S=>{b.getLeftChar().getValue()===S.getLeftChar().getValue()&&b.getRightChar().getValue()===S.getRightChar().getValue()&&b.getFinderPatter().getValue()===S.getFinderPatter().getValue()&&(m=!0)})}),m}}class ze extends dr{constructor(u){super(...arguments),this.pairs=new Array(ze.MAX_PAIRS),this.rows=new Array,this.startEnd=[2],this.verbose=u===!0}decodeRow(u,d,m){this.pairs.length=0,this.startFromEven=!1;try{return ze.constructResult(this.decodeRow2pairs(u,d))}catch(b){this.verbose&&console.log(b)}return this.pairs.length=0,this.startFromEven=!0,ze.constructResult(this.decodeRow2pairs(u,d))}reset(){this.pairs.length=0,this.rows.length=0}decodeRow2pairs(u,d){let m=!1;for(;!m;)try{this.pairs.push(this.retrieveNextPair(d,this.pairs,u))}catch(w){if(w instanceof Pe){if(!this.pairs.length)throw new Pe;m=!0}}if(this.checkChecksum())return this.pairs;let b;if(this.rows.length?b=!0:b=!1,this.storeRow(u,!1),b){let w=this.checkRowsBoolean(!1);if(w!=null||(w=this.checkRowsBoolean(!0),w!=null))return w}throw new Pe}checkRowsBoolean(u){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,u&&(this.rows=this.rows.reverse());let d=null;try{d=this.checkRows(new Array,0)}catch(m){this.verbose&&console.log(m)}return u&&(this.rows=this.rows.reverse()),d}checkRows(u,d){for(let m=d;m<this.rows.length;m++){let b=this.rows[m];this.pairs.length=0;for(let S of u)this.pairs.push(S.getPairs());if(this.pairs.push(b.getPairs()),!ze.isValidSequence(this.pairs))continue;if(this.checkChecksum())return this.pairs;let w=new Array(u);w.push(b);try{return this.checkRows(w,m+1)}catch(S){this.verbose&&console.log(S)}}throw new Pe}static isValidSequence(u){for(let d of ze.FINDER_PATTERN_SEQUENCES){if(u.length>d.length)continue;let m=!0;for(let b=0;b<u.length;b++)if(u[b].getFinderPattern().getValue()!=d[b]){m=!1;break}if(m)return!0}return!1}storeRow(u,d){let m=0,b=!1,w=!1;for(;m<this.rows.length;){let S=this.rows[m];if(S.getRowNumber()>u){w=S.isEquivalent(this.pairs);break}b=S.isEquivalent(this.pairs),m++}w||b||ze.isPartialRow(this.pairs,this.rows)||(this.rows.push(m,new tc(this.pairs,u,d)),this.removePartialRows(this.pairs,this.rows))}removePartialRows(u,d){for(let m of d)if(m.getPairs().length!==u.length){for(let b of m.getPairs())for(let w of u)if(Ui.equals(b,w))break}}static isPartialRow(u,d){for(let m of d){let b=!0;for(let w of u){let S=!1;for(let E of m.getPairs())if(w.equals(E)){S=!0;break}if(!S){b=!1;break}}if(b)return!0}return!1}getRows(){return this.rows}static constructResult(u){let d=kh.buildBitArray(u),b=ec(d).parseInformation(),w=u[0].getFinderPattern().getResultPoints(),S=u[u.length-1].getFinderPattern().getResultPoints(),E=[w[0],w[1],S[0],S[1]];return new En(b,null,null,E,yt.RSS_EXPANDED,null)}checkChecksum(){let u=this.pairs.get(0),d=u.getLeftChar(),m=u.getRightChar();if(m==null)return!1;let b=m.getChecksumPortion(),w=2;for(let E=1;E<this.pairs.size();++E){let A=this.pairs.get(E);b+=A.getLeftChar().getChecksumPortion(),w++;let G=A.getRightChar();G!=null&&(b+=G.getChecksumPortion(),w++)}return b%=211,211*(w-4)+b==d.getValue()}static getNextSecondBar(u,d){let m;return u.get(d)?(m=u.getNextUnset(d),m=u.getNextSet(m)):(m=u.getNextSet(d),m=u.getNextUnset(m)),m}retrieveNextPair(u,d,m){let b=d.length%2==0;this.startFromEven&&(b=!b);let w,S=!0,E=-1;do this.findNextPair(u,d,E),w=this.parseFoundFinderPattern(u,m,b),w==null?E=ze.getNextSecondBar(u,this.startEnd[0]):S=!1;while(S);let A=this.decodeDataCharacter(u,w,b,!0);if(!this.isEmptyPair(d)&&d[d.length-1].mustBeLast())throw new Pe;let G;try{G=this.decodeDataCharacter(u,w,b,!1)}catch(B){G=null,this.verbose&&console.log(B)}return new Ui(A,G,w,!0)}isEmptyPair(u){return u.length===0}findNextPair(u,d,m){let b=this.getDecodeFinderCounters();b[0]=0,b[1]=0,b[2]=0,b[3]=0;let w=u.getSize(),S;m>=0?S=m:this.isEmptyPair(d)?S=0:S=d[d.length-1].getFinderPattern().getStartEnd()[1];let E=d.length%2!=0;this.startFromEven&&(E=!E);let A=!1;for(;S<w&&(A=!u.get(S),!!A);)S++;let G=0,B=S;for(let Z=S;Z<w;Z++)if(u.get(Z)!=A)b[G]++;else{if(G==3){if(E&&ze.reverseCounters(b),ze.isFinderPattern(b)){this.startEnd[0]=B,this.startEnd[1]=Z;return}E&&ze.reverseCounters(b),B+=b[0]+b[1],b[0]=b[2],b[1]=b[3],b[2]=0,b[3]=0,G--}else G++;b[G]=1,A=!A}throw new Pe}static reverseCounters(u){let d=u.length;for(let m=0;m<d/2;++m){let b=u[m];u[m]=u[d-m-1],u[d-m-1]=b}}parseFoundFinderPattern(u,d,m){let b,w,S;if(m){let G=this.startEnd[0]-1;for(;G>=0&&!u.get(G);)G--;G++,b=this.startEnd[0]-G,w=G,S=this.startEnd[1]}else w=this.startEnd[0],S=u.getNextUnset(this.startEnd[1]+1),b=S-this.startEnd[1];let E=this.getDecodeFinderCounters();se.arraycopy(E,0,E,1,E.length-1),E[0]=b;let A;try{A=this.parseFinderValue(E,ze.FINDER_PATTERNS)}catch{return null}return new Qa(A,[w,S],w,S,d)}decodeDataCharacter(u,d,m,b){let w=this.getDataCharacterCounters();for(let zt=0;zt<w.length;zt++)w[zt]=0;if(b)ze.recordPatternInReverse(u,d.getStartEnd()[0],w);else{ze.recordPattern(u,d.getStartEnd()[1],w);for(let zt=0,Pt=w.length-1;zt<Pt;zt++,Pt--){let Sn=w[zt];w[zt]=w[Pt],w[Pt]=Sn}}let S=17,E=Ht.sum(new Int32Array(w))/S,A=(d.getStartEnd()[1]-d.getStartEnd()[0])/15;if(Math.abs(E-A)/A>.3)throw new Pe;let G=this.getOddCounts(),B=this.getEvenCounts(),Z=this.getOddRoundingErrors(),U=this.getEvenRoundingErrors();for(let zt=0;zt<w.length;zt++){let Pt=1*w[zt]/E,Sn=Pt+.5;if(Sn<1){if(Pt<.3)throw new Pe;Sn=1}else if(Sn>8){if(Pt>8.7)throw new Pe;Sn=8}let Yo=zt/2;zt&1?(B[Yo]=Sn,U[Yo]=Pt-Sn):(G[Yo]=Sn,Z[Yo]=Pt-Sn)}this.adjustOddEvenCounts(S);let ne=4*d.getValue()+(m?0:2)+(b?0:1)-1,le=0,ce=0;for(let zt=G.length-1;zt>=0;zt--){if(ze.isNotA1left(d,m,b)){let Pt=ze.WEIGHTS[ne][2*zt];ce+=G[zt]*Pt}le+=G[zt]}let ve=0;for(let zt=B.length-1;zt>=0;zt--)if(ze.isNotA1left(d,m,b)){let Pt=ze.WEIGHTS[ne][2*zt+1];ve+=B[zt]*Pt}let Re=ce+ve;if(le&1||le>13||le<4)throw new Pe;let Xe=(13-le)/2,Ye=ze.SYMBOL_WIDEST[Xe],Ke=9-Ye,Kt=ei.getRSSvalue(G,Ye,!0),At=ei.getRSSvalue(B,Ke,!1),Cs=ze.EVEN_TOTAL_SUBSET[Xe],vi=ze.GSUM[Xe],hs=Kt*Cs+At+vi;return new Zi(hs,Re)}static isNotA1left(u,d,m){return!(u.getValue()==0&&d&&m)}adjustOddEvenCounts(u){let d=Ht.sum(new Int32Array(this.getOddCounts())),m=Ht.sum(new Int32Array(this.getEvenCounts())),b=!1,w=!1;d>13?w=!0:d<4&&(b=!0);let S=!1,E=!1;m>13?E=!0:m<4&&(S=!0);let A=d+m-u,G=(d&1)==1,B=(m&1)==0;if(A==1)if(G){if(B)throw new Pe;w=!0}else{if(!B)throw new Pe;E=!0}else if(A==-1)if(G){if(B)throw new Pe;b=!0}else{if(!B)throw new Pe;S=!0}else if(A==0){if(G){if(!B)throw new Pe;d<m?(b=!0,E=!0):(w=!0,S=!0)}else if(B)throw new Pe}else throw new Pe;if(b){if(w)throw new Pe;ze.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(w&&ze.decrement(this.getOddCounts(),this.getOddRoundingErrors()),S){if(E)throw new Pe;ze.increment(this.getEvenCounts(),this.getOddRoundingErrors())}E&&ze.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}ze.SYMBOL_WIDEST=[7,5,4,3,1],ze.EVEN_TOTAL_SUBSET=[4,20,52,104,204],ze.GSUM=[0,348,1388,2948,3988],ze.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],ze.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],ze.FINDER_PAT_A=0,ze.FINDER_PAT_B=1,ze.FINDER_PAT_C=2,ze.FINDER_PAT_D=3,ze.FINDER_PAT_E=4,ze.FINDER_PAT_F=5,ze.FINDER_PATTERN_SEQUENCES=[[ze.FINDER_PAT_A,ze.FINDER_PAT_A],[ze.FINDER_PAT_A,ze.FINDER_PAT_B,ze.FINDER_PAT_B],[ze.FINDER_PAT_A,ze.FINDER_PAT_C,ze.FINDER_PAT_B,ze.FINDER_PAT_D],[ze.FINDER_PAT_A,ze.FINDER_PAT_E,ze.FINDER_PAT_B,ze.FINDER_PAT_D,ze.FINDER_PAT_C],[ze.FINDER_PAT_A,ze.FINDER_PAT_E,ze.FINDER_PAT_B,ze.FINDER_PAT_D,ze.FINDER_PAT_D,ze.FINDER_PAT_F],[ze.FINDER_PAT_A,ze.FINDER_PAT_E,ze.FINDER_PAT_B,ze.FINDER_PAT_D,ze.FINDER_PAT_E,ze.FINDER_PAT_F,ze.FINDER_PAT_F],[ze.FINDER_PAT_A,ze.FINDER_PAT_A,ze.FINDER_PAT_B,ze.FINDER_PAT_B,ze.FINDER_PAT_C,ze.FINDER_PAT_C,ze.FINDER_PAT_D,ze.FINDER_PAT_D],[ze.FINDER_PAT_A,ze.FINDER_PAT_A,ze.FINDER_PAT_B,ze.FINDER_PAT_B,ze.FINDER_PAT_C,ze.FINDER_PAT_C,ze.FINDER_PAT_D,ze.FINDER_PAT_E,ze.FINDER_PAT_E],[ze.FINDER_PAT_A,ze.FINDER_PAT_A,ze.FINDER_PAT_B,ze.FINDER_PAT_B,ze.FINDER_PAT_C,ze.FINDER_PAT_C,ze.FINDER_PAT_D,ze.FINDER_PAT_E,ze.FINDER_PAT_F,ze.FINDER_PAT_F],[ze.FINDER_PAT_A,ze.FINDER_PAT_A,ze.FINDER_PAT_B,ze.FINDER_PAT_B,ze.FINDER_PAT_C,ze.FINDER_PAT_D,ze.FINDER_PAT_D,ze.FINDER_PAT_E,ze.FINDER_PAT_E,ze.FINDER_PAT_F,ze.FINDER_PAT_F]],ze.MAX_PAIRS=11;class nc extends Zi{constructor(u,d,m){super(u,d),this.count=0,this.finderPattern=m}getFinderPattern(){return this.finderPattern}getCount(){return this.count}incrementCount(){this.count++}}class Vn extends dr{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(u,d,m){const b=this.decodePair(d,!1,u,m);Vn.addOrTally(this.possibleLeftPairs,b),d.reverse();let w=this.decodePair(d,!0,u,m);Vn.addOrTally(this.possibleRightPairs,w),d.reverse();for(let S of this.possibleLeftPairs)if(S.getCount()>1){for(let E of this.possibleRightPairs)if(E.getCount()>1&&Vn.checkChecksum(S,E))return Vn.constructResult(S,E)}throw new Pe}static addOrTally(u,d){if(d==null)return;let m=!1;for(let b of u)if(b.getValue()===d.getValue()){b.incrementCount(),m=!0;break}m||u.push(d)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(u,d){let m=4537077*u.getValue()+d.getValue(),b=new String(m).toString(),w=new _t;for(let G=13-b.length;G>0;G--)w.append("0");w.append(b);let S=0;for(let G=0;G<13;G++){let B=w.charAt(G).charCodeAt(0)-48;S+=G&1?B:3*B}S=10-S%10,S===10&&(S=0),w.append(S.toString());let E=u.getFinderPattern().getResultPoints(),A=d.getFinderPattern().getResultPoints();return new En(w.toString(),null,0,[E[0],E[1],A[0],A[1]],yt.RSS_14,new Date().getTime())}static checkChecksum(u,d){let m=(u.getChecksumPortion()+16*d.getChecksumPortion())%79,b=9*u.getFinderPattern().getValue()+d.getFinderPattern().getValue();return b>72&&b--,b>8&&b--,m===b}decodePair(u,d,m,b){try{let w=this.findFinderPattern(u,d),S=this.parseFoundFinderPattern(u,m,d,w),E=b==null?null:b.get(Fe.NEED_RESULT_POINT_CALLBACK);if(E!=null){let B=(w[0]+w[1])/2;d&&(B=u.getSize()-1-B),E.foundPossibleResultPoint(new gt(B,m))}let A=this.decodeDataCharacter(u,S,!0),G=this.decodeDataCharacter(u,S,!1);return new nc(1597*A.getValue()+G.getValue(),A.getChecksumPortion()+4*G.getChecksumPortion(),S)}catch{return null}}decodeDataCharacter(u,d,m){let b=this.getDataCharacterCounters();for(let ve=0;ve<b.length;ve++)b[ve]=0;if(m)_n.recordPatternInReverse(u,d.getStartEnd()[0],b);else{_n.recordPattern(u,d.getStartEnd()[1]+1,b);for(let ve=0,Re=b.length-1;ve<Re;ve++,Re--){let Xe=b[ve];b[ve]=b[Re],b[Re]=Xe}}let w=m?16:15,S=Ht.sum(new Int32Array(b))/w,E=this.getOddCounts(),A=this.getEvenCounts(),G=this.getOddRoundingErrors(),B=this.getEvenRoundingErrors();for(let ve=0;ve<b.length;ve++){let Re=b[ve]/S,Xe=Math.floor(Re+.5);Xe<1?Xe=1:Xe>8&&(Xe=8);let Ye=Math.floor(ve/2);ve&1?(A[Ye]=Xe,B[Ye]=Re-Xe):(E[Ye]=Xe,G[Ye]=Re-Xe)}this.adjustOddEvenCounts(m,w);let Z=0,U=0;for(let ve=E.length-1;ve>=0;ve--)U*=9,U+=E[ve],Z+=E[ve];let ne=0,le=0;for(let ve=A.length-1;ve>=0;ve--)ne*=9,ne+=A[ve],le+=A[ve];let ce=U+3*ne;if(m){if(Z&1||Z>12||Z<4)throw new Pe;let ve=(12-Z)/2,Re=Vn.OUTSIDE_ODD_WIDEST[ve],Xe=9-Re,Ye=ei.getRSSvalue(E,Re,!1),Ke=ei.getRSSvalue(A,Xe,!0),Kt=Vn.OUTSIDE_EVEN_TOTAL_SUBSET[ve],At=Vn.OUTSIDE_GSUM[ve];return new Zi(Ye*Kt+Ke+At,ce)}else{if(le&1||le>10||le<4)throw new Pe;let ve=(10-le)/2,Re=Vn.INSIDE_ODD_WIDEST[ve],Xe=9-Re,Ye=ei.getRSSvalue(E,Re,!0),Ke=ei.getRSSvalue(A,Xe,!1),Kt=Vn.INSIDE_ODD_TOTAL_SUBSET[ve],At=Vn.INSIDE_GSUM[ve];return new Zi(Ke*Kt+Ye+At,ce)}}findFinderPattern(u,d){let m=this.getDecodeFinderCounters();m[0]=0,m[1]=0,m[2]=0,m[3]=0;let b=u.getSize(),w=!1,S=0;for(;S<b&&(w=!u.get(S),d!==w);)S++;let E=0,A=S;for(let G=S;G<b;G++)if(u.get(G)!==w)m[E]++;else{if(E===3){if(dr.isFinderPattern(m))return[A,G];A+=m[0]+m[1],m[0]=m[2],m[1]=m[3],m[2]=0,m[3]=0,E--}else E++;m[E]=1,w=!w}throw new Pe}parseFoundFinderPattern(u,d,m,b){let w=u.get(b[0]),S=b[0]-1;for(;S>=0&&w!==u.get(S);)S--;S++;const E=b[0]-S,A=this.getDecodeFinderCounters(),G=new Int32Array(A.length);se.arraycopy(A,0,G,1,A.length-1),G[0]=E;const B=this.parseFinderValue(G,Vn.FINDER_PATTERNS);let Z=S,U=b[1];return m&&(Z=u.getSize()-1-Z,U=u.getSize()-1-U),new Qa(B,[S,b[1]],Z,U,d)}adjustOddEvenCounts(u,d){let m=Ht.sum(new Int32Array(this.getOddCounts())),b=Ht.sum(new Int32Array(this.getEvenCounts())),w=!1,S=!1,E=!1,A=!1;u?(m>12?S=!0:m<4&&(w=!0),b>12?A=!0:b<4&&(E=!0)):(m>11?S=!0:m<5&&(w=!0),b>10?A=!0:b<4&&(E=!0));let G=m+b-d,B=(m&1)===(u?1:0),Z=(b&1)===1;if(G===1)if(B){if(Z)throw new Pe;S=!0}else{if(!Z)throw new Pe;A=!0}else if(G===-1)if(B){if(Z)throw new Pe;w=!0}else{if(!Z)throw new Pe;E=!0}else if(G===0){if(B){if(!Z)throw new Pe;m<b?(w=!0,A=!0):(S=!0,E=!0)}else if(Z)throw new Pe}else throw new Pe;if(w){if(S)throw new Pe;dr.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(S&&dr.decrement(this.getOddCounts(),this.getOddRoundingErrors()),E){if(A)throw new Pe;dr.increment(this.getEvenCounts(),this.getOddRoundingErrors())}A&&dr.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}Vn.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],Vn.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],Vn.OUTSIDE_GSUM=[0,161,961,2015,2715],Vn.INSIDE_GSUM=[0,336,1036,1516],Vn.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],Vn.INSIDE_ODD_WIDEST=[2,4,6,8],Vn.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];class Hi extends _n{constructor(u,d){super(),this.readers=[],this.verbose=d===!0;const m=u?u.get(Fe.POSSIBLE_FORMATS):null,b=u&&u.get(Fe.ASSUME_CODE_39_CHECK_DIGIT)!==void 0;m?((m.includes(yt.EAN_13)||m.includes(yt.UPC_A)||m.includes(yt.EAN_8)||m.includes(yt.UPC_E))&&this.readers.push(new Th(u)),m.includes(yt.CODE_39)&&this.readers.push(new Un(b)),m.includes(yt.CODE_128)&&this.readers.push(new et),m.includes(yt.ITF)&&this.readers.push(new on),m.includes(yt.RSS_14)&&this.readers.push(new Vn),m.includes(yt.RSS_EXPANDED)&&this.readers.push(new ze(this.verbose))):(this.readers.push(new Th(u)),this.readers.push(new Un),this.readers.push(new Th(u)),this.readers.push(new et),this.readers.push(new on),this.readers.push(new Vn),this.readers.push(new ze(this.verbose)))}decodeRow(u,d,m){for(let b=0;b<this.readers.length;b++)try{return this.readers[b].decodeRow(u,d,m)}catch{}throw new Pe}reset(){this.readers.forEach(u=>u.reset())}}class hf extends qs{constructor(u=500,d){super(new Hi(d),u,d)}}class Jt{constructor(u,d,m){this.ecCodewords=u,this.ecBlocks=[d],m&&this.ecBlocks.push(m)}getECCodewords(){return this.ecCodewords}getECBlocks(){return this.ecBlocks}}class qt{constructor(u,d){this.count=u,this.dataCodewords=d}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class Wt{constructor(u,d,m,b,w,S){this.versionNumber=u,this.symbolSizeRows=d,this.symbolSizeColumns=m,this.dataRegionSizeRows=b,this.dataRegionSizeColumns=w,this.ecBlocks=S;let E=0;const A=S.getECCodewords(),G=S.getECBlocks();for(let B of G)E+=B.getCount()*(B.getDataCodewords()+A);this.totalCodewords=E}getVersionNumber(){return this.versionNumber}getSymbolSizeRows(){return this.symbolSizeRows}getSymbolSizeColumns(){return this.symbolSizeColumns}getDataRegionSizeRows(){return this.dataRegionSizeRows}getDataRegionSizeColumns(){return this.dataRegionSizeColumns}getTotalCodewords(){return this.totalCodewords}getECBlocks(){return this.ecBlocks}static getVersionForDimensions(u,d){if(u&1||d&1)throw new ue;for(let m of Wt.VERSIONS)if(m.symbolSizeRows===u&&m.symbolSizeColumns===d)return m;throw new ue}toString(){return""+this.versionNumber}static buildVersions(){return[new Wt(1,10,10,8,8,new Jt(5,new qt(1,3))),new Wt(2,12,12,10,10,new Jt(7,new qt(1,5))),new Wt(3,14,14,12,12,new Jt(10,new qt(1,8))),new Wt(4,16,16,14,14,new Jt(12,new qt(1,12))),new Wt(5,18,18,16,16,new Jt(14,new qt(1,18))),new Wt(6,20,20,18,18,new Jt(18,new qt(1,22))),new Wt(7,22,22,20,20,new Jt(20,new qt(1,30))),new Wt(8,24,24,22,22,new Jt(24,new qt(1,36))),new Wt(9,26,26,24,24,new Jt(28,new qt(1,44))),new Wt(10,32,32,14,14,new Jt(36,new qt(1,62))),new Wt(11,36,36,16,16,new Jt(42,new qt(1,86))),new Wt(12,40,40,18,18,new Jt(48,new qt(1,114))),new Wt(13,44,44,20,20,new Jt(56,new qt(1,144))),new Wt(14,48,48,22,22,new Jt(68,new qt(1,174))),new Wt(15,52,52,24,24,new Jt(42,new qt(2,102))),new Wt(16,64,64,14,14,new Jt(56,new qt(2,140))),new Wt(17,72,72,16,16,new Jt(36,new qt(4,92))),new Wt(18,80,80,18,18,new Jt(48,new qt(4,114))),new Wt(19,88,88,20,20,new Jt(56,new qt(4,144))),new Wt(20,96,96,22,22,new Jt(68,new qt(4,174))),new Wt(21,104,104,24,24,new Jt(56,new qt(6,136))),new Wt(22,120,120,18,18,new Jt(68,new qt(6,175))),new Wt(23,132,132,20,20,new Jt(62,new qt(8,163))),new Wt(24,144,144,22,22,new Jt(62,new qt(8,156),new qt(2,155))),new Wt(25,8,18,6,16,new Jt(7,new qt(1,5))),new Wt(26,8,32,6,14,new Jt(11,new qt(1,10))),new Wt(27,12,26,10,24,new Jt(14,new qt(1,16))),new Wt(28,12,36,10,16,new Jt(18,new qt(1,22))),new Wt(29,16,36,14,16,new Jt(24,new qt(1,32))),new Wt(30,16,48,14,22,new Jt(28,new qt(1,49)))]}}Wt.VERSIONS=Wt.buildVersions();class Dl{constructor(u){const d=u.getHeight();if(d<8||d>144||d&1)throw new ue;this.version=Dl.readVersion(u),this.mappingBitMatrix=this.extractDataRegion(u),this.readMappingMatrix=new fn(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}getVersion(){return this.version}static readVersion(u){const d=u.getHeight(),m=u.getWidth();return Wt.getVersionForDimensions(d,m)}readCodewords(){const u=new Int8Array(this.version.getTotalCodewords());let d=0,m=4,b=0;const w=this.mappingBitMatrix.getHeight(),S=this.mappingBitMatrix.getWidth();let E=!1,A=!1,G=!1,B=!1;do if(m===w&&b===0&&!E)u[d++]=this.readCorner1(w,S)&255,m-=2,b+=2,E=!0;else if(m===w-2&&b===0&&S&3&&!A)u[d++]=this.readCorner2(w,S)&255,m-=2,b+=2,A=!0;else if(m===w+4&&b===2&&!(S&7)&&!G)u[d++]=this.readCorner3(w,S)&255,m-=2,b+=2,G=!0;else if(m===w-2&&b===0&&(S&7)===4&&!B)u[d++]=this.readCorner4(w,S)&255,m-=2,b+=2,B=!0;else{do m<w&&b>=0&&!this.readMappingMatrix.get(b,m)&&(u[d++]=this.readUtah(m,b,w,S)&255),m-=2,b+=2;while(m>=0&&b<S);m+=1,b+=3;do m>=0&&b<S&&!this.readMappingMatrix.get(b,m)&&(u[d++]=this.readUtah(m,b,w,S)&255),m+=2,b-=2;while(m<w&&b>=0);m+=3,b+=1}while(m<w||b<S);if(d!==this.version.getTotalCodewords())throw new ue;return u}readModule(u,d,m,b){return u<0&&(u+=m,d+=4-(m+4&7)),d<0&&(d+=b,u+=4-(b+4&7)),this.readMappingMatrix.set(d,u),this.mappingBitMatrix.get(d,u)}readUtah(u,d,m,b){let w=0;return this.readModule(u-2,d-2,m,b)&&(w|=1),w<<=1,this.readModule(u-2,d-1,m,b)&&(w|=1),w<<=1,this.readModule(u-1,d-2,m,b)&&(w|=1),w<<=1,this.readModule(u-1,d-1,m,b)&&(w|=1),w<<=1,this.readModule(u-1,d,m,b)&&(w|=1),w<<=1,this.readModule(u,d-2,m,b)&&(w|=1),w<<=1,this.readModule(u,d-1,m,b)&&(w|=1),w<<=1,this.readModule(u,d,m,b)&&(w|=1),w}readCorner1(u,d){let m=0;return this.readModule(u-1,0,u,d)&&(m|=1),m<<=1,this.readModule(u-1,1,u,d)&&(m|=1),m<<=1,this.readModule(u-1,2,u,d)&&(m|=1),m<<=1,this.readModule(0,d-2,u,d)&&(m|=1),m<<=1,this.readModule(0,d-1,u,d)&&(m|=1),m<<=1,this.readModule(1,d-1,u,d)&&(m|=1),m<<=1,this.readModule(2,d-1,u,d)&&(m|=1),m<<=1,this.readModule(3,d-1,u,d)&&(m|=1),m}readCorner2(u,d){let m=0;return this.readModule(u-3,0,u,d)&&(m|=1),m<<=1,this.readModule(u-2,0,u,d)&&(m|=1),m<<=1,this.readModule(u-1,0,u,d)&&(m|=1),m<<=1,this.readModule(0,d-4,u,d)&&(m|=1),m<<=1,this.readModule(0,d-3,u,d)&&(m|=1),m<<=1,this.readModule(0,d-2,u,d)&&(m|=1),m<<=1,this.readModule(0,d-1,u,d)&&(m|=1),m<<=1,this.readModule(1,d-1,u,d)&&(m|=1),m}readCorner3(u,d){let m=0;return this.readModule(u-1,0,u,d)&&(m|=1),m<<=1,this.readModule(u-1,d-1,u,d)&&(m|=1),m<<=1,this.readModule(0,d-3,u,d)&&(m|=1),m<<=1,this.readModule(0,d-2,u,d)&&(m|=1),m<<=1,this.readModule(0,d-1,u,d)&&(m|=1),m<<=1,this.readModule(1,d-3,u,d)&&(m|=1),m<<=1,this.readModule(1,d-2,u,d)&&(m|=1),m<<=1,this.readModule(1,d-1,u,d)&&(m|=1),m}readCorner4(u,d){let m=0;return this.readModule(u-3,0,u,d)&&(m|=1),m<<=1,this.readModule(u-2,0,u,d)&&(m|=1),m<<=1,this.readModule(u-1,0,u,d)&&(m|=1),m<<=1,this.readModule(0,d-2,u,d)&&(m|=1),m<<=1,this.readModule(0,d-1,u,d)&&(m|=1),m<<=1,this.readModule(1,d-1,u,d)&&(m|=1),m<<=1,this.readModule(2,d-1,u,d)&&(m|=1),m<<=1,this.readModule(3,d-1,u,d)&&(m|=1),m}extractDataRegion(u){const d=this.version.getSymbolSizeRows(),m=this.version.getSymbolSizeColumns();if(u.getHeight()!==d)throw new D("Dimension of bitMatrix must match the version size");const b=this.version.getDataRegionSizeRows(),w=this.version.getDataRegionSizeColumns(),S=d/b|0,E=m/w|0,A=S*b,G=E*w,B=new fn(G,A);for(let Z=0;Z<S;++Z){const U=Z*b;for(let ne=0;ne<E;++ne){const le=ne*w;for(let ce=0;ce<b;++ce){const ve=Z*(b+2)+1+ce,Re=U+ce;for(let Xe=0;Xe<w;++Xe){const Ye=ne*(w+2)+1+Xe;if(u.get(Ye,ve)){const Ke=le+Xe;B.set(Ke,Re)}}}}}return B}}class Wo{constructor(u,d){this.numDataCodewords=u,this.codewords=d}static getDataBlocks(u,d){const m=d.getECBlocks();let b=0;const w=m.getECBlocks();for(let ce of w)b+=ce.getCount();const S=new Array(b);let E=0;for(let ce of w)for(let ve=0;ve<ce.getCount();ve++){const Re=ce.getDataCodewords(),Xe=m.getECCodewords()+Re;S[E++]=new Wo(Re,new Uint8Array(Xe))}const G=S[0].codewords.length-m.getECCodewords(),B=G-1;let Z=0;for(let ce=0;ce<B;ce++)for(let ve=0;ve<E;ve++)S[ve].codewords[ce]=u[Z++];const U=d.getVersionNumber()===24,ne=U?8:E;for(let ce=0;ce<ne;ce++)S[ce].codewords[G-1]=u[Z++];const le=S[0].codewords.length;for(let ce=G;ce<le;ce++)for(let ve=0;ve<E;ve++){const Re=U?(ve+8)%E:ve,Xe=U&&Re>7?ce-1:ce;S[Re].codewords[Xe]=u[Z++]}if(Z!==u.length)throw new D;return S}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class rc{constructor(u){this.bytes=u,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(u){if(u<1||u>32||u>this.available())throw new D(""+u);let d=0,m=this.bitOffset,b=this.byteOffset;const w=this.bytes;if(m>0){const S=8-m,E=u<S?u:S,A=S-E,G=255>>8-E<<A;d=(w[b]&G)>>A,u-=E,m+=E,m===8&&(m=0,b++)}if(u>0){for(;u>=8;)d=d<<8|w[b]&255,b++,u-=8;if(u>0){const S=8-u,E=255>>S<<S;d=d<<u|(w[b]&E)>>S,m+=u}}return this.bitOffset=m,this.byteOffset=b,d}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}var sr;(function(K){K[K.PAD_ENCODE=0]="PAD_ENCODE",K[K.ASCII_ENCODE=1]="ASCII_ENCODE",K[K.C40_ENCODE=2]="C40_ENCODE",K[K.TEXT_ENCODE=3]="TEXT_ENCODE",K[K.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",K[K.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",K[K.BASE256_ENCODE=6]="BASE256_ENCODE"})(sr||(sr={}));class ji{static decode(u){const d=new rc(u),m=new _t,b=new _t,w=new Array;let S=sr.ASCII_ENCODE;do if(S===sr.ASCII_ENCODE)S=this.decodeAsciiSegment(d,m,b);else{switch(S){case sr.C40_ENCODE:this.decodeC40Segment(d,m);break;case sr.TEXT_ENCODE:this.decodeTextSegment(d,m);break;case sr.ANSIX12_ENCODE:this.decodeAnsiX12Segment(d,m);break;case sr.EDIFACT_ENCODE:this.decodeEdifactSegment(d,m);break;case sr.BASE256_ENCODE:this.decodeBase256Segment(d,m,w);break;default:throw new ue}S=sr.ASCII_ENCODE}while(S!==sr.PAD_ENCODE&&d.available()>0);return b.length()>0&&m.append(b.toString()),new Bi(u,m.toString(),w.length===0?null:w,null)}static decodeAsciiSegment(u,d,m){let b=!1;do{let w=u.readBits(8);if(w===0)throw new ue;if(w<=128)return b&&(w+=128),d.append(String.fromCharCode(w-1)),sr.ASCII_ENCODE;if(w===129)return sr.PAD_ENCODE;if(w<=229){const S=w-130;S<10&&d.append("0"),d.append(""+S)}else switch(w){case 230:return sr.C40_ENCODE;case 231:return sr.BASE256_ENCODE;case 232:d.append("");break;case 233:case 234:break;case 235:b=!0;break;case 236:d.append("[)>05"),m.insert(0,"");break;case 237:d.append("[)>06"),m.insert(0,"");break;case 238:return sr.ANSIX12_ENCODE;case 239:return sr.TEXT_ENCODE;case 240:return sr.EDIFACT_ENCODE;case 241:break;default:if(w!==254||u.available()!==0)throw new ue;break}}while(u.available()>0);return sr.ASCII_ENCODE}static decodeC40Segment(u,d){let m=!1;const b=[];let w=0;do{if(u.available()===8)return;const S=u.readBits(8);if(S===254)return;this.parseTwoBytes(S,u.readBits(8),b);for(let E=0;E<3;E++){const A=b[E];switch(w){case 0:if(A<3)w=A+1;else if(A<this.C40_BASIC_SET_CHARS.length){const G=this.C40_BASIC_SET_CHARS[A];m?(d.append(String.fromCharCode(G.charCodeAt(0)+128)),m=!1):d.append(G)}else throw new ue;break;case 1:m?(d.append(String.fromCharCode(A+128)),m=!1):d.append(String.fromCharCode(A)),w=0;break;case 2:if(A<this.C40_SHIFT2_SET_CHARS.length){const G=this.C40_SHIFT2_SET_CHARS[A];m?(d.append(String.fromCharCode(G.charCodeAt(0)+128)),m=!1):d.append(G)}else switch(A){case 27:d.append("");break;case 30:m=!0;break;default:throw new ue}w=0;break;case 3:m?(d.append(String.fromCharCode(A+224)),m=!1):d.append(String.fromCharCode(A+96)),w=0;break;default:throw new ue}}}while(u.available()>0)}static decodeTextSegment(u,d){let m=!1,b=[],w=0;do{if(u.available()===8)return;const S=u.readBits(8);if(S===254)return;this.parseTwoBytes(S,u.readBits(8),b);for(let E=0;E<3;E++){const A=b[E];switch(w){case 0:if(A<3)w=A+1;else if(A<this.TEXT_BASIC_SET_CHARS.length){const G=this.TEXT_BASIC_SET_CHARS[A];m?(d.append(String.fromCharCode(G.charCodeAt(0)+128)),m=!1):d.append(G)}else throw new ue;break;case 1:m?(d.append(String.fromCharCode(A+128)),m=!1):d.append(String.fromCharCode(A)),w=0;break;case 2:if(A<this.TEXT_SHIFT2_SET_CHARS.length){const G=this.TEXT_SHIFT2_SET_CHARS[A];m?(d.append(String.fromCharCode(G.charCodeAt(0)+128)),m=!1):d.append(G)}else switch(A){case 27:d.append("");break;case 30:m=!0;break;default:throw new ue}w=0;break;case 3:if(A<this.TEXT_SHIFT3_SET_CHARS.length){const G=this.TEXT_SHIFT3_SET_CHARS[A];m?(d.append(String.fromCharCode(G.charCodeAt(0)+128)),m=!1):d.append(G),w=0}else throw new ue;break;default:throw new ue}}}while(u.available()>0)}static decodeAnsiX12Segment(u,d){const m=[];do{if(u.available()===8)return;const b=u.readBits(8);if(b===254)return;this.parseTwoBytes(b,u.readBits(8),m);for(let w=0;w<3;w++){const S=m[w];switch(S){case 0:d.append("\r");break;case 1:d.append("*");break;case 2:d.append(">");break;case 3:d.append(" ");break;default:if(S<14)d.append(String.fromCharCode(S+44));else if(S<40)d.append(String.fromCharCode(S+51));else throw new ue;break}}}while(u.available()>0)}static parseTwoBytes(u,d,m){let b=(u<<8)+d-1,w=Math.floor(b/1600);m[0]=w,b-=w*1600,w=Math.floor(b/40),m[1]=w,m[2]=b-w*40}static decodeEdifactSegment(u,d){do{if(u.available()<=16)return;for(let m=0;m<4;m++){let b=u.readBits(6);if(b===31){const w=8-u.getBitOffset();w!==8&&u.readBits(w);return}b&32||(b|=64),d.append(String.fromCharCode(b))}}while(u.available()>0)}static decodeBase256Segment(u,d,m){let b=1+u.getByteOffset();const w=this.unrandomize255State(u.readBits(8),b++);let S;if(w===0?S=u.available()/8|0:w<250?S=w:S=250*(w-249)+this.unrandomize255State(u.readBits(8),b++),S<0)throw new ue;const E=new Uint8Array(S);for(let A=0;A<S;A++){if(u.available()<8)throw new ue;E[A]=this.unrandomize255State(u.readBits(8),b++)}m.push(E);try{d.append(Bt.decode(E,ht.ISO88591))}catch(A){throw new Wi("Platform does not support required encoding: "+A.message)}}static unrandomize255State(u,d){const m=149*d%255+1,b=u-m;return b>=0?b:b+256}}ji.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],ji.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],ji.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],ji.TEXT_SHIFT2_SET_CHARS=ji.C40_SHIFT2_SET_CHARS,ji.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",""];class sc{constructor(){this.rsDecoder=new ke(an.DATA_MATRIX_FIELD_256)}decode(u){const d=new Dl(u),m=d.getVersion(),b=d.readCodewords(),w=Wo.getDataBlocks(b,m);let S=0;for(let G of w)S+=G.getNumDataCodewords();const E=new Uint8Array(S),A=w.length;for(let G=0;G<A;G++){const B=w[G],Z=B.getCodewords(),U=B.getNumDataCodewords();this.correctErrors(Z,U);for(let ne=0;ne<U;ne++)E[ne*A+G]=Z[ne]}return ji.decode(E)}correctErrors(u,d){const m=new Int32Array(u);try{this.rsDecoder.decode(m,u.length-d)}catch{throw new re}for(let b=0;b<d;b++)u[b]=m[b]}}class Rn{constructor(u){this.image=u,this.rectangleDetector=new _s(this.image)}detect(){const u=this.rectangleDetector.detect();let d=this.detectSolid1(u);if(d=this.detectSolid2(d),d[3]=this.correctTopRight(d),!d[3])throw new Pe;d=this.shiftToModuleCenter(d);const m=d[0],b=d[1],w=d[2],S=d[3];let E=this.transitionsBetween(m,S)+1,A=this.transitionsBetween(w,S)+1;(E&1)===1&&(E+=1),(A&1)===1&&(A+=1),4*E<7*A&&4*A<7*E&&(E=A=Math.max(E,A));let G=Rn.sampleGrid(this.image,m,b,w,S,E,A);return new Al(G,[m,b,w,S])}static shiftPoint(u,d,m){let b=(d.getX()-u.getX())/(m+1),w=(d.getY()-u.getY())/(m+1);return new gt(u.getX()+b,u.getY()+w)}static moveAway(u,d,m){let b=u.getX(),w=u.getY();return b<d?b-=1:b+=1,w<m?w-=1:w+=1,new gt(b,w)}detectSolid1(u){let d=u[0],m=u[1],b=u[3],w=u[2],S=this.transitionsBetween(d,m),E=this.transitionsBetween(m,b),A=this.transitionsBetween(b,w),G=this.transitionsBetween(w,d),B=S,Z=[w,d,m,b];return B>E&&(B=E,Z[0]=d,Z[1]=m,Z[2]=b,Z[3]=w),B>A&&(B=A,Z[0]=m,Z[1]=b,Z[2]=w,Z[3]=d),B>G&&(Z[0]=b,Z[1]=w,Z[2]=d,Z[3]=m),Z}detectSolid2(u){let d=u[0],m=u[1],b=u[2],w=u[3],S=this.transitionsBetween(d,w),E=Rn.shiftPoint(m,b,(S+1)*4),A=Rn.shiftPoint(b,m,(S+1)*4),G=this.transitionsBetween(E,d),B=this.transitionsBetween(A,w);return G<B?(u[0]=d,u[1]=m,u[2]=b,u[3]=w):(u[0]=m,u[1]=b,u[2]=w,u[3]=d),u}correctTopRight(u){let d=u[0],m=u[1],b=u[2],w=u[3],S=this.transitionsBetween(d,w),E=this.transitionsBetween(m,w),A=Rn.shiftPoint(d,m,(E+1)*4),G=Rn.shiftPoint(b,m,(S+1)*4);S=this.transitionsBetween(A,w),E=this.transitionsBetween(G,w);let B=new gt(w.getX()+(b.getX()-m.getX())/(S+1),w.getY()+(b.getY()-m.getY())/(S+1)),Z=new gt(w.getX()+(d.getX()-m.getX())/(E+1),w.getY()+(d.getY()-m.getY())/(E+1));if(!this.isValid(B))return this.isValid(Z)?Z:null;if(!this.isValid(Z))return B;let U=this.transitionsBetween(A,B)+this.transitionsBetween(G,B),ne=this.transitionsBetween(A,Z)+this.transitionsBetween(G,Z);return U>ne?B:Z}shiftToModuleCenter(u){let d=u[0],m=u[1],b=u[2],w=u[3],S=this.transitionsBetween(d,w)+1,E=this.transitionsBetween(b,w)+1,A=Rn.shiftPoint(d,m,E*4),G=Rn.shiftPoint(b,m,S*4);S=this.transitionsBetween(A,w)+1,E=this.transitionsBetween(G,w)+1,(S&1)===1&&(S+=1),(E&1)===1&&(E+=1);let B=(d.getX()+m.getX()+b.getX()+w.getX())/4,Z=(d.getY()+m.getY()+b.getY()+w.getY())/4;d=Rn.moveAway(d,B,Z),m=Rn.moveAway(m,B,Z),b=Rn.moveAway(b,B,Z),w=Rn.moveAway(w,B,Z);let U,ne;return A=Rn.shiftPoint(d,m,E*4),A=Rn.shiftPoint(A,w,S*4),U=Rn.shiftPoint(m,d,E*4),U=Rn.shiftPoint(U,b,S*4),G=Rn.shiftPoint(b,w,E*4),G=Rn.shiftPoint(G,m,S*4),ne=Rn.shiftPoint(w,b,E*4),ne=Rn.shiftPoint(ne,d,S*4),[A,U,G,ne]}isValid(u){return u.getX()>=0&&u.getX()<this.image.getWidth()&&u.getY()>0&&u.getY()<this.image.getHeight()}static sampleGrid(u,d,m,b,w,S,E){return zi.getInstance().sampleGrid(u,S,E,.5,.5,S-.5,.5,S-.5,E-.5,.5,E-.5,d.getX(),d.getY(),w.getX(),w.getY(),b.getX(),b.getY(),m.getX(),m.getY())}transitionsBetween(u,d){let m=Math.trunc(u.getX()),b=Math.trunc(u.getY()),w=Math.trunc(d.getX()),S=Math.trunc(d.getY()),E=Math.abs(S-b)>Math.abs(w-m);if(E){let ce=m;m=b,b=ce,ce=w,w=S,S=ce}let A=Math.abs(w-m),G=Math.abs(S-b),B=-A/2,Z=b<S?1:-1,U=m<w?1:-1,ne=0,le=this.image.get(E?b:m,E?m:b);for(let ce=m,ve=b;ce!==w;ce+=U){let Re=this.image.get(E?ve:ce,E?ce:ve);if(Re!==le&&(ne++,le=Re),B+=G,B>0){if(ve===S)break;ve+=Z,B-=A}}return ne}}class xi{constructor(){this.decoder=new sc}decode(u,d=null){let m,b;if(d!=null&&d.has(Fe.PURE_BARCODE)){const G=xi.extractPureBits(u.getBlackMatrix());m=this.decoder.decode(G),b=xi.NO_POINTS}else{const G=new Rn(u.getBlackMatrix()).detect();m=this.decoder.decode(G.getBits()),b=G.getPoints()}const w=m.getRawBytes(),S=new En(m.getText(),w,8*w.length,b,yt.DATA_MATRIX,se.currentTimeMillis()),E=m.getByteSegments();E!=null&&S.putMetadata(bn.BYTE_SEGMENTS,E);const A=m.getECLevel();return A!=null&&S.putMetadata(bn.ERROR_CORRECTION_LEVEL,A),S}reset(){}static extractPureBits(u){const d=u.getTopLeftOnBit(),m=u.getBottomRightOnBit();if(d==null||m==null)throw new Pe;const b=this.moduleSize(d,u);let w=d[1];const S=m[1];let E=d[0];const G=(m[0]-E+1)/b,B=(S-w+1)/b;if(G<=0||B<=0)throw new Pe;const Z=b/2;w+=Z,E+=Z;const U=new fn(G,B);for(let ne=0;ne<B;ne++){const le=w+ne*b;for(let ce=0;ce<G;ce++)u.get(E+ce*b,le)&&U.set(ce,ne)}return U}static moduleSize(u,d){const m=d.getWidth();let b=u[0];const w=u[1];for(;b<m&&d.get(b,w);)b++;if(b===m)throw new Pe;const S=b-u[0];if(S===0)throw new Pe;return S}}xi.NO_POINTS=[];class Nh extends qs{constructor(u=500){super(new xi,u)}}var zo;(function(K){K[K.L=0]="L",K[K.M=1]="M",K[K.Q=2]="Q",K[K.H=3]="H"})(zo||(zo={}));class dn{constructor(u,d,m){this.value=u,this.stringValue=d,this.bits=m,dn.FOR_BITS.set(m,this),dn.FOR_VALUE.set(u,this)}getValue(){return this.value}getBits(){return this.bits}static fromString(u){switch(u){case"L":return dn.L;case"M":return dn.M;case"Q":return dn.Q;case"H":return dn.H;default:throw new V(u+"not available")}}toString(){return this.stringValue}equals(u){if(!(u instanceof dn))return!1;const d=u;return this.value===d.value}static forBits(u){if(u<0||u>=dn.FOR_BITS.size)throw new D;return dn.FOR_BITS.get(u)}}dn.FOR_BITS=new Map,dn.FOR_VALUE=new Map,dn.L=new dn(zo.L,"L",1),dn.M=new dn(zo.M,"M",0),dn.Q=new dn(zo.Q,"Q",3),dn.H=new dn(zo.H,"H",2);class fr{constructor(u){this.errorCorrectionLevel=dn.forBits(u>>3&3),this.dataMask=u&7}static numBitsDiffering(u,d){return j.bitCount(u^d)}static decodeFormatInformation(u,d){const m=fr.doDecodeFormatInformation(u,d);return m!==null?m:fr.doDecodeFormatInformation(u^fr.FORMAT_INFO_MASK_QR,d^fr.FORMAT_INFO_MASK_QR)}static doDecodeFormatInformation(u,d){let m=Number.MAX_SAFE_INTEGER,b=0;for(const w of fr.FORMAT_INFO_DECODE_LOOKUP){const S=w[0];if(S===u||S===d)return new fr(w[1]);let E=fr.numBitsDiffering(u,S);E<m&&(b=w[1],m=E),u!==d&&(E=fr.numBitsDiffering(d,S),E<m&&(b=w[1],m=E))}return m<=3?new fr(b):null}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getDataMask(){return this.dataMask}hashCode(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask}equals(u){if(!(u instanceof fr))return!1;const d=u;return this.errorCorrectionLevel===d.errorCorrectionLevel&&this.dataMask===d.dataMask}}fr.FORMAT_INFO_MASK_QR=21522,fr.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])];class Ie{constructor(u,...d){this.ecCodewordsPerBlock=u,this.ecBlocks=d}getECCodewordsPerBlock(){return this.ecCodewordsPerBlock}getNumBlocks(){let u=0;const d=this.ecBlocks;for(const m of d)u+=m.getCount();return u}getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks()}getECBlocks(){return this.ecBlocks}}class q{constructor(u,d){this.count=u,this.dataCodewords=d}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class bt{constructor(u,d,...m){this.versionNumber=u,this.alignmentPatternCenters=d,this.ecBlocks=m;let b=0;const w=m[0].getECCodewordsPerBlock(),S=m[0].getECBlocks();for(const E of S)b+=E.getCount()*(E.getDataCodewords()+w);this.totalCodewords=b}getVersionNumber(){return this.versionNumber}getAlignmentPatternCenters(){return this.alignmentPatternCenters}getTotalCodewords(){return this.totalCodewords}getDimensionForVersion(){return 17+4*this.versionNumber}getECBlocksForLevel(u){return this.ecBlocks[u.getValue()]}static getProvisionalVersionForDimension(u){if(u%4!==1)throw new ue;try{return this.getVersionForNumber((u-17)/4)}catch{throw new ue}}static getVersionForNumber(u){if(u<1||u>40)throw new D;return bt.VERSIONS[u-1]}static decodeVersionInformation(u){let d=Number.MAX_SAFE_INTEGER,m=0;for(let b=0;b<bt.VERSION_DECODE_INFO.length;b++){const w=bt.VERSION_DECODE_INFO[b];if(w===u)return bt.getVersionForNumber(b+7);const S=fr.numBitsDiffering(u,w);S<d&&(m=b+7,d=S)}return d<=3?bt.getVersionForNumber(m):null}buildFunctionPattern(){const u=this.getDimensionForVersion(),d=new fn(u);d.setRegion(0,0,9,9),d.setRegion(u-8,0,8,9),d.setRegion(0,u-8,9,8);const m=this.alignmentPatternCenters.length;for(let b=0;b<m;b++){const w=this.alignmentPatternCenters[b]-2;for(let S=0;S<m;S++)b===0&&(S===0||S===m-1)||b===m-1&&S===0||d.setRegion(this.alignmentPatternCenters[S]-2,w,5,5)}return d.setRegion(6,9,1,u-17),d.setRegion(9,6,u-17,1),this.versionNumber>6&&(d.setRegion(u-11,0,3,6),d.setRegion(0,u-11,6,3)),d}toString(){return""+this.versionNumber}}bt.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),bt.VERSIONS=[new bt(1,new Int32Array(0),new Ie(7,new q(1,19)),new Ie(10,new q(1,16)),new Ie(13,new q(1,13)),new Ie(17,new q(1,9))),new bt(2,Int32Array.from([6,18]),new Ie(10,new q(1,34)),new Ie(16,new q(1,28)),new Ie(22,new q(1,22)),new Ie(28,new q(1,16))),new bt(3,Int32Array.from([6,22]),new Ie(15,new q(1,55)),new Ie(26,new q(1,44)),new Ie(18,new q(2,17)),new Ie(22,new q(2,13))),new bt(4,Int32Array.from([6,26]),new Ie(20,new q(1,80)),new Ie(18,new q(2,32)),new Ie(26,new q(2,24)),new Ie(16,new q(4,9))),new bt(5,Int32Array.from([6,30]),new Ie(26,new q(1,108)),new Ie(24,new q(2,43)),new Ie(18,new q(2,15),new q(2,16)),new Ie(22,new q(2,11),new q(2,12))),new bt(6,Int32Array.from([6,34]),new Ie(18,new q(2,68)),new Ie(16,new q(4,27)),new Ie(24,new q(4,19)),new Ie(28,new q(4,15))),new bt(7,Int32Array.from([6,22,38]),new Ie(20,new q(2,78)),new Ie(18,new q(4,31)),new Ie(18,new q(2,14),new q(4,15)),new Ie(26,new q(4,13),new q(1,14))),new bt(8,Int32Array.from([6,24,42]),new Ie(24,new q(2,97)),new Ie(22,new q(2,38),new q(2,39)),new Ie(22,new q(4,18),new q(2,19)),new Ie(26,new q(4,14),new q(2,15))),new bt(9,Int32Array.from([6,26,46]),new Ie(30,new q(2,116)),new Ie(22,new q(3,36),new q(2,37)),new Ie(20,new q(4,16),new q(4,17)),new Ie(24,new q(4,12),new q(4,13))),new bt(10,Int32Array.from([6,28,50]),new Ie(18,new q(2,68),new q(2,69)),new Ie(26,new q(4,43),new q(1,44)),new Ie(24,new q(6,19),new q(2,20)),new Ie(28,new q(6,15),new q(2,16))),new bt(11,Int32Array.from([6,30,54]),new Ie(20,new q(4,81)),new Ie(30,new q(1,50),new q(4,51)),new Ie(28,new q(4,22),new q(4,23)),new Ie(24,new q(3,12),new q(8,13))),new bt(12,Int32Array.from([6,32,58]),new Ie(24,new q(2,92),new q(2,93)),new Ie(22,new q(6,36),new q(2,37)),new Ie(26,new q(4,20),new q(6,21)),new Ie(28,new q(7,14),new q(4,15))),new bt(13,Int32Array.from([6,34,62]),new Ie(26,new q(4,107)),new Ie(22,new q(8,37),new q(1,38)),new Ie(24,new q(8,20),new q(4,21)),new Ie(22,new q(12,11),new q(4,12))),new bt(14,Int32Array.from([6,26,46,66]),new Ie(30,new q(3,115),new q(1,116)),new Ie(24,new q(4,40),new q(5,41)),new Ie(20,new q(11,16),new q(5,17)),new Ie(24,new q(11,12),new q(5,13))),new bt(15,Int32Array.from([6,26,48,70]),new Ie(22,new q(5,87),new q(1,88)),new Ie(24,new q(5,41),new q(5,42)),new Ie(30,new q(5,24),new q(7,25)),new Ie(24,new q(11,12),new q(7,13))),new bt(16,Int32Array.from([6,26,50,74]),new Ie(24,new q(5,98),new q(1,99)),new Ie(28,new q(7,45),new q(3,46)),new Ie(24,new q(15,19),new q(2,20)),new Ie(30,new q(3,15),new q(13,16))),new bt(17,Int32Array.from([6,30,54,78]),new Ie(28,new q(1,107),new q(5,108)),new Ie(28,new q(10,46),new q(1,47)),new Ie(28,new q(1,22),new q(15,23)),new Ie(28,new q(2,14),new q(17,15))),new bt(18,Int32Array.from([6,30,56,82]),new Ie(30,new q(5,120),new q(1,121)),new Ie(26,new q(9,43),new q(4,44)),new Ie(28,new q(17,22),new q(1,23)),new Ie(28,new q(2,14),new q(19,15))),new bt(19,Int32Array.from([6,30,58,86]),new Ie(28,new q(3,113),new q(4,114)),new Ie(26,new q(3,44),new q(11,45)),new Ie(26,new q(17,21),new q(4,22)),new Ie(26,new q(9,13),new q(16,14))),new bt(20,Int32Array.from([6,34,62,90]),new Ie(28,new q(3,107),new q(5,108)),new Ie(26,new q(3,41),new q(13,42)),new Ie(30,new q(15,24),new q(5,25)),new Ie(28,new q(15,15),new q(10,16))),new bt(21,Int32Array.from([6,28,50,72,94]),new Ie(28,new q(4,116),new q(4,117)),new Ie(26,new q(17,42)),new Ie(28,new q(17,22),new q(6,23)),new Ie(30,new q(19,16),new q(6,17))),new bt(22,Int32Array.from([6,26,50,74,98]),new Ie(28,new q(2,111),new q(7,112)),new Ie(28,new q(17,46)),new Ie(30,new q(7,24),new q(16,25)),new Ie(24,new q(34,13))),new bt(23,Int32Array.from([6,30,54,78,102]),new Ie(30,new q(4,121),new q(5,122)),new Ie(28,new q(4,47),new q(14,48)),new Ie(30,new q(11,24),new q(14,25)),new Ie(30,new q(16,15),new q(14,16))),new bt(24,Int32Array.from([6,28,54,80,106]),new Ie(30,new q(6,117),new q(4,118)),new Ie(28,new q(6,45),new q(14,46)),new Ie(30,new q(11,24),new q(16,25)),new Ie(30,new q(30,16),new q(2,17))),new bt(25,Int32Array.from([6,32,58,84,110]),new Ie(26,new q(8,106),new q(4,107)),new Ie(28,new q(8,47),new q(13,48)),new Ie(30,new q(7,24),new q(22,25)),new Ie(30,new q(22,15),new q(13,16))),new bt(26,Int32Array.from([6,30,58,86,114]),new Ie(28,new q(10,114),new q(2,115)),new Ie(28,new q(19,46),new q(4,47)),new Ie(28,new q(28,22),new q(6,23)),new Ie(30,new q(33,16),new q(4,17))),new bt(27,Int32Array.from([6,34,62,90,118]),new Ie(30,new q(8,122),new q(4,123)),new Ie(28,new q(22,45),new q(3,46)),new Ie(30,new q(8,23),new q(26,24)),new Ie(30,new q(12,15),new q(28,16))),new bt(28,Int32Array.from([6,26,50,74,98,122]),new Ie(30,new q(3,117),new q(10,118)),new Ie(28,new q(3,45),new q(23,46)),new Ie(30,new q(4,24),new q(31,25)),new Ie(30,new q(11,15),new q(31,16))),new bt(29,Int32Array.from([6,30,54,78,102,126]),new Ie(30,new q(7,116),new q(7,117)),new Ie(28,new q(21,45),new q(7,46)),new Ie(30,new q(1,23),new q(37,24)),new Ie(30,new q(19,15),new q(26,16))),new bt(30,Int32Array.from([6,26,52,78,104,130]),new Ie(30,new q(5,115),new q(10,116)),new Ie(28,new q(19,47),new q(10,48)),new Ie(30,new q(15,24),new q(25,25)),new Ie(30,new q(23,15),new q(25,16))),new bt(31,Int32Array.from([6,30,56,82,108,134]),new Ie(30,new q(13,115),new q(3,116)),new Ie(28,new q(2,46),new q(29,47)),new Ie(30,new q(42,24),new q(1,25)),new Ie(30,new q(23,15),new q(28,16))),new bt(32,Int32Array.from([6,34,60,86,112,138]),new Ie(30,new q(17,115)),new Ie(28,new q(10,46),new q(23,47)),new Ie(30,new q(10,24),new q(35,25)),new Ie(30,new q(19,15),new q(35,16))),new bt(33,Int32Array.from([6,30,58,86,114,142]),new Ie(30,new q(17,115),new q(1,116)),new Ie(28,new q(14,46),new q(21,47)),new Ie(30,new q(29,24),new q(19,25)),new Ie(30,new q(11,15),new q(46,16))),new bt(34,Int32Array.from([6,34,62,90,118,146]),new Ie(30,new q(13,115),new q(6,116)),new Ie(28,new q(14,46),new q(23,47)),new Ie(30,new q(44,24),new q(7,25)),new Ie(30,new q(59,16),new q(1,17))),new bt(35,Int32Array.from([6,30,54,78,102,126,150]),new Ie(30,new q(12,121),new q(7,122)),new Ie(28,new q(12,47),new q(26,48)),new Ie(30,new q(39,24),new q(14,25)),new Ie(30,new q(22,15),new q(41,16))),new bt(36,Int32Array.from([6,24,50,76,102,128,154]),new Ie(30,new q(6,121),new q(14,122)),new Ie(28,new q(6,47),new q(34,48)),new Ie(30,new q(46,24),new q(10,25)),new Ie(30,new q(2,15),new q(64,16))),new bt(37,Int32Array.from([6,28,54,80,106,132,158]),new Ie(30,new q(17,122),new q(4,123)),new Ie(28,new q(29,46),new q(14,47)),new Ie(30,new q(49,24),new q(10,25)),new Ie(30,new q(24,15),new q(46,16))),new bt(38,Int32Array.from([6,32,58,84,110,136,162]),new Ie(30,new q(4,122),new q(18,123)),new Ie(28,new q(13,46),new q(32,47)),new Ie(30,new q(48,24),new q(14,25)),new Ie(30,new q(42,15),new q(32,16))),new bt(39,Int32Array.from([6,26,54,82,110,138,166]),new Ie(30,new q(20,117),new q(4,118)),new Ie(28,new q(40,47),new q(7,48)),new Ie(30,new q(43,24),new q(22,25)),new Ie(30,new q(10,15),new q(67,16))),new bt(40,Int32Array.from([6,30,58,86,114,142,170]),new Ie(30,new q(19,118),new q(6,119)),new Ie(28,new q(18,47),new q(31,48)),new Ie(30,new q(34,24),new q(34,25)),new Ie(30,new q(20,15),new q(61,16)))];var qn;(function(K){K[K.DATA_MASK_000=0]="DATA_MASK_000",K[K.DATA_MASK_001=1]="DATA_MASK_001",K[K.DATA_MASK_010=2]="DATA_MASK_010",K[K.DATA_MASK_011=3]="DATA_MASK_011",K[K.DATA_MASK_100=4]="DATA_MASK_100",K[K.DATA_MASK_101=5]="DATA_MASK_101",K[K.DATA_MASK_110=6]="DATA_MASK_110",K[K.DATA_MASK_111=7]="DATA_MASK_111"})(qn||(qn={}));class Jr{constructor(u,d){this.value=u,this.isMasked=d}unmaskBitMatrix(u,d){for(let m=0;m<d;m++)for(let b=0;b<d;b++)this.isMasked(m,b)&&u.flip(b,m)}}Jr.values=new Map([[qn.DATA_MASK_000,new Jr(qn.DATA_MASK_000,(K,u)=>(K+u&1)===0)],[qn.DATA_MASK_001,new Jr(qn.DATA_MASK_001,(K,u)=>(K&1)===0)],[qn.DATA_MASK_010,new Jr(qn.DATA_MASK_010,(K,u)=>u%3===0)],[qn.DATA_MASK_011,new Jr(qn.DATA_MASK_011,(K,u)=>(K+u)%3===0)],[qn.DATA_MASK_100,new Jr(qn.DATA_MASK_100,(K,u)=>(Math.floor(K/2)+Math.floor(u/3)&1)===0)],[qn.DATA_MASK_101,new Jr(qn.DATA_MASK_101,(K,u)=>K*u%6===0)],[qn.DATA_MASK_110,new Jr(qn.DATA_MASK_110,(K,u)=>K*u%6<3)],[qn.DATA_MASK_111,new Jr(qn.DATA_MASK_111,(K,u)=>(K+u+K*u%3&1)===0)]]);class ic{constructor(u){const d=u.getHeight();if(d<21||(d&3)!==1)throw new ue;this.bitMatrix=u}readFormatInformation(){if(this.parsedFormatInfo!==null&&this.parsedFormatInfo!==void 0)return this.parsedFormatInfo;let u=0;for(let w=0;w<6;w++)u=this.copyBit(w,8,u);u=this.copyBit(7,8,u),u=this.copyBit(8,8,u),u=this.copyBit(8,7,u);for(let w=5;w>=0;w--)u=this.copyBit(8,w,u);const d=this.bitMatrix.getHeight();let m=0;const b=d-7;for(let w=d-1;w>=b;w--)m=this.copyBit(8,w,m);for(let w=d-8;w<d;w++)m=this.copyBit(w,8,m);if(this.parsedFormatInfo=fr.decodeFormatInformation(u,m),this.parsedFormatInfo!==null)return this.parsedFormatInfo;throw new ue}readVersion(){if(this.parsedVersion!==null&&this.parsedVersion!==void 0)return this.parsedVersion;const u=this.bitMatrix.getHeight(),d=Math.floor((u-17)/4);if(d<=6)return bt.getVersionForNumber(d);let m=0;const b=u-11;for(let S=5;S>=0;S--)for(let E=u-9;E>=b;E--)m=this.copyBit(E,S,m);let w=bt.decodeVersionInformation(m);if(w!==null&&w.getDimensionForVersion()===u)return this.parsedVersion=w,w;m=0;for(let S=5;S>=0;S--)for(let E=u-9;E>=b;E--)m=this.copyBit(S,E,m);if(w=bt.decodeVersionInformation(m),w!==null&&w.getDimensionForVersion()===u)return this.parsedVersion=w,w;throw new ue}copyBit(u,d,m){return(this.isMirror?this.bitMatrix.get(d,u):this.bitMatrix.get(u,d))?m<<1|1:m<<1}readCodewords(){const u=this.readFormatInformation(),d=this.readVersion(),m=Jr.values.get(u.getDataMask()),b=this.bitMatrix.getHeight();m.unmaskBitMatrix(this.bitMatrix,b);const w=d.buildFunctionPattern();let S=!0;const E=new Uint8Array(d.getTotalCodewords());let A=0,G=0,B=0;for(let Z=b-1;Z>0;Z-=2){Z===6&&Z--;for(let U=0;U<b;U++){const ne=S?b-1-U:U;for(let le=0;le<2;le++)w.get(Z-le,ne)||(B++,G<<=1,this.bitMatrix.get(Z-le,ne)&&(G|=1),B===8&&(E[A++]=G,B=0,G=0))}S=!S}if(A!==d.getTotalCodewords())throw new ue;return E}remask(){if(this.parsedFormatInfo===null)return;const u=Jr.values[this.parsedFormatInfo.getDataMask()],d=this.bitMatrix.getHeight();u.unmaskBitMatrix(this.bitMatrix,d)}setMirror(u){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=u}mirror(){const u=this.bitMatrix;for(let d=0,m=u.getWidth();d<m;d++)for(let b=d+1,w=u.getHeight();b<w;b++)u.get(d,b)!==u.get(b,d)&&(u.flip(b,d),u.flip(d,b))}}class Ol{constructor(u,d){this.numDataCodewords=u,this.codewords=d}static getDataBlocks(u,d,m){if(u.length!==d.getTotalCodewords())throw new D;const b=d.getECBlocksForLevel(m);let w=0;const S=b.getECBlocks();for(const le of S)w+=le.getCount();const E=new Array(w);let A=0;for(const le of S)for(let ce=0;ce<le.getCount();ce++){const ve=le.getDataCodewords(),Re=b.getECCodewordsPerBlock()+ve;E[A++]=new Ol(ve,new Uint8Array(Re))}const G=E[0].codewords.length;let B=E.length-1;for(;B>=0&&E[B].codewords.length!==G;)B--;B++;const Z=G-b.getECCodewordsPerBlock();let U=0;for(let le=0;le<Z;le++)for(let ce=0;ce<A;ce++)E[ce].codewords[le]=u[U++];for(let le=B;le<A;le++)E[le].codewords[Z]=u[U++];const ne=E[0].codewords.length;for(let le=Z;le<ne;le++)for(let ce=0;ce<A;ce++){const ve=ce<B?le:le+1;E[ce].codewords[ve]=u[U++]}return E}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}var cs;(function(K){K[K.TERMINATOR=0]="TERMINATOR",K[K.NUMERIC=1]="NUMERIC",K[K.ALPHANUMERIC=2]="ALPHANUMERIC",K[K.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",K[K.BYTE=4]="BYTE",K[K.ECI=5]="ECI",K[K.KANJI=6]="KANJI",K[K.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",K[K.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",K[K.HANZI=9]="HANZI"})(cs||(cs={}));class wt{constructor(u,d,m,b){this.value=u,this.stringValue=d,this.characterCountBitsForVersions=m,this.bits=b,wt.FOR_BITS.set(b,this),wt.FOR_VALUE.set(u,this)}static forBits(u){const d=wt.FOR_BITS.get(u);if(d===void 0)throw new D;return d}getCharacterCountBits(u){const d=u.getVersionNumber();let m;return d<=9?m=0:d<=26?m=1:m=2,this.characterCountBitsForVersions[m]}getValue(){return this.value}getBits(){return this.bits}equals(u){if(!(u instanceof wt))return!1;const d=u;return this.value===d.value}toString(){return this.stringValue}}wt.FOR_BITS=new Map,wt.FOR_VALUE=new Map,wt.TERMINATOR=new wt(cs.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),wt.NUMERIC=new wt(cs.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),wt.ALPHANUMERIC=new wt(cs.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),wt.STRUCTURED_APPEND=new wt(cs.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),wt.BYTE=new wt(cs.BYTE,"BYTE",Int32Array.from([8,16,16]),4),wt.ECI=new wt(cs.ECI,"ECI",Int32Array.from([0,0,0]),7),wt.KANJI=new wt(cs.KANJI,"KANJI",Int32Array.from([8,10,12]),8),wt.FNC1_FIRST_POSITION=new wt(cs.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),wt.FNC1_SECOND_POSITION=new wt(cs.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),wt.HANZI=new wt(cs.HANZI,"HANZI",Int32Array.from([8,10,12]),13);class Bn{static decode(u,d,m,b){const w=new rc(u);let S=new _t;const E=new Array;let A=-1,G=-1;try{let B=null,Z=!1,U;do{if(w.available()<4)U=wt.TERMINATOR;else{const ne=w.readBits(4);U=wt.forBits(ne)}switch(U){case wt.TERMINATOR:break;case wt.FNC1_FIRST_POSITION:case wt.FNC1_SECOND_POSITION:Z=!0;break;case wt.STRUCTURED_APPEND:if(w.available()<16)throw new ue;A=w.readBits(8),G=w.readBits(8);break;case wt.ECI:const ne=Bn.parseECIValue(w);if(B=Ne.getCharacterSetECIByValue(ne),B===null)throw new ue;break;case wt.HANZI:const le=w.readBits(4),ce=w.readBits(U.getCharacterCountBits(d));le===Bn.GB2312_SUBSET&&Bn.decodeHanziSegment(w,S,ce);break;default:const ve=w.readBits(U.getCharacterCountBits(d));switch(U){case wt.NUMERIC:Bn.decodeNumericSegment(w,S,ve);break;case wt.ALPHANUMERIC:Bn.decodeAlphanumericSegment(w,S,ve,Z);break;case wt.BYTE:Bn.decodeByteSegment(w,S,ve,B,E,b);break;case wt.KANJI:Bn.decodeKanjiSegment(w,S,ve);break;default:throw new ue}break}}while(U!==wt.TERMINATOR)}catch{throw new ue}return new Bi(u,S.toString(),E.length===0?null:E,m===null?null:m.toString(),A,G)}static decodeHanziSegment(u,d,m){if(m*13>u.available())throw new ue;const b=new Uint8Array(2*m);let w=0;for(;m>0;){const S=u.readBits(13);let E=S/96<<8&4294967295|S%96;E<959?E+=41377:E+=42657,b[w]=E>>8&255,b[w+1]=E&255,w+=2,m--}try{d.append(Bt.decode(b,ht.GB2312))}catch(S){throw new ue(S)}}static decodeKanjiSegment(u,d,m){if(m*13>u.available())throw new ue;const b=new Uint8Array(2*m);let w=0;for(;m>0;){const S=u.readBits(13);let E=S/192<<8&4294967295|S%192;E<7936?E+=33088:E+=49472,b[w]=E>>8,b[w+1]=E,w+=2,m--}try{d.append(Bt.decode(b,ht.SHIFT_JIS))}catch(S){throw new ue(S)}}static decodeByteSegment(u,d,m,b,w,S){if(8*m>u.available())throw new ue;const E=new Uint8Array(m);for(let G=0;G<m;G++)E[G]=u.readBits(8);let A;b===null?A=ht.guessEncoding(E,S):A=b.getName();try{d.append(Bt.decode(E,A))}catch(G){throw new ue(G)}w.push(E)}static toAlphaNumericChar(u){if(u>=Bn.ALPHANUMERIC_CHARS.length)throw new ue;return Bn.ALPHANUMERIC_CHARS[u]}static decodeAlphanumericSegment(u,d,m,b){const w=d.length();for(;m>1;){if(u.available()<11)throw new ue;const S=u.readBits(11);d.append(Bn.toAlphaNumericChar(Math.floor(S/45))),d.append(Bn.toAlphaNumericChar(S%45)),m-=2}if(m===1){if(u.available()<6)throw new ue;d.append(Bn.toAlphaNumericChar(u.readBits(6)))}if(b)for(let S=w;S<d.length();S++)d.charAt(S)==="%"&&(S<d.length()-1&&d.charAt(S+1)==="%"?d.deleteCharAt(S+1):d.setCharAt(S,""))}static decodeNumericSegment(u,d,m){for(;m>=3;){if(u.available()<10)throw new ue;const b=u.readBits(10);if(b>=1e3)throw new ue;d.append(Bn.toAlphaNumericChar(Math.floor(b/100))),d.append(Bn.toAlphaNumericChar(Math.floor(b/10)%10)),d.append(Bn.toAlphaNumericChar(b%10)),m-=3}if(m===2){if(u.available()<7)throw new ue;const b=u.readBits(7);if(b>=100)throw new ue;d.append(Bn.toAlphaNumericChar(Math.floor(b/10))),d.append(Bn.toAlphaNumericChar(b%10))}else if(m===1){if(u.available()<4)throw new ue;const b=u.readBits(4);if(b>=10)throw new ue;d.append(Bn.toAlphaNumericChar(b))}}static parseECIValue(u){const d=u.readBits(8);if(!(d&128))return d&127;if((d&192)===128){const m=u.readBits(8);return(d&63)<<8&4294967295|m}if((d&224)===192){const m=u.readBits(16);return(d&31)<<16&4294967295|m}throw new ue}}Bn.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",Bn.GB2312_SUBSET=1;class Pl{constructor(u){this.mirrored=u}isMirrored(){return this.mirrored}applyMirroredCorrection(u){if(!this.mirrored||u===null||u.length<3)return;const d=u[0];u[0]=u[2],u[2]=d}}class ac{constructor(){this.rsDecoder=new ke(an.QR_CODE_FIELD_256)}decodeBooleanArray(u,d){return this.decodeBitMatrix(fn.parseFromBooleanArray(u),d)}decodeBitMatrix(u,d){const m=new ic(u);let b=null;try{return this.decodeBitMatrixParser(m,d)}catch(w){b=w}try{m.remask(),m.setMirror(!0),m.readVersion(),m.readFormatInformation(),m.mirror();const w=this.decodeBitMatrixParser(m,d);return w.setOther(new Pl(!0)),w}catch(w){throw b!==null?b:w}}decodeBitMatrixParser(u,d){const m=u.readVersion(),b=u.readFormatInformation().getErrorCorrectionLevel(),w=u.readCodewords(),S=Ol.getDataBlocks(w,m,b);let E=0;for(const B of S)E+=B.getNumDataCodewords();const A=new Uint8Array(E);let G=0;for(const B of S){const Z=B.getCodewords(),U=B.getNumDataCodewords();this.correctErrors(Z,U);for(let ne=0;ne<U;ne++)A[G++]=Z[ne]}return Bn.decode(A,m,b,d)}correctErrors(u,d){const m=new Int32Array(u);try{this.rsDecoder.decode(m,u.length-d)}catch{throw new re}for(let b=0;b<d;b++)u[b]=m[b]}}class Fl extends gt{constructor(u,d,m){super(u,d),this.estimatedModuleSize=m}aboutEquals(u,d,m){if(Math.abs(d-this.getY())<=u&&Math.abs(m-this.getX())<=u){const b=Math.abs(u-this.estimatedModuleSize);return b<=1||b<=this.estimatedModuleSize}return!1}combineEstimate(u,d,m){const b=(this.getX()+d)/2,w=(this.getY()+u)/2,S=(this.estimatedModuleSize+m)/2;return new Fl(b,w,S)}}class Xo{constructor(u,d,m,b,w,S,E){this.image=u,this.startX=d,this.startY=m,this.width=b,this.height=w,this.moduleSize=S,this.resultPointCallback=E,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){const u=this.startX,d=this.height,m=this.width,b=u+m,w=this.startY+d/2,S=new Int32Array(3),E=this.image;for(let A=0;A<d;A++){const G=w+(A&1?-Math.floor((A+1)/2):Math.floor((A+1)/2));S[0]=0,S[1]=0,S[2]=0;let B=u;for(;B<b&&!E.get(B,G);)B++;let Z=0;for(;B<b;){if(E.get(B,G))if(Z===1)S[1]++;else if(Z===2){if(this.foundPatternCross(S)){const U=this.handlePossibleCenter(S,G,B);if(U!==null)return U}S[0]=S[2],S[1]=1,S[2]=0,Z=1}else S[++Z]++;else Z===1&&Z++,S[Z]++;B++}if(this.foundPatternCross(S)){const U=this.handlePossibleCenter(S,G,b);if(U!==null)return U}}if(this.possibleCenters.length!==0)return this.possibleCenters[0];throw new Pe}static centerFromEnd(u,d){return d-u[2]-u[1]/2}foundPatternCross(u){const d=this.moduleSize,m=d/2;for(let b=0;b<3;b++)if(Math.abs(d-u[b])>=m)return!1;return!0}crossCheckVertical(u,d,m,b){const w=this.image,S=w.getHeight(),E=this.crossCheckStateCount;E[0]=0,E[1]=0,E[2]=0;let A=u;for(;A>=0&&w.get(d,A)&&E[1]<=m;)E[1]++,A--;if(A<0||E[1]>m)return NaN;for(;A>=0&&!w.get(d,A)&&E[0]<=m;)E[0]++,A--;if(E[0]>m)return NaN;for(A=u+1;A<S&&w.get(d,A)&&E[1]<=m;)E[1]++,A++;if(A===S||E[1]>m)return NaN;for(;A<S&&!w.get(d,A)&&E[2]<=m;)E[2]++,A++;if(E[2]>m)return NaN;const G=E[0]+E[1]+E[2];return 5*Math.abs(G-b)>=2*b?NaN:this.foundPatternCross(E)?Xo.centerFromEnd(E,A):NaN}handlePossibleCenter(u,d,m){const b=u[0]+u[1]+u[2],w=Xo.centerFromEnd(u,m),S=this.crossCheckVertical(d,w,2*u[1],b);if(!isNaN(S)){const E=(u[0]+u[1]+u[2])/3;for(const G of this.possibleCenters)if(G.aboutEquals(E,S,w))return G.combineEstimate(S,w,E);const A=new Fl(w,S,E);this.possibleCenters.push(A),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(A)}return null}}class Gl extends gt{constructor(u,d,m,b){super(u,d),this.estimatedModuleSize=m,this.count=b,b===void 0&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(u,d,m){if(Math.abs(d-this.getY())<=u&&Math.abs(m-this.getX())<=u){const b=Math.abs(u-this.estimatedModuleSize);return b<=1||b<=this.estimatedModuleSize}return!1}combineEstimate(u,d,m){const b=this.count+1,w=(this.count*this.getX()+d)/b,S=(this.count*this.getY()+u)/b,E=(this.count*this.estimatedModuleSize+m)/b;return new Gl(w,S,E,b)}}class Zg{constructor(u){this.bottomLeft=u[0],this.topLeft=u[1],this.topRight=u[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}class ir{constructor(u,d){this.image=u,this.resultPointCallback=d,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=d}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(u){const d=u!=null&&u.get(Fe.TRY_HARDER)!==void 0,m=u!=null&&u.get(Fe.PURE_BARCODE)!==void 0,b=this.image,w=b.getHeight(),S=b.getWidth();let E=Math.floor(3*w/(4*ir.MAX_MODULES));(E<ir.MIN_SKIP||d)&&(E=ir.MIN_SKIP);let A=!1;const G=new Int32Array(5);for(let Z=E-1;Z<w&&!A;Z+=E){G[0]=0,G[1]=0,G[2]=0,G[3]=0,G[4]=0;let U=0;for(let ne=0;ne<S;ne++)if(b.get(ne,Z))(U&1)===1&&U++,G[U]++;else if(U&1)G[U]++;else if(U===4)if(ir.foundPatternCross(G)){if(this.handlePossibleCenter(G,Z,ne,m)===!0)if(E=2,this.hasSkipped===!0)A=this.haveMultiplyConfirmedCenters();else{const ce=this.findRowSkip();ce>G[2]&&(Z+=ce-G[2]-E,ne=S-1)}else{G[0]=G[2],G[1]=G[3],G[2]=G[4],G[3]=1,G[4]=0,U=3;continue}U=0,G[0]=0,G[1]=0,G[2]=0,G[3]=0,G[4]=0}else G[0]=G[2],G[1]=G[3],G[2]=G[4],G[3]=1,G[4]=0,U=3;else G[++U]++;ir.foundPatternCross(G)&&this.handlePossibleCenter(G,Z,S,m)===!0&&(E=G[0],this.hasSkipped&&(A=this.haveMultiplyConfirmedCenters()))}const B=this.selectBestPatterns();return gt.orderBestPatterns(B),new Zg(B)}static centerFromEnd(u,d){return d-u[4]-u[3]-u[2]/2}static foundPatternCross(u){let d=0;for(let w=0;w<5;w++){const S=u[w];if(S===0)return!1;d+=S}if(d<7)return!1;const m=d/7,b=m/2;return Math.abs(m-u[0])<b&&Math.abs(m-u[1])<b&&Math.abs(3*m-u[2])<3*b&&Math.abs(m-u[3])<b&&Math.abs(m-u[4])<b}getCrossCheckStateCount(){const u=this.crossCheckStateCount;return u[0]=0,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u}crossCheckDiagonal(u,d,m,b){const w=this.getCrossCheckStateCount();let S=0;const E=this.image;for(;u>=S&&d>=S&&E.get(d-S,u-S);)w[2]++,S++;if(u<S||d<S)return!1;for(;u>=S&&d>=S&&!E.get(d-S,u-S)&&w[1]<=m;)w[1]++,S++;if(u<S||d<S||w[1]>m)return!1;for(;u>=S&&d>=S&&E.get(d-S,u-S)&&w[0]<=m;)w[0]++,S++;if(w[0]>m)return!1;const A=E.getHeight(),G=E.getWidth();for(S=1;u+S<A&&d+S<G&&E.get(d+S,u+S);)w[2]++,S++;if(u+S>=A||d+S>=G)return!1;for(;u+S<A&&d+S<G&&!E.get(d+S,u+S)&&w[3]<m;)w[3]++,S++;if(u+S>=A||d+S>=G||w[3]>=m)return!1;for(;u+S<A&&d+S<G&&E.get(d+S,u+S)&&w[4]<m;)w[4]++,S++;if(w[4]>=m)return!1;const B=w[0]+w[1]+w[2]+w[3]+w[4];return Math.abs(B-b)<2*b&&ir.foundPatternCross(w)}crossCheckVertical(u,d,m,b){const w=this.image,S=w.getHeight(),E=this.getCrossCheckStateCount();let A=u;for(;A>=0&&w.get(d,A);)E[2]++,A--;if(A<0)return NaN;for(;A>=0&&!w.get(d,A)&&E[1]<=m;)E[1]++,A--;if(A<0||E[1]>m)return NaN;for(;A>=0&&w.get(d,A)&&E[0]<=m;)E[0]++,A--;if(E[0]>m)return NaN;for(A=u+1;A<S&&w.get(d,A);)E[2]++,A++;if(A===S)return NaN;for(;A<S&&!w.get(d,A)&&E[3]<m;)E[3]++,A++;if(A===S||E[3]>=m)return NaN;for(;A<S&&w.get(d,A)&&E[4]<m;)E[4]++,A++;if(E[4]>=m)return NaN;const G=E[0]+E[1]+E[2]+E[3]+E[4];return 5*Math.abs(G-b)>=2*b?NaN:ir.foundPatternCross(E)?ir.centerFromEnd(E,A):NaN}crossCheckHorizontal(u,d,m,b){const w=this.image,S=w.getWidth(),E=this.getCrossCheckStateCount();let A=u;for(;A>=0&&w.get(A,d);)E[2]++,A--;if(A<0)return NaN;for(;A>=0&&!w.get(A,d)&&E[1]<=m;)E[1]++,A--;if(A<0||E[1]>m)return NaN;for(;A>=0&&w.get(A,d)&&E[0]<=m;)E[0]++,A--;if(E[0]>m)return NaN;for(A=u+1;A<S&&w.get(A,d);)E[2]++,A++;if(A===S)return NaN;for(;A<S&&!w.get(A,d)&&E[3]<m;)E[3]++,A++;if(A===S||E[3]>=m)return NaN;for(;A<S&&w.get(A,d)&&E[4]<m;)E[4]++,A++;if(E[4]>=m)return NaN;const G=E[0]+E[1]+E[2]+E[3]+E[4];return 5*Math.abs(G-b)>=b?NaN:ir.foundPatternCross(E)?ir.centerFromEnd(E,A):NaN}handlePossibleCenter(u,d,m,b){const w=u[0]+u[1]+u[2]+u[3]+u[4];let S=ir.centerFromEnd(u,m),E=this.crossCheckVertical(d,Math.floor(S),u[2],w);if(!isNaN(E)&&(S=this.crossCheckHorizontal(Math.floor(S),Math.floor(E),u[2],w),!isNaN(S)&&(!b||this.crossCheckDiagonal(Math.floor(E),Math.floor(S),u[2],w)))){const A=w/7;let G=!1;const B=this.possibleCenters;for(let Z=0,U=B.length;Z<U;Z++){const ne=B[Z];if(ne.aboutEquals(A,E,S)){B[Z]=ne.combineEstimate(E,S,A),G=!0;break}}if(!G){const Z=new Gl(S,E,A);B.push(Z),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(Z)}return!0}return!1}findRowSkip(){if(this.possibleCenters.length<=1)return 0;let d=null;for(const m of this.possibleCenters)if(m.getCount()>=ir.CENTER_QUORUM)if(d==null)d=m;else return this.hasSkipped=!0,Math.floor((Math.abs(d.getX()-m.getX())-Math.abs(d.getY()-m.getY()))/2);return 0}haveMultiplyConfirmedCenters(){let u=0,d=0;const m=this.possibleCenters.length;for(const S of this.possibleCenters)S.getCount()>=ir.CENTER_QUORUM&&(u++,d+=S.getEstimatedModuleSize());if(u<3)return!1;const b=d/m;let w=0;for(const S of this.possibleCenters)w+=Math.abs(S.getEstimatedModuleSize()-b);return w<=.05*d}selectBestPatterns(){const u=this.possibleCenters.length;if(u<3)throw new Pe;const d=this.possibleCenters;let m;if(u>3){let b=0,w=0;for(const A of this.possibleCenters){const G=A.getEstimatedModuleSize();b+=G,w+=G*G}m=b/u;let S=Math.sqrt(w/u-m*m);d.sort((A,G)=>{const B=Math.abs(G.getEstimatedModuleSize()-m),Z=Math.abs(A.getEstimatedModuleSize()-m);return B<Z?-1:B>Z?1:0});const E=Math.max(.2*m,S);for(let A=0;A<d.length&&d.length>3;A++){const G=d[A];Math.abs(G.getEstimatedModuleSize()-m)>E&&(d.splice(A,1),A--)}}if(d.length>3){let b=0;for(const w of d)b+=w.getEstimatedModuleSize();m=b/d.length,d.sort((w,S)=>{if(S.getCount()===w.getCount()){const E=Math.abs(S.getEstimatedModuleSize()-m),A=Math.abs(w.getEstimatedModuleSize()-m);return E<A?1:E>A?-1:0}else return S.getCount()-w.getCount()}),d.splice(3)}return[d[0],d[1],d[2]]}}ir.CENTER_QUORUM=2,ir.MIN_SKIP=3,ir.MAX_MODULES=57;class Zo{constructor(u){this.image=u}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(u){this.resultPointCallback=u==null?null:u.get(Fe.NEED_RESULT_POINT_CALLBACK);const m=new ir(this.image,this.resultPointCallback).find(u);return this.processFinderPatternInfo(m)}processFinderPatternInfo(u){const d=u.getTopLeft(),m=u.getTopRight(),b=u.getBottomLeft(),w=this.calculateModuleSize(d,m,b);if(w<1)throw new Pe("No pattern found in proccess finder.");const S=Zo.computeDimension(d,m,b,w),E=bt.getProvisionalVersionForDimension(S),A=E.getDimensionForVersion()-7;let G=null;if(E.getAlignmentPatternCenters().length>0){const ne=m.getX()-d.getX()+b.getX(),le=m.getY()-d.getY()+b.getY(),ce=1-3/A,ve=Math.floor(d.getX()+ce*(ne-d.getX())),Re=Math.floor(d.getY()+ce*(le-d.getY()));for(let Xe=4;Xe<=16;Xe<<=1)try{G=this.findAlignmentInRegion(w,ve,Re,Xe);break}catch(Ye){if(!(Ye instanceof Pe))throw Ye}}const B=Zo.createTransform(d,m,b,G,S),Z=Zo.sampleGrid(this.image,B,S);let U;return G===null?U=[b,d,m]:U=[b,d,m,G],new Al(Z,U)}static createTransform(u,d,m,b,w){const S=w-3.5;let E,A,G,B;return b!==null?(E=b.getX(),A=b.getY(),G=S-3,B=G):(E=d.getX()-u.getX()+m.getX(),A=d.getY()-u.getY()+m.getY(),G=S,B=S),Yr.quadrilateralToQuadrilateral(3.5,3.5,S,3.5,G,B,3.5,S,u.getX(),u.getY(),d.getX(),d.getY(),E,A,m.getX(),m.getY())}static sampleGrid(u,d,m){return zi.getInstance().sampleGridWithTransform(u,m,m,d)}static computeDimension(u,d,m,b){const w=Ht.round(gt.distance(u,d)/b),S=Ht.round(gt.distance(u,m)/b);let E=Math.floor((w+S)/2)+7;switch(E&3){case 0:E++;break;case 2:E--;break;case 3:throw new Pe("Dimensions could be not found.")}return E}calculateModuleSize(u,d,m){return(this.calculateModuleSizeOneWay(u,d)+this.calculateModuleSizeOneWay(u,m))/2}calculateModuleSizeOneWay(u,d){const m=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(u.getX()),Math.floor(u.getY()),Math.floor(d.getX()),Math.floor(d.getY())),b=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(d.getX()),Math.floor(d.getY()),Math.floor(u.getX()),Math.floor(u.getY()));return isNaN(m)?b/7:isNaN(b)?m/7:(m+b)/14}sizeOfBlackWhiteBlackRunBothWays(u,d,m,b){let w=this.sizeOfBlackWhiteBlackRun(u,d,m,b),S=1,E=u-(m-u);E<0?(S=u/(u-E),E=0):E>=this.image.getWidth()&&(S=(this.image.getWidth()-1-u)/(E-u),E=this.image.getWidth()-1);let A=Math.floor(d-(b-d)*S);return S=1,A<0?(S=d/(d-A),A=0):A>=this.image.getHeight()&&(S=(this.image.getHeight()-1-d)/(A-d),A=this.image.getHeight()-1),E=Math.floor(u+(E-u)*S),w+=this.sizeOfBlackWhiteBlackRun(u,d,E,A),w-1}sizeOfBlackWhiteBlackRun(u,d,m,b){const w=Math.abs(b-d)>Math.abs(m-u);if(w){let ne=u;u=d,d=ne,ne=m,m=b,b=ne}const S=Math.abs(m-u),E=Math.abs(b-d);let A=-S/2;const G=u<m?1:-1,B=d<b?1:-1;let Z=0;const U=m+G;for(let ne=u,le=d;ne!==U;ne+=G){const ce=w?le:ne,ve=w?ne:le;if(Z===1===this.image.get(ce,ve)){if(Z===2)return Ht.distance(ne,le,u,d);Z++}if(A+=E,A>0){if(le===b)break;le+=B,A-=S}}return Z===2?Ht.distance(m+G,b,u,d):NaN}findAlignmentInRegion(u,d,m,b){const w=Math.floor(b*u),S=Math.max(0,d-w),E=Math.min(this.image.getWidth()-1,d+w);if(E-S<u*3)throw new Pe("Alignment top exceeds estimated module size.");const A=Math.max(0,m-w),G=Math.min(this.image.getHeight()-1,m+w);if(G-A<u*3)throw new Pe("Alignment bottom exceeds estimated module size.");return new Xo(this.image,S,A,E-S,G-A,u,this.resultPointCallback).find()}}class yi{constructor(){this.decoder=new ac}getDecoder(){return this.decoder}decode(u,d){let m,b;if(d!=null&&d.get(Fe.PURE_BARCODE)!==void 0){const A=yi.extractPureBits(u.getBlackMatrix());m=this.decoder.decodeBitMatrix(A,d),b=yi.NO_POINTS}else{const A=new Zo(u.getBlackMatrix()).detect(d);m=this.decoder.decodeBitMatrix(A.getBits(),d),b=A.getPoints()}m.getOther()instanceof Pl&&m.getOther().applyMirroredCorrection(b);const w=new En(m.getText(),m.getRawBytes(),void 0,b,yt.QR_CODE,void 0),S=m.getByteSegments();S!==null&&w.putMetadata(bn.BYTE_SEGMENTS,S);const E=m.getECLevel();return E!==null&&w.putMetadata(bn.ERROR_CORRECTION_LEVEL,E),m.hasStructuredAppend()&&(w.putMetadata(bn.STRUCTURED_APPEND_SEQUENCE,m.getStructuredAppendSequenceNumber()),w.putMetadata(bn.STRUCTURED_APPEND_PARITY,m.getStructuredAppendParity())),w}reset(){}static extractPureBits(u){const d=u.getTopLeftOnBit(),m=u.getBottomRightOnBit();if(d===null||m===null)throw new Pe;const b=this.moduleSize(d,u);let w=d[1],S=m[1],E=d[0],A=m[0];if(E>=A||w>=S)throw new Pe;if(S-w!==A-E&&(A=E+(S-w),A>=u.getWidth()))throw new Pe;const G=Math.round((A-E+1)/b),B=Math.round((S-w+1)/b);if(G<=0||B<=0)throw new Pe;if(B!==G)throw new Pe;const Z=Math.floor(b/2);w+=Z,E+=Z;const U=E+Math.floor((G-1)*b)-A;if(U>0){if(U>Z)throw new Pe;E-=U}const ne=w+Math.floor((B-1)*b)-S;if(ne>0){if(ne>Z)throw new Pe;w-=ne}const le=new fn(G,B);for(let ce=0;ce<B;ce++){const ve=w+Math.floor(ce*b);for(let Re=0;Re<G;Re++)u.get(E+Math.floor(Re*b),ve)&&le.set(Re,ce)}return le}static moduleSize(u,d){const m=d.getHeight(),b=d.getWidth();let w=u[0],S=u[1],E=!0,A=0;for(;w<b&&S<m;){if(E!==d.get(w,S)){if(++A===5)break;E=!E}w++,S++}if(w===b||S===m)throw new Pe;return(w-u[0])/7}}yi.NO_POINTS=new Array;class Ct{PDF417Common(){}static getBitCountSum(u){return Ht.sum(u)}static toIntArray(u){if(u==null||!u.length)return Ct.EMPTY_INT_ARRAY;const d=new Int32Array(u.length);let m=0;for(const b of u)d[m++]=b;return d}static getCodeword(u){const d=Y.binarySearch(Ct.SYMBOL_TABLE,u&262143);return d<0?-1:(Ct.CODEWORD_TABLE[d]-1)%Ct.NUMBER_OF_CODEWORDS}}Ct.NUMBER_OF_CODEWORDS=929,Ct.MAX_CODEWORDS_IN_BARCODE=Ct.NUMBER_OF_CODEWORDS-1,Ct.MIN_ROWS_IN_BARCODE=3,Ct.MAX_ROWS_IN_BARCODE=90,Ct.MODULES_IN_CODEWORD=17,Ct.MODULES_IN_STOP_PATTERN=18,Ct.BARS_IN_MODULE=8,Ct.EMPTY_INT_ARRAY=new Int32Array([]),Ct.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),Ct.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class Ah{constructor(u,d){this.bits=u,this.points=d}getBits(){return this.bits}getPoints(){return this.points}}class Ot{static detectMultiple(u,d,m){let b=u.getBlackMatrix(),w=Ot.detect(m,b);return w.length||(b=b.clone(),b.rotate180(),w=Ot.detect(m,b)),new Ah(b,w)}static detect(u,d){const m=new Array;let b=0,w=0,S=!1;for(;b<d.getHeight();){const E=Ot.findVertices(d,b,w);if(E[0]==null&&E[3]==null){if(!S)break;S=!1,w=0;for(const A of m)A[1]!=null&&(b=Math.trunc(Math.max(b,A[1].getY()))),A[3]!=null&&(b=Math.max(b,Math.trunc(A[3].getY())));b+=Ot.ROW_STEP;continue}if(S=!0,m.push(E),!u)break;E[2]!=null?(w=Math.trunc(E[2].getX()),b=Math.trunc(E[2].getY())):(w=Math.trunc(E[4].getX()),b=Math.trunc(E[4].getY()))}return m}static findVertices(u,d,m){const b=u.getHeight(),w=u.getWidth(),S=new Array(8);return Ot.copyToResult(S,Ot.findRowsWithPattern(u,b,w,d,m,Ot.START_PATTERN),Ot.INDEXES_START_PATTERN),S[4]!=null&&(m=Math.trunc(S[4].getX()),d=Math.trunc(S[4].getY())),Ot.copyToResult(S,Ot.findRowsWithPattern(u,b,w,d,m,Ot.STOP_PATTERN),Ot.INDEXES_STOP_PATTERN),S}static copyToResult(u,d,m){for(let b=0;b<m.length;b++)u[m[b]]=d[b]}static findRowsWithPattern(u,d,m,b,w,S){const E=new Array(4);let A=!1;const G=new Int32Array(S.length);for(;b<d;b+=Ot.ROW_STEP){let Z=Ot.findGuardPattern(u,w,b,m,!1,S,G);if(Z!=null){for(;b>0;){const U=Ot.findGuardPattern(u,w,--b,m,!1,S,G);if(U!=null)Z=U;else{b++;break}}E[0]=new gt(Z[0],b),E[1]=new gt(Z[1],b),A=!0;break}}let B=b+1;if(A){let Z=0,U=Int32Array.from([Math.trunc(E[0].getX()),Math.trunc(E[1].getX())]);for(;B<d;B++){const ne=Ot.findGuardPattern(u,U[0],B,m,!1,S,G);if(ne!=null&&Math.abs(U[0]-ne[0])<Ot.MAX_PATTERN_DRIFT&&Math.abs(U[1]-ne[1])<Ot.MAX_PATTERN_DRIFT)U=ne,Z=0;else{if(Z>Ot.SKIPPED_ROW_COUNT_MAX)break;Z++}}B-=Z+1,E[2]=new gt(U[0],B),E[3]=new gt(U[1],B)}return B-b<Ot.BARCODE_MIN_HEIGHT&&Y.fill(E,null),E}static findGuardPattern(u,d,m,b,w,S,E){Y.fillWithin(E,0,E.length,0);let A=d,G=0;for(;u.get(A,m)&&A>0&&G++<Ot.MAX_PIXEL_DRIFT;)A--;let B=A,Z=0,U=S.length;for(let ne=w;B<b;B++)if(u.get(B,m)!==ne)E[Z]++;else{if(Z===U-1){if(Ot.patternMatchVariance(E,S,Ot.MAX_INDIVIDUAL_VARIANCE)<Ot.MAX_AVG_VARIANCE)return new Int32Array([A,B]);A+=E[0]+E[1],se.arraycopy(E,2,E,0,Z-1),E[Z-1]=0,E[Z]=0,Z--}else Z++;E[Z]=1,ne=!ne}return Z===U-1&&Ot.patternMatchVariance(E,S,Ot.MAX_INDIVIDUAL_VARIANCE)<Ot.MAX_AVG_VARIANCE?new Int32Array([A,B-1]):null}static patternMatchVariance(u,d,m){let b=u.length,w=0,S=0;for(let G=0;G<b;G++)w+=u[G],S+=d[G];if(w<S)return 1/0;let E=w/S;m*=E;let A=0;for(let G=0;G<b;G++){let B=u[G],Z=d[G]*E,U=B>Z?B-Z:Z-B;if(U>m)return 1/0;A+=U}return A/w}}Ot.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),Ot.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),Ot.MAX_AVG_VARIANCE=.42,Ot.MAX_INDIVIDUAL_VARIANCE=.8,Ot.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),Ot.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),Ot.MAX_PIXEL_DRIFT=3,Ot.MAX_PATTERN_DRIFT=5,Ot.SKIPPED_ROW_COUNT_MAX=25,Ot.ROW_STEP=5,Ot.BARCODE_MIN_HEIGHT=10;class pr{constructor(u,d){if(d.length===0)throw new D;this.field=u;let m=d.length;if(m>1&&d[0]===0){let b=1;for(;b<m&&d[b]===0;)b++;b===m?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(m-b),se.arraycopy(d,b,this.coefficients,0,this.coefficients.length))}else this.coefficients=d}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(u){return this.coefficients[this.coefficients.length-1-u]}evaluateAt(u){if(u===0)return this.getCoefficient(0);if(u===1){let b=0;for(let w of this.coefficients)b=this.field.add(b,w);return b}let d=this.coefficients[0],m=this.coefficients.length;for(let b=1;b<m;b++)d=this.field.add(this.field.multiply(u,d),this.coefficients[b]);return d}add(u){if(!this.field.equals(u.field))throw new D("ModulusPolys do not have same ModulusGF field");if(this.isZero())return u;if(u.isZero())return this;let d=this.coefficients,m=u.coefficients;if(d.length>m.length){let S=d;d=m,m=S}let b=new Int32Array(m.length),w=m.length-d.length;se.arraycopy(m,0,b,0,w);for(let S=w;S<m.length;S++)b[S]=this.field.add(d[S-w],m[S]);return new pr(this.field,b)}subtract(u){if(!this.field.equals(u.field))throw new D("ModulusPolys do not have same ModulusGF field");return u.isZero()?this:this.add(u.negative())}multiply(u){return u instanceof pr?this.multiplyOther(u):this.multiplyScalar(u)}multiplyOther(u){if(!this.field.equals(u.field))throw new D("ModulusPolys do not have same ModulusGF field");if(this.isZero()||u.isZero())return new pr(this.field,new Int32Array([0]));let d=this.coefficients,m=d.length,b=u.coefficients,w=b.length,S=new Int32Array(m+w-1);for(let E=0;E<m;E++){let A=d[E];for(let G=0;G<w;G++)S[E+G]=this.field.add(S[E+G],this.field.multiply(A,b[G]))}return new pr(this.field,S)}negative(){let u=this.coefficients.length,d=new Int32Array(u);for(let m=0;m<u;m++)d[m]=this.field.subtract(0,this.coefficients[m]);return new pr(this.field,d)}multiplyScalar(u){if(u===0)return new pr(this.field,new Int32Array([0]));if(u===1)return this;let d=this.coefficients.length,m=new Int32Array(d);for(let b=0;b<d;b++)m[b]=this.field.multiply(this.coefficients[b],u);return new pr(this.field,m)}multiplyByMonomial(u,d){if(u<0)throw new D;if(d===0)return new pr(this.field,new Int32Array([0]));let m=this.coefficients.length,b=new Int32Array(m+u);for(let w=0;w<m;w++)b[w]=this.field.multiply(this.coefficients[w],d);return new pr(this.field,b)}toString(){let u=new _t;for(let d=this.getDegree();d>=0;d--){let m=this.getCoefficient(d);m!==0&&(m<0?(u.append(" - "),m=-m):u.length()>0&&u.append(" + "),(d===0||m!==1)&&u.append(m),d!==0&&(d===1?u.append("x"):(u.append("x^"),u.append(d))))}return u.toString()}}class df{add(u,d){return(u+d)%this.modulus}subtract(u,d){return(this.modulus+u-d)%this.modulus}exp(u){return this.expTable[u]}log(u){if(u===0)throw new D;return this.logTable[u]}inverse(u){if(u===0)throw new wh;return this.expTable[this.modulus-this.logTable[u]-1]}multiply(u,d){return u===0||d===0?0:this.expTable[(this.logTable[u]+this.logTable[d])%(this.modulus-1)]}getSize(){return this.modulus}equals(u){return u===this}}class Rh extends df{constructor(u,d){super(),this.modulus=u,this.expTable=new Int32Array(u),this.logTable=new Int32Array(u);let m=1;for(let b=0;b<u;b++)this.expTable[b]=m,m=m*d%u;for(let b=0;b<u-1;b++)this.logTable[this.expTable[b]]=b;this.zero=new pr(this,new Int32Array([0])),this.one=new pr(this,new Int32Array([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(u,d){if(u<0)throw new D;if(d===0)return this.zero;let m=new Int32Array(u+1);return m[0]=d,new pr(this,m)}}Rh.PDF417_GF=new Rh(Ct.NUMBER_OF_CODEWORDS,3);class oc{constructor(){this.field=Rh.PDF417_GF}decode(u,d,m){let b=new pr(this.field,u),w=new Int32Array(d),S=!1;for(let le=d;le>0;le--){let ce=b.evaluateAt(this.field.exp(le));w[d-le]=ce,ce!==0&&(S=!0)}if(!S)return 0;let E=this.field.getOne();if(m!=null)for(const le of m){let ce=this.field.exp(u.length-1-le),ve=new pr(this.field,new Int32Array([this.field.subtract(0,ce),1]));E=E.multiply(ve)}let A=new pr(this.field,w),G=this.runEuclideanAlgorithm(this.field.buildMonomial(d,1),A,d),B=G[0],Z=G[1],U=this.findErrorLocations(B),ne=this.findErrorMagnitudes(Z,B,U);for(let le=0;le<U.length;le++){let ce=u.length-1-this.field.log(U[le]);if(ce<0)throw re.getChecksumInstance();u[ce]=this.field.subtract(u[ce],ne[le])}return U.length}runEuclideanAlgorithm(u,d,m){if(u.getDegree()<d.getDegree()){let U=u;u=d,d=U}let b=u,w=d,S=this.field.getZero(),E=this.field.getOne();for(;w.getDegree()>=Math.round(m/2);){let U=b,ne=S;if(b=w,S=E,b.isZero())throw re.getChecksumInstance();w=U;let le=this.field.getZero(),ce=b.getCoefficient(b.getDegree()),ve=this.field.inverse(ce);for(;w.getDegree()>=b.getDegree()&&!w.isZero();){let Re=w.getDegree()-b.getDegree(),Xe=this.field.multiply(w.getCoefficient(w.getDegree()),ve);le=le.add(this.field.buildMonomial(Re,Xe)),w=w.subtract(b.multiplyByMonomial(Re,Xe))}E=le.multiply(S).subtract(ne).negative()}let A=E.getCoefficient(0);if(A===0)throw re.getChecksumInstance();let G=this.field.inverse(A),B=E.multiply(G),Z=w.multiply(G);return[B,Z]}findErrorLocations(u){let d=u.getDegree(),m=new Int32Array(d),b=0;for(let w=1;w<this.field.getSize()&&b<d;w++)u.evaluateAt(w)===0&&(m[b]=this.field.inverse(w),b++);if(b!==d)throw re.getChecksumInstance();return m}findErrorMagnitudes(u,d,m){let b=d.getDegree(),w=new Int32Array(b);for(let G=1;G<=b;G++)w[b-G]=this.field.multiply(G,d.getCoefficient(G));let S=new pr(this.field,w),E=m.length,A=new Int32Array(E);for(let G=0;G<E;G++){let B=this.field.inverse(m[G]),Z=this.field.subtract(0,u.evaluateAt(B)),U=this.field.inverse(S.evaluateAt(B));A[G]=this.field.multiply(Z,U)}return A}}class Yi{constructor(u,d,m,b,w){u instanceof Yi?this.constructor_2(u):this.constructor_1(u,d,m,b,w)}constructor_1(u,d,m,b,w){const S=d==null||m==null,E=b==null||w==null;if(S&&E)throw new Pe;S?(d=new gt(0,b.getY()),m=new gt(0,w.getY())):E&&(b=new gt(u.getWidth()-1,d.getY()),w=new gt(u.getWidth()-1,m.getY())),this.image=u,this.topLeft=d,this.bottomLeft=m,this.topRight=b,this.bottomRight=w,this.minX=Math.trunc(Math.min(d.getX(),m.getX())),this.maxX=Math.trunc(Math.max(b.getX(),w.getX())),this.minY=Math.trunc(Math.min(d.getY(),b.getY())),this.maxY=Math.trunc(Math.max(m.getY(),w.getY()))}constructor_2(u){this.image=u.image,this.topLeft=u.getTopLeft(),this.bottomLeft=u.getBottomLeft(),this.topRight=u.getTopRight(),this.bottomRight=u.getBottomRight(),this.minX=u.getMinX(),this.maxX=u.getMaxX(),this.minY=u.getMinY(),this.maxY=u.getMaxY()}static merge(u,d){return u==null?d:d==null?u:new Yi(u.image,u.topLeft,u.bottomLeft,d.topRight,d.bottomRight)}addMissingRows(u,d,m){let b=this.topLeft,w=this.bottomLeft,S=this.topRight,E=this.bottomRight;if(u>0){let A=m?this.topLeft:this.topRight,G=Math.trunc(A.getY()-u);G<0&&(G=0);let B=new gt(A.getX(),G);m?b=B:S=B}if(d>0){let A=m?this.bottomLeft:this.bottomRight,G=Math.trunc(A.getY()+d);G>=this.image.getHeight()&&(G=this.image.getHeight()-1);let B=new gt(A.getX(),G);m?w=B:E=B}return new Yi(this.image,b,w,S,E)}getMinX(){return this.minX}getMaxX(){return this.maxX}getMinY(){return this.minY}getMaxY(){return this.maxY}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}getBottomLeft(){return this.bottomLeft}getBottomRight(){return this.bottomRight}}class lc{constructor(u,d,m,b){this.columnCount=u,this.errorCorrectionLevel=b,this.rowCountUpperPart=d,this.rowCountLowerPart=m,this.rowCount=d+m}getColumnCount(){return this.columnCount}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getRowCount(){return this.rowCount}getRowCountUpperPart(){return this.rowCountUpperPart}getRowCountLowerPart(){return this.rowCountLowerPart}}class eo{constructor(){this.buffer=""}static form(u,d){let m=-1;function b(S,E,A,G,B,Z){if(S==="%%")return"%";if(d[++m]===void 0)return;S=G?parseInt(G.substr(1)):void 0;let U=B?parseInt(B.substr(1)):void 0,ne;switch(Z){case"s":ne=d[m];break;case"c":ne=d[m][0];break;case"f":ne=parseFloat(d[m]).toFixed(S);break;case"p":ne=parseFloat(d[m]).toPrecision(S);break;case"e":ne=parseFloat(d[m]).toExponential(S);break;case"x":ne=parseInt(d[m]).toString(U||16);break;case"d":ne=parseFloat(parseInt(d[m],U||10).toPrecision(S)).toFixed(0);break}ne=typeof ne=="object"?JSON.stringify(ne):(+ne).toString(U);let le=parseInt(A),ce=A&&A[0]+""=="0"?"0":" ";for(;ne.length<le;)ne=E!==void 0?ne+ce:ce+ne;return ne}let w=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return u.replace(w,b)}format(u,...d){this.buffer+=eo.form(u,d)}toString(){return this.buffer}}class wa{constructor(u){this.boundingBox=new Yi(u),this.codewords=new Array(u.getMaxY()-u.getMinY()+1)}getCodewordNearby(u){let d=this.getCodeword(u);if(d!=null)return d;for(let m=1;m<wa.MAX_NEARBY_DISTANCE;m++){let b=this.imageRowToCodewordIndex(u)-m;if(b>=0&&(d=this.codewords[b],d!=null)||(b=this.imageRowToCodewordIndex(u)+m,b<this.codewords.length&&(d=this.codewords[b],d!=null)))return d}return null}imageRowToCodewordIndex(u){return u-this.boundingBox.getMinY()}setCodeword(u,d){this.codewords[this.imageRowToCodewordIndex(u)]=d}getCodeword(u){return this.codewords[this.imageRowToCodewordIndex(u)]}getBoundingBox(){return this.boundingBox}getCodewords(){return this.codewords}toString(){const u=new eo;let d=0;for(const m of this.codewords){if(m==null){u.format("%3d:    |   %n",d++);continue}u.format("%3d: %3d|%3d%n",d++,m.getRowNumber(),m.getValue())}return u.toString()}}wa.MAX_NEARBY_DISTANCE=5;class _l{constructor(){this.values=new Map}setValue(u){u=Math.trunc(u);let d=this.values.get(u);d==null&&(d=0),d++,this.values.set(u,d)}getValue(){let u=-1,d=new Array;for(const[m,b]of this.values.entries()){const w={getKey:()=>m,getValue:()=>b};w.getValue()>u?(u=w.getValue(),d=[],d.push(w.getKey())):w.getValue()===u&&d.push(w.getKey())}return Ct.toIntArray(d)}getConfidence(u){return this.values.get(u)}}class Vl extends wa{constructor(u,d){super(u),this._isLeft=d}setRowNumbers(){for(let u of this.getCodewords())u!=null&&u.setRowNumberAsRowIndicatorColumn()}adjustCompleteIndicatorColumnRowNumbers(u){let d=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(d,u);let m=this.getBoundingBox(),b=this._isLeft?m.getTopLeft():m.getTopRight(),w=this._isLeft?m.getBottomLeft():m.getBottomRight(),S=this.imageRowToCodewordIndex(Math.trunc(b.getY())),E=this.imageRowToCodewordIndex(Math.trunc(w.getY())),A=-1,G=1,B=0;for(let Z=S;Z<E;Z++){if(d[Z]==null)continue;let U=d[Z],ne=U.getRowNumber()-A;if(ne===0)B++;else if(ne===1)G=Math.max(G,B),B=1,A=U.getRowNumber();else if(ne<0||U.getRowNumber()>=u.getRowCount()||ne>Z)d[Z]=null;else{let le;G>2?le=(G-2)*ne:le=ne;let ce=le>=Z;for(let ve=1;ve<=le&&!ce;ve++)ce=d[Z-ve]!=null;ce?d[Z]=null:(A=U.getRowNumber(),B=1)}}}getRowHeights(){let u=this.getBarcodeMetadata();if(u==null)return null;this.adjustIncompleteIndicatorColumnRowNumbers(u);let d=new Int32Array(u.getRowCount());for(let m of this.getCodewords())if(m!=null){let b=m.getRowNumber();if(b>=d.length)continue;d[b]++}return d}adjustIncompleteIndicatorColumnRowNumbers(u){let d=this.getBoundingBox(),m=this._isLeft?d.getTopLeft():d.getTopRight(),b=this._isLeft?d.getBottomLeft():d.getBottomRight(),w=this.imageRowToCodewordIndex(Math.trunc(m.getY())),S=this.imageRowToCodewordIndex(Math.trunc(b.getY())),E=this.getCodewords(),A=-1;for(let G=w;G<S;G++){if(E[G]==null)continue;let B=E[G];B.setRowNumberAsRowIndicatorColumn();let Z=B.getRowNumber()-A;Z===0||(Z===1?A=B.getRowNumber():B.getRowNumber()>=u.getRowCount()?E[G]=null:A=B.getRowNumber())}}getBarcodeMetadata(){let u=this.getCodewords(),d=new _l,m=new _l,b=new _l,w=new _l;for(let E of u){if(E==null)continue;E.setRowNumberAsRowIndicatorColumn();let A=E.getValue()%30,G=E.getRowNumber();switch(this._isLeft||(G+=2),G%3){case 0:m.setValue(A*3+1);break;case 1:w.setValue(A/3),b.setValue(A%3);break;case 2:d.setValue(A+1);break}}if(d.getValue().length===0||m.getValue().length===0||b.getValue().length===0||w.getValue().length===0||d.getValue()[0]<1||m.getValue()[0]+b.getValue()[0]<Ct.MIN_ROWS_IN_BARCODE||m.getValue()[0]+b.getValue()[0]>Ct.MAX_ROWS_IN_BARCODE)return null;let S=new lc(d.getValue()[0],m.getValue()[0],b.getValue()[0],w.getValue()[0]);return this.removeIncorrectCodewords(u,S),S}removeIncorrectCodewords(u,d){for(let m=0;m<u.length;m++){let b=u[m];if(u[m]==null)continue;let w=b.getValue()%30,S=b.getRowNumber();if(S>d.getRowCount()){u[m]=null;continue}switch(this._isLeft||(S+=2),S%3){case 0:w*3+1!==d.getRowCountUpperPart()&&(u[m]=null);break;case 1:(Math.trunc(w/3)!==d.getErrorCorrectionLevel()||w%3!==d.getRowCountLowerPart())&&(u[m]=null);break;case 2:w+1!==d.getColumnCount()&&(u[m]=null);break}}}isLeft(){return this._isLeft}toString(){return"IsLeft: "+this._isLeft+`
`+super.toString()}}class to{constructor(u,d){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=u,this.barcodeColumnCount=u.getColumnCount(),this.boundingBox=d,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}getDetectionResultColumns(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let u=Ct.MAX_CODEWORDS_IN_BARCODE,d;do d=u,u=this.adjustRowNumbersAndGetCount();while(u>0&&u<d);return this.detectionResultColumns}adjustIndicatorColumnRowNumbers(u){u!=null&&u.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)}adjustRowNumbersAndGetCount(){let u=this.adjustRowNumbersByRow();if(u===0)return 0;for(let d=1;d<this.barcodeColumnCount+1;d++){let m=this.detectionResultColumns[d].getCodewords();for(let b=0;b<m.length;b++)m[b]!=null&&(m[b].hasValidRowNumber()||this.adjustRowNumbers(d,b,m))}return u}adjustRowNumbersByRow(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()}adjustRowNumbersFromBothRI(){if(this.detectionResultColumns[0]==null||this.detectionResultColumns[this.barcodeColumnCount+1]==null)return;let u=this.detectionResultColumns[0].getCodewords(),d=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let m=0;m<u.length;m++)if(u[m]!=null&&d[m]!=null&&u[m].getRowNumber()===d[m].getRowNumber())for(let b=1;b<=this.barcodeColumnCount;b++){let w=this.detectionResultColumns[b].getCodewords()[m];w!=null&&(w.setRowNumber(u[m].getRowNumber()),w.hasValidRowNumber()||(this.detectionResultColumns[b].getCodewords()[m]=null))}}adjustRowNumbersFromRRI(){if(this.detectionResultColumns[this.barcodeColumnCount+1]==null)return 0;let u=0,d=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let m=0;m<d.length;m++){if(d[m]==null)continue;let b=d[m].getRowNumber(),w=0;for(let S=this.barcodeColumnCount+1;S>0&&w<this.ADJUST_ROW_NUMBER_SKIP;S--){let E=this.detectionResultColumns[S].getCodewords()[m];E!=null&&(w=to.adjustRowNumberIfValid(b,w,E),E.hasValidRowNumber()||u++)}}return u}adjustRowNumbersFromLRI(){if(this.detectionResultColumns[0]==null)return 0;let u=0,d=this.detectionResultColumns[0].getCodewords();for(let m=0;m<d.length;m++){if(d[m]==null)continue;let b=d[m].getRowNumber(),w=0;for(let S=1;S<this.barcodeColumnCount+1&&w<this.ADJUST_ROW_NUMBER_SKIP;S++){let E=this.detectionResultColumns[S].getCodewords()[m];E!=null&&(w=to.adjustRowNumberIfValid(b,w,E),E.hasValidRowNumber()||u++)}}return u}static adjustRowNumberIfValid(u,d,m){return m==null||m.hasValidRowNumber()||(m.isValidRowNumber(u)?(m.setRowNumber(u),d=0):++d),d}adjustRowNumbers(u,d,m){if(!this.detectionResultColumns[u-1])return;let b=m[d],w=this.detectionResultColumns[u-1].getCodewords(),S=w;this.detectionResultColumns[u+1]!=null&&(S=this.detectionResultColumns[u+1].getCodewords());let E=new Array(14);E[2]=w[d],E[3]=S[d],d>0&&(E[0]=m[d-1],E[4]=w[d-1],E[5]=S[d-1]),d>1&&(E[8]=m[d-2],E[10]=w[d-2],E[11]=S[d-2]),d<m.length-1&&(E[1]=m[d+1],E[6]=w[d+1],E[7]=S[d+1]),d<m.length-2&&(E[9]=m[d+2],E[12]=w[d+2],E[13]=S[d+2]);for(let A of E)if(to.adjustRowNumber(b,A))return}static adjustRowNumber(u,d){return d==null?!1:d.hasValidRowNumber()&&d.getBucket()===u.getBucket()?(u.setRowNumber(d.getRowNumber()),!0):!1}getBarcodeColumnCount(){return this.barcodeColumnCount}getBarcodeRowCount(){return this.barcodeMetadata.getRowCount()}getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel()}setBoundingBox(u){this.boundingBox=u}getBoundingBox(){return this.boundingBox}setDetectionResultColumn(u,d){this.detectionResultColumns[u]=d}getDetectionResultColumn(u){return this.detectionResultColumns[u]}toString(){let u=this.detectionResultColumns[0];u==null&&(u=this.detectionResultColumns[this.barcodeColumnCount+1]);let d=new eo;for(let m=0;m<u.getCodewords().length;m++){d.format("CW %3d:",m);for(let b=0;b<this.barcodeColumnCount+2;b++){if(this.detectionResultColumns[b]==null){d.format("    |   ");continue}let w=this.detectionResultColumns[b].getCodewords()[m];if(w==null){d.format("    |   ");continue}d.format(" %3d|%3d",w.getRowNumber(),w.getValue())}d.format("%n")}return d.toString()}}class no{constructor(u,d,m,b){this.rowNumber=no.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(u),this.endX=Math.trunc(d),this.bucket=Math.trunc(m),this.value=Math.trunc(b)}hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber)}isValidRowNumber(u){return u!==no.BARCODE_ROW_UNKNOWN&&this.bucket===u%3*3}setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc(Math.trunc(this.value/30)*3+Math.trunc(this.bucket/3))}getWidth(){return this.endX-this.startX}getStartX(){return this.startX}getEndX(){return this.endX}getBucket(){return this.bucket}getValue(){return this.value}getRowNumber(){return this.rowNumber}setRowNumber(u){this.rowNumber=u}toString(){return this.rowNumber+"|"+this.value}}no.BARCODE_ROW_UNKNOWN=-1;class qr{static initialize(){for(let u=0;u<Ct.SYMBOL_TABLE.length;u++){let d=Ct.SYMBOL_TABLE[u],m=d&1;for(let b=0;b<Ct.BARS_IN_MODULE;b++){let w=0;for(;(d&1)===m;)w+=1,d>>=1;m=d&1,qr.RATIOS_TABLE[u]||(qr.RATIOS_TABLE[u]=new Array(Ct.BARS_IN_MODULE)),qr.RATIOS_TABLE[u][Ct.BARS_IN_MODULE-b-1]=Math.fround(w/Ct.MODULES_IN_CODEWORD)}}this.bSymbolTableReady=!0}static getDecodedValue(u){let d=qr.getDecodedCodewordValue(qr.sampleBitCounts(u));return d!==-1?d:qr.getClosestDecodedValue(u)}static sampleBitCounts(u){let d=Ht.sum(u),m=new Int32Array(Ct.BARS_IN_MODULE),b=0,w=0;for(let S=0;S<Ct.MODULES_IN_CODEWORD;S++){let E=d/(2*Ct.MODULES_IN_CODEWORD)+S*d/Ct.MODULES_IN_CODEWORD;w+u[b]<=E&&(w+=u[b],b++),m[b]++}return m}static getDecodedCodewordValue(u){let d=qr.getBitValue(u);return Ct.getCodeword(d)===-1?-1:d}static getBitValue(u){let d=0;for(let m=0;m<u.length;m++)for(let b=0;b<u[m];b++)d=d<<1|(m%2===0?1:0);return Math.trunc(d)}static getClosestDecodedValue(u){let d=Ht.sum(u),m=new Array(Ct.BARS_IN_MODULE);if(d>1)for(let S=0;S<m.length;S++)m[S]=Math.fround(u[S]/d);let b=Yu.MAX_VALUE,w=-1;this.bSymbolTableReady||qr.initialize();for(let S=0;S<qr.RATIOS_TABLE.length;S++){let E=0,A=qr.RATIOS_TABLE[S];for(let G=0;G<Ct.BARS_IN_MODULE;G++){let B=Math.fround(A[G]-m[G]);if(E+=Math.fround(B*B),E>=b)break}E<b&&(b=E,w=Ct.SYMBOL_TABLE[S])}return w}}qr.bSymbolTableReady=!1,qr.RATIOS_TABLE=new Array(Ct.SYMBOL_TABLE.length).map(K=>new Array(Ct.BARS_IN_MODULE));class Mh{constructor(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}getSegmentIndex(){return this.segmentIndex}setSegmentIndex(u){this.segmentIndex=u}getFileId(){return this.fileId}setFileId(u){this.fileId=u}getOptionalData(){return this.optionalData}setOptionalData(u){this.optionalData=u}isLastSegment(){return this.lastSegment}setLastSegment(u){this.lastSegment=u}getSegmentCount(){return this.segmentCount}setSegmentCount(u){this.segmentCount=u}getSender(){return this.sender||null}setSender(u){this.sender=u}getAddressee(){return this.addressee||null}setAddressee(u){this.addressee=u}getFileName(){return this.fileName}setFileName(u){this.fileName=u}getFileSize(){return this.fileSize}setFileSize(u){this.fileSize=u}getChecksum(){return this.checksum}setChecksum(u){this.checksum=u}getTimestamp(){return this.timestamp}setTimestamp(u){this.timestamp=u}}class Lh{static parseLong(u,d=void 0){return parseInt(u,d)}}class uc extends O{}uc.kind="NullPointerException";class Dh{writeBytes(u){this.writeBytesOffset(u,0,u.length)}writeBytesOffset(u,d,m){if(u==null)throw new uc;if(d<0||d>u.length||m<0||d+m>u.length||d+m<0)throw new Ee;if(m===0)return;for(let b=0;b<m;b++)this.write(u[d+b])}flush(){}close(){}}class Oh extends O{}class Ph extends Dh{constructor(u=32){if(super(),this.count=0,u<0)throw new D("Negative initial size: "+u);this.buf=new Uint8Array(u)}ensureCapacity(u){u-this.buf.length>0&&this.grow(u)}grow(u){let m=this.buf.length<<1;if(m-u<0&&(m=u),m<0){if(u<0)throw new Oh;m=j.MAX_VALUE}this.buf=Y.copyOfUint8Array(this.buf,m)}write(u){this.ensureCapacity(this.count+1),this.buf[this.count]=u,this.count+=1}writeBytesOffset(u,d,m){if(d<0||d>u.length||m<0||d+m-u.length>0)throw new Ee;this.ensureCapacity(this.count+m),se.arraycopy(u,d,this.buf,this.count,m),this.count+=m}writeTo(u){u.writeBytesOffset(this.buf,0,this.count)}reset(){this.count=0}toByteArray(){return Y.copyOfUint8Array(this.buf,this.count)}size(){return this.count}toString(u){return u?typeof u=="string"?this.toString_string(u):this.toString_number(u):this.toString_void()}toString_void(){return new String(this.buf).toString()}toString_string(u){return new String(this.buf).toString()}toString_number(u){return new String(this.buf).toString()}close(){}}var rn;(function(K){K[K.ALPHA=0]="ALPHA",K[K.LOWER=1]="LOWER",K[K.MIXED=2]="MIXED",K[K.PUNCT=3]="PUNCT",K[K.ALPHA_SHIFT=4]="ALPHA_SHIFT",K[K.PUNCT_SHIFT=5]="PUNCT_SHIFT"})(rn||(rn={}));function cc(){if(typeof window<"u")return window.BigInt||null;if(typeof $a<"u")return $a.BigInt||null;if(typeof self<"u")return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}let Ko;function va(K){if(typeof Ko>"u"&&(Ko=cc()),Ko===null)throw new Error("BigInt is not supported!");return Ko(K)}function C0(){let K=[];K[0]=va(1);let u=va(900);K[1]=u;for(let d=2;d<16;d++)K[d]=K[d-1]*u;return K}class Ae{static decode(u,d){let m=new _t(""),b=Ne.ISO8859_1;m.enableDecoding(b);let w=1,S=u[w++],E=new Mh;for(;w<u[0];){switch(S){case Ae.TEXT_COMPACTION_MODE_LATCH:w=Ae.textCompaction(u,w,m);break;case Ae.BYTE_COMPACTION_MODE_LATCH:case Ae.BYTE_COMPACTION_MODE_LATCH_6:w=Ae.byteCompaction(S,u,b,w,m);break;case Ae.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:m.append(u[w++]);break;case Ae.NUMERIC_COMPACTION_MODE_LATCH:w=Ae.numericCompaction(u,w,m);break;case Ae.ECI_CHARSET:Ne.getCharacterSetECIByValue(u[w++]);break;case Ae.ECI_GENERAL_PURPOSE:w+=2;break;case Ae.ECI_USER_DEFINED:w++;break;case Ae.BEGIN_MACRO_PDF417_CONTROL_BLOCK:w=Ae.decodeMacroBlock(u,w,E);break;case Ae.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case Ae.MACRO_PDF417_TERMINATOR:throw new ue;default:w--,w=Ae.textCompaction(u,w,m);break}if(w<u.length)S=u[w++];else throw ue.getFormatInstance()}if(m.length()===0)throw ue.getFormatInstance();let A=new Bi(null,m.toString(),null,d);return A.setOther(E),A}static decodeMacroBlock(u,d,m){if(d+Ae.NUMBER_OF_SEQUENCE_CODEWORDS>u[0])throw ue.getFormatInstance();let b=new Int32Array(Ae.NUMBER_OF_SEQUENCE_CODEWORDS);for(let E=0;E<Ae.NUMBER_OF_SEQUENCE_CODEWORDS;E++,d++)b[E]=u[d];m.setSegmentIndex(j.parseInt(Ae.decodeBase900toBase10(b,Ae.NUMBER_OF_SEQUENCE_CODEWORDS)));let w=new _t;d=Ae.textCompaction(u,d,w),m.setFileId(w.toString());let S=-1;for(u[d]===Ae.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(S=d+1);d<u[0];)switch(u[d]){case Ae.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(d++,u[d]){case Ae.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let E=new _t;d=Ae.textCompaction(u,d+1,E),m.setFileName(E.toString());break;case Ae.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let A=new _t;d=Ae.textCompaction(u,d+1,A),m.setSender(A.toString());break;case Ae.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let G=new _t;d=Ae.textCompaction(u,d+1,G),m.setAddressee(G.toString());break;case Ae.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let B=new _t;d=Ae.numericCompaction(u,d+1,B),m.setSegmentCount(j.parseInt(B.toString()));break;case Ae.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let Z=new _t;d=Ae.numericCompaction(u,d+1,Z),m.setTimestamp(Lh.parseLong(Z.toString()));break;case Ae.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let U=new _t;d=Ae.numericCompaction(u,d+1,U),m.setChecksum(j.parseInt(U.toString()));break;case Ae.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let ne=new _t;d=Ae.numericCompaction(u,d+1,ne),m.setFileSize(Lh.parseLong(ne.toString()));break;default:throw ue.getFormatInstance()}break;case Ae.MACRO_PDF417_TERMINATOR:d++,m.setLastSegment(!0);break;default:throw ue.getFormatInstance()}if(S!==-1){let E=d-S;m.isLastSegment()&&E--,m.setOptionalData(Y.copyOfRange(u,S,S+E))}return d}static textCompaction(u,d,m){let b=new Int32Array((u[0]-d)*2),w=new Int32Array((u[0]-d)*2),S=0,E=!1;for(;d<u[0]&&!E;){let A=u[d++];if(A<Ae.TEXT_COMPACTION_MODE_LATCH)b[S]=A/30,b[S+1]=A%30,S+=2;else switch(A){case Ae.TEXT_COMPACTION_MODE_LATCH:b[S++]=Ae.TEXT_COMPACTION_MODE_LATCH;break;case Ae.BYTE_COMPACTION_MODE_LATCH:case Ae.BYTE_COMPACTION_MODE_LATCH_6:case Ae.NUMERIC_COMPACTION_MODE_LATCH:case Ae.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case Ae.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case Ae.MACRO_PDF417_TERMINATOR:d--,E=!0;break;case Ae.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:b[S]=Ae.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,A=u[d++],w[S]=A,S++;break}}return Ae.decodeTextCompaction(b,w,S,m),d}static decodeTextCompaction(u,d,m,b){let w=rn.ALPHA,S=rn.ALPHA,E=0;for(;E<m;){let A=u[E],G="";switch(w){case rn.ALPHA:if(A<26)G=String.fromCharCode(65+A);else switch(A){case 26:G=" ";break;case Ae.LL:w=rn.LOWER;break;case Ae.ML:w=rn.MIXED;break;case Ae.PS:S=w,w=rn.PUNCT_SHIFT;break;case Ae.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:b.append(d[E]);break;case Ae.TEXT_COMPACTION_MODE_LATCH:w=rn.ALPHA;break}break;case rn.LOWER:if(A<26)G=String.fromCharCode(97+A);else switch(A){case 26:G=" ";break;case Ae.AS:S=w,w=rn.ALPHA_SHIFT;break;case Ae.ML:w=rn.MIXED;break;case Ae.PS:S=w,w=rn.PUNCT_SHIFT;break;case Ae.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:b.append(d[E]);break;case Ae.TEXT_COMPACTION_MODE_LATCH:w=rn.ALPHA;break}break;case rn.MIXED:if(A<Ae.PL)G=Ae.MIXED_CHARS[A];else switch(A){case Ae.PL:w=rn.PUNCT;break;case 26:G=" ";break;case Ae.LL:w=rn.LOWER;break;case Ae.AL:w=rn.ALPHA;break;case Ae.PS:S=w,w=rn.PUNCT_SHIFT;break;case Ae.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:b.append(d[E]);break;case Ae.TEXT_COMPACTION_MODE_LATCH:w=rn.ALPHA;break}break;case rn.PUNCT:if(A<Ae.PAL)G=Ae.PUNCT_CHARS[A];else switch(A){case Ae.PAL:w=rn.ALPHA;break;case Ae.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:b.append(d[E]);break;case Ae.TEXT_COMPACTION_MODE_LATCH:w=rn.ALPHA;break}break;case rn.ALPHA_SHIFT:if(w=S,A<26)G=String.fromCharCode(65+A);else switch(A){case 26:G=" ";break;case Ae.TEXT_COMPACTION_MODE_LATCH:w=rn.ALPHA;break}break;case rn.PUNCT_SHIFT:if(w=S,A<Ae.PAL)G=Ae.PUNCT_CHARS[A];else switch(A){case Ae.PAL:w=rn.ALPHA;break;case Ae.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:b.append(d[E]);break;case Ae.TEXT_COMPACTION_MODE_LATCH:w=rn.ALPHA;break}break}G!==""&&b.append(G),E++}}static byteCompaction(u,d,m,b,w){let S=new Ph,E=0,A=0,G=!1;switch(u){case Ae.BYTE_COMPACTION_MODE_LATCH:let B=new Int32Array(6),Z=d[b++];for(;b<d[0]&&!G;)switch(B[E++]=Z,A=900*A+Z,Z=d[b++],Z){case Ae.TEXT_COMPACTION_MODE_LATCH:case Ae.BYTE_COMPACTION_MODE_LATCH:case Ae.NUMERIC_COMPACTION_MODE_LATCH:case Ae.BYTE_COMPACTION_MODE_LATCH_6:case Ae.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case Ae.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case Ae.MACRO_PDF417_TERMINATOR:b--,G=!0;break;default:if(E%5===0&&E>0){for(let U=0;U<6;++U)S.write(Number(va(A)>>va(8*(5-U))));A=0,E=0}break}b===d[0]&&Z<Ae.TEXT_COMPACTION_MODE_LATCH&&(B[E++]=Z);for(let U=0;U<E;U++)S.write(B[U]);break;case Ae.BYTE_COMPACTION_MODE_LATCH_6:for(;b<d[0]&&!G;){let U=d[b++];if(U<Ae.TEXT_COMPACTION_MODE_LATCH)E++,A=900*A+U;else switch(U){case Ae.TEXT_COMPACTION_MODE_LATCH:case Ae.BYTE_COMPACTION_MODE_LATCH:case Ae.NUMERIC_COMPACTION_MODE_LATCH:case Ae.BYTE_COMPACTION_MODE_LATCH_6:case Ae.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case Ae.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case Ae.MACRO_PDF417_TERMINATOR:b--,G=!0;break}if(E%5===0&&E>0){for(let ne=0;ne<6;++ne)S.write(Number(va(A)>>va(8*(5-ne))));A=0,E=0}}break}return w.append(Bt.decode(S.toByteArray(),m)),b}static numericCompaction(u,d,m){let b=0,w=!1,S=new Int32Array(Ae.MAX_NUMERIC_CODEWORDS);for(;d<u[0]&&!w;){let E=u[d++];if(d===u[0]&&(w=!0),E<Ae.TEXT_COMPACTION_MODE_LATCH)S[b]=E,b++;else switch(E){case Ae.TEXT_COMPACTION_MODE_LATCH:case Ae.BYTE_COMPACTION_MODE_LATCH:case Ae.BYTE_COMPACTION_MODE_LATCH_6:case Ae.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case Ae.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case Ae.MACRO_PDF417_TERMINATOR:d--,w=!0;break}(b%Ae.MAX_NUMERIC_CODEWORDS===0||E===Ae.NUMERIC_COMPACTION_MODE_LATCH||w)&&b>0&&(m.append(Ae.decodeBase900toBase10(S,b)),b=0)}return d}static decodeBase900toBase10(u,d){let m=va(0);for(let w=0;w<d;w++)m+=Ae.EXP900[d-w-1]*va(u[w]);let b=m.toString();if(b.charAt(0)!=="1")throw new ue;return b.substring(1)}}Ae.TEXT_COMPACTION_MODE_LATCH=900,Ae.BYTE_COMPACTION_MODE_LATCH=901,Ae.NUMERIC_COMPACTION_MODE_LATCH=902,Ae.BYTE_COMPACTION_MODE_LATCH_6=924,Ae.ECI_USER_DEFINED=925,Ae.ECI_GENERAL_PURPOSE=926,Ae.ECI_CHARSET=927,Ae.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,Ae.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,Ae.MACRO_PDF417_TERMINATOR=922,Ae.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,Ae.MAX_NUMERIC_CODEWORDS=15,Ae.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,Ae.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,Ae.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,Ae.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,Ae.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,Ae.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,Ae.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,Ae.PL=25,Ae.LL=27,Ae.AS=27,Ae.ML=28,Ae.AL=28,Ae.PS=29,Ae.PAL=29,Ae.PUNCT_CHARS=`;<>@[\\]_\`~!\r	,:
-.$/"|*()?{}'`,Ae.MIXED_CHARS="0123456789&\r	,:#-.$/+%*=^",Ae.EXP900=cc()?C0():[],Ae.NUMBER_OF_SEQUENCE_CODEWORDS=2;class Gt{constructor(){}static decode(u,d,m,b,w,S,E){let A=new Yi(u,d,m,b,w),G=null,B=null,Z;for(let le=!0;;le=!1){if(d!=null&&(G=Gt.getRowIndicatorColumn(u,A,d,!0,S,E)),b!=null&&(B=Gt.getRowIndicatorColumn(u,A,b,!1,S,E)),Z=Gt.merge(G,B),Z==null)throw Pe.getNotFoundInstance();let ce=Z.getBoundingBox();if(le&&ce!=null&&(ce.getMinY()<A.getMinY()||ce.getMaxY()>A.getMaxY()))A=ce;else break}Z.setBoundingBox(A);let U=Z.getBarcodeColumnCount()+1;Z.setDetectionResultColumn(0,G),Z.setDetectionResultColumn(U,B);let ne=G!=null;for(let le=1;le<=U;le++){let ce=ne?le:U-le;if(Z.getDetectionResultColumn(ce)!==void 0)continue;let ve;ce===0||ce===U?ve=new Vl(A,ce===0):ve=new wa(A),Z.setDetectionResultColumn(ce,ve);let Re=-1,Xe=Re;for(let Ye=A.getMinY();Ye<=A.getMaxY();Ye++){if(Re=Gt.getStartColumn(Z,ce,Ye,ne),Re<0||Re>A.getMaxX()){if(Xe===-1)continue;Re=Xe}let Ke=Gt.detectCodeword(u,A.getMinX(),A.getMaxX(),ne,Re,Ye,S,E);Ke!=null&&(ve.setCodeword(Ye,Ke),Xe=Re,S=Math.min(S,Ke.getWidth()),E=Math.max(E,Ke.getWidth()))}}return Gt.createDecoderResult(Z)}static merge(u,d){if(u==null&&d==null)return null;let m=Gt.getBarcodeMetadata(u,d);if(m==null)return null;let b=Yi.merge(Gt.adjustBoundingBox(u),Gt.adjustBoundingBox(d));return new to(m,b)}static adjustBoundingBox(u){if(u==null)return null;let d=u.getRowHeights();if(d==null)return null;let m=Gt.getMax(d),b=0;for(let E of d)if(b+=m-E,E>0)break;let w=u.getCodewords();for(let E=0;b>0&&w[E]==null;E++)b--;let S=0;for(let E=d.length-1;E>=0&&(S+=m-d[E],!(d[E]>0));E--);for(let E=w.length-1;S>0&&w[E]==null;E--)S--;return u.getBoundingBox().addMissingRows(b,S,u.isLeft())}static getMax(u){let d=-1;for(let m of u)d=Math.max(d,m);return d}static getBarcodeMetadata(u,d){let m;if(u==null||(m=u.getBarcodeMetadata())==null)return d==null?null:d.getBarcodeMetadata();let b;return d==null||(b=d.getBarcodeMetadata())==null?m:m.getColumnCount()!==b.getColumnCount()&&m.getErrorCorrectionLevel()!==b.getErrorCorrectionLevel()&&m.getRowCount()!==b.getRowCount()?null:m}static getRowIndicatorColumn(u,d,m,b,w,S){let E=new Vl(d,b);for(let A=0;A<2;A++){let G=A===0?1:-1,B=Math.trunc(Math.trunc(m.getX()));for(let Z=Math.trunc(Math.trunc(m.getY()));Z<=d.getMaxY()&&Z>=d.getMinY();Z+=G){let U=Gt.detectCodeword(u,0,u.getWidth(),b,B,Z,w,S);U!=null&&(E.setCodeword(Z,U),b?B=U.getStartX():B=U.getEndX())}}return E}static adjustCodewordCount(u,d){let m=d[0][1],b=m.getValue(),w=u.getBarcodeColumnCount()*u.getBarcodeRowCount()-Gt.getNumberOfECCodeWords(u.getBarcodeECLevel());if(b.length===0){if(w<1||w>Ct.MAX_CODEWORDS_IN_BARCODE)throw Pe.getNotFoundInstance();m.setValue(w)}else b[0]!==w&&m.setValue(w)}static createDecoderResult(u){let d=Gt.createBarcodeMatrix(u);Gt.adjustCodewordCount(u,d);let m=new Array,b=new Int32Array(u.getBarcodeRowCount()*u.getBarcodeColumnCount()),w=[],S=new Array;for(let A=0;A<u.getBarcodeRowCount();A++)for(let G=0;G<u.getBarcodeColumnCount();G++){let B=d[A][G+1].getValue(),Z=A*u.getBarcodeColumnCount()+G;B.length===0?m.push(Z):B.length===1?b[Z]=B[0]:(S.push(Z),w.push(B))}let E=new Array(w.length);for(let A=0;A<E.length;A++)E[A]=w[A];return Gt.createDecoderResultFromAmbiguousValues(u.getBarcodeECLevel(),b,Ct.toIntArray(m),Ct.toIntArray(S),E)}static createDecoderResultFromAmbiguousValues(u,d,m,b,w){let S=new Int32Array(b.length),E=100;for(;E-- >0;){for(let A=0;A<S.length;A++)d[b[A]]=w[A][S[A]];try{return Gt.decodeCodewords(d,u,m)}catch(A){if(!(A instanceof re))throw A}if(S.length===0)throw re.getChecksumInstance();for(let A=0;A<S.length;A++)if(S[A]<w[A].length-1){S[A]++;break}else if(S[A]=0,A===S.length-1)throw re.getChecksumInstance()}throw re.getChecksumInstance()}static createBarcodeMatrix(u){let d=Array.from({length:u.getBarcodeRowCount()},()=>new Array(u.getBarcodeColumnCount()+2));for(let b=0;b<d.length;b++)for(let w=0;w<d[b].length;w++)d[b][w]=new _l;let m=0;for(let b of u.getDetectionResultColumns()){if(b!=null){for(let w of b.getCodewords())if(w!=null){let S=w.getRowNumber();if(S>=0){if(S>=d.length)continue;d[S][m].setValue(w.getValue())}}}m++}return d}static isValidBarcodeColumn(u,d){return d>=0&&d<=u.getBarcodeColumnCount()+1}static getStartColumn(u,d,m,b){let w=b?1:-1,S=null;if(Gt.isValidBarcodeColumn(u,d-w)&&(S=u.getDetectionResultColumn(d-w).getCodeword(m)),S!=null)return b?S.getEndX():S.getStartX();if(S=u.getDetectionResultColumn(d).getCodewordNearby(m),S!=null)return b?S.getStartX():S.getEndX();if(Gt.isValidBarcodeColumn(u,d-w)&&(S=u.getDetectionResultColumn(d-w).getCodewordNearby(m)),S!=null)return b?S.getEndX():S.getStartX();let E=0;for(;Gt.isValidBarcodeColumn(u,d-w);){d-=w;for(let A of u.getDetectionResultColumn(d).getCodewords())if(A!=null)return(b?A.getEndX():A.getStartX())+w*E*(A.getEndX()-A.getStartX());E++}return b?u.getBoundingBox().getMinX():u.getBoundingBox().getMaxX()}static detectCodeword(u,d,m,b,w,S,E,A){w=Gt.adjustCodewordStartColumn(u,d,m,b,w,S);let G=Gt.getModuleBitCount(u,d,m,b,w,S);if(G==null)return null;let B,Z=Ht.sum(G);if(b)B=w+Z;else{for(let le=0;le<G.length/2;le++){let ce=G[le];G[le]=G[G.length-1-le],G[G.length-1-le]=ce}B=w,w=B-Z}if(!Gt.checkCodewordSkew(Z,E,A))return null;let U=qr.getDecodedValue(G),ne=Ct.getCodeword(U);return ne===-1?null:new no(w,B,Gt.getCodewordBucketNumber(U),ne)}static getModuleBitCount(u,d,m,b,w,S){let E=w,A=new Int32Array(8),G=0,B=b?1:-1,Z=b;for(;(b?E<m:E>=d)&&G<A.length;)u.get(E,S)===Z?(A[G]++,E+=B):(G++,Z=!Z);return G===A.length||E===(b?m:d)&&G===A.length-1?A:null}static getNumberOfECCodeWords(u){return 2<<u}static adjustCodewordStartColumn(u,d,m,b,w,S){let E=w,A=b?-1:1;for(let G=0;G<2;G++){for(;(b?E>=d:E<m)&&b===u.get(E,S);){if(Math.abs(w-E)>Gt.CODEWORD_SKEW_SIZE)return w;E+=A}A=-A,b=!b}return E}static checkCodewordSkew(u,d,m){return d-Gt.CODEWORD_SKEW_SIZE<=u&&u<=m+Gt.CODEWORD_SKEW_SIZE}static decodeCodewords(u,d,m){if(u.length===0)throw ue.getFormatInstance();let b=1<<d+1,w=Gt.correctErrors(u,m,b);Gt.verifyCodewordCount(u,b);let S=Ae.decode(u,""+d);return S.setErrorsCorrected(w),S.setErasures(m.length),S}static correctErrors(u,d,m){if(d!=null&&d.length>m/2+Gt.MAX_ERRORS||m<0||m>Gt.MAX_EC_CODEWORDS)throw re.getChecksumInstance();return Gt.errorCorrection.decode(u,m,d)}static verifyCodewordCount(u,d){if(u.length<4)throw ue.getFormatInstance();let m=u[0];if(m>u.length)throw ue.getFormatInstance();if(m===0)if(d<u.length)u[0]=u.length-d;else throw ue.getFormatInstance()}static getBitCountForCodeword(u){let d=new Int32Array(8),m=0,b=d.length-1;for(;!((u&1)!==m&&(m=u&1,b--,b<0));)d[b]++,u>>=1;return d}static getCodewordBucketNumber(u){return u instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(u):this.getCodewordBucketNumber_number(u)}static getCodewordBucketNumber_number(u){return Gt.getCodewordBucketNumber(Gt.getBitCountForCodeword(u))}static getCodewordBucketNumber_Int32Array(u){return(u[0]-u[2]+u[4]-u[6]+9)%9}static toString(u){let d=new eo;for(let m=0;m<u.length;m++){d.format("Row %2d: ",m);for(let b=0;b<u[m].length;b++){let w=u[m][b];w.getValue().length===0?d.format("        ",null):d.format("%4d(%2d)",w.getValue()[0],w.getConfidence(w.getValue()[0]))}d.format("%n")}return d.toString()}}Gt.CODEWORD_SKEW_SIZE=2,Gt.MAX_ERRORS=3,Gt.MAX_EC_CODEWORDS=512,Gt.errorCorrection=new oc;class Tr{decode(u,d=null){let m=Tr.decode(u,d,!1);if(m==null||m.length===0||m[0]==null)throw Pe.getNotFoundInstance();return m[0]}decodeMultiple(u,d=null){try{return Tr.decode(u,d,!0)}catch(m){throw m instanceof ue||m instanceof re?Pe.getNotFoundInstance():m}}static decode(u,d,m){const b=new Array,w=Ot.detectMultiple(u,d,m);for(const S of w.getPoints()){const E=Gt.decode(w.getBits(),S[4],S[5],S[6],S[7],Tr.getMinCodewordWidth(S),Tr.getMaxCodewordWidth(S)),A=new En(E.getText(),E.getRawBytes(),void 0,S,yt.PDF_417);A.putMetadata(bn.ERROR_CORRECTION_LEVEL,E.getECLevel());const G=E.getOther();G!=null&&A.putMetadata(bn.PDF417_EXTRA_METADATA,G),b.push(A)}return b.map(S=>S)}static getMaxWidth(u,d){return u==null||d==null?0:Math.trunc(Math.abs(u.getX()-d.getX()))}static getMinWidth(u,d){return u==null||d==null?j.MAX_VALUE:Math.trunc(Math.abs(u.getX()-d.getX()))}static getMaxCodewordWidth(u){return Math.floor(Math.max(Math.max(Tr.getMaxWidth(u[0],u[4]),Tr.getMaxWidth(u[6],u[2])*Ct.MODULES_IN_CODEWORD/Ct.MODULES_IN_STOP_PATTERN),Math.max(Tr.getMaxWidth(u[1],u[5]),Tr.getMaxWidth(u[7],u[3])*Ct.MODULES_IN_CODEWORD/Ct.MODULES_IN_STOP_PATTERN)))}static getMinCodewordWidth(u){return Math.floor(Math.min(Math.min(Tr.getMinWidth(u[0],u[4]),Tr.getMinWidth(u[6],u[2])*Ct.MODULES_IN_CODEWORD/Ct.MODULES_IN_STOP_PATTERN),Math.min(Tr.getMinWidth(u[1],u[5]),Tr.getMinWidth(u[7],u[3])*Ct.MODULES_IN_CODEWORD/Ct.MODULES_IN_STOP_PATTERN)))}reset(){}}class ro extends O{}ro.kind="ReaderException";class Bl{constructor(u,d){this.verbose=u===!0,d&&this.setHints(d)}decode(u,d){return d&&this.setHints(d),this.decodeInternal(u)}decodeWithState(u){return(this.readers===null||this.readers===void 0)&&this.setHints(null),this.decodeInternal(u)}setHints(u){this.hints=u;const d=!p(u)&&u.get(Fe.TRY_HARDER)===!0,m=p(u)?null:u.get(Fe.POSSIBLE_FORMATS),b=new Array;if(!p(m)){const w=m.some(S=>S===yt.UPC_A||S===yt.UPC_E||S===yt.EAN_13||S===yt.EAN_8||S===yt.CODABAR||S===yt.CODE_39||S===yt.CODE_93||S===yt.CODE_128||S===yt.ITF||S===yt.RSS_14||S===yt.RSS_EXPANDED);w&&!d&&b.push(new Hi(u,this.verbose)),m.includes(yt.QR_CODE)&&b.push(new yi),m.includes(yt.DATA_MATRIX)&&b.push(new xi),m.includes(yt.AZTEC)&&b.push(new Go),m.includes(yt.PDF_417)&&b.push(new Tr),w&&d&&b.push(new Hi(u,this.verbose))}b.length===0&&(d||b.push(new Hi(u,this.verbose)),b.push(new yi),b.push(new xi),b.push(new Go),b.push(new Tr),d&&b.push(new Hi(u,this.verbose))),this.readers=b}reset(){if(this.readers!==null)for(const u of this.readers)u.reset()}decodeInternal(u){if(this.readers===null)throw new ro("No readers where selected, nothing can be read.");for(const d of this.readers)try{return d.decode(u,this.hints)}catch(m){if(m instanceof ro)continue}throw new Pe("No MultiFormat Readers were able to detect the code.")}}class Fh extends qs{constructor(u=null,d=500){const m=new Bl;m.setHints(u),super(m,d)}decodeBitmap(u){return this.reader.decodeWithState(u)}}class Gh extends qs{constructor(u=500){super(new Tr,u)}}class ff extends qs{constructor(u=500){super(new yi,u)}}var Wl;(function(K){K[K.ERROR_CORRECTION=0]="ERROR_CORRECTION",K[K.CHARACTER_SET=1]="CHARACTER_SET",K[K.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",K[K.MIN_SIZE=3]="MIN_SIZE",K[K.MAX_SIZE=4]="MAX_SIZE",K[K.MARGIN=5]="MARGIN",K[K.PDF417_COMPACT=6]="PDF417_COMPACT",K[K.PDF417_COMPACTION=7]="PDF417_COMPACTION",K[K.PDF417_DIMENSIONS=8]="PDF417_DIMENSIONS",K[K.AZTEC_LAYERS=9]="AZTEC_LAYERS",K[K.QR_VERSION=10]="QR_VERSION"})(Wl||(Wl={}));var ar=Wl;class $o{constructor(u){this.field=u,this.cachedGenerators=[],this.cachedGenerators.push(new ls(u,Int32Array.from([1])))}buildGenerator(u){const d=this.cachedGenerators;if(u>=d.length){let m=d[d.length-1];const b=this.field;for(let w=d.length;w<=u;w++){const S=m.multiply(new ls(b,Int32Array.from([1,b.exp(w-1+b.getGeneratorBase())])));d.push(S),m=S}}return d[u]}encode(u,d){if(d===0)throw new D("No error correction bytes");const m=u.length-d;if(m<=0)throw new D("No data bytes provided");const b=this.buildGenerator(d),w=new Int32Array(m);se.arraycopy(u,0,w,0,m);let S=new ls(this.field,w);S=S.multiplyByMonomial(d,1);const A=S.divide(b)[1].getCoefficients(),G=d-A.length;for(let B=0;B<G;B++)u[m+B]=0;se.arraycopy(A,0,u,m+G,A.length)}}class Mn{constructor(){}static applyMaskPenaltyRule1(u){return Mn.applyMaskPenaltyRule1Internal(u,!0)+Mn.applyMaskPenaltyRule1Internal(u,!1)}static applyMaskPenaltyRule2(u){let d=0;const m=u.getArray(),b=u.getWidth(),w=u.getHeight();for(let S=0;S<w-1;S++){const E=m[S];for(let A=0;A<b-1;A++){const G=E[A];G===E[A+1]&&G===m[S+1][A]&&G===m[S+1][A+1]&&d++}}return Mn.N2*d}static applyMaskPenaltyRule3(u){let d=0;const m=u.getArray(),b=u.getWidth(),w=u.getHeight();for(let S=0;S<w;S++)for(let E=0;E<b;E++){const A=m[S];E+6<b&&A[E]===1&&A[E+1]===0&&A[E+2]===1&&A[E+3]===1&&A[E+4]===1&&A[E+5]===0&&A[E+6]===1&&(Mn.isWhiteHorizontal(A,E-4,E)||Mn.isWhiteHorizontal(A,E+7,E+11))&&d++,S+6<w&&m[S][E]===1&&m[S+1][E]===0&&m[S+2][E]===1&&m[S+3][E]===1&&m[S+4][E]===1&&m[S+5][E]===0&&m[S+6][E]===1&&(Mn.isWhiteVertical(m,E,S-4,S)||Mn.isWhiteVertical(m,E,S+7,S+11))&&d++}return d*Mn.N3}static isWhiteHorizontal(u,d,m){d=Math.max(d,0),m=Math.min(m,u.length);for(let b=d;b<m;b++)if(u[b]===1)return!1;return!0}static isWhiteVertical(u,d,m,b){m=Math.max(m,0),b=Math.min(b,u.length);for(let w=m;w<b;w++)if(u[w][d]===1)return!1;return!0}static applyMaskPenaltyRule4(u){let d=0;const m=u.getArray(),b=u.getWidth(),w=u.getHeight();for(let A=0;A<w;A++){const G=m[A];for(let B=0;B<b;B++)G[B]===1&&d++}const S=u.getHeight()*u.getWidth();return Math.floor(Math.abs(d*2-S)*10/S)*Mn.N4}static getDataMaskBit(u,d,m){let b,w;switch(u){case 0:b=m+d&1;break;case 1:b=m&1;break;case 2:b=d%3;break;case 3:b=(m+d)%3;break;case 4:b=Math.floor(m/2)+Math.floor(d/3)&1;break;case 5:w=m*d,b=(w&1)+w%3;break;case 6:w=m*d,b=(w&1)+w%3&1;break;case 7:w=m*d,b=w%3+(m+d&1)&1;break;default:throw new D("Invalid mask pattern: "+u)}return b===0}static applyMaskPenaltyRule1Internal(u,d){let m=0;const b=d?u.getHeight():u.getWidth(),w=d?u.getWidth():u.getHeight(),S=u.getArray();for(let E=0;E<b;E++){let A=0,G=-1;for(let B=0;B<w;B++){const Z=d?S[E][B]:S[B][E];Z===G?A++:(A>=5&&(m+=Mn.N1+(A-5)),A=1,G=Z)}A>=5&&(m+=Mn.N1+(A-5))}return m}}Mn.N1=3,Mn.N2=3,Mn.N3=40,Mn.N4=10;class so{constructor(u,d){this.width=u,this.height=d;const m=new Array(d);for(let b=0;b!==d;b++)m[b]=new Uint8Array(u);this.bytes=m}getHeight(){return this.height}getWidth(){return this.width}get(u,d){return this.bytes[d][u]}getArray(){return this.bytes}setNumber(u,d,m){this.bytes[d][u]=m}setBoolean(u,d,m){this.bytes[d][u]=m?1:0}clear(u){for(const d of this.bytes)Y.fill(d,u)}equals(u){if(!(u instanceof so))return!1;const d=u;if(this.width!==d.width||this.height!==d.height)return!1;for(let m=0,b=this.height;m<b;++m){const w=this.bytes[m],S=d.bytes[m];for(let E=0,A=this.width;E<A;++E)if(w[E]!==S[E])return!1}return!0}toString(){const u=new _t;for(let d=0,m=this.height;d<m;++d){const b=this.bytes[d];for(let w=0,S=this.width;w<S;++w)switch(b[w]){case 0:u.append(" 0");break;case 1:u.append(" 1");break;default:u.append("  ");break}u.append(`
`)}return u.toString()}}class bi{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){const u=new _t;return u.append(`<<
`),u.append(" mode: "),u.append(this.mode?this.mode.toString():"null"),u.append(`
 ecLevel: `),u.append(this.ecLevel?this.ecLevel.toString():"null"),u.append(`
 version: `),u.append(this.version?this.version.toString():"null"),u.append(`
 maskPattern: `),u.append(this.maskPattern.toString()),this.matrix?(u.append(`
 matrix:
`),u.append(this.matrix.toString())):u.append(`
 matrix: null
`),u.append(`>>
`),u.toString()}setMode(u){this.mode=u}setECLevel(u){this.ecLevel=u}setVersion(u){this.version=u}setMaskPattern(u){this.maskPattern=u}setMatrix(u){this.matrix=u}static isValidMaskPattern(u){return u>=0&&u<bi.NUM_MASK_PATTERNS}}bi.NUM_MASK_PATTERNS=8;class pn extends O{}pn.kind="WriterException";class kt{constructor(){}static clearMatrix(u){u.clear(255)}static buildMatrix(u,d,m,b,w){kt.clearMatrix(w),kt.embedBasicPatterns(m,w),kt.embedTypeInfo(d,b,w),kt.maybeEmbedVersionInfo(m,w),kt.embedDataBits(u,b,w)}static embedBasicPatterns(u,d){kt.embedPositionDetectionPatternsAndSeparators(d),kt.embedDarkDotAtLeftBottomCorner(d),kt.maybeEmbedPositionAdjustmentPatterns(u,d),kt.embedTimingPatterns(d)}static embedTypeInfo(u,d,m){const b=new fe;kt.makeTypeInfoBits(u,d,b);for(let w=0,S=b.getSize();w<S;++w){const E=b.get(b.getSize()-1-w),A=kt.TYPE_INFO_COORDINATES[w],G=A[0],B=A[1];if(m.setBoolean(G,B,E),w<8){const Z=m.getWidth()-w-1;m.setBoolean(Z,8,E)}else{const U=m.getHeight()-7+(w-8);m.setBoolean(8,U,E)}}}static maybeEmbedVersionInfo(u,d){if(u.getVersionNumber()<7)return;const m=new fe;kt.makeVersionInfoBits(u,m);let b=6*3-1;for(let w=0;w<6;++w)for(let S=0;S<3;++S){const E=m.get(b);b--,d.setBoolean(w,d.getHeight()-11+S,E),d.setBoolean(d.getHeight()-11+S,w,E)}}static embedDataBits(u,d,m){let b=0,w=-1,S=m.getWidth()-1,E=m.getHeight()-1;for(;S>0;){for(S===6&&(S-=1);E>=0&&E<m.getHeight();){for(let A=0;A<2;++A){const G=S-A;if(!kt.isEmpty(m.get(G,E)))continue;let B;b<u.getSize()?(B=u.get(b),++b):B=!1,d!==255&&Mn.getDataMaskBit(d,G,E)&&(B=!B),m.setBoolean(G,E,B)}E+=w}w=-w,E+=w,S-=2}if(b!==u.getSize())throw new pn("Not all bits consumed: "+b+"/"+u.getSize())}static findMSBSet(u){return 32-j.numberOfLeadingZeros(u)}static calculateBCHCode(u,d){if(d===0)throw new D("0 polynomial");const m=kt.findMSBSet(d);for(u<<=m-1;kt.findMSBSet(u)>=m;)u^=d<<kt.findMSBSet(u)-m;return u}static makeTypeInfoBits(u,d,m){if(!bi.isValidMaskPattern(d))throw new pn("Invalid mask pattern");const b=u.getBits()<<3|d;m.appendBits(b,5);const w=kt.calculateBCHCode(b,kt.TYPE_INFO_POLY);m.appendBits(w,10);const S=new fe;if(S.appendBits(kt.TYPE_INFO_MASK_PATTERN,15),m.xor(S),m.getSize()!==15)throw new pn("should not happen but we got: "+m.getSize())}static makeVersionInfoBits(u,d){d.appendBits(u.getVersionNumber(),6);const m=kt.calculateBCHCode(u.getVersionNumber(),kt.VERSION_INFO_POLY);if(d.appendBits(m,12),d.getSize()!==18)throw new pn("should not happen but we got: "+d.getSize())}static isEmpty(u){return u===255}static embedTimingPatterns(u){for(let d=8;d<u.getWidth()-8;++d){const m=(d+1)%2;kt.isEmpty(u.get(d,6))&&u.setNumber(d,6,m),kt.isEmpty(u.get(6,d))&&u.setNumber(6,d,m)}}static embedDarkDotAtLeftBottomCorner(u){if(u.get(8,u.getHeight()-8)===0)throw new pn;u.setNumber(8,u.getHeight()-8,1)}static embedHorizontalSeparationPattern(u,d,m){for(let b=0;b<8;++b){if(!kt.isEmpty(m.get(u+b,d)))throw new pn;m.setNumber(u+b,d,0)}}static embedVerticalSeparationPattern(u,d,m){for(let b=0;b<7;++b){if(!kt.isEmpty(m.get(u,d+b)))throw new pn;m.setNumber(u,d+b,0)}}static embedPositionAdjustmentPattern(u,d,m){for(let b=0;b<5;++b){const w=kt.POSITION_ADJUSTMENT_PATTERN[b];for(let S=0;S<5;++S)m.setNumber(u+S,d+b,w[S])}}static embedPositionDetectionPattern(u,d,m){for(let b=0;b<7;++b){const w=kt.POSITION_DETECTION_PATTERN[b];for(let S=0;S<7;++S)m.setNumber(u+S,d+b,w[S])}}static embedPositionDetectionPatternsAndSeparators(u){const d=kt.POSITION_DETECTION_PATTERN[0].length;kt.embedPositionDetectionPattern(0,0,u),kt.embedPositionDetectionPattern(u.getWidth()-d,0,u),kt.embedPositionDetectionPattern(0,u.getWidth()-d,u);const m=8;kt.embedHorizontalSeparationPattern(0,m-1,u),kt.embedHorizontalSeparationPattern(u.getWidth()-m,m-1,u),kt.embedHorizontalSeparationPattern(0,u.getWidth()-m,u);const b=7;kt.embedVerticalSeparationPattern(b,0,u),kt.embedVerticalSeparationPattern(u.getHeight()-b-1,0,u),kt.embedVerticalSeparationPattern(b,u.getHeight()-b,u)}static maybeEmbedPositionAdjustmentPatterns(u,d){if(u.getVersionNumber()<2)return;const m=u.getVersionNumber()-1,b=kt.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[m];for(let w=0,S=b.length;w!==S;w++){const E=b[w];if(E>=0)for(let A=0;A!==S;A++){const G=b[A];G>=0&&kt.isEmpty(d.get(G,E))&&kt.embedPositionAdjustmentPattern(G-2,E-2,d)}}}}kt.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),kt.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),kt.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),kt.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),kt.VERSION_INFO_POLY=7973,kt.TYPE_INFO_POLY=1335,kt.TYPE_INFO_MASK_PATTERN=21522;class S0{constructor(u,d){this.dataBytes=u,this.errorCorrectionBytes=d}getDataBytes(){return this.dataBytes}getErrorCorrectionBytes(){return this.errorCorrectionBytes}}class mn{constructor(){}static calculateMaskPenalty(u){return Mn.applyMaskPenaltyRule1(u)+Mn.applyMaskPenaltyRule2(u)+Mn.applyMaskPenaltyRule3(u)+Mn.applyMaskPenaltyRule4(u)}static encode(u,d,m=null){let b=mn.DEFAULT_BYTE_MODE_ENCODING;const w=m!==null&&m.get(ar.CHARACTER_SET)!==void 0;w&&(b=m.get(ar.CHARACTER_SET).toString());const S=this.chooseMode(u,b),E=new fe;if(S===wt.BYTE&&(w||mn.DEFAULT_BYTE_MODE_ENCODING!==b)){const Ye=Ne.getCharacterSetECIByName(b);Ye!==void 0&&this.appendECI(Ye,E)}this.appendModeInfo(S,E);const A=new fe;this.appendBytes(u,S,A,b);let G;if(m!==null&&m.get(ar.QR_VERSION)!==void 0){const Ye=Number.parseInt(m.get(ar.QR_VERSION).toString(),10);G=bt.getVersionForNumber(Ye);const Ke=this.calculateBitsNeeded(S,E,A,G);if(!this.willFit(Ke,G,d))throw new pn("Data too big for requested version")}else G=this.recommendVersion(d,S,E,A);const B=new fe;B.appendBitArray(E);const Z=S===wt.BYTE?A.getSizeInBytes():u.length;this.appendLengthInfo(Z,G,S,B),B.appendBitArray(A);const U=G.getECBlocksForLevel(d),ne=G.getTotalCodewords()-U.getTotalECCodewords();this.terminateBits(ne,B);const le=this.interleaveWithECBytes(B,G.getTotalCodewords(),ne,U.getNumBlocks()),ce=new bi;ce.setECLevel(d),ce.setMode(S),ce.setVersion(G);const ve=G.getDimensionForVersion(),Re=new so(ve,ve),Xe=this.chooseMaskPattern(le,d,G,Re);return ce.setMaskPattern(Xe),kt.buildMatrix(le,d,G,Xe,Re),ce.setMatrix(Re),ce}static recommendVersion(u,d,m,b){const w=this.calculateBitsNeeded(d,m,b,bt.getVersionForNumber(1)),S=this.chooseVersion(w,u),E=this.calculateBitsNeeded(d,m,b,S);return this.chooseVersion(E,u)}static calculateBitsNeeded(u,d,m,b){return d.getSize()+u.getCharacterCountBits(b)+m.getSize()}static getAlphanumericCode(u){return u<mn.ALPHANUMERIC_TABLE.length?mn.ALPHANUMERIC_TABLE[u]:-1}static chooseMode(u,d=null){if(Ne.SJIS.getName()===d&&this.isOnlyDoubleByteKanji(u))return wt.KANJI;let m=!1,b=!1;for(let w=0,S=u.length;w<S;++w){const E=u.charAt(w);if(mn.isDigit(E))m=!0;else if(this.getAlphanumericCode(E.charCodeAt(0))!==-1)b=!0;else return wt.BYTE}return b?wt.ALPHANUMERIC:m?wt.NUMERIC:wt.BYTE}static isOnlyDoubleByteKanji(u){let d;try{d=Bt.encode(u,Ne.SJIS)}catch{return!1}const m=d.length;if(m%2!==0)return!1;for(let b=0;b<m;b+=2){const w=d[b]&255;if((w<129||w>159)&&(w<224||w>235))return!1}return!0}static chooseMaskPattern(u,d,m,b){let w=Number.MAX_SAFE_INTEGER,S=-1;for(let E=0;E<bi.NUM_MASK_PATTERNS;E++){kt.buildMatrix(u,d,m,E,b);let A=this.calculateMaskPenalty(b);A<w&&(w=A,S=E)}return S}static chooseVersion(u,d){for(let m=1;m<=40;m++){const b=bt.getVersionForNumber(m);if(mn.willFit(u,b,d))return b}throw new pn("Data too big")}static willFit(u,d,m){const b=d.getTotalCodewords(),S=d.getECBlocksForLevel(m).getTotalECCodewords(),E=b-S,A=(u+7)/8;return E>=A}static terminateBits(u,d){const m=u*8;if(d.getSize()>m)throw new pn("data bits cannot fit in the QR Code"+d.getSize()+" > "+m);for(let S=0;S<4&&d.getSize()<m;++S)d.appendBit(!1);const b=d.getSize()&7;if(b>0)for(let S=b;S<8;S++)d.appendBit(!1);const w=u-d.getSizeInBytes();for(let S=0;S<w;++S)d.appendBits(S&1?17:236,8);if(d.getSize()!==m)throw new pn("Bits size does not equal capacity")}static getNumDataBytesAndNumECBytesForBlockID(u,d,m,b,w,S){if(b>=m)throw new pn("Block ID too large");const E=u%m,A=m-E,G=Math.floor(u/m),B=G+1,Z=Math.floor(d/m),U=Z+1,ne=G-Z,le=B-U;if(ne!==le)throw new pn("EC bytes mismatch");if(m!==A+E)throw new pn("RS blocks mismatch");if(u!==(Z+ne)*A+(U+le)*E)throw new pn("Total bytes mismatch");b<A?(w[0]=Z,S[0]=ne):(w[0]=U,S[0]=le)}static interleaveWithECBytes(u,d,m,b){if(u.getSizeInBytes()!==m)throw new pn("Number of bits and data bytes does not match");let w=0,S=0,E=0;const A=new Array;for(let B=0;B<b;++B){const Z=new Int32Array(1),U=new Int32Array(1);mn.getNumDataBytesAndNumECBytesForBlockID(d,m,b,B,Z,U);const ne=Z[0],le=new Uint8Array(ne);u.toBytes(8*w,le,0,ne);const ce=mn.generateECBytes(le,U[0]);A.push(new S0(le,ce)),S=Math.max(S,ne),E=Math.max(E,ce.length),w+=Z[0]}if(m!==w)throw new pn("Data bytes does not match offset");const G=new fe;for(let B=0;B<S;++B)for(const Z of A){const U=Z.getDataBytes();B<U.length&&G.appendBits(U[B],8)}for(let B=0;B<E;++B)for(const Z of A){const U=Z.getErrorCorrectionBytes();B<U.length&&G.appendBits(U[B],8)}if(d!==G.getSizeInBytes())throw new pn("Interleaving error: "+d+" and "+G.getSizeInBytes()+" differ.");return G}static generateECBytes(u,d){const m=u.length,b=new Int32Array(m+d);for(let S=0;S<m;S++)b[S]=u[S]&255;new $o(an.QR_CODE_FIELD_256).encode(b,d);const w=new Uint8Array(d);for(let S=0;S<d;S++)w[S]=b[m+S];return w}static appendModeInfo(u,d){d.appendBits(u.getBits(),4)}static appendLengthInfo(u,d,m,b){const w=m.getCharacterCountBits(d);if(u>=1<<w)throw new pn(u+" is bigger than "+((1<<w)-1));b.appendBits(u,w)}static appendBytes(u,d,m,b){switch(d){case wt.NUMERIC:mn.appendNumericBytes(u,m);break;case wt.ALPHANUMERIC:mn.appendAlphanumericBytes(u,m);break;case wt.BYTE:mn.append8BitBytes(u,m,b);break;case wt.KANJI:mn.appendKanjiBytes(u,m);break;default:throw new pn("Invalid mode: "+d)}}static getDigit(u){return u.charCodeAt(0)-48}static isDigit(u){const d=mn.getDigit(u);return d>=0&&d<=9}static appendNumericBytes(u,d){const m=u.length;let b=0;for(;b<m;){const w=mn.getDigit(u.charAt(b));if(b+2<m){const S=mn.getDigit(u.charAt(b+1)),E=mn.getDigit(u.charAt(b+2));d.appendBits(w*100+S*10+E,10),b+=3}else if(b+1<m){const S=mn.getDigit(u.charAt(b+1));d.appendBits(w*10+S,7),b+=2}else d.appendBits(w,4),b++}}static appendAlphanumericBytes(u,d){const m=u.length;let b=0;for(;b<m;){const w=mn.getAlphanumericCode(u.charCodeAt(b));if(w===-1)throw new pn;if(b+1<m){const S=mn.getAlphanumericCode(u.charCodeAt(b+1));if(S===-1)throw new pn;d.appendBits(w*45+S,11),b+=2}else d.appendBits(w,6),b++}}static append8BitBytes(u,d,m){let b;try{b=Bt.encode(u,m)}catch(w){throw new pn(w)}for(let w=0,S=b.length;w!==S;w++){const E=b[w];d.appendBits(E,8)}}static appendKanjiBytes(u,d){let m;try{m=Bt.encode(u,Ne.SJIS)}catch(w){throw new pn(w)}const b=m.length;for(let w=0;w<b;w+=2){const S=m[w]&255,E=m[w+1]&255,A=S<<8&4294967295|E;let G=-1;if(A>=33088&&A<=40956?G=A-33088:A>=57408&&A<=60351&&(G=A-49472),G===-1)throw new pn("Invalid byte sequence");const B=(G>>8)*192+(G&255);d.appendBits(B,13)}}static appendECI(u,d){d.appendBits(wt.ECI.getBits(),4),d.appendBits(u.getValue(),8)}}mn.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),mn.DEFAULT_BYTE_MODE_ENCODING=Ne.UTF8.getName();class wi{write(u,d,m,b=null){if(u.length===0)throw new D("Found empty contents");if(d<0||m<0)throw new D("Requested dimensions are too small: "+d+"x"+m);let w=dn.L,S=wi.QUIET_ZONE_SIZE;b!==null&&(b.get(ar.ERROR_CORRECTION)!==void 0&&(w=dn.fromString(b.get(ar.ERROR_CORRECTION).toString())),b.get(ar.MARGIN)!==void 0&&(S=Number.parseInt(b.get(ar.MARGIN).toString(),10)));const E=mn.encode(u,w,b);return this.renderResult(E,d,m,S)}writeToDom(u,d,m,b,w=null){typeof u=="string"&&(u=document.querySelector(u));const S=this.write(d,m,b,w);u&&u.appendChild(S)}renderResult(u,d,m,b){const w=u.getMatrix();if(w===null)throw new Wi;const S=w.getWidth(),E=w.getHeight(),A=S+b*2,G=E+b*2,B=Math.max(d,A),Z=Math.max(m,G),U=Math.min(Math.floor(B/A),Math.floor(Z/G)),ne=Math.floor((B-S*U)/2),le=Math.floor((Z-E*U)/2),ce=this.createSVGElement(B,Z);for(let ve=0,Re=le;ve<E;ve++,Re+=U)for(let Xe=0,Ye=ne;Xe<S;Xe++,Ye+=U)if(w.get(Xe,ve)===1){const Ke=this.createSvgRectElement(Ye,Re,U,U);ce.appendChild(Ke)}return ce}createSVGElement(u,d){const m=document.createElementNS(wi.SVG_NS,"svg");return m.setAttributeNS(null,"height",u.toString()),m.setAttributeNS(null,"width",d.toString()),m}createSvgRectElement(u,d,m,b){const w=document.createElementNS(wi.SVG_NS,"rect");return w.setAttributeNS(null,"x",u.toString()),w.setAttributeNS(null,"y",d.toString()),w.setAttributeNS(null,"height",m.toString()),w.setAttributeNS(null,"width",b.toString()),w.setAttributeNS(null,"fill","#000000"),w}}wi.QUIET_ZONE_SIZE=4,wi.SVG_NS="http://www.w3.org/2000/svg";class Ia{encode(u,d,m,b,w){if(u.length===0)throw new D("Found empty contents");if(d!==yt.QR_CODE)throw new D("Can only encode QR_CODE, but got "+d);if(m<0||b<0)throw new D(`Requested dimensions are too small: ${m}x${b}`);let S=dn.L,E=Ia.QUIET_ZONE_SIZE;w!==null&&(w.get(ar.ERROR_CORRECTION)!==void 0&&(S=dn.fromString(w.get(ar.ERROR_CORRECTION).toString())),w.get(ar.MARGIN)!==void 0&&(E=Number.parseInt(w.get(ar.MARGIN).toString(),10)));const A=mn.encode(u,S,w);return Ia.renderResult(A,m,b,E)}static renderResult(u,d,m,b){const w=u.getMatrix();if(w===null)throw new Wi;const S=w.getWidth(),E=w.getHeight(),A=S+b*2,G=E+b*2,B=Math.max(d,A),Z=Math.max(m,G),U=Math.min(Math.floor(B/A),Math.floor(Z/G)),ne=Math.floor((B-S*U)/2),le=Math.floor((Z-E*U)/2),ce=new fn(B,Z);for(let ve=0,Re=le;ve<E;ve++,Re+=U)for(let Xe=0,Ye=ne;Xe<S;Xe++,Ye+=U)w.get(Xe,ve)===1&&ce.setRegion(Ye,Re,U,U);return ce}}Ia.QUIET_ZONE_SIZE=4;class hc{encode(u,d,m,b,w){let S;switch(d){case yt.QR_CODE:S=new Ia;break;default:throw new D("No encoder available for format "+d)}return S.encode(u,d,m,b,w)}}class vs extends Je{constructor(u,d,m,b,w,S,E,A){if(super(S,E),this.yuvData=u,this.dataWidth=d,this.dataHeight=m,this.left=b,this.top=w,b+S>d||w+E>m)throw new D("Crop rectangle does not fit within image data.");A&&this.reverseHorizontal(S,E)}getRow(u,d){if(u<0||u>=this.getHeight())throw new D("Requested row is outside the image: "+u);const m=this.getWidth();(d==null||d.length<m)&&(d=new Uint8ClampedArray(m));const b=(u+this.top)*this.dataWidth+this.left;return se.arraycopy(this.yuvData,b,d,0,m),d}getMatrix(){const u=this.getWidth(),d=this.getHeight();if(u===this.dataWidth&&d===this.dataHeight)return this.yuvData;const m=u*d,b=new Uint8ClampedArray(m);let w=this.top*this.dataWidth+this.left;if(u===this.dataWidth)return se.arraycopy(this.yuvData,w,b,0,m),b;for(let S=0;S<d;S++){const E=S*u;se.arraycopy(this.yuvData,w,b,E,u),w+=this.dataWidth}return b}isCropSupported(){return!0}crop(u,d,m,b){return new vs(this.yuvData,this.dataWidth,this.dataHeight,this.left+u,this.top+d,m,b,!1)}renderThumbnail(){const u=this.getWidth()/vs.THUMBNAIL_SCALE_FACTOR,d=this.getHeight()/vs.THUMBNAIL_SCALE_FACTOR,m=new Int32Array(u*d),b=this.yuvData;let w=this.top*this.dataWidth+this.left;for(let S=0;S<d;S++){const E=S*u;for(let A=0;A<u;A++){const G=b[w+A*vs.THUMBNAIL_SCALE_FACTOR]&255;m[E+A]=4278190080|G*65793}w+=this.dataWidth*vs.THUMBNAIL_SCALE_FACTOR}return m}getThumbnailWidth(){return this.getWidth()/vs.THUMBNAIL_SCALE_FACTOR}getThumbnailHeight(){return this.getHeight()/vs.THUMBNAIL_SCALE_FACTOR}reverseHorizontal(u,d){const m=this.yuvData;for(let b=0,w=this.top*this.dataWidth+this.left;b<d;b++,w+=this.dataWidth){const S=w+u/2;for(let E=w,A=w+u-1;E<S;E++,A--){const G=m[E];m[E]=m[A],m[A]=G}}}invert(){return new xt(this)}}vs.THUMBNAIL_SCALE_FACTOR=2;class Uo extends Je{constructor(u,d,m,b,w,S,E){if(super(d,m),this.dataWidth=b,this.dataHeight=w,this.left=S,this.top=E,u.BYTES_PER_ELEMENT===4){const A=d*m,G=new Uint8ClampedArray(A);for(let B=0;B<A;B++){const Z=u[B],U=Z>>16&255,ne=Z>>7&510,le=Z&255;G[B]=(U+ne+le)/4&255}this.luminances=G}else this.luminances=u;if(b===void 0&&(this.dataWidth=d),w===void 0&&(this.dataHeight=m),S===void 0&&(this.left=0),E===void 0&&(this.top=0),this.left+d>this.dataWidth||this.top+m>this.dataHeight)throw new D("Crop rectangle does not fit within image data.")}getRow(u,d){if(u<0||u>=this.getHeight())throw new D("Requested row is outside the image: "+u);const m=this.getWidth();(d==null||d.length<m)&&(d=new Uint8ClampedArray(m));const b=(u+this.top)*this.dataWidth+this.left;return se.arraycopy(this.luminances,b,d,0,m),d}getMatrix(){const u=this.getWidth(),d=this.getHeight();if(u===this.dataWidth&&d===this.dataHeight)return this.luminances;const m=u*d,b=new Uint8ClampedArray(m);let w=this.top*this.dataWidth+this.left;if(u===this.dataWidth)return se.arraycopy(this.luminances,w,b,0,m),b;for(let S=0;S<d;S++){const E=S*u;se.arraycopy(this.luminances,w,b,E,u),w+=this.dataWidth}return b}isCropSupported(){return!0}crop(u,d,m,b){return new Uo(this.luminances,m,b,this.dataWidth,this.dataHeight,this.left+u,this.top+d)}invert(){return new xt(this)}}class zl extends Ne{static forName(u){return this.getCharacterSetECIByName(u)}}class Ho{}Ho.ISO_8859_1=Ne.ISO8859_1;class Xl{isCompact(){return this.compact}setCompact(u){this.compact=u}getSize(){return this.size}setSize(u){this.size=u}getLayers(){return this.layers}setLayers(u){this.layers=u}getCodeWords(){return this.codeWords}setCodeWords(u){this.codeWords=u}getMatrix(){return this.matrix}setMatrix(u){this.matrix=u}}class dc{static singletonList(u){return[u]}static min(u,d){return u.sort(d)[0]}}class _h{constructor(u){this.previous=u}getPrevious(){return this.previous}}class Ca extends _h{constructor(u,d,m){super(u),this.value=d,this.bitCount=m}appendTo(u,d){u.appendBits(this.value,this.bitCount)}add(u,d){return new Ca(this,u,d)}addBinaryShift(u,d){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new Ca(this,u,d)}toString(){let u=this.value&(1<<this.bitCount)-1;return u|=1<<this.bitCount,"<"+j.toBinaryString(u|1<<this.bitCount).substring(1)+">"}}class Zl extends Ca{constructor(u,d,m){super(u,0,0),this.binaryShiftStart=d,this.binaryShiftByteCount=m}appendTo(u,d){for(let m=0;m<this.binaryShiftByteCount;m++)(m===0||m===31&&this.binaryShiftByteCount<=62)&&(u.appendBits(31,5),this.binaryShiftByteCount>62?u.appendBits(this.binaryShiftByteCount-31,16):m===0?u.appendBits(Math.min(this.binaryShiftByteCount,31),5):u.appendBits(this.binaryShiftByteCount-31,5)),u.appendBits(d[this.binaryShiftStart+m],8)}addBinaryShift(u,d){return new Zl(this,u,d)}toString(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"}}function T0(K,u,d){return new Zl(K,u,d)}function Kl(K,u,d){return new Ca(K,u,d)}const k0=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],Sa=0,fc=1,es=2,Vh=3,ri=4,pf=new Ca(null,0,0),Bh=[Int32Array.from([0,(5<<16)+28,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(9<<16)+480+14,0,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(4<<16)+14,(9<<16)+448+28,0,(9<<16)+448+29,932798]),Int32Array.from([(5<<16)+29,(5<<16)+28,656318,0,(5<<16)+30]),Int32Array.from([(5<<16)+31,656380,656382,656381,0])];function E0(K){for(let u of K)Y.fill(u,-1);return K[Sa][ri]=0,K[fc][ri]=0,K[fc][Sa]=28,K[Vh][ri]=0,K[es][ri]=0,K[es][Sa]=15,K}const mf=E0(Y.createInt32Array(6,6));class Is{constructor(u,d,m,b){this.token=u,this.mode=d,this.binaryShiftByteCount=m,this.bitCount=b}getMode(){return this.mode}getToken(){return this.token}getBinaryShiftByteCount(){return this.binaryShiftByteCount}getBitCount(){return this.bitCount}latchAndAppend(u,d){let m=this.bitCount,b=this.token;if(u!==this.mode){let S=Bh[this.mode][u];b=Kl(b,S&65535,S>>16),m+=S>>16}let w=u===es?4:5;return b=Kl(b,d,w),new Is(b,u,0,m+w)}shiftAndAppend(u,d){let m=this.token,b=this.mode===es?4:5;return m=Kl(m,mf[this.mode][u],b),m=Kl(m,d,5),new Is(m,this.mode,0,this.bitCount+b+5)}addBinaryShiftChar(u){let d=this.token,m=this.mode,b=this.bitCount;if(this.mode===ri||this.mode===es){let E=Bh[m][Sa];d=Kl(d,E&65535,E>>16),b+=E>>16,m=Sa}let w=this.binaryShiftByteCount===0||this.binaryShiftByteCount===31?18:this.binaryShiftByteCount===62?9:8,S=new Is(d,m,this.binaryShiftByteCount+1,b+w);return S.binaryShiftByteCount===2078&&(S=S.endBinaryShift(u+1)),S}endBinaryShift(u){if(this.binaryShiftByteCount===0)return this;let d=this.token;return d=T0(d,u-this.binaryShiftByteCount,this.binaryShiftByteCount),new Is(d,this.mode,0,this.bitCount)}isBetterThanOrEqualTo(u){let d=this.bitCount+(Bh[this.mode][u.mode]>>16);return this.binaryShiftByteCount<u.binaryShiftByteCount?d+=Is.calculateBinaryShiftCost(u)-Is.calculateBinaryShiftCost(this):this.binaryShiftByteCount>u.binaryShiftByteCount&&u.binaryShiftByteCount>0&&(d+=10),d<=u.bitCount}toBitArray(u){let d=[];for(let b=this.endBinaryShift(u.length).token;b!==null;b=b.getPrevious())d.unshift(b);let m=new fe;for(const b of d)b.appendTo(m,u);return m}toString(){return ht.format("%s bits=%d bytes=%d",k0[this.mode],this.bitCount,this.binaryShiftByteCount)}static calculateBinaryShiftCost(u){return u.binaryShiftByteCount>62?21:u.binaryShiftByteCount>31?20:u.binaryShiftByteCount>0?10:0}}Is.INITIAL_STATE=new Is(pf,Sa,0,0);function pc(K){const u=ht.getCharCode(" "),d=ht.getCharCode("."),m=ht.getCharCode(",");K[Sa][u]=1;const b=ht.getCharCode("Z"),w=ht.getCharCode("A");for(let U=w;U<=b;U++)K[Sa][U]=U-w+2;K[fc][u]=1;const S=ht.getCharCode("z"),E=ht.getCharCode("a");for(let U=E;U<=S;U++)K[fc][U]=U-E+2;K[es][u]=1;const A=ht.getCharCode("9"),G=ht.getCharCode("0");for(let U=G;U<=A;U++)K[es][U]=U-G+2;K[es][m]=12,K[es][d]=13;const B=["\0"," ","","","","","","","\x07","\b","	",`
`,"\v","\f","\r","\x1B","","","","","@","\\","^","_","`","|","~",""];for(let U=0;U<B.length;U++)K[Vh][ht.getCharCode(B[U])]=U;const Z=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(let U=0;U<Z.length;U++)ht.getCharCode(Z[U])>0&&(K[ri][ht.getCharCode(Z[U])]=U);return K}const jo=pc(Y.createInt32Array(5,256));class Ta{constructor(u){this.text=u}encode(){const u=ht.getCharCode(" "),d=ht.getCharCode(`
`);let m=dc.singletonList(Is.INITIAL_STATE);for(let w=0;w<this.text.length;w++){let S,E=w+1<this.text.length?this.text[w+1]:0;switch(this.text[w]){case ht.getCharCode("\r"):S=E===d?2:0;break;case ht.getCharCode("."):S=E===u?3:0;break;case ht.getCharCode(","):S=E===u?4:0;break;case ht.getCharCode(":"):S=E===u?5:0;break;default:S=0}S>0?(m=Ta.updateStateListForPair(m,w,S),w++):m=this.updateStateListForChar(m,w)}return dc.min(m,(w,S)=>w.getBitCount()-S.getBitCount()).toBitArray(this.text)}updateStateListForChar(u,d){const m=[];for(let b of u)this.updateStateForChar(b,d,m);return Ta.simplifyStates(m)}updateStateForChar(u,d,m){let b=this.text[d]&255,w=jo[u.getMode()][b]>0,S=null;for(let E=0;E<=ri;E++){let A=jo[E][b];if(A>0){if(S==null&&(S=u.endBinaryShift(d)),!w||E===u.getMode()||E===es){const G=S.latchAndAppend(E,A);m.push(G)}if(!w&&mf[u.getMode()][E]>=0){const G=S.shiftAndAppend(E,A);m.push(G)}}}if(u.getBinaryShiftByteCount()>0||jo[u.getMode()][b]===0){let E=u.addBinaryShiftChar(d);m.push(E)}}static updateStateListForPair(u,d,m){const b=[];for(let w of u)this.updateStateForPair(w,d,m,b);return this.simplifyStates(b)}static updateStateForPair(u,d,m,b){let w=u.endBinaryShift(d);if(b.push(w.latchAndAppend(ri,m)),u.getMode()!==ri&&b.push(w.shiftAndAppend(ri,m)),m===3||m===4){let S=w.latchAndAppend(es,16-m).latchAndAppend(es,1);b.push(S)}if(u.getBinaryShiftByteCount()>0){let S=u.addBinaryShiftChar(d).addBinaryShiftChar(d+1);b.push(S)}}static simplifyStates(u){let d=[];for(const m of u){let b=!0;for(const w of d){if(w.isBetterThanOrEqualTo(m)){b=!1;break}m.isBetterThanOrEqualTo(w)&&(d=d.filter(S=>S!==w))}b&&d.push(m)}return d}}class jt{constructor(){}static encodeBytes(u){return jt.encode(u,jt.DEFAULT_EC_PERCENT,jt.DEFAULT_AZTEC_LAYERS)}static encode(u,d,m){let b=new Ta(u).encode(),w=j.truncDivision(b.getSize()*d,100)+11,S=b.getSize()+w,E,A,G,B,Z;if(m!==jt.DEFAULT_AZTEC_LAYERS){if(E=m<0,A=Math.abs(m),A>(E?jt.MAX_NB_BITS_COMPACT:jt.MAX_NB_BITS))throw new D(ht.format("Illegal value %s for layers",m));G=jt.totalBitsInLayer(A,E),B=jt.WORD_SIZE[A];let Ke=G-G%B;if(Z=jt.stuffBits(b,B),Z.getSize()+w>Ke)throw new D("Data to large for user specified layer");if(E&&Z.getSize()>B*64)throw new D("Data to large for user specified layer")}else{B=0,Z=null;for(let Ke=0;;Ke++){if(Ke>jt.MAX_NB_BITS)throw new D("Data too large for an Aztec code");if(E=Ke<=3,A=E?Ke+1:Ke,G=jt.totalBitsInLayer(A,E),S>G)continue;(Z==null||B!==jt.WORD_SIZE[A])&&(B=jt.WORD_SIZE[A],Z=jt.stuffBits(b,B));let Kt=G-G%B;if(!(E&&Z.getSize()>B*64)&&Z.getSize()+w<=Kt)break}}let U=jt.generateCheckWords(Z,G,B),ne=Z.getSize()/B,le=jt.generateModeMessage(E,A,ne),ce=(E?11:14)+A*4,ve=new Int32Array(ce),Re;if(E){Re=ce;for(let Ke=0;Ke<ve.length;Ke++)ve[Ke]=Ke}else{Re=ce+1+2*j.truncDivision(j.truncDivision(ce,2)-1,15);let Ke=j.truncDivision(ce,2),Kt=j.truncDivision(Re,2);for(let At=0;At<Ke;At++){let Cs=At+j.truncDivision(At,15);ve[Ke-At-1]=Kt-Cs-1,ve[Ke+At]=Kt+Cs+1}}let Xe=new fn(Re);for(let Ke=0,Kt=0;Ke<A;Ke++){let At=(A-Ke)*4+(E?9:12);for(let Cs=0;Cs<At;Cs++){let vi=Cs*2;for(let hs=0;hs<2;hs++)U.get(Kt+vi+hs)&&Xe.set(ve[Ke*2+hs],ve[Ke*2+Cs]),U.get(Kt+At*2+vi+hs)&&Xe.set(ve[Ke*2+Cs],ve[ce-1-Ke*2-hs]),U.get(Kt+At*4+vi+hs)&&Xe.set(ve[ce-1-Ke*2-hs],ve[ce-1-Ke*2-Cs]),U.get(Kt+At*6+vi+hs)&&Xe.set(ve[ce-1-Ke*2-Cs],ve[Ke*2+hs])}Kt+=At*8}if(jt.drawModeMessage(Xe,E,Re,le),E)jt.drawBullsEye(Xe,j.truncDivision(Re,2),5);else{jt.drawBullsEye(Xe,j.truncDivision(Re,2),7);for(let Ke=0,Kt=0;Ke<j.truncDivision(ce,2)-1;Ke+=15,Kt+=16)for(let At=j.truncDivision(Re,2)&1;At<Re;At+=2)Xe.set(j.truncDivision(Re,2)-Kt,At),Xe.set(j.truncDivision(Re,2)+Kt,At),Xe.set(At,j.truncDivision(Re,2)-Kt),Xe.set(At,j.truncDivision(Re,2)+Kt)}let Ye=new Xl;return Ye.setCompact(E),Ye.setSize(Re),Ye.setLayers(A),Ye.setCodeWords(ne),Ye.setMatrix(Xe),Ye}static drawBullsEye(u,d,m){for(let b=0;b<m;b+=2)for(let w=d-b;w<=d+b;w++)u.set(w,d-b),u.set(w,d+b),u.set(d-b,w),u.set(d+b,w);u.set(d-m,d-m),u.set(d-m+1,d-m),u.set(d-m,d-m+1),u.set(d+m,d-m),u.set(d+m,d-m+1),u.set(d+m,d+m-1)}static generateModeMessage(u,d,m){let b=new fe;return u?(b.appendBits(d-1,2),b.appendBits(m-1,6),b=jt.generateCheckWords(b,28,4)):(b.appendBits(d-1,5),b.appendBits(m-1,11),b=jt.generateCheckWords(b,40,4)),b}static drawModeMessage(u,d,m,b){let w=j.truncDivision(m,2);if(d)for(let S=0;S<7;S++){let E=w-3+S;b.get(S)&&u.set(E,w-5),b.get(S+7)&&u.set(w+5,E),b.get(20-S)&&u.set(E,w+5),b.get(27-S)&&u.set(w-5,E)}else for(let S=0;S<10;S++){let E=w-5+S+j.truncDivision(S,5);b.get(S)&&u.set(E,w-7),b.get(S+10)&&u.set(w+7,E),b.get(29-S)&&u.set(E,w+7),b.get(39-S)&&u.set(w-7,E)}}static generateCheckWords(u,d,m){let b=u.getSize()/m,w=new $o(jt.getGF(m)),S=j.truncDivision(d,m),E=jt.bitsToWords(u,m,S);w.encode(E,S-b);let A=d%m,G=new fe;G.appendBits(0,A);for(const B of Array.from(E))G.appendBits(B,m);return G}static bitsToWords(u,d,m){let b=new Int32Array(m),w,S;for(w=0,S=u.getSize()/d;w<S;w++){let E=0;for(let A=0;A<d;A++)E|=u.get(w*d+A)?1<<d-A-1:0;b[w]=E}return b}static getGF(u){switch(u){case 4:return an.AZTEC_PARAM;case 6:return an.AZTEC_DATA_6;case 8:return an.AZTEC_DATA_8;case 10:return an.AZTEC_DATA_10;case 12:return an.AZTEC_DATA_12;default:throw new D("Unsupported word size "+u)}}static stuffBits(u,d){let m=new fe,b=u.getSize(),w=(1<<d)-2;for(let S=0;S<b;S+=d){let E=0;for(let A=0;A<d;A++)(S+A>=b||u.get(S+A))&&(E|=1<<d-1-A);(E&w)===w?(m.appendBits(E&w,d),S--):E&w?m.appendBits(E,d):(m.appendBits(E|1,d),S--)}return m}static totalBitsInLayer(u,d){return((d?88:112)+16*u)*u}}jt.DEFAULT_EC_PERCENT=33,jt.DEFAULT_AZTEC_LAYERS=0,jt.MAX_NB_BITS=32,jt.MAX_NB_BITS_COMPACT=4,jt.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class $l{encode(u,d,m,b){return this.encodeWithHints(u,d,m,b,null)}encodeWithHints(u,d,m,b,w){let S=Ho.ISO_8859_1,E=jt.DEFAULT_EC_PERCENT,A=jt.DEFAULT_AZTEC_LAYERS;return w!=null&&(w.has(ar.CHARACTER_SET)&&(S=zl.forName(w.get(ar.CHARACTER_SET).toString())),w.has(ar.ERROR_CORRECTION)&&(E=j.parseInt(w.get(ar.ERROR_CORRECTION).toString())),w.has(ar.AZTEC_LAYERS)&&(A=j.parseInt(w.get(ar.AZTEC_LAYERS).toString()))),$l.encodeLayers(u,d,m,b,S,E,A)}static encodeLayers(u,d,m,b,w,S,E){if(d!==yt.AZTEC)throw new D("Can only encode AZTEC, but got "+d);let A=jt.encode(ht.getBytes(u,w),S,E);return $l.renderResult(A,m,b)}static renderResult(u,d,m){let b=u.getMatrix();if(b==null)throw new Wi;let w=b.getWidth(),S=b.getHeight(),E=Math.max(d,w),A=Math.max(m,S),G=Math.min(E/w,A/S),B=(E-w*G)/2,Z=(A-S*G)/2,U=new fn(E,A);for(let ne=0,le=Z;ne<S;ne++,le+=G)for(let ce=0,ve=B;ce<w;ce++,ve+=G)b.get(ce,ne)&&U.setRegion(ve,le,G,G);return U}}l.AbstractExpandedDecoder=Vo,l.ArgumentException=V,l.ArithmeticException=wh,l.AztecCode=Xl,l.AztecCodeReader=Go,l.AztecCodeWriter=$l,l.AztecDecoder=Cn,l.AztecDetector=Ju,l.AztecDetectorResult=Qu,l.AztecEncoder=jt,l.AztecHighLevelEncoder=Ta,l.AztecPoint=Br,l.BarcodeFormat=yt,l.Binarizer=H,l.BinaryBitmap=$,l.BitArray=fe,l.BitMatrix=fn,l.BitSource=rc,l.BrowserAztecCodeReader=qu,l.BrowserBarcodeReader=hf,l.BrowserCodeReader=qs,l.BrowserDatamatrixCodeReader=Nh,l.BrowserMultiFormatReader=Fh,l.BrowserPDF417Reader=Gh,l.BrowserQRCodeReader=ff,l.BrowserQRCodeSvgWriter=wi,l.CharacterSetECI=Ne,l.ChecksumException=re,l.Code128Reader=et,l.Code39Reader=Un,l.DataMatrixDecodedBitStreamParser=ji,l.DataMatrixReader=xi,l.DecodeHintType=Fe,l.DecoderResult=Bi,l.DefaultGridSampler=vh,l.DetectorResult=Al,l.EAN13Reader=Xi,l.EncodeHintType=ar,l.Exception=O,l.FormatException=ue,l.GenericGF=an,l.GenericGFPoly=ls,l.GlobalHistogramBinarizer=kn,l.GridSampler=Fo,l.GridSamplerInstance=zi,l.HTMLCanvasElementLuminanceSource=We,l.HybridBinarizer=ut,l.ITFReader=on,l.IllegalArgumentException=D,l.IllegalStateException=Wi,l.InvertedLuminanceSource=xt,l.LuminanceSource=Je,l.MathUtils=Ht,l.MultiFormatOneDReader=Hi,l.MultiFormatReader=Bl,l.MultiFormatWriter=hc,l.NotFoundException=Pe,l.OneDReader=_n,l.PDF417DecodedBitStreamParser=Ae,l.PDF417DecoderErrorCorrection=oc,l.PDF417Reader=Tr,l.PDF417ResultMetadata=Mh,l.PerspectiveTransform=Yr,l.PlanarYUVLuminanceSource=vs,l.QRCodeByteMatrix=so,l.QRCodeDataMask=Jr,l.QRCodeDecodedBitStreamParser=Bn,l.QRCodeDecoderErrorCorrectionLevel=dn,l.QRCodeDecoderFormatInformation=fr,l.QRCodeEncoder=mn,l.QRCodeEncoderQRCode=bi,l.QRCodeMaskUtil=Mn,l.QRCodeMatrixUtil=kt,l.QRCodeMode=wt,l.QRCodeReader=yi,l.QRCodeVersion=bt,l.QRCodeWriter=Ia,l.RGBLuminanceSource=Uo,l.RSS14Reader=Vn,l.RSSExpandedReader=ze,l.ReaderException=ro,l.ReedSolomonDecoder=ke,l.ReedSolomonEncoder=$o,l.ReedSolomonException=Nl,l.Result=En,l.ResultMetadataType=bn,l.ResultPoint=gt,l.StringUtils=ht,l.UnsupportedOperationException=it,l.VideoInputDevice=yn,l.WhiteRectangleDetector=_s,l.WriterException=pn,l.ZXingArrays=Y,l.ZXingCharset=zl,l.ZXingInteger=j,l.ZXingStandardCharsets=Ho,l.ZXingStringBuilder=_t,l.ZXingStringEncoding=Bt,l.ZXingSystem=se,l.createAbstractExpandedDecoder=ec,Object.defineProperty(l,"__esModule",{value:!0})})})(Gw,Gw.exports);var or=Gw.exports;const ece=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var cM=function(){function r(a,l,p){if(this.formatMap=new Map([[ct.QR_CODE,or.BarcodeFormat.QR_CODE],[ct.AZTEC,or.BarcodeFormat.AZTEC],[ct.CODABAR,or.BarcodeFormat.CODABAR],[ct.CODE_39,or.BarcodeFormat.CODE_39],[ct.CODE_93,or.BarcodeFormat.CODE_93],[ct.CODE_128,or.BarcodeFormat.CODE_128],[ct.DATA_MATRIX,or.BarcodeFormat.DATA_MATRIX],[ct.MAXICODE,or.BarcodeFormat.MAXICODE],[ct.ITF,or.BarcodeFormat.ITF],[ct.EAN_13,or.BarcodeFormat.EAN_13],[ct.EAN_8,or.BarcodeFormat.EAN_8],[ct.PDF_417,or.BarcodeFormat.PDF_417],[ct.RSS_14,or.BarcodeFormat.RSS_14],[ct.RSS_EXPANDED,or.BarcodeFormat.RSS_EXPANDED],[ct.UPC_A,or.BarcodeFormat.UPC_A],[ct.UPC_E,or.BarcodeFormat.UPC_E],[ct.UPC_EAN_EXTENSION,or.BarcodeFormat.UPC_EAN_EXTENSION]]),this.reverseFormatMap=this.createReverseFormatMap(),!ece)throw"Use html5qrcode.min.js without edit, ZXing not found.";this.verbose=l,this.logger=p;var x=this.createZXingFormats(a),v=new Map;v.set(or.DecodeHintType.POSSIBLE_FORMATS,x),v.set(or.DecodeHintType.TRY_HARDER,!1),this.hints=v}return r.prototype.decodeAsync=function(a){var l=this;return new Promise(function(p,x){try{p(l.decode(a))}catch(v){x(v)}})},r.prototype.decode=function(a){var l=new or.MultiFormatReader(this.verbose,this.hints),p=new or.HTMLCanvasElementLuminanceSource(a),x=new or.BinaryBitmap(new or.HybridBinarizer(p)),v=l.decode(x);return{text:v.text,format:dO.create(this.toHtml5QrcodeSupportedFormats(v.format)),debugData:this.createDebugData()}},r.prototype.createReverseFormatMap=function(){var a=new Map;return this.formatMap.forEach(function(l,p,x){a.set(l,p)}),a},r.prototype.toHtml5QrcodeSupportedFormats=function(a){if(!this.reverseFormatMap.has(a))throw"reverseFormatMap doesn't have ".concat(a);return this.reverseFormatMap.get(a)},r.prototype.createZXingFormats=function(a){for(var l=[],p=0,x=a;p<x.length;p++){var v=x[p];this.formatMap.has(v)?l.push(this.formatMap.get(v)):this.logger.logError("".concat(v," is not supported by")+"ZXingHtml5QrcodeShim")}return l},r.prototype.createDebugData=function(){return{decoderName:"zxing-js"}},r}(),tce=function(r,a,l,p){function x(v){return v instanceof l?v:new l(function(T){T(v)})}return new(l||(l=Promise))(function(v,T){function M(V){try{O(p.next(V))}catch(D){T(D)}}function _(V){try{O(p.throw(V))}catch(D){T(D)}}function O(V){V.done?v(V.value):x(V.value).then(M,_)}O((p=p.apply(r,a||[])).next())})},nce=function(r,a){var l={label:0,sent:function(){if(v[0]&1)throw v[1];return v[1]},trys:[],ops:[]},p,x,v,T;return T={next:M(0),throw:M(1),return:M(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function M(O){return function(V){return _([O,V])}}function _(O){if(p)throw new TypeError("Generator is already executing.");for(;T&&(T=0,O[0]&&(l=0)),l;)try{if(p=1,x&&(v=O[0]&2?x.return:O[0]?x.throw||((v=x.return)&&v.call(x),0):x.next)&&!(v=v.call(x,O[1])).done)return v;switch(x=0,v&&(O=[O[0]&2,v.value]),O[0]){case 0:case 1:v=O;break;case 4:return l.label++,{value:O[1],done:!1};case 5:l.label++,x=O[1],O=[0];continue;case 7:O=l.ops.pop(),l.trys.pop();continue;default:if(v=l.trys,!(v=v.length>0&&v[v.length-1])&&(O[0]===6||O[0]===2)){l=0;continue}if(O[0]===3&&(!v||O[1]>v[0]&&O[1]<v[3])){l.label=O[1];break}if(O[0]===6&&l.label<v[1]){l.label=v[1],v=O;break}if(v&&l.label<v[2]){l.label=v[2],l.ops.push(O);break}v[2]&&l.ops.pop(),l.trys.pop();continue}O=a.call(r,l)}catch(V){O=[6,V],x=0}finally{p=v=0}if(O[0]&5)throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}},hM=function(){function r(a,l,p){if(this.formatMap=new Map([[ct.QR_CODE,"qr_code"],[ct.AZTEC,"aztec"],[ct.CODABAR,"codabar"],[ct.CODE_39,"code_39"],[ct.CODE_93,"code_93"],[ct.CODE_128,"code_128"],[ct.DATA_MATRIX,"data_matrix"],[ct.ITF,"itf"],[ct.EAN_13,"ean_13"],[ct.EAN_8,"ean_8"],[ct.PDF_417,"pdf417"],[ct.UPC_A,"upc_a"],[ct.UPC_E,"upc_e"]]),this.reverseFormatMap=this.createReverseFormatMap(),!r.isSupported())throw"Use html5qrcode.min.js without edit, Use BarcodeDetectorDelegate only if it isSupported();";this.verbose=l,this.logger=p;var x=this.createBarcodeDetectorFormats(a);if(this.detector=new BarcodeDetector(x),!this.detector)throw"BarcodeDetector detector not supported"}return r.isSupported=function(){if(!("BarcodeDetector"in window))return!1;var a=new BarcodeDetector({formats:["qr_code"]});return typeof a<"u"},r.prototype.decodeAsync=function(a){return tce(this,void 0,void 0,function(){var l,p;return nce(this,function(x){switch(x.label){case 0:return[4,this.detector.detect(a)];case 1:if(l=x.sent(),!l||l.length===0)throw"No barcode or QR code detected.";return p=this.selectLargestBarcode(l),[2,{text:p.rawValue,format:dO.create(this.toHtml5QrcodeSupportedFormats(p.format)),debugData:this.createDebugData()}]}})})},r.prototype.selectLargestBarcode=function(a){for(var l=null,p=0,x=0,v=a;x<v.length;x++){var T=v[x],M=T.boundingBox.width*T.boundingBox.height;M>p&&(p=M,l=T)}if(!l)throw"No largest barcode found";return l},r.prototype.createBarcodeDetectorFormats=function(a){for(var l=[],p=0,x=a;p<x.length;p++){var v=x[p];this.formatMap.has(v)?l.push(this.formatMap.get(v)):this.logger.warn("".concat(v," is not supported by")+"BarcodeDetectorDelegate")}return{formats:l}},r.prototype.toHtml5QrcodeSupportedFormats=function(a){if(!this.reverseFormatMap.has(a))throw"reverseFormatMap doesn't have ".concat(a);return this.reverseFormatMap.get(a)},r.prototype.createReverseFormatMap=function(){var a=new Map;return this.formatMap.forEach(function(l,p,x){a.set(l,p)}),a},r.prototype.createDebugData=function(){return{decoderName:"BarcodeDetector"}},r}(),dM=function(r,a,l,p){function x(v){return v instanceof l?v:new l(function(T){T(v)})}return new(l||(l=Promise))(function(v,T){function M(V){try{O(p.next(V))}catch(D){T(D)}}function _(V){try{O(p.throw(V))}catch(D){T(D)}}function O(V){V.done?v(V.value):x(V.value).then(M,_)}O((p=p.apply(r,a||[])).next())})},fM=function(r,a){var l={label:0,sent:function(){if(v[0]&1)throw v[1];return v[1]},trys:[],ops:[]},p,x,v,T;return T={next:M(0),throw:M(1),return:M(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function M(O){return function(V){return _([O,V])}}function _(O){if(p)throw new TypeError("Generator is already executing.");for(;T&&(T=0,O[0]&&(l=0)),l;)try{if(p=1,x&&(v=O[0]&2?x.return:O[0]?x.throw||((v=x.return)&&v.call(x),0):x.next)&&!(v=v.call(x,O[1])).done)return v;switch(x=0,v&&(O=[O[0]&2,v.value]),O[0]){case 0:case 1:v=O;break;case 4:return l.label++,{value:O[1],done:!1};case 5:l.label++,x=O[1],O=[0];continue;case 7:O=l.ops.pop(),l.trys.pop();continue;default:if(v=l.trys,!(v=v.length>0&&v[v.length-1])&&(O[0]===6||O[0]===2)){l=0;continue}if(O[0]===3&&(!v||O[1]>v[0]&&O[1]<v[3])){l.label=O[1];break}if(O[0]===6&&l.label<v[1]){l.label=v[1],v=O;break}if(v&&l.label<v[2]){l.label=v[2],l.ops.push(O);break}v[2]&&l.ops.pop(),l.trys.pop();continue}O=a.call(r,l)}catch(V){O=[6,V],x=0}finally{p=v=0}if(O[0]&5)throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}},rce=function(){function r(a,l,p,x){this.EXECUTIONS_TO_REPORT_PERFORMANCE=100,this.executions=0,this.executionResults=[],this.wasPrimaryDecoderUsedInLastDecode=!1,this.verbose=p,l&&hM.isSupported()?(this.primaryDecoder=new hM(a,p,x),this.secondaryDecoder=new cM(a,p,x)):this.primaryDecoder=new cM(a,p,x)}return r.prototype.decodeAsync=function(a){return dM(this,void 0,void 0,function(){var l;return fM(this,function(p){switch(p.label){case 0:l=performance.now(),p.label=1;case 1:return p.trys.push([1,,3,4]),[4,this.getDecoder().decodeAsync(a)];case 2:return[2,p.sent()];case 3:return this.possiblyLogPerformance(l),[7];case 4:return[2]}})})},r.prototype.decodeRobustlyAsync=function(a){return dM(this,void 0,void 0,function(){var l,p;return fM(this,function(x){switch(x.label){case 0:l=performance.now(),x.label=1;case 1:return x.trys.push([1,3,4,5]),[4,this.primaryDecoder.decodeAsync(a)];case 2:return[2,x.sent()];case 3:if(p=x.sent(),this.secondaryDecoder)return[2,this.secondaryDecoder.decodeAsync(a)];throw p;case 4:return this.possiblyLogPerformance(l),[7];case 5:return[2]}})})},r.prototype.getDecoder=function(){return this.secondaryDecoder?this.wasPrimaryDecoderUsedInLastDecode===!1?(this.wasPrimaryDecoderUsedInLastDecode=!0,this.primaryDecoder):(this.wasPrimaryDecoderUsedInLastDecode=!1,this.secondaryDecoder):this.primaryDecoder},r.prototype.possiblyLogPerformance=function(a){if(this.verbose){var l=performance.now()-a;this.executionResults.push(l),this.executions++,this.possiblyFlushPerformanceReport()}},r.prototype.possiblyFlushPerformanceReport=function(){if(!(this.executions<this.EXECUTIONS_TO_REPORT_PERFORMANCE)){for(var a=0,l=0,p=this.executionResults;l<p.length;l++){var x=p[l];a+=x}var v=a/this.executionResults.length;console.log("".concat(v," ms for ").concat(this.executionResults.length," last runs.")),this.executions=0,this.executionResults=[]}},r}(),iI=function(){var r=function(a,l){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,x){p.__proto__=x}||function(p,x){for(var v in x)Object.prototype.hasOwnProperty.call(x,v)&&(p[v]=x[v])},r(a,l)};return function(a,l){if(typeof l!="function"&&l!==null)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");r(a,l);function p(){this.constructor=a}a.prototype=l===null?Object.create(l):(p.prototype=l.prototype,new p)}}(),cg=function(r,a,l,p){function x(v){return v instanceof l?v:new l(function(T){T(v)})}return new(l||(l=Promise))(function(v,T){function M(V){try{O(p.next(V))}catch(D){T(D)}}function _(V){try{O(p.throw(V))}catch(D){T(D)}}function O(V){V.done?v(V.value):x(V.value).then(M,_)}O((p=p.apply(r,a||[])).next())})},hg=function(r,a){var l={label:0,sent:function(){if(v[0]&1)throw v[1];return v[1]},trys:[],ops:[]},p,x,v,T;return T={next:M(0),throw:M(1),return:M(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function M(O){return function(V){return _([O,V])}}function _(O){if(p)throw new TypeError("Generator is already executing.");for(;T&&(T=0,O[0]&&(l=0)),l;)try{if(p=1,x&&(v=O[0]&2?x.return:O[0]?x.throw||((v=x.return)&&v.call(x),0):x.next)&&!(v=v.call(x,O[1])).done)return v;switch(x=0,v&&(O=[O[0]&2,v.value]),O[0]){case 0:case 1:v=O;break;case 4:return l.label++,{value:O[1],done:!1};case 5:l.label++,x=O[1],O=[0];continue;case 7:O=l.ops.pop(),l.trys.pop();continue;default:if(v=l.trys,!(v=v.length>0&&v[v.length-1])&&(O[0]===6||O[0]===2)){l=0;continue}if(O[0]===3&&(!v||O[1]>v[0]&&O[1]<v[3])){l.label=O[1];break}if(O[0]===6&&l.label<v[1]){l.label=v[1],v=O;break}if(v&&l.label<v[2]){l.label=v[2],l.ops.push(O);break}v[2]&&l.ops.pop(),l.trys.pop();continue}O=a.call(r,l)}catch(V){O=[6,V],x=0}finally{p=v=0}if(O[0]&5)throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}},gO=function(){function r(a,l){this.name=a,this.track=l}return r.prototype.isSupported=function(){return this.track.getCapabilities?this.name in this.track.getCapabilities():!1},r.prototype.apply=function(a){var l={};l[this.name]=a;var p={advanced:[l]};return this.track.applyConstraints(p)},r.prototype.value=function(){var a=this.track.getSettings();if(this.name in a){var l=a[this.name];return l}return null},r}(),sce=function(r){iI(a,r);function a(l,p){return r.call(this,l,p)||this}return a.prototype.min=function(){return this.getCapabilities().min},a.prototype.max=function(){return this.getCapabilities().max},a.prototype.step=function(){return this.getCapabilities().step},a.prototype.apply=function(l){var p={};p[this.name]=l;var x={advanced:[p]};return this.track.applyConstraints(x)},a.prototype.getCapabilities=function(){this.failIfNotSupported();var l=this.track.getCapabilities(),p=l[this.name];return{min:p.min,max:p.max,step:p.step}},a.prototype.failIfNotSupported=function(){if(!this.isSupported())throw new Error("".concat(this.name," capability not supported"))},a}(gO),ice=function(r){iI(a,r);function a(l){return r.call(this,"zoom",l)||this}return a}(sce),ace=function(r){iI(a,r);function a(l){return r.call(this,"torch",l)||this}return a}(gO),oce=function(){function r(a){this.track=a}return r.prototype.zoomFeature=function(){return new ice(this.track)},r.prototype.torchFeature=function(){return new ace(this.track)},r}(),lce=function(){function r(a,l,p){this.isClosed=!1,this.parentElement=a,this.mediaStream=l,this.callbacks=p,this.surface=this.createVideoElement(this.parentElement.clientWidth),a.append(this.surface)}return r.prototype.createVideoElement=function(a){var l=document.createElement("video");return l.style.width="".concat(a,"px"),l.style.display="block",l.muted=!0,l.setAttribute("muted","true"),l.playsInline=!0,l},r.prototype.setupSurface=function(){var a=this;this.surface.onabort=function(){throw"RenderedCameraImpl video surface onabort() called"},this.surface.onerror=function(){throw"RenderedCameraImpl video surface onerror() called"};var l=function(){var p=a.surface.clientWidth,x=a.surface.clientHeight;a.callbacks.onRenderSurfaceReady(p,x),a.surface.removeEventListener("playing",l)};this.surface.addEventListener("playing",l),this.surface.srcObject=this.mediaStream,this.surface.play()},r.create=function(a,l,p,x){return cg(this,void 0,void 0,function(){var v,T;return hg(this,function(M){switch(M.label){case 0:return v=new r(a,l,x),p.aspectRatio?(T={aspectRatio:p.aspectRatio},[4,v.getFirstTrackOrFail().applyConstraints(T)]):[3,2];case 1:M.sent(),M.label=2;case 2:return v.setupSurface(),[2,v]}})})},r.prototype.failIfClosed=function(){if(this.isClosed)throw"The RenderedCamera has already been closed."},r.prototype.getFirstTrackOrFail=function(){if(this.failIfClosed(),this.mediaStream.getVideoTracks().length===0)throw"No video tracks found";return this.mediaStream.getVideoTracks()[0]},r.prototype.pause=function(){this.failIfClosed(),this.surface.pause()},r.prototype.resume=function(a){this.failIfClosed();var l=this,p=function(){setTimeout(a,200),l.surface.removeEventListener("playing",p)};this.surface.addEventListener("playing",p),this.surface.play()},r.prototype.isPaused=function(){return this.failIfClosed(),this.surface.paused},r.prototype.getSurface=function(){return this.failIfClosed(),this.surface},r.prototype.getRunningTrackCapabilities=function(){return this.getFirstTrackOrFail().getCapabilities()},r.prototype.getRunningTrackSettings=function(){return this.getFirstTrackOrFail().getSettings()},r.prototype.applyVideoConstraints=function(a){return cg(this,void 0,void 0,function(){return hg(this,function(l){if("aspectRatio"in a)throw"Changing 'aspectRatio' in run-time is not yet supported.";return[2,this.getFirstTrackOrFail().applyConstraints(a)]})})},r.prototype.close=function(){if(this.isClosed)return Promise.resolve();var a=this;return new Promise(function(l,p){var x=a.mediaStream.getVideoTracks(),v=x.length,T=0;a.mediaStream.getVideoTracks().forEach(function(M){a.mediaStream.removeTrack(M),M.stop(),++T,T>=v&&(a.isClosed=!0,a.parentElement.removeChild(a.surface),l())})})},r.prototype.getCapabilities=function(){return new oce(this.getFirstTrackOrFail())},r}(),uce=function(){function r(a){this.mediaStream=a}return r.prototype.render=function(a,l,p){return cg(this,void 0,void 0,function(){return hg(this,function(x){return[2,lce.create(a,this.mediaStream,l,p)]})})},r.create=function(a){return cg(this,void 0,void 0,function(){var l,p;return hg(this,function(x){switch(x.label){case 0:if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return l={audio:!1,video:a},[4,navigator.mediaDevices.getUserMedia(l)];case 1:return p=x.sent(),[2,new r(p)]}})})},r}(),pM=function(r,a,l,p){function x(v){return v instanceof l?v:new l(function(T){T(v)})}return new(l||(l=Promise))(function(v,T){function M(V){try{O(p.next(V))}catch(D){T(D)}}function _(V){try{O(p.throw(V))}catch(D){T(D)}}function O(V){V.done?v(V.value):x(V.value).then(M,_)}O((p=p.apply(r,a||[])).next())})},mM=function(r,a){var l={label:0,sent:function(){if(v[0]&1)throw v[1];return v[1]},trys:[],ops:[]},p,x,v,T;return T={next:M(0),throw:M(1),return:M(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function M(O){return function(V){return _([O,V])}}function _(O){if(p)throw new TypeError("Generator is already executing.");for(;T&&(T=0,O[0]&&(l=0)),l;)try{if(p=1,x&&(v=O[0]&2?x.return:O[0]?x.throw||((v=x.return)&&v.call(x),0):x.next)&&!(v=v.call(x,O[1])).done)return v;switch(x=0,v&&(O=[O[0]&2,v.value]),O[0]){case 0:case 1:v=O;break;case 4:return l.label++,{value:O[1],done:!1};case 5:l.label++,x=O[1],O=[0];continue;case 7:O=l.ops.pop(),l.trys.pop();continue;default:if(v=l.trys,!(v=v.length>0&&v[v.length-1])&&(O[0]===6||O[0]===2)){l=0;continue}if(O[0]===3&&(!v||O[1]>v[0]&&O[1]<v[3])){l.label=O[1];break}if(O[0]===6&&l.label<v[1]){l.label=v[1],v=O;break}if(v&&l.label<v[2]){l.label=v[2],l.ops.push(O);break}v[2]&&l.ops.pop(),l.trys.pop();continue}O=a.call(r,l)}catch(V){O=[6,V],x=0}finally{p=v=0}if(O[0]&5)throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}},cce=function(){function r(){}return r.failIfNotSupported=function(){return pM(this,void 0,void 0,function(){return mM(this,function(a){if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return[2,new r]})})},r.prototype.create=function(a){return pM(this,void 0,void 0,function(){return mM(this,function(l){return[2,uce.create(a)]})})},r}(),hce=function(r,a,l,p){function x(v){return v instanceof l?v:new l(function(T){T(v)})}return new(l||(l=Promise))(function(v,T){function M(V){try{O(p.next(V))}catch(D){T(D)}}function _(V){try{O(p.throw(V))}catch(D){T(D)}}function O(V){V.done?v(V.value):x(V.value).then(M,_)}O((p=p.apply(r,a||[])).next())})},dce=function(r,a){var l={label:0,sent:function(){if(v[0]&1)throw v[1];return v[1]},trys:[],ops:[]},p,x,v,T;return T={next:M(0),throw:M(1),return:M(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function M(O){return function(V){return _([O,V])}}function _(O){if(p)throw new TypeError("Generator is already executing.");for(;T&&(T=0,O[0]&&(l=0)),l;)try{if(p=1,x&&(v=O[0]&2?x.return:O[0]?x.throw||((v=x.return)&&v.call(x),0):x.next)&&!(v=v.call(x,O[1])).done)return v;switch(x=0,v&&(O=[O[0]&2,v.value]),O[0]){case 0:case 1:v=O;break;case 4:return l.label++,{value:O[1],done:!1};case 5:l.label++,x=O[1],O=[0];continue;case 7:O=l.ops.pop(),l.trys.pop();continue;default:if(v=l.trys,!(v=v.length>0&&v[v.length-1])&&(O[0]===6||O[0]===2)){l=0;continue}if(O[0]===3&&(!v||O[1]>v[0]&&O[1]<v[3])){l.label=O[1];break}if(O[0]===6&&l.label<v[1]){l.label=v[1],v=O;break}if(v&&l.label<v[2]){l.label=v[2],l.ops.push(O);break}v[2]&&l.ops.pop(),l.trys.pop();continue}O=a.call(r,l)}catch(V){O=[6,V],x=0}finally{p=v=0}if(O[0]&5)throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}},fce=function(){function r(){}return r.retrieve=function(){if(navigator.mediaDevices)return r.getCamerasFromMediaDevices();var a=MediaStreamTrack;return MediaStreamTrack&&a.getSources?r.getCamerasFromMediaStreamTrack():r.rejectWithError()},r.rejectWithError=function(){var a=Gd.unableToQuerySupportedDevices();return r.isHttpsOrLocalhost()||(a=Gd.insecureContextCameraQueryError()),Promise.reject(a)},r.isHttpsOrLocalhost=function(){if(location.protocol==="https:")return!0;var a=location.host.split(":")[0];return a==="127.0.0.1"||a==="localhost"},r.getCamerasFromMediaDevices=function(){return hce(this,void 0,void 0,function(){var a,l,p,x,v,T,M;return dce(this,function(_){switch(_.label){case 0:return a=function(O){for(var V=O.getVideoTracks(),D=0,$=V;D<$.length;D++){var re=$[D];re.enabled=!1,re.stop(),O.removeTrack(re)}},[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 1:return l=_.sent(),[4,navigator.mediaDevices.enumerateDevices()];case 2:for(p=_.sent(),x=[],v=0,T=p;v<T.length;v++)M=T[v],M.kind==="videoinput"&&x.push({id:M.deviceId,label:M.label});return a(l),[2,x]}})})},r.getCamerasFromMediaStreamTrack=function(){return new Promise(function(a,l){var p=function(v){for(var T=[],M=0,_=v;M<_.length;M++){var O=_[M];O.kind==="video"&&T.push({id:O.id,label:O.label})}a(T)},x=MediaStreamTrack;x.getSources(p)})},r}(),vr;(function(r){r[r.UNKNOWN=0]="UNKNOWN",r[r.NOT_STARTED=1]="NOT_STARTED",r[r.SCANNING=2]="SCANNING",r[r.PAUSED=3]="PAUSED"})(vr||(vr={}));var pce=function(){function r(){this.state=vr.NOT_STARTED,this.onGoingTransactionNewState=vr.UNKNOWN}return r.prototype.directTransition=function(a){this.failIfTransitionOngoing(),this.validateTransition(a),this.state=a},r.prototype.startTransition=function(a){return this.failIfTransitionOngoing(),this.validateTransition(a),this.onGoingTransactionNewState=a,this},r.prototype.execute=function(){if(this.onGoingTransactionNewState===vr.UNKNOWN)throw"Transaction is already cancelled, cannot execute().";var a=this.onGoingTransactionNewState;this.onGoingTransactionNewState=vr.UNKNOWN,this.directTransition(a)},r.prototype.cancel=function(){if(this.onGoingTransactionNewState===vr.UNKNOWN)throw"Transaction is already cancelled, cannot cancel().";this.onGoingTransactionNewState=vr.UNKNOWN},r.prototype.getState=function(){return this.state},r.prototype.failIfTransitionOngoing=function(){if(this.onGoingTransactionNewState!==vr.UNKNOWN)throw"Cannot transition to a new state, already under transition"},r.prototype.validateTransition=function(a){switch(this.state){case vr.UNKNOWN:throw"Transition from unknown is not allowed";case vr.NOT_STARTED:this.failIfNewStateIs(a,[vr.PAUSED]);break;case vr.SCANNING:break;case vr.PAUSED:break}},r.prototype.failIfNewStateIs=function(a,l){for(var p=0,x=l;p<x.length;p++){var v=x[p];if(a===v)throw"Cannot transition from ".concat(this.state," to ").concat(a)}},r}(),mce=function(){function r(a){this.stateManager=a}return r.prototype.startTransition=function(a){return this.stateManager.startTransition(a)},r.prototype.directTransition=function(a){this.stateManager.directTransition(a)},r.prototype.getState=function(){return this.stateManager.getState()},r.prototype.canScanFile=function(){return this.stateManager.getState()===vr.NOT_STARTED},r.prototype.isScanning=function(){return this.stateManager.getState()!==vr.NOT_STARTED},r.prototype.isStrictlyScanning=function(){return this.stateManager.getState()===vr.SCANNING},r.prototype.isPaused=function(){return this.stateManager.getState()===vr.PAUSED},r}(),gce=function(){function r(){}return r.create=function(){return new mce(new pce)},r}(),xce=function(){var r=function(a,l){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,x){p.__proto__=x}||function(p,x){for(var v in x)Object.prototype.hasOwnProperty.call(x,v)&&(p[v]=x[v])},r(a,l)};return function(a,l){if(typeof l!="function"&&l!==null)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");r(a,l);function p(){this.constructor=a}a.prototype=l===null?Object.create(l):(p.prototype=l.prototype,new p)}}(),Ri=function(r){xce(a,r);function a(){return r!==null&&r.apply(this,arguments)||this}return a.DEFAULT_WIDTH=300,a.DEFAULT_WIDTH_OFFSET=2,a.FILE_SCAN_MIN_HEIGHT=300,a.FILE_SCAN_HIDDEN_CANVAS_PADDING=100,a.MIN_QR_BOX_SIZE=50,a.SHADED_LEFT=1,a.SHADED_RIGHT=2,a.SHADED_TOP=3,a.SHADED_BOTTOM=4,a.SHADED_REGION_ELEMENT_ID="qr-shaded-region",a.VERBOSE=!1,a.BORDER_SHADER_DEFAULT_COLOR="#ffffff",a.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",a}(Za),yce=function(){function r(a,l){this.logger=l,this.fps=Ri.SCAN_DEFAULT_FPS,a?(a.fps&&(this.fps=a.fps),this.disableFlip=a.disableFlip===!0,this.qrbox=a.qrbox,this.aspectRatio=a.aspectRatio,this.videoConstraints=a.videoConstraints):this.disableFlip=Ri.DEFAULT_DISABLE_FLIP}return r.prototype.isMediaStreamConstraintsValid=function(){return this.videoConstraints?mO.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)},r.prototype.isShadedBoxEnabled=function(){return!ko(this.qrbox)},r.create=function(a,l){return new r(a,l)},r}(),gM=function(){function r(a,l){if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.renderedCamera=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(a))throw"HTML Element with id=".concat(a," not found");this.elementId=a,this.verbose=!1;var p;typeof l=="boolean"?this.verbose=l===!0:l&&(p=l,this.verbose=p.verbose===!0,p.experimentalFeatures),this.logger=new pO(this.verbose),this.qrcode=new rce(this.getSupportedFormats(l),this.getUseBarCodeDetectorIfSupported(p),this.verbose,this.logger),this.foreverScanTimeout,this.shouldScan=!0,this.stateManagerProxy=gce.create()}return r.prototype.start=function(a,l,p,x){var v=this;if(!a)throw"cameraIdOrConfig is required";if(!p||typeof p!="function")throw"qrCodeSuccessCallback is required and should be a function.";var T;x?T=x:T=this.verbose?this.logger.log:function(){};var M=yce.create(l,this.logger);this.clearElement();var _=!1;M.videoConstraints&&(M.isMediaStreamConstraintsValid()?_=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));var O=_,V=document.getElementById(this.elementId);V.clientWidth?V.clientWidth:Ri.DEFAULT_WIDTH,V.style.position="relative",this.shouldScan=!0,this.element=V;var D=this,$=this.stateManagerProxy.startTransition(vr.SCANNING);return new Promise(function(re,H){var se=O?M.videoConstraints:D.createVideoConstraints(a);if(!se){$.cancel(),H("videoConstraints should be defined");return}var Ee={};(!O||M.aspectRatio)&&(Ee.aspectRatio=M.aspectRatio);var ee={onRenderSurfaceReady:function(Y,j){D.setupUi(Y,j,M),D.isScanning=!0,D.foreverScan(M,p,T)}};cce.failIfNotSupported().then(function(Y){Y.create(se).then(function(j){return j.render(v.element,Ee,ee).then(function(fe){D.renderedCamera=fe,$.execute(),re(null)}).catch(function(fe){$.cancel(),H(fe)})}).catch(function(j){$.cancel(),H(Gd.errorGettingUserMedia(j))})}).catch(function(Y){$.cancel(),H(Gd.cameraStreamingNotSupported())})})},r.prototype.pause=function(a){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition(vr.PAUSED),this.showPausedState(),(ko(a)||a!==!0)&&(a=!1),a&&this.renderedCamera&&this.renderedCamera.pause()},r.prototype.resume=function(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.renderedCamera)throw"renderedCamera doesn't exist while trying resume()";var a=this,l=function(){a.stateManagerProxy.directTransition(vr.SCANNING),a.hidePausedState()};if(!this.renderedCamera.isPaused()){l();return}this.renderedCamera.resume(function(){l()})},r.prototype.getState=function(){return this.stateManagerProxy.getState()},r.prototype.stop=function(){var a=this;if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";var l=this.stateManagerProxy.startTransition(vr.NOT_STARTED);this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout);var p=function(){if(a.element){var v=document.getElementById(Ri.SHADED_REGION_ELEMENT_ID);v&&a.element.removeChild(v)}},x=this;return this.renderedCamera.close().then(function(){return x.renderedCamera=null,x.element&&(x.element.removeChild(x.canvasElement),x.canvasElement=null),p(),x.qrRegion&&(x.qrRegion=null),x.context&&(x.context=null),l.execute(),x.hidePausedState(),x.isScanning=!1,Promise.resolve()})},r.prototype.scanFile=function(a,l){return this.scanFileV2(a,l).then(function(p){return p.decodedText})},r.prototype.scanFileV2=function(a,l){var p=this;if(!a||!(a instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if(ko(l)&&(l=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise(function(x,v){p.possiblyCloseLastScanImageFile(),p.clearElement(),p.lastScanImageFile=URL.createObjectURL(a);var T=new Image;T.onload=function(){var M=T.width,_=T.height,O=document.getElementById(p.elementId),V=O.clientWidth?O.clientWidth:Ri.DEFAULT_WIDTH,D=Math.max(O.clientHeight?O.clientHeight:_,Ri.FILE_SCAN_MIN_HEIGHT),$=p.computeCanvasDrawConfig(M,_,V,D);if(l){var re=p.createCanvasElement(V,D,"qr-canvas-visible");re.style.display="inline-block",O.appendChild(re);var H=re.getContext("2d");if(!H)throw"Unable to get 2d context from canvas";H.canvas.width=V,H.canvas.height=D,H.drawImage(T,0,0,M,_,$.x,$.y,$.width,$.height)}var se=Ri.FILE_SCAN_HIDDEN_CANVAS_PADDING,Ee=Math.max(T.width,$.width),ee=Math.max(T.height,$.height),Y=Ee+2*se,j=ee+2*se,fe=p.createCanvasElement(Y,j);O.appendChild(fe);var be=fe.getContext("2d");if(!be)throw"Unable to get 2d context from canvas";be.canvas.width=Y,be.canvas.height=j,be.drawImage(T,0,0,M,_,se,se,Ee,ee);try{p.qrcode.decodeRobustlyAsync(fe).then(function(Fe){x(lM.createFromQrcodeResult(Fe))}).catch(v)}catch(Fe){v("QR code parse error, error = ".concat(Fe))}},T.onerror=v,T.onabort=v,T.onstalled=v,T.onsuspend=v,T.src=URL.createObjectURL(a)})},r.prototype.clear=function(){this.clearElement()},r.getCameras=function(){return fce.retrieve()},r.prototype.getRunningTrackCapabilities=function(){return this.getRenderedCameraOrFail().getRunningTrackCapabilities()},r.prototype.getRunningTrackSettings=function(){return this.getRenderedCameraOrFail().getRunningTrackSettings()},r.prototype.getRunningTrackCameraCapabilities=function(){return this.getRenderedCameraOrFail().getCapabilities()},r.prototype.applyVideoConstraints=function(a){if(a){if(!mO.isMediaStreamConstraintsValid(a,this.logger))throw"invalid videoConstaints passed, check logs for more details"}else throw"videoConstaints is required argument.";return this.getRenderedCameraOrFail().applyVideoConstraints(a)},r.prototype.getRenderedCameraOrFail=function(){if(this.renderedCamera==null)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";return this.renderedCamera},r.prototype.getSupportedFormats=function(a){var l=[ct.QR_CODE,ct.AZTEC,ct.CODABAR,ct.CODE_39,ct.CODE_93,ct.CODE_128,ct.DATA_MATRIX,ct.MAXICODE,ct.ITF,ct.EAN_13,ct.EAN_8,ct.PDF_417,ct.RSS_14,ct.RSS_EXPANDED,ct.UPC_A,ct.UPC_E,ct.UPC_EAN_EXTENSION];if(!a||typeof a=="boolean"||!a.formatsToSupport)return l;if(!Array.isArray(a.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(a.formatsToSupport.length===0)throw"Atleast 1 formatsToSupport is needed.";for(var p=[],x=0,v=a.formatsToSupport;x<v.length;x++){var T=v[x];Jue(T)?p.push(T):this.logger.warn("Invalid format: ".concat(T," passed in config, ignoring."))}if(p.length===0)throw"None of formatsToSupport match supported values.";return p},r.prototype.getUseBarCodeDetectorIfSupported=function(a){if(ko(a))return!0;if(!ko(a.useBarCodeDetectorIfSupported))return a.useBarCodeDetectorIfSupported!==!1;if(ko(a.experimentalFeatures))return!0;var l=a.experimentalFeatures;return ko(l.useBarCodeDetectorIfSupported)?!0:l.useBarCodeDetectorIfSupported!==!1},r.prototype.validateQrboxSize=function(a,l,p){var x=this,v=p.qrbox;this.validateQrboxConfig(v);var T=this.toQrdimensions(a,l,v),M=function(O){if(O<Ri.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' dimension value is"+" ".concat(Ri.MIN_QR_BOX_SIZE,"px.")},_=function(O){return O>a&&(x.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),O=a),O};M(T.width),M(T.height),T.width=_(T.width)},r.prototype.validateQrboxConfig=function(a){if(typeof a!="number"&&typeof a!="function"&&(a.width===void 0||a.height===void 0))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."},r.prototype.toQrdimensions=function(a,l,p){if(typeof p=="number")return{width:p,height:p};if(typeof p=="function")try{return p(a,l)}catch(x){throw new Error("qrbox config was passed as a function but it failed with unknown error"+x)}return p},r.prototype.setupUi=function(a,l,p){p.isShadedBoxEnabled()&&this.validateQrboxSize(a,l,p);var x=ko(p.qrbox)?{width:a,height:l}:p.qrbox;this.validateQrboxConfig(x);var v=this.toQrdimensions(a,l,x);v.height>l&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");var T=p.isShadedBoxEnabled()&&v.height<=l,M={x:0,y:0,width:a,height:l},_=T?this.getShadedRegionBounds(a,l,v):M,O=this.createCanvasElement(_.width,_.height),V={willReadFrequently:!0},D=O.getContext("2d",V);D.canvas.width=_.width,D.canvas.height=_.height,this.element.append(O),T&&this.possiblyInsertShadingElement(this.element,a,l,v),this.createScannerPausedUiElement(this.element),this.qrRegion=_,this.context=D,this.canvasElement=O},r.prototype.createScannerPausedUiElement=function(a){var l=document.createElement("div");l.innerText=Gd.scannerPaused(),l.style.display="none",l.style.position="absolute",l.style.top="0px",l.style.zIndex="1",l.style.background="rgba(9, 9, 9, 0.46)",l.style.color="#FFECEC",l.style.textAlign="center",l.style.width="100%",a.appendChild(l),this.scannerPausedUiElement=l},r.prototype.scanContext=function(a,l){var p=this;return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then(function(x){return a(x.text,lM.createFromQrcodeResult(x)),p.possiblyUpdateShaders(!0),!0}).catch(function(x){p.possiblyUpdateShaders(!1);var v=Gd.codeParseError(x);return l(v,fO.createFrom(v)),!1})},r.prototype.foreverScan=function(a,l,p){var x=this;if(this.shouldScan&&this.renderedCamera){var v=this.renderedCamera.getSurface(),T=v.videoWidth/v.clientWidth,M=v.videoHeight/v.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";var _=this.qrRegion.width*T,O=this.qrRegion.height*M,V=this.qrRegion.x*T,D=this.qrRegion.y*M;this.context.drawImage(v,V,D,_,O,0,0,this.qrRegion.width,this.qrRegion.height);var $=function(){x.foreverScanTimeout=setTimeout(function(){x.foreverScan(a,l,p)},x.getTimeoutFps(a.fps))};this.scanContext(l,p).then(function(re){!re&&a.disableFlip!==!0?(x.context.translate(x.context.canvas.width,0),x.context.scale(-1,1),x.scanContext(l,p).finally(function(){$()})):$()}).catch(function(re){x.logger.logError("Error happend while scanning context",re),$()})}},r.prototype.createVideoConstraints=function(a){if(typeof a=="string")return{deviceId:{exact:a}};if(typeof a=="object"){var l="facingMode",p="deviceId",x={user:!0,environment:!0},v="exact",T=function(H){if(H in x)return!0;throw"config has invalid 'facingMode' value = "+"'".concat(H,"'")},M=Object.keys(a);if(M.length!==1)throw"'cameraIdOrConfig' object should have exactly 1 key,"+" if passed as an object, found ".concat(M.length," keys");var _=Object.keys(a)[0];if(_!==l&&_!==p)throw"Only '".concat(l,"' and '").concat(p,"' ")+" are supported for 'cameraIdOrConfig'";if(_===l){var O=a.facingMode;if(typeof O=="string"){if(T(O))return{facingMode:O}}else if(typeof O=="object")if(v in O){if(T(O["".concat(v)]))return{facingMode:{exact:O["".concat(v)]}}}else throw"'facingMode' should be string or object with"+" ".concat(v," as key.");else{var V=typeof O;throw"Invalid type of 'facingMode' = ".concat(V)}}else{var D=a.deviceId;if(typeof D=="string")return{deviceId:D};if(typeof D=="object"){if(v in D)return{deviceId:{exact:D["".concat(v)]}};throw"'deviceId' should be string or object with"+" ".concat(v," as key.")}else{var $=typeof D;throw"Invalid type of 'deviceId' = ".concat($)}}}var re=typeof a;throw"Invalid type of 'cameraIdOrConfig' = ".concat(re)},r.prototype.computeCanvasDrawConfig=function(a,l,p,x){if(a<=p&&l<=x){var v=(p-a)/2,T=(x-l)/2;return{x:v,y:T,width:a,height:l}}else{var M=a,_=l;return a>p&&(l=p/a*l,a=p),l>x&&(a=x/l*a,l=x),this.logger.log("Image downsampled from "+"".concat(M,"X").concat(_)+" to ".concat(a,"X").concat(l,".")),this.computeCanvasDrawConfig(a,l,p,x)}},r.prototype.clearElement=function(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";var a=document.getElementById(this.elementId);a&&(a.innerHTML="")},r.prototype.possiblyUpdateShaders=function(a){this.qrMatch!==a&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach(function(l){l.style.backgroundColor=a?Ri.BORDER_SHADER_MATCH_COLOR:Ri.BORDER_SHADER_DEFAULT_COLOR}),this.qrMatch=a)},r.prototype.possiblyCloseLastScanImageFile=function(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)},r.prototype.createCanvasElement=function(a,l,p){var x=a,v=l,T=document.createElement("canvas");return T.style.width="".concat(x,"px"),T.style.height="".concat(v,"px"),T.style.display="none",T.id=ko(p)?"qr-canvas":p,T},r.prototype.getShadedRegionBounds=function(a,l,p){if(p.width>a||p.height>l)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(a-p.width)/2,y:(l-p.height)/2,width:p.width,height:p.height}},r.prototype.possiblyInsertShadingElement=function(a,l,p,x){if(!(l-x.width<1||p-x.height<1)){var v=document.createElement("div");v.style.position="absolute";var T=(l-x.width)/2,M=(p-x.height)/2;if(v.style.borderLeft="".concat(T,"px solid rgba(0, 0, 0, 0.48)"),v.style.borderRight="".concat(T,"px solid rgba(0, 0, 0, 0.48)"),v.style.borderTop="".concat(M,"px solid rgba(0, 0, 0, 0.48)"),v.style.borderBottom="".concat(M,"px solid rgba(0, 0, 0, 0.48)"),v.style.boxSizing="border-box",v.style.top="0px",v.style.bottom="0px",v.style.left="0px",v.style.right="0px",v.id="".concat(Ri.SHADED_REGION_ELEMENT_ID),l-x.width<11||p-x.height<11)this.hasBorderShaders=!1;else{var _=5,O=40;this.insertShaderBorders(v,O,_,-_,null,0,!0),this.insertShaderBorders(v,O,_,-_,null,0,!1),this.insertShaderBorders(v,O,_,null,-_,0,!0),this.insertShaderBorders(v,O,_,null,-_,0,!1),this.insertShaderBorders(v,_,O+_,-_,null,-_,!0),this.insertShaderBorders(v,_,O+_,null,-_,-_,!0),this.insertShaderBorders(v,_,O+_,-_,null,-_,!1),this.insertShaderBorders(v,_,O+_,null,-_,-_,!1),this.hasBorderShaders=!0}a.append(v)}},r.prototype.insertShaderBorders=function(a,l,p,x,v,T,M){var _=document.createElement("div");_.style.position="absolute",_.style.backgroundColor=Ri.BORDER_SHADER_DEFAULT_COLOR,_.style.width="".concat(l,"px"),_.style.height="".concat(p,"px"),x!==null&&(_.style.top="".concat(x,"px")),v!==null&&(_.style.bottom="".concat(v,"px")),M?_.style.left="".concat(T,"px"):_.style.right="".concat(T,"px"),this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(_),a.appendChild(_)},r.prototype.showPausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"},r.prototype.hidePausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"},r.prototype.getTimeoutFps=function(a){return 1e3/a},r}(),aI="data:image/svg+xml;base64,",bce=aI+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzNzEuNjQzIDM3MS42NDMiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDM3MS42NDMgMzcxLjY0MyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PHBhdGggZD0iTTEwNS4wODQgMzguMjcxaDE2My43Njh2MjBIMTA1LjA4NHoiLz48cGF0aCBkPSJNMzExLjU5NiAxOTAuMTg5Yy03LjQ0MS05LjM0Ny0xOC40MDMtMTYuMjA2LTMyLjc0My0yMC41MjJWMzBjMC0xNi41NDItMTMuNDU4LTMwLTMwLTMwSDEyNS4wODRjLTE2LjU0MiAwLTMwIDEzLjQ1OC0zMCAzMHYxMjAuMTQzaC04LjI5NmMtMTYuNTQyIDAtMzAgMTMuNDU4LTMwIDMwdjEuMzMzYTI5LjgwNCAyOS44MDQgMCAwIDAgNC42MDMgMTUuOTM5Yy03LjM0IDUuNDc0LTEyLjEwMyAxNC4yMjEtMTIuMTAzIDI0LjA2MXYxLjMzM2MwIDkuODQgNC43NjMgMTguNTg3IDEyLjEwMyAyNC4wNjJhMjkuODEgMjkuODEgMCAwIDAtNC42MDMgMTUuOTM4djEuMzMzYzAgMTYuNTQyIDEzLjQ1OCAzMCAzMCAzMGg4LjMyNGMuNDI3IDExLjYzMSA3LjUwMyAyMS41ODcgMTcuNTM0IDI2LjE3Ny45MzEgMTAuNTAzIDQuMDg0IDMwLjE4NyAxNC43NjggNDUuNTM3YTkuOTg4IDkuOTg4IDAgMCAwIDguMjE2IDQuMjg4IDkuOTU4IDkuOTU4IDAgMCAwIDUuNzA0LTEuNzkzYzQuNTMzLTMuMTU1IDUuNjUtOS4zODggMi40OTUtMTMuOTIxLTYuNzk4LTkuNzY3LTkuNjAyLTIyLjYwOC0xMC43Ni0zMS40aDgyLjY4NWMuMjcyLjQxNC41NDUuODE4LjgxNSAxLjIxIDMuMTQyIDQuNTQxIDkuMzcyIDUuNjc5IDEzLjkxMyAyLjUzNCA0LjU0Mi0zLjE0MiA1LjY3Ny05LjM3MSAyLjUzNS0xMy45MTMtMTEuOTE5LTE3LjIyOS04Ljc4Ny0zNS44ODQgOS41ODEtNTcuMDEyIDMuMDY3LTIuNjUyIDEyLjMwNy0xMS43MzIgMTEuMjE3LTI0LjAzMy0uODI4LTkuMzQzLTcuMTA5LTE3LjE5NC0xOC42NjktMjMuMzM3YTkuODU3IDkuODU3IDAgMCAwLTEuMDYxLS40ODZjLS40NjYtLjE4Mi0xMS40MDMtNC41NzktOS43NDEtMTUuNzA2IDEuMDA3LTYuNzM3IDE0Ljc2OC04LjI3MyAyMy43NjYtNy42NjYgMjMuMTU2IDEuNTY5IDM5LjY5OCA3LjgwMyA0Ny44MzYgMTguMDI2IDUuNzUyIDcuMjI1IDcuNjA3IDE2LjYyMyA1LjY3MyAyOC43MzMtLjQxMyAyLjU4NS0uODI0IDUuMjQxLTEuMjQ1IDcuOTU5LTUuNzU2IDM3LjE5NC0xMi45MTkgODMuNDgzLTQ5Ljg3IDExNC42NjEtNC4yMjEgMy41NjEtNC43NTYgOS44Ny0xLjE5NCAxNC4wOTJhOS45OCA5Ljk4IDAgMCAwIDcuNjQ4IDMuNTUxIDkuOTU1IDkuOTU1IDAgMCAwIDYuNDQ0LTIuMzU4YzQyLjY3Mi0zNi4wMDUgNTAuODAyLTg4LjUzMyA1Ni43MzctMTI2Ljg4OC40MTUtMi42ODQuODIxLTUuMzA5IDEuMjI5LTcuODYzIDIuODM0LTE3LjcyMS0uNDU1LTMyLjY0MS05Ljc3Mi00NC4zNDV6bS0yMzIuMzA4IDQyLjYyYy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi0xLjMzM2MwLTUuNTE0IDQuNDg2LTEwIDEwLTEwaDE1djIxLjMzM2gtMTV6bS0yLjUtNTIuNjY2YzAtNS41MTQgNC40ODYtMTAgMTAtMTBoNy41djIxLjMzM2gtNy41Yy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi0xLjMzM3ptMTcuNSA5My45OTloLTcuNWMtNS41MTQgMC0xMC00LjQ4Ni0xMC0xMHYtMS4zMzNjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGg3LjV2MjEuMzMzem0zMC43OTYgMjguODg3Yy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi04LjI3MWg5MS40NTdjLS44NTEgNi42NjgtLjQzNyAxMi43ODcuNzMxIDE4LjI3MWgtODIuMTg4em03OS40ODItMTEzLjY5OGMtMy4xMjQgMjAuOTA2IDEyLjQyNyAzMy4xODQgMjEuNjI1IDM3LjA0IDUuNDQxIDIuOTY4IDcuNTUxIDUuNjQ3IDcuNzAxIDcuMTg4LjIxIDIuMTUtMi41NTMgNS42ODQtNC40NzcgNy4yNTEtLjQ4Mi4zNzgtLjkyOS44LTEuMzM1IDEuMjYxLTYuOTg3IDcuOTM2LTExLjk4MiAxNS41Mi0xNS40MzIgMjIuNjg4aC05Ny41NjRWMzBjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGgxMjMuNzY5YzUuNTE0IDAgMTAgNC40ODYgMTAgMTB2MTM1LjU3OWMtMy4wMzItLjM4MS02LjE1LS42OTQtOS4zODktLjkxNC0yNS4xNTktMS42OTQtNDIuMzcgNy43NDgtNDQuODk4IDI0LjY2NnoiLz48cGF0aCBkPSJNMTc5LjEyOSA4My4xNjdoLTI0LjA2YTUgNSAwIDAgMC01IDV2MjQuMDYxYTUgNSAwIDAgMCA1IDVoMjQuMDZhNSA1IDAgMCAwIDUtNVY4OC4xNjdhNSA1IDAgMCAwLTUtNXpNMTcyLjYyOSAxNDIuODZoLTEyLjU2VjEzMC44YTUgNSAwIDEgMC0xMCAwdjE3LjA2MWE1IDUgMCAwIDAgNSA1aDE3LjU2YTUgNSAwIDEgMCAwLTEwLjAwMXpNMjE2LjU2OCA4My4xNjdoLTI0LjA2YTUgNSAwIDAgMC01IDV2MjQuMDYxYTUgNSAwIDAgMCA1IDVoMjQuMDZhNSA1IDAgMCAwIDUtNVY4OC4xNjdhNSA1IDAgMCAwLTUtNXptLTUgMjQuMDYxaC0xNC4wNlY5My4xNjdoMTQuMDZ2MTQuMDYxek0yMTEuNjY5IDEyNS45MzZIMTk3LjQxYTUgNSAwIDAgMC01IDV2MTQuMjU3YTUgNSAwIDAgMCA1IDVoMTQuMjU5YTUgNSAwIDAgMCA1LTV2LTE0LjI1N2E1IDUgMCAwIDAtNS01eiIvPjwvc3ZnPg==",wce=aI+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1OS4wMTggNTkuMDE4IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1OS4wMTggNTkuMDE4IiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBkPSJtNTguNzQxIDU0LjgwOS01Ljk2OS02LjI0NGExMC43NCAxMC43NCAwIDAgMCAyLjgyLTcuMjVjMC01Ljk1My00Ljg0My0xMC43OTYtMTAuNzk2LTEwLjc5NlMzNCAzNS4zNjEgMzQgNDEuMzE0IDM4Ljg0MyA1Mi4xMSA0NC43OTYgNTIuMTFjMi40NDEgMCA0LjY4OC0uODI0IDYuNDk5LTIuMTk2bDYuMDAxIDYuMjc3YS45OTguOTk4IDAgMCAwIDEuNDE0LjAzMiAxIDEgMCAwIDAgLjAzMS0xLjQxNHpNMzYgNDEuMzE0YzAtNC44NSAzLjk0Ni04Ljc5NiA4Ljc5Ni04Ljc5NnM4Ljc5NiAzLjk0NiA4Ljc5NiA4Ljc5Ni0zLjk0NiA4Ljc5Ni04Ljc5NiA4Ljc5NlMzNiA0Ni4xNjQgMzYgNDEuMzE0ek0xMC40MzEgMTYuMDg4YzAgMy4wNyAyLjQ5OCA1LjU2OCA1LjU2OSA1LjU2OHM1LjU2OS0yLjQ5OCA1LjU2OS01LjU2OGMwLTMuMDcxLTIuNDk4LTUuNTY5LTUuNTY5LTUuNTY5cy01LjU2OSAyLjQ5OC01LjU2OSA1LjU2OXptOS4xMzggMGMwIDEuOTY4LTEuNjAyIDMuNTY4LTMuNTY5IDMuNTY4cy0zLjU2OS0xLjYwMS0zLjU2OS0zLjU2OCAxLjYwMi0zLjU2OSAzLjU2OS0zLjU2OSAzLjU2OSAxLjYwMSAzLjU2OSAzLjU2OXoiLz48cGF0aCBkPSJtMzAuODgyIDI4Ljk4NyA5LjE4LTEwLjA1NCAxMS4yNjIgMTAuMzIzYTEgMSAwIDAgMCAxLjM1MS0xLjQ3NWwtMTItMTFhMSAxIDAgMCAwLTEuNDE0LjA2M2wtOS43OTQgMTAuNzI3LTQuNzQzLTQuNzQzYTEuMDAzIDEuMDAzIDAgMCAwLTEuMzY4LS4wNDRMNi4zMzkgMzcuNzY4YTEgMSAwIDEgMCAxLjMyMiAxLjUwMWwxNi4zMTMtMTQuMzYyIDcuMzE5IDcuMzE4YS45OTkuOTk5IDAgMSAwIDEuNDE0LTEuNDE0bC0xLjgyNS0xLjgyNHoiLz48cGF0aCBkPSJNMzAgNDYuNTE4SDJ2LTQyaDU0djI4YTEgMSAwIDEgMCAyIDB2LTI5YTEgMSAwIDAgMC0xLTFIMWExIDEgMCAwIDAtMSAxdjQ0YTEgMSAwIDAgMCAxIDFoMjlhMSAxIDAgMSAwIDAtMnoiLz48L3N2Zz4=",xM=aI+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NjAgNDYwIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NjAgNDYwIiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBkPSJNMjMwIDBDMTAyLjk3NSAwIDAgMTAyLjk3NSAwIDIzMHMxMDIuOTc1IDIzMCAyMzAgMjMwIDIzMC0xMDIuOTc0IDIzMC0yMzBTMzU3LjAyNSAwIDIzMCAwem0zOC4zMzMgMzc3LjM2YzAgOC42NzYtNy4wMzQgMTUuNzEtMTUuNzEgMTUuNzFoLTQzLjEwMWMtOC42NzYgMC0xNS43MS03LjAzNC0xNS43MS0xNS43MVYyMDIuNDc3YzAtOC42NzYgNy4wMzMtMTUuNzEgMTUuNzEtMTUuNzFoNDMuMTAxYzguNjc2IDAgMTUuNzEgNy4wMzMgMTUuNzEgMTUuNzFWMzc3LjM2ek0yMzAgMTU3Yy0yMS41MzkgMC0zOS0xNy40NjEtMzktMzlzMTcuNDYxLTM5IDM5LTM5IDM5IDE3LjQ2MSAzOSAzOS0xNy40NjEgMzktMzkgMzl6Ii8+PC9zdmc+",vce="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAQgAAAEIBarqQRAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAE1SURBVDiNfdI7S0NBEAXgLya1otFgpbYSbISAgpXYi6CmiH9KCAiChaVga6OiWPgfRDQ+0itaGVNosXtluWwcuMzePfM4M3sq8lbHBubwg1dc4m1E/J/N4ghDPOIsfk/4xiEao5KX0McFljN4C9d4QTPXuY99jP3DsIoDPGM6BY5i5yI5R7O4q+ImFkJY2DCh3cAH2klyB+9J1xUMMAG7eCh1a+Mr+k48b5diXrFVwwLuS+BJ9MfR7+G0FHOHhTHhnXNWS87VDF4pcnfQK4Ep7XScNLmPTZgURNKKYENYWDpzW1BhscS1WHS8CDgURFJQrWcoF3c13KKbgg1BYQfy8xZWEzTTw1QZbAoKu8FqJnktdu5hcVSHmchiILzzuaDQvjBzV2m8yohCE1jHfPx/xhU+y4G/D75ELlRJsSYAAAAASUVORK5CYII=",yM=function(){function r(){}return r.createDefault=function(){return{hasPermission:!1,lastUsedCameraId:null}},r}(),Ice=function(){function r(){this.data=yM.createDefault();var a=localStorage.getItem(r.LOCAL_STORAGE_KEY);a?this.data=JSON.parse(a):this.reset()}return r.prototype.hasCameraPermissions=function(){return this.data.hasPermission},r.prototype.getLastUsedCameraId=function(){return this.data.lastUsedCameraId},r.prototype.setHasPermission=function(a){this.data.hasPermission=a,this.flush()},r.prototype.setLastUsedCameraId=function(a){this.data.lastUsedCameraId=a,this.flush()},r.prototype.resetLastUsedCameraId=function(){this.data.lastUsedCameraId=null,this.flush()},r.prototype.reset=function(){this.data=yM.createDefault(),this.flush()},r.prototype.flush=function(){localStorage.setItem(r.LOCAL_STORAGE_KEY,JSON.stringify(this.data))},r.LOCAL_STORAGE_KEY="HTML5_QRCODE_DATA",r}(),Cce=function(){function r(){this.infoDiv=document.createElement("div")}return r.prototype.renderInto=function(a){this.infoDiv.style.position="absolute",this.infoDiv.style.top="10px",this.infoDiv.style.right="10px",this.infoDiv.style.zIndex="2",this.infoDiv.style.display="none",this.infoDiv.style.padding="5pt",this.infoDiv.style.border="1px solid #171717",this.infoDiv.style.fontSize="10pt",this.infoDiv.style.background="rgb(0 0 0 / 69%)",this.infoDiv.style.borderRadius="5px",this.infoDiv.style.textAlign="center",this.infoDiv.style.fontWeight="400",this.infoDiv.style.color="white",this.infoDiv.innerText=uM.poweredBy();var l=document.createElement("a");l.innerText="ScanApp",l.href="https://scanapp.org",l.target="new",l.style.color="white",this.infoDiv.appendChild(l);var p=document.createElement("br"),x=document.createElement("br");this.infoDiv.appendChild(p),this.infoDiv.appendChild(x);var v=document.createElement("a");v.innerText=uM.reportIssues(),v.href="https://github.com/mebjas/html5-qrcode/issues",v.target="new",v.style.color="white",this.infoDiv.appendChild(v),a.appendChild(this.infoDiv)},r.prototype.show=function(){this.infoDiv.style.display="block"},r.prototype.hide=function(){this.infoDiv.style.display="none"},r}(),Sce=function(){function r(a,l){this.isShowingInfoIcon=!0,this.onTapIn=a,this.onTapOut=l,this.infoIcon=document.createElement("img")}return r.prototype.renderInto=function(a){var l=this;this.infoIcon.alt="Info icon",this.infoIcon.src=xM,this.infoIcon.style.position="absolute",this.infoIcon.style.top="4px",this.infoIcon.style.right="4px",this.infoIcon.style.opacity="0.6",this.infoIcon.style.cursor="pointer",this.infoIcon.style.zIndex="2",this.infoIcon.style.width="16px",this.infoIcon.style.height="16px",this.infoIcon.onmouseover=function(p){return l.onHoverIn()},this.infoIcon.onmouseout=function(p){return l.onHoverOut()},this.infoIcon.onclick=function(p){return l.onClick()},a.appendChild(this.infoIcon)},r.prototype.onHoverIn=function(){this.isShowingInfoIcon&&(this.infoIcon.style.opacity="1")},r.prototype.onHoverOut=function(){this.isShowingInfoIcon&&(this.infoIcon.style.opacity="0.6")},r.prototype.onClick=function(){this.isShowingInfoIcon?(this.isShowingInfoIcon=!1,this.onTapIn(),this.infoIcon.src=vce,this.infoIcon.style.opacity="1"):(this.isShowingInfoIcon=!0,this.onTapOut(),this.infoIcon.src=xM,this.infoIcon.style.opacity="0.6")},r}(),Tce=function(){function r(){var a=this;this.infoDiv=new Cce,this.infoIcon=new Sce(function(){a.infoDiv.show()},function(){a.infoDiv.hide()})}return r.prototype.renderInto=function(a){this.infoDiv.renderInto(a),this.infoIcon.renderInto(a)},r}(),kce=function(r,a,l,p){function x(v){return v instanceof l?v:new l(function(T){T(v)})}return new(l||(l=Promise))(function(v,T){function M(V){try{O(p.next(V))}catch(D){T(D)}}function _(V){try{O(p.throw(V))}catch(D){T(D)}}function O(V){V.done?v(V.value):x(V.value).then(M,_)}O((p=p.apply(r,a||[])).next())})},Ece=function(r,a){var l={label:0,sent:function(){if(v[0]&1)throw v[1];return v[1]},trys:[],ops:[]},p,x,v,T;return T={next:M(0),throw:M(1),return:M(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function M(O){return function(V){return _([O,V])}}function _(O){if(p)throw new TypeError("Generator is already executing.");for(;T&&(T=0,O[0]&&(l=0)),l;)try{if(p=1,x&&(v=O[0]&2?x.return:O[0]?x.throw||((v=x.return)&&v.call(x),0):x.next)&&!(v=v.call(x,O[1])).done)return v;switch(x=0,v&&(O=[O[0]&2,v.value]),O[0]){case 0:case 1:v=O;break;case 4:return l.label++,{value:O[1],done:!1};case 5:l.label++,x=O[1],O=[0];continue;case 7:O=l.ops.pop(),l.trys.pop();continue;default:if(v=l.trys,!(v=v.length>0&&v[v.length-1])&&(O[0]===6||O[0]===2)){l=0;continue}if(O[0]===3&&(!v||O[1]>v[0]&&O[1]<v[3])){l.label=O[1];break}if(O[0]===6&&l.label<v[1]){l.label=v[1],v=O;break}if(v&&l.label<v[2]){l.label=v[2],l.ops.push(O);break}v[2]&&l.ops.pop(),l.trys.pop();continue}O=a.call(r,l)}catch(V){O=[6,V],x=0}finally{p=v=0}if(O[0]&5)throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}},bM=function(){function r(){}return r.hasPermissions=function(){return kce(this,void 0,void 0,function(){var a,l,p,x;return Ece(this,function(v){switch(v.label){case 0:return[4,navigator.mediaDevices.enumerateDevices()];case 1:for(a=v.sent(),l=0,p=a;l<p.length;l++)if(x=p[l],x.kind==="videoinput"&&x.label)return[2,!0];return[2,!1]}})})},r}(),vu=function(){function r(a){this.supportedScanTypes=this.validateAndReturnScanTypes(a)}return r.prototype.getDefaultScanType=function(){return this.supportedScanTypes[0]},r.prototype.hasMoreThanOneScanType=function(){return this.supportedScanTypes.length>1},r.prototype.isCameraScanRequired=function(){for(var a=0,l=this.supportedScanTypes;a<l.length;a++){var p=l[a];if(r.isCameraScanType(p))return!0}return!1},r.isCameraScanType=function(a){return a===Wu.SCAN_TYPE_CAMERA},r.isFileScanType=function(a){return a===Wu.SCAN_TYPE_FILE},r.prototype.validateAndReturnScanTypes=function(a){if(!a||a.length===0)return Za.DEFAULT_SUPPORTED_SCAN_TYPE;var l=Za.DEFAULT_SUPPORTED_SCAN_TYPE.length;if(a.length>l)throw"Max ".concat(l," values expected for ")+"supportedScanTypes";for(var p=0,x=a;p<x.length;p++){var v=x[p];if(!Za.DEFAULT_SUPPORTED_SCAN_TYPE.includes(v))throw"Unsupported scan type ".concat(v)}return a},r}(),Di=function(){function r(){}return r.ALL_ELEMENT_CLASS="html5-qrcode-element",r.CAMERA_PERMISSION_BUTTON_ID="html5-qrcode-button-camera-permission",r.CAMERA_START_BUTTON_ID="html5-qrcode-button-camera-start",r.CAMERA_STOP_BUTTON_ID="html5-qrcode-button-camera-stop",r.TORCH_BUTTON_ID="html5-qrcode-button-torch",r.CAMERA_SELECTION_SELECT_ID="html5-qrcode-select-camera",r.FILE_SELECTION_BUTTON_ID="html5-qrcode-button-file-selection",r.ZOOM_SLIDER_ID="html5-qrcode-input-range-zoom",r.SCAN_TYPE_CHANGE_ANCHOR_ID="html5-qrcode-anchor-scan-type-change",r.TORCH_BUTTON_CLASS_TORCH_ON="html5-qrcode-button-torch-on",r.TORCH_BUTTON_CLASS_TORCH_OFF="html5-qrcode-button-torch-off",r}(),yl=function(){function r(){}return r.createElement=function(a,l){var p=document.createElement(a);return p.id=l,p.classList.add(Di.ALL_ELEMENT_CLASS),a==="button"&&p.setAttribute("type","button"),p},r}(),xO=function(r,a,l,p){function x(v){return v instanceof l?v:new l(function(T){T(v)})}return new(l||(l=Promise))(function(v,T){function M(V){try{O(p.next(V))}catch(D){T(D)}}function _(V){try{O(p.throw(V))}catch(D){T(D)}}function O(V){V.done?v(V.value):x(V.value).then(M,_)}O((p=p.apply(r,a||[])).next())})},yO=function(r,a){var l={label:0,sent:function(){if(v[0]&1)throw v[1];return v[1]},trys:[],ops:[]},p,x,v,T;return T={next:M(0),throw:M(1),return:M(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function M(O){return function(V){return _([O,V])}}function _(O){if(p)throw new TypeError("Generator is already executing.");for(;T&&(T=0,O[0]&&(l=0)),l;)try{if(p=1,x&&(v=O[0]&2?x.return:O[0]?x.throw||((v=x.return)&&v.call(x),0):x.next)&&!(v=v.call(x,O[1])).done)return v;switch(x=0,v&&(O=[O[0]&2,v.value]),O[0]){case 0:case 1:v=O;break;case 4:return l.label++,{value:O[1],done:!1};case 5:l.label++,x=O[1],O=[0];continue;case 7:O=l.ops.pop(),l.trys.pop();continue;default:if(v=l.trys,!(v=v.length>0&&v[v.length-1])&&(O[0]===6||O[0]===2)){l=0;continue}if(O[0]===3&&(!v||O[1]>v[0]&&O[1]<v[3])){l.label=O[1];break}if(O[0]===6&&l.label<v[1]){l.label=v[1],v=O;break}if(v&&l.label<v[2]){l.label=v[2],l.ops.push(O);break}v[2]&&l.ops.pop(),l.trys.pop();continue}O=a.call(r,l)}catch(V){O=[6,V],x=0}finally{p=v=0}if(O[0]&5)throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}},wM=function(){function r(a,l,p){this.isTorchOn=!1,this.torchCapability=a,this.buttonController=l,this.onTorchActionFailureCallback=p}return r.prototype.isTorchEnabled=function(){return this.isTorchOn},r.prototype.flipState=function(){return xO(this,void 0,void 0,function(){var a,l;return yO(this,function(p){switch(p.label){case 0:this.buttonController.disable(),a=!this.isTorchOn,p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.torchCapability.apply(a)];case 2:return p.sent(),this.updateUiBasedOnLatestSettings(this.torchCapability.value(),a),[3,4];case 3:return l=p.sent(),this.propagateFailure(a,l),this.buttonController.enable(),[3,4];case 4:return[2]}})})},r.prototype.updateUiBasedOnLatestSettings=function(a,l){a===l?(this.buttonController.setText(l?vn.torchOffButton():vn.torchOnButton()),this.isTorchOn=l):this.propagateFailure(l),this.buttonController.enable()},r.prototype.propagateFailure=function(a,l){var p=a?vn.torchOnFailedMessage():vn.torchOffFailedMessage();l&&(p+="; Error = "+l),this.onTorchActionFailureCallback(p)},r.prototype.reset=function(){this.isTorchOn=!1},r}(),Nce=function(){function r(a,l){this.onTorchActionFailureCallback=l,this.torchButton=yl.createElement("button",Di.TORCH_BUTTON_ID),this.torchController=new wM(a,this,l)}return r.prototype.render=function(a,l){var p=this;this.torchButton.innerText=vn.torchOnButton(),this.torchButton.style.display=l.display,this.torchButton.style.marginLeft=l.marginLeft;var x=this;this.torchButton.addEventListener("click",function(v){return xO(p,void 0,void 0,function(){return yO(this,function(T){switch(T.label){case 0:return[4,x.torchController.flipState()];case 1:return T.sent(),x.torchController.isTorchEnabled()?(x.torchButton.classList.remove(Di.TORCH_BUTTON_CLASS_TORCH_OFF),x.torchButton.classList.add(Di.TORCH_BUTTON_CLASS_TORCH_ON)):(x.torchButton.classList.remove(Di.TORCH_BUTTON_CLASS_TORCH_ON),x.torchButton.classList.add(Di.TORCH_BUTTON_CLASS_TORCH_OFF)),[2]}})})}),a.appendChild(this.torchButton)},r.prototype.updateTorchCapability=function(a){this.torchController=new wM(a,this,this.onTorchActionFailureCallback)},r.prototype.getTorchButton=function(){return this.torchButton},r.prototype.hide=function(){this.torchButton.style.display="none"},r.prototype.show=function(){this.torchButton.style.display="inline-block"},r.prototype.disable=function(){this.torchButton.disabled=!0},r.prototype.enable=function(){this.torchButton.disabled=!1},r.prototype.setText=function(a){this.torchButton.innerText=a},r.prototype.reset=function(){this.torchButton.innerText=vn.torchOnButton(),this.torchController.reset()},r.create=function(a,l,p,x){var v=new r(l,x);return v.render(a,p),v},r}(),Ace=function(){function r(a,l,p){this.fileBasedScanRegion=this.createFileBasedScanRegion(),this.fileBasedScanRegion.style.display=l?"block":"none",a.appendChild(this.fileBasedScanRegion);var x=document.createElement("label");x.setAttribute("for",this.getFileScanInputId()),x.style.display="inline-block",this.fileBasedScanRegion.appendChild(x),this.fileSelectionButton=yl.createElement("button",Di.FILE_SELECTION_BUTTON_ID),this.setInitialValueToButton(),this.fileSelectionButton.addEventListener("click",function(M){x.click()}),x.append(this.fileSelectionButton),this.fileScanInput=yl.createElement("input",this.getFileScanInputId()),this.fileScanInput.type="file",this.fileScanInput.accept="image/*",this.fileScanInput.style.display="none",x.appendChild(this.fileScanInput);var v=this;this.fileScanInput.addEventListener("change",function(M){if(!(M==null||M.target==null)){var _=M.target;if(!(_.files&&_.files.length===0)){var O=_.files,V=O[0],D=V.name;v.setImageNameToButton(D),p(V)}}});var T=this.createDragAndDropMessage();this.fileBasedScanRegion.appendChild(T),this.fileBasedScanRegion.addEventListener("dragenter",function(M){v.fileBasedScanRegion.style.border=v.fileBasedScanRegionActiveBorder(),M.stopPropagation(),M.preventDefault()}),this.fileBasedScanRegion.addEventListener("dragleave",function(M){v.fileBasedScanRegion.style.border=v.fileBasedScanRegionDefaultBorder(),M.stopPropagation(),M.preventDefault()}),this.fileBasedScanRegion.addEventListener("dragover",function(M){v.fileBasedScanRegion.style.border=v.fileBasedScanRegionActiveBorder(),M.stopPropagation(),M.preventDefault()}),this.fileBasedScanRegion.addEventListener("drop",function(M){M.stopPropagation(),M.preventDefault(),v.fileBasedScanRegion.style.border=v.fileBasedScanRegionDefaultBorder();var _=M.dataTransfer;if(_){var O=_.files;if(!O||O.length===0)return;for(var V=!1,D=0;D<O.length;++D){var $=O.item(D);if($){var re=/image.*/;if($.type.match(re)){V=!0;var H=$.name;v.setImageNameToButton(H),p($),T.innerText=vn.dragAndDropMessage();break}}}V||(T.innerText=vn.dragAndDropMessageOnlyImages())}})}return r.prototype.hide=function(){this.fileBasedScanRegion.style.display="none",this.fileScanInput.disabled=!0},r.prototype.show=function(){this.fileBasedScanRegion.style.display="block",this.fileScanInput.disabled=!1},r.prototype.isShowing=function(){return this.fileBasedScanRegion.style.display==="block"},r.prototype.resetValue=function(){this.fileScanInput.value="",this.setInitialValueToButton()},r.prototype.createFileBasedScanRegion=function(){var a=document.createElement("div");return a.style.textAlign="center",a.style.margin="auto",a.style.width="80%",a.style.maxWidth="600px",a.style.border=this.fileBasedScanRegionDefaultBorder(),a.style.padding="10px",a.style.marginBottom="10px",a},r.prototype.fileBasedScanRegionDefaultBorder=function(){return"6px dashed #ebebeb"},r.prototype.fileBasedScanRegionActiveBorder=function(){return"6px dashed rgb(153 151 151)"},r.prototype.createDragAndDropMessage=function(){var a=document.createElement("div");return a.innerText=vn.dragAndDropMessage(),a.style.fontWeight="400",a},r.prototype.setImageNameToButton=function(a){var l=20;if(a.length>l){var p=a.substring(0,8),x=a.length,v=a.substring(x-8,x);a="".concat(p,"....").concat(v)}var T=vn.fileSelectionChooseAnother()+" - "+a;this.fileSelectionButton.innerText=T},r.prototype.setInitialValueToButton=function(){var a=vn.fileSelectionChooseImage()+" - "+vn.fileSelectionNoImageSelected();this.fileSelectionButton.innerText=a},r.prototype.getFileScanInputId=function(){return"html5-qrcode-private-filescan-input"},r.create=function(a,l,p){var x=new r(a,l,p);return x},r}(),Rce=function(){function r(a){this.selectElement=yl.createElement("select",Di.CAMERA_SELECTION_SELECT_ID),this.cameras=a,this.options=[]}return r.prototype.render=function(a){var l=document.createElement("span");l.style.marginRight="10px";var p=this.cameras.length;if(p===0)throw new Error("No cameras found");if(p===1)l.style.display="none";else{var x=vn.selectCamera();l.innerText="".concat(x," (").concat(this.cameras.length,")  ")}for(var v=1,T=0,M=this.cameras;T<M.length;T++){var _=M[T],O=_.id,V=_.label==null?O:_.label;(!V||V==="")&&(V=[vn.anonymousCameraPrefix(),v++].join(" "));var D=document.createElement("option");D.value=O,D.innerText=V,this.options.push(D),this.selectElement.appendChild(D)}l.appendChild(this.selectElement),a.appendChild(l)},r.prototype.disable=function(){this.selectElement.disabled=!0},r.prototype.isDisabled=function(){return this.selectElement.disabled===!0},r.prototype.enable=function(){this.selectElement.disabled=!1},r.prototype.getValue=function(){return this.selectElement.value},r.prototype.hasValue=function(a){for(var l=0,p=this.options;l<p.length;l++){var x=p[l];if(x.value===a)return!0}return!1},r.prototype.setValue=function(a){if(!this.hasValue(a))throw new Error("".concat(a," is not present in the camera list."));this.selectElement.value=a},r.prototype.hasSingleItem=function(){return this.cameras.length===1},r.prototype.numCameras=function(){return this.cameras.length},r.create=function(a,l){var p=new r(l);return p.render(a),p},r}(),Mce=function(){function r(){this.onChangeCallback=null,this.zoomElementContainer=document.createElement("div"),this.rangeInput=yl.createElement("input",Di.ZOOM_SLIDER_ID),this.rangeInput.type="range",this.rangeText=document.createElement("span"),this.rangeInput.min="1",this.rangeInput.max="5",this.rangeInput.value="1",this.rangeInput.step="0.1"}return r.prototype.render=function(a,l){this.zoomElementContainer.style.display=l?"block":"none",this.zoomElementContainer.style.padding="5px 10px",this.zoomElementContainer.style.textAlign="center",a.appendChild(this.zoomElementContainer),this.rangeInput.style.display="inline-block",this.rangeInput.style.width="50%",this.rangeInput.style.height="5px",this.rangeInput.style.background="#d3d3d3",this.rangeInput.style.outline="none",this.rangeInput.style.opacity="0.7";var p=vn.zoom();this.rangeText.innerText="".concat(this.rangeInput.value,"x ").concat(p),this.rangeText.style.marginRight="10px";var x=this;this.rangeInput.addEventListener("input",function(){return x.onValueChange()}),this.rangeInput.addEventListener("change",function(){return x.onValueChange()}),this.zoomElementContainer.appendChild(this.rangeInput),this.zoomElementContainer.appendChild(this.rangeText)},r.prototype.onValueChange=function(){var a=vn.zoom();this.rangeText.innerText="".concat(this.rangeInput.value,"x ").concat(a),this.onChangeCallback&&this.onChangeCallback(parseFloat(this.rangeInput.value))},r.prototype.setValues=function(a,l,p,x){this.rangeInput.min=a.toString(),this.rangeInput.max=l.toString(),this.rangeInput.step=x.toString(),this.rangeInput.value=p.toString(),this.onValueChange()},r.prototype.show=function(){this.zoomElementContainer.style.display="block"},r.prototype.hide=function(){this.zoomElementContainer.style.display="none"},r.prototype.setOnCameraZoomValueChangeCallback=function(a){this.onChangeCallback=a},r.prototype.removeOnCameraZoomValueChangeCallback=function(){this.onChangeCallback=null},r.create=function(a,l){var p=new r;return p.render(a,l),p},r}(),Mi;(function(r){r[r.STATUS_DEFAULT=0]="STATUS_DEFAULT",r[r.STATUS_SUCCESS=1]="STATUS_SUCCESS",r[r.STATUS_WARNING=2]="STATUS_WARNING",r[r.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION"})(Mi||(Mi={}));function Lce(r){return{fps:r.fps,qrbox:r.qrbox,aspectRatio:r.aspectRatio,disableFlip:r.disableFlip,videoConstraints:r.videoConstraints}}function Dce(r,a){return{formatsToSupport:r.formatsToSupport,useBarCodeDetectorIfSupported:r.useBarCodeDetectorIfSupported,experimentalFeatures:r.experimentalFeatures,verbose:a}}var Oce=function(){function r(a,l,p){if(this.lastMatchFound=null,this.cameraScanImage=null,this.fileScanImage=null,this.fileSelectionUi=null,this.elementId=a,this.config=this.createConfig(l),this.verbose=p===!0,!document.getElementById(a))throw"HTML Element with id=".concat(a," not found");this.scanTypeSelector=new vu(this.config.supportedScanTypes),this.currentScanType=this.scanTypeSelector.getDefaultScanType(),this.sectionSwapAllowed=!0,this.logger=new pO(this.verbose),this.persistedDataManager=new Ice,l.rememberLastUsedCamera!==!0&&this.persistedDataManager.reset()}return r.prototype.render=function(a,l){var p=this;this.lastMatchFound=null,this.qrCodeSuccessCallback=function(v,T){if(a)a(v,T);else{if(p.lastMatchFound===v)return;p.lastMatchFound=v,p.setHeaderMessage(vn.lastMatch(v),Mi.STATUS_SUCCESS)}},this.qrCodeErrorCallback=function(v,T){l&&l(v,T)};var x=document.getElementById(this.elementId);if(!x)throw"HTML Element with id=".concat(this.elementId," not found");x.innerHTML="",this.createBasicLayout(x),this.html5Qrcode=new gM(this.getScanRegionId(),Dce(this.config,this.verbose))},r.prototype.pause=function(a){(ko(a)||a!==!0)&&(a=!1),this.getHtml5QrcodeOrFail().pause(a)},r.prototype.resume=function(){this.getHtml5QrcodeOrFail().resume()},r.prototype.getState=function(){return this.getHtml5QrcodeOrFail().getState()},r.prototype.clear=function(){var a=this,l=function(){var p=document.getElementById(a.elementId);p&&(p.innerHTML="",a.resetBasicLayout(p))};return this.html5Qrcode?new Promise(function(p,x){if(!a.html5Qrcode){p();return}a.html5Qrcode.isScanning?a.html5Qrcode.stop().then(function(v){if(!a.html5Qrcode){p();return}a.html5Qrcode.clear(),l(),p()}).catch(function(v){a.verbose&&a.logger.logError("Unable to stop qrcode scanner",v),x(v)}):(a.html5Qrcode.clear(),l(),p())}):Promise.resolve()},r.prototype.getRunningTrackCapabilities=function(){return this.getHtml5QrcodeOrFail().getRunningTrackCapabilities()},r.prototype.getRunningTrackSettings=function(){return this.getHtml5QrcodeOrFail().getRunningTrackSettings()},r.prototype.applyVideoConstraints=function(a){return this.getHtml5QrcodeOrFail().applyVideoConstraints(a)},r.prototype.getHtml5QrcodeOrFail=function(){if(!this.html5Qrcode)throw"Code scanner not initialized.";return this.html5Qrcode},r.prototype.createConfig=function(a){return a?(a.fps||(a.fps=Za.SCAN_DEFAULT_FPS),a.rememberLastUsedCamera!==!Za.DEFAULT_REMEMBER_LAST_CAMERA_USED&&(a.rememberLastUsedCamera=Za.DEFAULT_REMEMBER_LAST_CAMERA_USED),a.supportedScanTypes||(a.supportedScanTypes=Za.DEFAULT_SUPPORTED_SCAN_TYPE),a):{fps:Za.SCAN_DEFAULT_FPS,rememberLastUsedCamera:Za.DEFAULT_REMEMBER_LAST_CAMERA_USED,supportedScanTypes:Za.DEFAULT_SUPPORTED_SCAN_TYPE}},r.prototype.createBasicLayout=function(a){a.style.position="relative",a.style.padding="0px",a.style.border="1px solid silver",this.createHeader(a);var l=document.createElement("div"),p=this.getScanRegionId();l.id=p,l.style.width="100%",l.style.minHeight="100px",l.style.textAlign="center",a.appendChild(l),vu.isCameraScanType(this.currentScanType)?this.insertCameraScanImageToScanRegion():this.insertFileScanImageToScanRegion();var x=document.createElement("div"),v=this.getDashboardId();x.id=v,x.style.width="100%",a.appendChild(x),this.setupInitialDashboard(x)},r.prototype.resetBasicLayout=function(a){a.style.border="none"},r.prototype.setupInitialDashboard=function(a){this.createSection(a),this.createSectionControlPanel(),this.scanTypeSelector.hasMoreThanOneScanType()&&this.createSectionSwap()},r.prototype.createHeader=function(a){var l=document.createElement("div");l.style.textAlign="left",l.style.margin="0px",a.appendChild(l);var p=new Tce;p.renderInto(l);var x=document.createElement("div");x.id=this.getHeaderMessageContainerId(),x.style.display="none",x.style.textAlign="center",x.style.fontSize="14px",x.style.padding="2px 10px",x.style.margin="4px",x.style.borderTop="1px solid #f6f6f6",l.appendChild(x)},r.prototype.createSection=function(a){var l=document.createElement("div");l.id=this.getDashboardSectionId(),l.style.width="100%",l.style.padding="10px 0px 10px 0px",l.style.textAlign="left",a.appendChild(l)},r.prototype.createCameraListUi=function(a,l,p){var x=this;x.showHideScanTypeSwapLink(!1),x.setHeaderMessage(vn.cameraPermissionRequesting());var v=function(){p||x.createPermissionButton(a,l)};gM.getCameras().then(function(T){x.persistedDataManager.setHasPermission(!0),x.showHideScanTypeSwapLink(!0),x.resetHeaderMessage(),T&&T.length>0?(a.removeChild(l),x.renderCameraSelection(T)):(x.setHeaderMessage(vn.noCameraFound(),Mi.STATUS_WARNING),v())}).catch(function(T){x.persistedDataManager.setHasPermission(!1),p?p.disabled=!1:v(),x.setHeaderMessage(T,Mi.STATUS_WARNING),x.showHideScanTypeSwapLink(!0)})},r.prototype.createPermissionButton=function(a,l){var p=this,x=yl.createElement("button",this.getCameraPermissionButtonId());x.innerText=vn.cameraPermissionTitle(),x.addEventListener("click",function(){x.disabled=!0,p.createCameraListUi(a,l,x)}),l.appendChild(x)},r.prototype.createPermissionsUi=function(a,l){var p=this;if(vu.isCameraScanType(this.currentScanType)&&this.persistedDataManager.hasCameraPermissions()){bM.hasPermissions().then(function(x){x?p.createCameraListUi(a,l):(p.persistedDataManager.setHasPermission(!1),p.createPermissionButton(a,l))}).catch(function(x){p.persistedDataManager.setHasPermission(!1),p.createPermissionButton(a,l)});return}this.createPermissionButton(a,l)},r.prototype.createSectionControlPanel=function(){var a=document.getElementById(this.getDashboardSectionId()),l=document.createElement("div");a.appendChild(l);var p=document.createElement("div");p.id=this.getDashboardSectionCameraScanRegionId(),p.style.display=vu.isCameraScanType(this.currentScanType)?"block":"none",l.appendChild(p);var x=document.createElement("div");x.style.textAlign="center",p.appendChild(x),this.scanTypeSelector.isCameraScanRequired()&&this.createPermissionsUi(p,x),this.renderFileScanUi(l)},r.prototype.renderFileScanUi=function(a){var l=vu.isFileScanType(this.currentScanType),p=this,x=function(v){if(!p.html5Qrcode)throw"html5Qrcode not defined";vu.isFileScanType(p.currentScanType)&&(p.setHeaderMessage(vn.loadingImage()),p.html5Qrcode.scanFileV2(v,!0).then(function(T){p.resetHeaderMessage(),p.qrCodeSuccessCallback(T.decodedText,T)}).catch(function(T){p.setHeaderMessage(T,Mi.STATUS_WARNING),p.qrCodeErrorCallback(T,fO.createFrom(T))}))};this.fileSelectionUi=Ace.create(a,l,x)},r.prototype.renderCameraSelection=function(a){var l=this,p=this,x=document.getElementById(this.getDashboardSectionCameraScanRegionId());x.style.textAlign="center";var v=Mce.create(x,!1),T=function(se){var Ee=se.zoomFeature();if(Ee.isSupported()){v.setOnCameraZoomValueChangeCallback(function(Y){Ee.apply(Y)});var ee=1;l.config.defaultZoomValueIfSupported&&(ee=l.config.defaultZoomValueIfSupported),ee=que(ee,Ee.min(),Ee.max()),v.setValues(Ee.min(),Ee.max(),ee,Ee.step()),v.show()}},M=Rce.create(x,a),_=document.createElement("span"),O=yl.createElement("button",Di.CAMERA_START_BUTTON_ID);O.innerText=vn.scanButtonStartScanningText(),_.appendChild(O);var V=yl.createElement("button",Di.CAMERA_STOP_BUTTON_ID);V.innerText=vn.scanButtonStopScanningText(),V.style.display="none",V.disabled=!0,_.appendChild(V);var D,$=function(se){if(!se.torchFeature().isSupported()){D&&D.hide();return}D?D.updateTorchCapability(se.torchFeature()):D=Nce.create(_,se.torchFeature(),{display:"none",marginLeft:"5px"},function(Ee){p.setHeaderMessage(Ee,Mi.STATUS_WARNING)}),D.show()};x.appendChild(_);var re=function(se){se||(O.style.display="none"),O.innerText=vn.scanButtonStartScanningText(),O.style.opacity="1",O.disabled=!1,se&&(O.style.display="inline-block")};if(O.addEventListener("click",function(se){O.innerText=vn.scanButtonScanningStarting(),M.disable(),O.disabled=!0,O.style.opacity="0.5",l.scanTypeSelector.hasMoreThanOneScanType()&&p.showHideScanTypeSwapLink(!1),p.resetHeaderMessage();var Ee=M.getValue();p.persistedDataManager.setLastUsedCameraId(Ee),p.html5Qrcode.start(Ee,Lce(p.config),p.qrCodeSuccessCallback,p.qrCodeErrorCallback).then(function(ee){V.disabled=!1,V.style.display="inline-block",re(!1);var Y=p.html5Qrcode.getRunningTrackCameraCapabilities();l.config.showTorchButtonIfSupported===!0&&$(Y),l.config.showZoomSliderIfSupported===!0&&T(Y)}).catch(function(ee){p.showHideScanTypeSwapLink(!0),M.enable(),re(!0),p.setHeaderMessage(ee,Mi.STATUS_WARNING)})}),M.hasSingleItem()&&O.click(),V.addEventListener("click",function(se){if(!p.html5Qrcode)throw"html5Qrcode not defined";V.disabled=!0,p.html5Qrcode.stop().then(function(Ee){l.scanTypeSelector.hasMoreThanOneScanType()&&p.showHideScanTypeSwapLink(!0),M.enable(),O.disabled=!1,V.style.display="none",O.style.display="inline-block",D&&(D.reset(),D.hide()),v.removeOnCameraZoomValueChangeCallback(),v.hide(),p.insertCameraScanImageToScanRegion()}).catch(function(Ee){V.disabled=!1,p.setHeaderMessage(Ee,Mi.STATUS_WARNING)})}),p.persistedDataManager.getLastUsedCameraId()){var H=p.persistedDataManager.getLastUsedCameraId();M.hasValue(H)?(M.setValue(H),O.click()):p.persistedDataManager.resetLastUsedCameraId()}},r.prototype.createSectionSwap=function(){var a=this,l=vn.textIfCameraScanSelected(),p=vn.textIfFileScanSelected(),x=document.getElementById(this.getDashboardSectionId()),v=document.createElement("div");v.style.textAlign="center";var T=yl.createElement("span",this.getDashboardSectionSwapLinkId());T.style.textDecoration="underline",T.style.cursor="pointer",T.innerText=vu.isCameraScanType(this.currentScanType)?l:p,T.addEventListener("click",function(){if(!a.sectionSwapAllowed){a.verbose&&a.logger.logError("Section swap called when not allowed");return}a.resetHeaderMessage(),a.fileSelectionUi.resetValue(),a.sectionSwapAllowed=!1,vu.isCameraScanType(a.currentScanType)?(a.clearScanRegion(),a.getCameraScanRegion().style.display="none",a.fileSelectionUi.show(),T.innerText=p,a.currentScanType=Wu.SCAN_TYPE_FILE,a.insertFileScanImageToScanRegion()):(a.clearScanRegion(),a.getCameraScanRegion().style.display="block",a.fileSelectionUi.hide(),T.innerText=l,a.currentScanType=Wu.SCAN_TYPE_CAMERA,a.insertCameraScanImageToScanRegion(),a.startCameraScanIfPermissionExistsOnSwap()),a.sectionSwapAllowed=!0}),v.appendChild(T),x.appendChild(v)},r.prototype.startCameraScanIfPermissionExistsOnSwap=function(){var a=this,l=this;if(this.persistedDataManager.hasCameraPermissions()){bM.hasPermissions().then(function(p){if(p){var x=document.getElementById(l.getCameraPermissionButtonId());if(!x)throw a.logger.logError("Permission button not found, fail;"),"Permission button not found";x.click()}else l.persistedDataManager.setHasPermission(!1)}).catch(function(p){l.persistedDataManager.setHasPermission(!1)});return}},r.prototype.resetHeaderMessage=function(){var a=document.getElementById(this.getHeaderMessageContainerId());a.style.display="none"},r.prototype.setHeaderMessage=function(a,l){l||(l=Mi.STATUS_DEFAULT);var p=this.getHeaderMessageDiv();switch(p.innerText=a,p.style.display="block",l){case Mi.STATUS_SUCCESS:p.style.background="rgba(106, 175, 80, 0.26)",p.style.color="#477735";break;case Mi.STATUS_WARNING:p.style.background="rgba(203, 36, 49, 0.14)",p.style.color="#cb2431";break;case Mi.STATUS_DEFAULT:default:p.style.background="rgba(0, 0, 0, 0)",p.style.color="rgb(17, 17, 17)";break}},r.prototype.showHideScanTypeSwapLink=function(a){this.scanTypeSelector.hasMoreThanOneScanType()&&(a!==!0&&(a=!1),this.sectionSwapAllowed=a,this.getDashboardSectionSwapLink().style.display=a?"inline-block":"none")},r.prototype.insertCameraScanImageToScanRegion=function(){var a=this,l=document.getElementById(this.getScanRegionId());if(this.cameraScanImage){l.innerHTML="<br>",l.appendChild(this.cameraScanImage);return}this.cameraScanImage=new Image,this.cameraScanImage.onload=function(p){l.innerHTML="<br>",l.appendChild(a.cameraScanImage)},this.cameraScanImage.width=64,this.cameraScanImage.style.opacity="0.8",this.cameraScanImage.src=bce,this.cameraScanImage.alt=vn.cameraScanAltText()},r.prototype.insertFileScanImageToScanRegion=function(){var a=this,l=document.getElementById(this.getScanRegionId());if(this.fileScanImage){l.innerHTML="<br>",l.appendChild(this.fileScanImage);return}this.fileScanImage=new Image,this.fileScanImage.onload=function(p){l.innerHTML="<br>",l.appendChild(a.fileScanImage)},this.fileScanImage.width=64,this.fileScanImage.style.opacity="0.8",this.fileScanImage.src=wce,this.fileScanImage.alt=vn.fileScanAltText()},r.prototype.clearScanRegion=function(){var a=document.getElementById(this.getScanRegionId());a.innerHTML=""},r.prototype.getDashboardSectionId=function(){return"".concat(this.elementId,"__dashboard_section")},r.prototype.getDashboardSectionCameraScanRegionId=function(){return"".concat(this.elementId,"__dashboard_section_csr")},r.prototype.getDashboardSectionSwapLinkId=function(){return Di.SCAN_TYPE_CHANGE_ANCHOR_ID},r.prototype.getScanRegionId=function(){return"".concat(this.elementId,"__scan_region")},r.prototype.getDashboardId=function(){return"".concat(this.elementId,"__dashboard")},r.prototype.getHeaderMessageContainerId=function(){return"".concat(this.elementId,"__header_message")},r.prototype.getCameraPermissionButtonId=function(){return Di.CAMERA_PERMISSION_BUTTON_ID},r.prototype.getCameraScanRegion=function(){return document.getElementById(this.getDashboardSectionCameraScanRegionId())},r.prototype.getDashboardSectionSwapLink=function(){return document.getElementById(this.getDashboardSectionSwapLinkId())},r.prototype.getHeaderMessageDiv=function(){return document.getElementById(this.getHeaderMessageContainerId())},r}();const Pce=({onScanSuccess:r,onScanError:a,onClose:l})=>(Ge.useEffect(()=>{const p=new Oce("reader",{fps:10,qrbox:{width:250,height:250}},!1);return p.render(x=>{try{const T=new URL(x).searchParams.get("id");T?(r(T),p.clear()):(r(x),p.clear())}catch{r(x),p.clear()}},a),()=>{p.clear().catch(x=>console.error("Failed to clear scanner",x))}},[]),xe.jsxs("div",{className:"modal-overlay",children:[xe.jsxs("div",{className:"modal-content glass scanner-modal",children:[xe.jsxs("div",{className:"scanner-header",children:[xe.jsx("h3",{children:"QR Kodni Skanerlang"}),xe.jsx("p",{style:{color:"var(--text-dim)",fontSize:"12px"},children:"Skaner ramkasi ichiga QR kodni joylashtiring"})]}),xe.jsxs("div",{className:"scanner-container",children:[xe.jsx("div",{id:"reader"}),xe.jsx("div",{className:"scanner-overlay",children:xe.jsx("div",{className:"scan-frame"})})]}),xe.jsx("div",{className:"scanner-footer",children:xe.jsx("button",{onClick:l,className:"nav-btn",children:"Yopish"})})]}),xe.jsx("style",{children:`
                .scanner-modal {
                    max-width: 450px !important;
                    padding: 20px !important;
                    overflow: hidden;
                }
                .scanner-container {
                    position: relative;
                    width: 100%;
                    aspect-ratio: 1/1;
                    margin: 20px 0;
                    border-radius: 20px;
                    overflow: hidden;
                    background: #000;
                }
                #reader {
                    width: 100% !important;
                    border: none !important;
                }
                #reader video {
                    object-fit: cover !important;
                }
                .scanner-overlay {
                    position: absolute;
                    inset: 0;
                    pointer-events: none;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 10;
                }
                .scan-frame {
                    width: 70%;
                    height: 70%;
                    border: 2px solid var(--primary);
                    border-radius: 20px;
                    box-shadow: 0 0 0 1000px rgba(0,0,0,0.5);
                    position: relative;
                }
                .scan-frame::after {
                    content: '';
                    position: absolute;
                    top: 0; left: 0; width: 100%; height: 2px;
                    background: var(--primary);
                    box-shadow: 0 0 15px var(--primary);
                    animation: scan 2s linear infinite;
                }
                @keyframes scan {
                    0% { top: 0; }
                    50% { top: 100%; }
                    100% { top: 0; }
                }
                #reader__scan_region {
                    background: transparent !important;
                }
                #reader__dashboard {
                    display: none !important;
                }
            `})]}));let gm;const Fce=new Uint8Array(16);function Gce(){if(!gm&&(gm=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!gm))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return gm(Fce)}const ms=[];for(let r=0;r<256;++r)ms.push((r+256).toString(16).slice(1));function _ce(r,a=0){return ms[r[a+0]]+ms[r[a+1]]+ms[r[a+2]]+ms[r[a+3]]+"-"+ms[r[a+4]]+ms[r[a+5]]+"-"+ms[r[a+6]]+ms[r[a+7]]+"-"+ms[r[a+8]]+ms[r[a+9]]+"-"+ms[r[a+10]]+ms[r[a+11]]+ms[r[a+12]]+ms[r[a+13]]+ms[r[a+14]]+ms[r[a+15]]}const Vce=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),vM={randomUUID:Vce};function Bce(r,a,l){if(vM.randomUUID&&!r)return vM.randomUUID();r=r||{};const p=r.random||(r.rng||Gce)();return p[6]=p[6]&15|64,p[8]=p[8]&63|128,_ce(p)}let Wce={data:""},zce=r=>{if(typeof window=="object"){let a=(r?r.querySelector("#_goober"):window._goober)||Object.assign(document.createElement("style"),{innerHTML:" ",id:"_goober"});return a.nonce=window.__nonce__,a.parentNode||(r||document.head).appendChild(a),a.firstChild}return r||Wce},Xce=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,Zce=/\/\*[^]*?\*\/|  +/g,IM=/\n+/g,Eu=(r,a)=>{let l="",p="",x="";for(let v in r){let T=r[v];v[0]=="@"?v[1]=="i"?l=v+" "+T+";":p+=v[1]=="f"?Eu(T,v):v+"{"+Eu(T,v[1]=="k"?"":a)+"}":typeof T=="object"?p+=Eu(T,a?a.replace(/([^,])+/g,M=>v.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,_=>/&/.test(_)?_.replace(/&/g,M):M?M+" "+_:_)):v):T!=null&&(v=/^--/.test(v)?v:v.replace(/[A-Z]/g,"-$&").toLowerCase(),x+=Eu.p?Eu.p(v,T):v+":"+T+";")}return l+(a&&x?a+"{"+x+"}":x)+p},fl={},bO=r=>{if(typeof r=="object"){let a="";for(let l in r)a+=l+bO(r[l]);return a}return r},Kce=(r,a,l,p,x)=>{let v=bO(r),T=fl[v]||(fl[v]=(_=>{let O=0,V=11;for(;O<_.length;)V=101*V+_.charCodeAt(O++)>>>0;return"go"+V})(v));if(!fl[T]){let _=v!==r?r:(O=>{let V,D,$=[{}];for(;V=Xce.exec(O.replace(Zce,""));)V[4]?$.shift():V[3]?(D=V[3].replace(IM," ").trim(),$.unshift($[0][D]=$[0][D]||{})):$[0][V[1]]=V[2].replace(IM," ").trim();return $[0]})(r);fl[T]=Eu(x?{["@keyframes "+T]:_}:_,l?"":"."+T)}let M=l&&fl.g?fl.g:null;return l&&(fl.g=fl[T]),((_,O,V,D)=>{D?O.data=O.data.replace(D,_):O.data.indexOf(_)===-1&&(O.data=V?_+O.data:O.data+_)})(fl[T],a,p,M),T},$ce=(r,a,l)=>r.reduce((p,x,v)=>{let T=a[v];if(T&&T.call){let M=T(l),_=M&&M.props&&M.props.className||/^go/.test(M)&&M;T=_?"."+_:M&&typeof M=="object"?M.props?"":Eu(M,""):M===!1?"":M}return p+x+(T??"")},"");function _g(r){let a=this||{},l=r.call?r(a.p):r;return Kce(l.unshift?l.raw?$ce(l,[].slice.call(arguments,1),a.p):l.reduce((p,x)=>Object.assign(p,x&&x.call?x(a.p):x),{}):l,zce(a.target),a.g,a.o,a.k)}let wO,_w,Vw;_g.bind({g:1});let Tl=_g.bind({k:1});function Uce(r,a,l,p){Eu.p=a,wO=r,_w=l,Vw=p}function Hu(r,a){let l=this||{};return function(){let p=arguments;function x(v,T){let M=Object.assign({},v),_=M.className||x.className;l.p=Object.assign({theme:_w&&_w()},M),l.o=/ *go\d+/.test(_),M.className=_g.apply(l,p)+(_?" "+_:"");let O=r;return r[0]&&(O=M.as||r,delete M.as),Vw&&O[0]&&Vw(M),wO(O,M)}return x}}var Hce=r=>typeof r=="function",dg=(r,a)=>Hce(r)?r(a):r,jce=(()=>{let r=0;return()=>(++r).toString()})(),vO=(()=>{let r;return()=>{if(r===void 0&&typeof window<"u"){let a=matchMedia("(prefers-reduced-motion: reduce)");r=!a||a.matches}return r}})(),Yce=20,oI="default",IO=(r,a)=>{let{toastLimit:l}=r.settings;switch(a.type){case 0:return{...r,toasts:[a.toast,...r.toasts].slice(0,l)};case 1:return{...r,toasts:r.toasts.map(T=>T.id===a.toast.id?{...T,...a.toast}:T)};case 2:let{toast:p}=a;return IO(r,{type:r.toasts.find(T=>T.id===p.id)?1:0,toast:p});case 3:let{toastId:x}=a;return{...r,toasts:r.toasts.map(T=>T.id===x||x===void 0?{...T,dismissed:!0,visible:!1}:T)};case 4:return a.toastId===void 0?{...r,toasts:[]}:{...r,toasts:r.toasts.filter(T=>T.id!==a.toastId)};case 5:return{...r,pausedAt:a.time};case 6:let v=a.time-(r.pausedAt||0);return{...r,pausedAt:void 0,toasts:r.toasts.map(T=>({...T,pauseDuration:T.pauseDuration+v}))}}},Pm=[],CO={toasts:[],pausedAt:void 0,settings:{toastLimit:Yce}},Ro={},SO=(r,a=oI)=>{Ro[a]=IO(Ro[a]||CO,r),Pm.forEach(([l,p])=>{l===a&&p(Ro[a])})},TO=r=>Object.keys(Ro).forEach(a=>SO(r,a)),Qce=r=>Object.keys(Ro).find(a=>Ro[a].toasts.some(l=>l.id===r)),Vg=(r=oI)=>a=>{SO(a,r)},Jce={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},qce=(r={},a=oI)=>{let[l,p]=Ge.useState(Ro[a]||CO),x=Ge.useRef(Ro[a]);Ge.useEffect(()=>(x.current!==Ro[a]&&p(Ro[a]),Pm.push([a,p]),()=>{let T=Pm.findIndex(([M])=>M===a);T>-1&&Pm.splice(T,1)}),[a]);let v=l.toasts.map(T=>{var M,_,O;return{...r,...r[T.type],...T,removeDelay:T.removeDelay||((M=r[T.type])==null?void 0:M.removeDelay)||(r==null?void 0:r.removeDelay),duration:T.duration||((_=r[T.type])==null?void 0:_.duration)||(r==null?void 0:r.duration)||Jce[T.type],style:{...r.style,...(O=r[T.type])==null?void 0:O.style,...T.style}}});return{...l,toasts:v}},ehe=(r,a="blank",l)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:a,ariaProps:{role:"status","aria-live":"polite"},message:r,pauseDuration:0,...l,id:(l==null?void 0:l.id)||jce()}),y0=r=>(a,l)=>{let p=ehe(a,r,l);return Vg(p.toasterId||Qce(p.id))({type:2,toast:p}),p.id},Sr=(r,a)=>y0("blank")(r,a);Sr.error=y0("error");Sr.success=y0("success");Sr.loading=y0("loading");Sr.custom=y0("custom");Sr.dismiss=(r,a)=>{let l={type:3,toastId:r};a?Vg(a)(l):TO(l)};Sr.dismissAll=r=>Sr.dismiss(void 0,r);Sr.remove=(r,a)=>{let l={type:4,toastId:r};a?Vg(a)(l):TO(l)};Sr.removeAll=r=>Sr.remove(void 0,r);Sr.promise=(r,a,l)=>{let p=Sr.loading(a.loading,{...l,...l==null?void 0:l.loading});return typeof r=="function"&&(r=r()),r.then(x=>{let v=a.success?dg(a.success,x):void 0;return v?Sr.success(v,{id:p,...l,...l==null?void 0:l.success}):Sr.dismiss(p),x}).catch(x=>{let v=a.error?dg(a.error,x):void 0;v?Sr.error(v,{id:p,...l,...l==null?void 0:l.error}):Sr.dismiss(p)}),r};var the=1e3,nhe=(r,a="default")=>{let{toasts:l,pausedAt:p}=qce(r,a),x=Ge.useRef(new Map).current,v=Ge.useCallback((D,$=the)=>{if(x.has(D))return;let re=setTimeout(()=>{x.delete(D),T({type:4,toastId:D})},$);x.set(D,re)},[]);Ge.useEffect(()=>{if(p)return;let D=Date.now(),$=l.map(re=>{if(re.duration===1/0)return;let H=(re.duration||0)+re.pauseDuration-(D-re.createdAt);if(H<0){re.visible&&Sr.dismiss(re.id);return}return setTimeout(()=>Sr.dismiss(re.id,a),H)});return()=>{$.forEach(re=>re&&clearTimeout(re))}},[l,p,a]);let T=Ge.useCallback(Vg(a),[a]),M=Ge.useCallback(()=>{T({type:5,time:Date.now()})},[T]),_=Ge.useCallback((D,$)=>{T({type:1,toast:{id:D,height:$}})},[T]),O=Ge.useCallback(()=>{p&&T({type:6,time:Date.now()})},[p,T]),V=Ge.useCallback((D,$)=>{let{reverseOrder:re=!1,gutter:H=8,defaultPosition:se}=$||{},Ee=l.filter(j=>(j.position||se)===(D.position||se)&&j.height),ee=Ee.findIndex(j=>j.id===D.id),Y=Ee.filter((j,fe)=>fe<ee&&j.visible).length;return Ee.filter(j=>j.visible).slice(...re?[Y+1]:[0,Y]).reduce((j,fe)=>j+(fe.height||0)+H,0)},[l]);return Ge.useEffect(()=>{l.forEach(D=>{if(D.dismissed)v(D.id,D.removeDelay);else{let $=x.get(D.id);$&&(clearTimeout($),x.delete(D.id))}})},[l,v]),{toasts:l,handlers:{updateHeight:_,startPause:M,endPause:O,calculateOffset:V}}},rhe=Tl`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,she=Tl`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,ihe=Tl`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,ahe=Hu("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${r=>r.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${rhe} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${she} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${r=>r.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${ihe} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,ohe=Tl`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,lhe=Hu("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${r=>r.secondary||"#e0e0e0"};
  border-right-color: ${r=>r.primary||"#616161"};
  animation: ${ohe} 1s linear infinite;
`,uhe=Tl`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,che=Tl`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,hhe=Hu("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${r=>r.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${uhe} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${che} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${r=>r.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,dhe=Hu("div")`
  position: absolute;
`,fhe=Hu("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,phe=Tl`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,mhe=Hu("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${phe} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,ghe=({toast:r})=>{let{icon:a,type:l,iconTheme:p}=r;return a!==void 0?typeof a=="string"?Ge.createElement(mhe,null,a):a:l==="blank"?null:Ge.createElement(fhe,null,Ge.createElement(lhe,{...p}),l!=="loading"&&Ge.createElement(dhe,null,l==="error"?Ge.createElement(ahe,{...p}):Ge.createElement(hhe,{...p})))},xhe=r=>`
0% {transform: translate3d(0,${r*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,yhe=r=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${r*-150}%,-1px) scale(.6); opacity:0;}
`,bhe="0%{opacity:0;} 100%{opacity:1;}",whe="0%{opacity:1;} 100%{opacity:0;}",vhe=Hu("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,Ihe=Hu("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Che=(r,a)=>{let l=r.includes("top")?1:-1,[p,x]=vO()?[bhe,whe]:[xhe(l),yhe(l)];return{animation:a?`${Tl(p)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${Tl(x)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},She=Ge.memo(({toast:r,position:a,style:l,children:p})=>{let x=r.height?Che(r.position||a||"top-center",r.visible):{opacity:0},v=Ge.createElement(ghe,{toast:r}),T=Ge.createElement(Ihe,{...r.ariaProps},dg(r.message,r));return Ge.createElement(vhe,{className:r.className,style:{...x,...l,...r.style}},typeof p=="function"?p({icon:v,message:T}):Ge.createElement(Ge.Fragment,null,v,T))});Uce(Ge.createElement);var The=({id:r,className:a,style:l,onHeightUpdate:p,children:x})=>{let v=Ge.useCallback(T=>{if(T){let M=()=>{let _=T.getBoundingClientRect().height;p(r,_)};M(),new MutationObserver(M).observe(T,{subtree:!0,childList:!0,characterData:!0})}},[r,p]);return Ge.createElement("div",{ref:v,className:a,style:l},x)},khe=(r,a)=>{let l=r.includes("top"),p=l?{top:0}:{bottom:0},x=r.includes("center")?{justifyContent:"center"}:r.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:vO()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${a*(l?1:-1)}px)`,...p,...x}},Ehe=_g`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,xm=16,Nhe=({reverseOrder:r,position:a="top-center",toastOptions:l,gutter:p,children:x,toasterId:v,containerStyle:T,containerClassName:M})=>{let{toasts:_,handlers:O}=nhe(l,v);return Ge.createElement("div",{"data-rht-toaster":v||"",style:{position:"fixed",zIndex:9999,top:xm,left:xm,right:xm,bottom:xm,pointerEvents:"none",...T},className:M,onMouseEnter:O.startPause,onMouseLeave:O.endPause},_.map(V=>{let D=V.position||a,$=O.calculateOffset(V,{reverseOrder:r,gutter:p,defaultPosition:a}),re=khe(D,$);return Ge.createElement(The,{id:V.id,key:V.id,onHeightUpdate:O.updateHeight,className:V.visible?Ehe:"",style:re},V.type==="custom"?dg(V.message,V):x?x(V):Ge.createElement(She,{toast:V,position:D}))}))};const lI=Ge.createContext({});function uI(r){const a=Ge.useRef(null);return a.current===null&&(a.current=r()),a.current}const kO=typeof window<"u",EO=kO?Ge.useLayoutEffect:Ge.useEffect,Bg=Ge.createContext(null);function cI(r,a){r.indexOf(a)===-1&&r.push(a)}function hI(r,a){const l=r.indexOf(a);l>-1&&r.splice(l,1)}const Oo=(r,a,l)=>l>a?a:l<r?r:l;let dI=()=>{};const kl={},NO=r=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(r);function AO(r){return typeof r=="object"&&r!==null}const RO=r=>/^0[^.\s]+$/u.test(r);function fI(r){let a;return()=>(a===void 0&&(a=r()),a)}const xa=r=>r,Ahe=(r,a)=>l=>a(r(l)),b0=(...r)=>r.reduce(Ahe),o0=(r,a,l)=>{const p=a-r;return p===0?1:(l-r)/p};class pI{constructor(){this.subscriptions=[]}add(a){return cI(this.subscriptions,a),()=>hI(this.subscriptions,a)}notify(a,l,p){const x=this.subscriptions.length;if(x)if(x===1)this.subscriptions[0](a,l,p);else for(let v=0;v<x;v++){const T=this.subscriptions[v];T&&T(a,l,p)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const wl=r=>r*1e3,ma=r=>r/1e3;function MO(r,a){return a?r*(1e3/a):0}const LO=(r,a,l)=>(((1-3*l+3*a)*r+(3*l-6*a))*r+3*a)*r,Rhe=1e-7,Mhe=12;function Lhe(r,a,l,p,x){let v,T,M=0;do T=a+(l-a)/2,v=LO(T,p,x)-r,v>0?l=T:a=T;while(Math.abs(v)>Rhe&&++M<Mhe);return T}function w0(r,a,l,p){if(r===a&&l===p)return xa;const x=v=>Lhe(v,0,1,r,l);return v=>v===0||v===1?v:LO(x(v),a,p)}const DO=r=>a=>a<=.5?r(2*a)/2:(2-r(2*(1-a)))/2,OO=r=>a=>1-r(1-a),PO=w0(.33,1.53,.69,.99),mI=OO(PO),FO=DO(mI),GO=r=>(r*=2)<1?.5*mI(r):.5*(2-Math.pow(2,-10*(r-1))),gI=r=>1-Math.sin(Math.acos(r)),_O=OO(gI),VO=DO(gI),Dhe=w0(.42,0,1,1),Ohe=w0(0,0,.58,1),BO=w0(.42,0,.58,1),Phe=r=>Array.isArray(r)&&typeof r[0]!="number",WO=r=>Array.isArray(r)&&typeof r[0]=="number",Fhe={linear:xa,easeIn:Dhe,easeInOut:BO,easeOut:Ohe,circIn:gI,circInOut:VO,circOut:_O,backIn:mI,backInOut:FO,backOut:PO,anticipate:GO},Ghe=r=>typeof r=="string",CM=r=>{if(WO(r)){dI(r.length===4);const[a,l,p,x]=r;return w0(a,l,p,x)}else if(Ghe(r))return Fhe[r];return r},ym=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function _he(r,a){let l=new Set,p=new Set,x=!1,v=!1;const T=new WeakSet;let M={delta:0,timestamp:0,isProcessing:!1};function _(V){T.has(V)&&(O.schedule(V),r()),V(M)}const O={schedule:(V,D=!1,$=!1)=>{const H=$&&x?l:p;return D&&T.add(V),H.has(V)||H.add(V),V},cancel:V=>{p.delete(V),T.delete(V)},process:V=>{if(M=V,x){v=!0;return}x=!0,[l,p]=[p,l],l.forEach(_),l.clear(),x=!1,v&&(v=!1,O.process(V))}};return O}const Vhe=40;function zO(r,a){let l=!1,p=!0;const x={delta:0,timestamp:0,isProcessing:!1},v=()=>l=!0,T=ym.reduce((j,fe)=>(j[fe]=_he(v),j),{}),{setup:M,read:_,resolveKeyframes:O,preUpdate:V,update:D,preRender:$,render:re,postRender:H}=T,se=()=>{const j=kl.useManualTiming?x.timestamp:performance.now();l=!1,kl.useManualTiming||(x.delta=p?1e3/60:Math.max(Math.min(j-x.timestamp,Vhe),1)),x.timestamp=j,x.isProcessing=!0,M.process(x),_.process(x),O.process(x),V.process(x),D.process(x),$.process(x),re.process(x),H.process(x),x.isProcessing=!1,l&&a&&(p=!1,r(se))},Ee=()=>{l=!0,p=!0,x.isProcessing||r(se)};return{schedule:ym.reduce((j,fe)=>{const be=T[fe];return j[fe]=(Fe,ue=!1,we=!1)=>(l||Ee(),be.schedule(Fe,ue,we)),j},{}),cancel:j=>{for(let fe=0;fe<ym.length;fe++)T[ym[fe]].cancel(j)},state:x,steps:T}}const{schedule:Jn,cancel:zu,state:xs,steps:k2}=zO(typeof requestAnimationFrame<"u"?requestAnimationFrame:xa,!0);let Fm;function Bhe(){Fm=void 0}const Hs={now:()=>(Fm===void 0&&Hs.set(xs.isProcessing||kl.useManualTiming?xs.timestamp:performance.now()),Fm),set:r=>{Fm=r,queueMicrotask(Bhe)}},XO=r=>a=>typeof a=="string"&&a.startsWith(r),ZO=XO("--"),Whe=XO("var(--"),xI=r=>Whe(r)?zhe.test(r.split("/*")[0].trim()):!1,zhe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu;function SM(r){return typeof r!="string"?!1:r.split("/*")[0].includes("var(--")}const of={test:r=>typeof r=="number",parse:parseFloat,transform:r=>r},l0={...of,transform:r=>Oo(0,1,r)},bm={...of,default:1},Bp=r=>Math.round(r*1e5)/1e5,yI=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function Xhe(r){return r==null}const Zhe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,bI=(r,a)=>l=>!!(typeof l=="string"&&Zhe.test(l)&&l.startsWith(r)||a&&!Xhe(l)&&Object.prototype.hasOwnProperty.call(l,a)),KO=(r,a,l)=>p=>{if(typeof p!="string")return p;const[x,v,T,M]=p.match(yI);return{[r]:parseFloat(x),[a]:parseFloat(v),[l]:parseFloat(T),alpha:M!==void 0?parseFloat(M):1}},Khe=r=>Oo(0,255,r),E2={...of,transform:r=>Math.round(Khe(r))},lh={test:bI("rgb","red"),parse:KO("red","green","blue"),transform:({red:r,green:a,blue:l,alpha:p=1})=>"rgba("+E2.transform(r)+", "+E2.transform(a)+", "+E2.transform(l)+", "+Bp(l0.transform(p))+")"};function $he(r){let a="",l="",p="",x="";return r.length>5?(a=r.substring(1,3),l=r.substring(3,5),p=r.substring(5,7),x=r.substring(7,9)):(a=r.substring(1,2),l=r.substring(2,3),p=r.substring(3,4),x=r.substring(4,5),a+=a,l+=l,p+=p,x+=x),{red:parseInt(a,16),green:parseInt(l,16),blue:parseInt(p,16),alpha:x?parseInt(x,16)/255:1}}const Bw={test:bI("#"),parse:$he,transform:lh.transform},v0=r=>({test:a=>typeof a=="string"&&a.endsWith(r)&&a.split(" ").length===1,parse:parseFloat,transform:a=>`${a}${r}`}),Iu=v0("deg"),Do=v0("%"),mt=v0("px"),Uhe=v0("vh"),Hhe=v0("vw"),TM={...Do,parse:r=>Do.parse(r)/100,transform:r=>Do.transform(r*100)},_d={test:bI("hsl","hue"),parse:KO("hue","saturation","lightness"),transform:({hue:r,saturation:a,lightness:l,alpha:p=1})=>"hsla("+Math.round(r)+", "+Do.transform(Bp(a))+", "+Do.transform(Bp(l))+", "+Bp(l0.transform(p))+")"},_r={test:r=>lh.test(r)||Bw.test(r)||_d.test(r),parse:r=>lh.test(r)?lh.parse(r):_d.test(r)?_d.parse(r):Bw.parse(r),transform:r=>typeof r=="string"?r:r.hasOwnProperty("red")?lh.transform(r):_d.transform(r),getAnimatableNone:r=>{const a=_r.parse(r);return a.alpha=0,_r.transform(a)}},jhe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Yhe(r){var a,l;return isNaN(r)&&typeof r=="string"&&(((a=r.match(yI))==null?void 0:a.length)||0)+(((l=r.match(jhe))==null?void 0:l.length)||0)>0}const $O="number",UO="color",Qhe="var",Jhe="var(",kM="${}",qhe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function u0(r){const a=r.toString(),l=[],p={color:[],number:[],var:[]},x=[];let v=0;const M=a.replace(qhe,_=>(_r.test(_)?(p.color.push(v),x.push(UO),l.push(_r.parse(_))):_.startsWith(Jhe)?(p.var.push(v),x.push(Qhe),l.push(_)):(p.number.push(v),x.push($O),l.push(parseFloat(_))),++v,kM)).split(kM);return{values:l,split:M,indexes:p,types:x}}function HO(r){return u0(r).values}function jO(r){const{split:a,types:l}=u0(r),p=a.length;return x=>{let v="";for(let T=0;T<p;T++)if(v+=a[T],x[T]!==void 0){const M=l[T];M===$O?v+=Bp(x[T]):M===UO?v+=_r.transform(x[T]):v+=x[T]}return v}}const ede=r=>typeof r=="number"?0:_r.test(r)?_r.getAnimatableNone(r):r;function tde(r){const a=HO(r);return jO(r)(a.map(ede))}const Xu={test:Yhe,parse:HO,createTransformer:jO,getAnimatableNone:tde};function N2(r,a,l){return l<0&&(l+=1),l>1&&(l-=1),l<1/6?r+(a-r)*6*l:l<1/2?a:l<2/3?r+(a-r)*(2/3-l)*6:r}function nde({hue:r,saturation:a,lightness:l,alpha:p}){r/=360,a/=100,l/=100;let x=0,v=0,T=0;if(!a)x=v=T=l;else{const M=l<.5?l*(1+a):l+a-l*a,_=2*l-M;x=N2(_,M,r+1/3),v=N2(_,M,r),T=N2(_,M,r-1/3)}return{red:Math.round(x*255),green:Math.round(v*255),blue:Math.round(T*255),alpha:p}}function fg(r,a){return l=>l>0?a:r}const ur=(r,a,l)=>r+(a-r)*l,A2=(r,a,l)=>{const p=r*r,x=l*(a*a-p)+p;return x<0?0:Math.sqrt(x)},rde=[Bw,lh,_d],sde=r=>rde.find(a=>a.test(r));function EM(r){const a=sde(r);if(!a)return!1;let l=a.parse(r);return a===_d&&(l=nde(l)),l}const NM=(r,a)=>{const l=EM(r),p=EM(a);if(!l||!p)return fg(r,a);const x={...l};return v=>(x.red=A2(l.red,p.red,v),x.green=A2(l.green,p.green,v),x.blue=A2(l.blue,p.blue,v),x.alpha=ur(l.alpha,p.alpha,v),lh.transform(x))},Ww=new Set(["none","hidden"]);function ide(r,a){return Ww.has(r)?l=>l<=0?r:a:l=>l>=1?a:r}function ade(r,a){return l=>ur(r,a,l)}function wI(r){return typeof r=="number"?ade:typeof r=="string"?xI(r)?fg:_r.test(r)?NM:ude:Array.isArray(r)?YO:typeof r=="object"?_r.test(r)?NM:ode:fg}function YO(r,a){const l=[...r],p=l.length,x=r.map((v,T)=>wI(v)(v,a[T]));return v=>{for(let T=0;T<p;T++)l[T]=x[T](v);return l}}function ode(r,a){const l={...r,...a},p={};for(const x in l)r[x]!==void 0&&a[x]!==void 0&&(p[x]=wI(r[x])(r[x],a[x]));return x=>{for(const v in p)l[v]=p[v](x);return l}}function lde(r,a){const l=[],p={color:0,var:0,number:0};for(let x=0;x<a.values.length;x++){const v=a.types[x],T=r.indexes[v][p[v]],M=r.values[T]??0;l[x]=M,p[v]++}return l}const ude=(r,a)=>{const l=Xu.createTransformer(a),p=u0(r),x=u0(a);return p.indexes.var.length===x.indexes.var.length&&p.indexes.color.length===x.indexes.color.length&&p.indexes.number.length>=x.indexes.number.length?Ww.has(r)&&!x.values.length||Ww.has(a)&&!p.values.length?ide(r,a):b0(YO(lde(p,x),x.values),l):fg(r,a)};function QO(r,a,l){return typeof r=="number"&&typeof a=="number"&&typeof l=="number"?ur(r,a,l):wI(r)(r,a)}const cde=r=>{const a=({timestamp:l})=>r(l);return{start:(l=!0)=>Jn.update(a,l),stop:()=>zu(a),now:()=>xs.isProcessing?xs.timestamp:Hs.now()}},JO=(r,a,l=10)=>{let p="";const x=Math.max(Math.round(a/l),2);for(let v=0;v<x;v++)p+=Math.round(r(v/(x-1))*1e4)/1e4+", ";return`linear(${p.substring(0,p.length-2)})`},pg=2e4;function vI(r){let a=0;const l=50;let p=r.next(a);for(;!p.done&&a<pg;)a+=l,p=r.next(a);return a>=pg?1/0:a}function hde(r,a=100,l){const p=l({...r,keyframes:[0,a]}),x=Math.min(vI(p),pg);return{type:"keyframes",ease:v=>p.next(x*v).value/a,duration:ma(x)}}const dde=5;function qO(r,a,l){const p=Math.max(a-dde,0);return MO(l-r(p),a-p)}const Ir={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},R2=.001;function fde({duration:r=Ir.duration,bounce:a=Ir.bounce,velocity:l=Ir.velocity,mass:p=Ir.mass}){let x,v,T=1-a;T=Oo(Ir.minDamping,Ir.maxDamping,T),r=Oo(Ir.minDuration,Ir.maxDuration,ma(r)),T<1?(x=O=>{const V=O*T,D=V*r,$=V-l,re=zw(O,T),H=Math.exp(-D);return R2-$/re*H},v=O=>{const D=O*T*r,$=D*l+l,re=Math.pow(T,2)*Math.pow(O,2)*r,H=Math.exp(-D),se=zw(Math.pow(O,2),T);return(-x(O)+R2>0?-1:1)*(($-re)*H)/se}):(x=O=>{const V=Math.exp(-O*r),D=(O-l)*r+1;return-R2+V*D},v=O=>{const V=Math.exp(-O*r),D=(l-O)*(r*r);return V*D});const M=5/r,_=mde(x,v,M);if(r=wl(r),isNaN(_))return{stiffness:Ir.stiffness,damping:Ir.damping,duration:r};{const O=Math.pow(_,2)*p;return{stiffness:O,damping:T*2*Math.sqrt(p*O),duration:r}}}const pde=12;function mde(r,a,l){let p=l;for(let x=1;x<pde;x++)p=p-r(p)/a(p);return p}function zw(r,a){return r*Math.sqrt(1-a*a)}const gde=["duration","bounce"],xde=["stiffness","damping","mass"];function AM(r,a){return a.some(l=>r[l]!==void 0)}function yde(r){let a={velocity:Ir.velocity,stiffness:Ir.stiffness,damping:Ir.damping,mass:Ir.mass,isResolvedFromDuration:!1,...r};if(!AM(r,xde)&&AM(r,gde))if(r.visualDuration){const l=r.visualDuration,p=2*Math.PI/(l*1.2),x=p*p,v=2*Oo(.05,1,1-(r.bounce||0))*Math.sqrt(x);a={...a,mass:Ir.mass,stiffness:x,damping:v}}else{const l=fde(r);a={...a,...l,mass:Ir.mass},a.isResolvedFromDuration=!0}return a}function mg(r=Ir.visualDuration,a=Ir.bounce){const l=typeof r!="object"?{visualDuration:r,keyframes:[0,1],bounce:a}:r;let{restSpeed:p,restDelta:x}=l;const v=l.keyframes[0],T=l.keyframes[l.keyframes.length-1],M={done:!1,value:v},{stiffness:_,damping:O,mass:V,duration:D,velocity:$,isResolvedFromDuration:re}=yde({...l,velocity:-ma(l.velocity||0)}),H=$||0,se=O/(2*Math.sqrt(_*V)),Ee=T-v,ee=ma(Math.sqrt(_/V)),Y=Math.abs(Ee)<5;p||(p=Y?Ir.restSpeed.granular:Ir.restSpeed.default),x||(x=Y?Ir.restDelta.granular:Ir.restDelta.default);let j;if(se<1){const be=zw(ee,se);j=Fe=>{const ue=Math.exp(-se*ee*Fe);return T-ue*((H+se*ee*Ee)/be*Math.sin(be*Fe)+Ee*Math.cos(be*Fe))}}else if(se===1)j=be=>T-Math.exp(-ee*be)*(Ee+(H+ee*Ee)*be);else{const be=ee*Math.sqrt(se*se-1);j=Fe=>{const ue=Math.exp(-se*ee*Fe),we=Math.min(be*Fe,300);return T-ue*((H+se*ee*Ee)*Math.sinh(we)+be*Ee*Math.cosh(we))/be}}const fe={calculatedDuration:re&&D||null,next:be=>{const Fe=j(be);if(re)M.done=be>=D;else{let ue=be===0?H:0;se<1&&(ue=be===0?wl(H):qO(j,be,Fe));const we=Math.abs(ue)<=p,Ne=Math.abs(T-Fe)<=x;M.done=we&&Ne}return M.value=M.done?T:Fe,M},toString:()=>{const be=Math.min(vI(fe),pg),Fe=JO(ue=>fe.next(be*ue).value,be,30);return be+"ms "+Fe},toTransition:()=>{}};return fe}mg.applyToOptions=r=>{const a=hde(r,100,mg);return r.ease=a.ease,r.duration=wl(a.duration),r.type="keyframes",r};function Xw({keyframes:r,velocity:a=0,power:l=.8,timeConstant:p=325,bounceDamping:x=10,bounceStiffness:v=500,modifyTarget:T,min:M,max:_,restDelta:O=.5,restSpeed:V}){const D=r[0],$={done:!1,value:D},re=we=>M!==void 0&&we<M||_!==void 0&&we>_,H=we=>M===void 0?_:_===void 0||Math.abs(M-we)<Math.abs(_-we)?M:_;let se=l*a;const Ee=D+se,ee=T===void 0?Ee:T(Ee);ee!==Ee&&(se=ee-D);const Y=we=>-se*Math.exp(-we/p),j=we=>ee+Y(we),fe=we=>{const Ne=Y(we),it=j(we);$.done=Math.abs(Ne)<=O,$.value=$.done?ee:it};let be,Fe;const ue=we=>{re($.value)&&(be=we,Fe=mg({keyframes:[$.value,H($.value)],velocity:qO(j,we,$.value),damping:x,stiffness:v,restDelta:O,restSpeed:V}))};return ue(0),{calculatedDuration:null,next:we=>{let Ne=!1;return!Fe&&be===void 0&&(Ne=!0,fe(we),ue(we)),be!==void 0&&we>=be?Fe.next(we-be):(!Ne&&fe(we),$)}}}function bde(r,a,l){const p=[],x=l||kl.mix||QO,v=r.length-1;for(let T=0;T<v;T++){let M=x(r[T],r[T+1]);if(a){const _=Array.isArray(a)?a[T]||xa:a;M=b0(_,M)}p.push(M)}return p}function wde(r,a,{clamp:l=!0,ease:p,mixer:x}={}){const v=r.length;if(dI(v===a.length),v===1)return()=>a[0];if(v===2&&a[0]===a[1])return()=>a[1];const T=r[0]===r[1];r[0]>r[v-1]&&(r=[...r].reverse(),a=[...a].reverse());const M=bde(a,p,x),_=M.length,O=V=>{if(T&&V<r[0])return a[0];let D=0;if(_>1)for(;D<r.length-2&&!(V<r[D+1]);D++);const $=o0(r[D],r[D+1],V);return M[D]($)};return l?V=>O(Oo(r[0],r[v-1],V)):O}function vde(r,a){const l=r[r.length-1];for(let p=1;p<=a;p++){const x=o0(0,a,p);r.push(ur(l,1,x))}}function Ide(r){const a=[0];return vde(a,r.length-1),a}function Cde(r,a){return r.map(l=>l*a)}function Sde(r,a){return r.map(()=>a||BO).splice(0,r.length-1)}function Wp({duration:r=300,keyframes:a,times:l,ease:p="easeInOut"}){const x=Phe(p)?p.map(CM):CM(p),v={done:!1,value:a[0]},T=Cde(l&&l.length===a.length?l:Ide(a),r),M=wde(T,a,{ease:Array.isArray(x)?x:Sde(a,x)});return{calculatedDuration:r,next:_=>(v.value=M(_),v.done=_>=r,v)}}const Tde=r=>r!==null;function II(r,{repeat:a,repeatType:l="loop"},p,x=1){const v=r.filter(Tde),M=x<0||a&&l!=="loop"&&a%2===1?0:v.length-1;return!M||p===void 0?v[M]:p}const kde={decay:Xw,inertia:Xw,tween:Wp,keyframes:Wp,spring:mg};function e5(r){typeof r.type=="string"&&(r.type=kde[r.type])}class CI{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(a=>{this.resolve=a})}notifyFinished(){this.resolve()}then(a,l){return this.finished.then(a,l)}}const Ede=r=>r/100;class SI extends CI{constructor(a){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var p,x;const{motionValue:l}=this.options;l&&l.updatedAt!==Hs.now()&&this.tick(Hs.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(x=(p=this.options).onStop)==null||x.call(p))},this.options=a,this.initAnimation(),this.play(),a.autoplay===!1&&this.pause()}initAnimation(){const{options:a}=this;e5(a);const{type:l=Wp,repeat:p=0,repeatDelay:x=0,repeatType:v,velocity:T=0}=a;let{keyframes:M}=a;const _=l||Wp;_!==Wp&&typeof M[0]!="number"&&(this.mixKeyframes=b0(Ede,QO(M[0],M[1])),M=[0,100]);const O=_({...a,keyframes:M});v==="mirror"&&(this.mirroredGenerator=_({...a,keyframes:[...M].reverse(),velocity:-T})),O.calculatedDuration===null&&(O.calculatedDuration=vI(O));const{calculatedDuration:V}=O;this.calculatedDuration=V,this.resolvedDuration=V+x,this.totalDuration=this.resolvedDuration*(p+1)-x,this.generator=O}updateTime(a){const l=Math.round(a-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=l}tick(a,l=!1){const{generator:p,totalDuration:x,mixKeyframes:v,mirroredGenerator:T,resolvedDuration:M,calculatedDuration:_}=this;if(this.startTime===null)return p.next(0);const{delay:O=0,keyframes:V,repeat:D,repeatType:$,repeatDelay:re,type:H,onUpdate:se,finalKeyframe:Ee}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,a):this.speed<0&&(this.startTime=Math.min(a-x/this.speed,this.startTime)),l?this.currentTime=a:this.updateTime(a);const ee=this.currentTime-O*(this.playbackSpeed>=0?1:-1),Y=this.playbackSpeed>=0?ee<0:ee>x;this.currentTime=Math.max(ee,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=x);let j=this.currentTime,fe=p;if(D){const we=Math.min(this.currentTime,x)/M;let Ne=Math.floor(we),it=we%1;!it&&we>=1&&(it=1),it===1&&Ne--,Ne=Math.min(Ne,D+1),!!(Ne%2)&&($==="reverse"?(it=1-it,re&&(it-=re/M)):$==="mirror"&&(fe=T)),j=Oo(0,1,it)*M}const be=Y?{done:!1,value:V[0]}:fe.next(j);v&&(be.value=v(be.value));let{done:Fe}=be;!Y&&_!==null&&(Fe=this.playbackSpeed>=0?this.currentTime>=x:this.currentTime<=0);const ue=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&Fe);return ue&&H!==Xw&&(be.value=II(V,this.options,Ee,this.speed)),se&&se(be.value),ue&&this.finish(),be}then(a,l){return this.finished.then(a,l)}get duration(){return ma(this.calculatedDuration)}get iterationDuration(){const{delay:a=0}=this.options||{};return this.duration+ma(a)}get time(){return ma(this.currentTime)}set time(a){var l;a=wl(a),this.currentTime=a,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=a:this.driver&&(this.startTime=this.driver.now()-a/this.playbackSpeed),(l=this.driver)==null||l.start(!1)}get speed(){return this.playbackSpeed}set speed(a){this.updateTime(Hs.now());const l=this.playbackSpeed!==a;this.playbackSpeed=a,l&&(this.time=ma(this.currentTime))}play(){var x,v;if(this.isStopped)return;const{driver:a=cde,startTime:l}=this.options;this.driver||(this.driver=a(T=>this.tick(T))),(v=(x=this.options).onPlay)==null||v.call(x);const p=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=p):this.holdTime!==null?this.startTime=p-this.holdTime:this.startTime||(this.startTime=l??p),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Hs.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var a,l;this.notifyFinished(),this.teardown(),this.state="finished",(l=(a=this.options).onComplete)==null||l.call(a)}cancel(){var a,l;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(l=(a=this.options).onCancel)==null||l.call(a)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(a){return this.startTime=0,this.tick(a,!0)}attachTimeline(a){var l;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(l=this.driver)==null||l.stop(),a.observe(this)}}function Nde(r){for(let a=1;a<r.length;a++)r[a]??(r[a]=r[a-1])}const uh=r=>r*180/Math.PI,Zw=r=>{const a=uh(Math.atan2(r[1],r[0]));return Kw(a)},Ade={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:r=>(Math.abs(r[0])+Math.abs(r[3]))/2,rotate:Zw,rotateZ:Zw,skewX:r=>uh(Math.atan(r[1])),skewY:r=>uh(Math.atan(r[2])),skew:r=>(Math.abs(r[1])+Math.abs(r[2]))/2},Kw=r=>(r=r%360,r<0&&(r+=360),r),RM=Zw,MM=r=>Math.sqrt(r[0]*r[0]+r[1]*r[1]),LM=r=>Math.sqrt(r[4]*r[4]+r[5]*r[5]),Rde={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:MM,scaleY:LM,scale:r=>(MM(r)+LM(r))/2,rotateX:r=>Kw(uh(Math.atan2(r[6],r[5]))),rotateY:r=>Kw(uh(Math.atan2(-r[2],r[0]))),rotateZ:RM,rotate:RM,skewX:r=>uh(Math.atan(r[4])),skewY:r=>uh(Math.atan(r[1])),skew:r=>(Math.abs(r[1])+Math.abs(r[4]))/2};function $w(r){return r.includes("scale")?1:0}function Uw(r,a){if(!r||r==="none")return $w(a);const l=r.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let p,x;if(l)p=Rde,x=l;else{const M=r.match(/^matrix\(([-\d.e\s,]+)\)$/u);p=Ade,x=M}if(!x)return $w(a);const v=p[a],T=x[1].split(",").map(Lde);return typeof v=="function"?v(T):T[v]}const Mde=(r,a)=>{const{transform:l="none"}=getComputedStyle(r);return Uw(l,a)};function Lde(r){return parseFloat(r.trim())}const lf=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],uf=new Set(lf),DM=r=>r===of||r===mt,Dde=new Set(["x","y","z"]),Ode=lf.filter(r=>!Dde.has(r));function Pde(r){const a=[];return Ode.forEach(l=>{const p=r.getValue(l);p!==void 0&&(a.push([l,p.get()]),p.set(l.startsWith("scale")?1:0))}),a}const Ru={width:({x:r},{paddingLeft:a="0",paddingRight:l="0"})=>r.max-r.min-parseFloat(a)-parseFloat(l),height:({y:r},{paddingTop:a="0",paddingBottom:l="0"})=>r.max-r.min-parseFloat(a)-parseFloat(l),top:(r,{top:a})=>parseFloat(a),left:(r,{left:a})=>parseFloat(a),bottom:({y:r},{top:a})=>parseFloat(a)+(r.max-r.min),right:({x:r},{left:a})=>parseFloat(a)+(r.max-r.min),x:(r,{transform:a})=>Uw(a,"x"),y:(r,{transform:a})=>Uw(a,"y")};Ru.translateX=Ru.x;Ru.translateY=Ru.y;const dh=new Set;let Hw=!1,jw=!1,Yw=!1;function t5(){if(jw){const r=Array.from(dh).filter(p=>p.needsMeasurement),a=new Set(r.map(p=>p.element)),l=new Map;a.forEach(p=>{const x=Pde(p);x.length&&(l.set(p,x),p.render())}),r.forEach(p=>p.measureInitialState()),a.forEach(p=>{p.render();const x=l.get(p);x&&x.forEach(([v,T])=>{var M;(M=p.getValue(v))==null||M.set(T)})}),r.forEach(p=>p.measureEndState()),r.forEach(p=>{p.suspendedScrollY!==void 0&&window.scrollTo(0,p.suspendedScrollY)})}jw=!1,Hw=!1,dh.forEach(r=>r.complete(Yw)),dh.clear()}function n5(){dh.forEach(r=>{r.readKeyframes(),r.needsMeasurement&&(jw=!0)})}function Fde(){Yw=!0,n5(),t5(),Yw=!1}class TI{constructor(a,l,p,x,v,T=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...a],this.onComplete=l,this.name=p,this.motionValue=x,this.element=v,this.isAsync=T}scheduleResolve(){this.state="scheduled",this.isAsync?(dh.add(this),Hw||(Hw=!0,Jn.read(n5),Jn.resolveKeyframes(t5))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:a,name:l,element:p,motionValue:x}=this;if(a[0]===null){const v=x==null?void 0:x.get(),T=a[a.length-1];if(v!==void 0)a[0]=v;else if(p&&l){const M=p.readValue(l,T);M!=null&&(a[0]=M)}a[0]===void 0&&(a[0]=T),x&&v===void 0&&x.set(a[0])}Nde(a)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(a=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,a),dh.delete(this)}cancel(){this.state==="scheduled"&&(dh.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const Gde=r=>r.startsWith("--");function _de(r,a,l){Gde(a)?r.style.setProperty(a,l):r.style[a]=l}const Vde=fI(()=>window.ScrollTimeline!==void 0),Bde={};function Wde(r,a){const l=fI(r);return()=>Bde[a]??l()}const r5=Wde(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Ap=([r,a,l,p])=>`cubic-bezier(${r}, ${a}, ${l}, ${p})`,OM={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Ap([0,.65,.55,1]),circOut:Ap([.55,0,1,.45]),backIn:Ap([.31,.01,.66,-.59]),backOut:Ap([.33,1.53,.69,.99])};function s5(r,a){if(r)return typeof r=="function"?r5()?JO(r,a):"ease-out":WO(r)?Ap(r):Array.isArray(r)?r.map(l=>s5(l,a)||OM.easeOut):OM[r]}function zde(r,a,l,{delay:p=0,duration:x=300,repeat:v=0,repeatType:T="loop",ease:M="easeOut",times:_}={},O=void 0){const V={[a]:l};_&&(V.offset=_);const D=s5(M,x);Array.isArray(D)&&(V.easing=D);const $={delay:p,duration:x,easing:Array.isArray(D)?"linear":D,fill:"both",iterations:v+1,direction:T==="reverse"?"alternate":"normal"};return O&&($.pseudoElement=O),r.animate(V,$)}function i5(r){return typeof r=="function"&&"applyToOptions"in r}function Xde({type:r,...a}){return i5(r)&&r5()?r.applyToOptions(a):(a.duration??(a.duration=300),a.ease??(a.ease="easeOut"),a)}class Zde extends CI{constructor(a){if(super(),this.finishedTime=null,this.isStopped=!1,this.manualStartTime=null,!a)return;const{element:l,name:p,keyframes:x,pseudoElement:v,allowFlatten:T=!1,finalKeyframe:M,onComplete:_}=a;this.isPseudoElement=!!v,this.allowFlatten=T,this.options=a,dI(typeof a.type!="string");const O=Xde(a);this.animation=zde(l,p,x,O,v),O.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!v){const V=II(x,this.options,M,this.speed);this.updateMotionValue?this.updateMotionValue(V):_de(l,p,V),this.animation.cancel()}_==null||_(),this.notifyFinished()}}play(){this.isStopped||(this.manualStartTime=null,this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var a,l;(l=(a=this.animation).finish)==null||l.call(a)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:a}=this;a==="idle"||a==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var a,l;this.isPseudoElement||(l=(a=this.animation).commitStyles)==null||l.call(a)}get duration(){var l,p;const a=((p=(l=this.animation.effect)==null?void 0:l.getComputedTiming)==null?void 0:p.call(l).duration)||0;return ma(Number(a))}get iterationDuration(){const{delay:a=0}=this.options||{};return this.duration+ma(a)}get time(){return ma(Number(this.animation.currentTime)||0)}set time(a){this.manualStartTime=null,this.finishedTime=null,this.animation.currentTime=wl(a)}get speed(){return this.animation.playbackRate}set speed(a){a<0&&(this.finishedTime=null),this.animation.playbackRate=a}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return this.manualStartTime??Number(this.animation.startTime)}set startTime(a){this.manualStartTime=this.animation.startTime=a}attachTimeline({timeline:a,observe:l}){var p;return this.allowFlatten&&((p=this.animation.effect)==null||p.updateTiming({easing:"linear"})),this.animation.onfinish=null,a&&Vde()?(this.animation.timeline=a,xa):l(this)}}const a5={anticipate:GO,backInOut:FO,circInOut:VO};function Kde(r){return r in a5}function $de(r){typeof r.ease=="string"&&Kde(r.ease)&&(r.ease=a5[r.ease])}const M2=10;class Ude extends Zde{constructor(a){$de(a),e5(a),super(a),a.startTime!==void 0&&(this.startTime=a.startTime),this.options=a}updateMotionValue(a){const{motionValue:l,onUpdate:p,onComplete:x,element:v,...T}=this.options;if(!l)return;if(a!==void 0){l.set(a);return}const M=new SI({...T,autoplay:!1}),_=Math.max(M2,Hs.now()-this.startTime),O=Oo(0,M2,_-M2);l.setWithVelocity(M.sample(Math.max(0,_-O)).value,M.sample(_).value,O),M.stop()}}const PM=(r,a)=>a==="zIndex"?!1:!!(typeof r=="number"||Array.isArray(r)||typeof r=="string"&&(Xu.test(r)||r==="0")&&!r.startsWith("url("));function Hde(r){const a=r[0];if(r.length===1)return!0;for(let l=0;l<r.length;l++)if(r[l]!==a)return!0}function jde(r,a,l,p){const x=r[0];if(x===null)return!1;if(a==="display"||a==="visibility")return!0;const v=r[r.length-1],T=PM(x,a),M=PM(v,a);return!T||!M?!1:Hde(r)||(l==="spring"||i5(l))&&p}function Qw(r){r.duration=0,r.type="keyframes"}const Yde=new Set(["opacity","clipPath","filter","transform"]),Qde=fI(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function Jde(r){var V;const{motionValue:a,name:l,repeatDelay:p,repeatType:x,damping:v,type:T}=r;if(!(((V=a==null?void 0:a.owner)==null?void 0:V.current)instanceof HTMLElement))return!1;const{onUpdate:_,transformTemplate:O}=a.owner.getProps();return Qde()&&l&&Yde.has(l)&&(l!=="transform"||!O)&&!_&&!p&&x!=="mirror"&&v!==0&&T!=="inertia"}const qde=40;class efe extends CI{constructor({autoplay:a=!0,delay:l=0,type:p="keyframes",repeat:x=0,repeatDelay:v=0,repeatType:T="loop",keyframes:M,name:_,motionValue:O,element:V,...D}){var H;super(),this.stop=()=>{var se,Ee;this._animation&&(this._animation.stop(),(se=this.stopTimeline)==null||se.call(this)),(Ee=this.keyframeResolver)==null||Ee.cancel()},this.createdAt=Hs.now();const $={autoplay:a,delay:l,type:p,repeat:x,repeatDelay:v,repeatType:T,name:_,motionValue:O,element:V,...D},re=(V==null?void 0:V.KeyframeResolver)||TI;this.keyframeResolver=new re(M,(se,Ee,ee)=>this.onKeyframesResolved(se,Ee,$,!ee),_,O,V),(H=this.keyframeResolver)==null||H.scheduleResolve()}onKeyframesResolved(a,l,p,x){var Ee,ee;this.keyframeResolver=void 0;const{name:v,type:T,velocity:M,delay:_,isHandoff:O,onUpdate:V}=p;this.resolvedAt=Hs.now(),jde(a,v,T,M)||((kl.instantAnimations||!_)&&(V==null||V(II(a,p,l))),a[0]=a[a.length-1],Qw(p),p.repeat=0);const $={startTime:x?this.resolvedAt?this.resolvedAt-this.createdAt>qde?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:l,...p,keyframes:a},re=!O&&Jde($),H=(ee=(Ee=$.motionValue)==null?void 0:Ee.owner)==null?void 0:ee.current,se=re?new Ude({...$,element:H}):new SI($);se.finished.then(()=>{this.notifyFinished()}).catch(xa),this.pendingTimeline&&(this.stopTimeline=se.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=se}get finished(){return this._animation?this.animation.finished:this._finished}then(a,l){return this.finished.finally(a).then(()=>{})}get animation(){var a;return this._animation||((a=this.keyframeResolver)==null||a.resume(),Fde()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(a){this.animation.time=a}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(a){this.animation.speed=a}get startTime(){return this.animation.startTime}attachTimeline(a){return this._animation?this.stopTimeline=this.animation.attachTimeline(a):this.pendingTimeline=a,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var a;this._animation&&this.animation.cancel(),(a=this.keyframeResolver)==null||a.cancel()}}function o5(r,a,l,p=0,x=1){const v=Array.from(r).sort((O,V)=>O.sortNodePosition(V)).indexOf(a),T=r.size,M=(T-1)*p;return typeof l=="function"?l(v,T):x===1?v*p:M-v*p}const tfe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function nfe(r){const a=tfe.exec(r);if(!a)return[,];const[,l,p,x]=a;return[`--${l??p}`,x]}function l5(r,a,l=1){const[p,x]=nfe(r);if(!p)return;const v=window.getComputedStyle(a).getPropertyValue(p);if(v){const T=v.trim();return NO(T)?parseFloat(T):T}return xI(x)?l5(x,a,l+1):x}const rfe={type:"spring",stiffness:500,damping:25,restSpeed:10},sfe=r=>({type:"spring",stiffness:550,damping:r===0?2*Math.sqrt(550):30,restSpeed:10}),ife={type:"keyframes",duration:.8},afe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},ofe=(r,{keyframes:a})=>a.length>2?ife:uf.has(r)?r.startsWith("scale")?sfe(a[1]):rfe:afe,lfe=r=>r!==null;function ufe(r,{repeat:a,repeatType:l="loop"},p){const x=r.filter(lfe),v=a&&l!=="loop"&&a%2===1?0:x.length-1;return x[v]}function kI(r,a){return(r==null?void 0:r[a])??(r==null?void 0:r.default)??r}function cfe({when:r,delay:a,delayChildren:l,staggerChildren:p,staggerDirection:x,repeat:v,repeatType:T,repeatDelay:M,from:_,elapsed:O,...V}){return!!Object.keys(V).length}const EI=(r,a,l,p={},x,v)=>T=>{const M=kI(p,r)||{},_=M.delay||p.delay||0;let{elapsed:O=0}=p;O=O-wl(_);const V={keyframes:Array.isArray(l)?l:[null,l],ease:"easeOut",velocity:a.getVelocity(),...M,delay:-O,onUpdate:$=>{a.set($),M.onUpdate&&M.onUpdate($)},onComplete:()=>{T(),M.onComplete&&M.onComplete()},name:r,motionValue:a,element:v?void 0:x};cfe(M)||Object.assign(V,ofe(r,V)),V.duration&&(V.duration=wl(V.duration)),V.repeatDelay&&(V.repeatDelay=wl(V.repeatDelay)),V.from!==void 0&&(V.keyframes[0]=V.from);let D=!1;if((V.type===!1||V.duration===0&&!V.repeatDelay)&&(Qw(V),V.delay===0&&(D=!0)),(kl.instantAnimations||kl.skipAnimations)&&(D=!0,Qw(V),V.delay=0),V.allowFlatten=!M.type&&!M.ease,D&&!v&&a.get()!==void 0){const $=ufe(V.keyframes,M);if($!==void 0){Jn.update(()=>{V.onUpdate($),V.onComplete()});return}}return M.isSync?new SI(V):new efe(V)};function FM(r){const a=[{},{}];return r==null||r.values.forEach((l,p)=>{a[0][p]=l.get(),a[1][p]=l.getVelocity()}),a}function NI(r,a,l,p){if(typeof a=="function"){const[x,v]=FM(p);a=a(l!==void 0?l:r.custom,x,v)}if(typeof a=="string"&&(a=r.variants&&r.variants[a]),typeof a=="function"){const[x,v]=FM(p);a=a(l!==void 0?l:r.custom,x,v)}return a}function Hd(r,a,l){const p=r.getProps();return NI(p,a,l!==void 0?l:p.custom,r)}const u5=new Set(["width","height","top","left","right","bottom",...lf]),GM=30,hfe=r=>!isNaN(parseFloat(r));class dfe{constructor(a,l={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=p=>{var v;const x=Hs.now();if(this.updatedAt!==x&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(p),this.current!==this.prev&&((v=this.events.change)==null||v.notify(this.current),this.dependents))for(const T of this.dependents)T.dirty()},this.hasAnimated=!1,this.setCurrent(a),this.owner=l.owner}setCurrent(a){this.current=a,this.updatedAt=Hs.now(),this.canTrackVelocity===null&&a!==void 0&&(this.canTrackVelocity=hfe(this.current))}setPrevFrameValue(a=this.current){this.prevFrameValue=a,this.prevUpdatedAt=this.updatedAt}onChange(a){return this.on("change",a)}on(a,l){this.events[a]||(this.events[a]=new pI);const p=this.events[a].add(l);return a==="change"?()=>{p(),Jn.read(()=>{this.events.change.getSize()||this.stop()})}:p}clearListeners(){for(const a in this.events)this.events[a].clear()}attach(a,l){this.passiveEffect=a,this.stopPassiveEffect=l}set(a){this.passiveEffect?this.passiveEffect(a,this.updateAndNotify):this.updateAndNotify(a)}setWithVelocity(a,l,p){this.set(l),this.prev=void 0,this.prevFrameValue=a,this.prevUpdatedAt=this.updatedAt-p}jump(a,l=!0){this.updateAndNotify(a),this.prev=a,this.prevUpdatedAt=this.prevFrameValue=void 0,l&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var a;(a=this.events.change)==null||a.notify(this.current)}addDependent(a){this.dependents||(this.dependents=new Set),this.dependents.add(a)}removeDependent(a){this.dependents&&this.dependents.delete(a)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const a=Hs.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||a-this.updatedAt>GM)return 0;const l=Math.min(this.updatedAt-this.prevUpdatedAt,GM);return MO(parseFloat(this.current)-parseFloat(this.prevFrameValue),l)}start(a){return this.stop(),new Promise(l=>{this.hasAnimated=!0,this.animation=a(l),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var a,l;(a=this.dependents)==null||a.clear(),(l=this.events.destroy)==null||l.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function nf(r,a){return new dfe(r,a)}const Jw=r=>Array.isArray(r);function ffe(r,a,l){r.hasValue(a)?r.getValue(a).set(l):r.addValue(a,nf(l))}function pfe(r){return Jw(r)?r[r.length-1]||0:r}function mfe(r,a){const l=Hd(r,a);let{transitionEnd:p={},transition:x={},...v}=l||{};v={...v,...p};for(const T in v){const M=pfe(v[T]);ffe(r,T,M)}}const Fs=r=>!!(r&&r.getVelocity);function gfe(r){return!!(Fs(r)&&r.add)}function qw(r,a){const l=r.getValue("willChange");if(gfe(l))return l.add(a);if(!l&&kl.WillChange){const p=new kl.WillChange("auto");r.addValue("willChange",p),p.add(a)}}function AI(r){return r.replace(/([A-Z])/g,a=>`-${a.toLowerCase()}`)}const xfe="framerAppearId",c5="data-"+AI(xfe);function h5(r){return r.props[c5]}function yfe({protectedKeys:r,needsAnimating:a},l){const p=r.hasOwnProperty(l)&&a[l]!==!0;return a[l]=!1,p}function d5(r,a,{delay:l=0,transitionOverride:p,type:x}={}){let{transition:v=r.getDefaultTransition(),transitionEnd:T,...M}=a;const _=v==null?void 0:v.reduceMotion;p&&(v=p);const O=[],V=x&&r.animationState&&r.animationState.getState()[x];for(const D in M){const $=r.getValue(D,r.latestValues[D]??null),re=M[D];if(re===void 0||V&&yfe(V,D))continue;const H={delay:l,...kI(v||{},D)},se=$.get();if(se!==void 0&&!$.isAnimating&&!Array.isArray(re)&&re===se&&!H.velocity)continue;let Ee=!1;if(window.MotionHandoffAnimation){const j=h5(r);if(j){const fe=window.MotionHandoffAnimation(j,D,Jn);fe!==null&&(H.startTime=fe,Ee=!0)}}qw(r,D);const ee=_??r.shouldReduceMotion;$.start(EI(D,$,re,ee&&u5.has(D)?{type:!1}:H,r,Ee));const Y=$.animation;Y&&O.push(Y)}return T&&Promise.all(O).then(()=>{Jn.update(()=>{T&&mfe(r,T)})}),O}function ev(r,a,l={}){var _;const p=Hd(r,a,l.type==="exit"?(_=r.presenceContext)==null?void 0:_.custom:void 0);let{transition:x=r.getDefaultTransition()||{}}=p||{};l.transitionOverride&&(x=l.transitionOverride);const v=p?()=>Promise.all(d5(r,p,l)):()=>Promise.resolve(),T=r.variantChildren&&r.variantChildren.size?(O=0)=>{const{delayChildren:V=0,staggerChildren:D,staggerDirection:$}=x;return bfe(r,a,O,V,D,$,l)}:()=>Promise.resolve(),{when:M}=x;if(M){const[O,V]=M==="beforeChildren"?[v,T]:[T,v];return O().then(()=>V())}else return Promise.all([v(),T(l.delay)])}function bfe(r,a,l=0,p=0,x=0,v=1,T){const M=[];for(const _ of r.variantChildren)_.notify("AnimationStart",a),M.push(ev(_,a,{...T,delay:l+(typeof p=="function"?0:p)+o5(r.variantChildren,_,p,x,v)}).then(()=>_.notify("AnimationComplete",a)));return Promise.all(M)}function wfe(r,a,l={}){r.notify("AnimationStart",a);let p;if(Array.isArray(a)){const x=a.map(v=>ev(r,v,l));p=Promise.all(x)}else if(typeof a=="string")p=ev(r,a,l);else{const x=typeof a=="function"?Hd(r,a,l.custom):a;p=Promise.all(d5(r,x,l))}return p.then(()=>{r.notify("AnimationComplete",a)})}const vfe={test:r=>r==="auto",parse:r=>r},f5=r=>a=>a.test(r),p5=[of,mt,Do,Iu,Hhe,Uhe,vfe],_M=r=>p5.find(f5(r));function Ife(r){return typeof r=="number"?r===0:r!==null?r==="none"||r==="0"||RO(r):!0}const Cfe=new Set(["brightness","contrast","saturate","opacity"]);function Sfe(r){const[a,l]=r.slice(0,-1).split("(");if(a==="drop-shadow")return r;const[p]=l.match(yI)||[];if(!p)return r;const x=l.replace(p,"");let v=Cfe.has(a)?1:0;return p!==l&&(v*=100),a+"("+v+x+")"}const Tfe=/\b([a-z-]*)\(.*?\)/gu,tv={...Xu,getAnimatableNone:r=>{const a=r.match(Tfe);return a?a.map(Sfe).join(" "):r}},VM={...of,transform:Math.round},kfe={rotate:Iu,rotateX:Iu,rotateY:Iu,rotateZ:Iu,scale:bm,scaleX:bm,scaleY:bm,scaleZ:bm,skew:Iu,skewX:Iu,skewY:Iu,distance:mt,translateX:mt,translateY:mt,translateZ:mt,x:mt,y:mt,z:mt,perspective:mt,transformPerspective:mt,opacity:l0,originX:TM,originY:TM,originZ:mt},RI={borderWidth:mt,borderTopWidth:mt,borderRightWidth:mt,borderBottomWidth:mt,borderLeftWidth:mt,borderRadius:mt,borderTopLeftRadius:mt,borderTopRightRadius:mt,borderBottomRightRadius:mt,borderBottomLeftRadius:mt,width:mt,maxWidth:mt,height:mt,maxHeight:mt,top:mt,right:mt,bottom:mt,left:mt,inset:mt,insetBlock:mt,insetBlockStart:mt,insetBlockEnd:mt,insetInline:mt,insetInlineStart:mt,insetInlineEnd:mt,padding:mt,paddingTop:mt,paddingRight:mt,paddingBottom:mt,paddingLeft:mt,paddingBlock:mt,paddingBlockStart:mt,paddingBlockEnd:mt,paddingInline:mt,paddingInlineStart:mt,paddingInlineEnd:mt,margin:mt,marginTop:mt,marginRight:mt,marginBottom:mt,marginLeft:mt,marginBlock:mt,marginBlockStart:mt,marginBlockEnd:mt,marginInline:mt,marginInlineStart:mt,marginInlineEnd:mt,fontSize:mt,backgroundPositionX:mt,backgroundPositionY:mt,...kfe,zIndex:VM,fillOpacity:l0,strokeOpacity:l0,numOctaves:VM},Efe={...RI,color:_r,backgroundColor:_r,outlineColor:_r,fill:_r,stroke:_r,borderColor:_r,borderTopColor:_r,borderRightColor:_r,borderBottomColor:_r,borderLeftColor:_r,filter:tv,WebkitFilter:tv},m5=r=>Efe[r];function g5(r,a){let l=m5(r);return l!==tv&&(l=Xu),l.getAnimatableNone?l.getAnimatableNone(a):void 0}const Nfe=new Set(["auto","none","0"]);function Afe(r,a,l){let p=0,x;for(;p<r.length&&!x;){const v=r[p];typeof v=="string"&&!Nfe.has(v)&&u0(v).values.length&&(x=r[p]),p++}if(x&&l)for(const v of a)r[v]=g5(l,x)}class Rfe extends TI{constructor(a,l,p,x,v){super(a,l,p,x,v,!0)}readKeyframes(){const{unresolvedKeyframes:a,element:l,name:p}=this;if(!l||!l.current)return;super.readKeyframes();for(let V=0;V<a.length;V++){let D=a[V];if(typeof D=="string"&&(D=D.trim(),xI(D))){const $=l5(D,l.current);$!==void 0&&(a[V]=$),V===a.length-1&&(this.finalKeyframe=D)}}if(this.resolveNoneKeyframes(),!u5.has(p)||a.length!==2)return;const[x,v]=a,T=_M(x),M=_M(v),_=SM(x),O=SM(v);if(_!==O&&Ru[p]){this.needsMeasurement=!0;return}if(T!==M)if(DM(T)&&DM(M))for(let V=0;V<a.length;V++){const D=a[V];typeof D=="string"&&(a[V]=parseFloat(D))}else Ru[p]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:a,name:l}=this,p=[];for(let x=0;x<a.length;x++)(a[x]===null||Ife(a[x]))&&p.push(x);p.length&&Afe(a,p,l)}measureInitialState(){const{element:a,unresolvedKeyframes:l,name:p}=this;if(!a||!a.current)return;p==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Ru[p](a.measureViewportBox(),window.getComputedStyle(a.current)),l[0]=this.measuredOrigin;const x=l[l.length-1];x!==void 0&&a.getValue(p,x).jump(x,!1)}measureEndState(){var M;const{element:a,name:l,unresolvedKeyframes:p}=this;if(!a||!a.current)return;const x=a.getValue(l);x&&x.jump(this.measuredOrigin,!1);const v=p.length-1,T=p[v];p[v]=Ru[l](a.measureViewportBox(),window.getComputedStyle(a.current)),T!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=T),(M=this.removedTransforms)!=null&&M.length&&this.removedTransforms.forEach(([_,O])=>{a.getValue(_).set(O)}),this.resolveNoneKeyframes()}}function Mfe(r,a,l){if(r==null)return[];if(r instanceof EventTarget)return[r];if(typeof r=="string"){let p=document;const x=(l==null?void 0:l[r])??p.querySelectorAll(r);return x?Array.from(x):[]}return Array.from(r).filter(p=>p!=null)}const x5=(r,a)=>a&&typeof r=="number"?a.transform(r):r;function nv(r){return AO(r)&&"offsetHeight"in r}const{schedule:MI}=zO(queueMicrotask,!1),Wa={x:!1,y:!1};function y5(){return Wa.x||Wa.y}function Lfe(r){return r==="x"||r==="y"?Wa[r]?null:(Wa[r]=!0,()=>{Wa[r]=!1}):Wa.x||Wa.y?null:(Wa.x=Wa.y=!0,()=>{Wa.x=Wa.y=!1})}function b5(r,a){const l=Mfe(r),p=new AbortController,x={passive:!0,...a,signal:p.signal};return[l,x,()=>p.abort()]}function BM(r){return!(r.pointerType==="touch"||y5())}function Dfe(r,a,l={}){const[p,x,v]=b5(r,l),T=M=>{if(!BM(M))return;const{target:_}=M,O=a(_,M);if(typeof O!="function"||!_)return;const V=D=>{BM(D)&&(O(D),_.removeEventListener("pointerleave",V))};_.addEventListener("pointerleave",V,x)};return p.forEach(M=>{M.addEventListener("pointerenter",T,x)}),v}const w5=(r,a)=>a?r===a?!0:w5(r,a.parentElement):!1,LI=r=>r.pointerType==="mouse"?typeof r.button!="number"||r.button<=0:r.isPrimary!==!1,Ofe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function v5(r){return Ofe.has(r.tagName)||r.isContentEditable===!0}const Gm=new WeakSet;function WM(r){return a=>{a.key==="Enter"&&r(a)}}function L2(r,a){r.dispatchEvent(new PointerEvent("pointer"+a,{isPrimary:!0,bubbles:!0}))}const Pfe=(r,a)=>{const l=r.currentTarget;if(!l)return;const p=WM(()=>{if(Gm.has(l))return;L2(l,"down");const x=WM(()=>{L2(l,"up")}),v=()=>L2(l,"cancel");l.addEventListener("keyup",x,a),l.addEventListener("blur",v,a)});l.addEventListener("keydown",p,a),l.addEventListener("blur",()=>l.removeEventListener("keydown",p),a)};function zM(r){return LI(r)&&!y5()}function Ffe(r,a,l={}){const[p,x,v]=b5(r,l),T=M=>{const _=M.currentTarget;if(!zM(M))return;Gm.add(_);const O=a(_,M),V=(re,H)=>{window.removeEventListener("pointerup",D),window.removeEventListener("pointercancel",$),Gm.has(_)&&Gm.delete(_),zM(re)&&typeof O=="function"&&O(re,{success:H})},D=re=>{V(re,_===window||_===document||l.useGlobalTarget||w5(_,re.target))},$=re=>{V(re,!1)};window.addEventListener("pointerup",D,x),window.addEventListener("pointercancel",$,x)};return p.forEach(M=>{(l.useGlobalTarget?window:M).addEventListener("pointerdown",T,x),nv(M)&&(M.addEventListener("focus",O=>Pfe(O,x)),!v5(M)&&!M.hasAttribute("tabindex")&&(M.tabIndex=0))}),v}function I5(r){return AO(r)&&"ownerSVGElement"in r}function Gfe(r){return I5(r)&&r.tagName==="svg"}const _fe=[...p5,_r,Xu],Vfe=r=>_fe.find(f5(r)),XM=()=>({translate:0,scale:1,origin:0,originPoint:0}),Vd=()=>({x:XM(),y:XM()}),ZM=()=>({min:0,max:0}),$r=()=>({x:ZM(),y:ZM()}),rv={current:null},C5={current:!1},Bfe=typeof window<"u";function Wfe(){if(C5.current=!0,!!Bfe)if(window.matchMedia){const r=window.matchMedia("(prefers-reduced-motion)"),a=()=>rv.current=r.matches;r.addEventListener("change",a),a()}else rv.current=!1}const zfe=new WeakMap;function Wg(r){return r!==null&&typeof r=="object"&&typeof r.start=="function"}function c0(r){return typeof r=="string"||Array.isArray(r)}const DI=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],OI=["initial",...DI];function zg(r){return Wg(r.animate)||OI.some(a=>c0(r[a]))}function S5(r){return!!(zg(r)||r.variants)}function Xfe(r,a,l){for(const p in a){const x=a[p],v=l[p];if(Fs(x))r.addValue(p,x);else if(Fs(v))r.addValue(p,nf(x,{owner:r}));else if(v!==x)if(r.hasValue(p)){const T=r.getValue(p);T.liveStyle===!0?T.jump(x):T.hasAnimated||T.set(x)}else{const T=r.getStaticValue(p);r.addValue(p,nf(T!==void 0?T:x,{owner:r}))}}for(const p in l)a[p]===void 0&&r.removeValue(p);return a}const KM=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];let gg={};function T5(r){gg=r}function Zfe(){return gg}class Kfe{scrapeMotionValuesFromProps(a,l,p){return{}}constructor({parent:a,props:l,presenceContext:p,reducedMotionConfig:x,blockInitialAnimation:v,visualState:T},M={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=TI,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const $=Hs.now();this.renderScheduledAt<$&&(this.renderScheduledAt=$,Jn.render(this.render,!1,!0))};const{latestValues:_,renderState:O}=T;this.latestValues=_,this.baseTarget={..._},this.initialValues=l.initial?{..._}:{},this.renderState=O,this.parent=a,this.props=l,this.presenceContext=p,this.depth=a?a.depth+1:0,this.reducedMotionConfig=x,this.options=M,this.blockInitialAnimation=!!v,this.isControllingVariants=zg(l),this.isVariantNode=S5(l),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(a&&a.current);const{willChange:V,...D}=this.scrapeMotionValuesFromProps(l,{},this);for(const $ in D){const re=D[$];_[$]!==void 0&&Fs(re)&&re.set(_[$])}}mount(a){var l;this.current=a,zfe.set(a,this),this.projection&&!this.projection.instance&&this.projection.mount(a),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((p,x)=>this.bindToMotionValue(x,p)),this.reducedMotionConfig==="never"?this.shouldReduceMotion=!1:this.reducedMotionConfig==="always"?this.shouldReduceMotion=!0:(C5.current||Wfe(),this.shouldReduceMotion=rv.current),(l=this.parent)==null||l.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var a;this.projection&&this.projection.unmount(),zu(this.notifyUpdate),zu(this.render),this.valueSubscriptions.forEach(l=>l()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(a=this.parent)==null||a.removeChild(this);for(const l in this.events)this.events[l].clear();for(const l in this.features){const p=this.features[l];p&&(p.unmount(),p.isMounted=!1)}this.current=null}addChild(a){this.children.add(a),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(a)}removeChild(a){this.children.delete(a),this.enteringChildren&&this.enteringChildren.delete(a)}bindToMotionValue(a,l){this.valueSubscriptions.has(a)&&this.valueSubscriptions.get(a)();const p=uf.has(a);p&&this.onBindTransform&&this.onBindTransform();const x=l.on("change",T=>{this.latestValues[a]=T,this.props.onUpdate&&Jn.preRender(this.notifyUpdate),p&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let v;typeof window<"u"&&window.MotionCheckAppearSync&&(v=window.MotionCheckAppearSync(this,a,l)),this.valueSubscriptions.set(a,()=>{x(),v&&v(),l.owner&&l.stop()})}sortNodePosition(a){return!this.current||!this.sortInstanceNodePosition||this.type!==a.type?0:this.sortInstanceNodePosition(this.current,a.current)}updateFeatures(){let a="animation";for(a in gg){const l=gg[a];if(!l)continue;const{isEnabled:p,Feature:x}=l;if(!this.features[a]&&x&&p(this.props)&&(this.features[a]=new x(this)),this.features[a]){const v=this.features[a];v.isMounted?v.update():(v.mount(),v.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):$r()}getStaticValue(a){return this.latestValues[a]}setStaticValue(a,l){this.latestValues[a]=l}update(a,l){(a.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=a,this.prevPresenceContext=this.presenceContext,this.presenceContext=l;for(let p=0;p<KM.length;p++){const x=KM[p];this.propEventSubscriptions[x]&&(this.propEventSubscriptions[x](),delete this.propEventSubscriptions[x]);const v="on"+x,T=a[v];T&&(this.propEventSubscriptions[x]=this.on(x,T))}this.prevMotionValues=Xfe(this,this.scrapeMotionValuesFromProps(a,this.prevProps||{},this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(a){return this.props.variants?this.props.variants[a]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(a){const l=this.getClosestVariantNode();if(l)return l.variantChildren&&l.variantChildren.add(a),()=>l.variantChildren.delete(a)}addValue(a,l){const p=this.values.get(a);l!==p&&(p&&this.removeValue(a),this.bindToMotionValue(a,l),this.values.set(a,l),this.latestValues[a]=l.get())}removeValue(a){this.values.delete(a);const l=this.valueSubscriptions.get(a);l&&(l(),this.valueSubscriptions.delete(a)),delete this.latestValues[a],this.removeValueFromRenderState(a,this.renderState)}hasValue(a){return this.values.has(a)}getValue(a,l){if(this.props.values&&this.props.values[a])return this.props.values[a];let p=this.values.get(a);return p===void 0&&l!==void 0&&(p=nf(l===null?void 0:l,{owner:this}),this.addValue(a,p)),p}readValue(a,l){let p=this.latestValues[a]!==void 0||!this.current?this.latestValues[a]:this.getBaseTargetFromProps(this.props,a)??this.readValueFromInstance(this.current,a,this.options);return p!=null&&(typeof p=="string"&&(NO(p)||RO(p))?p=parseFloat(p):!Vfe(p)&&Xu.test(l)&&(p=g5(a,l)),this.setBaseTarget(a,Fs(p)?p.get():p)),Fs(p)?p.get():p}setBaseTarget(a,l){this.baseTarget[a]=l}getBaseTarget(a){var v;const{initial:l}=this.props;let p;if(typeof l=="string"||typeof l=="object"){const T=NI(this.props,l,(v=this.presenceContext)==null?void 0:v.custom);T&&(p=T[a])}if(l&&p!==void 0)return p;const x=this.getBaseTargetFromProps(this.props,a);return x!==void 0&&!Fs(x)?x:this.initialValues[a]!==void 0&&p===void 0?void 0:this.baseTarget[a]}on(a,l){return this.events[a]||(this.events[a]=new pI),this.events[a].add(l)}notify(a,...l){this.events[a]&&this.events[a].notify(...l)}scheduleRenderMicrotask(){MI.render(this.render)}}class k5 extends Kfe{constructor(){super(...arguments),this.KeyframeResolver=Rfe}sortInstanceNodePosition(a,l){return a.compareDocumentPosition(l)&2?1:-1}getBaseTargetFromProps(a,l){const p=a.style;return p?p[l]:void 0}removeValueFromRenderState(a,{vars:l,style:p}){delete l[a],delete p[a]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:a}=this.props;Fs(a)&&(this.childSubscription=a.on("change",l=>{this.current&&(this.current.textContent=`${l}`)}))}}class ju{constructor(a){this.isMounted=!1,this.node=a}update(){}}function E5({top:r,left:a,right:l,bottom:p}){return{x:{min:a,max:l},y:{min:r,max:p}}}function $fe({x:r,y:a}){return{top:a.min,right:r.max,bottom:a.max,left:r.min}}function Ufe(r,a){if(!a)return r;const l=a({x:r.left,y:r.top}),p=a({x:r.right,y:r.bottom});return{top:l.y,left:l.x,bottom:p.y,right:p.x}}function D2(r){return r===void 0||r===1}function sv({scale:r,scaleX:a,scaleY:l}){return!D2(r)||!D2(a)||!D2(l)}function sh(r){return sv(r)||N5(r)||r.z||r.rotate||r.rotateX||r.rotateY||r.skewX||r.skewY}function N5(r){return $M(r.x)||$M(r.y)}function $M(r){return r&&r!=="0%"}function xg(r,a,l){const p=r-l,x=a*p;return l+x}function UM(r,a,l,p,x){return x!==void 0&&(r=xg(r,x,p)),xg(r,l,p)+a}function iv(r,a=0,l=1,p,x){r.min=UM(r.min,a,l,p,x),r.max=UM(r.max,a,l,p,x)}function A5(r,{x:a,y:l}){iv(r.x,a.translate,a.scale,a.originPoint),iv(r.y,l.translate,l.scale,l.originPoint)}const HM=.999999999999,jM=1.0000000000001;function Hfe(r,a,l,p=!1){const x=l.length;if(!x)return;a.x=a.y=1;let v,T;for(let M=0;M<x;M++){v=l[M],T=v.projectionDelta;const{visualElement:_}=v.options;_&&_.props.style&&_.props.style.display==="contents"||(p&&v.options.layoutScroll&&v.scroll&&v!==v.root&&Wd(r,{x:-v.scroll.offset.x,y:-v.scroll.offset.y}),T&&(a.x*=T.x.scale,a.y*=T.y.scale,A5(r,T)),p&&sh(v.latestValues)&&Wd(r,v.latestValues))}a.x<jM&&a.x>HM&&(a.x=1),a.y<jM&&a.y>HM&&(a.y=1)}function Bd(r,a){r.min=r.min+a,r.max=r.max+a}function YM(r,a,l,p,x=.5){const v=ur(r.min,r.max,x);iv(r,a,l,v,p)}function Wd(r,a){YM(r.x,a.x,a.scaleX,a.scale,a.originX),YM(r.y,a.y,a.scaleY,a.scale,a.originY)}function R5(r,a){return E5(Ufe(r.getBoundingClientRect(),a))}function jfe(r,a,l){const p=R5(r,l),{scroll:x}=a;return x&&(Bd(p.x,x.offset.x),Bd(p.y,x.offset.y)),p}const Yfe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Qfe=lf.length;function Jfe(r,a,l){let p="",x=!0;for(let v=0;v<Qfe;v++){const T=lf[v],M=r[T];if(M===void 0)continue;let _=!0;if(typeof M=="number")_=M===(T.startsWith("scale")?1:0);else{const O=parseFloat(M);_=T.startsWith("scale")?O===1:O===0}if(!_||l){const O=x5(M,RI[T]);if(!_){x=!1;const V=Yfe[T]||T;p+=`${V}(${O}) `}l&&(a[T]=O)}}return p=p.trim(),l?p=l(a,x?"":p):x&&(p="none"),p}function PI(r,a,l){const{style:p,vars:x,transformOrigin:v}=r;let T=!1,M=!1;for(const _ in a){const O=a[_];if(uf.has(_)){T=!0;continue}else if(ZO(_)){x[_]=O;continue}else{const V=x5(O,RI[_]);_.startsWith("origin")?(M=!0,v[_]=V):p[_]=V}}if(a.transform||(T||l?p.transform=Jfe(a,r.transform,l):p.transform&&(p.transform="none")),M){const{originX:_="50%",originY:O="50%",originZ:V=0}=v;p.transformOrigin=`${_} ${O} ${V}`}}function M5(r,{style:a,vars:l},p,x){const v=r.style;let T;for(T in a)v[T]=a[T];x==null||x.applyProjectionStyles(v,p);for(T in l)v.setProperty(T,l[T])}function QM(r,a){return a.max===a.min?0:r/(a.max-a.min)*100}const Cp={correct:(r,a)=>{if(!a.target)return r;if(typeof r=="string")if(mt.test(r))r=parseFloat(r);else return r;const l=QM(r,a.target.x),p=QM(r,a.target.y);return`${l}% ${p}%`}},qfe={correct:(r,{treeScale:a,projectionDelta:l})=>{const p=r,x=Xu.parse(r);if(x.length>5)return p;const v=Xu.createTransformer(r),T=typeof x[0]!="number"?1:0,M=l.x.scale*a.x,_=l.y.scale*a.y;x[0+T]/=M,x[1+T]/=_;const O=ur(M,_,.5);return typeof x[2+T]=="number"&&(x[2+T]/=O),typeof x[3+T]=="number"&&(x[3+T]/=O),v(x)}},av={borderRadius:{...Cp,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Cp,borderTopRightRadius:Cp,borderBottomLeftRadius:Cp,borderBottomRightRadius:Cp,boxShadow:qfe};function L5(r,{layout:a,layoutId:l}){return uf.has(r)||r.startsWith("origin")||(a||l!==void 0)&&(!!av[r]||r==="opacity")}function FI(r,a,l){var T;const p=r.style,x=a==null?void 0:a.style,v={};if(!p)return v;for(const M in p)(Fs(p[M])||x&&Fs(x[M])||L5(M,r)||((T=l==null?void 0:l.getValue(M))==null?void 0:T.liveStyle)!==void 0)&&(v[M]=p[M]);return v}function epe(r){return window.getComputedStyle(r)}class tpe extends k5{constructor(){super(...arguments),this.type="html",this.renderInstance=M5}readValueFromInstance(a,l){var p;if(uf.has(l))return(p=this.projection)!=null&&p.isProjecting?$w(l):Mde(a,l);{const x=epe(a),v=(ZO(l)?x.getPropertyValue(l):x[l])||0;return typeof v=="string"?v.trim():v}}measureInstanceViewportBox(a,{transformPagePoint:l}){return R5(a,l)}build(a,l,p){PI(a,l,p.transformTemplate)}scrapeMotionValuesFromProps(a,l,p){return FI(a,l,p)}}const npe={offset:"stroke-dashoffset",array:"stroke-dasharray"},rpe={offset:"strokeDashoffset",array:"strokeDasharray"};function spe(r,a,l=1,p=0,x=!0){r.pathLength=1;const v=x?npe:rpe;r[v.offset]=`${-p}`,r[v.array]=`${a} ${l}`}const ipe=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function D5(r,{attrX:a,attrY:l,attrScale:p,pathLength:x,pathSpacing:v=1,pathOffset:T=0,...M},_,O,V){if(PI(r,M,O),_){r.style.viewBox&&(r.attrs.viewBox=r.style.viewBox);return}r.attrs=r.style,r.style={};const{attrs:D,style:$}=r;D.transform&&($.transform=D.transform,delete D.transform),($.transform||D.transformOrigin)&&($.transformOrigin=D.transformOrigin??"50% 50%",delete D.transformOrigin),$.transform&&($.transformBox=(V==null?void 0:V.transformBox)??"fill-box",delete D.transformBox);for(const re of ipe)D[re]!==void 0&&($[re]=D[re],delete D[re]);a!==void 0&&(D.x=a),l!==void 0&&(D.y=l),p!==void 0&&(D.scale=p),x!==void 0&&spe(D,x,v,T,!1)}const O5=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]),P5=r=>typeof r=="string"&&r.toLowerCase()==="svg";function ape(r,a,l,p){M5(r,a,void 0,p);for(const x in a.attrs)r.setAttribute(O5.has(x)?x:AI(x),a.attrs[x])}function F5(r,a,l){const p=FI(r,a,l);for(const x in r)if(Fs(r[x])||Fs(a[x])){const v=lf.indexOf(x)!==-1?"attr"+x.charAt(0).toUpperCase()+x.substring(1):x;p[v]=r[x]}return p}class ope extends k5{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=$r}getBaseTargetFromProps(a,l){return a[l]}readValueFromInstance(a,l){if(uf.has(l)){const p=m5(l);return p&&p.default||0}return l=O5.has(l)?l:AI(l),a.getAttribute(l)}scrapeMotionValuesFromProps(a,l,p){return F5(a,l,p)}build(a,l,p){D5(a,l,this.isSVGTag,p.transformTemplate,p.style)}renderInstance(a,l,p,x){ape(a,l,p,x)}mount(a){this.isSVGTag=P5(a.tagName),super.mount(a)}}const lpe=OI.length;function G5(r){if(!r)return;if(!r.isControllingVariants){const l=r.parent?G5(r.parent)||{}:{};return r.props.initial!==void 0&&(l.initial=r.props.initial),l}const a={};for(let l=0;l<lpe;l++){const p=OI[l],x=r.props[p];(c0(x)||x===!1)&&(a[p]=x)}return a}function _5(r,a){if(!Array.isArray(a))return!1;const l=a.length;if(l!==r.length)return!1;for(let p=0;p<l;p++)if(a[p]!==r[p])return!1;return!0}const upe=[...DI].reverse(),cpe=DI.length;function hpe(r){return a=>Promise.all(a.map(({animation:l,options:p})=>wfe(r,l,p)))}function dpe(r){let a=hpe(r),l=JM(),p=!0;const x=_=>(O,V)=>{var $;const D=Hd(r,V,_==="exit"?($=r.presenceContext)==null?void 0:$.custom:void 0);if(D){const{transition:re,transitionEnd:H,...se}=D;O={...O,...se,...H}}return O};function v(_){a=_(r)}function T(_){const{props:O}=r,V=G5(r.parent)||{},D=[],$=new Set;let re={},H=1/0;for(let Ee=0;Ee<cpe;Ee++){const ee=upe[Ee],Y=l[ee],j=O[ee]!==void 0?O[ee]:V[ee],fe=c0(j),be=ee===_?Y.isActive:null;be===!1&&(H=Ee);let Fe=j===V[ee]&&j!==O[ee]&&fe;if(Fe&&p&&r.manuallyAnimateOnMount&&(Fe=!1),Y.protectedKeys={...re},!Y.isActive&&be===null||!j&&!Y.prevProp||Wg(j)||typeof j=="boolean")continue;const ue=fpe(Y.prevProp,j);let we=ue||ee===_&&Y.isActive&&!Fe&&fe||Ee>H&&fe,Ne=!1;const it=Array.isArray(j)?j:[j];let Bt=it.reduce(x(ee),{});be===!1&&(Bt={});const{prevResolvedValues:ht={}}=Y,_t={...ht,...Bt},fn=ut=>{we=!0,$.has(ut)&&(Ne=!0,$.delete(ut)),Y.needsAnimating[ut]=!0;const Je=r.getValue(ut);Je&&(Je.liveStyle=!1)};for(const ut in _t){const Je=Bt[ut],xt=ht[ut];if(re.hasOwnProperty(ut))continue;let We=!1;Jw(Je)&&Jw(xt)?We=!_5(Je,xt):We=Je!==xt,We?Je!=null?fn(ut):$.add(ut):Je!==void 0&&$.has(ut)?fn(ut):Y.protectedKeys[ut]=!0}Y.prevProp=j,Y.prevResolvedValues=Bt,Y.isActive&&(re={...re,...Bt}),p&&r.blockInitialAnimation&&(we=!1);const Pe=Fe&&ue;we&&(!Pe||Ne)&&D.push(...it.map(ut=>{const Je={type:ee};if(typeof ut=="string"&&p&&!Pe&&r.manuallyAnimateOnMount&&r.parent){const{parent:xt}=r,We=Hd(xt,ut);if(xt.enteringChildren&&We){const{delayChildren:yn}=We.transition||{};Je.delay=o5(xt.enteringChildren,r,yn)}}return{animation:ut,options:Je}}))}if($.size){const Ee={};if(typeof O.initial!="boolean"){const ee=Hd(r,Array.isArray(O.initial)?O.initial[0]:O.initial);ee&&ee.transition&&(Ee.transition=ee.transition)}$.forEach(ee=>{const Y=r.getBaseTarget(ee),j=r.getValue(ee);j&&(j.liveStyle=!0),Ee[ee]=Y??null}),D.push({animation:Ee})}let se=!!D.length;return p&&(O.initial===!1||O.initial===O.animate)&&!r.manuallyAnimateOnMount&&(se=!1),p=!1,se?a(D):Promise.resolve()}function M(_,O){var D;if(l[_].isActive===O)return Promise.resolve();(D=r.variantChildren)==null||D.forEach($=>{var re;return(re=$.animationState)==null?void 0:re.setActive(_,O)}),l[_].isActive=O;const V=T(_);for(const $ in l)l[$].protectedKeys={};return V}return{animateChanges:T,setActive:M,setAnimateFunction:v,getState:()=>l,reset:()=>{l=JM()}}}function fpe(r,a){return typeof a=="string"?a!==r:Array.isArray(a)?!_5(a,r):!1}function th(r=!1){return{isActive:r,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function JM(){return{animate:th(!0),whileInView:th(),whileHover:th(),whileTap:th(),whileDrag:th(),whileFocus:th(),exit:th()}}function qM(r,a){r.min=a.min,r.max=a.max}function Ba(r,a){qM(r.x,a.x),qM(r.y,a.y)}function e4(r,a){r.translate=a.translate,r.scale=a.scale,r.originPoint=a.originPoint,r.origin=a.origin}const V5=1e-4,ppe=1-V5,mpe=1+V5,B5=.01,gpe=0-B5,xpe=0+B5;function js(r){return r.max-r.min}function ype(r,a,l){return Math.abs(r-a)<=l}function t4(r,a,l,p=.5){r.origin=p,r.originPoint=ur(a.min,a.max,r.origin),r.scale=js(l)/js(a),r.translate=ur(l.min,l.max,r.origin)-r.originPoint,(r.scale>=ppe&&r.scale<=mpe||isNaN(r.scale))&&(r.scale=1),(r.translate>=gpe&&r.translate<=xpe||isNaN(r.translate))&&(r.translate=0)}function zp(r,a,l,p){t4(r.x,a.x,l.x,p?p.originX:void 0),t4(r.y,a.y,l.y,p?p.originY:void 0)}function n4(r,a,l){r.min=l.min+a.min,r.max=r.min+js(a)}function bpe(r,a,l){n4(r.x,a.x,l.x),n4(r.y,a.y,l.y)}function r4(r,a,l){r.min=a.min-l.min,r.max=r.min+js(a)}function yg(r,a,l){r4(r.x,a.x,l.x),r4(r.y,a.y,l.y)}function s4(r,a,l,p,x){return r-=a,r=xg(r,1/l,p),x!==void 0&&(r=xg(r,1/x,p)),r}function wpe(r,a=0,l=1,p=.5,x,v=r,T=r){if(Do.test(a)&&(a=parseFloat(a),a=ur(T.min,T.max,a/100)-T.min),typeof a!="number")return;let M=ur(v.min,v.max,p);r===v&&(M-=a),r.min=s4(r.min,a,l,M,x),r.max=s4(r.max,a,l,M,x)}function i4(r,a,[l,p,x],v,T){wpe(r,a[l],a[p],a[x],a.scale,v,T)}const vpe=["x","scaleX","originX"],Ipe=["y","scaleY","originY"];function a4(r,a,l,p){i4(r.x,a,vpe,l?l.x:void 0,p?p.x:void 0),i4(r.y,a,Ipe,l?l.y:void 0,p?p.y:void 0)}function o4(r){return r.translate===0&&r.scale===1}function W5(r){return o4(r.x)&&o4(r.y)}function l4(r,a){return r.min===a.min&&r.max===a.max}function Cpe(r,a){return l4(r.x,a.x)&&l4(r.y,a.y)}function u4(r,a){return Math.round(r.min)===Math.round(a.min)&&Math.round(r.max)===Math.round(a.max)}function z5(r,a){return u4(r.x,a.x)&&u4(r.y,a.y)}function c4(r){return js(r.x)/js(r.y)}function h4(r,a){return r.translate===a.translate&&r.scale===a.scale&&r.originPoint===a.originPoint}function ha(r){return[r("x"),r("y")]}function Spe(r,a,l){let p="";const x=r.x.translate/a.x,v=r.y.translate/a.y,T=(l==null?void 0:l.z)||0;if((x||v||T)&&(p=`translate3d(${x}px, ${v}px, ${T}px) `),(a.x!==1||a.y!==1)&&(p+=`scale(${1/a.x}, ${1/a.y}) `),l){const{transformPerspective:O,rotate:V,rotateX:D,rotateY:$,skewX:re,skewY:H}=l;O&&(p=`perspective(${O}px) ${p}`),V&&(p+=`rotate(${V}deg) `),D&&(p+=`rotateX(${D}deg) `),$&&(p+=`rotateY(${$}deg) `),re&&(p+=`skewX(${re}deg) `),H&&(p+=`skewY(${H}deg) `)}const M=r.x.scale*a.x,_=r.y.scale*a.y;return(M!==1||_!==1)&&(p+=`scale(${M}, ${_})`),p||"none"}const X5=["TopLeft","TopRight","BottomLeft","BottomRight"],Tpe=X5.length,d4=r=>typeof r=="string"?parseFloat(r):r,f4=r=>typeof r=="number"||mt.test(r);function kpe(r,a,l,p,x,v){x?(r.opacity=ur(0,l.opacity??1,Epe(p)),r.opacityExit=ur(a.opacity??1,0,Npe(p))):v&&(r.opacity=ur(a.opacity??1,l.opacity??1,p));for(let T=0;T<Tpe;T++){const M=`border${X5[T]}Radius`;let _=p4(a,M),O=p4(l,M);if(_===void 0&&O===void 0)continue;_||(_=0),O||(O=0),_===0||O===0||f4(_)===f4(O)?(r[M]=Math.max(ur(d4(_),d4(O),p),0),(Do.test(O)||Do.test(_))&&(r[M]+="%")):r[M]=O}(a.rotate||l.rotate)&&(r.rotate=ur(a.rotate||0,l.rotate||0,p))}function p4(r,a){return r[a]!==void 0?r[a]:r.borderRadius}const Epe=Z5(0,.5,_O),Npe=Z5(.5,.95,xa);function Z5(r,a,l){return p=>p<r?0:p>a?1:l(o0(r,a,p))}function Ape(r,a,l){const p=Fs(r)?r:nf(r);return p.start(EI("",p,a,l)),p.animation}function h0(r,a,l,p={passive:!0}){return r.addEventListener(a,l,p),()=>r.removeEventListener(a,l)}const Rpe=(r,a)=>r.depth-a.depth;class Mpe{constructor(){this.children=[],this.isDirty=!1}add(a){cI(this.children,a),this.isDirty=!0}remove(a){hI(this.children,a),this.isDirty=!0}forEach(a){this.isDirty&&this.children.sort(Rpe),this.isDirty=!1,this.children.forEach(a)}}function Lpe(r,a){const l=Hs.now(),p=({timestamp:x})=>{const v=x-l;v>=a&&(zu(p),r(v-a))};return Jn.setup(p,!0),()=>zu(p)}function _m(r){return Fs(r)?r.get():r}class Dpe{constructor(){this.members=[]}add(a){cI(this.members,a),a.scheduleRender()}remove(a){if(hI(this.members,a),a===this.prevLead&&(this.prevLead=void 0),a===this.lead){const l=this.members[this.members.length-1];l&&this.promote(l)}}relegate(a){const l=this.members.findIndex(x=>a===x);if(l===0)return!1;let p;for(let x=l;x>=0;x--){const v=this.members[x];if(v.isPresent!==!1){p=v;break}}return p?(this.promote(p),!0):!1}promote(a,l){const p=this.lead;if(a!==p&&(this.prevLead=p,this.lead=a,a.show(),p)){p.instance&&p.scheduleRender(),a.scheduleRender();const x=p.options.layoutDependency,v=a.options.layoutDependency;x!==void 0&&v!==void 0&&x===v||(a.resumeFrom=p,l&&(a.resumeFrom.preserveOpacity=!0),p.snapshot&&(a.snapshot=p.snapshot,a.snapshot.latestValues=p.animationValues||p.latestValues),a.root&&a.root.isUpdating&&(a.isLayoutDirty=!0));const{crossfade:M}=a.options;M===!1&&p.hide()}}exitAnimationComplete(){this.members.forEach(a=>{const{options:l,resumingFrom:p}=a;l.onExitComplete&&l.onExitComplete(),p&&p.options.onExitComplete&&p.options.onExitComplete()})}scheduleRender(){this.members.forEach(a=>{a.instance&&a.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const Vm={hasAnimatedSinceResize:!0,hasEverUpdated:!1},O2=["","X","Y","Z"],Ope=1e3;let Ppe=0;function P2(r,a,l,p){const{latestValues:x}=a;x[r]&&(l[r]=x[r],a.setStaticValue(r,0),p&&(p[r]=0))}function K5(r){if(r.hasCheckedOptimisedAppear=!0,r.root===r)return;const{visualElement:a}=r.options;if(!a)return;const l=h5(a);if(window.MotionHasOptimisedAnimation(l,"transform")){const{layout:x,layoutId:v}=r.options;window.MotionCancelOptimisedAnimation(l,"transform",Jn,!(x||v))}const{parent:p}=r;p&&!p.hasCheckedOptimisedAppear&&K5(p)}function $5({attachResizeListener:r,defaultParent:a,measureScroll:l,checkIsScrollRoot:p,resetTransform:x}){return class{constructor(T={},M=a==null?void 0:a()){this.id=Ppe++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(_pe),this.nodes.forEach(zpe),this.nodes.forEach(Xpe),this.nodes.forEach(Vpe)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=T,this.root=M?M.root||M:this,this.path=M?[...M.path,M]:[],this.parent=M,this.depth=M?M.depth+1:0;for(let _=0;_<this.path.length;_++)this.path[_].shouldResetTransform=!0;this.root===this&&(this.nodes=new Mpe)}addEventListener(T,M){return this.eventHandlers.has(T)||this.eventHandlers.set(T,new pI),this.eventHandlers.get(T).add(M)}notifyListeners(T,...M){const _=this.eventHandlers.get(T);_&&_.notify(...M)}hasListeners(T){return this.eventHandlers.has(T)}mount(T){if(this.instance)return;this.isSVG=I5(T)&&!Gfe(T),this.instance=T;const{layoutId:M,layout:_,visualElement:O}=this.options;if(O&&!O.current&&O.mount(T),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(_||M)&&(this.isLayoutDirty=!0),r){let V,D=0;const $=()=>this.root.updateBlockedByResize=!1;Jn.read(()=>{D=window.innerWidth}),r(T,()=>{const re=window.innerWidth;re!==D&&(D=re,this.root.updateBlockedByResize=!0,V&&V(),V=Lpe($,250),Vm.hasAnimatedSinceResize&&(Vm.hasAnimatedSinceResize=!1,this.nodes.forEach(x4)))})}M&&this.root.registerSharedNode(M,this),this.options.animate!==!1&&O&&(M||_)&&this.addEventListener("didUpdate",({delta:V,hasLayoutChanged:D,hasRelativeLayoutChanged:$,layout:re})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const H=this.options.transition||O.getDefaultTransition()||Hpe,{onLayoutAnimationStart:se,onLayoutAnimationComplete:Ee}=O.getProps(),ee=!this.targetLayout||!z5(this.targetLayout,re),Y=!D&&$;if(this.options.layoutRoot||this.resumeFrom||Y||D&&(ee||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const j={...kI(H,"layout"),onPlay:se,onComplete:Ee};(O.shouldReduceMotion||this.options.layoutRoot)&&(j.delay=0,j.type=!1),this.startAnimation(j),this.setAnimationOrigin(V,Y)}else D||x4(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=re})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const T=this.getStack();T&&T.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),zu(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Zpe),this.animationId++)}getTransformTemplate(){const{visualElement:T}=this.options;return T&&T.getProps().transformTemplate}willUpdate(T=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&K5(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let V=0;V<this.path.length;V++){const D=this.path[V];D.shouldResetTransform=!0,D.updateScroll("snapshot"),D.options.layoutRoot&&D.willUpdate(!1)}const{layoutId:M,layout:_}=this.options;if(M===void 0&&!_)return;const O=this.getTransformTemplate();this.prevTransformTemplateValue=O?O(this.latestValues,""):void 0,this.updateSnapshot(),T&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(m4);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(g4);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(Wpe),this.nodes.forEach(Fpe),this.nodes.forEach(Gpe)):this.nodes.forEach(g4),this.clearAllSnapshots();const M=Hs.now();xs.delta=Oo(0,1e3/60,M-xs.timestamp),xs.timestamp=M,xs.isProcessing=!0,k2.update.process(xs),k2.preRender.process(xs),k2.render.process(xs),xs.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,MI.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Bpe),this.sharedNodes.forEach(Kpe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Jn.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Jn.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!js(this.snapshot.measuredBox.x)&&!js(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let _=0;_<this.path.length;_++)this.path[_].updateScroll();const T=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=$r(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:M}=this.options;M&&M.notify("LayoutMeasure",this.layout.layoutBox,T?T.layoutBox:void 0)}updateScroll(T="measure"){let M=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===T&&(M=!1),M&&this.instance){const _=p(this.instance);this.scroll={animationId:this.root.animationId,phase:T,isRoot:_,offset:l(this.instance),wasRoot:this.scroll?this.scroll.isRoot:_}}}resetTransform(){if(!x)return;const T=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,M=this.projectionDelta&&!W5(this.projectionDelta),_=this.getTransformTemplate(),O=_?_(this.latestValues,""):void 0,V=O!==this.prevTransformTemplateValue;T&&this.instance&&(M||sh(this.latestValues)||V)&&(x(this.instance,O),this.shouldResetTransform=!1,this.scheduleRender())}measure(T=!0){const M=this.measurePageBox();let _=this.removeElementScroll(M);return T&&(_=this.removeTransform(_)),jpe(_),{animationId:this.root.animationId,measuredBox:M,layoutBox:_,latestValues:{},source:this.id}}measurePageBox(){var O;const{visualElement:T}=this.options;if(!T)return $r();const M=T.measureViewportBox();if(!(((O=this.scroll)==null?void 0:O.wasRoot)||this.path.some(Ype))){const{scroll:V}=this.root;V&&(Bd(M.x,V.offset.x),Bd(M.y,V.offset.y))}return M}removeElementScroll(T){var _;const M=$r();if(Ba(M,T),(_=this.scroll)!=null&&_.wasRoot)return M;for(let O=0;O<this.path.length;O++){const V=this.path[O],{scroll:D,options:$}=V;V!==this.root&&D&&$.layoutScroll&&(D.wasRoot&&Ba(M,T),Bd(M.x,D.offset.x),Bd(M.y,D.offset.y))}return M}applyTransform(T,M=!1){const _=$r();Ba(_,T);for(let O=0;O<this.path.length;O++){const V=this.path[O];!M&&V.options.layoutScroll&&V.scroll&&V!==V.root&&Wd(_,{x:-V.scroll.offset.x,y:-V.scroll.offset.y}),sh(V.latestValues)&&Wd(_,V.latestValues)}return sh(this.latestValues)&&Wd(_,this.latestValues),_}removeTransform(T){const M=$r();Ba(M,T);for(let _=0;_<this.path.length;_++){const O=this.path[_];if(!O.instance||!sh(O.latestValues))continue;sv(O.latestValues)&&O.updateSnapshot();const V=$r(),D=O.measurePageBox();Ba(V,D),a4(M,O.latestValues,O.snapshot?O.snapshot.layoutBox:void 0,V)}return sh(this.latestValues)&&a4(M,this.latestValues),M}setTargetDelta(T){this.targetDelta=T,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(T){this.options={...this.options,...T,crossfade:T.crossfade!==void 0?T.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==xs.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(T=!1){var re;const M=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=M.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=M.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=M.isSharedProjectionDirty);const _=!!this.resumingFrom||this!==M;if(!(T||_&&this.isSharedProjectionDirty||this.isProjectionDirty||(re=this.parent)!=null&&re.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:V,layoutId:D}=this.options;if(!this.layout||!(V||D))return;this.resolvedRelativeTargetAt=xs.timestamp;const $=this.getClosestProjectingParent();$&&this.linkedParentVersion!==$.layoutVersion&&!$.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&($&&$.layout?this.createRelativeTarget($,this.layout.layoutBox,$.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=$r(),this.targetWithTransforms=$r()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),bpe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Ba(this.target,this.layout.layoutBox),A5(this.target,this.targetDelta)):Ba(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,$&&!!$.resumingFrom==!!this.resumingFrom&&!$.options.layoutScroll&&$.target&&this.animationProgress!==1?this.createRelativeTarget($,this.target,$.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||sv(this.parent.latestValues)||N5(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(T,M,_){this.relativeParent=T,this.linkedParentVersion=T.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=$r(),this.relativeTargetOrigin=$r(),yg(this.relativeTargetOrigin,M,_),Ba(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var H;const T=this.getLead(),M=!!this.resumingFrom||this!==T;let _=!0;if((this.isProjectionDirty||(H=this.parent)!=null&&H.isProjectionDirty)&&(_=!1),M&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(_=!1),this.resolvedRelativeTargetAt===xs.timestamp&&(_=!1),_)return;const{layout:O,layoutId:V}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(O||V))return;Ba(this.layoutCorrected,this.layout.layoutBox);const D=this.treeScale.x,$=this.treeScale.y;Hfe(this.layoutCorrected,this.treeScale,this.path,M),T.layout&&!T.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(T.target=T.layout.layoutBox,T.targetWithTransforms=$r());const{target:re}=T;if(!re){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(e4(this.prevProjectionDelta.x,this.projectionDelta.x),e4(this.prevProjectionDelta.y,this.projectionDelta.y)),zp(this.projectionDelta,this.layoutCorrected,re,this.latestValues),(this.treeScale.x!==D||this.treeScale.y!==$||!h4(this.projectionDelta.x,this.prevProjectionDelta.x)||!h4(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",re))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(T=!0){var M;if((M=this.options.visualElement)==null||M.scheduleRender(),T){const _=this.getStack();_&&_.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Vd(),this.projectionDelta=Vd(),this.projectionDeltaWithTransform=Vd()}setAnimationOrigin(T,M=!1){const _=this.snapshot,O=_?_.latestValues:{},V={...this.latestValues},D=Vd();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!M;const $=$r(),re=_?_.source:void 0,H=this.layout?this.layout.source:void 0,se=re!==H,Ee=this.getStack(),ee=!Ee||Ee.members.length<=1,Y=!!(se&&!ee&&this.options.crossfade===!0&&!this.path.some(Upe));this.animationProgress=0;let j;this.mixTargetDelta=fe=>{const be=fe/1e3;y4(D.x,T.x,be),y4(D.y,T.y,be),this.setTargetDelta(D),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(yg($,this.layout.layoutBox,this.relativeParent.layout.layoutBox),$pe(this.relativeTarget,this.relativeTargetOrigin,$,be),j&&Cpe(this.relativeTarget,j)&&(this.isProjectionDirty=!1),j||(j=$r()),Ba(j,this.relativeTarget)),se&&(this.animationValues=V,kpe(V,O,this.latestValues,be,Y,ee)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=be},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(T){var M,_,O;this.notifyListeners("animationStart"),(M=this.currentAnimation)==null||M.stop(),(O=(_=this.resumingFrom)==null?void 0:_.currentAnimation)==null||O.stop(),this.pendingAnimation&&(zu(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Jn.update(()=>{Vm.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=nf(0)),this.currentAnimation=Ape(this.motionValue,[0,1e3],{...T,velocity:0,isSync:!0,onUpdate:V=>{this.mixTargetDelta(V),T.onUpdate&&T.onUpdate(V)},onStop:()=>{},onComplete:()=>{T.onComplete&&T.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const T=this.getStack();T&&T.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Ope),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const T=this.getLead();let{targetWithTransforms:M,target:_,layout:O,latestValues:V}=T;if(!(!M||!_||!O)){if(this!==T&&this.layout&&O&&U5(this.options.animationType,this.layout.layoutBox,O.layoutBox)){_=this.target||$r();const D=js(this.layout.layoutBox.x);_.x.min=T.target.x.min,_.x.max=_.x.min+D;const $=js(this.layout.layoutBox.y);_.y.min=T.target.y.min,_.y.max=_.y.min+$}Ba(M,_),Wd(M,V),zp(this.projectionDeltaWithTransform,this.layoutCorrected,M,V)}}registerSharedNode(T,M){this.sharedNodes.has(T)||this.sharedNodes.set(T,new Dpe),this.sharedNodes.get(T).add(M);const O=M.options.initialPromotionConfig;M.promote({transition:O?O.transition:void 0,preserveFollowOpacity:O&&O.shouldPreserveFollowOpacity?O.shouldPreserveFollowOpacity(M):void 0})}isLead(){const T=this.getStack();return T?T.lead===this:!0}getLead(){var M;const{layoutId:T}=this.options;return T?((M=this.getStack())==null?void 0:M.lead)||this:this}getPrevLead(){var M;const{layoutId:T}=this.options;return T?(M=this.getStack())==null?void 0:M.prevLead:void 0}getStack(){const{layoutId:T}=this.options;if(T)return this.root.sharedNodes.get(T)}promote({needsReset:T,transition:M,preserveFollowOpacity:_}={}){const O=this.getStack();O&&O.promote(this,_),T&&(this.projectionDelta=void 0,this.needsReset=!0),M&&this.setOptions({transition:M})}relegate(){const T=this.getStack();return T?T.relegate(this):!1}resetSkewAndRotation(){const{visualElement:T}=this.options;if(!T)return;let M=!1;const{latestValues:_}=T;if((_.z||_.rotate||_.rotateX||_.rotateY||_.rotateZ||_.skewX||_.skewY)&&(M=!0),!M)return;const O={};_.z&&P2("z",T,O,this.animationValues);for(let V=0;V<O2.length;V++)P2(`rotate${O2[V]}`,T,O,this.animationValues),P2(`skew${O2[V]}`,T,O,this.animationValues);T.render();for(const V in O)T.setStaticValue(V,O[V]),this.animationValues&&(this.animationValues[V]=O[V]);T.scheduleRender()}applyProjectionStyles(T,M){if(!this.instance||this.isSVG)return;if(!this.isVisible){T.visibility="hidden";return}const _=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,T.visibility="",T.opacity="",T.pointerEvents=_m(M==null?void 0:M.pointerEvents)||"",T.transform=_?_(this.latestValues,""):"none";return}const O=this.getLead();if(!this.projectionDelta||!this.layout||!O.target){this.options.layoutId&&(T.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,T.pointerEvents=_m(M==null?void 0:M.pointerEvents)||""),this.hasProjected&&!sh(this.latestValues)&&(T.transform=_?_({},""):"none",this.hasProjected=!1);return}T.visibility="";const V=O.animationValues||O.latestValues;this.applyTransformsToTarget();let D=Spe(this.projectionDeltaWithTransform,this.treeScale,V);_&&(D=_(V,D)),T.transform=D;const{x:$,y:re}=this.projectionDelta;T.transformOrigin=`${$.origin*100}% ${re.origin*100}% 0`,O.animationValues?T.opacity=O===this?V.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:V.opacityExit:T.opacity=O===this?V.opacity!==void 0?V.opacity:"":V.opacityExit!==void 0?V.opacityExit:0;for(const H in av){if(V[H]===void 0)continue;const{correct:se,applyTo:Ee,isCSSVariable:ee}=av[H],Y=D==="none"?V[H]:se(V[H],O);if(Ee){const j=Ee.length;for(let fe=0;fe<j;fe++)T[Ee[fe]]=Y}else ee?this.options.visualElement.renderState.vars[H]=Y:T[H]=Y}this.options.layoutId&&(T.pointerEvents=O===this?_m(M==null?void 0:M.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(T=>{var M;return(M=T.currentAnimation)==null?void 0:M.stop()}),this.root.nodes.forEach(m4),this.root.sharedNodes.clear()}}}function Fpe(r){r.updateLayout()}function Gpe(r){var l;const a=((l=r.resumeFrom)==null?void 0:l.snapshot)||r.snapshot;if(r.isLead()&&r.layout&&a&&r.hasListeners("didUpdate")){const{layoutBox:p,measuredBox:x}=r.layout,{animationType:v}=r.options,T=a.source!==r.layout.source;v==="size"?ha(D=>{const $=T?a.measuredBox[D]:a.layoutBox[D],re=js($);$.min=p[D].min,$.max=$.min+re}):U5(v,a.layoutBox,p)&&ha(D=>{const $=T?a.measuredBox[D]:a.layoutBox[D],re=js(p[D]);$.max=$.min+re,r.relativeTarget&&!r.currentAnimation&&(r.isProjectionDirty=!0,r.relativeTarget[D].max=r.relativeTarget[D].min+re)});const M=Vd();zp(M,p,a.layoutBox);const _=Vd();T?zp(_,r.applyTransform(x,!0),a.measuredBox):zp(_,p,a.layoutBox);const O=!W5(M);let V=!1;if(!r.resumeFrom){const D=r.getClosestProjectingParent();if(D&&!D.resumeFrom){const{snapshot:$,layout:re}=D;if($&&re){const H=$r();yg(H,a.layoutBox,$.layoutBox);const se=$r();yg(se,p,re.layoutBox),z5(H,se)||(V=!0),D.options.layoutRoot&&(r.relativeTarget=se,r.relativeTargetOrigin=H,r.relativeParent=D)}}}r.notifyListeners("didUpdate",{layout:p,snapshot:a,delta:_,layoutDelta:M,hasLayoutChanged:O,hasRelativeLayoutChanged:V})}else if(r.isLead()){const{onExitComplete:p}=r.options;p&&p()}r.options.transition=void 0}function _pe(r){r.parent&&(r.isProjecting()||(r.isProjectionDirty=r.parent.isProjectionDirty),r.isSharedProjectionDirty||(r.isSharedProjectionDirty=!!(r.isProjectionDirty||r.parent.isProjectionDirty||r.parent.isSharedProjectionDirty)),r.isTransformDirty||(r.isTransformDirty=r.parent.isTransformDirty))}function Vpe(r){r.isProjectionDirty=r.isSharedProjectionDirty=r.isTransformDirty=!1}function Bpe(r){r.clearSnapshot()}function m4(r){r.clearMeasurements()}function g4(r){r.isLayoutDirty=!1}function Wpe(r){const{visualElement:a}=r.options;a&&a.getProps().onBeforeLayoutMeasure&&a.notify("BeforeLayoutMeasure"),r.resetTransform()}function x4(r){r.finishAnimation(),r.targetDelta=r.relativeTarget=r.target=void 0,r.isProjectionDirty=!0}function zpe(r){r.resolveTargetDelta()}function Xpe(r){r.calcProjection()}function Zpe(r){r.resetSkewAndRotation()}function Kpe(r){r.removeLeadSnapshot()}function y4(r,a,l){r.translate=ur(a.translate,0,l),r.scale=ur(a.scale,1,l),r.origin=a.origin,r.originPoint=a.originPoint}function b4(r,a,l,p){r.min=ur(a.min,l.min,p),r.max=ur(a.max,l.max,p)}function $pe(r,a,l,p){b4(r.x,a.x,l.x,p),b4(r.y,a.y,l.y,p)}function Upe(r){return r.animationValues&&r.animationValues.opacityExit!==void 0}const Hpe={duration:.45,ease:[.4,0,.1,1]},w4=r=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(r),v4=w4("applewebkit/")&&!w4("chrome/")?Math.round:xa;function I4(r){r.min=v4(r.min),r.max=v4(r.max)}function jpe(r){I4(r.x),I4(r.y)}function U5(r,a,l){return r==="position"||r==="preserve-aspect"&&!ype(c4(a),c4(l),.2)}function Ype(r){var a;return r!==r.root&&((a=r.scroll)==null?void 0:a.wasRoot)}const Qpe=$5({attachResizeListener:(r,a)=>h0(r,"resize",a),measureScroll:()=>{var r,a;return{x:document.documentElement.scrollLeft||((r=document.body)==null?void 0:r.scrollLeft)||0,y:document.documentElement.scrollTop||((a=document.body)==null?void 0:a.scrollTop)||0}},checkIsScrollRoot:()=>!0}),F2={current:void 0},H5=$5({measureScroll:r=>({x:r.scrollLeft,y:r.scrollTop}),defaultParent:()=>{if(!F2.current){const r=new Qpe({});r.mount(window),r.setOptions({layoutScroll:!0}),F2.current=r}return F2.current},resetTransform:(r,a)=>{r.style.transform=a!==void 0?a:"none"},checkIsScrollRoot:r=>window.getComputedStyle(r).position==="fixed"}),GI=Ge.createContext({transformPagePoint:r=>r,isStatic:!1,reducedMotion:"never"});function C4(r,a){if(typeof r=="function")return r(a);r!=null&&(r.current=a)}function Jpe(...r){return a=>{let l=!1;const p=r.map(x=>{const v=C4(x,a);return!l&&typeof v=="function"&&(l=!0),v});if(l)return()=>{for(let x=0;x<p.length;x++){const v=p[x];typeof v=="function"?v():C4(r[x],null)}}}}function qpe(...r){return Ge.useCallback(Jpe(...r),r)}class e0e extends Ge.Component{getSnapshotBeforeUpdate(a){const l=this.props.childRef.current;if(l&&a.isPresent&&!this.props.isPresent){const p=l.offsetParent,x=nv(p)&&p.offsetWidth||0,v=nv(p)&&p.offsetHeight||0,T=this.props.sizeRef.current;T.height=l.offsetHeight||0,T.width=l.offsetWidth||0,T.top=l.offsetTop,T.left=l.offsetLeft,T.right=x-T.width-T.left,T.bottom=v-T.height-T.top}return null}componentDidUpdate(){}render(){return this.props.children}}function t0e({children:r,isPresent:a,anchorX:l,anchorY:p,root:x}){var D;const v=Ge.useId(),T=Ge.useRef(null),M=Ge.useRef({width:0,height:0,top:0,left:0,right:0,bottom:0}),{nonce:_}=Ge.useContext(GI),O=((D=r.props)==null?void 0:D.ref)??(r==null?void 0:r.ref),V=qpe(T,O);return Ge.useInsertionEffect(()=>{const{width:$,height:re,top:H,left:se,right:Ee,bottom:ee}=M.current;if(a||!T.current||!$||!re)return;const Y=l==="left"?`left: ${se}`:`right: ${Ee}`,j=p==="bottom"?`bottom: ${ee}`:`top: ${H}`;T.current.dataset.motionPopId=v;const fe=document.createElement("style");_&&(fe.nonce=_);const be=x??document.head;return be.appendChild(fe),fe.sheet&&fe.sheet.insertRule(`
          [data-motion-pop-id="${v}"] {
            position: absolute !important;
            width: ${$}px !important;
            height: ${re}px !important;
            ${Y}px !important;
            ${j}px !important;
          }
        `),()=>{be.contains(fe)&&be.removeChild(fe)}},[a]),xe.jsx(e0e,{isPresent:a,childRef:T,sizeRef:M,children:Ge.cloneElement(r,{ref:V})})}const n0e=({children:r,initial:a,isPresent:l,onExitComplete:p,custom:x,presenceAffectsLayout:v,mode:T,anchorX:M,anchorY:_,root:O})=>{const V=uI(r0e),D=Ge.useId();let $=!0,re=Ge.useMemo(()=>($=!1,{id:D,initial:a,isPresent:l,custom:x,onExitComplete:H=>{V.set(H,!0);for(const se of V.values())if(!se)return;p&&p()},register:H=>(V.set(H,!1),()=>V.delete(H))}),[l,V,p]);return v&&$&&(re={...re}),Ge.useMemo(()=>{V.forEach((H,se)=>V.set(se,!1))},[l]),Ge.useEffect(()=>{!l&&!V.size&&p&&p()},[l]),T==="popLayout"&&(r=xe.jsx(t0e,{isPresent:l,anchorX:M,anchorY:_,root:O,children:r})),xe.jsx(Bg.Provider,{value:re,children:r})};function r0e(){return new Map}function j5(r=!0){const a=Ge.useContext(Bg);if(a===null)return[!0,null];const{isPresent:l,onExitComplete:p,register:x}=a,v=Ge.useId();Ge.useEffect(()=>{if(r)return x(v)},[r]);const T=Ge.useCallback(()=>r&&p&&p(v),[v,p,r]);return!l&&p?[!1,T]:[!0]}const wm=r=>r.key||"";function S4(r){const a=[];return Ge.Children.forEach(r,l=>{Ge.isValidElement(l)&&a.push(l)}),a}const s0e=({children:r,custom:a,initial:l=!0,onExitComplete:p,presenceAffectsLayout:x=!0,mode:v="sync",propagate:T=!1,anchorX:M="left",anchorY:_="top",root:O})=>{const[V,D]=j5(T),$=Ge.useMemo(()=>S4(r),[r]),re=T&&!V?[]:$.map(wm),H=Ge.useRef(!0),se=Ge.useRef($),Ee=uI(()=>new Map),ee=Ge.useRef(new Set),[Y,j]=Ge.useState($),[fe,be]=Ge.useState($);EO(()=>{H.current=!1,se.current=$;for(let we=0;we<fe.length;we++){const Ne=wm(fe[we]);re.includes(Ne)?(Ee.delete(Ne),ee.current.delete(Ne)):Ee.get(Ne)!==!0&&Ee.set(Ne,!1)}},[fe,re.length,re.join("-")]);const Fe=[];if($!==Y){let we=[...$];for(let Ne=0;Ne<fe.length;Ne++){const it=fe[Ne],Bt=wm(it);re.includes(Bt)||(we.splice(Ne,0,it),Fe.push(it))}return v==="wait"&&Fe.length&&(we=Fe),be(S4(we)),j($),null}const{forceRender:ue}=Ge.useContext(lI);return xe.jsx(xe.Fragment,{children:fe.map(we=>{const Ne=wm(we),it=T&&!V?!1:$===fe||re.includes(Ne),Bt=()=>{if(ee.current.has(Ne))return;if(ee.current.add(Ne),Ee.has(Ne))Ee.set(Ne,!0);else return;let ht=!0;Ee.forEach(_t=>{_t||(ht=!1)}),ht&&(ue==null||ue(),be(se.current),T&&(D==null||D()),p&&p())};return xe.jsx(n0e,{isPresent:it,initial:!H.current||l?void 0:!1,custom:a,presenceAffectsLayout:x,mode:v,root:O,onExitComplete:it?void 0:Bt,anchorX:M,anchorY:_,children:we},Ne)})})},Y5=Ge.createContext({strict:!1}),T4={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]};let k4=!1;function i0e(){if(k4)return;const r={};for(const a in T4)r[a]={isEnabled:l=>T4[a].some(p=>!!l[p])};T5(r),k4=!0}function Q5(){return i0e(),Zfe()}function a0e(r){const a=Q5();for(const l in r)a[l]={...a[l],...r[l]};T5(a)}const o0e=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function bg(r){return r.startsWith("while")||r.startsWith("drag")&&r!=="draggable"||r.startsWith("layout")||r.startsWith("onTap")||r.startsWith("onPan")||r.startsWith("onLayout")||o0e.has(r)}let J5=r=>!bg(r);function l0e(r){typeof r=="function"&&(J5=a=>a.startsWith("on")?!bg(a):r(a))}try{l0e(require("@emotion/is-prop-valid").default)}catch{}function u0e(r,a,l){const p={};for(const x in r)x==="values"&&typeof r.values=="object"||(J5(x)||l===!0&&bg(x)||!a&&!bg(x)||r.draggable&&x.startsWith("onDrag"))&&(p[x]=r[x]);return p}const Xg=Ge.createContext({});function c0e(r,a){if(zg(r)){const{initial:l,animate:p}=r;return{initial:l===!1||c0(l)?l:void 0,animate:c0(p)?p:void 0}}return r.inherit!==!1?a:{}}function h0e(r){const{initial:a,animate:l}=c0e(r,Ge.useContext(Xg));return Ge.useMemo(()=>({initial:a,animate:l}),[E4(a),E4(l)])}function E4(r){return Array.isArray(r)?r.join(" "):r}const _I=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function q5(r,a,l){for(const p in a)!Fs(a[p])&&!L5(p,l)&&(r[p]=a[p])}function d0e({transformTemplate:r},a){return Ge.useMemo(()=>{const l=_I();return PI(l,a,r),Object.assign({},l.vars,l.style)},[a])}function f0e(r,a){const l=r.style||{},p={};return q5(p,l,r),Object.assign(p,d0e(r,a)),p}function p0e(r,a){const l={},p=f0e(r,a);return r.drag&&r.dragListener!==!1&&(l.draggable=!1,p.userSelect=p.WebkitUserSelect=p.WebkitTouchCallout="none",p.touchAction=r.drag===!0?"none":`pan-${r.drag==="x"?"y":"x"}`),r.tabIndex===void 0&&(r.onTap||r.onTapStart||r.whileTap)&&(l.tabIndex=0),l.style=p,l}const eP=()=>({..._I(),attrs:{}});function m0e(r,a,l,p){const x=Ge.useMemo(()=>{const v=eP();return D5(v,a,P5(p),r.transformTemplate,r.style),{...v.attrs,style:{...v.style}}},[a]);if(r.style){const v={};q5(v,r.style,r),x.style={...v,...x.style}}return x}const g0e=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function VI(r){return typeof r!="string"||r.includes("-")?!1:!!(g0e.indexOf(r)>-1||/[A-Z]/u.test(r))}function x0e(r,a,l,{latestValues:p},x,v=!1,T){const _=(T??VI(r)?m0e:p0e)(a,p,x,r),O=u0e(a,typeof r=="string",v),V=r!==Ge.Fragment?{...O,..._,ref:l}:{},{children:D}=a,$=Ge.useMemo(()=>Fs(D)?D.get():D,[D]);return Ge.createElement(r,{...V,children:$})}function y0e({scrapeMotionValuesFromProps:r,createRenderState:a},l,p,x){return{latestValues:b0e(l,p,x,r),renderState:a()}}function b0e(r,a,l,p){const x={},v=p(r,{});for(const $ in v)x[$]=_m(v[$]);let{initial:T,animate:M}=r;const _=zg(r),O=S5(r);a&&O&&!_&&r.inherit!==!1&&(T===void 0&&(T=a.initial),M===void 0&&(M=a.animate));let V=l?l.initial===!1:!1;V=V||T===!1;const D=V?M:T;if(D&&typeof D!="boolean"&&!Wg(D)){const $=Array.isArray(D)?D:[D];for(let re=0;re<$.length;re++){const H=NI(r,$[re]);if(H){const{transitionEnd:se,transition:Ee,...ee}=H;for(const Y in ee){let j=ee[Y];if(Array.isArray(j)){const fe=V?j.length-1:0;j=j[fe]}j!==null&&(x[Y]=j)}for(const Y in se)x[Y]=se[Y]}}}return x}const tP=r=>(a,l)=>{const p=Ge.useContext(Xg),x=Ge.useContext(Bg),v=()=>y0e(r,a,p,x);return l?v():uI(v)},w0e=tP({scrapeMotionValuesFromProps:FI,createRenderState:_I}),v0e=tP({scrapeMotionValuesFromProps:F5,createRenderState:eP}),I0e=Symbol.for("motionComponentSymbol");function C0e(r,a,l){const p=Ge.useRef(l);Ge.useInsertionEffect(()=>{p.current=l});const x=Ge.useRef(null);return Ge.useCallback(v=>{var M;v&&((M=r.onMount)==null||M.call(r,v)),a&&(v?a.mount(v):a.unmount());const T=p.current;if(typeof T=="function")if(v){const _=T(v);typeof _=="function"&&(x.current=_)}else x.current?(x.current(),x.current=null):T(v);else T&&(T.current=v)},[a])}const nP=Ge.createContext({});function Rp(r){return r&&typeof r=="object"&&Object.prototype.hasOwnProperty.call(r,"current")}function S0e(r,a,l,p,x,v){var ee,Y;const{visualElement:T}=Ge.useContext(Xg),M=Ge.useContext(Y5),_=Ge.useContext(Bg),O=Ge.useContext(GI).reducedMotion,V=Ge.useRef(null),D=Ge.useRef(!1);p=p||M.renderer,!V.current&&p&&(V.current=p(r,{visualState:a,parent:T,props:l,presenceContext:_,blockInitialAnimation:_?_.initial===!1:!1,reducedMotionConfig:O,isSVG:v}),D.current&&V.current&&(V.current.manuallyAnimateOnMount=!0));const $=V.current,re=Ge.useContext(nP);$&&!$.projection&&x&&($.type==="html"||$.type==="svg")&&T0e(V.current,l,x,re);const H=Ge.useRef(!1);Ge.useInsertionEffect(()=>{$&&H.current&&$.update(l,_)});const se=l[c5],Ee=Ge.useRef(!!se&&!((ee=window.MotionHandoffIsComplete)!=null&&ee.call(window,se))&&((Y=window.MotionHasOptimisedAnimation)==null?void 0:Y.call(window,se)));return EO(()=>{D.current=!0,$&&(H.current=!0,window.MotionIsMounted=!0,$.updateFeatures(),$.scheduleRenderMicrotask(),Ee.current&&$.animationState&&$.animationState.animateChanges())}),Ge.useEffect(()=>{$&&(!Ee.current&&$.animationState&&$.animationState.animateChanges(),Ee.current&&(queueMicrotask(()=>{var j;(j=window.MotionHandoffMarkAsComplete)==null||j.call(window,se)}),Ee.current=!1),$.enteringChildren=void 0)}),$}function T0e(r,a,l,p){const{layoutId:x,layout:v,drag:T,dragConstraints:M,layoutScroll:_,layoutRoot:O,layoutCrossfade:V}=a;r.projection=new l(r.latestValues,a["data-framer-portal-id"]?void 0:rP(r.parent)),r.projection.setOptions({layoutId:x,layout:v,alwaysMeasureLayout:!!T||M&&Rp(M),visualElement:r,animationType:typeof v=="string"?v:"both",initialPromotionConfig:p,crossfade:V,layoutScroll:_,layoutRoot:O})}function rP(r){if(r)return r.options.allowProjection!==!1?r.projection:rP(r.parent)}function G2(r,{forwardMotionProps:a=!1,type:l}={},p,x){p&&a0e(p);const v=l?l==="svg":VI(r),T=v?v0e:w0e;function M(O,V){let D;const $={...Ge.useContext(GI),...O,layoutId:k0e(O)},{isStatic:re}=$,H=h0e(O),se=T(O,re);if(!re&&kO){E0e();const Ee=N0e($);D=Ee.MeasureLayout,H.visualElement=S0e(r,se,$,x,Ee.ProjectionNode,v)}return xe.jsxs(Xg.Provider,{value:H,children:[D&&H.visualElement?xe.jsx(D,{visualElement:H.visualElement,...$}):null,x0e(r,O,C0e(se,H.visualElement,V),se,re,a,v)]})}M.displayName=`motion.${typeof r=="string"?r:`create(${r.displayName??r.name??""})`}`;const _=Ge.forwardRef(M);return _[I0e]=r,_}function k0e({layoutId:r}){const a=Ge.useContext(lI).id;return a&&r!==void 0?a+"-"+r:r}function E0e(r,a){Ge.useContext(Y5).strict}function N0e(r){const a=Q5(),{drag:l,layout:p}=a;if(!l&&!p)return{};const x={...l,...p};return{MeasureLayout:l!=null&&l.isEnabled(r)||p!=null&&p.isEnabled(r)?x.MeasureLayout:void 0,ProjectionNode:x.ProjectionNode}}function A0e(r,a){if(typeof Proxy>"u")return G2;const l=new Map,p=(v,T)=>G2(v,T,r,a),x=(v,T)=>p(v,T);return new Proxy(x,{get:(v,T)=>T==="create"?p:(l.has(T)||l.set(T,G2(T,void 0,r,a)),l.get(T))})}const R0e=(r,a)=>a.isSVG??VI(r)?new ope(a):new tpe(a,{allowProjection:r!==Ge.Fragment});class M0e extends ju{constructor(a){super(a),a.animationState||(a.animationState=dpe(a))}updateAnimationControlsSubscription(){const{animate:a}=this.node.getProps();Wg(a)&&(this.unmountControls=a.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:a}=this.node.getProps(),{animate:l}=this.node.prevProps||{};a!==l&&this.updateAnimationControlsSubscription()}unmount(){var a;this.node.animationState.reset(),(a=this.unmountControls)==null||a.call(this)}}let L0e=0;class D0e extends ju{constructor(){super(...arguments),this.id=L0e++}update(){if(!this.node.presenceContext)return;const{isPresent:a,onExitComplete:l}=this.node.presenceContext,{isPresent:p}=this.node.prevPresenceContext||{};if(!this.node.animationState||a===p)return;const x=this.node.animationState.setActive("exit",!a);l&&!a&&x.then(()=>{l(this.id)})}mount(){const{register:a,onExitComplete:l}=this.node.presenceContext||{};l&&l(this.id),a&&(this.unmount=a(this.id))}unmount(){}}const O0e={animation:{Feature:M0e},exit:{Feature:D0e}};function I0(r){return{point:{x:r.pageX,y:r.pageY}}}const P0e=r=>a=>LI(a)&&r(a,I0(a));function Xp(r,a,l,p){return h0(r,a,P0e(l),p)}const sP=({current:r})=>r?r.ownerDocument.defaultView:null,N4=(r,a)=>Math.abs(r-a);function F0e(r,a){const l=N4(r.x,a.x),p=N4(r.y,a.y);return Math.sqrt(l**2+p**2)}const A4=new Set(["auto","scroll"]);class iP{constructor(a,l,{transformPagePoint:p,contextWindow:x=window,dragSnapToOrigin:v=!1,distanceThreshold:T=3,element:M}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.scrollPositions=new Map,this.removeScrollListeners=null,this.onElementScroll=re=>{this.handleScroll(re.target)},this.onWindowScroll=()=>{this.handleScroll(window)},this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const re=V2(this.lastMoveEventInfo,this.history),H=this.startEvent!==null,se=F0e(re.offset,{x:0,y:0})>=this.distanceThreshold;if(!H&&!se)return;const{point:Ee}=re,{timestamp:ee}=xs;this.history.push({...Ee,timestamp:ee});const{onStart:Y,onMove:j}=this.handlers;H||(Y&&Y(this.lastMoveEvent,re),this.startEvent=this.lastMoveEvent),j&&j(this.lastMoveEvent,re)},this.handlePointerMove=(re,H)=>{this.lastMoveEvent=re,this.lastMoveEventInfo=_2(H,this.transformPagePoint),Jn.update(this.updatePoint,!0)},this.handlePointerUp=(re,H)=>{this.end();const{onEnd:se,onSessionEnd:Ee,resumeAnimation:ee}=this.handlers;if((this.dragSnapToOrigin||!this.startEvent)&&ee&&ee(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const Y=V2(re.type==="pointercancel"?this.lastMoveEventInfo:_2(H,this.transformPagePoint),this.history);this.startEvent&&se&&se(re,Y),Ee&&Ee(re,Y)},!LI(a))return;this.dragSnapToOrigin=v,this.handlers=l,this.transformPagePoint=p,this.distanceThreshold=T,this.contextWindow=x||window;const _=I0(a),O=_2(_,this.transformPagePoint),{point:V}=O,{timestamp:D}=xs;this.history=[{...V,timestamp:D}];const{onSessionStart:$}=l;$&&$(a,V2(O,this.history)),this.removeListeners=b0(Xp(this.contextWindow,"pointermove",this.handlePointerMove),Xp(this.contextWindow,"pointerup",this.handlePointerUp),Xp(this.contextWindow,"pointercancel",this.handlePointerUp)),M&&this.startScrollTracking(M)}startScrollTracking(a){let l=a.parentElement;for(;l;){const p=getComputedStyle(l);(A4.has(p.overflowX)||A4.has(p.overflowY))&&this.scrollPositions.set(l,{x:l.scrollLeft,y:l.scrollTop}),l=l.parentElement}this.scrollPositions.set(window,{x:window.scrollX,y:window.scrollY}),window.addEventListener("scroll",this.onElementScroll,{capture:!0,passive:!0}),window.addEventListener("scroll",this.onWindowScroll,{passive:!0}),this.removeScrollListeners=()=>{window.removeEventListener("scroll",this.onElementScroll,{capture:!0}),window.removeEventListener("scroll",this.onWindowScroll)}}handleScroll(a){const l=this.scrollPositions.get(a);if(!l)return;const p=a===window,x=p?{x:window.scrollX,y:window.scrollY}:{x:a.scrollLeft,y:a.scrollTop},v={x:x.x-l.x,y:x.y-l.y};v.x===0&&v.y===0||(p?this.lastMoveEventInfo&&(this.lastMoveEventInfo.point.x+=v.x,this.lastMoveEventInfo.point.y+=v.y):this.history.length>0&&(this.history[0].x-=v.x,this.history[0].y-=v.y),this.scrollPositions.set(a,x),Jn.update(this.updatePoint,!0))}updateHandlers(a){this.handlers=a}end(){this.removeListeners&&this.removeListeners(),this.removeScrollListeners&&this.removeScrollListeners(),this.scrollPositions.clear(),zu(this.updatePoint)}}function _2(r,a){return a?{point:a(r.point)}:r}function R4(r,a){return{x:r.x-a.x,y:r.y-a.y}}function V2({point:r},a){return{point:r,delta:R4(r,aP(a)),offset:R4(r,G0e(a)),velocity:_0e(a,.1)}}function G0e(r){return r[0]}function aP(r){return r[r.length-1]}function _0e(r,a){if(r.length<2)return{x:0,y:0};let l=r.length-1,p=null;const x=aP(r);for(;l>=0&&(p=r[l],!(x.timestamp-p.timestamp>wl(a)));)l--;if(!p)return{x:0,y:0};const v=ma(x.timestamp-p.timestamp);if(v===0)return{x:0,y:0};const T={x:(x.x-p.x)/v,y:(x.y-p.y)/v};return T.x===1/0&&(T.x=0),T.y===1/0&&(T.y=0),T}function V0e(r,{min:a,max:l},p){return a!==void 0&&r<a?r=p?ur(a,r,p.min):Math.max(r,a):l!==void 0&&r>l&&(r=p?ur(l,r,p.max):Math.min(r,l)),r}function M4(r,a,l){return{min:a!==void 0?r.min+a:void 0,max:l!==void 0?r.max+l-(r.max-r.min):void 0}}function B0e(r,{top:a,left:l,bottom:p,right:x}){return{x:M4(r.x,l,x),y:M4(r.y,a,p)}}function L4(r,a){let l=a.min-r.min,p=a.max-r.max;return a.max-a.min<r.max-r.min&&([l,p]=[p,l]),{min:l,max:p}}function W0e(r,a){return{x:L4(r.x,a.x),y:L4(r.y,a.y)}}function z0e(r,a){let l=.5;const p=js(r),x=js(a);return x>p?l=o0(a.min,a.max-p,r.min):p>x&&(l=o0(r.min,r.max-x,a.min)),Oo(0,1,l)}function X0e(r,a){const l={};return a.min!==void 0&&(l.min=a.min-r.min),a.max!==void 0&&(l.max=a.max-r.min),l}const ov=.35;function Z0e(r=ov){return r===!1?r=0:r===!0&&(r=ov),{x:D4(r,"left","right"),y:D4(r,"top","bottom")}}function D4(r,a,l){return{min:O4(r,a),max:O4(r,l)}}function O4(r,a){return typeof r=="number"?r:r[a]||0}const K0e=new WeakMap;class $0e{constructor(a){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=$r(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=a}start(a,{snapToCursor:l=!1,distanceThreshold:p}={}){const{presenceContext:x}=this.visualElement;if(x&&x.isPresent===!1)return;const v=D=>{l?(this.stopAnimation(),this.snapToCursor(I0(D).point)):this.pauseAnimation()},T=(D,$)=>{this.stopAnimation();const{drag:re,dragPropagation:H,onDragStart:se}=this.getProps();if(re&&!H&&(this.openDragLock&&this.openDragLock(),this.openDragLock=Lfe(re),!this.openDragLock))return;this.latestPointerEvent=D,this.latestPanInfo=$,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),ha(ee=>{let Y=this.getAxisMotionValue(ee).get()||0;if(Do.test(Y)){const{projection:j}=this.visualElement;if(j&&j.layout){const fe=j.layout.layoutBox[ee];fe&&(Y=js(fe)*(parseFloat(Y)/100))}}this.originPoint[ee]=Y}),se&&Jn.postRender(()=>se(D,$)),qw(this.visualElement,"transform");const{animationState:Ee}=this.visualElement;Ee&&Ee.setActive("whileDrag",!0)},M=(D,$)=>{this.latestPointerEvent=D,this.latestPanInfo=$;const{dragPropagation:re,dragDirectionLock:H,onDirectionLock:se,onDrag:Ee}=this.getProps();if(!re&&!this.openDragLock)return;const{offset:ee}=$;if(H&&this.currentDirection===null){this.currentDirection=U0e(ee),this.currentDirection!==null&&se&&se(this.currentDirection);return}this.updateAxis("x",$.point,ee),this.updateAxis("y",$.point,ee),this.visualElement.render(),Ee&&Ee(D,$)},_=(D,$)=>{this.latestPointerEvent=D,this.latestPanInfo=$,this.stop(D,$),this.latestPointerEvent=null,this.latestPanInfo=null},O=()=>ha(D=>{var $;return this.getAnimationState(D)==="paused"&&(($=this.getAxisMotionValue(D).animation)==null?void 0:$.play())}),{dragSnapToOrigin:V}=this.getProps();this.panSession=new iP(a,{onSessionStart:v,onStart:T,onMove:M,onSessionEnd:_,resumeAnimation:O},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:V,distanceThreshold:p,contextWindow:sP(this.visualElement),element:this.visualElement.current})}stop(a,l){const p=a||this.latestPointerEvent,x=l||this.latestPanInfo,v=this.isDragging;if(this.cancel(),!v||!x||!p)return;const{velocity:T}=x;this.startAnimation(T);const{onDragEnd:M}=this.getProps();M&&Jn.postRender(()=>M(p,x))}cancel(){this.isDragging=!1;const{projection:a,animationState:l}=this.visualElement;a&&(a.isAnimationBlocked=!1),this.endPanSession();const{dragPropagation:p}=this.getProps();!p&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),l&&l.setActive("whileDrag",!1)}endPanSession(){this.panSession&&this.panSession.end(),this.panSession=void 0}updateAxis(a,l,p){const{drag:x}=this.getProps();if(!p||!vm(a,x,this.currentDirection))return;const v=this.getAxisMotionValue(a);let T=this.originPoint[a]+p[a];this.constraints&&this.constraints[a]&&(T=V0e(T,this.constraints[a],this.elastic[a])),v.set(T)}resolveConstraints(){var v;const{dragConstraints:a,dragElastic:l}=this.getProps(),p=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(v=this.visualElement.projection)==null?void 0:v.layout,x=this.constraints;a&&Rp(a)?this.constraints||(this.constraints=this.resolveRefConstraints()):a&&p?this.constraints=B0e(p.layoutBox,a):this.constraints=!1,this.elastic=Z0e(l),x!==this.constraints&&p&&this.constraints&&!this.hasMutatedConstraints&&ha(T=>{this.constraints!==!1&&this.getAxisMotionValue(T)&&(this.constraints[T]=X0e(p.layoutBox[T],this.constraints[T]))})}resolveRefConstraints(){const{dragConstraints:a,onMeasureDragConstraints:l}=this.getProps();if(!a||!Rp(a))return!1;const p=a.current,{projection:x}=this.visualElement;if(!x||!x.layout)return!1;const v=jfe(p,x.root,this.visualElement.getTransformPagePoint());let T=W0e(x.layout.layoutBox,v);if(l){const M=l($fe(T));this.hasMutatedConstraints=!!M,M&&(T=E5(M))}return T}startAnimation(a){const{drag:l,dragMomentum:p,dragElastic:x,dragTransition:v,dragSnapToOrigin:T,onDragTransitionEnd:M}=this.getProps(),_=this.constraints||{},O=ha(V=>{if(!vm(V,l,this.currentDirection))return;let D=_&&_[V]||{};T&&(D={min:0,max:0});const $=x?200:1e6,re=x?40:1e7,H={type:"inertia",velocity:p?a[V]:0,bounceStiffness:$,bounceDamping:re,timeConstant:750,restDelta:1,restSpeed:10,...v,...D};return this.startAxisValueAnimation(V,H)});return Promise.all(O).then(M)}startAxisValueAnimation(a,l){const p=this.getAxisMotionValue(a);return qw(this.visualElement,a),p.start(EI(a,p,0,l,this.visualElement,!1))}stopAnimation(){ha(a=>this.getAxisMotionValue(a).stop())}pauseAnimation(){ha(a=>{var l;return(l=this.getAxisMotionValue(a).animation)==null?void 0:l.pause()})}getAnimationState(a){var l;return(l=this.getAxisMotionValue(a).animation)==null?void 0:l.state}getAxisMotionValue(a){const l=`_drag${a.toUpperCase()}`,p=this.visualElement.getProps(),x=p[l];return x||this.visualElement.getValue(a,(p.initial?p.initial[a]:void 0)||0)}snapToCursor(a){ha(l=>{const{drag:p}=this.getProps();if(!vm(l,p,this.currentDirection))return;const{projection:x}=this.visualElement,v=this.getAxisMotionValue(l);if(x&&x.layout){const{min:T,max:M}=x.layout.layoutBox[l],_=v.get()||0;v.set(a[l]-ur(T,M,.5)+_)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:a,dragConstraints:l}=this.getProps(),{projection:p}=this.visualElement;if(!Rp(l)||!p||!this.constraints)return;this.stopAnimation();const x={x:0,y:0};ha(T=>{const M=this.getAxisMotionValue(T);if(M&&this.constraints!==!1){const _=M.get();x[T]=z0e({min:_,max:_},this.constraints[T])}});const{transformTemplate:v}=this.visualElement.getProps();this.visualElement.current.style.transform=v?v({},""):"none",p.root&&p.root.updateScroll(),p.updateLayout(),this.resolveConstraints(),ha(T=>{if(!vm(T,a,null))return;const M=this.getAxisMotionValue(T),{min:_,max:O}=this.constraints[T];M.set(ur(_,O,x[T]))})}addListeners(){if(!this.visualElement.current)return;K0e.set(this.visualElement,this);const a=this.visualElement.current,l=Xp(a,"pointerdown",_=>{const{drag:O,dragListener:V=!0}=this.getProps(),D=_.target,$=D!==a&&v5(D);O&&V&&!$&&this.start(_)}),p=()=>{const{dragConstraints:_}=this.getProps();Rp(_)&&_.current&&(this.constraints=this.resolveRefConstraints())},{projection:x}=this.visualElement,v=x.addEventListener("measure",p);x&&!x.layout&&(x.root&&x.root.updateScroll(),x.updateLayout()),Jn.read(p);const T=h0(window,"resize",()=>this.scalePositionWithinConstraints()),M=x.addEventListener("didUpdate",({delta:_,hasLayoutChanged:O})=>{this.isDragging&&O&&(ha(V=>{const D=this.getAxisMotionValue(V);D&&(this.originPoint[V]+=_[V].translate,D.set(D.get()+_[V].translate))}),this.visualElement.render())});return()=>{T(),l(),v(),M&&M()}}getProps(){const a=this.visualElement.getProps(),{drag:l=!1,dragDirectionLock:p=!1,dragPropagation:x=!1,dragConstraints:v=!1,dragElastic:T=ov,dragMomentum:M=!0}=a;return{...a,drag:l,dragDirectionLock:p,dragPropagation:x,dragConstraints:v,dragElastic:T,dragMomentum:M}}}function vm(r,a,l){return(a===!0||a===r)&&(l===null||l===r)}function U0e(r,a=10){let l=null;return Math.abs(r.y)>a?l="y":Math.abs(r.x)>a&&(l="x"),l}class H0e extends ju{constructor(a){super(a),this.removeGroupControls=xa,this.removeListeners=xa,this.controls=new $0e(a)}mount(){const{dragControls:a}=this.node.getProps();a&&(this.removeGroupControls=a.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||xa}update(){const{dragControls:a}=this.node.getProps(),{dragControls:l}=this.node.prevProps||{};a!==l&&(this.removeGroupControls(),a&&(this.removeGroupControls=a.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners(),this.controls.isDragging||this.controls.endPanSession()}}const P4=r=>(a,l)=>{r&&Jn.postRender(()=>r(a,l))};class j0e extends ju{constructor(){super(...arguments),this.removePointerDownListener=xa}onPointerDown(a){this.session=new iP(a,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:sP(this.node)})}createPanHandlers(){const{onPanSessionStart:a,onPanStart:l,onPan:p,onPanEnd:x}=this.node.getProps();return{onSessionStart:P4(a),onStart:P4(l),onMove:p,onEnd:(v,T)=>{delete this.session,x&&Jn.postRender(()=>x(v,T))}}}mount(){this.removePointerDownListener=Xp(this.node.current,"pointerdown",a=>this.onPointerDown(a))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}let B2=!1;class Y0e extends Ge.Component{componentDidMount(){const{visualElement:a,layoutGroup:l,switchLayoutGroup:p,layoutId:x}=this.props,{projection:v}=a;v&&(l.group&&l.group.add(v),p&&p.register&&x&&p.register(v),B2&&v.root.didUpdate(),v.addEventListener("animationComplete",()=>{this.safeToRemove()}),v.setOptions({...v.options,layoutDependency:this.props.layoutDependency,onExitComplete:()=>this.safeToRemove()})),Vm.hasEverUpdated=!0}getSnapshotBeforeUpdate(a){const{layoutDependency:l,visualElement:p,drag:x,isPresent:v}=this.props,{projection:T}=p;return T&&(T.isPresent=v,a.layoutDependency!==l&&T.setOptions({...T.options,layoutDependency:l}),B2=!0,x||a.layoutDependency!==l||l===void 0||a.isPresent!==v?T.willUpdate():this.safeToRemove(),a.isPresent!==v&&(v?T.promote():T.relegate()||Jn.postRender(()=>{const M=T.getStack();(!M||!M.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:a}=this.props.visualElement;a&&(a.root.didUpdate(),MI.postRender(()=>{!a.currentAnimation&&a.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:a,layoutGroup:l,switchLayoutGroup:p}=this.props,{projection:x}=a;B2=!0,x&&(x.scheduleCheckAfterUnmount(),l&&l.group&&l.group.remove(x),p&&p.deregister&&p.deregister(x))}safeToRemove(){const{safeToRemove:a}=this.props;a&&a()}render(){return null}}function oP(r){const[a,l]=j5(),p=Ge.useContext(lI);return xe.jsx(Y0e,{...r,layoutGroup:p,switchLayoutGroup:Ge.useContext(nP),isPresent:a,safeToRemove:l})}const Q0e={pan:{Feature:j0e},drag:{Feature:H0e,ProjectionNode:H5,MeasureLayout:oP}};function F4(r,a,l){const{props:p}=r;r.animationState&&p.whileHover&&r.animationState.setActive("whileHover",l==="Start");const x="onHover"+l,v=p[x];v&&Jn.postRender(()=>v(a,I0(a)))}class J0e extends ju{mount(){const{current:a}=this.node;a&&(this.unmount=Dfe(a,(l,p)=>(F4(this.node,p,"Start"),x=>F4(this.node,x,"End"))))}unmount(){}}class q0e extends ju{constructor(){super(...arguments),this.isActive=!1}onFocus(){let a=!1;try{a=this.node.current.matches(":focus-visible")}catch{a=!0}!a||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=b0(h0(this.node.current,"focus",()=>this.onFocus()),h0(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function G4(r,a,l){const{props:p}=r;if(r.current instanceof HTMLButtonElement&&r.current.disabled)return;r.animationState&&p.whileTap&&r.animationState.setActive("whileTap",l==="Start");const x="onTap"+(l==="End"?"":l),v=p[x];v&&Jn.postRender(()=>v(a,I0(a)))}class e1e extends ju{mount(){const{current:a}=this.node;a&&(this.unmount=Ffe(a,(l,p)=>(G4(this.node,p,"Start"),(x,{success:v})=>G4(this.node,x,v?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const lv=new WeakMap,W2=new WeakMap,t1e=r=>{const a=lv.get(r.target);a&&a(r)},n1e=r=>{r.forEach(t1e)};function r1e({root:r,...a}){const l=r||document;W2.has(l)||W2.set(l,{});const p=W2.get(l),x=JSON.stringify(a);return p[x]||(p[x]=new IntersectionObserver(n1e,{root:r,...a})),p[x]}function s1e(r,a,l){const p=r1e(a);return lv.set(r,l),p.observe(r),()=>{lv.delete(r),p.unobserve(r)}}const i1e={some:0,all:1};class a1e extends ju{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:a={}}=this.node.getProps(),{root:l,margin:p,amount:x="some",once:v}=a,T={root:l?l.current:void 0,rootMargin:p,threshold:typeof x=="number"?x:i1e[x]},M=_=>{const{isIntersecting:O}=_;if(this.isInView===O||(this.isInView=O,v&&!O&&this.hasEnteredView))return;O&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",O);const{onViewportEnter:V,onViewportLeave:D}=this.node.getProps(),$=O?V:D;$&&$(_)};return s1e(this.node.current,T,M)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:a,prevProps:l}=this.node;["amount","margin","root"].some(o1e(a,l))&&this.startObserver()}unmount(){}}function o1e({viewport:r={}},{viewport:a={}}={}){return l=>r[l]!==a[l]}const l1e={inView:{Feature:a1e},tap:{Feature:e1e},focus:{Feature:q0e},hover:{Feature:J0e}},u1e={layout:{ProjectionNode:H5,MeasureLayout:oP}},c1e={...O0e,...l1e,...Q0e,...u1e},z2=A0e(c1e,R0e);function h1e(){const[r,a]=Ge.useState("pin"),[l,p]=Ge.useState(""),[x,v]=Ge.useState(""),[T,M]=Ge.useState(null),[_,O]=Ge.useState(!1),[V,D]=Ge.useState({telegram:"",instagram:"",phone:""}),$=window.location.pathname==="/admin";Ge.useEffect(()=>{let H=localStorage.getItem("pinhan_device_id");H||(H=Bce(),localStorage.setItem("pinhan_device_id",H)),fetch("/api/settings").then(ee=>ee.json()).then(ee=>D(ee));const Ee=new URLSearchParams(window.location.search).get("id");Ee&&re(null,Ee)},[]);const re=async(H,se)=>{if(!(se||l))return;a("loading"),Sr.loading("Sovg'a qidirilmoqda...",{id:"auth"});const ee=localStorage.getItem("pinhan_device_id");try{const j=await(await fetch("/api/verify-pin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pinCode:l,deviceId:ee})})).json();j.success?(M(j.data),Sr.success("Sovg'a topildi!",{id:"auth"}),setTimeout(()=>a("ar"),1e3)):(Sr.error(j.error||"PIN xato",{id:"auth"}),a("pin"))}catch{Sr.error("Tarmoq xatosi",{id:"auth"}),a("pin")}};return $?xe.jsx(Que,{}):xe.jsxs("div",{className:"app-container",style:{width:"100vw",height:"100vh",background:"var(--bg-color)",color:"#fff",overflow:"hidden"},children:[xe.jsx(Nhe,{position:"top-center",reverseOrder:!1}),xe.jsxs(s0e,{mode:"wait",children:[r==="pin"&&xe.jsxs(z2.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},className:"center-col",style:Sp.centerCol,children:[xe.jsxs("div",{className:"logo-section",style:{marginBottom:"40px"},children:[xe.jsx("img",{src:"/logo.png",alt:"Logo",style:{width:"120px",height:"auto",borderRadius:"20px",marginBottom:"15px"}}),xe.jsx("h1",{style:{color:"var(--primary)",fontSize:"42px",fontWeight:"bold",margin:0},children:"PINHAN BOX"}),xe.jsx("p",{style:{color:"var(--text-dim)",fontSize:"14px",letterSpacing:"1px"},children:"PREMIUM AR EXPERIENCE"})]}),xe.jsxs("div",{className:"glass-card glass",style:{padding:"40px",width:"90%",maxWidth:"400px"},children:[xe.jsx("p",{style:{color:"var(--text-dim)",marginBottom:"20px"},children:"Sovg'ani ochish uchun PIN kodni kiriting"}),xe.jsx("input",{type:"text",value:l,onChange:H=>p(H.target.value.toUpperCase()),placeholder:"******",maxLength:10,style:Sp.input}),xe.jsx("button",{onClick:()=>re(),className:"btn-primary",style:{...Sp.button,width:"100%"},children:"OCHISH"}),xe.jsx("div",{style:{margin:"30px 0",borderTop:"1px solid var(--glass-border)",position:"relative"},children:xe.jsx("span",{style:{position:"absolute",top:"-10px",left:"50%",transform:"translateX(-50%)",background:"#111",padding:"0 10px",fontSize:"12px",color:"var(--text-dim)"},children:"YOKI"})}),xe.jsx("button",{onClick:()=>O(!0),className:"nav-btn",style:{width:"100%",borderColor:"var(--primary)",color:"var(--primary)"},children:"QR KODNI SKANERLASH"})]}),xe.jsxs("div",{style:{position:"fixed",bottom:"30px",display:"flex",gap:"20px"},children:[V.telegram&&xe.jsx("a",{href:`https://t.me/${V.telegram.replace("@","")}`,target:"_blank",className:"nav-btn",children:"Telegram"}),V.instagram&&xe.jsx("a",{href:`https://instagram.com/${V.instagram}`,target:"_blank",className:"nav-btn",children:"Instagram"})]})]},"pin"),r==="loading"&&xe.jsxs(z2.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:Sp.centerCol,children:[xe.jsx("div",{className:"loader",style:Sp.spinner}),xe.jsx("h2",{style:{marginTop:"20px",color:"var(--primary)",fontSize:"18px"},children:"Tayyorlanmoqda..."})]},"loading"),r==="ar"&&T&&xe.jsx(z2.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:1},style:{width:"100%",height:"100%"},children:xe.jsx(yue,{videoUrl:T.videoUrl,targetFile:T.targetFile})},"ar")]}),_&&xe.jsx(Pce,{onScanSuccess:H=>{re(null,H),O(!1)},onScanError:()=>{},onClose:()=>O(!1)})]})}const Sp={centerCol:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",width:"100%",padding:"20px",textAlign:"center"},input:{padding:"18px",borderRadius:"15px",border:"2px solid #333",background:"#000",color:"#FFD700",fontSize:"24px",fontWeight:"bold",textAlign:"center",letterSpacing:"4px",width:"100%",maxWidth:"280px",outline:"none"},button:{marginTop:"30px",padding:"18px 60px",borderRadius:"40px",border:"none",background:"linear-gradient(135deg, #FFD700 0%, #B8860B 100%)",color:"#000",fontWeight:"bold",fontSize:"16px",cursor:"pointer",boxShadow:"0 10px 20px rgba(0,0,0,0.5)"},spinner:{width:"50px",height:"50px",border:"4px solid rgba(255,215,0,0.1)",borderTop:"4px solid #FFD700",borderRadius:"50%",animation:"spin 1s linear infinite"}};class d1e extends H4.Component{constructor(a){super(a),this.state={hasError:!1}}static getDerivedStateFromError(a){return{hasError:!0}}componentDidCatch(a,l){console.error("ErrorBoundary caught an error",a,l)}render(){return this.state.hasError?xe.jsxs("div",{style:{padding:"40px",textAlign:"center",background:"#000",color:"#fff",height:"100vh",display:"flex",flexDirection:"column",justifyContent:"center"},children:[xe.jsx("h2",{style:{color:"#ff4444"},children:"Kechirasiz, muammo yuz berdi."}),xe.jsx("p",{style:{color:"#aaa",margin:"20px 0"},children:"Sahifani qayta yuklab ko'ring yoki birozdan so'ng harakat qiling."}),xe.jsx("button",{onClick:()=>window.location.reload(),style:{background:"#FFD700",border:"none",padding:"12px 24px",borderRadius:"12px",fontWeight:"bold",cursor:"pointer"},children:"QAYTA YUKLASH"})]}):this.props.children}}X2.createRoot(document.getElementById("root")).render(xe.jsx(H4.StrictMode,{children:xe.jsx(d1e,{children:xe.jsx(h1e,{})})}));
