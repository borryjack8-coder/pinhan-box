(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))f(b);new MutationObserver(b=>{for(const x of b)if(x.type==="childList")for(const k of x.addedNodes)k.tagName==="LINK"&&k.rel==="modulepreload"&&f(k)}).observe(document,{childList:!0,subtree:!0});function d(b){const x={};return b.integrity&&(x.integrity=b.integrity),b.referrerPolicy&&(x.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?x.credentials="include":b.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function f(b){if(b.ep)return;b.ep=!0;const x=d(b);fetch(b.href,x)}})();var Gl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function jne(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function Yne(a){if(a.__esModule)return a;var o=a.default;if(typeof o=="function"){var d=function f(){return this instanceof f?Reflect.construct(o,arguments,this.constructor):o.apply(this,arguments)};d.prototype=o.prototype}else d={};return Object.defineProperty(d,"__esModule",{value:!0}),Object.keys(a).forEach(function(f){var b=Object.getOwnPropertyDescriptor(a,f);Object.defineProperty(d,f,b.get?b:{enumerable:!0,get:function(){return a[f]}})}),d}var VE={exports:{}},Um={},PE={exports:{}},rt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _d=Symbol.for("react.element"),Qne=Symbol.for("react.portal"),Jne=Symbol.for("react.fragment"),qne=Symbol.for("react.strict_mode"),ere=Symbol.for("react.profiler"),tre=Symbol.for("react.provider"),nre=Symbol.for("react.context"),rre=Symbol.for("react.forward_ref"),sre=Symbol.for("react.suspense"),are=Symbol.for("react.memo"),ire=Symbol.for("react.lazy"),e3=Symbol.iterator;function ore(a){return a===null||typeof a!="object"?null:(a=e3&&a[e3]||a["@@iterator"],typeof a=="function"?a:null)}var XE={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},OE=Object.assign,DE={};function su(a,o,d){this.props=a,this.context=o,this.refs=DE,this.updater=d||XE}su.prototype.isReactComponent={};su.prototype.setState=function(a,o){if(typeof a!="object"&&typeof a!="function"&&a!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,a,o,"setState")};su.prototype.forceUpdate=function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")};function AE(){}AE.prototype=su.prototype;function av(a,o,d){this.props=a,this.context=o,this.refs=DE,this.updater=d||XE}var iv=av.prototype=new AE;iv.constructor=av;OE(iv,su.prototype);iv.isPureReactComponent=!0;var t3=Array.isArray,KE=Object.prototype.hasOwnProperty,ov={current:null},ZE={key:!0,ref:!0,__self:!0,__source:!0};function BE(a,o,d){var f,b={},x=null,k=null;if(o!=null)for(f in o.ref!==void 0&&(k=o.ref),o.key!==void 0&&(x=""+o.key),o)KE.call(o,f)&&!ZE.hasOwnProperty(f)&&(b[f]=o[f]);var N=arguments.length-2;if(N===1)b.children=d;else if(1<N){for(var E=Array(N),z=0;z<N;z++)E[z]=arguments[z+2];b.children=E}if(a&&a.defaultProps)for(f in N=a.defaultProps,N)b[f]===void 0&&(b[f]=N[f]);return{$$typeof:_d,type:a,key:x,ref:k,props:b,_owner:ov.current}}function lre(a,o){return{$$typeof:_d,type:a.type,key:o,ref:a.ref,props:a.props,_owner:a._owner}}function lv(a){return typeof a=="object"&&a!==null&&a.$$typeof===_d}function ure(a){var o={"=":"=0",":":"=2"};return"$"+a.replace(/[=:]/g,function(d){return o[d]})}var n3=/\/+/g;function Cx(a,o){return typeof a=="object"&&a!==null&&a.key!=null?ure(""+a.key):o.toString(36)}function nm(a,o,d,f,b){var x=typeof a;(x==="undefined"||x==="boolean")&&(a=null);var k=!1;if(a===null)k=!0;else switch(x){case"string":case"number":k=!0;break;case"object":switch(a.$$typeof){case _d:case Qne:k=!0}}if(k)return k=a,b=b(k),a=f===""?"."+Cx(k,0):f,t3(b)?(d="",a!=null&&(d=a.replace(n3,"$&/")+"/"),nm(b,o,d,"",function(z){return z})):b!=null&&(lv(b)&&(b=lre(b,d+(!b.key||k&&k.key===b.key?"":(""+b.key).replace(n3,"$&/")+"/")+a)),o.push(b)),1;if(k=0,f=f===""?".":f+":",t3(a))for(var N=0;N<a.length;N++){x=a[N];var E=f+Cx(x,N);k+=nm(x,o,d,E,b)}else if(E=ore(a),typeof E=="function")for(a=E.call(a),N=0;!(x=a.next()).done;)x=x.value,E=f+Cx(x,N++),k+=nm(x,o,d,E,b);else if(x==="object")throw o=String(a),Error("Objects are not valid as a React child (found: "+(o==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":o)+"). If you meant to render a collection of children, use an array instead.");return k}function Wf(a,o,d){if(a==null)return a;var f=[],b=0;return nm(a,f,"","",function(x){return o.call(d,x,b++)}),f}function cre(a){if(a._status===-1){var o=a._result;o=o(),o.then(function(d){(a._status===0||a._status===-1)&&(a._status=1,a._result=d)},function(d){(a._status===0||a._status===-1)&&(a._status=2,a._result=d)}),a._status===-1&&(a._status=0,a._result=o)}if(a._status===1)return a._result.default;throw a._result}var ir={current:null},rm={transition:null},dre={ReactCurrentDispatcher:ir,ReactCurrentBatchConfig:rm,ReactCurrentOwner:ov};function _E(){throw Error("act(...) is not supported in production builds of React.")}rt.Children={map:Wf,forEach:function(a,o,d){Wf(a,function(){o.apply(this,arguments)},d)},count:function(a){var o=0;return Wf(a,function(){o++}),o},toArray:function(a){return Wf(a,function(o){return o})||[]},only:function(a){if(!lv(a))throw Error("React.Children.only expected to receive a single React element child.");return a}};rt.Component=su;rt.Fragment=Jne;rt.Profiler=ere;rt.PureComponent=av;rt.StrictMode=qne;rt.Suspense=sre;rt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=dre;rt.act=_E;rt.cloneElement=function(a,o,d){if(a==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+a+".");var f=OE({},a.props),b=a.key,x=a.ref,k=a._owner;if(o!=null){if(o.ref!==void 0&&(x=o.ref,k=ov.current),o.key!==void 0&&(b=""+o.key),a.type&&a.type.defaultProps)var N=a.type.defaultProps;for(E in o)KE.call(o,E)&&!ZE.hasOwnProperty(E)&&(f[E]=o[E]===void 0&&N!==void 0?N[E]:o[E])}var E=arguments.length-2;if(E===1)f.children=d;else if(1<E){N=Array(E);for(var z=0;z<E;z++)N[z]=arguments[z+2];f.children=N}return{$$typeof:_d,type:a.type,key:b,ref:x,props:f,_owner:k}};rt.createContext=function(a){return a={$$typeof:nre,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},a.Provider={$$typeof:tre,_context:a},a.Consumer=a};rt.createElement=BE;rt.createFactory=function(a){var o=BE.bind(null,a);return o.type=a,o};rt.createRef=function(){return{current:null}};rt.forwardRef=function(a){return{$$typeof:rre,render:a}};rt.isValidElement=lv;rt.lazy=function(a){return{$$typeof:ire,_payload:{_status:-1,_result:a},_init:cre}};rt.memo=function(a,o){return{$$typeof:are,type:a,compare:o===void 0?null:o}};rt.startTransition=function(a){var o=rm.transition;rm.transition={};try{a()}finally{rm.transition=o}};rt.unstable_act=_E;rt.useCallback=function(a,o){return ir.current.useCallback(a,o)};rt.useContext=function(a){return ir.current.useContext(a)};rt.useDebugValue=function(){};rt.useDeferredValue=function(a){return ir.current.useDeferredValue(a)};rt.useEffect=function(a,o){return ir.current.useEffect(a,o)};rt.useId=function(){return ir.current.useId()};rt.useImperativeHandle=function(a,o,d){return ir.current.useImperativeHandle(a,o,d)};rt.useInsertionEffect=function(a,o){return ir.current.useInsertionEffect(a,o)};rt.useLayoutEffect=function(a,o){return ir.current.useLayoutEffect(a,o)};rt.useMemo=function(a,o){return ir.current.useMemo(a,o)};rt.useReducer=function(a,o,d){return ir.current.useReducer(a,o,d)};rt.useRef=function(a){return ir.current.useRef(a)};rt.useState=function(a){return ir.current.useState(a)};rt.useSyncExternalStore=function(a,o,d){return ir.current.useSyncExternalStore(a,o,d)};rt.useTransition=function(){return ir.current.useTransition()};rt.version="18.3.1";PE.exports=rt;var Q=PE.exports;const HE=jne(Q);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hre=Q,pre=Symbol.for("react.element"),fre=Symbol.for("react.fragment"),mre=Object.prototype.hasOwnProperty,gre=hre.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,bre={key:!0,ref:!0,__self:!0,__source:!0};function UE(a,o,d){var f,b={},x=null,k=null;d!==void 0&&(x=""+d),o.key!==void 0&&(x=""+o.key),o.ref!==void 0&&(k=o.ref);for(f in o)mre.call(o,f)&&!bre.hasOwnProperty(f)&&(b[f]=o[f]);if(a&&a.defaultProps)for(f in o=a.defaultProps,o)b[f]===void 0&&(b[f]=o[f]);return{$$typeof:pre,type:a,key:x,ref:k,props:b,_owner:gre.current}}Um.Fragment=fre;Um.jsx=UE;Um.jsxs=UE;VE.exports=Um;var te=VE.exports,s1={},jE={exports:{}},Pr={},YE={exports:{}},QE={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(a){function o(Ge,_e){var we=Ge.length;Ge.push(_e);e:for(;0<we;){var lt=we-1>>>1,nt=Ge[lt];if(0<b(nt,_e))Ge[lt]=_e,Ge[we]=nt,we=lt;else break e}}function d(Ge){return Ge.length===0?null:Ge[0]}function f(Ge){if(Ge.length===0)return null;var _e=Ge[0],we=Ge.pop();if(we!==_e){Ge[0]=we;e:for(var lt=0,nt=Ge.length,Ms=nt>>>1;lt<Ms;){var $n=2*(lt+1)-1,Pt=Ge[$n],$s=$n+1,lr=Ge[$s];if(0>b(Pt,we))$s<nt&&0>b(lr,Pt)?(Ge[lt]=lr,Ge[$s]=we,lt=$s):(Ge[lt]=Pt,Ge[$n]=we,lt=$n);else if($s<nt&&0>b(lr,we))Ge[lt]=lr,Ge[$s]=we,lt=$s;else break e}}return _e}function b(Ge,_e){var we=Ge.sortIndex-_e.sortIndex;return we!==0?we:Ge.id-_e.id}if(typeof performance=="object"&&typeof performance.now=="function"){var x=performance;a.unstable_now=function(){return x.now()}}else{var k=Date,N=k.now();a.unstable_now=function(){return k.now()-N}}var E=[],z=[],W=1,T=null,A=3,Y=!1,M=!1,B=!1,H=typeof setTimeout=="function"?setTimeout:null,O=typeof clearTimeout=="function"?clearTimeout:null,P=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function X(Ge){for(var _e=d(z);_e!==null;){if(_e.callback===null)f(z);else if(_e.startTime<=Ge)f(z),_e.sortIndex=_e.expirationTime,o(E,_e);else break;_e=d(z)}}function ie(Ge){if(B=!1,X(Ge),!M)if(d(E)!==null)M=!0,Ut(oe);else{var _e=d(z);_e!==null&&Ir(ie,_e.startTime-Ge)}}function oe(Ge,_e){M=!1,B&&(B=!1,O(be),be=-1),Y=!0;var we=A;try{for(X(_e),T=d(E);T!==null&&(!(T.expirationTime>_e)||Ge&&!Gt());){var lt=T.callback;if(typeof lt=="function"){T.callback=null,A=T.priorityLevel;var nt=lt(T.expirationTime<=_e);_e=a.unstable_now(),typeof nt=="function"?T.callback=nt:T===d(E)&&f(E),X(_e)}else f(E);T=d(E)}if(T!==null)var Ms=!0;else{var $n=d(z);$n!==null&&Ir(ie,$n.startTime-_e),Ms=!1}return Ms}finally{T=null,A=we,Y=!1}}var fe=!1,ge=null,be=-1,Ve=5,Oe=-1;function Gt(){return!(a.unstable_now()-Oe<Ve)}function Ht(){if(ge!==null){var Ge=a.unstable_now();Oe=Ge;var _e=!0;try{_e=ge(!0,Ge)}finally{_e?zt():(fe=!1,ge=null)}}else fe=!1}var zt;if(typeof P=="function")zt=function(){P(Ht)};else if(typeof MessageChannel<"u"){var Vt=new MessageChannel,Do=Vt.port2;Vt.port1.onmessage=Ht,zt=function(){Do.postMessage(null)}}else zt=function(){H(Ht,0)};function Ut(Ge){ge=Ge,fe||(fe=!0,zt())}function Ir(Ge,_e){be=H(function(){Ge(a.unstable_now())},_e)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(Ge){Ge.callback=null},a.unstable_continueExecution=function(){M||Y||(M=!0,Ut(oe))},a.unstable_forceFrameRate=function(Ge){0>Ge||125<Ge?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ve=0<Ge?Math.floor(1e3/Ge):5},a.unstable_getCurrentPriorityLevel=function(){return A},a.unstable_getFirstCallbackNode=function(){return d(E)},a.unstable_next=function(Ge){switch(A){case 1:case 2:case 3:var _e=3;break;default:_e=A}var we=A;A=_e;try{return Ge()}finally{A=we}},a.unstable_pauseExecution=function(){},a.unstable_requestPaint=function(){},a.unstable_runWithPriority=function(Ge,_e){switch(Ge){case 1:case 2:case 3:case 4:case 5:break;default:Ge=3}var we=A;A=Ge;try{return _e()}finally{A=we}},a.unstable_scheduleCallback=function(Ge,_e,we){var lt=a.unstable_now();switch(typeof we=="object"&&we!==null?(we=we.delay,we=typeof we=="number"&&0<we?lt+we:lt):we=lt,Ge){case 1:var nt=-1;break;case 2:nt=250;break;case 5:nt=1073741823;break;case 4:nt=1e4;break;default:nt=5e3}return nt=we+nt,Ge={id:W++,callback:_e,priorityLevel:Ge,startTime:we,expirationTime:nt,sortIndex:-1},we>lt?(Ge.sortIndex=we,o(z,Ge),d(E)===null&&Ge===d(z)&&(B?(O(be),be=-1):B=!0,Ir(ie,we-lt))):(Ge.sortIndex=nt,o(E,Ge),M||Y||(M=!0,Ut(oe))),Ge},a.unstable_shouldYield=Gt,a.unstable_wrapCallback=function(Ge){var _e=A;return function(){var we=A;A=_e;try{return Ge.apply(this,arguments)}finally{A=we}}}})(QE);YE.exports=QE;var yre=YE.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xre=Q,Vr=yre;function Se(a){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+a,d=1;d<arguments.length;d++)o+="&args[]="+encodeURIComponent(arguments[d]);return"Minified React error #"+a+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var JE=new Set,Rd={};function Xo(a,o){Yl(a,o),Yl(a+"Capture",o)}function Yl(a,o){for(Rd[a]=o,a=0;a<o.length;a++)JE.add(o[a])}var za=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),a1=Object.prototype.hasOwnProperty,vre=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,r3={},s3={};function wre(a){return a1.call(s3,a)?!0:a1.call(r3,a)?!1:vre.test(a)?s3[a]=!0:(r3[a]=!0,!1)}function kre(a,o,d,f){if(d!==null&&d.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return f?!1:d!==null?!d.acceptsBooleans:(a=a.toLowerCase().slice(0,5),a!=="data-"&&a!=="aria-");default:return!1}}function Ire(a,o,d,f){if(o===null||typeof o>"u"||kre(a,o,d,f))return!0;if(f)return!1;if(d!==null)switch(d.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function or(a,o,d,f,b,x,k){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=f,this.attributeNamespace=b,this.mustUseProperty=d,this.propertyName=a,this.type=o,this.sanitizeURL=x,this.removeEmptyString=k}var Mn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){Mn[a]=new or(a,0,!1,a,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var o=a[0];Mn[o]=new or(o,1,!1,a[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(a){Mn[a]=new or(a,2,!1,a.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){Mn[a]=new or(a,2,!1,a,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){Mn[a]=new or(a,3,!1,a.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(a){Mn[a]=new or(a,3,!0,a,null,!1,!1)});["capture","download"].forEach(function(a){Mn[a]=new or(a,4,!1,a,null,!1,!1)});["cols","rows","size","span"].forEach(function(a){Mn[a]=new or(a,6,!1,a,null,!1,!1)});["rowSpan","start"].forEach(function(a){Mn[a]=new or(a,5,!1,a.toLowerCase(),null,!1,!1)});var uv=/[\-:]([a-z])/g;function cv(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var o=a.replace(uv,cv);Mn[o]=new or(o,1,!1,a,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var o=a.replace(uv,cv);Mn[o]=new or(o,1,!1,a,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(a){var o=a.replace(uv,cv);Mn[o]=new or(o,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(a){Mn[a]=new or(a,1,!1,a.toLowerCase(),null,!1,!1)});Mn.xlinkHref=new or("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(a){Mn[a]=new or(a,1,!1,a.toLowerCase(),null,!0,!0)});function dv(a,o,d,f){var b=Mn.hasOwnProperty(o)?Mn[o]:null;(b!==null?b.type!==0:f||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(Ire(o,d,b,f)&&(d=null),f||b===null?wre(o)&&(d===null?a.removeAttribute(o):a.setAttribute(o,""+d)):b.mustUseProperty?a[b.propertyName]=d===null?b.type===3?!1:"":d:(o=b.attributeName,f=b.attributeNamespace,d===null?a.removeAttribute(o):(b=b.type,d=b===3||b===4&&d===!0?"":""+d,f?a.setAttributeNS(f,o,d):a.setAttribute(o,d))))}var Pa=xre.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Mf=Symbol.for("react.element"),zl=Symbol.for("react.portal"),Wl=Symbol.for("react.fragment"),hv=Symbol.for("react.strict_mode"),i1=Symbol.for("react.profiler"),qE=Symbol.for("react.provider"),eL=Symbol.for("react.context"),pv=Symbol.for("react.forward_ref"),o1=Symbol.for("react.suspense"),l1=Symbol.for("react.suspense_list"),fv=Symbol.for("react.memo"),pi=Symbol.for("react.lazy"),tL=Symbol.for("react.offscreen"),a3=Symbol.iterator;function ad(a){return a===null||typeof a!="object"?null:(a=a3&&a[a3]||a["@@iterator"],typeof a=="function"?a:null)}var _t=Object.assign,Tx;function md(a){if(Tx===void 0)try{throw Error()}catch(d){var o=d.stack.trim().match(/\n( *(at )?)/);Tx=o&&o[1]||""}return`
`+Tx+a}var Nx=!1;function Rx(a,o){if(!a||Nx)return"";Nx=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(z){var f=z}Reflect.construct(a,[],o)}else{try{o.call()}catch(z){f=z}a.call(o.prototype)}else{try{throw Error()}catch(z){f=z}a()}}catch(z){if(z&&f&&typeof z.stack=="string"){for(var b=z.stack.split(`
`),x=f.stack.split(`
`),k=b.length-1,N=x.length-1;1<=k&&0<=N&&b[k]!==x[N];)N--;for(;1<=k&&0<=N;k--,N--)if(b[k]!==x[N]){if(k!==1||N!==1)do if(k--,N--,0>N||b[k]!==x[N]){var E=`
`+b[k].replace(" at new "," at ");return a.displayName&&E.includes("<anonymous>")&&(E=E.replace("<anonymous>",a.displayName)),E}while(1<=k&&0<=N);break}}}finally{Nx=!1,Error.prepareStackTrace=d}return(a=a?a.displayName||a.name:"")?md(a):""}function Sre(a){switch(a.tag){case 5:return md(a.type);case 16:return md("Lazy");case 13:return md("Suspense");case 19:return md("SuspenseList");case 0:case 2:case 15:return a=Rx(a.type,!1),a;case 11:return a=Rx(a.type.render,!1),a;case 1:return a=Rx(a.type,!0),a;default:return""}}function u1(a){if(a==null)return null;if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case Wl:return"Fragment";case zl:return"Portal";case i1:return"Profiler";case hv:return"StrictMode";case o1:return"Suspense";case l1:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case eL:return(a.displayName||"Context")+".Consumer";case qE:return(a._context.displayName||"Context")+".Provider";case pv:var o=a.render;return a=a.displayName,a||(a=o.displayName||o.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case fv:return o=a.displayName||null,o!==null?o:u1(a.type)||"Memo";case pi:o=a._payload,a=a._init;try{return u1(a(o))}catch{}}return null}function Cre(a){var o=a.type;switch(a.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return a=o.render,a=a.displayName||a.name||"",o.displayName||(a!==""?"ForwardRef("+a+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return u1(o);case 8:return o===hv?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function Ri(a){switch(typeof a){case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function nL(a){var o=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function Tre(a){var o=nL(a)?"checked":"value",d=Object.getOwnPropertyDescriptor(a.constructor.prototype,o),f=""+a[o];if(!a.hasOwnProperty(o)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var b=d.get,x=d.set;return Object.defineProperty(a,o,{configurable:!0,get:function(){return b.call(this)},set:function(k){f=""+k,x.call(this,k)}}),Object.defineProperty(a,o,{enumerable:d.enumerable}),{getValue:function(){return f},setValue:function(k){f=""+k},stopTracking:function(){a._valueTracker=null,delete a[o]}}}}function $f(a){a._valueTracker||(a._valueTracker=Tre(a))}function rL(a){if(!a)return!1;var o=a._valueTracker;if(!o)return!0;var d=o.getValue(),f="";return a&&(f=nL(a)?a.checked?"true":"false":a.value),a=f,a!==d?(o.setValue(a),!0):!1}function wm(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}function c1(a,o){var d=o.checked;return _t({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:d??a._wrapperState.initialChecked})}function i3(a,o){var d=o.defaultValue==null?"":o.defaultValue,f=o.checked!=null?o.checked:o.defaultChecked;d=Ri(o.value!=null?o.value:d),a._wrapperState={initialChecked:f,initialValue:d,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function sL(a,o){o=o.checked,o!=null&&dv(a,"checked",o,!1)}function d1(a,o){sL(a,o);var d=Ri(o.value),f=o.type;if(d!=null)f==="number"?(d===0&&a.value===""||a.value!=d)&&(a.value=""+d):a.value!==""+d&&(a.value=""+d);else if(f==="submit"||f==="reset"){a.removeAttribute("value");return}o.hasOwnProperty("value")?h1(a,o.type,d):o.hasOwnProperty("defaultValue")&&h1(a,o.type,Ri(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(a.defaultChecked=!!o.defaultChecked)}function o3(a,o,d){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var f=o.type;if(!(f!=="submit"&&f!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+a._wrapperState.initialValue,d||o===a.value||(a.value=o),a.defaultValue=o}d=a.name,d!==""&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,d!==""&&(a.name=d)}function h1(a,o,d){(o!=="number"||wm(a.ownerDocument)!==a)&&(d==null?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+d&&(a.defaultValue=""+d))}var gd=Array.isArray;function Zl(a,o,d,f){if(a=a.options,o){o={};for(var b=0;b<d.length;b++)o["$"+d[b]]=!0;for(d=0;d<a.length;d++)b=o.hasOwnProperty("$"+a[d].value),a[d].selected!==b&&(a[d].selected=b),b&&f&&(a[d].defaultSelected=!0)}else{for(d=""+Ri(d),o=null,b=0;b<a.length;b++){if(a[b].value===d){a[b].selected=!0,f&&(a[b].defaultSelected=!0);return}o!==null||a[b].disabled||(o=a[b])}o!==null&&(o.selected=!0)}}function p1(a,o){if(o.dangerouslySetInnerHTML!=null)throw Error(Se(91));return _t({},o,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function l3(a,o){var d=o.value;if(d==null){if(d=o.children,o=o.defaultValue,d!=null){if(o!=null)throw Error(Se(92));if(gd(d)){if(1<d.length)throw Error(Se(93));d=d[0]}o=d}o==null&&(o=""),d=o}a._wrapperState={initialValue:Ri(d)}}function aL(a,o){var d=Ri(o.value),f=Ri(o.defaultValue);d!=null&&(d=""+d,d!==a.value&&(a.value=d),o.defaultValue==null&&a.defaultValue!==d&&(a.defaultValue=d)),f!=null&&(a.defaultValue=""+f)}function u3(a){var o=a.textContent;o===a._wrapperState.initialValue&&o!==""&&o!==null&&(a.value=o)}function iL(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function f1(a,o){return a==null||a==="http://www.w3.org/1999/xhtml"?iL(o):a==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":a}var Ff,oL=function(a){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,d,f,b){MSApp.execUnsafeLocalFunction(function(){return a(o,d,f,b)})}:a}(function(a,o){if(a.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in a)a.innerHTML=o;else{for(Ff=Ff||document.createElement("div"),Ff.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=Ff.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;o.firstChild;)a.appendChild(o.firstChild)}});function Ed(a,o){if(o){var d=a.firstChild;if(d&&d===a.lastChild&&d.nodeType===3){d.nodeValue=o;return}}a.textContent=o}var xd={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Nre=["Webkit","ms","Moz","O"];Object.keys(xd).forEach(function(a){Nre.forEach(function(o){o=o+a.charAt(0).toUpperCase()+a.substring(1),xd[o]=xd[a]})});function lL(a,o,d){return o==null||typeof o=="boolean"||o===""?"":d||typeof o!="number"||o===0||xd.hasOwnProperty(a)&&xd[a]?(""+o).trim():o+"px"}function uL(a,o){a=a.style;for(var d in o)if(o.hasOwnProperty(d)){var f=d.indexOf("--")===0,b=lL(d,o[d],f);d==="float"&&(d="cssFloat"),f?a.setProperty(d,b):a[d]=b}}var Rre=_t({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function m1(a,o){if(o){if(Rre[a]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(Se(137,a));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(Se(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(Se(61))}if(o.style!=null&&typeof o.style!="object")throw Error(Se(62))}}function g1(a,o){if(a.indexOf("-")===-1)return typeof o.is=="string";switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var b1=null;function mv(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var y1=null,Bl=null,_l=null;function c3(a){if(a=jd(a)){if(typeof y1!="function")throw Error(Se(280));var o=a.stateNode;o&&(o=qm(o),y1(a.stateNode,a.type,o))}}function cL(a){Bl?_l?_l.push(a):_l=[a]:Bl=a}function dL(){if(Bl){var a=Bl,o=_l;if(_l=Bl=null,c3(a),o)for(a=0;a<o.length;a++)c3(o[a])}}function hL(a,o){return a(o)}function pL(){}var Ex=!1;function fL(a,o,d){if(Ex)return a(o,d);Ex=!0;try{return hL(a,o,d)}finally{Ex=!1,(Bl!==null||_l!==null)&&(pL(),dL())}}function Ld(a,o){var d=a.stateNode;if(d===null)return null;var f=qm(d);if(f===null)return null;d=f[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(a=a.type,f=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!f;break e;default:a=!1}if(a)return null;if(d&&typeof d!="function")throw Error(Se(231,o,typeof d));return d}var x1=!1;if(za)try{var id={};Object.defineProperty(id,"passive",{get:function(){x1=!0}}),window.addEventListener("test",id,id),window.removeEventListener("test",id,id)}catch{x1=!1}function Ere(a,o,d,f,b,x,k,N,E){var z=Array.prototype.slice.call(arguments,3);try{o.apply(d,z)}catch(W){this.onError(W)}}var vd=!1,km=null,Im=!1,v1=null,Lre={onError:function(a){vd=!0,km=a}};function Gre(a,o,d,f,b,x,k,N,E){vd=!1,km=null,Ere.apply(Lre,arguments)}function zre(a,o,d,f,b,x,k,N,E){if(Gre.apply(this,arguments),vd){if(vd){var z=km;vd=!1,km=null}else throw Error(Se(198));Im||(Im=!0,v1=z)}}function Oo(a){var o=a,d=a;if(a.alternate)for(;o.return;)o=o.return;else{a=o;do o=a,o.flags&4098&&(d=o.return),a=o.return;while(a)}return o.tag===3?d:null}function mL(a){if(a.tag===13){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function d3(a){if(Oo(a)!==a)throw Error(Se(188))}function Wre(a){var o=a.alternate;if(!o){if(o=Oo(a),o===null)throw Error(Se(188));return o!==a?null:a}for(var d=a,f=o;;){var b=d.return;if(b===null)break;var x=b.alternate;if(x===null){if(f=b.return,f!==null){d=f;continue}break}if(b.child===x.child){for(x=b.child;x;){if(x===d)return d3(b),a;if(x===f)return d3(b),o;x=x.sibling}throw Error(Se(188))}if(d.return!==f.return)d=b,f=x;else{for(var k=!1,N=b.child;N;){if(N===d){k=!0,d=b,f=x;break}if(N===f){k=!0,f=b,d=x;break}N=N.sibling}if(!k){for(N=x.child;N;){if(N===d){k=!0,d=x,f=b;break}if(N===f){k=!0,f=x,d=b;break}N=N.sibling}if(!k)throw Error(Se(189))}}if(d.alternate!==f)throw Error(Se(190))}if(d.tag!==3)throw Error(Se(188));return d.stateNode.current===d?a:o}function gL(a){return a=Wre(a),a!==null?bL(a):null}function bL(a){if(a.tag===5||a.tag===6)return a;for(a=a.child;a!==null;){var o=bL(a);if(o!==null)return o;a=a.sibling}return null}var yL=Vr.unstable_scheduleCallback,h3=Vr.unstable_cancelCallback,Mre=Vr.unstable_shouldYield,$re=Vr.unstable_requestPaint,sn=Vr.unstable_now,Fre=Vr.unstable_getCurrentPriorityLevel,gv=Vr.unstable_ImmediatePriority,xL=Vr.unstable_UserBlockingPriority,Sm=Vr.unstable_NormalPriority,Vre=Vr.unstable_LowPriority,vL=Vr.unstable_IdlePriority,jm=null,la=null;function Pre(a){if(la&&typeof la.onCommitFiberRoot=="function")try{la.onCommitFiberRoot(jm,a,void 0,(a.current.flags&128)===128)}catch{}}var Es=Math.clz32?Math.clz32:Dre,Xre=Math.log,Ore=Math.LN2;function Dre(a){return a>>>=0,a===0?32:31-(Xre(a)/Ore|0)|0}var Vf=64,Pf=4194304;function bd(a){switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return a&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return a}}function Cm(a,o){var d=a.pendingLanes;if(d===0)return 0;var f=0,b=a.suspendedLanes,x=a.pingedLanes,k=d&268435455;if(k!==0){var N=k&~b;N!==0?f=bd(N):(x&=k,x!==0&&(f=bd(x)))}else k=d&~b,k!==0?f=bd(k):x!==0&&(f=bd(x));if(f===0)return 0;if(o!==0&&o!==f&&!(o&b)&&(b=f&-f,x=o&-o,b>=x||b===16&&(x&4194240)!==0))return o;if(f&4&&(f|=d&16),o=a.entangledLanes,o!==0)for(a=a.entanglements,o&=f;0<o;)d=31-Es(o),b=1<<d,f|=a[d],o&=~b;return f}function Are(a,o){switch(a){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Kre(a,o){for(var d=a.suspendedLanes,f=a.pingedLanes,b=a.expirationTimes,x=a.pendingLanes;0<x;){var k=31-Es(x),N=1<<k,E=b[k];E===-1?(!(N&d)||N&f)&&(b[k]=Are(N,o)):E<=o&&(a.expiredLanes|=N),x&=~N}}function w1(a){return a=a.pendingLanes&-1073741825,a!==0?a:a&1073741824?1073741824:0}function wL(){var a=Vf;return Vf<<=1,!(Vf&4194240)&&(Vf=64),a}function Lx(a){for(var o=[],d=0;31>d;d++)o.push(a);return o}function Hd(a,o,d){a.pendingLanes|=o,o!==536870912&&(a.suspendedLanes=0,a.pingedLanes=0),a=a.eventTimes,o=31-Es(o),a[o]=d}function Zre(a,o){var d=a.pendingLanes&~o;a.pendingLanes=o,a.suspendedLanes=0,a.pingedLanes=0,a.expiredLanes&=o,a.mutableReadLanes&=o,a.entangledLanes&=o,o=a.entanglements;var f=a.eventTimes;for(a=a.expirationTimes;0<d;){var b=31-Es(d),x=1<<b;o[b]=0,f[b]=-1,a[b]=-1,d&=~x}}function bv(a,o){var d=a.entangledLanes|=o;for(a=a.entanglements;d;){var f=31-Es(d),b=1<<f;b&o|a[f]&o&&(a[f]|=o),d&=~b}}var bt=0;function kL(a){return a&=-a,1<a?4<a?a&268435455?16:536870912:4:1}var IL,yv,SL,CL,TL,k1=!1,Xf=[],vi=null,wi=null,ki=null,Gd=new Map,zd=new Map,mi=[],Bre="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function p3(a,o){switch(a){case"focusin":case"focusout":vi=null;break;case"dragenter":case"dragleave":wi=null;break;case"mouseover":case"mouseout":ki=null;break;case"pointerover":case"pointerout":Gd.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":zd.delete(o.pointerId)}}function od(a,o,d,f,b,x){return a===null||a.nativeEvent!==x?(a={blockedOn:o,domEventName:d,eventSystemFlags:f,nativeEvent:x,targetContainers:[b]},o!==null&&(o=jd(o),o!==null&&yv(o)),a):(a.eventSystemFlags|=f,o=a.targetContainers,b!==null&&o.indexOf(b)===-1&&o.push(b),a)}function _re(a,o,d,f,b){switch(o){case"focusin":return vi=od(vi,a,o,d,f,b),!0;case"dragenter":return wi=od(wi,a,o,d,f,b),!0;case"mouseover":return ki=od(ki,a,o,d,f,b),!0;case"pointerover":var x=b.pointerId;return Gd.set(x,od(Gd.get(x)||null,a,o,d,f,b)),!0;case"gotpointercapture":return x=b.pointerId,zd.set(x,od(zd.get(x)||null,a,o,d,f,b)),!0}return!1}function NL(a){var o=To(a.target);if(o!==null){var d=Oo(o);if(d!==null){if(o=d.tag,o===13){if(o=mL(d),o!==null){a.blockedOn=o,TL(a.priority,function(){SL(d)});return}}else if(o===3&&d.stateNode.current.memoizedState.isDehydrated){a.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}a.blockedOn=null}function sm(a){if(a.blockedOn!==null)return!1;for(var o=a.targetContainers;0<o.length;){var d=I1(a.domEventName,a.eventSystemFlags,o[0],a.nativeEvent);if(d===null){d=a.nativeEvent;var f=new d.constructor(d.type,d);b1=f,d.target.dispatchEvent(f),b1=null}else return o=jd(d),o!==null&&yv(o),a.blockedOn=d,!1;o.shift()}return!0}function f3(a,o,d){sm(a)&&d.delete(o)}function Hre(){k1=!1,vi!==null&&sm(vi)&&(vi=null),wi!==null&&sm(wi)&&(wi=null),ki!==null&&sm(ki)&&(ki=null),Gd.forEach(f3),zd.forEach(f3)}function ld(a,o){a.blockedOn===o&&(a.blockedOn=null,k1||(k1=!0,Vr.unstable_scheduleCallback(Vr.unstable_NormalPriority,Hre)))}function Wd(a){function o(b){return ld(b,a)}if(0<Xf.length){ld(Xf[0],a);for(var d=1;d<Xf.length;d++){var f=Xf[d];f.blockedOn===a&&(f.blockedOn=null)}}for(vi!==null&&ld(vi,a),wi!==null&&ld(wi,a),ki!==null&&ld(ki,a),Gd.forEach(o),zd.forEach(o),d=0;d<mi.length;d++)f=mi[d],f.blockedOn===a&&(f.blockedOn=null);for(;0<mi.length&&(d=mi[0],d.blockedOn===null);)NL(d),d.blockedOn===null&&mi.shift()}var Hl=Pa.ReactCurrentBatchConfig,Tm=!0;function Ure(a,o,d,f){var b=bt,x=Hl.transition;Hl.transition=null;try{bt=1,xv(a,o,d,f)}finally{bt=b,Hl.transition=x}}function jre(a,o,d,f){var b=bt,x=Hl.transition;Hl.transition=null;try{bt=4,xv(a,o,d,f)}finally{bt=b,Hl.transition=x}}function xv(a,o,d,f){if(Tm){var b=I1(a,o,d,f);if(b===null)Ox(a,o,f,Nm,d),p3(a,f);else if(_re(b,a,o,d,f))f.stopPropagation();else if(p3(a,f),o&4&&-1<Bre.indexOf(a)){for(;b!==null;){var x=jd(b);if(x!==null&&IL(x),x=I1(a,o,d,f),x===null&&Ox(a,o,f,Nm,d),x===b)break;b=x}b!==null&&f.stopPropagation()}else Ox(a,o,f,null,d)}}var Nm=null;function I1(a,o,d,f){if(Nm=null,a=mv(f),a=To(a),a!==null)if(o=Oo(a),o===null)a=null;else if(d=o.tag,d===13){if(a=mL(o),a!==null)return a;a=null}else if(d===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;a=null}else o!==a&&(a=null);return Nm=a,null}function RL(a){switch(a){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Fre()){case gv:return 1;case xL:return 4;case Sm:case Vre:return 16;case vL:return 536870912;default:return 16}default:return 16}}var yi=null,vv=null,am=null;function EL(){if(am)return am;var a,o=vv,d=o.length,f,b="value"in yi?yi.value:yi.textContent,x=b.length;for(a=0;a<d&&o[a]===b[a];a++);var k=d-a;for(f=1;f<=k&&o[d-f]===b[x-f];f++);return am=b.slice(a,1<f?1-f:void 0)}function im(a){var o=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&o===13&&(a=13)):a=o,a===10&&(a=13),32<=a||a===13?a:0}function Of(){return!0}function m3(){return!1}function Xr(a){function o(d,f,b,x,k){this._reactName=d,this._targetInst=b,this.type=f,this.nativeEvent=x,this.target=k,this.currentTarget=null;for(var N in a)a.hasOwnProperty(N)&&(d=a[N],this[N]=d?d(x):x[N]);return this.isDefaultPrevented=(x.defaultPrevented!=null?x.defaultPrevented:x.returnValue===!1)?Of:m3,this.isPropagationStopped=m3,this}return _t(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=Of)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=Of)},persist:function(){},isPersistent:Of}),o}var au={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},wv=Xr(au),Ud=_t({},au,{view:0,detail:0}),Yre=Xr(Ud),Gx,zx,ud,Ym=_t({},Ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kv,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==ud&&(ud&&a.type==="mousemove"?(Gx=a.screenX-ud.screenX,zx=a.screenY-ud.screenY):zx=Gx=0,ud=a),Gx)},movementY:function(a){return"movementY"in a?a.movementY:zx}}),g3=Xr(Ym),Qre=_t({},Ym,{dataTransfer:0}),Jre=Xr(Qre),qre=_t({},Ud,{relatedTarget:0}),Wx=Xr(qre),ese=_t({},au,{animationName:0,elapsedTime:0,pseudoElement:0}),tse=Xr(ese),nse=_t({},au,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),rse=Xr(nse),sse=_t({},au,{data:0}),b3=Xr(sse),ase={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ise={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ose={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function lse(a){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(a):(a=ose[a])?!!o[a]:!1}function kv(){return lse}var use=_t({},Ud,{key:function(a){if(a.key){var o=ase[a.key]||a.key;if(o!=="Unidentified")return o}return a.type==="keypress"?(a=im(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?ise[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kv,charCode:function(a){return a.type==="keypress"?im(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?im(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),cse=Xr(use),dse=_t({},Ym,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),y3=Xr(dse),hse=_t({},Ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kv}),pse=Xr(hse),fse=_t({},au,{propertyName:0,elapsedTime:0,pseudoElement:0}),mse=Xr(fse),gse=_t({},Ym,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),bse=Xr(gse),yse=[9,13,27,32],Iv=za&&"CompositionEvent"in window,wd=null;za&&"documentMode"in document&&(wd=document.documentMode);var xse=za&&"TextEvent"in window&&!wd,LL=za&&(!Iv||wd&&8<wd&&11>=wd),x3=" ",v3=!1;function GL(a,o){switch(a){case"keyup":return yse.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zL(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Ml=!1;function vse(a,o){switch(a){case"compositionend":return zL(o);case"keypress":return o.which!==32?null:(v3=!0,x3);case"textInput":return a=o.data,a===x3&&v3?null:a;default:return null}}function wse(a,o){if(Ml)return a==="compositionend"||!Iv&&GL(a,o)?(a=EL(),am=vv=yi=null,Ml=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return LL&&o.locale!=="ko"?null:o.data;default:return null}}var kse={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function w3(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o==="input"?!!kse[a.type]:o==="textarea"}function WL(a,o,d,f){cL(f),o=Rm(o,"onChange"),0<o.length&&(d=new wv("onChange","change",null,d,f),a.push({event:d,listeners:o}))}var kd=null,Md=null;function Ise(a){ZL(a,0)}function Qm(a){var o=Vl(a);if(rL(o))return a}function Sse(a,o){if(a==="change")return o}var ML=!1;if(za){var Mx;if(za){var $x="oninput"in document;if(!$x){var k3=document.createElement("div");k3.setAttribute("oninput","return;"),$x=typeof k3.oninput=="function"}Mx=$x}else Mx=!1;ML=Mx&&(!document.documentMode||9<document.documentMode)}function I3(){kd&&(kd.detachEvent("onpropertychange",$L),Md=kd=null)}function $L(a){if(a.propertyName==="value"&&Qm(Md)){var o=[];WL(o,Md,a,mv(a)),fL(Ise,o)}}function Cse(a,o,d){a==="focusin"?(I3(),kd=o,Md=d,kd.attachEvent("onpropertychange",$L)):a==="focusout"&&I3()}function Tse(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Qm(Md)}function Nse(a,o){if(a==="click")return Qm(o)}function Rse(a,o){if(a==="input"||a==="change")return Qm(o)}function Ese(a,o){return a===o&&(a!==0||1/a===1/o)||a!==a&&o!==o}var Gs=typeof Object.is=="function"?Object.is:Ese;function $d(a,o){if(Gs(a,o))return!0;if(typeof a!="object"||a===null||typeof o!="object"||o===null)return!1;var d=Object.keys(a),f=Object.keys(o);if(d.length!==f.length)return!1;for(f=0;f<d.length;f++){var b=d[f];if(!a1.call(o,b)||!Gs(a[b],o[b]))return!1}return!0}function S3(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function C3(a,o){var d=S3(a);a=0;for(var f;d;){if(d.nodeType===3){if(f=a+d.textContent.length,a<=o&&f>=o)return{node:d,offset:o-a};a=f}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=S3(d)}}function FL(a,o){return a&&o?a===o?!0:a&&a.nodeType===3?!1:o&&o.nodeType===3?FL(a,o.parentNode):"contains"in a?a.contains(o):a.compareDocumentPosition?!!(a.compareDocumentPosition(o)&16):!1:!1}function VL(){for(var a=window,o=wm();o instanceof a.HTMLIFrameElement;){try{var d=typeof o.contentWindow.location.href=="string"}catch{d=!1}if(d)a=o.contentWindow;else break;o=wm(a.document)}return o}function Sv(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o&&(o==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||o==="textarea"||a.contentEditable==="true")}function Lse(a){var o=VL(),d=a.focusedElem,f=a.selectionRange;if(o!==d&&d&&d.ownerDocument&&FL(d.ownerDocument.documentElement,d)){if(f!==null&&Sv(d)){if(o=f.start,a=f.end,a===void 0&&(a=o),"selectionStart"in d)d.selectionStart=o,d.selectionEnd=Math.min(a,d.value.length);else if(a=(o=d.ownerDocument||document)&&o.defaultView||window,a.getSelection){a=a.getSelection();var b=d.textContent.length,x=Math.min(f.start,b);f=f.end===void 0?x:Math.min(f.end,b),!a.extend&&x>f&&(b=f,f=x,x=b),b=C3(d,x);var k=C3(d,f);b&&k&&(a.rangeCount!==1||a.anchorNode!==b.node||a.anchorOffset!==b.offset||a.focusNode!==k.node||a.focusOffset!==k.offset)&&(o=o.createRange(),o.setStart(b.node,b.offset),a.removeAllRanges(),x>f?(a.addRange(o),a.extend(k.node,k.offset)):(o.setEnd(k.node,k.offset),a.addRange(o)))}}for(o=[],a=d;a=a.parentNode;)a.nodeType===1&&o.push({element:a,left:a.scrollLeft,top:a.scrollTop});for(typeof d.focus=="function"&&d.focus(),d=0;d<o.length;d++)a=o[d],a.element.scrollLeft=a.left,a.element.scrollTop=a.top}}var Gse=za&&"documentMode"in document&&11>=document.documentMode,$l=null,S1=null,Id=null,C1=!1;function T3(a,o,d){var f=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;C1||$l==null||$l!==wm(f)||(f=$l,"selectionStart"in f&&Sv(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Id&&$d(Id,f)||(Id=f,f=Rm(S1,"onSelect"),0<f.length&&(o=new wv("onSelect","select",null,o,d),a.push({event:o,listeners:f}),o.target=$l)))}function Df(a,o){var d={};return d[a.toLowerCase()]=o.toLowerCase(),d["Webkit"+a]="webkit"+o,d["Moz"+a]="moz"+o,d}var Fl={animationend:Df("Animation","AnimationEnd"),animationiteration:Df("Animation","AnimationIteration"),animationstart:Df("Animation","AnimationStart"),transitionend:Df("Transition","TransitionEnd")},Fx={},PL={};za&&(PL=document.createElement("div").style,"AnimationEvent"in window||(delete Fl.animationend.animation,delete Fl.animationiteration.animation,delete Fl.animationstart.animation),"TransitionEvent"in window||delete Fl.transitionend.transition);function Jm(a){if(Fx[a])return Fx[a];if(!Fl[a])return a;var o=Fl[a],d;for(d in o)if(o.hasOwnProperty(d)&&d in PL)return Fx[a]=o[d];return a}var XL=Jm("animationend"),OL=Jm("animationiteration"),DL=Jm("animationstart"),AL=Jm("transitionend"),KL=new Map,N3="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Li(a,o){KL.set(a,o),Xo(o,[a])}for(var Vx=0;Vx<N3.length;Vx++){var Px=N3[Vx],zse=Px.toLowerCase(),Wse=Px[0].toUpperCase()+Px.slice(1);Li(zse,"on"+Wse)}Li(XL,"onAnimationEnd");Li(OL,"onAnimationIteration");Li(DL,"onAnimationStart");Li("dblclick","onDoubleClick");Li("focusin","onFocus");Li("focusout","onBlur");Li(AL,"onTransitionEnd");Yl("onMouseEnter",["mouseout","mouseover"]);Yl("onMouseLeave",["mouseout","mouseover"]);Yl("onPointerEnter",["pointerout","pointerover"]);Yl("onPointerLeave",["pointerout","pointerover"]);Xo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Xo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Xo("onBeforeInput",["compositionend","keypress","textInput","paste"]);Xo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Xo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Xo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var yd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mse=new Set("cancel close invalid load scroll toggle".split(" ").concat(yd));function R3(a,o,d){var f=a.type||"unknown-event";a.currentTarget=d,zre(f,o,void 0,a),a.currentTarget=null}function ZL(a,o){o=(o&4)!==0;for(var d=0;d<a.length;d++){var f=a[d],b=f.event;f=f.listeners;e:{var x=void 0;if(o)for(var k=f.length-1;0<=k;k--){var N=f[k],E=N.instance,z=N.currentTarget;if(N=N.listener,E!==x&&b.isPropagationStopped())break e;R3(b,N,z),x=E}else for(k=0;k<f.length;k++){if(N=f[k],E=N.instance,z=N.currentTarget,N=N.listener,E!==x&&b.isPropagationStopped())break e;R3(b,N,z),x=E}}}if(Im)throw a=v1,Im=!1,v1=null,a}function $t(a,o){var d=o[L1];d===void 0&&(d=o[L1]=new Set);var f=a+"__bubble";d.has(f)||(BL(o,a,2,!1),d.add(f))}function Xx(a,o,d){var f=0;o&&(f|=4),BL(d,a,f,o)}var Af="_reactListening"+Math.random().toString(36).slice(2);function Fd(a){if(!a[Af]){a[Af]=!0,JE.forEach(function(d){d!=="selectionchange"&&(Mse.has(d)||Xx(d,!1,a),Xx(d,!0,a))});var o=a.nodeType===9?a:a.ownerDocument;o===null||o[Af]||(o[Af]=!0,Xx("selectionchange",!1,o))}}function BL(a,o,d,f){switch(RL(o)){case 1:var b=Ure;break;case 4:b=jre;break;default:b=xv}d=b.bind(null,o,d,a),b=void 0,!x1||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(b=!0),f?b!==void 0?a.addEventListener(o,d,{capture:!0,passive:b}):a.addEventListener(o,d,!0):b!==void 0?a.addEventListener(o,d,{passive:b}):a.addEventListener(o,d,!1)}function Ox(a,o,d,f,b){var x=f;if(!(o&1)&&!(o&2)&&f!==null)e:for(;;){if(f===null)return;var k=f.tag;if(k===3||k===4){var N=f.stateNode.containerInfo;if(N===b||N.nodeType===8&&N.parentNode===b)break;if(k===4)for(k=f.return;k!==null;){var E=k.tag;if((E===3||E===4)&&(E=k.stateNode.containerInfo,E===b||E.nodeType===8&&E.parentNode===b))return;k=k.return}for(;N!==null;){if(k=To(N),k===null)return;if(E=k.tag,E===5||E===6){f=x=k;continue e}N=N.parentNode}}f=f.return}fL(function(){var z=x,W=mv(d),T=[];e:{var A=KL.get(a);if(A!==void 0){var Y=wv,M=a;switch(a){case"keypress":if(im(d)===0)break e;case"keydown":case"keyup":Y=cse;break;case"focusin":M="focus",Y=Wx;break;case"focusout":M="blur",Y=Wx;break;case"beforeblur":case"afterblur":Y=Wx;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Y=g3;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Y=Jre;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Y=pse;break;case XL:case OL:case DL:Y=tse;break;case AL:Y=mse;break;case"scroll":Y=Yre;break;case"wheel":Y=bse;break;case"copy":case"cut":case"paste":Y=rse;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Y=y3}var B=(o&4)!==0,H=!B&&a==="scroll",O=B?A!==null?A+"Capture":null:A;B=[];for(var P=z,X;P!==null;){X=P;var ie=X.stateNode;if(X.tag===5&&ie!==null&&(X=ie,O!==null&&(ie=Ld(P,O),ie!=null&&B.push(Vd(P,ie,X)))),H)break;P=P.return}0<B.length&&(A=new Y(A,M,null,d,W),T.push({event:A,listeners:B}))}}if(!(o&7)){e:{if(A=a==="mouseover"||a==="pointerover",Y=a==="mouseout"||a==="pointerout",A&&d!==b1&&(M=d.relatedTarget||d.fromElement)&&(To(M)||M[Wa]))break e;if((Y||A)&&(A=W.window===W?W:(A=W.ownerDocument)?A.defaultView||A.parentWindow:window,Y?(M=d.relatedTarget||d.toElement,Y=z,M=M?To(M):null,M!==null&&(H=Oo(M),M!==H||M.tag!==5&&M.tag!==6)&&(M=null)):(Y=null,M=z),Y!==M)){if(B=g3,ie="onMouseLeave",O="onMouseEnter",P="mouse",(a==="pointerout"||a==="pointerover")&&(B=y3,ie="onPointerLeave",O="onPointerEnter",P="pointer"),H=Y==null?A:Vl(Y),X=M==null?A:Vl(M),A=new B(ie,P+"leave",Y,d,W),A.target=H,A.relatedTarget=X,ie=null,To(W)===z&&(B=new B(O,P+"enter",M,d,W),B.target=X,B.relatedTarget=H,ie=B),H=ie,Y&&M)t:{for(B=Y,O=M,P=0,X=B;X;X=Rl(X))P++;for(X=0,ie=O;ie;ie=Rl(ie))X++;for(;0<P-X;)B=Rl(B),P--;for(;0<X-P;)O=Rl(O),X--;for(;P--;){if(B===O||O!==null&&B===O.alternate)break t;B=Rl(B),O=Rl(O)}B=null}else B=null;Y!==null&&E3(T,A,Y,B,!1),M!==null&&H!==null&&E3(T,H,M,B,!0)}}e:{if(A=z?Vl(z):window,Y=A.nodeName&&A.nodeName.toLowerCase(),Y==="select"||Y==="input"&&A.type==="file")var oe=Sse;else if(w3(A))if(ML)oe=Rse;else{oe=Tse;var fe=Cse}else(Y=A.nodeName)&&Y.toLowerCase()==="input"&&(A.type==="checkbox"||A.type==="radio")&&(oe=Nse);if(oe&&(oe=oe(a,z))){WL(T,oe,d,W);break e}fe&&fe(a,A,z),a==="focusout"&&(fe=A._wrapperState)&&fe.controlled&&A.type==="number"&&h1(A,"number",A.value)}switch(fe=z?Vl(z):window,a){case"focusin":(w3(fe)||fe.contentEditable==="true")&&($l=fe,S1=z,Id=null);break;case"focusout":Id=S1=$l=null;break;case"mousedown":C1=!0;break;case"contextmenu":case"mouseup":case"dragend":C1=!1,T3(T,d,W);break;case"selectionchange":if(Gse)break;case"keydown":case"keyup":T3(T,d,W)}var ge;if(Iv)e:{switch(a){case"compositionstart":var be="onCompositionStart";break e;case"compositionend":be="onCompositionEnd";break e;case"compositionupdate":be="onCompositionUpdate";break e}be=void 0}else Ml?GL(a,d)&&(be="onCompositionEnd"):a==="keydown"&&d.keyCode===229&&(be="onCompositionStart");be&&(LL&&d.locale!=="ko"&&(Ml||be!=="onCompositionStart"?be==="onCompositionEnd"&&Ml&&(ge=EL()):(yi=W,vv="value"in yi?yi.value:yi.textContent,Ml=!0)),fe=Rm(z,be),0<fe.length&&(be=new b3(be,a,null,d,W),T.push({event:be,listeners:fe}),ge?be.data=ge:(ge=zL(d),ge!==null&&(be.data=ge)))),(ge=xse?vse(a,d):wse(a,d))&&(z=Rm(z,"onBeforeInput"),0<z.length&&(W=new b3("onBeforeInput","beforeinput",null,d,W),T.push({event:W,listeners:z}),W.data=ge))}ZL(T,o)})}function Vd(a,o,d){return{instance:a,listener:o,currentTarget:d}}function Rm(a,o){for(var d=o+"Capture",f=[];a!==null;){var b=a,x=b.stateNode;b.tag===5&&x!==null&&(b=x,x=Ld(a,d),x!=null&&f.unshift(Vd(a,x,b)),x=Ld(a,o),x!=null&&f.push(Vd(a,x,b))),a=a.return}return f}function Rl(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5);return a||null}function E3(a,o,d,f,b){for(var x=o._reactName,k=[];d!==null&&d!==f;){var N=d,E=N.alternate,z=N.stateNode;if(E!==null&&E===f)break;N.tag===5&&z!==null&&(N=z,b?(E=Ld(d,x),E!=null&&k.unshift(Vd(d,E,N))):b||(E=Ld(d,x),E!=null&&k.push(Vd(d,E,N)))),d=d.return}k.length!==0&&a.push({event:o,listeners:k})}var $se=/\r\n?/g,Fse=/\u0000|\uFFFD/g;function L3(a){return(typeof a=="string"?a:""+a).replace($se,`
`).replace(Fse,"")}function Kf(a,o,d){if(o=L3(o),L3(a)!==o&&d)throw Error(Se(425))}function Em(){}var T1=null,N1=null;function R1(a,o){return a==="textarea"||a==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var E1=typeof setTimeout=="function"?setTimeout:void 0,Vse=typeof clearTimeout=="function"?clearTimeout:void 0,G3=typeof Promise=="function"?Promise:void 0,Pse=typeof queueMicrotask=="function"?queueMicrotask:typeof G3<"u"?function(a){return G3.resolve(null).then(a).catch(Xse)}:E1;function Xse(a){setTimeout(function(){throw a})}function Dx(a,o){var d=o,f=0;do{var b=d.nextSibling;if(a.removeChild(d),b&&b.nodeType===8)if(d=b.data,d==="/$"){if(f===0){a.removeChild(b),Wd(o);return}f--}else d!=="$"&&d!=="$?"&&d!=="$!"||f++;d=b}while(d);Wd(o)}function Ii(a){for(;a!=null;a=a.nextSibling){var o=a.nodeType;if(o===1||o===3)break;if(o===8){if(o=a.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return a}function z3(a){a=a.previousSibling;for(var o=0;a;){if(a.nodeType===8){var d=a.data;if(d==="$"||d==="$!"||d==="$?"){if(o===0)return a;o--}else d==="/$"&&o++}a=a.previousSibling}return null}var iu=Math.random().toString(36).slice(2),ra="__reactFiber$"+iu,Pd="__reactProps$"+iu,Wa="__reactContainer$"+iu,L1="__reactEvents$"+iu,Ose="__reactListeners$"+iu,Dse="__reactHandles$"+iu;function To(a){var o=a[ra];if(o)return o;for(var d=a.parentNode;d;){if(o=d[Wa]||d[ra]){if(d=o.alternate,o.child!==null||d!==null&&d.child!==null)for(a=z3(a);a!==null;){if(d=a[ra])return d;a=z3(a)}return o}a=d,d=a.parentNode}return null}function jd(a){return a=a[ra]||a[Wa],!a||a.tag!==5&&a.tag!==6&&a.tag!==13&&a.tag!==3?null:a}function Vl(a){if(a.tag===5||a.tag===6)return a.stateNode;throw Error(Se(33))}function qm(a){return a[Pd]||null}var G1=[],Pl=-1;function Gi(a){return{current:a}}function Ft(a){0>Pl||(a.current=G1[Pl],G1[Pl]=null,Pl--)}function Lt(a,o){Pl++,G1[Pl]=a.current,a.current=o}var Ei={},jn=Gi(Ei),yr=Gi(!1),Wo=Ei;function Ql(a,o){var d=a.type.contextTypes;if(!d)return Ei;var f=a.stateNode;if(f&&f.__reactInternalMemoizedUnmaskedChildContext===o)return f.__reactInternalMemoizedMaskedChildContext;var b={},x;for(x in d)b[x]=o[x];return f&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=o,a.__reactInternalMemoizedMaskedChildContext=b),b}function xr(a){return a=a.childContextTypes,a!=null}function Lm(){Ft(yr),Ft(jn)}function W3(a,o,d){if(jn.current!==Ei)throw Error(Se(168));Lt(jn,o),Lt(yr,d)}function _L(a,o,d){var f=a.stateNode;if(o=o.childContextTypes,typeof f.getChildContext!="function")return d;f=f.getChildContext();for(var b in f)if(!(b in o))throw Error(Se(108,Cre(a)||"Unknown",b));return _t({},d,f)}function Gm(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Ei,Wo=jn.current,Lt(jn,a),Lt(yr,yr.current),!0}function M3(a,o,d){var f=a.stateNode;if(!f)throw Error(Se(169));d?(a=_L(a,o,Wo),f.__reactInternalMemoizedMergedChildContext=a,Ft(yr),Ft(jn),Lt(jn,a)):Ft(yr),Lt(yr,d)}var Na=null,eg=!1,Ax=!1;function HL(a){Na===null?Na=[a]:Na.push(a)}function Ase(a){eg=!0,HL(a)}function zi(){if(!Ax&&Na!==null){Ax=!0;var a=0,o=bt;try{var d=Na;for(bt=1;a<d.length;a++){var f=d[a];do f=f(!0);while(f!==null)}Na=null,eg=!1}catch(b){throw Na!==null&&(Na=Na.slice(a+1)),yL(gv,zi),b}finally{bt=o,Ax=!1}}return null}var Xl=[],Ol=0,zm=null,Wm=0,as=[],is=0,Mo=null,Ra=1,Ea="";function So(a,o){Xl[Ol++]=Wm,Xl[Ol++]=zm,zm=a,Wm=o}function UL(a,o,d){as[is++]=Ra,as[is++]=Ea,as[is++]=Mo,Mo=a;var f=Ra;a=Ea;var b=32-Es(f)-1;f&=~(1<<b),d+=1;var x=32-Es(o)+b;if(30<x){var k=b-b%5;x=(f&(1<<k)-1).toString(32),f>>=k,b-=k,Ra=1<<32-Es(o)+b|d<<b|f,Ea=x+a}else Ra=1<<x|d<<b|f,Ea=a}function Cv(a){a.return!==null&&(So(a,1),UL(a,1,0))}function Tv(a){for(;a===zm;)zm=Xl[--Ol],Xl[Ol]=null,Wm=Xl[--Ol],Xl[Ol]=null;for(;a===Mo;)Mo=as[--is],as[is]=null,Ea=as[--is],as[is]=null,Ra=as[--is],as[is]=null}var Fr=null,$r=null,At=!1,Ns=null;function jL(a,o){var d=os(5,null,null,0);d.elementType="DELETED",d.stateNode=o,d.return=a,o=a.deletions,o===null?(a.deletions=[d],a.flags|=16):o.push(d)}function $3(a,o){switch(a.tag){case 5:var d=a.type;return o=o.nodeType!==1||d.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(a.stateNode=o,Fr=a,$r=Ii(o.firstChild),!0):!1;case 6:return o=a.pendingProps===""||o.nodeType!==3?null:o,o!==null?(a.stateNode=o,Fr=a,$r=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(d=Mo!==null?{id:Ra,overflow:Ea}:null,a.memoizedState={dehydrated:o,treeContext:d,retryLane:1073741824},d=os(18,null,null,0),d.stateNode=o,d.return=a,a.child=d,Fr=a,$r=null,!0):!1;default:return!1}}function z1(a){return(a.mode&1)!==0&&(a.flags&128)===0}function W1(a){if(At){var o=$r;if(o){var d=o;if(!$3(a,o)){if(z1(a))throw Error(Se(418));o=Ii(d.nextSibling);var f=Fr;o&&$3(a,o)?jL(f,d):(a.flags=a.flags&-4097|2,At=!1,Fr=a)}}else{if(z1(a))throw Error(Se(418));a.flags=a.flags&-4097|2,At=!1,Fr=a}}}function F3(a){for(a=a.return;a!==null&&a.tag!==5&&a.tag!==3&&a.tag!==13;)a=a.return;Fr=a}function Zf(a){if(a!==Fr)return!1;if(!At)return F3(a),At=!0,!1;var o;if((o=a.tag!==3)&&!(o=a.tag!==5)&&(o=a.type,o=o!=="head"&&o!=="body"&&!R1(a.type,a.memoizedProps)),o&&(o=$r)){if(z1(a))throw YL(),Error(Se(418));for(;o;)jL(a,o),o=Ii(o.nextSibling)}if(F3(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(Se(317));e:{for(a=a.nextSibling,o=0;a;){if(a.nodeType===8){var d=a.data;if(d==="/$"){if(o===0){$r=Ii(a.nextSibling);break e}o--}else d!=="$"&&d!=="$!"&&d!=="$?"||o++}a=a.nextSibling}$r=null}}else $r=Fr?Ii(a.stateNode.nextSibling):null;return!0}function YL(){for(var a=$r;a;)a=Ii(a.nextSibling)}function Jl(){$r=Fr=null,At=!1}function Nv(a){Ns===null?Ns=[a]:Ns.push(a)}var Kse=Pa.ReactCurrentBatchConfig;function cd(a,o,d){if(a=d.ref,a!==null&&typeof a!="function"&&typeof a!="object"){if(d._owner){if(d=d._owner,d){if(d.tag!==1)throw Error(Se(309));var f=d.stateNode}if(!f)throw Error(Se(147,a));var b=f,x=""+a;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===x?o.ref:(o=function(k){var N=b.refs;k===null?delete N[x]:N[x]=k},o._stringRef=x,o)}if(typeof a!="string")throw Error(Se(284));if(!d._owner)throw Error(Se(290,a))}return a}function Bf(a,o){throw a=Object.prototype.toString.call(o),Error(Se(31,a==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":a))}function V3(a){var o=a._init;return o(a._payload)}function QL(a){function o(O,P){if(a){var X=O.deletions;X===null?(O.deletions=[P],O.flags|=16):X.push(P)}}function d(O,P){if(!a)return null;for(;P!==null;)o(O,P),P=P.sibling;return null}function f(O,P){for(O=new Map;P!==null;)P.key!==null?O.set(P.key,P):O.set(P.index,P),P=P.sibling;return O}function b(O,P){return O=Ni(O,P),O.index=0,O.sibling=null,O}function x(O,P,X){return O.index=X,a?(X=O.alternate,X!==null?(X=X.index,X<P?(O.flags|=2,P):X):(O.flags|=2,P)):(O.flags|=1048576,P)}function k(O){return a&&O.alternate===null&&(O.flags|=2),O}function N(O,P,X,ie){return P===null||P.tag!==6?(P=jx(X,O.mode,ie),P.return=O,P):(P=b(P,X),P.return=O,P)}function E(O,P,X,ie){var oe=X.type;return oe===Wl?W(O,P,X.props.children,ie,X.key):P!==null&&(P.elementType===oe||typeof oe=="object"&&oe!==null&&oe.$$typeof===pi&&V3(oe)===P.type)?(ie=b(P,X.props),ie.ref=cd(O,P,X),ie.return=O,ie):(ie=pm(X.type,X.key,X.props,null,O.mode,ie),ie.ref=cd(O,P,X),ie.return=O,ie)}function z(O,P,X,ie){return P===null||P.tag!==4||P.stateNode.containerInfo!==X.containerInfo||P.stateNode.implementation!==X.implementation?(P=Yx(X,O.mode,ie),P.return=O,P):(P=b(P,X.children||[]),P.return=O,P)}function W(O,P,X,ie,oe){return P===null||P.tag!==7?(P=Go(X,O.mode,ie,oe),P.return=O,P):(P=b(P,X),P.return=O,P)}function T(O,P,X){if(typeof P=="string"&&P!==""||typeof P=="number")return P=jx(""+P,O.mode,X),P.return=O,P;if(typeof P=="object"&&P!==null){switch(P.$$typeof){case Mf:return X=pm(P.type,P.key,P.props,null,O.mode,X),X.ref=cd(O,null,P),X.return=O,X;case zl:return P=Yx(P,O.mode,X),P.return=O,P;case pi:var ie=P._init;return T(O,ie(P._payload),X)}if(gd(P)||ad(P))return P=Go(P,O.mode,X,null),P.return=O,P;Bf(O,P)}return null}function A(O,P,X,ie){var oe=P!==null?P.key:null;if(typeof X=="string"&&X!==""||typeof X=="number")return oe!==null?null:N(O,P,""+X,ie);if(typeof X=="object"&&X!==null){switch(X.$$typeof){case Mf:return X.key===oe?E(O,P,X,ie):null;case zl:return X.key===oe?z(O,P,X,ie):null;case pi:return oe=X._init,A(O,P,oe(X._payload),ie)}if(gd(X)||ad(X))return oe!==null?null:W(O,P,X,ie,null);Bf(O,X)}return null}function Y(O,P,X,ie,oe){if(typeof ie=="string"&&ie!==""||typeof ie=="number")return O=O.get(X)||null,N(P,O,""+ie,oe);if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case Mf:return O=O.get(ie.key===null?X:ie.key)||null,E(P,O,ie,oe);case zl:return O=O.get(ie.key===null?X:ie.key)||null,z(P,O,ie,oe);case pi:var fe=ie._init;return Y(O,P,X,fe(ie._payload),oe)}if(gd(ie)||ad(ie))return O=O.get(X)||null,W(P,O,ie,oe,null);Bf(P,ie)}return null}function M(O,P,X,ie){for(var oe=null,fe=null,ge=P,be=P=0,Ve=null;ge!==null&&be<X.length;be++){ge.index>be?(Ve=ge,ge=null):Ve=ge.sibling;var Oe=A(O,ge,X[be],ie);if(Oe===null){ge===null&&(ge=Ve);break}a&&ge&&Oe.alternate===null&&o(O,ge),P=x(Oe,P,be),fe===null?oe=Oe:fe.sibling=Oe,fe=Oe,ge=Ve}if(be===X.length)return d(O,ge),At&&So(O,be),oe;if(ge===null){for(;be<X.length;be++)ge=T(O,X[be],ie),ge!==null&&(P=x(ge,P,be),fe===null?oe=ge:fe.sibling=ge,fe=ge);return At&&So(O,be),oe}for(ge=f(O,ge);be<X.length;be++)Ve=Y(ge,O,be,X[be],ie),Ve!==null&&(a&&Ve.alternate!==null&&ge.delete(Ve.key===null?be:Ve.key),P=x(Ve,P,be),fe===null?oe=Ve:fe.sibling=Ve,fe=Ve);return a&&ge.forEach(function(Gt){return o(O,Gt)}),At&&So(O,be),oe}function B(O,P,X,ie){var oe=ad(X);if(typeof oe!="function")throw Error(Se(150));if(X=oe.call(X),X==null)throw Error(Se(151));for(var fe=oe=null,ge=P,be=P=0,Ve=null,Oe=X.next();ge!==null&&!Oe.done;be++,Oe=X.next()){ge.index>be?(Ve=ge,ge=null):Ve=ge.sibling;var Gt=A(O,ge,Oe.value,ie);if(Gt===null){ge===null&&(ge=Ve);break}a&&ge&&Gt.alternate===null&&o(O,ge),P=x(Gt,P,be),fe===null?oe=Gt:fe.sibling=Gt,fe=Gt,ge=Ve}if(Oe.done)return d(O,ge),At&&So(O,be),oe;if(ge===null){for(;!Oe.done;be++,Oe=X.next())Oe=T(O,Oe.value,ie),Oe!==null&&(P=x(Oe,P,be),fe===null?oe=Oe:fe.sibling=Oe,fe=Oe);return At&&So(O,be),oe}for(ge=f(O,ge);!Oe.done;be++,Oe=X.next())Oe=Y(ge,O,be,Oe.value,ie),Oe!==null&&(a&&Oe.alternate!==null&&ge.delete(Oe.key===null?be:Oe.key),P=x(Oe,P,be),fe===null?oe=Oe:fe.sibling=Oe,fe=Oe);return a&&ge.forEach(function(Ht){return o(O,Ht)}),At&&So(O,be),oe}function H(O,P,X,ie){if(typeof X=="object"&&X!==null&&X.type===Wl&&X.key===null&&(X=X.props.children),typeof X=="object"&&X!==null){switch(X.$$typeof){case Mf:e:{for(var oe=X.key,fe=P;fe!==null;){if(fe.key===oe){if(oe=X.type,oe===Wl){if(fe.tag===7){d(O,fe.sibling),P=b(fe,X.props.children),P.return=O,O=P;break e}}else if(fe.elementType===oe||typeof oe=="object"&&oe!==null&&oe.$$typeof===pi&&V3(oe)===fe.type){d(O,fe.sibling),P=b(fe,X.props),P.ref=cd(O,fe,X),P.return=O,O=P;break e}d(O,fe);break}else o(O,fe);fe=fe.sibling}X.type===Wl?(P=Go(X.props.children,O.mode,ie,X.key),P.return=O,O=P):(ie=pm(X.type,X.key,X.props,null,O.mode,ie),ie.ref=cd(O,P,X),ie.return=O,O=ie)}return k(O);case zl:e:{for(fe=X.key;P!==null;){if(P.key===fe)if(P.tag===4&&P.stateNode.containerInfo===X.containerInfo&&P.stateNode.implementation===X.implementation){d(O,P.sibling),P=b(P,X.children||[]),P.return=O,O=P;break e}else{d(O,P);break}else o(O,P);P=P.sibling}P=Yx(X,O.mode,ie),P.return=O,O=P}return k(O);case pi:return fe=X._init,H(O,P,fe(X._payload),ie)}if(gd(X))return M(O,P,X,ie);if(ad(X))return B(O,P,X,ie);Bf(O,X)}return typeof X=="string"&&X!==""||typeof X=="number"?(X=""+X,P!==null&&P.tag===6?(d(O,P.sibling),P=b(P,X),P.return=O,O=P):(d(O,P),P=jx(X,O.mode,ie),P.return=O,O=P),k(O)):d(O,P)}return H}var ql=QL(!0),JL=QL(!1),Mm=Gi(null),$m=null,Dl=null,Rv=null;function Ev(){Rv=Dl=$m=null}function Lv(a){var o=Mm.current;Ft(Mm),a._currentValue=o}function M1(a,o,d){for(;a!==null;){var f=a.alternate;if((a.childLanes&o)!==o?(a.childLanes|=o,f!==null&&(f.childLanes|=o)):f!==null&&(f.childLanes&o)!==o&&(f.childLanes|=o),a===d)break;a=a.return}}function Ul(a,o){$m=a,Rv=Dl=null,a=a.dependencies,a!==null&&a.firstContext!==null&&(a.lanes&o&&(br=!0),a.firstContext=null)}function us(a){var o=a._currentValue;if(Rv!==a)if(a={context:a,memoizedValue:o,next:null},Dl===null){if($m===null)throw Error(Se(308));Dl=a,$m.dependencies={lanes:0,firstContext:a}}else Dl=Dl.next=a;return o}var No=null;function Gv(a){No===null?No=[a]:No.push(a)}function qL(a,o,d,f){var b=o.interleaved;return b===null?(d.next=d,Gv(o)):(d.next=b.next,b.next=d),o.interleaved=d,Ma(a,f)}function Ma(a,o){a.lanes|=o;var d=a.alternate;for(d!==null&&(d.lanes|=o),d=a,a=a.return;a!==null;)a.childLanes|=o,d=a.alternate,d!==null&&(d.childLanes|=o),d=a,a=a.return;return d.tag===3?d.stateNode:null}var fi=!1;function zv(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function eG(a,o){a=a.updateQueue,o.updateQueue===a&&(o.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,effects:a.effects})}function La(a,o){return{eventTime:a,lane:o,tag:0,payload:null,callback:null,next:null}}function Si(a,o,d){var f=a.updateQueue;if(f===null)return null;if(f=f.shared,ct&2){var b=f.pending;return b===null?o.next=o:(o.next=b.next,b.next=o),f.pending=o,Ma(a,d)}return b=f.interleaved,b===null?(o.next=o,Gv(f)):(o.next=b.next,b.next=o),f.interleaved=o,Ma(a,d)}function om(a,o,d){if(o=o.updateQueue,o!==null&&(o=o.shared,(d&4194240)!==0)){var f=o.lanes;f&=a.pendingLanes,d|=f,o.lanes=d,bv(a,d)}}function P3(a,o){var d=a.updateQueue,f=a.alternate;if(f!==null&&(f=f.updateQueue,d===f)){var b=null,x=null;if(d=d.firstBaseUpdate,d!==null){do{var k={eventTime:d.eventTime,lane:d.lane,tag:d.tag,payload:d.payload,callback:d.callback,next:null};x===null?b=x=k:x=x.next=k,d=d.next}while(d!==null);x===null?b=x=o:x=x.next=o}else b=x=o;d={baseState:f.baseState,firstBaseUpdate:b,lastBaseUpdate:x,shared:f.shared,effects:f.effects},a.updateQueue=d;return}a=d.lastBaseUpdate,a===null?d.firstBaseUpdate=o:a.next=o,d.lastBaseUpdate=o}function Fm(a,o,d,f){var b=a.updateQueue;fi=!1;var x=b.firstBaseUpdate,k=b.lastBaseUpdate,N=b.shared.pending;if(N!==null){b.shared.pending=null;var E=N,z=E.next;E.next=null,k===null?x=z:k.next=z,k=E;var W=a.alternate;W!==null&&(W=W.updateQueue,N=W.lastBaseUpdate,N!==k&&(N===null?W.firstBaseUpdate=z:N.next=z,W.lastBaseUpdate=E))}if(x!==null){var T=b.baseState;k=0,W=z=E=null,N=x;do{var A=N.lane,Y=N.eventTime;if((f&A)===A){W!==null&&(W=W.next={eventTime:Y,lane:0,tag:N.tag,payload:N.payload,callback:N.callback,next:null});e:{var M=a,B=N;switch(A=o,Y=d,B.tag){case 1:if(M=B.payload,typeof M=="function"){T=M.call(Y,T,A);break e}T=M;break e;case 3:M.flags=M.flags&-65537|128;case 0:if(M=B.payload,A=typeof M=="function"?M.call(Y,T,A):M,A==null)break e;T=_t({},T,A);break e;case 2:fi=!0}}N.callback!==null&&N.lane!==0&&(a.flags|=64,A=b.effects,A===null?b.effects=[N]:A.push(N))}else Y={eventTime:Y,lane:A,tag:N.tag,payload:N.payload,callback:N.callback,next:null},W===null?(z=W=Y,E=T):W=W.next=Y,k|=A;if(N=N.next,N===null){if(N=b.shared.pending,N===null)break;A=N,N=A.next,A.next=null,b.lastBaseUpdate=A,b.shared.pending=null}}while(!0);if(W===null&&(E=T),b.baseState=E,b.firstBaseUpdate=z,b.lastBaseUpdate=W,o=b.shared.interleaved,o!==null){b=o;do k|=b.lane,b=b.next;while(b!==o)}else x===null&&(b.shared.lanes=0);Fo|=k,a.lanes=k,a.memoizedState=T}}function X3(a,o,d){if(a=o.effects,o.effects=null,a!==null)for(o=0;o<a.length;o++){var f=a[o],b=f.callback;if(b!==null){if(f.callback=null,f=d,typeof b!="function")throw Error(Se(191,b));b.call(f)}}}var Yd={},ua=Gi(Yd),Xd=Gi(Yd),Od=Gi(Yd);function Ro(a){if(a===Yd)throw Error(Se(174));return a}function Wv(a,o){switch(Lt(Od,o),Lt(Xd,a),Lt(ua,Yd),a=o.nodeType,a){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:f1(null,"");break;default:a=a===8?o.parentNode:o,o=a.namespaceURI||null,a=a.tagName,o=f1(o,a)}Ft(ua),Lt(ua,o)}function eu(){Ft(ua),Ft(Xd),Ft(Od)}function tG(a){Ro(Od.current);var o=Ro(ua.current),d=f1(o,a.type);o!==d&&(Lt(Xd,a),Lt(ua,d))}function Mv(a){Xd.current===a&&(Ft(ua),Ft(Xd))}var Zt=Gi(0);function Vm(a){for(var o=a;o!==null;){if(o.tag===13){var d=o.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||d.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if(o.flags&128)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var Kx=[];function $v(){for(var a=0;a<Kx.length;a++)Kx[a]._workInProgressVersionPrimary=null;Kx.length=0}var lm=Pa.ReactCurrentDispatcher,Zx=Pa.ReactCurrentBatchConfig,$o=0,Bt=null,yn=null,Tn=null,Pm=!1,Sd=!1,Dd=0,Zse=0;function Bn(){throw Error(Se(321))}function Fv(a,o){if(o===null)return!1;for(var d=0;d<o.length&&d<a.length;d++)if(!Gs(a[d],o[d]))return!1;return!0}function Vv(a,o,d,f,b,x){if($o=x,Bt=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,lm.current=a===null||a.memoizedState===null?Use:jse,a=d(f,b),Sd){x=0;do{if(Sd=!1,Dd=0,25<=x)throw Error(Se(301));x+=1,Tn=yn=null,o.updateQueue=null,lm.current=Yse,a=d(f,b)}while(Sd)}if(lm.current=Xm,o=yn!==null&&yn.next!==null,$o=0,Tn=yn=Bt=null,Pm=!1,o)throw Error(Se(300));return a}function Pv(){var a=Dd!==0;return Dd=0,a}function na(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Tn===null?Bt.memoizedState=Tn=a:Tn=Tn.next=a,Tn}function cs(){if(yn===null){var a=Bt.alternate;a=a!==null?a.memoizedState:null}else a=yn.next;var o=Tn===null?Bt.memoizedState:Tn.next;if(o!==null)Tn=o,yn=a;else{if(a===null)throw Error(Se(310));yn=a,a={memoizedState:yn.memoizedState,baseState:yn.baseState,baseQueue:yn.baseQueue,queue:yn.queue,next:null},Tn===null?Bt.memoizedState=Tn=a:Tn=Tn.next=a}return Tn}function Ad(a,o){return typeof o=="function"?o(a):o}function Bx(a){var o=cs(),d=o.queue;if(d===null)throw Error(Se(311));d.lastRenderedReducer=a;var f=yn,b=f.baseQueue,x=d.pending;if(x!==null){if(b!==null){var k=b.next;b.next=x.next,x.next=k}f.baseQueue=b=x,d.pending=null}if(b!==null){x=b.next,f=f.baseState;var N=k=null,E=null,z=x;do{var W=z.lane;if(($o&W)===W)E!==null&&(E=E.next={lane:0,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null}),f=z.hasEagerState?z.eagerState:a(f,z.action);else{var T={lane:W,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null};E===null?(N=E=T,k=f):E=E.next=T,Bt.lanes|=W,Fo|=W}z=z.next}while(z!==null&&z!==x);E===null?k=f:E.next=N,Gs(f,o.memoizedState)||(br=!0),o.memoizedState=f,o.baseState=k,o.baseQueue=E,d.lastRenderedState=f}if(a=d.interleaved,a!==null){b=a;do x=b.lane,Bt.lanes|=x,Fo|=x,b=b.next;while(b!==a)}else b===null&&(d.lanes=0);return[o.memoizedState,d.dispatch]}function _x(a){var o=cs(),d=o.queue;if(d===null)throw Error(Se(311));d.lastRenderedReducer=a;var f=d.dispatch,b=d.pending,x=o.memoizedState;if(b!==null){d.pending=null;var k=b=b.next;do x=a(x,k.action),k=k.next;while(k!==b);Gs(x,o.memoizedState)||(br=!0),o.memoizedState=x,o.baseQueue===null&&(o.baseState=x),d.lastRenderedState=x}return[x,f]}function nG(){}function rG(a,o){var d=Bt,f=cs(),b=o(),x=!Gs(f.memoizedState,b);if(x&&(f.memoizedState=b,br=!0),f=f.queue,Xv(iG.bind(null,d,f,a),[a]),f.getSnapshot!==o||x||Tn!==null&&Tn.memoizedState.tag&1){if(d.flags|=2048,Kd(9,aG.bind(null,d,f,b,o),void 0,null),Nn===null)throw Error(Se(349));$o&30||sG(d,o,b)}return b}function sG(a,o,d){a.flags|=16384,a={getSnapshot:o,value:d},o=Bt.updateQueue,o===null?(o={lastEffect:null,stores:null},Bt.updateQueue=o,o.stores=[a]):(d=o.stores,d===null?o.stores=[a]:d.push(a))}function aG(a,o,d,f){o.value=d,o.getSnapshot=f,oG(o)&&lG(a)}function iG(a,o,d){return d(function(){oG(o)&&lG(a)})}function oG(a){var o=a.getSnapshot;a=a.value;try{var d=o();return!Gs(a,d)}catch{return!0}}function lG(a){var o=Ma(a,1);o!==null&&Ls(o,a,1,-1)}function O3(a){var o=na();return typeof a=="function"&&(a=a()),o.memoizedState=o.baseState=a,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ad,lastRenderedState:a},o.queue=a,a=a.dispatch=Hse.bind(null,Bt,a),[o.memoizedState,a]}function Kd(a,o,d,f){return a={tag:a,create:o,destroy:d,deps:f,next:null},o=Bt.updateQueue,o===null?(o={lastEffect:null,stores:null},Bt.updateQueue=o,o.lastEffect=a.next=a):(d=o.lastEffect,d===null?o.lastEffect=a.next=a:(f=d.next,d.next=a,a.next=f,o.lastEffect=a)),a}function uG(){return cs().memoizedState}function um(a,o,d,f){var b=na();Bt.flags|=a,b.memoizedState=Kd(1|o,d,void 0,f===void 0?null:f)}function tg(a,o,d,f){var b=cs();f=f===void 0?null:f;var x=void 0;if(yn!==null){var k=yn.memoizedState;if(x=k.destroy,f!==null&&Fv(f,k.deps)){b.memoizedState=Kd(o,d,x,f);return}}Bt.flags|=a,b.memoizedState=Kd(1|o,d,x,f)}function D3(a,o){return um(8390656,8,a,o)}function Xv(a,o){return tg(2048,8,a,o)}function cG(a,o){return tg(4,2,a,o)}function dG(a,o){return tg(4,4,a,o)}function hG(a,o){if(typeof o=="function")return a=a(),o(a),function(){o(null)};if(o!=null)return a=a(),o.current=a,function(){o.current=null}}function pG(a,o,d){return d=d!=null?d.concat([a]):null,tg(4,4,hG.bind(null,o,a),d)}function Ov(){}function fG(a,o){var d=cs();o=o===void 0?null:o;var f=d.memoizedState;return f!==null&&o!==null&&Fv(o,f[1])?f[0]:(d.memoizedState=[a,o],a)}function mG(a,o){var d=cs();o=o===void 0?null:o;var f=d.memoizedState;return f!==null&&o!==null&&Fv(o,f[1])?f[0]:(a=a(),d.memoizedState=[a,o],a)}function gG(a,o,d){return $o&21?(Gs(d,o)||(d=wL(),Bt.lanes|=d,Fo|=d,a.baseState=!0),o):(a.baseState&&(a.baseState=!1,br=!0),a.memoizedState=d)}function Bse(a,o){var d=bt;bt=d!==0&&4>d?d:4,a(!0);var f=Zx.transition;Zx.transition={};try{a(!1),o()}finally{bt=d,Zx.transition=f}}function bG(){return cs().memoizedState}function _se(a,o,d){var f=Ti(a);if(d={lane:f,action:d,hasEagerState:!1,eagerState:null,next:null},yG(a))xG(o,d);else if(d=qL(a,o,d,f),d!==null){var b=ar();Ls(d,a,f,b),vG(d,o,f)}}function Hse(a,o,d){var f=Ti(a),b={lane:f,action:d,hasEagerState:!1,eagerState:null,next:null};if(yG(a))xG(o,b);else{var x=a.alternate;if(a.lanes===0&&(x===null||x.lanes===0)&&(x=o.lastRenderedReducer,x!==null))try{var k=o.lastRenderedState,N=x(k,d);if(b.hasEagerState=!0,b.eagerState=N,Gs(N,k)){var E=o.interleaved;E===null?(b.next=b,Gv(o)):(b.next=E.next,E.next=b),o.interleaved=b;return}}catch{}finally{}d=qL(a,o,b,f),d!==null&&(b=ar(),Ls(d,a,f,b),vG(d,o,f))}}function yG(a){var o=a.alternate;return a===Bt||o!==null&&o===Bt}function xG(a,o){Sd=Pm=!0;var d=a.pending;d===null?o.next=o:(o.next=d.next,d.next=o),a.pending=o}function vG(a,o,d){if(d&4194240){var f=o.lanes;f&=a.pendingLanes,d|=f,o.lanes=d,bv(a,d)}}var Xm={readContext:us,useCallback:Bn,useContext:Bn,useEffect:Bn,useImperativeHandle:Bn,useInsertionEffect:Bn,useLayoutEffect:Bn,useMemo:Bn,useReducer:Bn,useRef:Bn,useState:Bn,useDebugValue:Bn,useDeferredValue:Bn,useTransition:Bn,useMutableSource:Bn,useSyncExternalStore:Bn,useId:Bn,unstable_isNewReconciler:!1},Use={readContext:us,useCallback:function(a,o){return na().memoizedState=[a,o===void 0?null:o],a},useContext:us,useEffect:D3,useImperativeHandle:function(a,o,d){return d=d!=null?d.concat([a]):null,um(4194308,4,hG.bind(null,o,a),d)},useLayoutEffect:function(a,o){return um(4194308,4,a,o)},useInsertionEffect:function(a,o){return um(4,2,a,o)},useMemo:function(a,o){var d=na();return o=o===void 0?null:o,a=a(),d.memoizedState=[a,o],a},useReducer:function(a,o,d){var f=na();return o=d!==void 0?d(o):o,f.memoizedState=f.baseState=o,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:o},f.queue=a,a=a.dispatch=_se.bind(null,Bt,a),[f.memoizedState,a]},useRef:function(a){var o=na();return a={current:a},o.memoizedState=a},useState:O3,useDebugValue:Ov,useDeferredValue:function(a){return na().memoizedState=a},useTransition:function(){var a=O3(!1),o=a[0];return a=Bse.bind(null,a[1]),na().memoizedState=a,[o,a]},useMutableSource:function(){},useSyncExternalStore:function(a,o,d){var f=Bt,b=na();if(At){if(d===void 0)throw Error(Se(407));d=d()}else{if(d=o(),Nn===null)throw Error(Se(349));$o&30||sG(f,o,d)}b.memoizedState=d;var x={value:d,getSnapshot:o};return b.queue=x,D3(iG.bind(null,f,x,a),[a]),f.flags|=2048,Kd(9,aG.bind(null,f,x,d,o),void 0,null),d},useId:function(){var a=na(),o=Nn.identifierPrefix;if(At){var d=Ea,f=Ra;d=(f&~(1<<32-Es(f)-1)).toString(32)+d,o=":"+o+"R"+d,d=Dd++,0<d&&(o+="H"+d.toString(32)),o+=":"}else d=Zse++,o=":"+o+"r"+d.toString(32)+":";return a.memoizedState=o},unstable_isNewReconciler:!1},jse={readContext:us,useCallback:fG,useContext:us,useEffect:Xv,useImperativeHandle:pG,useInsertionEffect:cG,useLayoutEffect:dG,useMemo:mG,useReducer:Bx,useRef:uG,useState:function(){return Bx(Ad)},useDebugValue:Ov,useDeferredValue:function(a){var o=cs();return gG(o,yn.memoizedState,a)},useTransition:function(){var a=Bx(Ad)[0],o=cs().memoizedState;return[a,o]},useMutableSource:nG,useSyncExternalStore:rG,useId:bG,unstable_isNewReconciler:!1},Yse={readContext:us,useCallback:fG,useContext:us,useEffect:Xv,useImperativeHandle:pG,useInsertionEffect:cG,useLayoutEffect:dG,useMemo:mG,useReducer:_x,useRef:uG,useState:function(){return _x(Ad)},useDebugValue:Ov,useDeferredValue:function(a){var o=cs();return yn===null?o.memoizedState=a:gG(o,yn.memoizedState,a)},useTransition:function(){var a=_x(Ad)[0],o=cs().memoizedState;return[a,o]},useMutableSource:nG,useSyncExternalStore:rG,useId:bG,unstable_isNewReconciler:!1};function Cs(a,o){if(a&&a.defaultProps){o=_t({},o),a=a.defaultProps;for(var d in a)o[d]===void 0&&(o[d]=a[d]);return o}return o}function $1(a,o,d,f){o=a.memoizedState,d=d(f,o),d=d==null?o:_t({},o,d),a.memoizedState=d,a.lanes===0&&(a.updateQueue.baseState=d)}var ng={isMounted:function(a){return(a=a._reactInternals)?Oo(a)===a:!1},enqueueSetState:function(a,o,d){a=a._reactInternals;var f=ar(),b=Ti(a),x=La(f,b);x.payload=o,d!=null&&(x.callback=d),o=Si(a,x,b),o!==null&&(Ls(o,a,b,f),om(o,a,b))},enqueueReplaceState:function(a,o,d){a=a._reactInternals;var f=ar(),b=Ti(a),x=La(f,b);x.tag=1,x.payload=o,d!=null&&(x.callback=d),o=Si(a,x,b),o!==null&&(Ls(o,a,b,f),om(o,a,b))},enqueueForceUpdate:function(a,o){a=a._reactInternals;var d=ar(),f=Ti(a),b=La(d,f);b.tag=2,o!=null&&(b.callback=o),o=Si(a,b,f),o!==null&&(Ls(o,a,f,d),om(o,a,f))}};function A3(a,o,d,f,b,x,k){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(f,x,k):o.prototype&&o.prototype.isPureReactComponent?!$d(d,f)||!$d(b,x):!0}function wG(a,o,d){var f=!1,b=Ei,x=o.contextType;return typeof x=="object"&&x!==null?x=us(x):(b=xr(o)?Wo:jn.current,f=o.contextTypes,x=(f=f!=null)?Ql(a,b):Ei),o=new o(d,x),a.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=ng,a.stateNode=o,o._reactInternals=a,f&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=b,a.__reactInternalMemoizedMaskedChildContext=x),o}function K3(a,o,d,f){a=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(d,f),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(d,f),o.state!==a&&ng.enqueueReplaceState(o,o.state,null)}function F1(a,o,d,f){var b=a.stateNode;b.props=d,b.state=a.memoizedState,b.refs={},zv(a);var x=o.contextType;typeof x=="object"&&x!==null?b.context=us(x):(x=xr(o)?Wo:jn.current,b.context=Ql(a,x)),b.state=a.memoizedState,x=o.getDerivedStateFromProps,typeof x=="function"&&($1(a,o,x,d),b.state=a.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(o=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),o!==b.state&&ng.enqueueReplaceState(b,b.state,null),Fm(a,d,b,f),b.state=a.memoizedState),typeof b.componentDidMount=="function"&&(a.flags|=4194308)}function tu(a,o){try{var d="",f=o;do d+=Sre(f),f=f.return;while(f);var b=d}catch(x){b=`
Error generating stack: `+x.message+`
`+x.stack}return{value:a,source:o,stack:b,digest:null}}function Hx(a,o,d){return{value:a,source:null,stack:d??null,digest:o??null}}function V1(a,o){try{console.error(o.value)}catch(d){setTimeout(function(){throw d})}}var Qse=typeof WeakMap=="function"?WeakMap:Map;function kG(a,o,d){d=La(-1,d),d.tag=3,d.payload={element:null};var f=o.value;return d.callback=function(){Dm||(Dm=!0,H1=f),V1(a,o)},d}function IG(a,o,d){d=La(-1,d),d.tag=3;var f=a.type.getDerivedStateFromError;if(typeof f=="function"){var b=o.value;d.payload=function(){return f(b)},d.callback=function(){V1(a,o)}}var x=a.stateNode;return x!==null&&typeof x.componentDidCatch=="function"&&(d.callback=function(){V1(a,o),typeof f!="function"&&(Ci===null?Ci=new Set([this]):Ci.add(this));var k=o.stack;this.componentDidCatch(o.value,{componentStack:k!==null?k:""})}),d}function Z3(a,o,d){var f=a.pingCache;if(f===null){f=a.pingCache=new Qse;var b=new Set;f.set(o,b)}else b=f.get(o),b===void 0&&(b=new Set,f.set(o,b));b.has(d)||(b.add(d),a=dae.bind(null,a,o,d),o.then(a,a))}function B3(a){do{var o;if((o=a.tag===13)&&(o=a.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return a;a=a.return}while(a!==null);return null}function _3(a,o,d,f,b){return a.mode&1?(a.flags|=65536,a.lanes=b,a):(a===o?a.flags|=65536:(a.flags|=128,d.flags|=131072,d.flags&=-52805,d.tag===1&&(d.alternate===null?d.tag=17:(o=La(-1,1),o.tag=2,Si(d,o,1))),d.lanes|=1),a)}var Jse=Pa.ReactCurrentOwner,br=!1;function sr(a,o,d,f){o.child=a===null?JL(o,null,d,f):ql(o,a.child,d,f)}function H3(a,o,d,f,b){d=d.render;var x=o.ref;return Ul(o,b),f=Vv(a,o,d,f,x,b),d=Pv(),a!==null&&!br?(o.updateQueue=a.updateQueue,o.flags&=-2053,a.lanes&=~b,$a(a,o,b)):(At&&d&&Cv(o),o.flags|=1,sr(a,o,f,b),o.child)}function U3(a,o,d,f,b){if(a===null){var x=d.type;return typeof x=="function"&&!Uv(x)&&x.defaultProps===void 0&&d.compare===null&&d.defaultProps===void 0?(o.tag=15,o.type=x,SG(a,o,x,f,b)):(a=pm(d.type,null,f,o,o.mode,b),a.ref=o.ref,a.return=o,o.child=a)}if(x=a.child,!(a.lanes&b)){var k=x.memoizedProps;if(d=d.compare,d=d!==null?d:$d,d(k,f)&&a.ref===o.ref)return $a(a,o,b)}return o.flags|=1,a=Ni(x,f),a.ref=o.ref,a.return=o,o.child=a}function SG(a,o,d,f,b){if(a!==null){var x=a.memoizedProps;if($d(x,f)&&a.ref===o.ref)if(br=!1,o.pendingProps=f=x,(a.lanes&b)!==0)a.flags&131072&&(br=!0);else return o.lanes=a.lanes,$a(a,o,b)}return P1(a,o,d,f,b)}function CG(a,o,d){var f=o.pendingProps,b=f.children,x=a!==null?a.memoizedState:null;if(f.mode==="hidden")if(!(o.mode&1))o.memoizedState={baseLanes:0,cachePool:null,transitions:null},Lt(Kl,Mr),Mr|=d;else{if(!(d&1073741824))return a=x!==null?x.baseLanes|d:d,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:a,cachePool:null,transitions:null},o.updateQueue=null,Lt(Kl,Mr),Mr|=a,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},f=x!==null?x.baseLanes:d,Lt(Kl,Mr),Mr|=f}else x!==null?(f=x.baseLanes|d,o.memoizedState=null):f=d,Lt(Kl,Mr),Mr|=f;return sr(a,o,b,d),o.child}function TG(a,o){var d=o.ref;(a===null&&d!==null||a!==null&&a.ref!==d)&&(o.flags|=512,o.flags|=2097152)}function P1(a,o,d,f,b){var x=xr(d)?Wo:jn.current;return x=Ql(o,x),Ul(o,b),d=Vv(a,o,d,f,x,b),f=Pv(),a!==null&&!br?(o.updateQueue=a.updateQueue,o.flags&=-2053,a.lanes&=~b,$a(a,o,b)):(At&&f&&Cv(o),o.flags|=1,sr(a,o,d,b),o.child)}function j3(a,o,d,f,b){if(xr(d)){var x=!0;Gm(o)}else x=!1;if(Ul(o,b),o.stateNode===null)cm(a,o),wG(o,d,f),F1(o,d,f,b),f=!0;else if(a===null){var k=o.stateNode,N=o.memoizedProps;k.props=N;var E=k.context,z=d.contextType;typeof z=="object"&&z!==null?z=us(z):(z=xr(d)?Wo:jn.current,z=Ql(o,z));var W=d.getDerivedStateFromProps,T=typeof W=="function"||typeof k.getSnapshotBeforeUpdate=="function";T||typeof k.UNSAFE_componentWillReceiveProps!="function"&&typeof k.componentWillReceiveProps!="function"||(N!==f||E!==z)&&K3(o,k,f,z),fi=!1;var A=o.memoizedState;k.state=A,Fm(o,f,k,b),E=o.memoizedState,N!==f||A!==E||yr.current||fi?(typeof W=="function"&&($1(o,d,W,f),E=o.memoizedState),(N=fi||A3(o,d,N,f,A,E,z))?(T||typeof k.UNSAFE_componentWillMount!="function"&&typeof k.componentWillMount!="function"||(typeof k.componentWillMount=="function"&&k.componentWillMount(),typeof k.UNSAFE_componentWillMount=="function"&&k.UNSAFE_componentWillMount()),typeof k.componentDidMount=="function"&&(o.flags|=4194308)):(typeof k.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=f,o.memoizedState=E),k.props=f,k.state=E,k.context=z,f=N):(typeof k.componentDidMount=="function"&&(o.flags|=4194308),f=!1)}else{k=o.stateNode,eG(a,o),N=o.memoizedProps,z=o.type===o.elementType?N:Cs(o.type,N),k.props=z,T=o.pendingProps,A=k.context,E=d.contextType,typeof E=="object"&&E!==null?E=us(E):(E=xr(d)?Wo:jn.current,E=Ql(o,E));var Y=d.getDerivedStateFromProps;(W=typeof Y=="function"||typeof k.getSnapshotBeforeUpdate=="function")||typeof k.UNSAFE_componentWillReceiveProps!="function"&&typeof k.componentWillReceiveProps!="function"||(N!==T||A!==E)&&K3(o,k,f,E),fi=!1,A=o.memoizedState,k.state=A,Fm(o,f,k,b);var M=o.memoizedState;N!==T||A!==M||yr.current||fi?(typeof Y=="function"&&($1(o,d,Y,f),M=o.memoizedState),(z=fi||A3(o,d,z,f,A,M,E)||!1)?(W||typeof k.UNSAFE_componentWillUpdate!="function"&&typeof k.componentWillUpdate!="function"||(typeof k.componentWillUpdate=="function"&&k.componentWillUpdate(f,M,E),typeof k.UNSAFE_componentWillUpdate=="function"&&k.UNSAFE_componentWillUpdate(f,M,E)),typeof k.componentDidUpdate=="function"&&(o.flags|=4),typeof k.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof k.componentDidUpdate!="function"||N===a.memoizedProps&&A===a.memoizedState||(o.flags|=4),typeof k.getSnapshotBeforeUpdate!="function"||N===a.memoizedProps&&A===a.memoizedState||(o.flags|=1024),o.memoizedProps=f,o.memoizedState=M),k.props=f,k.state=M,k.context=E,f=z):(typeof k.componentDidUpdate!="function"||N===a.memoizedProps&&A===a.memoizedState||(o.flags|=4),typeof k.getSnapshotBeforeUpdate!="function"||N===a.memoizedProps&&A===a.memoizedState||(o.flags|=1024),f=!1)}return X1(a,o,d,f,x,b)}function X1(a,o,d,f,b,x){TG(a,o);var k=(o.flags&128)!==0;if(!f&&!k)return b&&M3(o,d,!1),$a(a,o,x);f=o.stateNode,Jse.current=o;var N=k&&typeof d.getDerivedStateFromError!="function"?null:f.render();return o.flags|=1,a!==null&&k?(o.child=ql(o,a.child,null,x),o.child=ql(o,null,N,x)):sr(a,o,N,x),o.memoizedState=f.state,b&&M3(o,d,!0),o.child}function NG(a){var o=a.stateNode;o.pendingContext?W3(a,o.pendingContext,o.pendingContext!==o.context):o.context&&W3(a,o.context,!1),Wv(a,o.containerInfo)}function Y3(a,o,d,f,b){return Jl(),Nv(b),o.flags|=256,sr(a,o,d,f),o.child}var O1={dehydrated:null,treeContext:null,retryLane:0};function D1(a){return{baseLanes:a,cachePool:null,transitions:null}}function RG(a,o,d){var f=o.pendingProps,b=Zt.current,x=!1,k=(o.flags&128)!==0,N;if((N=k)||(N=a!==null&&a.memoizedState===null?!1:(b&2)!==0),N?(x=!0,o.flags&=-129):(a===null||a.memoizedState!==null)&&(b|=1),Lt(Zt,b&1),a===null)return W1(o),a=o.memoizedState,a!==null&&(a=a.dehydrated,a!==null)?(o.mode&1?a.data==="$!"?o.lanes=8:o.lanes=1073741824:o.lanes=1,null):(k=f.children,a=f.fallback,x?(f=o.mode,x=o.child,k={mode:"hidden",children:k},!(f&1)&&x!==null?(x.childLanes=0,x.pendingProps=k):x=ag(k,f,0,null),a=Go(a,f,d,null),x.return=o,a.return=o,x.sibling=a,o.child=x,o.child.memoizedState=D1(d),o.memoizedState=O1,a):Dv(o,k));if(b=a.memoizedState,b!==null&&(N=b.dehydrated,N!==null))return qse(a,o,k,f,N,b,d);if(x){x=f.fallback,k=o.mode,b=a.child,N=b.sibling;var E={mode:"hidden",children:f.children};return!(k&1)&&o.child!==b?(f=o.child,f.childLanes=0,f.pendingProps=E,o.deletions=null):(f=Ni(b,E),f.subtreeFlags=b.subtreeFlags&14680064),N!==null?x=Ni(N,x):(x=Go(x,k,d,null),x.flags|=2),x.return=o,f.return=o,f.sibling=x,o.child=f,f=x,x=o.child,k=a.child.memoizedState,k=k===null?D1(d):{baseLanes:k.baseLanes|d,cachePool:null,transitions:k.transitions},x.memoizedState=k,x.childLanes=a.childLanes&~d,o.memoizedState=O1,f}return x=a.child,a=x.sibling,f=Ni(x,{mode:"visible",children:f.children}),!(o.mode&1)&&(f.lanes=d),f.return=o,f.sibling=null,a!==null&&(d=o.deletions,d===null?(o.deletions=[a],o.flags|=16):d.push(a)),o.child=f,o.memoizedState=null,f}function Dv(a,o){return o=ag({mode:"visible",children:o},a.mode,0,null),o.return=a,a.child=o}function _f(a,o,d,f){return f!==null&&Nv(f),ql(o,a.child,null,d),a=Dv(o,o.pendingProps.children),a.flags|=2,o.memoizedState=null,a}function qse(a,o,d,f,b,x,k){if(d)return o.flags&256?(o.flags&=-257,f=Hx(Error(Se(422))),_f(a,o,k,f)):o.memoizedState!==null?(o.child=a.child,o.flags|=128,null):(x=f.fallback,b=o.mode,f=ag({mode:"visible",children:f.children},b,0,null),x=Go(x,b,k,null),x.flags|=2,f.return=o,x.return=o,f.sibling=x,o.child=f,o.mode&1&&ql(o,a.child,null,k),o.child.memoizedState=D1(k),o.memoizedState=O1,x);if(!(o.mode&1))return _f(a,o,k,null);if(b.data==="$!"){if(f=b.nextSibling&&b.nextSibling.dataset,f)var N=f.dgst;return f=N,x=Error(Se(419)),f=Hx(x,f,void 0),_f(a,o,k,f)}if(N=(k&a.childLanes)!==0,br||N){if(f=Nn,f!==null){switch(k&-k){case 4:b=2;break;case 16:b=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:b=32;break;case 536870912:b=268435456;break;default:b=0}b=b&(f.suspendedLanes|k)?0:b,b!==0&&b!==x.retryLane&&(x.retryLane=b,Ma(a,b),Ls(f,a,b,-1))}return Hv(),f=Hx(Error(Se(421))),_f(a,o,k,f)}return b.data==="$?"?(o.flags|=128,o.child=a.child,o=hae.bind(null,a),b._reactRetry=o,null):(a=x.treeContext,$r=Ii(b.nextSibling),Fr=o,At=!0,Ns=null,a!==null&&(as[is++]=Ra,as[is++]=Ea,as[is++]=Mo,Ra=a.id,Ea=a.overflow,Mo=o),o=Dv(o,f.children),o.flags|=4096,o)}function Q3(a,o,d){a.lanes|=o;var f=a.alternate;f!==null&&(f.lanes|=o),M1(a.return,o,d)}function Ux(a,o,d,f,b){var x=a.memoizedState;x===null?a.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:f,tail:d,tailMode:b}:(x.isBackwards=o,x.rendering=null,x.renderingStartTime=0,x.last=f,x.tail=d,x.tailMode=b)}function EG(a,o,d){var f=o.pendingProps,b=f.revealOrder,x=f.tail;if(sr(a,o,f.children,d),f=Zt.current,f&2)f=f&1|2,o.flags|=128;else{if(a!==null&&a.flags&128)e:for(a=o.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&Q3(a,d,o);else if(a.tag===19)Q3(a,d,o);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break e;for(;a.sibling===null;){if(a.return===null||a.return===o)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}f&=1}if(Lt(Zt,f),!(o.mode&1))o.memoizedState=null;else switch(b){case"forwards":for(d=o.child,b=null;d!==null;)a=d.alternate,a!==null&&Vm(a)===null&&(b=d),d=d.sibling;d=b,d===null?(b=o.child,o.child=null):(b=d.sibling,d.sibling=null),Ux(o,!1,b,d,x);break;case"backwards":for(d=null,b=o.child,o.child=null;b!==null;){if(a=b.alternate,a!==null&&Vm(a)===null){o.child=b;break}a=b.sibling,b.sibling=d,d=b,b=a}Ux(o,!0,d,null,x);break;case"together":Ux(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function cm(a,o){!(o.mode&1)&&a!==null&&(a.alternate=null,o.alternate=null,o.flags|=2)}function $a(a,o,d){if(a!==null&&(o.dependencies=a.dependencies),Fo|=o.lanes,!(d&o.childLanes))return null;if(a!==null&&o.child!==a.child)throw Error(Se(153));if(o.child!==null){for(a=o.child,d=Ni(a,a.pendingProps),o.child=d,d.return=o;a.sibling!==null;)a=a.sibling,d=d.sibling=Ni(a,a.pendingProps),d.return=o;d.sibling=null}return o.child}function eae(a,o,d){switch(o.tag){case 3:NG(o),Jl();break;case 5:tG(o);break;case 1:xr(o.type)&&Gm(o);break;case 4:Wv(o,o.stateNode.containerInfo);break;case 10:var f=o.type._context,b=o.memoizedProps.value;Lt(Mm,f._currentValue),f._currentValue=b;break;case 13:if(f=o.memoizedState,f!==null)return f.dehydrated!==null?(Lt(Zt,Zt.current&1),o.flags|=128,null):d&o.child.childLanes?RG(a,o,d):(Lt(Zt,Zt.current&1),a=$a(a,o,d),a!==null?a.sibling:null);Lt(Zt,Zt.current&1);break;case 19:if(f=(d&o.childLanes)!==0,a.flags&128){if(f)return EG(a,o,d);o.flags|=128}if(b=o.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),Lt(Zt,Zt.current),f)break;return null;case 22:case 23:return o.lanes=0,CG(a,o,d)}return $a(a,o,d)}var LG,A1,GG,zG;LG=function(a,o){for(var d=o.child;d!==null;){if(d.tag===5||d.tag===6)a.appendChild(d.stateNode);else if(d.tag!==4&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===o)break;for(;d.sibling===null;){if(d.return===null||d.return===o)return;d=d.return}d.sibling.return=d.return,d=d.sibling}};A1=function(){};GG=function(a,o,d,f){var b=a.memoizedProps;if(b!==f){a=o.stateNode,Ro(ua.current);var x=null;switch(d){case"input":b=c1(a,b),f=c1(a,f),x=[];break;case"select":b=_t({},b,{value:void 0}),f=_t({},f,{value:void 0}),x=[];break;case"textarea":b=p1(a,b),f=p1(a,f),x=[];break;default:typeof b.onClick!="function"&&typeof f.onClick=="function"&&(a.onclick=Em)}m1(d,f);var k;d=null;for(z in b)if(!f.hasOwnProperty(z)&&b.hasOwnProperty(z)&&b[z]!=null)if(z==="style"){var N=b[z];for(k in N)N.hasOwnProperty(k)&&(d||(d={}),d[k]="")}else z!=="dangerouslySetInnerHTML"&&z!=="children"&&z!=="suppressContentEditableWarning"&&z!=="suppressHydrationWarning"&&z!=="autoFocus"&&(Rd.hasOwnProperty(z)?x||(x=[]):(x=x||[]).push(z,null));for(z in f){var E=f[z];if(N=b!=null?b[z]:void 0,f.hasOwnProperty(z)&&E!==N&&(E!=null||N!=null))if(z==="style")if(N){for(k in N)!N.hasOwnProperty(k)||E&&E.hasOwnProperty(k)||(d||(d={}),d[k]="");for(k in E)E.hasOwnProperty(k)&&N[k]!==E[k]&&(d||(d={}),d[k]=E[k])}else d||(x||(x=[]),x.push(z,d)),d=E;else z==="dangerouslySetInnerHTML"?(E=E?E.__html:void 0,N=N?N.__html:void 0,E!=null&&N!==E&&(x=x||[]).push(z,E)):z==="children"?typeof E!="string"&&typeof E!="number"||(x=x||[]).push(z,""+E):z!=="suppressContentEditableWarning"&&z!=="suppressHydrationWarning"&&(Rd.hasOwnProperty(z)?(E!=null&&z==="onScroll"&&$t("scroll",a),x||N===E||(x=[])):(x=x||[]).push(z,E))}d&&(x=x||[]).push("style",d);var z=x;(o.updateQueue=z)&&(o.flags|=4)}};zG=function(a,o,d,f){d!==f&&(o.flags|=4)};function dd(a,o){if(!At)switch(a.tailMode){case"hidden":o=a.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?a.tail=null:d.sibling=null;break;case"collapsed":d=a.tail;for(var f=null;d!==null;)d.alternate!==null&&(f=d),d=d.sibling;f===null?o||a.tail===null?a.tail=null:a.tail.sibling=null:f.sibling=null}}function _n(a){var o=a.alternate!==null&&a.alternate.child===a.child,d=0,f=0;if(o)for(var b=a.child;b!==null;)d|=b.lanes|b.childLanes,f|=b.subtreeFlags&14680064,f|=b.flags&14680064,b.return=a,b=b.sibling;else for(b=a.child;b!==null;)d|=b.lanes|b.childLanes,f|=b.subtreeFlags,f|=b.flags,b.return=a,b=b.sibling;return a.subtreeFlags|=f,a.childLanes=d,o}function tae(a,o,d){var f=o.pendingProps;switch(Tv(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return _n(o),null;case 1:return xr(o.type)&&Lm(),_n(o),null;case 3:return f=o.stateNode,eu(),Ft(yr),Ft(jn),$v(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(a===null||a.child===null)&&(Zf(o)?o.flags|=4:a===null||a.memoizedState.isDehydrated&&!(o.flags&256)||(o.flags|=1024,Ns!==null&&(Y1(Ns),Ns=null))),A1(a,o),_n(o),null;case 5:Mv(o);var b=Ro(Od.current);if(d=o.type,a!==null&&o.stateNode!=null)GG(a,o,d,f,b),a.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!f){if(o.stateNode===null)throw Error(Se(166));return _n(o),null}if(a=Ro(ua.current),Zf(o)){f=o.stateNode,d=o.type;var x=o.memoizedProps;switch(f[ra]=o,f[Pd]=x,a=(o.mode&1)!==0,d){case"dialog":$t("cancel",f),$t("close",f);break;case"iframe":case"object":case"embed":$t("load",f);break;case"video":case"audio":for(b=0;b<yd.length;b++)$t(yd[b],f);break;case"source":$t("error",f);break;case"img":case"image":case"link":$t("error",f),$t("load",f);break;case"details":$t("toggle",f);break;case"input":i3(f,x),$t("invalid",f);break;case"select":f._wrapperState={wasMultiple:!!x.multiple},$t("invalid",f);break;case"textarea":l3(f,x),$t("invalid",f)}m1(d,x),b=null;for(var k in x)if(x.hasOwnProperty(k)){var N=x[k];k==="children"?typeof N=="string"?f.textContent!==N&&(x.suppressHydrationWarning!==!0&&Kf(f.textContent,N,a),b=["children",N]):typeof N=="number"&&f.textContent!==""+N&&(x.suppressHydrationWarning!==!0&&Kf(f.textContent,N,a),b=["children",""+N]):Rd.hasOwnProperty(k)&&N!=null&&k==="onScroll"&&$t("scroll",f)}switch(d){case"input":$f(f),o3(f,x,!0);break;case"textarea":$f(f),u3(f);break;case"select":case"option":break;default:typeof x.onClick=="function"&&(f.onclick=Em)}f=b,o.updateQueue=f,f!==null&&(o.flags|=4)}else{k=b.nodeType===9?b:b.ownerDocument,a==="http://www.w3.org/1999/xhtml"&&(a=iL(d)),a==="http://www.w3.org/1999/xhtml"?d==="script"?(a=k.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):typeof f.is=="string"?a=k.createElement(d,{is:f.is}):(a=k.createElement(d),d==="select"&&(k=a,f.multiple?k.multiple=!0:f.size&&(k.size=f.size))):a=k.createElementNS(a,d),a[ra]=o,a[Pd]=f,LG(a,o,!1,!1),o.stateNode=a;e:{switch(k=g1(d,f),d){case"dialog":$t("cancel",a),$t("close",a),b=f;break;case"iframe":case"object":case"embed":$t("load",a),b=f;break;case"video":case"audio":for(b=0;b<yd.length;b++)$t(yd[b],a);b=f;break;case"source":$t("error",a),b=f;break;case"img":case"image":case"link":$t("error",a),$t("load",a),b=f;break;case"details":$t("toggle",a),b=f;break;case"input":i3(a,f),b=c1(a,f),$t("invalid",a);break;case"option":b=f;break;case"select":a._wrapperState={wasMultiple:!!f.multiple},b=_t({},f,{value:void 0}),$t("invalid",a);break;case"textarea":l3(a,f),b=p1(a,f),$t("invalid",a);break;default:b=f}m1(d,b),N=b;for(x in N)if(N.hasOwnProperty(x)){var E=N[x];x==="style"?uL(a,E):x==="dangerouslySetInnerHTML"?(E=E?E.__html:void 0,E!=null&&oL(a,E)):x==="children"?typeof E=="string"?(d!=="textarea"||E!=="")&&Ed(a,E):typeof E=="number"&&Ed(a,""+E):x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&x!=="autoFocus"&&(Rd.hasOwnProperty(x)?E!=null&&x==="onScroll"&&$t("scroll",a):E!=null&&dv(a,x,E,k))}switch(d){case"input":$f(a),o3(a,f,!1);break;case"textarea":$f(a),u3(a);break;case"option":f.value!=null&&a.setAttribute("value",""+Ri(f.value));break;case"select":a.multiple=!!f.multiple,x=f.value,x!=null?Zl(a,!!f.multiple,x,!1):f.defaultValue!=null&&Zl(a,!!f.multiple,f.defaultValue,!0);break;default:typeof b.onClick=="function"&&(a.onclick=Em)}switch(d){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}}f&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return _n(o),null;case 6:if(a&&o.stateNode!=null)zG(a,o,a.memoizedProps,f);else{if(typeof f!="string"&&o.stateNode===null)throw Error(Se(166));if(d=Ro(Od.current),Ro(ua.current),Zf(o)){if(f=o.stateNode,d=o.memoizedProps,f[ra]=o,(x=f.nodeValue!==d)&&(a=Fr,a!==null))switch(a.tag){case 3:Kf(f.nodeValue,d,(a.mode&1)!==0);break;case 5:a.memoizedProps.suppressHydrationWarning!==!0&&Kf(f.nodeValue,d,(a.mode&1)!==0)}x&&(o.flags|=4)}else f=(d.nodeType===9?d:d.ownerDocument).createTextNode(f),f[ra]=o,o.stateNode=f}return _n(o),null;case 13:if(Ft(Zt),f=o.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(At&&$r!==null&&o.mode&1&&!(o.flags&128))YL(),Jl(),o.flags|=98560,x=!1;else if(x=Zf(o),f!==null&&f.dehydrated!==null){if(a===null){if(!x)throw Error(Se(318));if(x=o.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(Se(317));x[ra]=o}else Jl(),!(o.flags&128)&&(o.memoizedState=null),o.flags|=4;_n(o),x=!1}else Ns!==null&&(Y1(Ns),Ns=null),x=!0;if(!x)return o.flags&65536?o:null}return o.flags&128?(o.lanes=d,o):(f=f!==null,f!==(a!==null&&a.memoizedState!==null)&&f&&(o.child.flags|=8192,o.mode&1&&(a===null||Zt.current&1?vn===0&&(vn=3):Hv())),o.updateQueue!==null&&(o.flags|=4),_n(o),null);case 4:return eu(),A1(a,o),a===null&&Fd(o.stateNode.containerInfo),_n(o),null;case 10:return Lv(o.type._context),_n(o),null;case 17:return xr(o.type)&&Lm(),_n(o),null;case 19:if(Ft(Zt),x=o.memoizedState,x===null)return _n(o),null;if(f=(o.flags&128)!==0,k=x.rendering,k===null)if(f)dd(x,!1);else{if(vn!==0||a!==null&&a.flags&128)for(a=o.child;a!==null;){if(k=Vm(a),k!==null){for(o.flags|=128,dd(x,!1),f=k.updateQueue,f!==null&&(o.updateQueue=f,o.flags|=4),o.subtreeFlags=0,f=d,d=o.child;d!==null;)x=d,a=f,x.flags&=14680066,k=x.alternate,k===null?(x.childLanes=0,x.lanes=a,x.child=null,x.subtreeFlags=0,x.memoizedProps=null,x.memoizedState=null,x.updateQueue=null,x.dependencies=null,x.stateNode=null):(x.childLanes=k.childLanes,x.lanes=k.lanes,x.child=k.child,x.subtreeFlags=0,x.deletions=null,x.memoizedProps=k.memoizedProps,x.memoizedState=k.memoizedState,x.updateQueue=k.updateQueue,x.type=k.type,a=k.dependencies,x.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),d=d.sibling;return Lt(Zt,Zt.current&1|2),o.child}a=a.sibling}x.tail!==null&&sn()>nu&&(o.flags|=128,f=!0,dd(x,!1),o.lanes=4194304)}else{if(!f)if(a=Vm(k),a!==null){if(o.flags|=128,f=!0,d=a.updateQueue,d!==null&&(o.updateQueue=d,o.flags|=4),dd(x,!0),x.tail===null&&x.tailMode==="hidden"&&!k.alternate&&!At)return _n(o),null}else 2*sn()-x.renderingStartTime>nu&&d!==1073741824&&(o.flags|=128,f=!0,dd(x,!1),o.lanes=4194304);x.isBackwards?(k.sibling=o.child,o.child=k):(d=x.last,d!==null?d.sibling=k:o.child=k,x.last=k)}return x.tail!==null?(o=x.tail,x.rendering=o,x.tail=o.sibling,x.renderingStartTime=sn(),o.sibling=null,d=Zt.current,Lt(Zt,f?d&1|2:d&1),o):(_n(o),null);case 22:case 23:return _v(),f=o.memoizedState!==null,a!==null&&a.memoizedState!==null!==f&&(o.flags|=8192),f&&o.mode&1?Mr&1073741824&&(_n(o),o.subtreeFlags&6&&(o.flags|=8192)):_n(o),null;case 24:return null;case 25:return null}throw Error(Se(156,o.tag))}function nae(a,o){switch(Tv(o),o.tag){case 1:return xr(o.type)&&Lm(),a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 3:return eu(),Ft(yr),Ft(jn),$v(),a=o.flags,a&65536&&!(a&128)?(o.flags=a&-65537|128,o):null;case 5:return Mv(o),null;case 13:if(Ft(Zt),a=o.memoizedState,a!==null&&a.dehydrated!==null){if(o.alternate===null)throw Error(Se(340));Jl()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 19:return Ft(Zt),null;case 4:return eu(),null;case 10:return Lv(o.type._context),null;case 22:case 23:return _v(),null;case 24:return null;default:return null}}var Hf=!1,Hn=!1,rae=typeof WeakSet=="function"?WeakSet:Set,Me=null;function Al(a,o){var d=a.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(f){tn(a,o,f)}else d.current=null}function K1(a,o,d){try{d()}catch(f){tn(a,o,f)}}var J3=!1;function sae(a,o){if(T1=Tm,a=VL(),Sv(a)){if("selectionStart"in a)var d={start:a.selectionStart,end:a.selectionEnd};else e:{d=(d=a.ownerDocument)&&d.defaultView||window;var f=d.getSelection&&d.getSelection();if(f&&f.rangeCount!==0){d=f.anchorNode;var b=f.anchorOffset,x=f.focusNode;f=f.focusOffset;try{d.nodeType,x.nodeType}catch{d=null;break e}var k=0,N=-1,E=-1,z=0,W=0,T=a,A=null;t:for(;;){for(var Y;T!==d||b!==0&&T.nodeType!==3||(N=k+b),T!==x||f!==0&&T.nodeType!==3||(E=k+f),T.nodeType===3&&(k+=T.nodeValue.length),(Y=T.firstChild)!==null;)A=T,T=Y;for(;;){if(T===a)break t;if(A===d&&++z===b&&(N=k),A===x&&++W===f&&(E=k),(Y=T.nextSibling)!==null)break;T=A,A=T.parentNode}T=Y}d=N===-1||E===-1?null:{start:N,end:E}}else d=null}d=d||{start:0,end:0}}else d=null;for(N1={focusedElem:a,selectionRange:d},Tm=!1,Me=o;Me!==null;)if(o=Me,a=o.child,(o.subtreeFlags&1028)!==0&&a!==null)a.return=o,Me=a;else for(;Me!==null;){o=Me;try{var M=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(M!==null){var B=M.memoizedProps,H=M.memoizedState,O=o.stateNode,P=O.getSnapshotBeforeUpdate(o.elementType===o.type?B:Cs(o.type,B),H);O.__reactInternalSnapshotBeforeUpdate=P}break;case 3:var X=o.stateNode.containerInfo;X.nodeType===1?X.textContent="":X.nodeType===9&&X.documentElement&&X.removeChild(X.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Se(163))}}catch(ie){tn(o,o.return,ie)}if(a=o.sibling,a!==null){a.return=o.return,Me=a;break}Me=o.return}return M=J3,J3=!1,M}function Cd(a,o,d){var f=o.updateQueue;if(f=f!==null?f.lastEffect:null,f!==null){var b=f=f.next;do{if((b.tag&a)===a){var x=b.destroy;b.destroy=void 0,x!==void 0&&K1(o,d,x)}b=b.next}while(b!==f)}}function rg(a,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var d=o=o.next;do{if((d.tag&a)===a){var f=d.create;d.destroy=f()}d=d.next}while(d!==o)}}function Z1(a){var o=a.ref;if(o!==null){var d=a.stateNode;switch(a.tag){case 5:a=d;break;default:a=d}typeof o=="function"?o(a):o.current=a}}function WG(a){var o=a.alternate;o!==null&&(a.alternate=null,WG(o)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(o=a.stateNode,o!==null&&(delete o[ra],delete o[Pd],delete o[L1],delete o[Ose],delete o[Dse])),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}function MG(a){return a.tag===5||a.tag===3||a.tag===4}function q3(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||MG(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function B1(a,o,d){var f=a.tag;if(f===5||f===6)a=a.stateNode,o?d.nodeType===8?d.parentNode.insertBefore(a,o):d.insertBefore(a,o):(d.nodeType===8?(o=d.parentNode,o.insertBefore(a,d)):(o=d,o.appendChild(a)),d=d._reactRootContainer,d!=null||o.onclick!==null||(o.onclick=Em));else if(f!==4&&(a=a.child,a!==null))for(B1(a,o,d),a=a.sibling;a!==null;)B1(a,o,d),a=a.sibling}function _1(a,o,d){var f=a.tag;if(f===5||f===6)a=a.stateNode,o?d.insertBefore(a,o):d.appendChild(a);else if(f!==4&&(a=a.child,a!==null))for(_1(a,o,d),a=a.sibling;a!==null;)_1(a,o,d),a=a.sibling}var Gn=null,Ts=!1;function di(a,o,d){for(d=d.child;d!==null;)$G(a,o,d),d=d.sibling}function $G(a,o,d){if(la&&typeof la.onCommitFiberUnmount=="function")try{la.onCommitFiberUnmount(jm,d)}catch{}switch(d.tag){case 5:Hn||Al(d,o);case 6:var f=Gn,b=Ts;Gn=null,di(a,o,d),Gn=f,Ts=b,Gn!==null&&(Ts?(a=Gn,d=d.stateNode,a.nodeType===8?a.parentNode.removeChild(d):a.removeChild(d)):Gn.removeChild(d.stateNode));break;case 18:Gn!==null&&(Ts?(a=Gn,d=d.stateNode,a.nodeType===8?Dx(a.parentNode,d):a.nodeType===1&&Dx(a,d),Wd(a)):Dx(Gn,d.stateNode));break;case 4:f=Gn,b=Ts,Gn=d.stateNode.containerInfo,Ts=!0,di(a,o,d),Gn=f,Ts=b;break;case 0:case 11:case 14:case 15:if(!Hn&&(f=d.updateQueue,f!==null&&(f=f.lastEffect,f!==null))){b=f=f.next;do{var x=b,k=x.destroy;x=x.tag,k!==void 0&&(x&2||x&4)&&K1(d,o,k),b=b.next}while(b!==f)}di(a,o,d);break;case 1:if(!Hn&&(Al(d,o),f=d.stateNode,typeof f.componentWillUnmount=="function"))try{f.props=d.memoizedProps,f.state=d.memoizedState,f.componentWillUnmount()}catch(N){tn(d,o,N)}di(a,o,d);break;case 21:di(a,o,d);break;case 22:d.mode&1?(Hn=(f=Hn)||d.memoizedState!==null,di(a,o,d),Hn=f):di(a,o,d);break;default:di(a,o,d)}}function eE(a){var o=a.updateQueue;if(o!==null){a.updateQueue=null;var d=a.stateNode;d===null&&(d=a.stateNode=new rae),o.forEach(function(f){var b=pae.bind(null,a,f);d.has(f)||(d.add(f),f.then(b,b))})}}function Ss(a,o){var d=o.deletions;if(d!==null)for(var f=0;f<d.length;f++){var b=d[f];try{var x=a,k=o,N=k;e:for(;N!==null;){switch(N.tag){case 5:Gn=N.stateNode,Ts=!1;break e;case 3:Gn=N.stateNode.containerInfo,Ts=!0;break e;case 4:Gn=N.stateNode.containerInfo,Ts=!0;break e}N=N.return}if(Gn===null)throw Error(Se(160));$G(x,k,b),Gn=null,Ts=!1;var E=b.alternate;E!==null&&(E.return=null),b.return=null}catch(z){tn(b,o,z)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)FG(o,a),o=o.sibling}function FG(a,o){var d=a.alternate,f=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:if(Ss(o,a),ta(a),f&4){try{Cd(3,a,a.return),rg(3,a)}catch(B){tn(a,a.return,B)}try{Cd(5,a,a.return)}catch(B){tn(a,a.return,B)}}break;case 1:Ss(o,a),ta(a),f&512&&d!==null&&Al(d,d.return);break;case 5:if(Ss(o,a),ta(a),f&512&&d!==null&&Al(d,d.return),a.flags&32){var b=a.stateNode;try{Ed(b,"")}catch(B){tn(a,a.return,B)}}if(f&4&&(b=a.stateNode,b!=null)){var x=a.memoizedProps,k=d!==null?d.memoizedProps:x,N=a.type,E=a.updateQueue;if(a.updateQueue=null,E!==null)try{N==="input"&&x.type==="radio"&&x.name!=null&&sL(b,x),g1(N,k);var z=g1(N,x);for(k=0;k<E.length;k+=2){var W=E[k],T=E[k+1];W==="style"?uL(b,T):W==="dangerouslySetInnerHTML"?oL(b,T):W==="children"?Ed(b,T):dv(b,W,T,z)}switch(N){case"input":d1(b,x);break;case"textarea":aL(b,x);break;case"select":var A=b._wrapperState.wasMultiple;b._wrapperState.wasMultiple=!!x.multiple;var Y=x.value;Y!=null?Zl(b,!!x.multiple,Y,!1):A!==!!x.multiple&&(x.defaultValue!=null?Zl(b,!!x.multiple,x.defaultValue,!0):Zl(b,!!x.multiple,x.multiple?[]:"",!1))}b[Pd]=x}catch(B){tn(a,a.return,B)}}break;case 6:if(Ss(o,a),ta(a),f&4){if(a.stateNode===null)throw Error(Se(162));b=a.stateNode,x=a.memoizedProps;try{b.nodeValue=x}catch(B){tn(a,a.return,B)}}break;case 3:if(Ss(o,a),ta(a),f&4&&d!==null&&d.memoizedState.isDehydrated)try{Wd(o.containerInfo)}catch(B){tn(a,a.return,B)}break;case 4:Ss(o,a),ta(a);break;case 13:Ss(o,a),ta(a),b=a.child,b.flags&8192&&(x=b.memoizedState!==null,b.stateNode.isHidden=x,!x||b.alternate!==null&&b.alternate.memoizedState!==null||(Zv=sn())),f&4&&eE(a);break;case 22:if(W=d!==null&&d.memoizedState!==null,a.mode&1?(Hn=(z=Hn)||W,Ss(o,a),Hn=z):Ss(o,a),ta(a),f&8192){if(z=a.memoizedState!==null,(a.stateNode.isHidden=z)&&!W&&a.mode&1)for(Me=a,W=a.child;W!==null;){for(T=Me=W;Me!==null;){switch(A=Me,Y=A.child,A.tag){case 0:case 11:case 14:case 15:Cd(4,A,A.return);break;case 1:Al(A,A.return);var M=A.stateNode;if(typeof M.componentWillUnmount=="function"){f=A,d=A.return;try{o=f,M.props=o.memoizedProps,M.state=o.memoizedState,M.componentWillUnmount()}catch(B){tn(f,d,B)}}break;case 5:Al(A,A.return);break;case 22:if(A.memoizedState!==null){nE(T);continue}}Y!==null?(Y.return=A,Me=Y):nE(T)}W=W.sibling}e:for(W=null,T=a;;){if(T.tag===5){if(W===null){W=T;try{b=T.stateNode,z?(x=b.style,typeof x.setProperty=="function"?x.setProperty("display","none","important"):x.display="none"):(N=T.stateNode,E=T.memoizedProps.style,k=E!=null&&E.hasOwnProperty("display")?E.display:null,N.style.display=lL("display",k))}catch(B){tn(a,a.return,B)}}}else if(T.tag===6){if(W===null)try{T.stateNode.nodeValue=z?"":T.memoizedProps}catch(B){tn(a,a.return,B)}}else if((T.tag!==22&&T.tag!==23||T.memoizedState===null||T===a)&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===a)break e;for(;T.sibling===null;){if(T.return===null||T.return===a)break e;W===T&&(W=null),T=T.return}W===T&&(W=null),T.sibling.return=T.return,T=T.sibling}}break;case 19:Ss(o,a),ta(a),f&4&&eE(a);break;case 21:break;default:Ss(o,a),ta(a)}}function ta(a){var o=a.flags;if(o&2){try{e:{for(var d=a.return;d!==null;){if(MG(d)){var f=d;break e}d=d.return}throw Error(Se(160))}switch(f.tag){case 5:var b=f.stateNode;f.flags&32&&(Ed(b,""),f.flags&=-33);var x=q3(a);_1(a,x,b);break;case 3:case 4:var k=f.stateNode.containerInfo,N=q3(a);B1(a,N,k);break;default:throw Error(Se(161))}}catch(E){tn(a,a.return,E)}a.flags&=-3}o&4096&&(a.flags&=-4097)}function aae(a,o,d){Me=a,VG(a)}function VG(a,o,d){for(var f=(a.mode&1)!==0;Me!==null;){var b=Me,x=b.child;if(b.tag===22&&f){var k=b.memoizedState!==null||Hf;if(!k){var N=b.alternate,E=N!==null&&N.memoizedState!==null||Hn;N=Hf;var z=Hn;if(Hf=k,(Hn=E)&&!z)for(Me=b;Me!==null;)k=Me,E=k.child,k.tag===22&&k.memoizedState!==null?rE(b):E!==null?(E.return=k,Me=E):rE(b);for(;x!==null;)Me=x,VG(x),x=x.sibling;Me=b,Hf=N,Hn=z}tE(a)}else b.subtreeFlags&8772&&x!==null?(x.return=b,Me=x):tE(a)}}function tE(a){for(;Me!==null;){var o=Me;if(o.flags&8772){var d=o.alternate;try{if(o.flags&8772)switch(o.tag){case 0:case 11:case 15:Hn||rg(5,o);break;case 1:var f=o.stateNode;if(o.flags&4&&!Hn)if(d===null)f.componentDidMount();else{var b=o.elementType===o.type?d.memoizedProps:Cs(o.type,d.memoizedProps);f.componentDidUpdate(b,d.memoizedState,f.__reactInternalSnapshotBeforeUpdate)}var x=o.updateQueue;x!==null&&X3(o,x,f);break;case 3:var k=o.updateQueue;if(k!==null){if(d=null,o.child!==null)switch(o.child.tag){case 5:d=o.child.stateNode;break;case 1:d=o.child.stateNode}X3(o,k,d)}break;case 5:var N=o.stateNode;if(d===null&&o.flags&4){d=N;var E=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":E.autoFocus&&d.focus();break;case"img":E.src&&(d.src=E.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var z=o.alternate;if(z!==null){var W=z.memoizedState;if(W!==null){var T=W.dehydrated;T!==null&&Wd(T)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Se(163))}Hn||o.flags&512&&Z1(o)}catch(A){tn(o,o.return,A)}}if(o===a){Me=null;break}if(d=o.sibling,d!==null){d.return=o.return,Me=d;break}Me=o.return}}function nE(a){for(;Me!==null;){var o=Me;if(o===a){Me=null;break}var d=o.sibling;if(d!==null){d.return=o.return,Me=d;break}Me=o.return}}function rE(a){for(;Me!==null;){var o=Me;try{switch(o.tag){case 0:case 11:case 15:var d=o.return;try{rg(4,o)}catch(E){tn(o,d,E)}break;case 1:var f=o.stateNode;if(typeof f.componentDidMount=="function"){var b=o.return;try{f.componentDidMount()}catch(E){tn(o,b,E)}}var x=o.return;try{Z1(o)}catch(E){tn(o,x,E)}break;case 5:var k=o.return;try{Z1(o)}catch(E){tn(o,k,E)}}}catch(E){tn(o,o.return,E)}if(o===a){Me=null;break}var N=o.sibling;if(N!==null){N.return=o.return,Me=N;break}Me=o.return}}var iae=Math.ceil,Om=Pa.ReactCurrentDispatcher,Av=Pa.ReactCurrentOwner,ls=Pa.ReactCurrentBatchConfig,ct=0,Nn=null,pn=null,Wn=0,Mr=0,Kl=Gi(0),vn=0,Zd=null,Fo=0,sg=0,Kv=0,Td=null,gr=null,Zv=0,nu=1/0,Ta=null,Dm=!1,H1=null,Ci=null,Uf=!1,xi=null,Am=0,Nd=0,U1=null,dm=-1,hm=0;function ar(){return ct&6?sn():dm!==-1?dm:dm=sn()}function Ti(a){return a.mode&1?ct&2&&Wn!==0?Wn&-Wn:Kse.transition!==null?(hm===0&&(hm=wL()),hm):(a=bt,a!==0||(a=window.event,a=a===void 0?16:RL(a.type)),a):1}function Ls(a,o,d,f){if(50<Nd)throw Nd=0,U1=null,Error(Se(185));Hd(a,d,f),(!(ct&2)||a!==Nn)&&(a===Nn&&(!(ct&2)&&(sg|=d),vn===4&&gi(a,Wn)),vr(a,f),d===1&&ct===0&&!(o.mode&1)&&(nu=sn()+500,eg&&zi()))}function vr(a,o){var d=a.callbackNode;Kre(a,o);var f=Cm(a,a===Nn?Wn:0);if(f===0)d!==null&&h3(d),a.callbackNode=null,a.callbackPriority=0;else if(o=f&-f,a.callbackPriority!==o){if(d!=null&&h3(d),o===1)a.tag===0?Ase(sE.bind(null,a)):HL(sE.bind(null,a)),Pse(function(){!(ct&6)&&zi()}),d=null;else{switch(kL(f)){case 1:d=gv;break;case 4:d=xL;break;case 16:d=Sm;break;case 536870912:d=vL;break;default:d=Sm}d=BG(d,PG.bind(null,a))}a.callbackPriority=o,a.callbackNode=d}}function PG(a,o){if(dm=-1,hm=0,ct&6)throw Error(Se(327));var d=a.callbackNode;if(jl()&&a.callbackNode!==d)return null;var f=Cm(a,a===Nn?Wn:0);if(f===0)return null;if(f&30||f&a.expiredLanes||o)o=Km(a,f);else{o=f;var b=ct;ct|=2;var x=OG();(Nn!==a||Wn!==o)&&(Ta=null,nu=sn()+500,Lo(a,o));do try{uae();break}catch(N){XG(a,N)}while(!0);Ev(),Om.current=x,ct=b,pn!==null?o=0:(Nn=null,Wn=0,o=vn)}if(o!==0){if(o===2&&(b=w1(a),b!==0&&(f=b,o=j1(a,b))),o===1)throw d=Zd,Lo(a,0),gi(a,f),vr(a,sn()),d;if(o===6)gi(a,f);else{if(b=a.current.alternate,!(f&30)&&!oae(b)&&(o=Km(a,f),o===2&&(x=w1(a),x!==0&&(f=x,o=j1(a,x))),o===1))throw d=Zd,Lo(a,0),gi(a,f),vr(a,sn()),d;switch(a.finishedWork=b,a.finishedLanes=f,o){case 0:case 1:throw Error(Se(345));case 2:Co(a,gr,Ta);break;case 3:if(gi(a,f),(f&130023424)===f&&(o=Zv+500-sn(),10<o)){if(Cm(a,0)!==0)break;if(b=a.suspendedLanes,(b&f)!==f){ar(),a.pingedLanes|=a.suspendedLanes&b;break}a.timeoutHandle=E1(Co.bind(null,a,gr,Ta),o);break}Co(a,gr,Ta);break;case 4:if(gi(a,f),(f&4194240)===f)break;for(o=a.eventTimes,b=-1;0<f;){var k=31-Es(f);x=1<<k,k=o[k],k>b&&(b=k),f&=~x}if(f=b,f=sn()-f,f=(120>f?120:480>f?480:1080>f?1080:1920>f?1920:3e3>f?3e3:4320>f?4320:1960*iae(f/1960))-f,10<f){a.timeoutHandle=E1(Co.bind(null,a,gr,Ta),f);break}Co(a,gr,Ta);break;case 5:Co(a,gr,Ta);break;default:throw Error(Se(329))}}}return vr(a,sn()),a.callbackNode===d?PG.bind(null,a):null}function j1(a,o){var d=Td;return a.current.memoizedState.isDehydrated&&(Lo(a,o).flags|=256),a=Km(a,o),a!==2&&(o=gr,gr=d,o!==null&&Y1(o)),a}function Y1(a){gr===null?gr=a:gr.push.apply(gr,a)}function oae(a){for(var o=a;;){if(o.flags&16384){var d=o.updateQueue;if(d!==null&&(d=d.stores,d!==null))for(var f=0;f<d.length;f++){var b=d[f],x=b.getSnapshot;b=b.value;try{if(!Gs(x(),b))return!1}catch{return!1}}}if(d=o.child,o.subtreeFlags&16384&&d!==null)d.return=o,o=d;else{if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function gi(a,o){for(o&=~Kv,o&=~sg,a.suspendedLanes|=o,a.pingedLanes&=~o,a=a.expirationTimes;0<o;){var d=31-Es(o),f=1<<d;a[d]=-1,o&=~f}}function sE(a){if(ct&6)throw Error(Se(327));jl();var o=Cm(a,0);if(!(o&1))return vr(a,sn()),null;var d=Km(a,o);if(a.tag!==0&&d===2){var f=w1(a);f!==0&&(o=f,d=j1(a,f))}if(d===1)throw d=Zd,Lo(a,0),gi(a,o),vr(a,sn()),d;if(d===6)throw Error(Se(345));return a.finishedWork=a.current.alternate,a.finishedLanes=o,Co(a,gr,Ta),vr(a,sn()),null}function Bv(a,o){var d=ct;ct|=1;try{return a(o)}finally{ct=d,ct===0&&(nu=sn()+500,eg&&zi())}}function Vo(a){xi!==null&&xi.tag===0&&!(ct&6)&&jl();var o=ct;ct|=1;var d=ls.transition,f=bt;try{if(ls.transition=null,bt=1,a)return a()}finally{bt=f,ls.transition=d,ct=o,!(ct&6)&&zi()}}function _v(){Mr=Kl.current,Ft(Kl)}function Lo(a,o){a.finishedWork=null,a.finishedLanes=0;var d=a.timeoutHandle;if(d!==-1&&(a.timeoutHandle=-1,Vse(d)),pn!==null)for(d=pn.return;d!==null;){var f=d;switch(Tv(f),f.tag){case 1:f=f.type.childContextTypes,f!=null&&Lm();break;case 3:eu(),Ft(yr),Ft(jn),$v();break;case 5:Mv(f);break;case 4:eu();break;case 13:Ft(Zt);break;case 19:Ft(Zt);break;case 10:Lv(f.type._context);break;case 22:case 23:_v()}d=d.return}if(Nn=a,pn=a=Ni(a.current,null),Wn=Mr=o,vn=0,Zd=null,Kv=sg=Fo=0,gr=Td=null,No!==null){for(o=0;o<No.length;o++)if(d=No[o],f=d.interleaved,f!==null){d.interleaved=null;var b=f.next,x=d.pending;if(x!==null){var k=x.next;x.next=b,f.next=k}d.pending=f}No=null}return a}function XG(a,o){do{var d=pn;try{if(Ev(),lm.current=Xm,Pm){for(var f=Bt.memoizedState;f!==null;){var b=f.queue;b!==null&&(b.pending=null),f=f.next}Pm=!1}if($o=0,Tn=yn=Bt=null,Sd=!1,Dd=0,Av.current=null,d===null||d.return===null){vn=1,Zd=o,pn=null;break}e:{var x=a,k=d.return,N=d,E=o;if(o=Wn,N.flags|=32768,E!==null&&typeof E=="object"&&typeof E.then=="function"){var z=E,W=N,T=W.tag;if(!(W.mode&1)&&(T===0||T===11||T===15)){var A=W.alternate;A?(W.updateQueue=A.updateQueue,W.memoizedState=A.memoizedState,W.lanes=A.lanes):(W.updateQueue=null,W.memoizedState=null)}var Y=B3(k);if(Y!==null){Y.flags&=-257,_3(Y,k,N,x,o),Y.mode&1&&Z3(x,z,o),o=Y,E=z;var M=o.updateQueue;if(M===null){var B=new Set;B.add(E),o.updateQueue=B}else M.add(E);break e}else{if(!(o&1)){Z3(x,z,o),Hv();break e}E=Error(Se(426))}}else if(At&&N.mode&1){var H=B3(k);if(H!==null){!(H.flags&65536)&&(H.flags|=256),_3(H,k,N,x,o),Nv(tu(E,N));break e}}x=E=tu(E,N),vn!==4&&(vn=2),Td===null?Td=[x]:Td.push(x),x=k;do{switch(x.tag){case 3:x.flags|=65536,o&=-o,x.lanes|=o;var O=kG(x,E,o);P3(x,O);break e;case 1:N=E;var P=x.type,X=x.stateNode;if(!(x.flags&128)&&(typeof P.getDerivedStateFromError=="function"||X!==null&&typeof X.componentDidCatch=="function"&&(Ci===null||!Ci.has(X)))){x.flags|=65536,o&=-o,x.lanes|=o;var ie=IG(x,N,o);P3(x,ie);break e}}x=x.return}while(x!==null)}AG(d)}catch(oe){o=oe,pn===d&&d!==null&&(pn=d=d.return);continue}break}while(!0)}function OG(){var a=Om.current;return Om.current=Xm,a===null?Xm:a}function Hv(){(vn===0||vn===3||vn===2)&&(vn=4),Nn===null||!(Fo&268435455)&&!(sg&268435455)||gi(Nn,Wn)}function Km(a,o){var d=ct;ct|=2;var f=OG();(Nn!==a||Wn!==o)&&(Ta=null,Lo(a,o));do try{lae();break}catch(b){XG(a,b)}while(!0);if(Ev(),ct=d,Om.current=f,pn!==null)throw Error(Se(261));return Nn=null,Wn=0,vn}function lae(){for(;pn!==null;)DG(pn)}function uae(){for(;pn!==null&&!Mre();)DG(pn)}function DG(a){var o=ZG(a.alternate,a,Mr);a.memoizedProps=a.pendingProps,o===null?AG(a):pn=o,Av.current=null}function AG(a){var o=a;do{var d=o.alternate;if(a=o.return,o.flags&32768){if(d=nae(d,o),d!==null){d.flags&=32767,pn=d;return}if(a!==null)a.flags|=32768,a.subtreeFlags=0,a.deletions=null;else{vn=6,pn=null;return}}else if(d=tae(d,o,Mr),d!==null){pn=d;return}if(o=o.sibling,o!==null){pn=o;return}pn=o=a}while(o!==null);vn===0&&(vn=5)}function Co(a,o,d){var f=bt,b=ls.transition;try{ls.transition=null,bt=1,cae(a,o,d,f)}finally{ls.transition=b,bt=f}return null}function cae(a,o,d,f){do jl();while(xi!==null);if(ct&6)throw Error(Se(327));d=a.finishedWork;var b=a.finishedLanes;if(d===null)return null;if(a.finishedWork=null,a.finishedLanes=0,d===a.current)throw Error(Se(177));a.callbackNode=null,a.callbackPriority=0;var x=d.lanes|d.childLanes;if(Zre(a,x),a===Nn&&(pn=Nn=null,Wn=0),!(d.subtreeFlags&2064)&&!(d.flags&2064)||Uf||(Uf=!0,BG(Sm,function(){return jl(),null})),x=(d.flags&15990)!==0,d.subtreeFlags&15990||x){x=ls.transition,ls.transition=null;var k=bt;bt=1;var N=ct;ct|=4,Av.current=null,sae(a,d),FG(d,a),Lse(N1),Tm=!!T1,N1=T1=null,a.current=d,aae(d),$re(),ct=N,bt=k,ls.transition=x}else a.current=d;if(Uf&&(Uf=!1,xi=a,Am=b),x=a.pendingLanes,x===0&&(Ci=null),Pre(d.stateNode),vr(a,sn()),o!==null)for(f=a.onRecoverableError,d=0;d<o.length;d++)b=o[d],f(b.value,{componentStack:b.stack,digest:b.digest});if(Dm)throw Dm=!1,a=H1,H1=null,a;return Am&1&&a.tag!==0&&jl(),x=a.pendingLanes,x&1?a===U1?Nd++:(Nd=0,U1=a):Nd=0,zi(),null}function jl(){if(xi!==null){var a=kL(Am),o=ls.transition,d=bt;try{if(ls.transition=null,bt=16>a?16:a,xi===null)var f=!1;else{if(a=xi,xi=null,Am=0,ct&6)throw Error(Se(331));var b=ct;for(ct|=4,Me=a.current;Me!==null;){var x=Me,k=x.child;if(Me.flags&16){var N=x.deletions;if(N!==null){for(var E=0;E<N.length;E++){var z=N[E];for(Me=z;Me!==null;){var W=Me;switch(W.tag){case 0:case 11:case 15:Cd(8,W,x)}var T=W.child;if(T!==null)T.return=W,Me=T;else for(;Me!==null;){W=Me;var A=W.sibling,Y=W.return;if(WG(W),W===z){Me=null;break}if(A!==null){A.return=Y,Me=A;break}Me=Y}}}var M=x.alternate;if(M!==null){var B=M.child;if(B!==null){M.child=null;do{var H=B.sibling;B.sibling=null,B=H}while(B!==null)}}Me=x}}if(x.subtreeFlags&2064&&k!==null)k.return=x,Me=k;else e:for(;Me!==null;){if(x=Me,x.flags&2048)switch(x.tag){case 0:case 11:case 15:Cd(9,x,x.return)}var O=x.sibling;if(O!==null){O.return=x.return,Me=O;break e}Me=x.return}}var P=a.current;for(Me=P;Me!==null;){k=Me;var X=k.child;if(k.subtreeFlags&2064&&X!==null)X.return=k,Me=X;else e:for(k=P;Me!==null;){if(N=Me,N.flags&2048)try{switch(N.tag){case 0:case 11:case 15:rg(9,N)}}catch(oe){tn(N,N.return,oe)}if(N===k){Me=null;break e}var ie=N.sibling;if(ie!==null){ie.return=N.return,Me=ie;break e}Me=N.return}}if(ct=b,zi(),la&&typeof la.onPostCommitFiberRoot=="function")try{la.onPostCommitFiberRoot(jm,a)}catch{}f=!0}return f}finally{bt=d,ls.transition=o}}return!1}function aE(a,o,d){o=tu(d,o),o=kG(a,o,1),a=Si(a,o,1),o=ar(),a!==null&&(Hd(a,1,o),vr(a,o))}function tn(a,o,d){if(a.tag===3)aE(a,a,d);else for(;o!==null;){if(o.tag===3){aE(o,a,d);break}else if(o.tag===1){var f=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Ci===null||!Ci.has(f))){a=tu(d,a),a=IG(o,a,1),o=Si(o,a,1),a=ar(),o!==null&&(Hd(o,1,a),vr(o,a));break}}o=o.return}}function dae(a,o,d){var f=a.pingCache;f!==null&&f.delete(o),o=ar(),a.pingedLanes|=a.suspendedLanes&d,Nn===a&&(Wn&d)===d&&(vn===4||vn===3&&(Wn&130023424)===Wn&&500>sn()-Zv?Lo(a,0):Kv|=d),vr(a,o)}function KG(a,o){o===0&&(a.mode&1?(o=Pf,Pf<<=1,!(Pf&130023424)&&(Pf=4194304)):o=1);var d=ar();a=Ma(a,o),a!==null&&(Hd(a,o,d),vr(a,d))}function hae(a){var o=a.memoizedState,d=0;o!==null&&(d=o.retryLane),KG(a,d)}function pae(a,o){var d=0;switch(a.tag){case 13:var f=a.stateNode,b=a.memoizedState;b!==null&&(d=b.retryLane);break;case 19:f=a.stateNode;break;default:throw Error(Se(314))}f!==null&&f.delete(o),KG(a,d)}var ZG;ZG=function(a,o,d){if(a!==null)if(a.memoizedProps!==o.pendingProps||yr.current)br=!0;else{if(!(a.lanes&d)&&!(o.flags&128))return br=!1,eae(a,o,d);br=!!(a.flags&131072)}else br=!1,At&&o.flags&1048576&&UL(o,Wm,o.index);switch(o.lanes=0,o.tag){case 2:var f=o.type;cm(a,o),a=o.pendingProps;var b=Ql(o,jn.current);Ul(o,d),b=Vv(null,o,f,a,b,d);var x=Pv();return o.flags|=1,typeof b=="object"&&b!==null&&typeof b.render=="function"&&b.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,xr(f)?(x=!0,Gm(o)):x=!1,o.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,zv(o),b.updater=ng,o.stateNode=b,b._reactInternals=o,F1(o,f,a,d),o=X1(null,o,f,!0,x,d)):(o.tag=0,At&&x&&Cv(o),sr(null,o,b,d),o=o.child),o;case 16:f=o.elementType;e:{switch(cm(a,o),a=o.pendingProps,b=f._init,f=b(f._payload),o.type=f,b=o.tag=mae(f),a=Cs(f,a),b){case 0:o=P1(null,o,f,a,d);break e;case 1:o=j3(null,o,f,a,d);break e;case 11:o=H3(null,o,f,a,d);break e;case 14:o=U3(null,o,f,Cs(f.type,a),d);break e}throw Error(Se(306,f,""))}return o;case 0:return f=o.type,b=o.pendingProps,b=o.elementType===f?b:Cs(f,b),P1(a,o,f,b,d);case 1:return f=o.type,b=o.pendingProps,b=o.elementType===f?b:Cs(f,b),j3(a,o,f,b,d);case 3:e:{if(NG(o),a===null)throw Error(Se(387));f=o.pendingProps,x=o.memoizedState,b=x.element,eG(a,o),Fm(o,f,null,d);var k=o.memoizedState;if(f=k.element,x.isDehydrated)if(x={element:f,isDehydrated:!1,cache:k.cache,pendingSuspenseBoundaries:k.pendingSuspenseBoundaries,transitions:k.transitions},o.updateQueue.baseState=x,o.memoizedState=x,o.flags&256){b=tu(Error(Se(423)),o),o=Y3(a,o,f,d,b);break e}else if(f!==b){b=tu(Error(Se(424)),o),o=Y3(a,o,f,d,b);break e}else for($r=Ii(o.stateNode.containerInfo.firstChild),Fr=o,At=!0,Ns=null,d=JL(o,null,f,d),o.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(Jl(),f===b){o=$a(a,o,d);break e}sr(a,o,f,d)}o=o.child}return o;case 5:return tG(o),a===null&&W1(o),f=o.type,b=o.pendingProps,x=a!==null?a.memoizedProps:null,k=b.children,R1(f,b)?k=null:x!==null&&R1(f,x)&&(o.flags|=32),TG(a,o),sr(a,o,k,d),o.child;case 6:return a===null&&W1(o),null;case 13:return RG(a,o,d);case 4:return Wv(o,o.stateNode.containerInfo),f=o.pendingProps,a===null?o.child=ql(o,null,f,d):sr(a,o,f,d),o.child;case 11:return f=o.type,b=o.pendingProps,b=o.elementType===f?b:Cs(f,b),H3(a,o,f,b,d);case 7:return sr(a,o,o.pendingProps,d),o.child;case 8:return sr(a,o,o.pendingProps.children,d),o.child;case 12:return sr(a,o,o.pendingProps.children,d),o.child;case 10:e:{if(f=o.type._context,b=o.pendingProps,x=o.memoizedProps,k=b.value,Lt(Mm,f._currentValue),f._currentValue=k,x!==null)if(Gs(x.value,k)){if(x.children===b.children&&!yr.current){o=$a(a,o,d);break e}}else for(x=o.child,x!==null&&(x.return=o);x!==null;){var N=x.dependencies;if(N!==null){k=x.child;for(var E=N.firstContext;E!==null;){if(E.context===f){if(x.tag===1){E=La(-1,d&-d),E.tag=2;var z=x.updateQueue;if(z!==null){z=z.shared;var W=z.pending;W===null?E.next=E:(E.next=W.next,W.next=E),z.pending=E}}x.lanes|=d,E=x.alternate,E!==null&&(E.lanes|=d),M1(x.return,d,o),N.lanes|=d;break}E=E.next}}else if(x.tag===10)k=x.type===o.type?null:x.child;else if(x.tag===18){if(k=x.return,k===null)throw Error(Se(341));k.lanes|=d,N=k.alternate,N!==null&&(N.lanes|=d),M1(k,d,o),k=x.sibling}else k=x.child;if(k!==null)k.return=x;else for(k=x;k!==null;){if(k===o){k=null;break}if(x=k.sibling,x!==null){x.return=k.return,k=x;break}k=k.return}x=k}sr(a,o,b.children,d),o=o.child}return o;case 9:return b=o.type,f=o.pendingProps.children,Ul(o,d),b=us(b),f=f(b),o.flags|=1,sr(a,o,f,d),o.child;case 14:return f=o.type,b=Cs(f,o.pendingProps),b=Cs(f.type,b),U3(a,o,f,b,d);case 15:return SG(a,o,o.type,o.pendingProps,d);case 17:return f=o.type,b=o.pendingProps,b=o.elementType===f?b:Cs(f,b),cm(a,o),o.tag=1,xr(f)?(a=!0,Gm(o)):a=!1,Ul(o,d),wG(o,f,b),F1(o,f,b,d),X1(null,o,f,!0,a,d);case 19:return EG(a,o,d);case 22:return CG(a,o,d)}throw Error(Se(156,o.tag))};function BG(a,o){return yL(a,o)}function fae(a,o,d,f){this.tag=a,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function os(a,o,d,f){return new fae(a,o,d,f)}function Uv(a){return a=a.prototype,!(!a||!a.isReactComponent)}function mae(a){if(typeof a=="function")return Uv(a)?1:0;if(a!=null){if(a=a.$$typeof,a===pv)return 11;if(a===fv)return 14}return 2}function Ni(a,o){var d=a.alternate;return d===null?(d=os(a.tag,o,a.key,a.mode),d.elementType=a.elementType,d.type=a.type,d.stateNode=a.stateNode,d.alternate=a,a.alternate=d):(d.pendingProps=o,d.type=a.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=a.flags&14680064,d.childLanes=a.childLanes,d.lanes=a.lanes,d.child=a.child,d.memoizedProps=a.memoizedProps,d.memoizedState=a.memoizedState,d.updateQueue=a.updateQueue,o=a.dependencies,d.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},d.sibling=a.sibling,d.index=a.index,d.ref=a.ref,d}function pm(a,o,d,f,b,x){var k=2;if(f=a,typeof a=="function")Uv(a)&&(k=1);else if(typeof a=="string")k=5;else e:switch(a){case Wl:return Go(d.children,b,x,o);case hv:k=8,b|=8;break;case i1:return a=os(12,d,o,b|2),a.elementType=i1,a.lanes=x,a;case o1:return a=os(13,d,o,b),a.elementType=o1,a.lanes=x,a;case l1:return a=os(19,d,o,b),a.elementType=l1,a.lanes=x,a;case tL:return ag(d,b,x,o);default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case qE:k=10;break e;case eL:k=9;break e;case pv:k=11;break e;case fv:k=14;break e;case pi:k=16,f=null;break e}throw Error(Se(130,a==null?a:typeof a,""))}return o=os(k,d,o,b),o.elementType=a,o.type=f,o.lanes=x,o}function Go(a,o,d,f){return a=os(7,a,f,o),a.lanes=d,a}function ag(a,o,d,f){return a=os(22,a,f,o),a.elementType=tL,a.lanes=d,a.stateNode={isHidden:!1},a}function jx(a,o,d){return a=os(6,a,null,o),a.lanes=d,a}function Yx(a,o,d){return o=os(4,a.children!==null?a.children:[],a.key,o),o.lanes=d,o.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},o}function gae(a,o,d,f,b){this.tag=o,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Lx(0),this.expirationTimes=Lx(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Lx(0),this.identifierPrefix=f,this.onRecoverableError=b,this.mutableSourceEagerHydrationData=null}function jv(a,o,d,f,b,x,k,N,E){return a=new gae(a,o,d,N,E),o===1?(o=1,x===!0&&(o|=8)):o=0,x=os(3,null,null,o),a.current=x,x.stateNode=a,x.memoizedState={element:f,isDehydrated:d,cache:null,transitions:null,pendingSuspenseBoundaries:null},zv(x),a}function bae(a,o,d){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:zl,key:f==null?null:""+f,children:a,containerInfo:o,implementation:d}}function _G(a){if(!a)return Ei;a=a._reactInternals;e:{if(Oo(a)!==a||a.tag!==1)throw Error(Se(170));var o=a;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(xr(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(Se(171))}if(a.tag===1){var d=a.type;if(xr(d))return _L(a,d,o)}return o}function HG(a,o,d,f,b,x,k,N,E){return a=jv(d,f,!0,a,b,x,k,N,E),a.context=_G(null),d=a.current,f=ar(),b=Ti(d),x=La(f,b),x.callback=o??null,Si(d,x,b),a.current.lanes=b,Hd(a,b,f),vr(a,f),a}function ig(a,o,d,f){var b=o.current,x=ar(),k=Ti(b);return d=_G(d),o.context===null?o.context=d:o.pendingContext=d,o=La(x,k),o.payload={element:a},f=f===void 0?null:f,f!==null&&(o.callback=f),a=Si(b,o,k),a!==null&&(Ls(a,b,k,x),om(a,b,k)),k}function Zm(a){if(a=a.current,!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function iE(a,o){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var d=a.retryLane;a.retryLane=d!==0&&d<o?d:o}}function Yv(a,o){iE(a,o),(a=a.alternate)&&iE(a,o)}function yae(){return null}var UG=typeof reportError=="function"?reportError:function(a){console.error(a)};function Qv(a){this._internalRoot=a}og.prototype.render=Qv.prototype.render=function(a){var o=this._internalRoot;if(o===null)throw Error(Se(409));ig(a,o,null,null)};og.prototype.unmount=Qv.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var o=a.containerInfo;Vo(function(){ig(null,a,null,null)}),o[Wa]=null}};function og(a){this._internalRoot=a}og.prototype.unstable_scheduleHydration=function(a){if(a){var o=CL();a={blockedOn:null,target:a,priority:o};for(var d=0;d<mi.length&&o!==0&&o<mi[d].priority;d++);mi.splice(d,0,a),d===0&&NL(a)}};function Jv(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function lg(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11&&(a.nodeType!==8||a.nodeValue!==" react-mount-point-unstable "))}function oE(){}function xae(a,o,d,f,b){if(b){if(typeof f=="function"){var x=f;f=function(){var z=Zm(k);x.call(z)}}var k=HG(o,f,a,0,null,!1,!1,"",oE);return a._reactRootContainer=k,a[Wa]=k.current,Fd(a.nodeType===8?a.parentNode:a),Vo(),k}for(;b=a.lastChild;)a.removeChild(b);if(typeof f=="function"){var N=f;f=function(){var z=Zm(E);N.call(z)}}var E=jv(a,0,!1,null,null,!1,!1,"",oE);return a._reactRootContainer=E,a[Wa]=E.current,Fd(a.nodeType===8?a.parentNode:a),Vo(function(){ig(o,E,d,f)}),E}function ug(a,o,d,f,b){var x=d._reactRootContainer;if(x){var k=x;if(typeof b=="function"){var N=b;b=function(){var E=Zm(k);N.call(E)}}ig(o,k,a,b)}else k=xae(d,o,a,b,f);return Zm(k)}IL=function(a){switch(a.tag){case 3:var o=a.stateNode;if(o.current.memoizedState.isDehydrated){var d=bd(o.pendingLanes);d!==0&&(bv(o,d|1),vr(o,sn()),!(ct&6)&&(nu=sn()+500,zi()))}break;case 13:Vo(function(){var f=Ma(a,1);if(f!==null){var b=ar();Ls(f,a,1,b)}}),Yv(a,1)}};yv=function(a){if(a.tag===13){var o=Ma(a,134217728);if(o!==null){var d=ar();Ls(o,a,134217728,d)}Yv(a,134217728)}};SL=function(a){if(a.tag===13){var o=Ti(a),d=Ma(a,o);if(d!==null){var f=ar();Ls(d,a,o,f)}Yv(a,o)}};CL=function(){return bt};TL=function(a,o){var d=bt;try{return bt=a,o()}finally{bt=d}};y1=function(a,o,d){switch(o){case"input":if(d1(a,d),o=d.name,d.type==="radio"&&o!=null){for(d=a;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<d.length;o++){var f=d[o];if(f!==a&&f.form===a.form){var b=qm(f);if(!b)throw Error(Se(90));rL(f),d1(f,b)}}}break;case"textarea":aL(a,d);break;case"select":o=d.value,o!=null&&Zl(a,!!d.multiple,o,!1)}};hL=Bv;pL=Vo;var vae={usingClientEntryPoint:!1,Events:[jd,Vl,qm,cL,dL,Bv]},hd={findFiberByHostInstance:To,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},wae={bundleType:hd.bundleType,version:hd.version,rendererPackageName:hd.rendererPackageName,rendererConfig:hd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Pa.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return a=gL(a),a===null?null:a.stateNode},findFiberByHostInstance:hd.findFiberByHostInstance||yae,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var jf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!jf.isDisabled&&jf.supportsFiber)try{jm=jf.inject(wae),la=jf}catch{}}Pr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=vae;Pr.createPortal=function(a,o){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Jv(o))throw Error(Se(200));return bae(a,o,null,d)};Pr.createRoot=function(a,o){if(!Jv(a))throw Error(Se(299));var d=!1,f="",b=UG;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(f=o.identifierPrefix),o.onRecoverableError!==void 0&&(b=o.onRecoverableError)),o=jv(a,1,!1,null,null,d,!1,f,b),a[Wa]=o.current,Fd(a.nodeType===8?a.parentNode:a),new Qv(o)};Pr.findDOMNode=function(a){if(a==null)return null;if(a.nodeType===1)return a;var o=a._reactInternals;if(o===void 0)throw typeof a.render=="function"?Error(Se(188)):(a=Object.keys(a).join(","),Error(Se(268,a)));return a=gL(o),a=a===null?null:a.stateNode,a};Pr.flushSync=function(a){return Vo(a)};Pr.hydrate=function(a,o,d){if(!lg(o))throw Error(Se(200));return ug(null,a,o,!0,d)};Pr.hydrateRoot=function(a,o,d){if(!Jv(a))throw Error(Se(405));var f=d!=null&&d.hydratedSources||null,b=!1,x="",k=UG;if(d!=null&&(d.unstable_strictMode===!0&&(b=!0),d.identifierPrefix!==void 0&&(x=d.identifierPrefix),d.onRecoverableError!==void 0&&(k=d.onRecoverableError)),o=HG(o,null,a,1,d??null,b,!1,x,k),a[Wa]=o.current,Fd(a),f)for(a=0;a<f.length;a++)d=f[a],b=d._getVersion,b=b(d._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[d,b]:o.mutableSourceEagerHydrationData.push(d,b);return new og(o)};Pr.render=function(a,o,d){if(!lg(o))throw Error(Se(200));return ug(null,a,o,!1,d)};Pr.unmountComponentAtNode=function(a){if(!lg(a))throw Error(Se(40));return a._reactRootContainer?(Vo(function(){ug(null,null,a,!1,function(){a._reactRootContainer=null,a[Wa]=null})}),!0):!1};Pr.unstable_batchedUpdates=Bv;Pr.unstable_renderSubtreeIntoContainer=function(a,o,d,f){if(!lg(d))throw Error(Se(200));if(a==null||a._reactInternals===void 0)throw Error(Se(38));return ug(a,o,d,!1,f)};Pr.version="18.3.1-next-f1338f8080-20240426";function jG(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(jG)}catch(a){console.error(a)}}jG(),jE.exports=Pr;var kae=jE.exports,lE=kae;s1.createRoot=lE.createRoot,s1.hydrateRoot=lE.hydrateRoot;/**
 * react-router v7.13.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var uE="popstate";function Iae(a={}){function o(f,b){let{pathname:x,search:k,hash:N}=f.location;return Q1("",{pathname:x,search:k,hash:N},b.state&&b.state.usr||null,b.state&&b.state.key||"default")}function d(f,b){return typeof b=="string"?b:Bd(b)}return Cae(o,d,null,a)}function Kt(a,o){if(a===!1||a===null||typeof a>"u")throw new Error(o)}function zs(a,o){if(!a){typeof console<"u"&&console.warn(o);try{throw new Error(o)}catch{}}}function Sae(){return Math.random().toString(36).substring(2,10)}function cE(a,o){return{usr:a.state,key:a.key,idx:o}}function Q1(a,o,d=null,f){return{pathname:typeof a=="string"?a:a.pathname,search:"",hash:"",...typeof o=="string"?ou(o):o,state:d,key:o&&o.key||f||Sae()}}function Bd({pathname:a="/",search:o="",hash:d=""}){return o&&o!=="?"&&(a+=o.charAt(0)==="?"?o:"?"+o),d&&d!=="#"&&(a+=d.charAt(0)==="#"?d:"#"+d),a}function ou(a){let o={};if(a){let d=a.indexOf("#");d>=0&&(o.hash=a.substring(d),a=a.substring(0,d));let f=a.indexOf("?");f>=0&&(o.search=a.substring(f),a=a.substring(0,f)),a&&(o.pathname=a)}return o}function Cae(a,o,d,f={}){let{window:b=document.defaultView,v5Compat:x=!1}=f,k=b.history,N="POP",E=null,z=W();z==null&&(z=0,k.replaceState({...k.state,idx:z},""));function W(){return(k.state||{idx:null}).idx}function T(){N="POP";let H=W(),O=H==null?null:H-z;z=H,E&&E({action:N,location:B.location,delta:O})}function A(H,O){N="PUSH";let P=Q1(B.location,H,O);z=W()+1;let X=cE(P,z),ie=B.createHref(P);try{k.pushState(X,"",ie)}catch(oe){if(oe instanceof DOMException&&oe.name==="DataCloneError")throw oe;b.location.assign(ie)}x&&E&&E({action:N,location:B.location,delta:1})}function Y(H,O){N="REPLACE";let P=Q1(B.location,H,O);z=W();let X=cE(P,z),ie=B.createHref(P);k.replaceState(X,"",ie),x&&E&&E({action:N,location:B.location,delta:0})}function M(H){return Tae(H)}let B={get action(){return N},get location(){return a(b,k)},listen(H){if(E)throw new Error("A history only accepts one active listener");return b.addEventListener(uE,T),E=H,()=>{b.removeEventListener(uE,T),E=null}},createHref(H){return o(b,H)},createURL:M,encodeLocation(H){let O=M(H);return{pathname:O.pathname,search:O.search,hash:O.hash}},push:A,replace:Y,go(H){return k.go(H)}};return B}function Tae(a,o=!1){let d="http://localhost";typeof window<"u"&&(d=window.location.origin!=="null"?window.location.origin:window.location.href),Kt(d,"No window.location.(origin|href) available to create URL");let f=typeof a=="string"?a:Bd(a);return f=f.replace(/ $/,"%20"),!o&&f.startsWith("//")&&(f=d+f),new URL(f,d)}function YG(a,o,d="/"){return Nae(a,o,d,!1)}function Nae(a,o,d,f){let b=typeof o=="string"?ou(o):o,x=Fa(b.pathname||"/",d);if(x==null)return null;let k=QG(a);Rae(k);let N=null;for(let E=0;N==null&&E<k.length;++E){let z=Xae(x);N=Vae(k[E],z,f)}return N}function QG(a,o=[],d=[],f="",b=!1){let x=(k,N,E=b,z)=>{let W={relativePath:z===void 0?k.path||"":z,caseSensitive:k.caseSensitive===!0,childrenIndex:N,route:k};if(W.relativePath.startsWith("/")){if(!W.relativePath.startsWith(f)&&E)return;Kt(W.relativePath.startsWith(f),`Absolute route path "${W.relativePath}" nested under path "${f}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),W.relativePath=W.relativePath.slice(f.length)}let T=Ga([f,W.relativePath]),A=d.concat(W);k.children&&k.children.length>0&&(Kt(k.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${T}".`),QG(k.children,o,A,T,E)),!(k.path==null&&!k.index)&&o.push({path:T,score:$ae(T,k.index),routesMeta:A})};return a.forEach((k,N)=>{var E;if(k.path===""||!((E=k.path)!=null&&E.includes("?")))x(k,N);else for(let z of JG(k.path))x(k,N,!0,z)}),o}function JG(a){let o=a.split("/");if(o.length===0)return[];let[d,...f]=o,b=d.endsWith("?"),x=d.replace(/\?$/,"");if(f.length===0)return b?[x,""]:[x];let k=JG(f.join("/")),N=[];return N.push(...k.map(E=>E===""?x:[x,E].join("/"))),b&&N.push(...k),N.map(E=>a.startsWith("/")&&E===""?"/":E)}function Rae(a){a.sort((o,d)=>o.score!==d.score?d.score-o.score:Fae(o.routesMeta.map(f=>f.childrenIndex),d.routesMeta.map(f=>f.childrenIndex)))}var Eae=/^:[\w-]+$/,Lae=3,Gae=2,zae=1,Wae=10,Mae=-2,dE=a=>a==="*";function $ae(a,o){let d=a.split("/"),f=d.length;return d.some(dE)&&(f+=Mae),o&&(f+=Gae),d.filter(b=>!dE(b)).reduce((b,x)=>b+(Eae.test(x)?Lae:x===""?zae:Wae),f)}function Fae(a,o){return a.length===o.length&&a.slice(0,-1).every((f,b)=>f===o[b])?a[a.length-1]-o[o.length-1]:0}function Vae(a,o,d=!1){let{routesMeta:f}=a,b={},x="/",k=[];for(let N=0;N<f.length;++N){let E=f[N],z=N===f.length-1,W=x==="/"?o:o.slice(x.length)||"/",T=Bm({path:E.relativePath,caseSensitive:E.caseSensitive,end:z},W),A=E.route;if(!T&&z&&d&&!f[f.length-1].route.index&&(T=Bm({path:E.relativePath,caseSensitive:E.caseSensitive,end:!1},W)),!T)return null;Object.assign(b,T.params),k.push({params:b,pathname:Ga([x,T.pathname]),pathnameBase:Kae(Ga([x,T.pathnameBase])),route:A}),T.pathnameBase!=="/"&&(x=Ga([x,T.pathnameBase]))}return k}function Bm(a,o){typeof a=="string"&&(a={path:a,caseSensitive:!1,end:!0});let[d,f]=Pae(a.path,a.caseSensitive,a.end),b=o.match(d);if(!b)return null;let x=b[0],k=x.replace(/(.)\/+$/,"$1"),N=b.slice(1);return{params:f.reduce((z,{paramName:W,isOptional:T},A)=>{if(W==="*"){let M=N[A]||"";k=x.slice(0,x.length-M.length).replace(/(.)\/+$/,"$1")}const Y=N[A];return T&&!Y?z[W]=void 0:z[W]=(Y||"").replace(/%2F/g,"/"),z},{}),pathname:x,pathnameBase:k,pattern:a}}function Pae(a,o=!1,d=!0){zs(a==="*"||!a.endsWith("*")||a.endsWith("/*"),`Route path "${a}" will be treated as if it were "${a.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${a.replace(/\*$/,"/*")}".`);let f=[],b="^"+a.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(k,N,E)=>(f.push({paramName:N,isOptional:E!=null}),E?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return a.endsWith("*")?(f.push({paramName:"*"}),b+=a==="*"||a==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):d?b+="\\/*$":a!==""&&a!=="/"&&(b+="(?:(?=\\/|$))"),[new RegExp(b,o?void 0:"i"),f]}function Xae(a){try{return a.split("/").map(o=>decodeURIComponent(o).replace(/\//g,"%2F")).join("/")}catch(o){return zs(!1,`The URL path "${a}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${o}).`),a}}function Fa(a,o){if(o==="/")return a;if(!a.toLowerCase().startsWith(o.toLowerCase()))return null;let d=o.endsWith("/")?o.length-1:o.length,f=a.charAt(d);return f&&f!=="/"?null:a.slice(d)||"/"}var Oae=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function Dae(a,o="/"){let{pathname:d,search:f="",hash:b=""}=typeof a=="string"?ou(a):a,x;return d?(d=d.replace(/\/\/+/g,"/"),d.startsWith("/")?x=hE(d.substring(1),"/"):x=hE(d,o)):x=o,{pathname:x,search:Zae(f),hash:Bae(b)}}function hE(a,o){let d=o.replace(/\/+$/,"").split("/");return a.split("/").forEach(b=>{b===".."?d.length>1&&d.pop():b!=="."&&d.push(b)}),d.length>1?d.join("/"):"/"}function Qx(a,o,d,f){return`Cannot include a '${a}' character in a manually specified \`to.${o}\` field [${JSON.stringify(f)}].  Please separate it out to the \`to.${d}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Aae(a){return a.filter((o,d)=>d===0||o.route.path&&o.route.path.length>0)}function qv(a){let o=Aae(a);return o.map((d,f)=>f===o.length-1?d.pathname:d.pathnameBase)}function ew(a,o,d,f=!1){let b;typeof a=="string"?b=ou(a):(b={...a},Kt(!b.pathname||!b.pathname.includes("?"),Qx("?","pathname","search",b)),Kt(!b.pathname||!b.pathname.includes("#"),Qx("#","pathname","hash",b)),Kt(!b.search||!b.search.includes("#"),Qx("#","search","hash",b)));let x=a===""||b.pathname==="",k=x?"/":b.pathname,N;if(k==null)N=d;else{let T=o.length-1;if(!f&&k.startsWith("..")){let A=k.split("/");for(;A[0]==="..";)A.shift(),T-=1;b.pathname=A.join("/")}N=T>=0?o[T]:"/"}let E=Dae(b,N),z=k&&k!=="/"&&k.endsWith("/"),W=(x||k===".")&&d.endsWith("/");return!E.pathname.endsWith("/")&&(z||W)&&(E.pathname+="/"),E}var Ga=a=>a.join("/").replace(/\/\/+/g,"/"),Kae=a=>a.replace(/\/+$/,"").replace(/^\/*/,"/"),Zae=a=>!a||a==="?"?"":a.startsWith("?")?a:"?"+a,Bae=a=>!a||a==="#"?"":a.startsWith("#")?a:"#"+a,_ae=class{constructor(a,o,d,f=!1){this.status=a,this.statusText=o||"",this.internal=f,d instanceof Error?(this.data=d.toString(),this.error=d):this.data=d}};function Hae(a){return a!=null&&typeof a.status=="number"&&typeof a.statusText=="string"&&typeof a.internal=="boolean"&&"data"in a}function Uae(a){return a.map(o=>o.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var qG=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function ez(a,o){let d=a;if(typeof d!="string"||!Oae.test(d))return{absoluteURL:void 0,isExternal:!1,to:d};let f=d,b=!1;if(qG)try{let x=new URL(window.location.href),k=d.startsWith("//")?new URL(x.protocol+d):new URL(d),N=Fa(k.pathname,o);k.origin===x.origin&&N!=null?d=N+k.search+k.hash:b=!0}catch{zs(!1,`<Link to="${d}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:f,isExternal:b,to:d}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var tz=["POST","PUT","PATCH","DELETE"];new Set(tz);var jae=["GET",...tz];new Set(jae);var lu=Q.createContext(null);lu.displayName="DataRouter";var cg=Q.createContext(null);cg.displayName="DataRouterState";var Yae=Q.createContext(!1),nz=Q.createContext({isTransitioning:!1});nz.displayName="ViewTransition";var Qae=Q.createContext(new Map);Qae.displayName="Fetchers";var Jae=Q.createContext(null);Jae.displayName="Await";var Or=Q.createContext(null);Or.displayName="Navigation";var Qd=Q.createContext(null);Qd.displayName="Location";var ca=Q.createContext({outlet:null,matches:[],isDataRoute:!1});ca.displayName="Route";var tw=Q.createContext(null);tw.displayName="RouteError";var rz="REACT_ROUTER_ERROR",qae="REDIRECT",eie="ROUTE_ERROR_RESPONSE";function tie(a){if(a.startsWith(`${rz}:${qae}:{`))try{let o=JSON.parse(a.slice(28));if(typeof o=="object"&&o&&typeof o.status=="number"&&typeof o.statusText=="string"&&typeof o.location=="string"&&typeof o.reloadDocument=="boolean"&&typeof o.replace=="boolean")return o}catch{}}function nie(a){if(a.startsWith(`${rz}:${eie}:{`))try{let o=JSON.parse(a.slice(40));if(typeof o=="object"&&o&&typeof o.status=="number"&&typeof o.statusText=="string")return new _ae(o.status,o.statusText,o.data)}catch{}}function rie(a,{relative:o}={}){Kt(uu(),"useHref() may be used only in the context of a <Router> component.");let{basename:d,navigator:f}=Q.useContext(Or),{hash:b,pathname:x,search:k}=qd(a,{relative:o}),N=x;return d!=="/"&&(N=x==="/"?d:Ga([d,x])),f.createHref({pathname:N,search:k,hash:b})}function uu(){return Q.useContext(Qd)!=null}function Wi(){return Kt(uu(),"useLocation() may be used only in the context of a <Router> component."),Q.useContext(Qd).location}var sz="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function az(a){Q.useContext(Or).static||Q.useLayoutEffect(a)}function Jd(){let{isDataRoute:a}=Q.useContext(ca);return a?gie():sie()}function sie(){Kt(uu(),"useNavigate() may be used only in the context of a <Router> component.");let a=Q.useContext(lu),{basename:o,navigator:d}=Q.useContext(Or),{matches:f}=Q.useContext(ca),{pathname:b}=Wi(),x=JSON.stringify(qv(f)),k=Q.useRef(!1);return az(()=>{k.current=!0}),Q.useCallback((E,z={})=>{if(zs(k.current,sz),!k.current)return;if(typeof E=="number"){d.go(E);return}let W=ew(E,JSON.parse(x),b,z.relative==="path");a==null&&o!=="/"&&(W.pathname=W.pathname==="/"?o:Ga([o,W.pathname])),(z.replace?d.replace:d.push)(W,z.state,z)},[o,d,x,b,a])}Q.createContext(null);function qd(a,{relative:o}={}){let{matches:d}=Q.useContext(ca),{pathname:f}=Wi(),b=JSON.stringify(qv(d));return Q.useMemo(()=>ew(a,JSON.parse(b),f,o==="path"),[a,b,f,o])}function aie(a,o){return iz(a,o)}function iz(a,o,d,f,b){var P;Kt(uu(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:x}=Q.useContext(Or),{matches:k}=Q.useContext(ca),N=k[k.length-1],E=N?N.params:{},z=N?N.pathname:"/",W=N?N.pathnameBase:"/",T=N&&N.route;{let X=T&&T.path||"";lz(z,!T||X.endsWith("*")||X.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${z}" (under <Route path="${X}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${X}"> to <Route path="${X==="/"?"*":`${X}/*`}">.`)}let A=Wi(),Y;if(o){let X=typeof o=="string"?ou(o):o;Kt(W==="/"||((P=X.pathname)==null?void 0:P.startsWith(W)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${W}" but pathname "${X.pathname}" was given in the \`location\` prop.`),Y=X}else Y=A;let M=Y.pathname||"/",B=M;if(W!=="/"){let X=W.replace(/^\//,"").split("/");B="/"+M.replace(/^\//,"").split("/").slice(X.length).join("/")}let H=YG(a,{pathname:B});zs(T||H!=null,`No routes matched location "${Y.pathname}${Y.search}${Y.hash}" `),zs(H==null||H[H.length-1].route.element!==void 0||H[H.length-1].route.Component!==void 0||H[H.length-1].route.lazy!==void 0,`Matched leaf route at location "${Y.pathname}${Y.search}${Y.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let O=cie(H&&H.map(X=>Object.assign({},X,{params:Object.assign({},E,X.params),pathname:Ga([W,x.encodeLocation?x.encodeLocation(X.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:X.pathname]),pathnameBase:X.pathnameBase==="/"?W:Ga([W,x.encodeLocation?x.encodeLocation(X.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:X.pathnameBase])})),k,d,f,b);return o&&O?Q.createElement(Qd.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...Y},navigationType:"POP"}},O):O}function iie(){let a=mie(),o=Hae(a)?`${a.status} ${a.statusText}`:a instanceof Error?a.message:JSON.stringify(a),d=a instanceof Error?a.stack:null,f="rgba(200,200,200, 0.5)",b={padding:"0.5rem",backgroundColor:f},x={padding:"2px 4px",backgroundColor:f},k=null;return console.error("Error handled by React Router default ErrorBoundary:",a),k=Q.createElement(Q.Fragment,null,Q.createElement("p",null," Hey developer "),Q.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Q.createElement("code",{style:x},"ErrorBoundary")," or"," ",Q.createElement("code",{style:x},"errorElement")," prop on your route.")),Q.createElement(Q.Fragment,null,Q.createElement("h2",null,"Unexpected Application Error!"),Q.createElement("h3",{style:{fontStyle:"italic"}},o),d?Q.createElement("pre",{style:b},d):null,k)}var oie=Q.createElement(iie,null),oz=class extends Q.Component{constructor(a){super(a),this.state={location:a.location,revalidation:a.revalidation,error:a.error}}static getDerivedStateFromError(a){return{error:a}}static getDerivedStateFromProps(a,o){return o.location!==a.location||o.revalidation!=="idle"&&a.revalidation==="idle"?{error:a.error,location:a.location,revalidation:a.revalidation}:{error:a.error!==void 0?a.error:o.error,location:o.location,revalidation:a.revalidation||o.revalidation}}componentDidCatch(a,o){this.props.onError?this.props.onError(a,o):console.error("React Router caught the following error during render",a)}render(){let a=this.state.error;if(this.context&&typeof a=="object"&&a&&"digest"in a&&typeof a.digest=="string"){const d=nie(a.digest);d&&(a=d)}let o=a!==void 0?Q.createElement(ca.Provider,{value:this.props.routeContext},Q.createElement(tw.Provider,{value:a,children:this.props.component})):this.props.children;return this.context?Q.createElement(lie,{error:a},o):o}};oz.contextType=Yae;var Jx=new WeakMap;function lie({children:a,error:o}){let{basename:d}=Q.useContext(Or);if(typeof o=="object"&&o&&"digest"in o&&typeof o.digest=="string"){let f=tie(o.digest);if(f){let b=Jx.get(o);if(b)throw b;let x=ez(f.location,d);if(qG&&!Jx.get(o))if(x.isExternal||f.reloadDocument)window.location.href=x.absoluteURL||x.to;else{const k=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(x.to,{replace:f.replace}));throw Jx.set(o,k),k}return Q.createElement("meta",{httpEquiv:"refresh",content:`0;url=${x.absoluteURL||x.to}`})}}return a}function uie({routeContext:a,match:o,children:d}){let f=Q.useContext(lu);return f&&f.static&&f.staticContext&&(o.route.errorElement||o.route.ErrorBoundary)&&(f.staticContext._deepestRenderedBoundaryId=o.route.id),Q.createElement(ca.Provider,{value:a},d)}function cie(a,o=[],d=null,f=null,b=null){if(a==null){if(!d)return null;if(d.errors)a=d.matches;else if(o.length===0&&!d.initialized&&d.matches.length>0)a=d.matches;else return null}let x=a,k=d==null?void 0:d.errors;if(k!=null){let W=x.findIndex(T=>T.route.id&&(k==null?void 0:k[T.route.id])!==void 0);Kt(W>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(k).join(",")}`),x=x.slice(0,Math.min(x.length,W+1))}let N=!1,E=-1;if(d)for(let W=0;W<x.length;W++){let T=x[W];if((T.route.HydrateFallback||T.route.hydrateFallbackElement)&&(E=W),T.route.id){let{loaderData:A,errors:Y}=d,M=T.route.loader&&!A.hasOwnProperty(T.route.id)&&(!Y||Y[T.route.id]===void 0);if(T.route.lazy||M){N=!0,E>=0?x=x.slice(0,E+1):x=[x[0]];break}}}let z=d&&f?(W,T)=>{var A,Y;f(W,{location:d.location,params:((Y=(A=d.matches)==null?void 0:A[0])==null?void 0:Y.params)??{},unstable_pattern:Uae(d.matches),errorInfo:T})}:void 0;return x.reduceRight((W,T,A)=>{let Y,M=!1,B=null,H=null;d&&(Y=k&&T.route.id?k[T.route.id]:void 0,B=T.route.errorElement||oie,N&&(E<0&&A===0?(lz("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),M=!0,H=null):E===A&&(M=!0,H=T.route.hydrateFallbackElement||null)));let O=o.concat(x.slice(0,A+1)),P=()=>{let X;return Y?X=B:M?X=H:T.route.Component?X=Q.createElement(T.route.Component,null):T.route.element?X=T.route.element:X=W,Q.createElement(uie,{match:T,routeContext:{outlet:W,matches:O,isDataRoute:d!=null},children:X})};return d&&(T.route.ErrorBoundary||T.route.errorElement||A===0)?Q.createElement(oz,{location:d.location,revalidation:d.revalidation,component:B,error:Y,children:P(),routeContext:{outlet:null,matches:O,isDataRoute:!0},onError:z}):P()},null)}function nw(a){return`${a} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function die(a){let o=Q.useContext(lu);return Kt(o,nw(a)),o}function hie(a){let o=Q.useContext(cg);return Kt(o,nw(a)),o}function pie(a){let o=Q.useContext(ca);return Kt(o,nw(a)),o}function rw(a){let o=pie(a),d=o.matches[o.matches.length-1];return Kt(d.route.id,`${a} can only be used on routes that contain a unique "id"`),d.route.id}function fie(){return rw("useRouteId")}function mie(){var f;let a=Q.useContext(tw),o=hie("useRouteError"),d=rw("useRouteError");return a!==void 0?a:(f=o.errors)==null?void 0:f[d]}function gie(){let{router:a}=die("useNavigate"),o=rw("useNavigate"),d=Q.useRef(!1);return az(()=>{d.current=!0}),Q.useCallback(async(b,x={})=>{zs(d.current,sz),d.current&&(typeof b=="number"?await a.navigate(b):await a.navigate(b,{fromRouteId:o,...x}))},[a,o])}var pE={};function lz(a,o,d){!o&&!pE[a]&&(pE[a]=!0,zs(!1,d))}Q.memo(bie);function bie({routes:a,future:o,state:d,onError:f}){return iz(a,void 0,d,f,o)}function fE({to:a,replace:o,state:d,relative:f}){Kt(uu(),"<Navigate> may be used only in the context of a <Router> component.");let{static:b}=Q.useContext(Or);zs(!b,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:x}=Q.useContext(ca),{pathname:k}=Wi(),N=Jd(),E=ew(a,qv(x),k,f==="path"),z=JSON.stringify(E);return Q.useEffect(()=>{N(JSON.parse(z),{replace:o,state:d,relative:f})},[N,z,f,o,d]),null}function Ll(a){Kt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function yie({basename:a="/",children:o=null,location:d,navigationType:f="POP",navigator:b,static:x=!1,unstable_useTransitions:k}){Kt(!uu(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let N=a.replace(/^\/*/,"/"),E=Q.useMemo(()=>({basename:N,navigator:b,static:x,unstable_useTransitions:k,future:{}}),[N,b,x,k]);typeof d=="string"&&(d=ou(d));let{pathname:z="/",search:W="",hash:T="",state:A=null,key:Y="default"}=d,M=Q.useMemo(()=>{let B=Fa(z,N);return B==null?null:{location:{pathname:B,search:W,hash:T,state:A,key:Y},navigationType:f}},[N,z,W,T,A,Y,f]);return zs(M!=null,`<Router basename="${N}"> is not able to match the URL "${z}${W}${T}" because it does not start with the basename, so the <Router> won't render anything.`),M==null?null:Q.createElement(Or.Provider,{value:E},Q.createElement(Qd.Provider,{children:o,value:M}))}function xie({children:a,location:o}){return aie(J1(a),o)}function J1(a,o=[]){let d=[];return Q.Children.forEach(a,(f,b)=>{if(!Q.isValidElement(f))return;let x=[...o,b];if(f.type===Q.Fragment){d.push.apply(d,J1(f.props.children,x));return}Kt(f.type===Ll,`[${typeof f.type=="string"?f.type:f.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Kt(!f.props.index||!f.props.children,"An index route cannot have child routes.");let k={id:f.props.id||x.join("-"),caseSensitive:f.props.caseSensitive,element:f.props.element,Component:f.props.Component,index:f.props.index,path:f.props.path,middleware:f.props.middleware,loader:f.props.loader,action:f.props.action,hydrateFallbackElement:f.props.hydrateFallbackElement,HydrateFallback:f.props.HydrateFallback,errorElement:f.props.errorElement,ErrorBoundary:f.props.ErrorBoundary,hasErrorBoundary:f.props.hasErrorBoundary===!0||f.props.ErrorBoundary!=null||f.props.errorElement!=null,shouldRevalidate:f.props.shouldRevalidate,handle:f.props.handle,lazy:f.props.lazy};f.props.children&&(k.children=J1(f.props.children,x)),d.push(k)}),d}var fm="get",mm="application/x-www-form-urlencoded";function dg(a){return typeof HTMLElement<"u"&&a instanceof HTMLElement}function vie(a){return dg(a)&&a.tagName.toLowerCase()==="button"}function wie(a){return dg(a)&&a.tagName.toLowerCase()==="form"}function kie(a){return dg(a)&&a.tagName.toLowerCase()==="input"}function Iie(a){return!!(a.metaKey||a.altKey||a.ctrlKey||a.shiftKey)}function Sie(a,o){return a.button===0&&(!o||o==="_self")&&!Iie(a)}var Yf=null;function Cie(){if(Yf===null)try{new FormData(document.createElement("form"),0),Yf=!1}catch{Yf=!0}return Yf}var Tie=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function qx(a){return a!=null&&!Tie.has(a)?(zs(!1,`"${a}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${mm}"`),null):a}function Nie(a,o){let d,f,b,x,k;if(wie(a)){let N=a.getAttribute("action");f=N?Fa(N,o):null,d=a.getAttribute("method")||fm,b=qx(a.getAttribute("enctype"))||mm,x=new FormData(a)}else if(vie(a)||kie(a)&&(a.type==="submit"||a.type==="image")){let N=a.form;if(N==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let E=a.getAttribute("formaction")||N.getAttribute("action");if(f=E?Fa(E,o):null,d=a.getAttribute("formmethod")||N.getAttribute("method")||fm,b=qx(a.getAttribute("formenctype"))||qx(N.getAttribute("enctype"))||mm,x=new FormData(N,a),!Cie()){let{name:z,type:W,value:T}=a;if(W==="image"){let A=z?`${z}.`:"";x.append(`${A}x`,"0"),x.append(`${A}y`,"0")}else z&&x.append(z,T)}}else{if(dg(a))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');d=fm,f=null,b=mm,k=a}return x&&b==="text/plain"&&(k=x,x=void 0),{action:f,method:d.toLowerCase(),encType:b,formData:x,body:k}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function sw(a,o){if(a===!1||a===null||typeof a>"u")throw new Error(o)}function Rie(a,o,d,f){let b=typeof a=="string"?new URL(a,typeof window>"u"?"server://singlefetch/":window.location.origin):a;return d?b.pathname.endsWith("/")?b.pathname=`${b.pathname}_.${f}`:b.pathname=`${b.pathname}.${f}`:b.pathname==="/"?b.pathname=`_root.${f}`:o&&Fa(b.pathname,o)==="/"?b.pathname=`${o.replace(/\/$/,"")}/_root.${f}`:b.pathname=`${b.pathname.replace(/\/$/,"")}.${f}`,b}async function Eie(a,o){if(a.id in o)return o[a.id];try{let d=await import(a.module);return o[a.id]=d,d}catch(d){return console.error(`Error loading route module \`${a.module}\`, reloading page...`),console.error(d),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Lie(a){return a==null?!1:a.href==null?a.rel==="preload"&&typeof a.imageSrcSet=="string"&&typeof a.imageSizes=="string":typeof a.rel=="string"&&typeof a.href=="string"}async function Gie(a,o,d){let f=await Promise.all(a.map(async b=>{let x=o.routes[b.route.id];if(x){let k=await Eie(x,d);return k.links?k.links():[]}return[]}));return $ie(f.flat(1).filter(Lie).filter(b=>b.rel==="stylesheet"||b.rel==="preload").map(b=>b.rel==="stylesheet"?{...b,rel:"prefetch",as:"style"}:{...b,rel:"prefetch"}))}function mE(a,o,d,f,b,x){let k=(E,z)=>d[z]?E.route.id!==d[z].route.id:!0,N=(E,z)=>{var W;return d[z].pathname!==E.pathname||((W=d[z].route.path)==null?void 0:W.endsWith("*"))&&d[z].params["*"]!==E.params["*"]};return x==="assets"?o.filter((E,z)=>k(E,z)||N(E,z)):x==="data"?o.filter((E,z)=>{var T;let W=f.routes[E.route.id];if(!W||!W.hasLoader)return!1;if(k(E,z)||N(E,z))return!0;if(E.route.shouldRevalidate){let A=E.route.shouldRevalidate({currentUrl:new URL(b.pathname+b.search+b.hash,window.origin),currentParams:((T=d[0])==null?void 0:T.params)||{},nextUrl:new URL(a,window.origin),nextParams:E.params,defaultShouldRevalidate:!0});if(typeof A=="boolean")return A}return!0}):[]}function zie(a,o,{includeHydrateFallback:d}={}){return Wie(a.map(f=>{let b=o.routes[f.route.id];if(!b)return[];let x=[b.module];return b.clientActionModule&&(x=x.concat(b.clientActionModule)),b.clientLoaderModule&&(x=x.concat(b.clientLoaderModule)),d&&b.hydrateFallbackModule&&(x=x.concat(b.hydrateFallbackModule)),b.imports&&(x=x.concat(b.imports)),x}).flat(1))}function Wie(a){return[...new Set(a)]}function Mie(a){let o={},d=Object.keys(a).sort();for(let f of d)o[f]=a[f];return o}function $ie(a,o){let d=new Set;return new Set(o),a.reduce((f,b)=>{let x=JSON.stringify(Mie(b));return d.has(x)||(d.add(x),f.push({key:x,link:b})),f},[])}function uz(){let a=Q.useContext(lu);return sw(a,"You must render this element inside a <DataRouterContext.Provider> element"),a}function Fie(){let a=Q.useContext(cg);return sw(a,"You must render this element inside a <DataRouterStateContext.Provider> element"),a}var aw=Q.createContext(void 0);aw.displayName="FrameworkContext";function cz(){let a=Q.useContext(aw);return sw(a,"You must render this element inside a <HydratedRouter> element"),a}function Vie(a,o){let d=Q.useContext(aw),[f,b]=Q.useState(!1),[x,k]=Q.useState(!1),{onFocus:N,onBlur:E,onMouseEnter:z,onMouseLeave:W,onTouchStart:T}=o,A=Q.useRef(null);Q.useEffect(()=>{if(a==="render"&&k(!0),a==="viewport"){let B=O=>{O.forEach(P=>{k(P.isIntersecting)})},H=new IntersectionObserver(B,{threshold:.5});return A.current&&H.observe(A.current),()=>{H.disconnect()}}},[a]),Q.useEffect(()=>{if(f){let B=setTimeout(()=>{k(!0)},100);return()=>{clearTimeout(B)}}},[f]);let Y=()=>{b(!0)},M=()=>{b(!1),k(!1)};return d?a!=="intent"?[x,A,{}]:[x,A,{onFocus:pd(N,Y),onBlur:pd(E,M),onMouseEnter:pd(z,Y),onMouseLeave:pd(W,M),onTouchStart:pd(T,Y)}]:[!1,A,{}]}function pd(a,o){return d=>{a&&a(d),d.defaultPrevented||o(d)}}function Pie({page:a,...o}){let{router:d}=uz(),f=Q.useMemo(()=>YG(d.routes,a,d.basename),[d.routes,a,d.basename]);return f?Q.createElement(Oie,{page:a,matches:f,...o}):null}function Xie(a){let{manifest:o,routeModules:d}=cz(),[f,b]=Q.useState([]);return Q.useEffect(()=>{let x=!1;return Gie(a,o,d).then(k=>{x||b(k)}),()=>{x=!0}},[a,o,d]),f}function Oie({page:a,matches:o,...d}){let f=Wi(),{future:b,manifest:x,routeModules:k}=cz(),{basename:N}=uz(),{loaderData:E,matches:z}=Fie(),W=Q.useMemo(()=>mE(a,o,z,x,f,"data"),[a,o,z,x,f]),T=Q.useMemo(()=>mE(a,o,z,x,f,"assets"),[a,o,z,x,f]),A=Q.useMemo(()=>{if(a===f.pathname+f.search+f.hash)return[];let B=new Set,H=!1;if(o.forEach(P=>{var ie;let X=x.routes[P.route.id];!X||!X.hasLoader||(!W.some(oe=>oe.route.id===P.route.id)&&P.route.id in E&&((ie=k[P.route.id])!=null&&ie.shouldRevalidate)||X.hasClientLoader?H=!0:B.add(P.route.id))}),B.size===0)return[];let O=Rie(a,N,b.unstable_trailingSlashAwareDataRequests,"data");return H&&B.size>0&&O.searchParams.set("_routes",o.filter(P=>B.has(P.route.id)).map(P=>P.route.id).join(",")),[O.pathname+O.search]},[N,b.unstable_trailingSlashAwareDataRequests,E,f,x,W,o,a,k]),Y=Q.useMemo(()=>zie(T,x),[T,x]),M=Xie(T);return Q.createElement(Q.Fragment,null,A.map(B=>Q.createElement("link",{key:B,rel:"prefetch",as:"fetch",href:B,...d})),Y.map(B=>Q.createElement("link",{key:B,rel:"modulepreload",href:B,...d})),M.map(({key:B,link:H})=>Q.createElement("link",{key:B,nonce:d.nonce,...H,crossOrigin:H.crossOrigin??d.crossOrigin})))}function Die(...a){return o=>{a.forEach(d=>{typeof d=="function"?d(o):d!=null&&(d.current=o)})}}var Aie=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Aie&&(window.__reactRouterVersion="7.13.0")}catch{}function Kie({basename:a,children:o,unstable_useTransitions:d,window:f}){let b=Q.useRef();b.current==null&&(b.current=Iae({window:f,v5Compat:!0}));let x=b.current,[k,N]=Q.useState({action:x.action,location:x.location}),E=Q.useCallback(z=>{d===!1?N(z):Q.startTransition(()=>N(z))},[d]);return Q.useLayoutEffect(()=>x.listen(E),[x,E]),Q.createElement(yie,{basename:a,children:o,location:k.location,navigationType:k.action,navigator:x,unstable_useTransitions:d})}var dz=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,hz=Q.forwardRef(function({onClick:o,discover:d="render",prefetch:f="none",relative:b,reloadDocument:x,replace:k,state:N,target:E,to:z,preventScrollReset:W,viewTransition:T,unstable_defaultShouldRevalidate:A,...Y},M){let{basename:B,unstable_useTransitions:H}=Q.useContext(Or),O=typeof z=="string"&&dz.test(z),P=ez(z,B);z=P.to;let X=rie(z,{relative:b}),[ie,oe,fe]=Vie(f,Y),ge=Hie(z,{replace:k,state:N,target:E,preventScrollReset:W,relative:b,viewTransition:T,unstable_defaultShouldRevalidate:A,unstable_useTransitions:H});function be(Oe){o&&o(Oe),Oe.defaultPrevented||ge(Oe)}let Ve=Q.createElement("a",{...Y,...fe,href:P.absoluteURL||X,onClick:P.isExternal||x?o:be,ref:Die(M,oe),target:E,"data-discover":!O&&d==="render"?"true":void 0});return ie&&!O?Q.createElement(Q.Fragment,null,Ve,Q.createElement(Pie,{page:X})):Ve});hz.displayName="Link";var Zie=Q.forwardRef(function({"aria-current":o="page",caseSensitive:d=!1,className:f="",end:b=!1,style:x,to:k,viewTransition:N,children:E,...z},W){let T=qd(k,{relative:z.relative}),A=Wi(),Y=Q.useContext(cg),{navigator:M,basename:B}=Q.useContext(Or),H=Y!=null&&Jie(T)&&N===!0,O=M.encodeLocation?M.encodeLocation(T).pathname:T.pathname,P=A.pathname,X=Y&&Y.navigation&&Y.navigation.location?Y.navigation.location.pathname:null;d||(P=P.toLowerCase(),X=X?X.toLowerCase():null,O=O.toLowerCase()),X&&B&&(X=Fa(X,B)||X);const ie=O!=="/"&&O.endsWith("/")?O.length-1:O.length;let oe=P===O||!b&&P.startsWith(O)&&P.charAt(ie)==="/",fe=X!=null&&(X===O||!b&&X.startsWith(O)&&X.charAt(O.length)==="/"),ge={isActive:oe,isPending:fe,isTransitioning:H},be=oe?o:void 0,Ve;typeof f=="function"?Ve=f(ge):Ve=[f,oe?"active":null,fe?"pending":null,H?"transitioning":null].filter(Boolean).join(" ");let Oe=typeof x=="function"?x(ge):x;return Q.createElement(hz,{...z,"aria-current":be,className:Ve,ref:W,style:Oe,to:k,viewTransition:N},typeof E=="function"?E(ge):E)});Zie.displayName="NavLink";var Bie=Q.forwardRef(({discover:a="render",fetcherKey:o,navigate:d,reloadDocument:f,replace:b,state:x,method:k=fm,action:N,onSubmit:E,relative:z,preventScrollReset:W,viewTransition:T,unstable_defaultShouldRevalidate:A,...Y},M)=>{let{unstable_useTransitions:B}=Q.useContext(Or),H=Yie(),O=Qie(N,{relative:z}),P=k.toLowerCase()==="get"?"get":"post",X=typeof N=="string"&&dz.test(N),ie=oe=>{if(E&&E(oe),oe.defaultPrevented)return;oe.preventDefault();let fe=oe.nativeEvent.submitter,ge=(fe==null?void 0:fe.getAttribute("formmethod"))||k,be=()=>H(fe||oe.currentTarget,{fetcherKey:o,method:ge,navigate:d,replace:b,state:x,relative:z,preventScrollReset:W,viewTransition:T,unstable_defaultShouldRevalidate:A});B&&d!==!1?Q.startTransition(()=>be()):be()};return Q.createElement("form",{ref:M,method:P,action:O,onSubmit:f?E:ie,...Y,"data-discover":!X&&a==="render"?"true":void 0})});Bie.displayName="Form";function _ie(a){return`${a} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function pz(a){let o=Q.useContext(lu);return Kt(o,_ie(a)),o}function Hie(a,{target:o,replace:d,state:f,preventScrollReset:b,relative:x,viewTransition:k,unstable_defaultShouldRevalidate:N,unstable_useTransitions:E}={}){let z=Jd(),W=Wi(),T=qd(a,{relative:x});return Q.useCallback(A=>{if(Sie(A,o)){A.preventDefault();let Y=d!==void 0?d:Bd(W)===Bd(T),M=()=>z(a,{replace:Y,state:f,preventScrollReset:b,relative:x,viewTransition:k,unstable_defaultShouldRevalidate:N});E?Q.startTransition(()=>M()):M()}},[W,z,T,d,f,o,a,b,x,k,N,E])}var Uie=0,jie=()=>`__${String(++Uie)}__`;function Yie(){let{router:a}=pz("useSubmit"),{basename:o}=Q.useContext(Or),d=fie(),f=a.fetch,b=a.navigate;return Q.useCallback(async(x,k={})=>{let{action:N,method:E,encType:z,formData:W,body:T}=Nie(x,o);if(k.navigate===!1){let A=k.fetcherKey||jie();await f(A,d,k.action||N,{unstable_defaultShouldRevalidate:k.unstable_defaultShouldRevalidate,preventScrollReset:k.preventScrollReset,formData:W,body:T,formMethod:k.method||E,formEncType:k.encType||z,flushSync:k.flushSync})}else await b(k.action||N,{unstable_defaultShouldRevalidate:k.unstable_defaultShouldRevalidate,preventScrollReset:k.preventScrollReset,formData:W,body:T,formMethod:k.method||E,formEncType:k.encType||z,replace:k.replace,state:k.state,fromRouteId:d,flushSync:k.flushSync,viewTransition:k.viewTransition})},[f,b,o,d])}function Qie(a,{relative:o}={}){let{basename:d}=Q.useContext(Or),f=Q.useContext(ca);Kt(f,"useFormAction must be used inside a RouteContext");let[b]=f.matches.slice(-1),x={...qd(a||".",{relative:o})},k=Wi();if(a==null){x.search=k.search;let N=new URLSearchParams(x.search),E=N.getAll("index");if(E.some(W=>W==="")){N.delete("index"),E.filter(T=>T).forEach(T=>N.append("index",T));let W=N.toString();x.search=W?`?${W}`:""}}return(!a||a===".")&&b.route.index&&(x.search=x.search?x.search.replace(/^\?/,"?index&"):"?index"),d!=="/"&&(x.pathname=x.pathname==="/"?d:Ga([d,x.pathname])),Bd(x)}function Jie(a,{relative:o}={}){let d=Q.useContext(nz);Kt(d!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:f}=pz("useViewTransitionState"),b=qd(a,{relative:o});if(!d.isTransitioning)return!1;let x=Fa(d.currentLocation.pathname,f)||d.currentLocation.pathname,k=Fa(d.nextLocation.pathname,f)||d.nextLocation.pathname;return Bm(b.pathname,k)!=null||Bm(b.pathname,x)!=null}function fz(a,o){return function(){return a.apply(o,arguments)}}const{toString:qie}=Object.prototype,{getPrototypeOf:iw}=Object,{iterator:hg,toStringTag:mz}=Symbol,pg=(a=>o=>{const d=qie.call(o);return a[d]||(a[d]=d.slice(8,-1).toLowerCase())})(Object.create(null)),Ws=a=>(a=a.toLowerCase(),o=>pg(o)===a),fg=a=>o=>typeof o===a,{isArray:cu}=Array,ru=fg("undefined");function eh(a){return a!==null&&!ru(a)&&a.constructor!==null&&!ru(a.constructor)&&wr(a.constructor.isBuffer)&&a.constructor.isBuffer(a)}const gz=Ws("ArrayBuffer");function eoe(a){let o;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?o=ArrayBuffer.isView(a):o=a&&a.buffer&&gz(a.buffer),o}const toe=fg("string"),wr=fg("function"),bz=fg("number"),th=a=>a!==null&&typeof a=="object",noe=a=>a===!0||a===!1,gm=a=>{if(pg(a)!=="object")return!1;const o=iw(a);return(o===null||o===Object.prototype||Object.getPrototypeOf(o)===null)&&!(mz in a)&&!(hg in a)},roe=a=>{if(!th(a)||eh(a))return!1;try{return Object.keys(a).length===0&&Object.getPrototypeOf(a)===Object.prototype}catch{return!1}},soe=Ws("Date"),aoe=Ws("File"),ioe=Ws("Blob"),ooe=Ws("FileList"),loe=a=>th(a)&&wr(a.pipe),uoe=a=>{let o;return a&&(typeof FormData=="function"&&a instanceof FormData||wr(a.append)&&((o=pg(a))==="formdata"||o==="object"&&wr(a.toString)&&a.toString()==="[object FormData]"))},coe=Ws("URLSearchParams"),[doe,hoe,poe,foe]=["ReadableStream","Request","Response","Headers"].map(Ws),moe=a=>a.trim?a.trim():a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function nh(a,o,{allOwnKeys:d=!1}={}){if(a===null||typeof a>"u")return;let f,b;if(typeof a!="object"&&(a=[a]),cu(a))for(f=0,b=a.length;f<b;f++)o.call(null,a[f],f,a);else{if(eh(a))return;const x=d?Object.getOwnPropertyNames(a):Object.keys(a),k=x.length;let N;for(f=0;f<k;f++)N=x[f],o.call(null,a[N],N,a)}}function yz(a,o){if(eh(a))return null;o=o.toLowerCase();const d=Object.keys(a);let f=d.length,b;for(;f-- >0;)if(b=d[f],o===b.toLowerCase())return b;return null}const Eo=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,xz=a=>!ru(a)&&a!==Eo;function q1(){const{caseless:a,skipUndefined:o}=xz(this)&&this||{},d={},f=(b,x)=>{if(x==="__proto__"||x==="constructor"||x==="prototype")return;const k=a&&yz(d,x)||x;gm(d[k])&&gm(b)?d[k]=q1(d[k],b):gm(b)?d[k]=q1({},b):cu(b)?d[k]=b.slice():(!o||!ru(b))&&(d[k]=b)};for(let b=0,x=arguments.length;b<x;b++)arguments[b]&&nh(arguments[b],f);return d}const goe=(a,o,d,{allOwnKeys:f}={})=>(nh(o,(b,x)=>{d&&wr(b)?Object.defineProperty(a,x,{value:fz(b,d),writable:!0,enumerable:!0,configurable:!0}):Object.defineProperty(a,x,{value:b,writable:!0,enumerable:!0,configurable:!0})},{allOwnKeys:f}),a),boe=a=>(a.charCodeAt(0)===65279&&(a=a.slice(1)),a),yoe=(a,o,d,f)=>{a.prototype=Object.create(o.prototype,f),Object.defineProperty(a.prototype,"constructor",{value:a,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(a,"super",{value:o.prototype}),d&&Object.assign(a.prototype,d)},xoe=(a,o,d,f)=>{let b,x,k;const N={};if(o=o||{},a==null)return o;do{for(b=Object.getOwnPropertyNames(a),x=b.length;x-- >0;)k=b[x],(!f||f(k,a,o))&&!N[k]&&(o[k]=a[k],N[k]=!0);a=d!==!1&&iw(a)}while(a&&(!d||d(a,o))&&a!==Object.prototype);return o},voe=(a,o,d)=>{a=String(a),(d===void 0||d>a.length)&&(d=a.length),d-=o.length;const f=a.indexOf(o,d);return f!==-1&&f===d},woe=a=>{if(!a)return null;if(cu(a))return a;let o=a.length;if(!bz(o))return null;const d=new Array(o);for(;o-- >0;)d[o]=a[o];return d},koe=(a=>o=>a&&o instanceof a)(typeof Uint8Array<"u"&&iw(Uint8Array)),Ioe=(a,o)=>{const f=(a&&a[hg]).call(a);let b;for(;(b=f.next())&&!b.done;){const x=b.value;o.call(a,x[0],x[1])}},Soe=(a,o)=>{let d;const f=[];for(;(d=a.exec(o))!==null;)f.push(d);return f},Coe=Ws("HTMLFormElement"),Toe=a=>a.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(d,f,b){return f.toUpperCase()+b}),gE=(({hasOwnProperty:a})=>(o,d)=>a.call(o,d))(Object.prototype),Noe=Ws("RegExp"),vz=(a,o)=>{const d=Object.getOwnPropertyDescriptors(a),f={};nh(d,(b,x)=>{let k;(k=o(b,x,a))!==!1&&(f[x]=k||b)}),Object.defineProperties(a,f)},Roe=a=>{vz(a,(o,d)=>{if(wr(a)&&["arguments","caller","callee"].indexOf(d)!==-1)return!1;const f=a[d];if(wr(f)){if(o.enumerable=!1,"writable"in o){o.writable=!1;return}o.set||(o.set=()=>{throw Error("Can not rewrite read-only method '"+d+"'")})}})},Eoe=(a,o)=>{const d={},f=b=>{b.forEach(x=>{d[x]=!0})};return cu(a)?f(a):f(String(a).split(o)),d},Loe=()=>{},Goe=(a,o)=>a!=null&&Number.isFinite(a=+a)?a:o;function zoe(a){return!!(a&&wr(a.append)&&a[mz]==="FormData"&&a[hg])}const Woe=a=>{const o=new Array(10),d=(f,b)=>{if(th(f)){if(o.indexOf(f)>=0)return;if(eh(f))return f;if(!("toJSON"in f)){o[b]=f;const x=cu(f)?[]:{};return nh(f,(k,N)=>{const E=d(k,b+1);!ru(E)&&(x[N]=E)}),o[b]=void 0,x}}return f};return d(a,0)},Moe=Ws("AsyncFunction"),$oe=a=>a&&(th(a)||wr(a))&&wr(a.then)&&wr(a.catch),wz=((a,o)=>a?setImmediate:o?((d,f)=>(Eo.addEventListener("message",({source:b,data:x})=>{b===Eo&&x===d&&f.length&&f.shift()()},!1),b=>{f.push(b),Eo.postMessage(d,"*")}))(`axios@${Math.random()}`,[]):d=>setTimeout(d))(typeof setImmediate=="function",wr(Eo.postMessage)),Foe=typeof queueMicrotask<"u"?queueMicrotask.bind(Eo):typeof process<"u"&&process.nextTick||wz,Voe=a=>a!=null&&wr(a[hg]),ce={isArray:cu,isArrayBuffer:gz,isBuffer:eh,isFormData:uoe,isArrayBufferView:eoe,isString:toe,isNumber:bz,isBoolean:noe,isObject:th,isPlainObject:gm,isEmptyObject:roe,isReadableStream:doe,isRequest:hoe,isResponse:poe,isHeaders:foe,isUndefined:ru,isDate:soe,isFile:aoe,isBlob:ioe,isRegExp:Noe,isFunction:wr,isStream:loe,isURLSearchParams:coe,isTypedArray:koe,isFileList:ooe,forEach:nh,merge:q1,extend:goe,trim:moe,stripBOM:boe,inherits:yoe,toFlatObject:xoe,kindOf:pg,kindOfTest:Ws,endsWith:voe,toArray:woe,forEachEntry:Ioe,matchAll:Soe,isHTMLForm:Coe,hasOwnProperty:gE,hasOwnProp:gE,reduceDescriptors:vz,freezeMethods:Roe,toObjectSet:Eoe,toCamelCase:Toe,noop:Loe,toFiniteNumber:Goe,findKey:yz,global:Eo,isContextDefined:xz,isSpecCompliantForm:zoe,toJSONObject:Woe,isAsyncFn:Moe,isThenable:$oe,setImmediate:wz,asap:Foe,isIterable:Voe};let He=class kz extends Error{static from(o,d,f,b,x,k){const N=new kz(o.message,d||o.code,f,b,x);return N.cause=o,N.name=o.name,k&&Object.assign(N,k),N}constructor(o,d,f,b,x){super(o),this.name="AxiosError",this.isAxiosError=!0,d&&(this.code=d),f&&(this.config=f),b&&(this.request=b),x&&(this.response=x,this.status=x.status)}toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ce.toJSONObject(this.config),code:this.code,status:this.status}}};He.ERR_BAD_OPTION_VALUE="ERR_BAD_OPTION_VALUE";He.ERR_BAD_OPTION="ERR_BAD_OPTION";He.ECONNABORTED="ECONNABORTED";He.ETIMEDOUT="ETIMEDOUT";He.ERR_NETWORK="ERR_NETWORK";He.ERR_FR_TOO_MANY_REDIRECTS="ERR_FR_TOO_MANY_REDIRECTS";He.ERR_DEPRECATED="ERR_DEPRECATED";He.ERR_BAD_RESPONSE="ERR_BAD_RESPONSE";He.ERR_BAD_REQUEST="ERR_BAD_REQUEST";He.ERR_CANCELED="ERR_CANCELED";He.ERR_NOT_SUPPORT="ERR_NOT_SUPPORT";He.ERR_INVALID_URL="ERR_INVALID_URL";const Poe=null;function ev(a){return ce.isPlainObject(a)||ce.isArray(a)}function Iz(a){return ce.endsWith(a,"[]")?a.slice(0,-2):a}function bE(a,o,d){return a?a.concat(o).map(function(b,x){return b=Iz(b),!d&&x?"["+b+"]":b}).join(d?".":""):o}function Xoe(a){return ce.isArray(a)&&!a.some(ev)}const Ooe=ce.toFlatObject(ce,{},null,function(o){return/^is[A-Z]/.test(o)});function mg(a,o,d){if(!ce.isObject(a))throw new TypeError("target must be an object");o=o||new FormData,d=ce.toFlatObject(d,{metaTokens:!0,dots:!1,indexes:!1},!1,function(B,H){return!ce.isUndefined(H[B])});const f=d.metaTokens,b=d.visitor||W,x=d.dots,k=d.indexes,E=(d.Blob||typeof Blob<"u"&&Blob)&&ce.isSpecCompliantForm(o);if(!ce.isFunction(b))throw new TypeError("visitor must be a function");function z(M){if(M===null)return"";if(ce.isDate(M))return M.toISOString();if(ce.isBoolean(M))return M.toString();if(!E&&ce.isBlob(M))throw new He("Blob is not supported. Use a Buffer instead.");return ce.isArrayBuffer(M)||ce.isTypedArray(M)?E&&typeof Blob=="function"?new Blob([M]):Buffer.from(M):M}function W(M,B,H){let O=M;if(M&&!H&&typeof M=="object"){if(ce.endsWith(B,"{}"))B=f?B:B.slice(0,-2),M=JSON.stringify(M);else if(ce.isArray(M)&&Xoe(M)||(ce.isFileList(M)||ce.endsWith(B,"[]"))&&(O=ce.toArray(M)))return B=Iz(B),O.forEach(function(X,ie){!(ce.isUndefined(X)||X===null)&&o.append(k===!0?bE([B],ie,x):k===null?B:B+"[]",z(X))}),!1}return ev(M)?!0:(o.append(bE(H,B,x),z(M)),!1)}const T=[],A=Object.assign(Ooe,{defaultVisitor:W,convertValue:z,isVisitable:ev});function Y(M,B){if(!ce.isUndefined(M)){if(T.indexOf(M)!==-1)throw Error("Circular reference detected in "+B.join("."));T.push(M),ce.forEach(M,function(O,P){(!(ce.isUndefined(O)||O===null)&&b.call(o,O,ce.isString(P)?P.trim():P,B,A))===!0&&Y(O,B?B.concat(P):[P])}),T.pop()}}if(!ce.isObject(a))throw new TypeError("data must be an object");return Y(a),o}function yE(a){const o={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(a).replace(/[!'()~]|%20|%00/g,function(f){return o[f]})}function ow(a,o){this._pairs=[],a&&mg(a,this,o)}const Sz=ow.prototype;Sz.append=function(o,d){this._pairs.push([o,d])};Sz.toString=function(o){const d=o?function(f){return o.call(this,f,yE)}:yE;return this._pairs.map(function(b){return d(b[0])+"="+d(b[1])},"").join("&")};function Doe(a){return encodeURIComponent(a).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Cz(a,o,d){if(!o)return a;const f=d&&d.encode||Doe,b=ce.isFunction(d)?{serialize:d}:d,x=b&&b.serialize;let k;if(x?k=x(o,b):k=ce.isURLSearchParams(o)?o.toString():new ow(o,b).toString(f),k){const N=a.indexOf("#");N!==-1&&(a=a.slice(0,N)),a+=(a.indexOf("?")===-1?"?":"&")+k}return a}class xE{constructor(){this.handlers=[]}use(o,d,f){return this.handlers.push({fulfilled:o,rejected:d,synchronous:f?f.synchronous:!1,runWhen:f?f.runWhen:null}),this.handlers.length-1}eject(o){this.handlers[o]&&(this.handlers[o]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(o){ce.forEach(this.handlers,function(f){f!==null&&o(f)})}}const lw={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1,legacyInterceptorReqResOrdering:!0},Aoe=typeof URLSearchParams<"u"?URLSearchParams:ow,Koe=typeof FormData<"u"?FormData:null,Zoe=typeof Blob<"u"?Blob:null,Boe={isBrowser:!0,classes:{URLSearchParams:Aoe,FormData:Koe,Blob:Zoe},protocols:["http","https","file","blob","url","data"]},uw=typeof window<"u"&&typeof document<"u",tv=typeof navigator=="object"&&navigator||void 0,_oe=uw&&(!tv||["ReactNative","NativeScript","NS"].indexOf(tv.product)<0),Hoe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Uoe=uw&&window.location.href||"http://localhost",joe=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:uw,hasStandardBrowserEnv:_oe,hasStandardBrowserWebWorkerEnv:Hoe,navigator:tv,origin:Uoe},Symbol.toStringTag,{value:"Module"})),Un={...joe,...Boe};function Yoe(a,o){return mg(a,new Un.classes.URLSearchParams,{visitor:function(d,f,b,x){return Un.isNode&&ce.isBuffer(d)?(this.append(f,d.toString("base64")),!1):x.defaultVisitor.apply(this,arguments)},...o})}function Qoe(a){return ce.matchAll(/\w+|\[(\w*)]/g,a).map(o=>o[0]==="[]"?"":o[1]||o[0])}function Joe(a){const o={},d=Object.keys(a);let f;const b=d.length;let x;for(f=0;f<b;f++)x=d[f],o[x]=a[x];return o}function Tz(a){function o(d,f,b,x){let k=d[x++];if(k==="__proto__")return!0;const N=Number.isFinite(+k),E=x>=d.length;return k=!k&&ce.isArray(b)?b.length:k,E?(ce.hasOwnProp(b,k)?b[k]=[b[k],f]:b[k]=f,!N):((!b[k]||!ce.isObject(b[k]))&&(b[k]=[]),o(d,f,b[k],x)&&ce.isArray(b[k])&&(b[k]=Joe(b[k])),!N)}if(ce.isFormData(a)&&ce.isFunction(a.entries)){const d={};return ce.forEachEntry(a,(f,b)=>{o(Qoe(f),b,d,0)}),d}return null}function qoe(a,o,d){if(ce.isString(a))try{return(o||JSON.parse)(a),ce.trim(a)}catch(f){if(f.name!=="SyntaxError")throw f}return(d||JSON.stringify)(a)}const rh={transitional:lw,adapter:["xhr","http","fetch"],transformRequest:[function(o,d){const f=d.getContentType()||"",b=f.indexOf("application/json")>-1,x=ce.isObject(o);if(x&&ce.isHTMLForm(o)&&(o=new FormData(o)),ce.isFormData(o))return b?JSON.stringify(Tz(o)):o;if(ce.isArrayBuffer(o)||ce.isBuffer(o)||ce.isStream(o)||ce.isFile(o)||ce.isBlob(o)||ce.isReadableStream(o))return o;if(ce.isArrayBufferView(o))return o.buffer;if(ce.isURLSearchParams(o))return d.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),o.toString();let N;if(x){if(f.indexOf("application/x-www-form-urlencoded")>-1)return Yoe(o,this.formSerializer).toString();if((N=ce.isFileList(o))||f.indexOf("multipart/form-data")>-1){const E=this.env&&this.env.FormData;return mg(N?{"files[]":o}:o,E&&new E,this.formSerializer)}}return x||b?(d.setContentType("application/json",!1),qoe(o)):o}],transformResponse:[function(o){const d=this.transitional||rh.transitional,f=d&&d.forcedJSONParsing,b=this.responseType==="json";if(ce.isResponse(o)||ce.isReadableStream(o))return o;if(o&&ce.isString(o)&&(f&&!this.responseType||b)){const k=!(d&&d.silentJSONParsing)&&b;try{return JSON.parse(o,this.parseReviver)}catch(N){if(k)throw N.name==="SyntaxError"?He.from(N,He.ERR_BAD_RESPONSE,this,null,this.response):N}}return o}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Un.classes.FormData,Blob:Un.classes.Blob},validateStatus:function(o){return o>=200&&o<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ce.forEach(["delete","get","head","post","put","patch"],a=>{rh.headers[a]={}});const ele=ce.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),tle=a=>{const o={};let d,f,b;return a&&a.split(`
`).forEach(function(k){b=k.indexOf(":"),d=k.substring(0,b).trim().toLowerCase(),f=k.substring(b+1).trim(),!(!d||o[d]&&ele[d])&&(d==="set-cookie"?o[d]?o[d].push(f):o[d]=[f]:o[d]=o[d]?o[d]+", "+f:f)}),o},vE=Symbol("internals");function fd(a){return a&&String(a).trim().toLowerCase()}function bm(a){return a===!1||a==null?a:ce.isArray(a)?a.map(bm):String(a)}function nle(a){const o=Object.create(null),d=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let f;for(;f=d.exec(a);)o[f[1]]=f[2];return o}const rle=a=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(a.trim());function e1(a,o,d,f,b){if(ce.isFunction(f))return f.call(this,o,d);if(b&&(o=d),!!ce.isString(o)){if(ce.isString(f))return o.indexOf(f)!==-1;if(ce.isRegExp(f))return f.test(o)}}function sle(a){return a.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(o,d,f)=>d.toUpperCase()+f)}function ale(a,o){const d=ce.toCamelCase(" "+o);["get","set","has"].forEach(f=>{Object.defineProperty(a,f+d,{value:function(b,x,k){return this[f].call(this,o,b,x,k)},configurable:!0})})}let kr=class{constructor(o){o&&this.set(o)}set(o,d,f){const b=this;function x(N,E,z){const W=fd(E);if(!W)throw new Error("header name must be a non-empty string");const T=ce.findKey(b,W);(!T||b[T]===void 0||z===!0||z===void 0&&b[T]!==!1)&&(b[T||E]=bm(N))}const k=(N,E)=>ce.forEach(N,(z,W)=>x(z,W,E));if(ce.isPlainObject(o)||o instanceof this.constructor)k(o,d);else if(ce.isString(o)&&(o=o.trim())&&!rle(o))k(tle(o),d);else if(ce.isObject(o)&&ce.isIterable(o)){let N={},E,z;for(const W of o){if(!ce.isArray(W))throw TypeError("Object iterator must return a key-value pair");N[z=W[0]]=(E=N[z])?ce.isArray(E)?[...E,W[1]]:[E,W[1]]:W[1]}k(N,d)}else o!=null&&x(d,o,f);return this}get(o,d){if(o=fd(o),o){const f=ce.findKey(this,o);if(f){const b=this[f];if(!d)return b;if(d===!0)return nle(b);if(ce.isFunction(d))return d.call(this,b,f);if(ce.isRegExp(d))return d.exec(b);throw new TypeError("parser must be boolean|regexp|function")}}}has(o,d){if(o=fd(o),o){const f=ce.findKey(this,o);return!!(f&&this[f]!==void 0&&(!d||e1(this,this[f],f,d)))}return!1}delete(o,d){const f=this;let b=!1;function x(k){if(k=fd(k),k){const N=ce.findKey(f,k);N&&(!d||e1(f,f[N],N,d))&&(delete f[N],b=!0)}}return ce.isArray(o)?o.forEach(x):x(o),b}clear(o){const d=Object.keys(this);let f=d.length,b=!1;for(;f--;){const x=d[f];(!o||e1(this,this[x],x,o,!0))&&(delete this[x],b=!0)}return b}normalize(o){const d=this,f={};return ce.forEach(this,(b,x)=>{const k=ce.findKey(f,x);if(k){d[k]=bm(b),delete d[x];return}const N=o?sle(x):String(x).trim();N!==x&&delete d[x],d[N]=bm(b),f[N]=!0}),this}concat(...o){return this.constructor.concat(this,...o)}toJSON(o){const d=Object.create(null);return ce.forEach(this,(f,b)=>{f!=null&&f!==!1&&(d[b]=o&&ce.isArray(f)?f.join(", "):f)}),d}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([o,d])=>o+": "+d).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(o){return o instanceof this?o:new this(o)}static concat(o,...d){const f=new this(o);return d.forEach(b=>f.set(b)),f}static accessor(o){const f=(this[vE]=this[vE]={accessors:{}}).accessors,b=this.prototype;function x(k){const N=fd(k);f[N]||(ale(b,k),f[N]=!0)}return ce.isArray(o)?o.forEach(x):x(o),this}};kr.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);ce.reduceDescriptors(kr.prototype,({value:a},o)=>{let d=o[0].toUpperCase()+o.slice(1);return{get:()=>a,set(f){this[d]=f}}});ce.freezeMethods(kr);function t1(a,o){const d=this||rh,f=o||d,b=kr.from(f.headers);let x=f.data;return ce.forEach(a,function(N){x=N.call(d,x,b.normalize(),o?o.status:void 0)}),b.normalize(),x}function Nz(a){return!!(a&&a.__CANCEL__)}let sh=class extends He{constructor(o,d,f){super(o??"canceled",He.ERR_CANCELED,d,f),this.name="CanceledError",this.__CANCEL__=!0}};function Rz(a,o,d){const f=d.config.validateStatus;!d.status||!f||f(d.status)?a(d):o(new He("Request failed with status code "+d.status,[He.ERR_BAD_REQUEST,He.ERR_BAD_RESPONSE][Math.floor(d.status/100)-4],d.config,d.request,d))}function ile(a){const o=/^([-+\w]{1,25})(:?\/\/|:)/.exec(a);return o&&o[1]||""}function ole(a,o){a=a||10;const d=new Array(a),f=new Array(a);let b=0,x=0,k;return o=o!==void 0?o:1e3,function(E){const z=Date.now(),W=f[x];k||(k=z),d[b]=E,f[b]=z;let T=x,A=0;for(;T!==b;)A+=d[T++],T=T%a;if(b=(b+1)%a,b===x&&(x=(x+1)%a),z-k<o)return;const Y=W&&z-W;return Y?Math.round(A*1e3/Y):void 0}}function lle(a,o){let d=0,f=1e3/o,b,x;const k=(z,W=Date.now())=>{d=W,b=null,x&&(clearTimeout(x),x=null),a(...z)};return[(...z)=>{const W=Date.now(),T=W-d;T>=f?k(z,W):(b=z,x||(x=setTimeout(()=>{x=null,k(b)},f-T)))},()=>b&&k(b)]}const _m=(a,o,d=3)=>{let f=0;const b=ole(50,250);return lle(x=>{const k=x.loaded,N=x.lengthComputable?x.total:void 0,E=k-f,z=b(E),W=k<=N;f=k;const T={loaded:k,total:N,progress:N?k/N:void 0,bytes:E,rate:z||void 0,estimated:z&&N&&W?(N-k)/z:void 0,event:x,lengthComputable:N!=null,[o?"download":"upload"]:!0};a(T)},d)},wE=(a,o)=>{const d=a!=null;return[f=>o[0]({lengthComputable:d,total:a,loaded:f}),o[1]]},kE=a=>(...o)=>ce.asap(()=>a(...o)),ule=Un.hasStandardBrowserEnv?((a,o)=>d=>(d=new URL(d,Un.origin),a.protocol===d.protocol&&a.host===d.host&&(o||a.port===d.port)))(new URL(Un.origin),Un.navigator&&/(msie|trident)/i.test(Un.navigator.userAgent)):()=>!0,cle=Un.hasStandardBrowserEnv?{write(a,o,d,f,b,x,k){if(typeof document>"u")return;const N=[`${a}=${encodeURIComponent(o)}`];ce.isNumber(d)&&N.push(`expires=${new Date(d).toUTCString()}`),ce.isString(f)&&N.push(`path=${f}`),ce.isString(b)&&N.push(`domain=${b}`),x===!0&&N.push("secure"),ce.isString(k)&&N.push(`SameSite=${k}`),document.cookie=N.join("; ")},read(a){if(typeof document>"u")return null;const o=document.cookie.match(new RegExp("(?:^|; )"+a+"=([^;]*)"));return o?decodeURIComponent(o[1]):null},remove(a){this.write(a,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function dle(a){return typeof a!="string"?!1:/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)}function hle(a,o){return o?a.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):a}function Ez(a,o,d){let f=!dle(o);return a&&(f||d==!1)?hle(a,o):o}const IE=a=>a instanceof kr?{...a}:a;function Po(a,o){o=o||{};const d={};function f(z,W,T,A){return ce.isPlainObject(z)&&ce.isPlainObject(W)?ce.merge.call({caseless:A},z,W):ce.isPlainObject(W)?ce.merge({},W):ce.isArray(W)?W.slice():W}function b(z,W,T,A){if(ce.isUndefined(W)){if(!ce.isUndefined(z))return f(void 0,z,T,A)}else return f(z,W,T,A)}function x(z,W){if(!ce.isUndefined(W))return f(void 0,W)}function k(z,W){if(ce.isUndefined(W)){if(!ce.isUndefined(z))return f(void 0,z)}else return f(void 0,W)}function N(z,W,T){if(T in o)return f(z,W);if(T in a)return f(void 0,z)}const E={url:x,method:x,data:x,baseURL:k,transformRequest:k,transformResponse:k,paramsSerializer:k,timeout:k,timeoutMessage:k,withCredentials:k,withXSRFToken:k,adapter:k,responseType:k,xsrfCookieName:k,xsrfHeaderName:k,onUploadProgress:k,onDownloadProgress:k,decompress:k,maxContentLength:k,maxBodyLength:k,beforeRedirect:k,transport:k,httpAgent:k,httpsAgent:k,cancelToken:k,socketPath:k,responseEncoding:k,validateStatus:N,headers:(z,W,T)=>b(IE(z),IE(W),T,!0)};return ce.forEach(Object.keys({...a,...o}),function(W){if(W==="__proto__"||W==="constructor"||W==="prototype")return;const T=ce.hasOwnProp(E,W)?E[W]:b,A=T(a[W],o[W],W);ce.isUndefined(A)&&T!==N||(d[W]=A)}),d}const Lz=a=>{const o=Po({},a);let{data:d,withXSRFToken:f,xsrfHeaderName:b,xsrfCookieName:x,headers:k,auth:N}=o;if(o.headers=k=kr.from(k),o.url=Cz(Ez(o.baseURL,o.url,o.allowAbsoluteUrls),a.params,a.paramsSerializer),N&&k.set("Authorization","Basic "+btoa((N.username||"")+":"+(N.password?unescape(encodeURIComponent(N.password)):""))),ce.isFormData(d)){if(Un.hasStandardBrowserEnv||Un.hasStandardBrowserWebWorkerEnv)k.setContentType(void 0);else if(ce.isFunction(d.getHeaders)){const E=d.getHeaders(),z=["content-type","content-length"];Object.entries(E).forEach(([W,T])=>{z.includes(W.toLowerCase())&&k.set(W,T)})}}if(Un.hasStandardBrowserEnv&&(f&&ce.isFunction(f)&&(f=f(o)),f||f!==!1&&ule(o.url))){const E=b&&x&&cle.read(x);E&&k.set(b,E)}return o},ple=typeof XMLHttpRequest<"u",fle=ple&&function(a){return new Promise(function(d,f){const b=Lz(a);let x=b.data;const k=kr.from(b.headers).normalize();let{responseType:N,onUploadProgress:E,onDownloadProgress:z}=b,W,T,A,Y,M;function B(){Y&&Y(),M&&M(),b.cancelToken&&b.cancelToken.unsubscribe(W),b.signal&&b.signal.removeEventListener("abort",W)}let H=new XMLHttpRequest;H.open(b.method.toUpperCase(),b.url,!0),H.timeout=b.timeout;function O(){if(!H)return;const X=kr.from("getAllResponseHeaders"in H&&H.getAllResponseHeaders()),oe={data:!N||N==="text"||N==="json"?H.responseText:H.response,status:H.status,statusText:H.statusText,headers:X,config:a,request:H};Rz(function(ge){d(ge),B()},function(ge){f(ge),B()},oe),H=null}"onloadend"in H?H.onloadend=O:H.onreadystatechange=function(){!H||H.readyState!==4||H.status===0&&!(H.responseURL&&H.responseURL.indexOf("file:")===0)||setTimeout(O)},H.onabort=function(){H&&(f(new He("Request aborted",He.ECONNABORTED,a,H)),H=null)},H.onerror=function(ie){const oe=ie&&ie.message?ie.message:"Network Error",fe=new He(oe,He.ERR_NETWORK,a,H);fe.event=ie||null,f(fe),H=null},H.ontimeout=function(){let ie=b.timeout?"timeout of "+b.timeout+"ms exceeded":"timeout exceeded";const oe=b.transitional||lw;b.timeoutErrorMessage&&(ie=b.timeoutErrorMessage),f(new He(ie,oe.clarifyTimeoutError?He.ETIMEDOUT:He.ECONNABORTED,a,H)),H=null},x===void 0&&k.setContentType(null),"setRequestHeader"in H&&ce.forEach(k.toJSON(),function(ie,oe){H.setRequestHeader(oe,ie)}),ce.isUndefined(b.withCredentials)||(H.withCredentials=!!b.withCredentials),N&&N!=="json"&&(H.responseType=b.responseType),z&&([A,M]=_m(z,!0),H.addEventListener("progress",A)),E&&H.upload&&([T,Y]=_m(E),H.upload.addEventListener("progress",T),H.upload.addEventListener("loadend",Y)),(b.cancelToken||b.signal)&&(W=X=>{H&&(f(!X||X.type?new sh(null,a,H):X),H.abort(),H=null)},b.cancelToken&&b.cancelToken.subscribe(W),b.signal&&(b.signal.aborted?W():b.signal.addEventListener("abort",W)));const P=ile(b.url);if(P&&Un.protocols.indexOf(P)===-1){f(new He("Unsupported protocol "+P+":",He.ERR_BAD_REQUEST,a));return}H.send(x||null)})},mle=(a,o)=>{const{length:d}=a=a?a.filter(Boolean):[];if(o||d){let f=new AbortController,b;const x=function(z){if(!b){b=!0,N();const W=z instanceof Error?z:this.reason;f.abort(W instanceof He?W:new sh(W instanceof Error?W.message:W))}};let k=o&&setTimeout(()=>{k=null,x(new He(`timeout of ${o}ms exceeded`,He.ETIMEDOUT))},o);const N=()=>{a&&(k&&clearTimeout(k),k=null,a.forEach(z=>{z.unsubscribe?z.unsubscribe(x):z.removeEventListener("abort",x)}),a=null)};a.forEach(z=>z.addEventListener("abort",x));const{signal:E}=f;return E.unsubscribe=()=>ce.asap(N),E}},gle=function*(a,o){let d=a.byteLength;if(d<o){yield a;return}let f=0,b;for(;f<d;)b=f+o,yield a.slice(f,b),f=b},ble=async function*(a,o){for await(const d of yle(a))yield*gle(d,o)},yle=async function*(a){if(a[Symbol.asyncIterator]){yield*a;return}const o=a.getReader();try{for(;;){const{done:d,value:f}=await o.read();if(d)break;yield f}}finally{await o.cancel()}},SE=(a,o,d,f)=>{const b=ble(a,o);let x=0,k,N=E=>{k||(k=!0,f&&f(E))};return new ReadableStream({async pull(E){try{const{done:z,value:W}=await b.next();if(z){N(),E.close();return}let T=W.byteLength;if(d){let A=x+=T;d(A)}E.enqueue(new Uint8Array(W))}catch(z){throw N(z),z}},cancel(E){return N(E),b.return()}},{highWaterMark:2})},CE=64*1024,{isFunction:Qf}=ce,xle=(({Request:a,Response:o})=>({Request:a,Response:o}))(ce.global),{ReadableStream:TE,TextEncoder:NE}=ce.global,RE=(a,...o)=>{try{return!!a(...o)}catch{return!1}},vle=a=>{a=ce.merge.call({skipUndefined:!0},xle,a);const{fetch:o,Request:d,Response:f}=a,b=o?Qf(o):typeof fetch=="function",x=Qf(d),k=Qf(f);if(!b)return!1;const N=b&&Qf(TE),E=b&&(typeof NE=="function"?(M=>B=>M.encode(B))(new NE):async M=>new Uint8Array(await new d(M).arrayBuffer())),z=x&&N&&RE(()=>{let M=!1;const B=new d(Un.origin,{body:new TE,method:"POST",get duplex(){return M=!0,"half"}}).headers.has("Content-Type");return M&&!B}),W=k&&N&&RE(()=>ce.isReadableStream(new f("").body)),T={stream:W&&(M=>M.body)};b&&["text","arrayBuffer","blob","formData","stream"].forEach(M=>{!T[M]&&(T[M]=(B,H)=>{let O=B&&B[M];if(O)return O.call(B);throw new He(`Response type '${M}' is not supported`,He.ERR_NOT_SUPPORT,H)})});const A=async M=>{if(M==null)return 0;if(ce.isBlob(M))return M.size;if(ce.isSpecCompliantForm(M))return(await new d(Un.origin,{method:"POST",body:M}).arrayBuffer()).byteLength;if(ce.isArrayBufferView(M)||ce.isArrayBuffer(M))return M.byteLength;if(ce.isURLSearchParams(M)&&(M=M+""),ce.isString(M))return(await E(M)).byteLength},Y=async(M,B)=>{const H=ce.toFiniteNumber(M.getContentLength());return H??A(B)};return async M=>{let{url:B,method:H,data:O,signal:P,cancelToken:X,timeout:ie,onDownloadProgress:oe,onUploadProgress:fe,responseType:ge,headers:be,withCredentials:Ve="same-origin",fetchOptions:Oe}=Lz(M),Gt=o||fetch;ge=ge?(ge+"").toLowerCase():"text";let Ht=mle([P,X&&X.toAbortSignal()],ie),zt=null;const Vt=Ht&&Ht.unsubscribe&&(()=>{Ht.unsubscribe()});let Do;try{if(fe&&z&&H!=="get"&&H!=="head"&&(Do=await Y(be,O))!==0){let lt=new d(B,{method:"POST",body:O,duplex:"half"}),nt;if(ce.isFormData(O)&&(nt=lt.headers.get("content-type"))&&be.setContentType(nt),lt.body){const[Ms,$n]=wE(Do,_m(kE(fe)));O=SE(lt.body,CE,Ms,$n)}}ce.isString(Ve)||(Ve=Ve?"include":"omit");const Ut=x&&"credentials"in d.prototype,Ir={...Oe,signal:Ht,method:H.toUpperCase(),headers:be.normalize().toJSON(),body:O,duplex:"half",credentials:Ut?Ve:void 0};zt=x&&new d(B,Ir);let Ge=await(x?Gt(zt,Oe):Gt(B,Ir));const _e=W&&(ge==="stream"||ge==="response");if(W&&(oe||_e&&Vt)){const lt={};["status","statusText","headers"].forEach(Pt=>{lt[Pt]=Ge[Pt]});const nt=ce.toFiniteNumber(Ge.headers.get("content-length")),[Ms,$n]=oe&&wE(nt,_m(kE(oe),!0))||[];Ge=new f(SE(Ge.body,CE,Ms,()=>{$n&&$n(),Vt&&Vt()}),lt)}ge=ge||"text";let we=await T[ce.findKey(T,ge)||"text"](Ge,M);return!_e&&Vt&&Vt(),await new Promise((lt,nt)=>{Rz(lt,nt,{data:we,headers:kr.from(Ge.headers),status:Ge.status,statusText:Ge.statusText,config:M,request:zt})})}catch(Ut){throw Vt&&Vt(),Ut&&Ut.name==="TypeError"&&/Load failed|fetch/i.test(Ut.message)?Object.assign(new He("Network Error",He.ERR_NETWORK,M,zt,Ut&&Ut.response),{cause:Ut.cause||Ut}):He.from(Ut,Ut&&Ut.code,M,zt,Ut&&Ut.response)}}},wle=new Map,Gz=a=>{let o=a&&a.env||{};const{fetch:d,Request:f,Response:b}=o,x=[f,b,d];let k=x.length,N=k,E,z,W=wle;for(;N--;)E=x[N],z=W.get(E),z===void 0&&W.set(E,z=N?new Map:vle(o)),W=z;return z};Gz();const cw={http:Poe,xhr:fle,fetch:{get:Gz}};ce.forEach(cw,(a,o)=>{if(a){try{Object.defineProperty(a,"name",{value:o})}catch{}Object.defineProperty(a,"adapterName",{value:o})}});const EE=a=>`- ${a}`,kle=a=>ce.isFunction(a)||a===null||a===!1;function Ile(a,o){a=ce.isArray(a)?a:[a];const{length:d}=a;let f,b;const x={};for(let k=0;k<d;k++){f=a[k];let N;if(b=f,!kle(f)&&(b=cw[(N=String(f)).toLowerCase()],b===void 0))throw new He(`Unknown adapter '${N}'`);if(b&&(ce.isFunction(b)||(b=b.get(o))))break;x[N||"#"+k]=b}if(!b){const k=Object.entries(x).map(([E,z])=>`adapter ${E} `+(z===!1?"is not supported by the environment":"is not available in the build"));let N=d?k.length>1?`since :
`+k.map(EE).join(`
`):" "+EE(k[0]):"as no adapter specified";throw new He("There is no suitable adapter to dispatch the request "+N,"ERR_NOT_SUPPORT")}return b}const zz={getAdapter:Ile,adapters:cw};function n1(a){if(a.cancelToken&&a.cancelToken.throwIfRequested(),a.signal&&a.signal.aborted)throw new sh(null,a)}function LE(a){return n1(a),a.headers=kr.from(a.headers),a.data=t1.call(a,a.transformRequest),["post","put","patch"].indexOf(a.method)!==-1&&a.headers.setContentType("application/x-www-form-urlencoded",!1),zz.getAdapter(a.adapter||rh.adapter,a)(a).then(function(f){return n1(a),f.data=t1.call(a,a.transformResponse,f),f.headers=kr.from(f.headers),f},function(f){return Nz(f)||(n1(a),f&&f.response&&(f.response.data=t1.call(a,a.transformResponse,f.response),f.response.headers=kr.from(f.response.headers))),Promise.reject(f)})}const Wz="1.13.5",gg={};["object","boolean","number","function","string","symbol"].forEach((a,o)=>{gg[a]=function(f){return typeof f===a||"a"+(o<1?"n ":" ")+a}});const GE={};gg.transitional=function(o,d,f){function b(x,k){return"[Axios v"+Wz+"] Transitional option '"+x+"'"+k+(f?". "+f:"")}return(x,k,N)=>{if(o===!1)throw new He(b(k," has been removed"+(d?" in "+d:"")),He.ERR_DEPRECATED);return d&&!GE[k]&&(GE[k]=!0,console.warn(b(k," has been deprecated since v"+d+" and will be removed in the near future"))),o?o(x,k,N):!0}};gg.spelling=function(o){return(d,f)=>(console.warn(`${f} is likely a misspelling of ${o}`),!0)};function Sle(a,o,d){if(typeof a!="object")throw new He("options must be an object",He.ERR_BAD_OPTION_VALUE);const f=Object.keys(a);let b=f.length;for(;b-- >0;){const x=f[b],k=o[x];if(k){const N=a[x],E=N===void 0||k(N,x,a);if(E!==!0)throw new He("option "+x+" must be "+E,He.ERR_BAD_OPTION_VALUE);continue}if(d!==!0)throw new He("Unknown option "+x,He.ERR_BAD_OPTION)}}const ym={assertOptions:Sle,validators:gg},ns=ym.validators;let zo=class{constructor(o){this.defaults=o||{},this.interceptors={request:new xE,response:new xE}}async request(o,d){try{return await this._request(o,d)}catch(f){if(f instanceof Error){let b={};Error.captureStackTrace?Error.captureStackTrace(b):b=new Error;const x=b.stack?b.stack.replace(/^.+\n/,""):"";try{f.stack?x&&!String(f.stack).endsWith(x.replace(/^.+\n.+\n/,""))&&(f.stack+=`
`+x):f.stack=x}catch{}}throw f}}_request(o,d){typeof o=="string"?(d=d||{},d.url=o):d=o||{},d=Po(this.defaults,d);const{transitional:f,paramsSerializer:b,headers:x}=d;f!==void 0&&ym.assertOptions(f,{silentJSONParsing:ns.transitional(ns.boolean),forcedJSONParsing:ns.transitional(ns.boolean),clarifyTimeoutError:ns.transitional(ns.boolean),legacyInterceptorReqResOrdering:ns.transitional(ns.boolean)},!1),b!=null&&(ce.isFunction(b)?d.paramsSerializer={serialize:b}:ym.assertOptions(b,{encode:ns.function,serialize:ns.function},!0)),d.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?d.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:d.allowAbsoluteUrls=!0),ym.assertOptions(d,{baseUrl:ns.spelling("baseURL"),withXsrfToken:ns.spelling("withXSRFToken")},!0),d.method=(d.method||this.defaults.method||"get").toLowerCase();let k=x&&ce.merge(x.common,x[d.method]);x&&ce.forEach(["delete","get","head","post","put","patch","common"],M=>{delete x[M]}),d.headers=kr.concat(k,x);const N=[];let E=!0;this.interceptors.request.forEach(function(B){if(typeof B.runWhen=="function"&&B.runWhen(d)===!1)return;E=E&&B.synchronous;const H=d.transitional||lw;H&&H.legacyInterceptorReqResOrdering?N.unshift(B.fulfilled,B.rejected):N.push(B.fulfilled,B.rejected)});const z=[];this.interceptors.response.forEach(function(B){z.push(B.fulfilled,B.rejected)});let W,T=0,A;if(!E){const M=[LE.bind(this),void 0];for(M.unshift(...N),M.push(...z),A=M.length,W=Promise.resolve(d);T<A;)W=W.then(M[T++],M[T++]);return W}A=N.length;let Y=d;for(;T<A;){const M=N[T++],B=N[T++];try{Y=M(Y)}catch(H){B.call(this,H);break}}try{W=LE.call(this,Y)}catch(M){return Promise.reject(M)}for(T=0,A=z.length;T<A;)W=W.then(z[T++],z[T++]);return W}getUri(o){o=Po(this.defaults,o);const d=Ez(o.baseURL,o.url,o.allowAbsoluteUrls);return Cz(d,o.params,o.paramsSerializer)}};ce.forEach(["delete","get","head","options"],function(o){zo.prototype[o]=function(d,f){return this.request(Po(f||{},{method:o,url:d,data:(f||{}).data}))}});ce.forEach(["post","put","patch"],function(o){function d(f){return function(x,k,N){return this.request(Po(N||{},{method:o,headers:f?{"Content-Type":"multipart/form-data"}:{},url:x,data:k}))}}zo.prototype[o]=d(),zo.prototype[o+"Form"]=d(!0)});let Cle=class Mz{constructor(o){if(typeof o!="function")throw new TypeError("executor must be a function.");let d;this.promise=new Promise(function(x){d=x});const f=this;this.promise.then(b=>{if(!f._listeners)return;let x=f._listeners.length;for(;x-- >0;)f._listeners[x](b);f._listeners=null}),this.promise.then=b=>{let x;const k=new Promise(N=>{f.subscribe(N),x=N}).then(b);return k.cancel=function(){f.unsubscribe(x)},k},o(function(x,k,N){f.reason||(f.reason=new sh(x,k,N),d(f.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(o){if(this.reason){o(this.reason);return}this._listeners?this._listeners.push(o):this._listeners=[o]}unsubscribe(o){if(!this._listeners)return;const d=this._listeners.indexOf(o);d!==-1&&this._listeners.splice(d,1)}toAbortSignal(){const o=new AbortController,d=f=>{o.abort(f)};return this.subscribe(d),o.signal.unsubscribe=()=>this.unsubscribe(d),o.signal}static source(){let o;return{token:new Mz(function(b){o=b}),cancel:o}}};function Tle(a){return function(d){return a.apply(null,d)}}function Nle(a){return ce.isObject(a)&&a.isAxiosError===!0}const nv={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(nv).forEach(([a,o])=>{nv[o]=a});function $z(a){const o=new zo(a),d=fz(zo.prototype.request,o);return ce.extend(d,zo.prototype,o,{allOwnKeys:!0}),ce.extend(d,o,null,{allOwnKeys:!0}),d.create=function(b){return $z(Po(a,b))},d}const mt=$z(rh);mt.Axios=zo;mt.CanceledError=sh;mt.CancelToken=Cle;mt.isCancel=Nz;mt.VERSION=Wz;mt.toFormData=mg;mt.AxiosError=He;mt.Cancel=mt.CanceledError;mt.all=function(o){return Promise.all(o)};mt.spread=Tle;mt.isAxiosError=Nle;mt.mergeConfig=Po;mt.AxiosHeaders=kr;mt.formToJSON=a=>Tz(ce.isHTMLForm(a)?new FormData(a):a);mt.getAdapter=zz.getAdapter;mt.HttpStatusCode=nv;mt.default=mt;const{Axios:rce,AxiosError:sce,CanceledError:ace,isCancel:ice,CancelToken:oce,VERSION:lce,all:uce,Cancel:cce,isAxiosError:dce,spread:hce,toFormData:pce,AxiosHeaders:fce,HttpStatusCode:mce,formToJSON:gce,getAdapter:bce,mergeConfig:yce}=mt;let Rle={data:""},Ele=a=>{if(typeof window=="object"){let o=(a?a.querySelector("#_goober"):window._goober)||Object.assign(document.createElement("style"),{innerHTML:" ",id:"_goober"});return o.nonce=window.__nonce__,o.parentNode||(a||document.head).appendChild(o),o.firstChild}return a||Rle},Lle=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,Gle=/\/\*[^]*?\*\/|  +/g,zE=/\n+/g,bi=(a,o)=>{let d="",f="",b="";for(let x in a){let k=a[x];x[0]=="@"?x[1]=="i"?d=x+" "+k+";":f+=x[1]=="f"?bi(k,x):x+"{"+bi(k,x[1]=="k"?"":o)+"}":typeof k=="object"?f+=bi(k,o?o.replace(/([^,])+/g,N=>x.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,E=>/&/.test(E)?E.replace(/&/g,N):N?N+" "+E:E)):x):k!=null&&(x=/^--/.test(x)?x:x.replace(/[A-Z]/g,"-$&").toLowerCase(),b+=bi.p?bi.p(x,k):x+":"+k+";")}return d+(o&&b?o+"{"+b+"}":b)+f},Sa={},Fz=a=>{if(typeof a=="object"){let o="";for(let d in a)o+=d+Fz(a[d]);return o}return a},zle=(a,o,d,f,b)=>{let x=Fz(a),k=Sa[x]||(Sa[x]=(E=>{let z=0,W=11;for(;z<E.length;)W=101*W+E.charCodeAt(z++)>>>0;return"go"+W})(x));if(!Sa[k]){let E=x!==a?a:(z=>{let W,T,A=[{}];for(;W=Lle.exec(z.replace(Gle,""));)W[4]?A.shift():W[3]?(T=W[3].replace(zE," ").trim(),A.unshift(A[0][T]=A[0][T]||{})):A[0][W[1]]=W[2].replace(zE," ").trim();return A[0]})(a);Sa[k]=bi(b?{["@keyframes "+k]:E}:E,d?"":"."+k)}let N=d&&Sa.g?Sa.g:null;return d&&(Sa.g=Sa[k]),((E,z,W,T)=>{T?z.data=z.data.replace(T,E):z.data.indexOf(E)===-1&&(z.data=W?E+z.data:z.data+E)})(Sa[k],o,f,N),k},Wle=(a,o,d)=>a.reduce((f,b,x)=>{let k=o[x];if(k&&k.call){let N=k(d),E=N&&N.props&&N.props.className||/^go/.test(N)&&N;k=E?"."+E:N&&typeof N=="object"?N.props?"":bi(N,""):N===!1?"":N}return f+b+(k??"")},"");function bg(a){let o=this||{},d=a.call?a(o.p):a;return zle(d.unshift?d.raw?Wle(d,[].slice.call(arguments,1),o.p):d.reduce((f,b)=>Object.assign(f,b&&b.call?b(o.p):b),{}):d,Ele(o.target),o.g,o.o,o.k)}let Vz,rv,sv;bg.bind({g:1});let Va=bg.bind({k:1});function Mle(a,o,d,f){bi.p=o,Vz=a,rv=d,sv=f}function Mi(a,o){let d=this||{};return function(){let f=arguments;function b(x,k){let N=Object.assign({},x),E=N.className||b.className;d.p=Object.assign({theme:rv&&rv()},N),d.o=/ *go\d+/.test(E),N.className=bg.apply(d,f)+(E?" "+E:"");let z=a;return a[0]&&(z=N.as||a,delete N.as),sv&&z[0]&&sv(N),Vz(z,N)}return b}}var $le=a=>typeof a=="function",Hm=(a,o)=>$le(a)?a(o):a,Fle=(()=>{let a=0;return()=>(++a).toString()})(),Pz=(()=>{let a;return()=>{if(a===void 0&&typeof window<"u"){let o=matchMedia("(prefers-reduced-motion: reduce)");a=!o||o.matches}return a}})(),Vle=20,dw="default",Xz=(a,o)=>{let{toastLimit:d}=a.settings;switch(o.type){case 0:return{...a,toasts:[o.toast,...a.toasts].slice(0,d)};case 1:return{...a,toasts:a.toasts.map(k=>k.id===o.toast.id?{...k,...o.toast}:k)};case 2:let{toast:f}=o;return Xz(a,{type:a.toasts.find(k=>k.id===f.id)?1:0,toast:f});case 3:let{toastId:b}=o;return{...a,toasts:a.toasts.map(k=>k.id===b||b===void 0?{...k,dismissed:!0,visible:!1}:k)};case 4:return o.toastId===void 0?{...a,toasts:[]}:{...a,toasts:a.toasts.filter(k=>k.id!==o.toastId)};case 5:return{...a,pausedAt:o.time};case 6:let x=o.time-(a.pausedAt||0);return{...a,pausedAt:void 0,toasts:a.toasts.map(k=>({...k,pauseDuration:k.pauseDuration+x}))}}},xm=[],Oz={toasts:[],pausedAt:void 0,settings:{toastLimit:Vle}},aa={},Dz=(a,o=dw)=>{aa[o]=Xz(aa[o]||Oz,a),xm.forEach(([d,f])=>{d===o&&f(aa[o])})},Az=a=>Object.keys(aa).forEach(o=>Dz(a,o)),Ple=a=>Object.keys(aa).find(o=>aa[o].toasts.some(d=>d.id===a)),yg=(a=dw)=>o=>{Dz(o,a)},Xle={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},Ole=(a={},o=dw)=>{let[d,f]=Q.useState(aa[o]||Oz),b=Q.useRef(aa[o]);Q.useEffect(()=>(b.current!==aa[o]&&f(aa[o]),xm.push([o,f]),()=>{let k=xm.findIndex(([N])=>N===o);k>-1&&xm.splice(k,1)}),[o]);let x=d.toasts.map(k=>{var N,E,z;return{...a,...a[k.type],...k,removeDelay:k.removeDelay||((N=a[k.type])==null?void 0:N.removeDelay)||(a==null?void 0:a.removeDelay),duration:k.duration||((E=a[k.type])==null?void 0:E.duration)||(a==null?void 0:a.duration)||Xle[k.type],style:{...a.style,...(z=a[k.type])==null?void 0:z.style,...k.style}}});return{...d,toasts:x}},Dle=(a,o="blank",d)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:o,ariaProps:{role:"status","aria-live":"polite"},message:a,pauseDuration:0,...d,id:(d==null?void 0:d.id)||Fle()}),ah=a=>(o,d)=>{let f=Dle(o,a,d);return yg(f.toasterId||Ple(f.id))({type:2,toast:f}),f.id},xn=(a,o)=>ah("blank")(a,o);xn.error=ah("error");xn.success=ah("success");xn.loading=ah("loading");xn.custom=ah("custom");xn.dismiss=(a,o)=>{let d={type:3,toastId:a};o?yg(o)(d):Az(d)};xn.dismissAll=a=>xn.dismiss(void 0,a);xn.remove=(a,o)=>{let d={type:4,toastId:a};o?yg(o)(d):Az(d)};xn.removeAll=a=>xn.remove(void 0,a);xn.promise=(a,o,d)=>{let f=xn.loading(o.loading,{...d,...d==null?void 0:d.loading});return typeof a=="function"&&(a=a()),a.then(b=>{let x=o.success?Hm(o.success,b):void 0;return x?xn.success(x,{id:f,...d,...d==null?void 0:d.success}):xn.dismiss(f),b}).catch(b=>{let x=o.error?Hm(o.error,b):void 0;x?xn.error(x,{id:f,...d,...d==null?void 0:d.error}):xn.dismiss(f)}),a};var Ale=1e3,Kle=(a,o="default")=>{let{toasts:d,pausedAt:f}=Ole(a,o),b=Q.useRef(new Map).current,x=Q.useCallback((T,A=Ale)=>{if(b.has(T))return;let Y=setTimeout(()=>{b.delete(T),k({type:4,toastId:T})},A);b.set(T,Y)},[]);Q.useEffect(()=>{if(f)return;let T=Date.now(),A=d.map(Y=>{if(Y.duration===1/0)return;let M=(Y.duration||0)+Y.pauseDuration-(T-Y.createdAt);if(M<0){Y.visible&&xn.dismiss(Y.id);return}return setTimeout(()=>xn.dismiss(Y.id,o),M)});return()=>{A.forEach(Y=>Y&&clearTimeout(Y))}},[d,f,o]);let k=Q.useCallback(yg(o),[o]),N=Q.useCallback(()=>{k({type:5,time:Date.now()})},[k]),E=Q.useCallback((T,A)=>{k({type:1,toast:{id:T,height:A}})},[k]),z=Q.useCallback(()=>{f&&k({type:6,time:Date.now()})},[f,k]),W=Q.useCallback((T,A)=>{let{reverseOrder:Y=!1,gutter:M=8,defaultPosition:B}=A||{},H=d.filter(X=>(X.position||B)===(T.position||B)&&X.height),O=H.findIndex(X=>X.id===T.id),P=H.filter((X,ie)=>ie<O&&X.visible).length;return H.filter(X=>X.visible).slice(...Y?[P+1]:[0,P]).reduce((X,ie)=>X+(ie.height||0)+M,0)},[d]);return Q.useEffect(()=>{d.forEach(T=>{if(T.dismissed)x(T.id,T.removeDelay);else{let A=b.get(T.id);A&&(clearTimeout(A),b.delete(T.id))}})},[d,x]),{toasts:d,handlers:{updateHeight:E,startPause:N,endPause:z,calculateOffset:W}}},Zle=Va`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,Ble=Va`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,_le=Va`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,Hle=Mi("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${a=>a.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Zle} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${Ble} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${a=>a.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${_le} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,Ule=Va`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,jle=Mi("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${a=>a.secondary||"#e0e0e0"};
  border-right-color: ${a=>a.primary||"#616161"};
  animation: ${Ule} 1s linear infinite;
`,Yle=Va`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,Qle=Va`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Jle=Mi("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${a=>a.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Yle} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${Qle} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${a=>a.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,qle=Mi("div")`
  position: absolute;
`,eue=Mi("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,tue=Va`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,nue=Mi("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${tue} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,rue=({toast:a})=>{let{icon:o,type:d,iconTheme:f}=a;return o!==void 0?typeof o=="string"?Q.createElement(nue,null,o):o:d==="blank"?null:Q.createElement(eue,null,Q.createElement(jle,{...f}),d!=="loading"&&Q.createElement(qle,null,d==="error"?Q.createElement(Hle,{...f}):Q.createElement(Jle,{...f})))},sue=a=>`
0% {transform: translate3d(0,${a*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,aue=a=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${a*-150}%,-1px) scale(.6); opacity:0;}
`,iue="0%{opacity:0;} 100%{opacity:1;}",oue="0%{opacity:1;} 100%{opacity:0;}",lue=Mi("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,uue=Mi("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,cue=(a,o)=>{let d=a.includes("top")?1:-1,[f,b]=Pz()?[iue,oue]:[sue(d),aue(d)];return{animation:o?`${Va(f)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${Va(b)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},due=Q.memo(({toast:a,position:o,style:d,children:f})=>{let b=a.height?cue(a.position||o||"top-center",a.visible):{opacity:0},x=Q.createElement(rue,{toast:a}),k=Q.createElement(uue,{...a.ariaProps},Hm(a.message,a));return Q.createElement(lue,{className:a.className,style:{...b,...d,...a.style}},typeof f=="function"?f({icon:x,message:k}):Q.createElement(Q.Fragment,null,x,k))});Mle(Q.createElement);var hue=({id:a,className:o,style:d,onHeightUpdate:f,children:b})=>{let x=Q.useCallback(k=>{if(k){let N=()=>{let E=k.getBoundingClientRect().height;f(a,E)};N(),new MutationObserver(N).observe(k,{subtree:!0,childList:!0,characterData:!0})}},[a,f]);return Q.createElement("div",{ref:x,className:o,style:d},b)},pue=(a,o)=>{let d=a.includes("top"),f=d?{top:0}:{bottom:0},b=a.includes("center")?{justifyContent:"center"}:a.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:Pz()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${o*(d?1:-1)}px)`,...f,...b}},fue=bg`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,Jf=16,xg=({reverseOrder:a,position:o="top-center",toastOptions:d,gutter:f,children:b,toasterId:x,containerStyle:k,containerClassName:N})=>{let{toasts:E,handlers:z}=Kle(d,x);return Q.createElement("div",{"data-rht-toaster":x||"",style:{position:"fixed",zIndex:9999,top:Jf,left:Jf,right:Jf,bottom:Jf,pointerEvents:"none",...k},className:N,onMouseEnter:z.startPause,onMouseLeave:z.endPause},E.map(W=>{let T=W.position||o,A=z.calculateOffset(W,{reverseOrder:a,gutter:f,defaultPosition:o}),Y=pue(T,A);return Q.createElement(hue,{id:W.id,key:W.id,onHeightUpdate:z.updateHeight,className:W.visible?fue:"",style:Y},W.type==="custom"?Hm(W.message,W):b?b(W):Q.createElement(due,{toast:W,position:T}))}))},ia=xn;const mue=()=>{const[a,o]=Q.useState(""),[d,f]=Q.useState(""),[b,x]=Q.useState(!1),k=Jd(),N=async E=>{var z,W;E.preventDefault(),x(!0);try{const T=await mt.post("/api/auth/login",{username:a,password:d});if(T.data.success){const{token:A,user:Y}=T.data;localStorage.setItem("token",A),localStorage.setItem("user",JSON.stringify(Y)),ia.success(`Xush kelibsiz, ${Y.shopName||Y.username}!`),setTimeout(()=>{Y.role==="admin"?k("/admin"):k("/shop")},800)}}catch(T){console.error(T),ia.error(((W=(z=T.response)==null?void 0:z.data)==null?void 0:W.error)||"Login xatosi")}finally{x(!1)}};return te.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-pinhan-black text-white p-4",children:[te.jsx(xg,{position:"top-center"}),te.jsxs("div",{className:"w-full max-w-md bg-zinc-900 border border-zinc-800 rounded-2xl p-8 shadow-2xl",children:[te.jsxs("div",{className:"text-center mb-8",children:[te.jsx("img",{src:"/logo.png",alt:"Pinhan",className:"h-16 mx-auto mb-4",onError:E=>E.target.style.display="none"}),te.jsx("h1",{className:"text-3xl font-bold text-pinhan-gold tracking-wider",children:"PINHAN BOX"}),te.jsx("p",{className:"text-zinc-500 mt-2",children:"B2B Partner Platform"})]}),te.jsxs("form",{onSubmit:N,className:"space-y-6",children:[te.jsxs("div",{children:[te.jsx("label",{className:"block text-sm font-medium text-zinc-400 mb-2",children:"Username"}),te.jsx("input",{type:"text",required:!0,value:a,onChange:E=>o(E.target.value),className:"w-full bg-black border border-zinc-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-pinhan-gold transition-colors",placeholder:"admin or shop name"})]}),te.jsxs("div",{children:[te.jsx("label",{className:"block text-sm font-medium text-zinc-400 mb-2",children:"Parol"}),te.jsx("input",{type:"password",required:!0,value:d,onChange:E=>f(E.target.value),className:"w-full bg-black border border-zinc-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-pinhan-gold transition-colors",placeholder:""})]}),te.jsx("button",{type:"submit",disabled:b,className:"w-full bg-gradient-to-r from-yellow-600 to-yellow-500 hover:from-yellow-500 hover:to-yellow-400 text-black font-bold py-3 rounded-lg transition-all transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed",children:b?"Kirish...":"KIRISH"})]}),te.jsx("div",{className:"mt-8 text-center text-xs text-zinc-600",children:" 2026 Pinhan Box. All rights reserved."})]})]})};var vg={},Kz={exports:{}},gue="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",bue=gue,yue=bue;function Zz(){}function Bz(){}Bz.resetWarningCache=Zz;var xue=function(){function a(f,b,x,k,N,E){if(E!==yue){var z=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw z.name="Invariant Violation",z}}a.isRequired=a;function o(){return a}var d={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:o,element:a,elementType:a,instanceOf:o,node:a,objectOf:o,oneOf:o,oneOfType:o,shape:o,exact:o,checkPropTypes:Bz,resetWarningCache:Zz};return d.PropTypes=d,d};Kz.exports=xue();var _z=Kz.exports,Hz={L:1,M:0,Q:3,H:2},Uz={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},vue=Uz;function jz(a){this.mode=vue.MODE_8BIT_BYTE,this.data=a}jz.prototype={getLength:function(a){return this.data.length},write:function(a){for(var o=0;o<this.data.length;o++)a.put(this.data.charCodeAt(o),8)}};var wue=jz,qf=Hz;function sa(a,o){this.totalCount=a,this.dataCount=o}sa.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];sa.getRSBlocks=function(a,o){var d=sa.getRsBlockTable(a,o);if(d==null)throw new Error("bad rs block @ typeNumber:"+a+"/errorCorrectLevel:"+o);for(var f=d.length/3,b=new Array,x=0;x<f;x++)for(var k=d[x*3+0],N=d[x*3+1],E=d[x*3+2],z=0;z<k;z++)b.push(new sa(N,E));return b};sa.getRsBlockTable=function(a,o){switch(o){case qf.L:return sa.RS_BLOCK_TABLE[(a-1)*4+0];case qf.M:return sa.RS_BLOCK_TABLE[(a-1)*4+1];case qf.Q:return sa.RS_BLOCK_TABLE[(a-1)*4+2];case qf.H:return sa.RS_BLOCK_TABLE[(a-1)*4+3];default:return}};var kue=sa;function Yz(){this.buffer=new Array,this.length=0}Yz.prototype={get:function(a){var o=Math.floor(a/8);return(this.buffer[o]>>>7-a%8&1)==1},put:function(a,o){for(var d=0;d<o;d++)this.putBit((a>>>o-d-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(a){var o=Math.floor(this.length/8);this.buffer.length<=o&&this.buffer.push(0),a&&(this.buffer[o]|=128>>>this.length%8),this.length++}};var Iue=Yz,Rs={glog:function(a){if(a<1)throw new Error("glog("+a+")");return Rs.LOG_TABLE[a]},gexp:function(a){for(;a<0;)a+=255;for(;a>=256;)a-=255;return Rs.EXP_TABLE[a]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)};for(var zn=0;zn<8;zn++)Rs.EXP_TABLE[zn]=1<<zn;for(var zn=8;zn<256;zn++)Rs.EXP_TABLE[zn]=Rs.EXP_TABLE[zn-4]^Rs.EXP_TABLE[zn-5]^Rs.EXP_TABLE[zn-6]^Rs.EXP_TABLE[zn-8];for(var zn=0;zn<255;zn++)Rs.LOG_TABLE[Rs.EXP_TABLE[zn]]=zn;var Qz=Rs,Io=Qz;function vm(a,o){if(a.length==null)throw new Error(a.length+"/"+o);for(var d=0;d<a.length&&a[d]==0;)d++;this.num=new Array(a.length-d+o);for(var f=0;f<a.length-d;f++)this.num[f]=a[f+d]}vm.prototype={get:function(a){return this.num[a]},getLength:function(){return this.num.length},multiply:function(a){for(var o=new Array(this.getLength()+a.getLength()-1),d=0;d<this.getLength();d++)for(var f=0;f<a.getLength();f++)o[d+f]^=Io.gexp(Io.glog(this.get(d))+Io.glog(a.get(f)));return new vm(o,0)},mod:function(a){if(this.getLength()-a.getLength()<0)return this;for(var o=Io.glog(this.get(0))-Io.glog(a.get(0)),d=new Array(this.getLength()),f=0;f<this.getLength();f++)d[f]=this.get(f);for(var f=0;f<a.getLength();f++)d[f]^=Io.gexp(Io.glog(a.get(f))+o);return new vm(d,0).mod(a)}};var Jz=vm,rs=Uz,WE=Jz,Sue=Qz,hi={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},Ln={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(a){for(var o=a<<10;Ln.getBCHDigit(o)-Ln.getBCHDigit(Ln.G15)>=0;)o^=Ln.G15<<Ln.getBCHDigit(o)-Ln.getBCHDigit(Ln.G15);return(a<<10|o)^Ln.G15_MASK},getBCHTypeNumber:function(a){for(var o=a<<12;Ln.getBCHDigit(o)-Ln.getBCHDigit(Ln.G18)>=0;)o^=Ln.G18<<Ln.getBCHDigit(o)-Ln.getBCHDigit(Ln.G18);return a<<12|o},getBCHDigit:function(a){for(var o=0;a!=0;)o++,a>>>=1;return o},getPatternPosition:function(a){return Ln.PATTERN_POSITION_TABLE[a-1]},getMask:function(a,o,d){switch(a){case hi.PATTERN000:return(o+d)%2==0;case hi.PATTERN001:return o%2==0;case hi.PATTERN010:return d%3==0;case hi.PATTERN011:return(o+d)%3==0;case hi.PATTERN100:return(Math.floor(o/2)+Math.floor(d/3))%2==0;case hi.PATTERN101:return o*d%2+o*d%3==0;case hi.PATTERN110:return(o*d%2+o*d%3)%2==0;case hi.PATTERN111:return(o*d%3+(o+d)%2)%2==0;default:throw new Error("bad maskPattern:"+a)}},getErrorCorrectPolynomial:function(a){for(var o=new WE([1],0),d=0;d<a;d++)o=o.multiply(new WE([1,Sue.gexp(d)],0));return o},getLengthInBits:function(a,o){if(1<=o&&o<10)switch(a){case rs.MODE_NUMBER:return 10;case rs.MODE_ALPHA_NUM:return 9;case rs.MODE_8BIT_BYTE:return 8;case rs.MODE_KANJI:return 8;default:throw new Error("mode:"+a)}else if(o<27)switch(a){case rs.MODE_NUMBER:return 12;case rs.MODE_ALPHA_NUM:return 11;case rs.MODE_8BIT_BYTE:return 16;case rs.MODE_KANJI:return 10;default:throw new Error("mode:"+a)}else if(o<41)switch(a){case rs.MODE_NUMBER:return 14;case rs.MODE_ALPHA_NUM:return 13;case rs.MODE_8BIT_BYTE:return 16;case rs.MODE_KANJI:return 12;default:throw new Error("mode:"+a)}else throw new Error("type:"+o)},getLostPoint:function(a){for(var o=a.getModuleCount(),d=0,f=0;f<o;f++)for(var b=0;b<o;b++){for(var x=0,k=a.isDark(f,b),N=-1;N<=1;N++)if(!(f+N<0||o<=f+N))for(var E=-1;E<=1;E++)b+E<0||o<=b+E||N==0&&E==0||k==a.isDark(f+N,b+E)&&x++;x>5&&(d+=3+x-5)}for(var f=0;f<o-1;f++)for(var b=0;b<o-1;b++){var z=0;a.isDark(f,b)&&z++,a.isDark(f+1,b)&&z++,a.isDark(f,b+1)&&z++,a.isDark(f+1,b+1)&&z++,(z==0||z==4)&&(d+=3)}for(var f=0;f<o;f++)for(var b=0;b<o-6;b++)a.isDark(f,b)&&!a.isDark(f,b+1)&&a.isDark(f,b+2)&&a.isDark(f,b+3)&&a.isDark(f,b+4)&&!a.isDark(f,b+5)&&a.isDark(f,b+6)&&(d+=40);for(var b=0;b<o;b++)for(var f=0;f<o-6;f++)a.isDark(f,b)&&!a.isDark(f+1,b)&&a.isDark(f+2,b)&&a.isDark(f+3,b)&&a.isDark(f+4,b)&&!a.isDark(f+5,b)&&a.isDark(f+6,b)&&(d+=40);for(var W=0,b=0;b<o;b++)for(var f=0;f<o;f++)a.isDark(f,b)&&W++;var T=Math.abs(100*W/o/o-50)/5;return d+=T*10,d}},Cue=Ln,Tue=wue,qz=kue,eW=Iue,$i=Cue,Nue=Jz;function oa(a,o){this.typeNumber=a,this.errorCorrectLevel=o,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}var Dr=oa.prototype;Dr.addData=function(a){var o=new Tue(a);this.dataList.push(o),this.dataCache=null};Dr.isDark=function(a,o){if(a<0||this.moduleCount<=a||o<0||this.moduleCount<=o)throw new Error(a+","+o);return this.modules[a][o]};Dr.getModuleCount=function(){return this.moduleCount};Dr.make=function(){if(this.typeNumber<1){var a=1;for(a=1;a<40;a++){for(var o=qz.getRSBlocks(a,this.errorCorrectLevel),d=new eW,f=0,b=0;b<o.length;b++)f+=o[b].dataCount;for(var b=0;b<this.dataList.length;b++){var x=this.dataList[b];d.put(x.mode,4),d.put(x.getLength(),$i.getLengthInBits(x.mode,a)),x.write(d)}if(d.getLengthInBits()<=f*8)break}this.typeNumber=a}this.makeImpl(!1,this.getBestMaskPattern())};Dr.makeImpl=function(a,o){this.moduleCount=this.typeNumber*4+17,this.modules=new Array(this.moduleCount);for(var d=0;d<this.moduleCount;d++){this.modules[d]=new Array(this.moduleCount);for(var f=0;f<this.moduleCount;f++)this.modules[d][f]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(a,o),this.typeNumber>=7&&this.setupTypeNumber(a),this.dataCache==null&&(this.dataCache=oa.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,o)};Dr.setupPositionProbePattern=function(a,o){for(var d=-1;d<=7;d++)if(!(a+d<=-1||this.moduleCount<=a+d))for(var f=-1;f<=7;f++)o+f<=-1||this.moduleCount<=o+f||(0<=d&&d<=6&&(f==0||f==6)||0<=f&&f<=6&&(d==0||d==6)||2<=d&&d<=4&&2<=f&&f<=4?this.modules[a+d][o+f]=!0:this.modules[a+d][o+f]=!1)};Dr.getBestMaskPattern=function(){for(var a=0,o=0,d=0;d<8;d++){this.makeImpl(!0,d);var f=$i.getLostPoint(this);(d==0||a>f)&&(a=f,o=d)}return o};Dr.createMovieClip=function(a,o,d){var f=a.createEmptyMovieClip(o,d),b=1;this.make();for(var x=0;x<this.modules.length;x++)for(var k=x*b,N=0;N<this.modules[x].length;N++){var E=N*b,z=this.modules[x][N];z&&(f.beginFill(0,100),f.moveTo(E,k),f.lineTo(E+b,k),f.lineTo(E+b,k+b),f.lineTo(E,k+b),f.endFill())}return f};Dr.setupTimingPattern=function(){for(var a=8;a<this.moduleCount-8;a++)this.modules[a][6]==null&&(this.modules[a][6]=a%2==0);for(var o=8;o<this.moduleCount-8;o++)this.modules[6][o]==null&&(this.modules[6][o]=o%2==0)};Dr.setupPositionAdjustPattern=function(){for(var a=$i.getPatternPosition(this.typeNumber),o=0;o<a.length;o++)for(var d=0;d<a.length;d++){var f=a[o],b=a[d];if(this.modules[f][b]==null)for(var x=-2;x<=2;x++)for(var k=-2;k<=2;k++)x==-2||x==2||k==-2||k==2||x==0&&k==0?this.modules[f+x][b+k]=!0:this.modules[f+x][b+k]=!1}};Dr.setupTypeNumber=function(a){for(var o=$i.getBCHTypeNumber(this.typeNumber),d=0;d<18;d++){var f=!a&&(o>>d&1)==1;this.modules[Math.floor(d/3)][d%3+this.moduleCount-8-3]=f}for(var d=0;d<18;d++){var f=!a&&(o>>d&1)==1;this.modules[d%3+this.moduleCount-8-3][Math.floor(d/3)]=f}};Dr.setupTypeInfo=function(a,o){for(var d=this.errorCorrectLevel<<3|o,f=$i.getBCHTypeInfo(d),b=0;b<15;b++){var x=!a&&(f>>b&1)==1;b<6?this.modules[b][8]=x:b<8?this.modules[b+1][8]=x:this.modules[this.moduleCount-15+b][8]=x}for(var b=0;b<15;b++){var x=!a&&(f>>b&1)==1;b<8?this.modules[8][this.moduleCount-b-1]=x:b<9?this.modules[8][15-b-1+1]=x:this.modules[8][15-b-1]=x}this.modules[this.moduleCount-8][8]=!a};Dr.mapData=function(a,o){for(var d=-1,f=this.moduleCount-1,b=7,x=0,k=this.moduleCount-1;k>0;k-=2)for(k==6&&k--;;){for(var N=0;N<2;N++)if(this.modules[f][k-N]==null){var E=!1;x<a.length&&(E=(a[x]>>>b&1)==1);var z=$i.getMask(o,f,k-N);z&&(E=!E),this.modules[f][k-N]=E,b--,b==-1&&(x++,b=7)}if(f+=d,f<0||this.moduleCount<=f){f-=d,d=-d;break}}};oa.PAD0=236;oa.PAD1=17;oa.createData=function(a,o,d){for(var f=qz.getRSBlocks(a,o),b=new eW,x=0;x<d.length;x++){var k=d[x];b.put(k.mode,4),b.put(k.getLength(),$i.getLengthInBits(k.mode,a)),k.write(b)}for(var N=0,x=0;x<f.length;x++)N+=f[x].dataCount;if(b.getLengthInBits()>N*8)throw new Error("code length overflow. ("+b.getLengthInBits()+">"+N*8+")");for(b.getLengthInBits()+4<=N*8&&b.put(0,4);b.getLengthInBits()%8!=0;)b.putBit(!1);for(;!(b.getLengthInBits()>=N*8||(b.put(oa.PAD0,8),b.getLengthInBits()>=N*8));)b.put(oa.PAD1,8);return oa.createBytes(b,f)};oa.createBytes=function(a,o){for(var d=0,f=0,b=0,x=new Array(o.length),k=new Array(o.length),N=0;N<o.length;N++){var E=o[N].dataCount,z=o[N].totalCount-E;f=Math.max(f,E),b=Math.max(b,z),x[N]=new Array(E);for(var W=0;W<x[N].length;W++)x[N][W]=255&a.buffer[W+d];d+=E;var T=$i.getErrorCorrectPolynomial(z),A=new Nue(x[N],T.getLength()-1),Y=A.mod(T);k[N]=new Array(T.getLength()-1);for(var W=0;W<k[N].length;W++){var M=W+Y.getLength()-k[N].length;k[N][W]=M>=0?Y.get(M):0}}for(var B=0,W=0;W<o.length;W++)B+=o[W].totalCount;for(var H=new Array(B),O=0,W=0;W<f;W++)for(var N=0;N<o.length;N++)W<x[N].length&&(H[O++]=x[N][W]);for(var W=0;W<b;W++)for(var N=0;N<o.length;N++)W<k[N].length&&(H[O++]=k[N][W]);return H};var Rue=oa,hw={};Object.defineProperty(hw,"__esModule",{value:!0});var Eue=Object.assign||function(a){for(var o=1;o<arguments.length;o++){var d=arguments[o];for(var f in d)Object.prototype.hasOwnProperty.call(d,f)&&(a[f]=d[f])}return a},Lue=_z,ss=nW(Lue),tW=Q,em=nW(tW);function nW(a){return a&&a.__esModule?a:{default:a}}function Gue(a,o){var d={};for(var f in a)o.indexOf(f)>=0||Object.prototype.hasOwnProperty.call(a,f)&&(d[f]=a[f]);return d}var zue={bgColor:ss.default.oneOfType([ss.default.object,ss.default.string]).isRequired,bgD:ss.default.string.isRequired,fgColor:ss.default.oneOfType([ss.default.object,ss.default.string]).isRequired,fgD:ss.default.string.isRequired,size:ss.default.number.isRequired,title:ss.default.string,viewBoxSize:ss.default.number.isRequired,xmlns:ss.default.string},pw=(0,tW.forwardRef)(function(a,o){var d=a.bgColor,f=a.bgD,b=a.fgD,x=a.fgColor,k=a.size,N=a.title,E=a.viewBoxSize,z=a.xmlns,W=z===void 0?"http://www.w3.org/2000/svg":z,T=Gue(a,["bgColor","bgD","fgD","fgColor","size","title","viewBoxSize","xmlns"]);return em.default.createElement("svg",Eue({},T,{height:k,ref:o,viewBox:"0 0 "+E+" "+E,width:k,xmlns:W}),N?em.default.createElement("title",null,N):null,em.default.createElement("path",{d:f,fill:d}),em.default.createElement("path",{d:b,fill:x}))});pw.displayName="QRCodeSvg";pw.propTypes=zue;hw.default=pw;Object.defineProperty(vg,"__esModule",{value:!0});vg.QRCode=void 0;var Wue=Object.assign||function(a){for(var o=1;o<arguments.length;o++){var d=arguments[o];for(var f in d)Object.prototype.hasOwnProperty.call(d,f)&&(a[f]=d[f])}return a},Mue=_z,Ca=ih(Mue),$ue=Hz,Fue=ih($ue),Vue=Rue,Pue=ih(Vue),rW=Q,Xue=ih(rW),Oue=hw,Due=ih(Oue);function ih(a){return a&&a.__esModule?a:{default:a}}function Aue(a,o){var d={};for(var f in a)o.indexOf(f)>=0||Object.prototype.hasOwnProperty.call(a,f)&&(d[f]=a[f]);return d}var Kue={bgColor:Ca.default.oneOfType([Ca.default.object,Ca.default.string]),fgColor:Ca.default.oneOfType([Ca.default.object,Ca.default.string]),level:Ca.default.string,size:Ca.default.number,value:Ca.default.string.isRequired},wg=(0,rW.forwardRef)(function(a,o){var d=a.bgColor,f=d===void 0?"#FFFFFF":d,b=a.fgColor,x=b===void 0?"#000000":b,k=a.level,N=k===void 0?"L":k,E=a.size,z=E===void 0?256:E,W=a.value,T=Aue(a,["bgColor","fgColor","level","size","value"]),A=new Pue.default(-1,Fue.default[N]);A.addData(W),A.make();var Y=A.modules;return Xue.default.createElement(Due.default,Wue({},T,{bgColor:f,bgD:Y.map(function(M,B){return M.map(function(H,O){return H?"":"M "+O+" "+B+" l 1 0 0 1 -1 0 Z"}).join(" ")}).join(" "),fgColor:x,fgD:Y.map(function(M,B){return M.map(function(H,O){return H?"M "+O+" "+B+" l 1 0 0 1 -1 0 Z":""}).join(" ")}).join(" "),ref:o,size:z,viewBoxSize:Y.length}))});vg.QRCode=wg;wg.displayName="QRCode";wg.propTypes=Kue;var Zue=vg.default=wg;const Bue=()=>{const a=Jd(),[o,d]=Q.useState(JSON.parse(localStorage.getItem("user")||"{}")),[f,b]=Q.useState([]),[x,k]=Q.useState(!1),[N,E]=Q.useState({clientName:"",videoUrl:"",markerUrl:"",pinCode:""}),[z,W]=Q.useState(!1),[T,A]=Q.useState(!1),[Y,M]=Q.useState(null),[B,H]=Q.useState("");Q.useEffect(()=>{if(O(),!window.MINDAR){const fe=document.createElement("script");fe.src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image.prod.js",fe.async=!0,fe.onload=()=>console.log("MindAR Compiler Loaded"),document.body.appendChild(fe)}},[]);const O=async()=>{var fe;try{const ge=localStorage.getItem("token"),[be,Ve]=await Promise.all([mt.get("/api/auth/me",{headers:{Authorization:`Bearer ${ge}`}}),mt.get("/api/shop/gifts",{headers:{Authorization:`Bearer ${ge}`}})]);d(be.data),localStorage.setItem("user",JSON.stringify(be.data)),b(Ve.data)}catch(ge){console.error("Fetch Data Error:",ge),((fe=ge.response)==null?void 0:fe.status)===401&&(localStorage.clear(),a("/login"))}},P=()=>{localStorage.clear(),a("/login")},X=async(fe,ge)=>{var Gt,Ht;const be=fe.target.files[0];if(!be)return;if(ge==="markerUrl"&&be.size>5*1024*1024){alert("Rasm hajmi juda katta! 5MB dan kichik rasm yuklang.");return}console.log(`Starting Upload [${ge}]:`,be.name,`Size: ${(be.size/1024/1024).toFixed(2)} MB`),W(!0);const Ve=new FormData;Ve.append("file",be);const Oe=localStorage.getItem("token");try{const zt=await mt.post("/api/shop/upload",Ve,{headers:{Authorization:`Bearer ${Oe}`,"Content-Type":"multipart/form-data"}});console.log("Upload Success:",zt.data),E(Vt=>({...Vt,[ge]:zt.data.url})),ia.success("Fayl yuklandi")}catch(zt){console.error("Upload Error:",zt);const Vt=((Ht=(Gt=zt.response)==null?void 0:Gt.data)==null?void 0:Ht.error)||zt.message||"Yuklashda xatolik";alert(`XATOLIK: ${Vt}`),ia.error(Vt)}finally{W(!1)}},ie=async fe=>new Promise((ge,be)=>{if(!window.MINDAR||!window.MINDAR.IMAGE){be(new Error("MindAR Compiler script not loaded yet. Please refresh."));return}const Ve=new Image;Ve.crossOrigin="Anonymous",Ve.onload=async()=>{try{const Oe=new window.MINDAR.IMAGE.Compiler;console.log("Starting Compilation..."),await Oe.compileImageTargets([Ve],Vt=>{console.log("Compile Progress:",Vt),H(`Tayyorlanmoqda... ${Vt.toFixed(0)}%`)});const Gt=await Oe.exportData(),Ht=new Blob([Gt]),zt=new File([Ht],"targets.mind",{type:"application/octet-stream"});ge(zt)}catch(Oe){be(Oe)}},Ve.onerror=Oe=>be(new Error("Failed to load image for compilation.")),Ve.src=fe}),oe=async()=>{var ge;if(!N.clientName)return alert("Iltimos, Mijoz ismini kiriting!");if(!N.videoUrl)return alert("Video yuklanmagan!");if(!N.markerUrl)return alert("Rasm (Marker) yuklanmagan!");if(o.balance<=0){alert("Sizda yetarli limit mavjud emas! Administratorga murojaat qiling.");return}A(!0),H("Boshlanmoqda...");const fe=localStorage.getItem("token");try{console.log("Step 1: Client-Side Compilation..."),H("AR Fayl tayyorlanmoqda... (Brauzerda)");const be=await ie(N.markerUrl);console.log("Mind File Compiled:",be.name,be.size),console.log("Step 2: Uploading .mind file..."),H("AR Fayl yuklanmoqda...");const Ve=new FormData;Ve.append("file",be);const Gt=(await mt.post("/api/shop/upload-mind",Ve,{headers:{Authorization:`Bearer ${fe}`,"Content-Type":"multipart/form-data"}})).data.mindUrl;console.log("Mind File Uploaded:",Gt),console.log("Step 3: Creating Gift Transaction..."),H("Saqlanmoqda...");const Ht={...N,targetFile:Gt},zt=await mt.post("/api/shop/gifts",Ht,{headers:{Authorization:`Bearer ${fe}`}});console.log("Gift Created:",zt.data),M(zt.data.gift),alert("Muvaffaqiyatli yaratildi! Balansdan 1 limit yechildi."),ia.success("Sovg'a yaratildi (-1 Credit)"),k(!1),E({clientName:"",videoUrl:"",markerUrl:"",pinCode:""}),O()}catch(be){console.error("FULL ERROR:",be);const Ve=JSON.stringify(((ge=be.response)==null?void 0:ge.data)||be.message,null,2);alert(`XATOLIK YUZ BERDI:

`+Ve)}finally{A(!1),H("")}};return te.jsxs("div",{className:"min-h-screen bg-pinhan-black text-white p-4 pb-20",children:[te.jsx(xg,{position:"top-center"}),te.jsxs("header",{className:"flex justify-between items-center mb-6",children:[te.jsxs("div",{children:[te.jsx("h1",{className:"text-xl font-bold text-pinhan-gold",children:o.shopName}),te.jsxs("p",{className:"text-xs text-zinc-500",children:["Shop ID: ",o.username]})]}),te.jsxs("div",{className:"text-right",children:[te.jsxs("span",{className:"block text-2xl font-bold",children:[o.balance," CR"]}),te.jsx("button",{onClick:P,className:"text-xs text-red-400",children:"Chiqish"})]})]}),!x&&!Y&&te.jsxs("button",{onClick:()=>k(!0),className:"w-full py-6 bg-gradient-to-r from-pinhan-gold to-yellow-600 rounded-2xl text-black font-bold text-xl shadow-lg hover:scale-[1.02] transition-transform mb-8 flex items-center justify-center gap-2",children:[te.jsx("span",{children:"+"})," YANGI SOVG'A"]}),x&&te.jsxs("div",{className:"bg-zinc-900 p-6 rounded-2xl border border-zinc-700 mb-8 animate-fade-in",children:[te.jsx("h2",{className:"text-lg font-bold mb-4",children:"1. Sovg'a Ma'lumotlari"}),te.jsxs("div",{className:"space-y-4",children:[te.jsx("input",{placeholder:"Mijoz Ismi",className:"w-full bg-black p-3 rounded border border-zinc-700 focus:border-pinhan-gold outline-none",value:N.clientName,onChange:fe=>E({...N,clientName:fe.target.value})}),te.jsx("input",{placeholder:"PIN (Ixtiyoriy)",className:"w-full bg-black p-3 rounded border border-zinc-700 focus:border-pinhan-gold outline-none",value:N.pinCode,onChange:fe=>E({...N,pinCode:fe.target.value})}),te.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[te.jsxs("label",{className:`block p-4 rounded border text-center cursor-pointer ${N.videoUrl?"border-green-500 text-green-500":"border-dashed border-zinc-600"}`,children:[te.jsx("span",{className:"text-sm",children:" Video Yuklash"}),te.jsx("input",{type:"file",accept:"video/*",className:"hidden",onChange:fe=>X(fe,"videoUrl")}),z&&te.jsx("span",{className:"block text-xs text-yellow-500 mt-1",children:"Yuklanmoqda..."})]}),te.jsxs("label",{className:`block p-4 rounded border text-center cursor-pointer ${N.markerUrl?"border-green-500 text-green-500":"border-dashed border-zinc-600"}`,children:[te.jsx("span",{className:"text-sm",children:" Rasm Yuklash"}),te.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:fe=>X(fe,"markerUrl")}),z&&te.jsx("span",{className:"block text-xs text-yellow-500 mt-1",children:"Yuklanmoqda..."})]})]}),te.jsxs("div",{className:"flex gap-2 mt-4",children:[te.jsx("button",{onClick:()=>k(!1),className:"flex-1 py-3 rounded bg-zinc-800",children:"Bekor qilish"}),te.jsx("button",{onClick:oe,disabled:z||T,className:`flex-1 py-3 rounded text-black font-bold transition-all ${T?"bg-yellow-800 cursor-wait":"bg-pinhan-gold"}`,children:T?B||"YARATILMOQDA...":"YARATISH (-1 CR)"})]})]})]}),Y&&te.jsx("div",{className:"fixed inset-0 z-50 bg-black/90 flex items-center justify-center p-4",children:te.jsxs("div",{className:"bg-white text-black p-6 rounded-xl max-w-sm w-full text-center",children:[te.jsx("h2",{className:"text-2xl font-bold mb-4 text-pinhan-gold",children:"Tayyor! "}),te.jsxs("div",{id:"print-area",className:"border-4 border-black p-4 rounded-lg bg-white relative overflow-hidden mb-4",children:[te.jsxs("div",{className:"absolute top-0 left-0 bg-pinhan-gold text-xs font-bold px-2 py-1",children:["PIN: ",Y.pinCode]}),te.jsx("img",{src:Y.thumbnailUrl,className:"w-full h-40 object-cover rounded mb-4 border border-gray-200",alt:"marker"}),te.jsx("div",{className:"flex justify-center my-2",children:te.jsx(Zue,{value:`${window.location.origin}/view?id=${Y._id}`,size:100})}),te.jsx("p",{className:"font-bold uppercase tracking-widest mt-2",children:o.shopName}),te.jsx("p",{className:"text-xs text-gray-500",children:"Scan to watch the message"})]}),te.jsx("button",{onClick:()=>window.print(),className:"w-full py-3 bg-black text-white rounded font-bold mb-2",children:" Chop Etish"}),te.jsx("button",{onClick:()=>M(null),className:"w-full py-2 text-zinc-500",children:"Yopish"})]})}),te.jsx("h3",{className:"text-zinc-500 text-sm font-bold mb-4 uppercase tracking-widest",children:"Tarix"}),te.jsx("div",{className:"space-y-3",children:f.map(fe=>te.jsxs("div",{className:"bg-zinc-900 p-4 rounded-xl flex gap-4 items-center border border-zinc-800",children:[te.jsx("img",{src:fe.thumbnailUrl,className:"w-12 h-12 object-cover rounded bg-zinc-800",alt:"thumb"}),te.jsxs("div",{className:"flex-1",children:[te.jsx("h4",{className:"font-bold text-white",children:fe.clientName}),te.jsxs("p",{className:"text-xs text-zinc-500",children:["PIN: ",fe.pinCode,"  ",new Date(fe.createdAt).toLocaleDateString()]})]}),te.jsx("button",{onClick:()=>M(fe),className:"text-2xl",children:""})]},fe._id))}),te.jsx("style",{children:`
                @media print {
                    body * { visibility: hidden; }
                    #print-area, #print-area * { visibility: visible; }
                    #print-area { position: absolute; left: 0; top: 0; width: 100%; height: 100%; border: none; }
                }
            `})]})},_ue=()=>{const a=Jd(),[o,d]=Q.useState([]),[f,b]=Q.useState(!1),[x,k]=Q.useState(null),[N,E]=Q.useState(10),[z,W]=Q.useState(!1),[T,A]=Q.useState({username:"",password:"",shopName:""});Q.useEffect(()=>{Y()},[]);const Y=async()=>{var O;const H=localStorage.getItem("token");try{const P=await mt.get("/api/admin/shops",{headers:{Authorization:`Bearer ${H}`}});d(P.data)}catch(P){console.error(P),((O=P.response)==null?void 0:O.status)===401&&(localStorage.clear(),a("/login"))}},M=async()=>{try{const H=localStorage.getItem("token");await mt.post(`/api/admin/shops/${x._id}/credit`,{amount:N},{headers:{Authorization:`Bearer ${H}`}}),ia.success(`${N} CR qo'shildi!`),b(!1),Y()}catch{ia.error("Xatolik yuz berdi")}},B=async()=>{var H,O;try{const P=localStorage.getItem("token");await mt.post("/api/admin/shops",T,{headers:{Authorization:`Bearer ${P}`}}),ia.success("Do'kon muvaffaqiyatli yaratildi"),W(!1),A({username:"",password:"",shopName:""}),Y()}catch(P){ia.error(((O=(H=P.response)==null?void 0:H.data)==null?void 0:O.error)||"Xatolik")}};return te.jsxs("div",{className:"min-h-screen bg-zinc-900 text-white p-6",children:[te.jsx(xg,{position:"top-right"}),te.jsxs("header",{className:"flex justify-between items-center mb-8 pb-4 border-b border-zinc-800",children:[te.jsx("h1",{className:"text-2xl font-bold text-pinhan-gold uppercase tracking-wider",children:"Do'konlar Boshqaruvi"}),te.jsx("button",{onClick:()=>{localStorage.clear(),a("/login")},className:"text-xs text-red-400 hover:text-red-300 transition-colors",children:"CHIQISH"})]}),te.jsx("div",{className:"mb-8",children:te.jsxs("button",{onClick:()=>W(!0),className:"bg-pinhan-gold hover:bg-yellow-500 text-black font-bold py-4 px-8 rounded-xl shadow-lg transition-all transform hover:scale-[1.02] flex items-center gap-2",children:[te.jsx("span",{className:"text-xl",children:"+"})," Yangi Do'kon Qo'shish"]})}),te.jsx("div",{className:"bg-black rounded-2xl overflow-hidden border border-zinc-800 shadow-xl",children:te.jsxs("table",{className:"w-full text-left",children:[te.jsx("thead",{className:"bg-zinc-900 text-zinc-500 text-xs uppercase tracking-wider",children:te.jsxs("tr",{children:[te.jsx("th",{className:"p-5 font-medium",children:"Do'kon Nomi"}),te.jsx("th",{className:"p-5 font-medium",children:"Login"}),te.jsx("th",{className:"p-5 font-medium",children:"Hozirgi Balans (Credits)"}),te.jsx("th",{className:"p-5 font-medium",children:"Harakat"})]})}),te.jsx("tbody",{className:"divide-y divide-zinc-800",children:o.length===0?te.jsx("tr",{children:te.jsx("td",{colSpan:"4",className:"p-8 text-center text-zinc-500",children:"Hozircha do'konlar yo'q."})}):o.map(H=>te.jsxs("tr",{className:"hover:bg-zinc-900/40 transition-colors group",children:[te.jsx("td",{className:"p-5 font-bold text-white text-lg",children:H.shopName}),te.jsx("td",{className:"p-5 text-zinc-400 font-mono",children:H.username}),te.jsx("td",{className:"p-5",children:te.jsxs("span",{className:`inline-block px-3 py-1 rounded-md font-mono font-bold ${H.balance<5?"bg-red-900/30 text-red-500":"bg-green-900/30 text-green-400"}`,children:[H.balance," CR"]})}),te.jsx("td",{className:"p-5",children:te.jsx("button",{onClick:()=>{k(H),b(!0)},className:"bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg font-bold text-sm shadow transition-all hover:shadow-green-900/50 flex items-center gap-2",children:"[+] Limit Qo'shish"})})]},H._id))})]})}),f&&te.jsx("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-fade-in",children:te.jsxs("div",{className:"bg-zinc-900 p-8 rounded-2xl w-full max-w-sm border border-zinc-700 shadow-2xl",children:[te.jsx("h3",{className:"text-xl font-bold mb-2 text-white",children:"Balans To'ldirish"}),te.jsxs("p",{className:"text-zinc-500 mb-6",children:["Do'kon: ",te.jsx("span",{className:"text-pinhan-gold",children:x==null?void 0:x.shopName})]}),te.jsx("div",{className:"flex gap-2 mb-4",children:[10,50,100].map(H=>te.jsxs("button",{onClick:()=>E(H),className:`flex-1 py-3 rounded-lg font-bold border transition-colors ${N===H?"bg-pinhan-gold text-black border-pinhan-gold":"bg-transparent border-zinc-700 hover:border-zinc-500"}`,children:["+",H]},H))}),te.jsxs("div",{className:"mb-6",children:[te.jsx("label",{className:"text-xs text-zinc-500 mb-1 block",children:"Yoki qo'lda kiriting:"}),te.jsx("input",{type:"number",value:N,onChange:H=>E(H.target.value),className:"w-full bg-black p-4 rounded-lg text-center text-2xl font-bold text-white border border-zinc-700 focus:border-pinhan-gold outline-none"})]}),te.jsxs("button",{onClick:M,className:"w-full bg-green-600 hover:bg-green-500 text-white py-4 rounded-xl font-bold mb-3 transition-colors shadow-lg shadow-green-900/20",children:["TASDIQLASH (+",N,")"]}),te.jsx("button",{onClick:()=>b(!1),className:"w-full bg-transparent hover:bg-zinc-800 text-zinc-400 py-3 rounded-xl transition-colors",children:"Bekor qilish"})]})}),z&&te.jsx("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-fade-in",children:te.jsxs("div",{className:"bg-zinc-900 p-8 rounded-2xl w-full max-w-md border border-zinc-700 shadow-2xl",children:[te.jsx("h3",{className:"text-xl font-bold mb-6 text-white border-b border-zinc-800 pb-4",children:"Yangi Do'kon Ro'yxatdan O'tkazish"}),te.jsxs("div",{className:"space-y-4 mb-8",children:[te.jsxs("div",{children:[te.jsx("label",{className:"block text-xs text-zinc-500 mb-1",children:"Do'kon Nomi (Brand)"}),te.jsx("input",{className:"w-full bg-black p-4 rounded-xl border border-zinc-700 text-white focus:border-pinhan-gold outline-none",placeholder:"Masalan: Flower Shop Tashkent",value:T.shopName,onChange:H=>A({...T,shopName:H.target.value})})]}),te.jsxs("div",{children:[te.jsx("label",{className:"block text-xs text-zinc-500 mb-1",children:"Login (Username)"}),te.jsx("input",{className:"w-full bg-black p-4 rounded-xl border border-zinc-700 text-white focus:border-pinhan-gold outline-none",placeholder:"login_name",value:T.username,onChange:H=>A({...T,username:H.target.value})})]}),te.jsxs("div",{children:[te.jsx("label",{className:"block text-xs text-zinc-500 mb-1",children:"Parol"}),te.jsx("input",{className:"w-full bg-black p-4 rounded-xl border border-zinc-700 text-white focus:border-pinhan-gold outline-none",placeholder:"",type:"password",value:T.password,onChange:H=>A({...T,password:H.target.value})})]})]}),te.jsx("button",{onClick:B,className:"w-full bg-pinhan-gold hover:bg-yellow-500 text-black py-4 rounded-xl font-bold mb-3 transition-colors shadow-lg shadow-yellow-900/20",children:"SAQLASH VA YARATISH"}),te.jsx("button",{onClick:()=>W(!1),className:"w-full bg-transparent hover:bg-zinc-800 text-zinc-400 py-3 rounded-xl transition-colors",children:"Bekor qilish"})]})})]})},ME=({children:a,roles:o})=>{const d=localStorage.getItem("token"),f=localStorage.getItem("user");if(!d||!f)return te.jsx(fE,{to:"/login",replace:!0});if(o&&o.length>0){const b=JSON.parse(f);if(!o.includes(b.role)){const x=b.role==="admin"?"/admin":"/shop";return te.jsx(fE,{to:x,replace:!0})}}return a};var tm={exports:{}},$E;function Hue(){return $E||($E=1,function(a,o){var d=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof Gl<"u")return Gl;throw new Error("unable to locate global object")},f=d();a.exports=o=f.fetch,f.fetch&&(o.default=f.fetch.bind(f)),o.Headers=f.Headers,o.Request=f.Request,o.Response=f.Response}(tm,tm.exports)),tm.exports}const Uue={},jue=Object.freeze(Object.defineProperty({__proto__:null,default:Uue},Symbol.toStringTag,{value:"Module"})),Yue=Yne(jue);var r1={};(function(){function a(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const o=1e-7,d=1e-4;class f{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class b{refCount(e){return x("refCount")}incRef(e){return x("incRef")}timerAvailable(){return!0}time(e){return x("time")}read(e){return x("read")}readSync(e){return x("readSync")}readToGPU(e,t){return x("readToGPU")}numDataIds(){return x("numDataIds")}disposeData(e,t){return x("disposeData")}write(e,t,r){return x("write")}move(e,t,r,s,i){return x("move")}createTensorFromGPUData(e,t,r){return x("createTensorFromGPUData")}memory(){return x("memory")}floatPrecision(){return x("floatPrecision")}epsilon(){return this.floatPrecision()===32?o:d}dispose(){return x("dispose")}}function x(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function k(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,z(n,e,t)}function N(n,e,t){return Math.max(n,Math.min(e,t))}function E(n){return n%2===0?n:n+1}function z(n,e,t){const r=n[e];n[e]=n[t],n[t]=r}function W(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function T(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function A(n,e,t=""){T(B(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function Y(n){T(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function M(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function B(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function H(n){return n%1===0}function O(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function P(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function X(n,e=s=>0,t,r){return new Promise((s,i)=>{let l=0;const u=()=>{if(n()){s();return}l++;const c=e(l);if(t!=null&&l>=t){i();return}r!=null?r(u,c):setTimeout(u,c)};u()})}function ie(n,e){let t=1,r=-1;for(let i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(n[i]===-1){if(r!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${i}`);r=i}else if(n[i]<0)throw Error(`Shapes can not be < 0. Found ${n[i]} at dim ${i}`);if(r===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const s=n.slice();return s[r]=e/t,s}function oe(n,e){const t=e.length;return n=n==null?e.map((r,s)=>s):[].concat(n),T(n.every(r=>r>=-t&&r<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),T(n.every(r=>H(r)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(r=>r<0?t+r:r)}function fe(n,e){const t=[],r=[],s=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||s?null:oe(e,n).sort();let l=0;for(let u=0;u<n.length;++u){if(i!=null){if(i[l]===u&&n[u]!==1)throw new Error(`Can't squeeze axis ${u} since its dim '${n[u]}' is not 1`);(i[l]==null||i[l]>u)&&n[u]===1&&(t.push(n[u]),r.push(u)),i[l]<=u&&l++}n[u]!==1&&(t.push(n[u]),r.push(u))}return{newShape:t,keptDims:r}}function ge(n,e){return be(n,e)}function be(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function Ve(n,e){for(let t=0;t<n.length;t++){const r=n[t];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}function Oe(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function Gt(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function Ht(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function zt(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function Vt(n){return typeof n=="string"||n instanceof String}function Do(n){return typeof n=="boolean"}function Ut(n){return typeof n=="number"}function Ir(n){return Array.isArray(n)?Ir(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":Ut(n)?"float32":Vt(n)?"string":Do(n)?"bool":"float32"}function Ge(n){return!!(n&&n.constructor&&n.call&&n.apply)}function _e(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function we(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function lt(n,e,t,r=!1){const s=new Array;if(e.length===1){const i=e[0]*(r?2:1);for(let l=0;l<i;l++)s[l]=t[n+l]}else{const i=e[0],l=e.slice(1),u=l.reduce((c,h)=>c*h)*(r?2:1);for(let c=0;c<i;c++)s[c]=lt(n+c*u,l,t,r)}return s}function nt(n,e,t=!1){if(n.length===0)return e[0];const r=n.reduce((s,i)=>s*i)*(t?2:1);if(r===0)return[];if(r!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return lt(0,n,e,t)}function Ms(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function $n(n,e){const t=Pt(n,e);for(let r=0;r<t.length;r++)t[r]=1;return t}function Pt(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function $s(n,e){const t=n.reduce((r,s)=>r*s,1);if(e==null||e==="float32")return nt(n,new Float32Array(t));if(e==="int32")return nt(n,new Int32Array(t));if(e==="bool")return nt(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function lr(n){n.forEach(e=>{T(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function Fs(n,e,t){if(e===0)return 0;if(e===1)return n[0];let r=n[n.length-1];for(let s=0;s<n.length-1;++s)r+=t[s]*n[s];return r}function Ao(n,e,t){if(e===0)return[];if(e===1)return[n];const r=new Array(e);for(let s=0;s<r.length-1;++s)r[s]=Math.floor(n/t[s]),n-=r[s]*t[s];return r[r.length-1]=n,r}function kg(n){return n&&n.then&&typeof n.then=="function"}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const fw="tfjsflags";class sW{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=aW,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(ae().getBool("IS_TEST")||ae().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){const s=this.urlFlags[e];ae().getBool("IS_TEST")||ae().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${s}.`),this.set(e,s)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(kg(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);fw in e&&e[fw].split(",").forEach(t=>{const[r,s]=t.split(":");this.urlFlags[r]=oW(r,s)})}}function aW(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...r)=>(iW(e,r[0],r[1]),r.join("="))),e}function iW(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function oW(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function ae(){return mw}let mw=null;function lW(n){mw=n}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/let Ig;function gw(){if(Ig==null){let n;if(typeof window<"u")n=window;else if(typeof Gl<"u")n=Gl;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");Ig=n}return Ig}function uW(){const n=gw();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function Sg(n,e){const t=uW();if(t.has(n))return t.get(n);{const r=e();return t.set(n,r),t.get(n)}}const oh="Abs",du="Acos",hu="Acosh",Ko="Add",Cg="AddN",Tg="All",Ng="Any",lh="ArgMax",uh="ArgMin",pu="Asin",fu="Asinh",mu="Atan",gu="Atanh",bu="Atan2",ch="AvgPool",Rg="AvgPoolGrad",dh="AvgPool3D",Eg="AvgPool3DGrad",hh="BatchMatMul",ph="BatchToSpaceND",Lg="Bincount",Gg="BitwiseAnd",cW="BroadcastTo",bw="BroadcastArgs",yu="Cast",xu="Ceil",vu="ClipByValue",zg="Complex",fh="ComplexAbs",mh="Concat",gh="Conv2D",Wg="Conv2DBackpropFilter",bh="Conv2DBackpropInput",yh="Conv3D",Mg="Conv3DBackpropFilterV2",$g="Conv3DBackpropInputV2",wu="Cos",ku="Cosh",Fg="Cumprod",xh="Cumsum",Vg="CropAndResize",Pg="DenseBincount",Xg="DepthToSpace",vh="DepthwiseConv2dNative",Og="DepthwiseConv2dNativeBackpropFilter",Dg="DepthwiseConv2dNativeBackpropInput",yw="Diag",wh="Dilation2D",Ag="Dilation2DBackpropInput",Kg="Dilation2DBackpropFilter",dW="Draw",Iu="RealDiv",Zg="Einsum",Su="Elu",Bg="EluGrad",Cu="Erf",kh="Equal",Tu="Exp",Ih="ExpandDims",Nu="Expm1",_g="FFT",Hg="Fill",Ug="FlipLeftRight",Ru="Floor",Eu="FloorDiv",Sh="FusedBatchNorm",Ch="GatherV2",xw="GatherNd",Th="Greater",Lu="GreaterEqual",Gu="Identity",jg="IFFT",Yg="Imag",zu="IsFinite",Wu="IsInf",Mu="IsNan",Nh="LeakyRelu",Rh="Less",Eh="LessEqual",vw="LinSpace",$u="Log",Fu="Log1p",Lh="LogicalAnd",Gh="LogicalNot",zh="LogicalOr",hW="LogSoftmax",Wh="LRN",Qg="LRNGrad",Mh="Max",Vu="Maximum",$h="MaxPool",Jg="MaxPoolGrad",Fh="MaxPool3D",qg="MaxPool3DGrad",ww="MaxPoolWithArgmax",Vh="Mean",Ph="Min",Pu="Minimum",Xh="MirrorPad",Xu="Mod",kw="Multinomial",Ou="Multiply",Oh="Neg",Dh="NotEqual",e0="NonMaxSuppressionV3",t0="NonMaxSuppressionV4",n0="NonMaxSuppressionV5",Ah="OnesLike",Kh="OneHot",Zh="Pack",Bh="PadV2",Du="Pow",_h="Prelu",Hh="Prod",Iw="RaggedGather",Sw="RaggedRange",Cw="RaggedTensorToTensor",r0="Range",s0="Real",Au="Reciprocal",Ku="Relu",Uh="Reshape",jh="ResizeNearestNeighbor",a0="ResizeNearestNeighborGrad",Yh="ResizeBilinear",i0="ResizeBilinearGrad",Zu="Relu6",Qh="Reverse",Bu="Round",_u="Rsqrt",Tw="ScatterNd",Nw="TensorScatterUpdate",Rw="SearchSorted",Jh="Select",Hu="Selu",qh="Slice",Uu="Sin",ju="Sinh",Yu="Sign",Qu="Sigmoid",Ju="Softplus",qu="Sqrt",ep="Sum",tp="SpaceToBatchND",np="SplitV",rp="Softmax",Ew="SparseFillEmptyRows",Lw="SparseReshape",Gw="SparseSegmentMean",zw="SparseSegmentSum",Ww="SparseToDense",ec="SquaredDifference",o0="Square",l0="StaticRegexReplace",u0="StridedSlice",Mw="StringNGrams",$w="StringSplit",Fw="StringToHashBucketFast",tc="Sub",nc="Tan",rc="Tanh",sc="Tile",c0="TopK",d0="Transform",Zo="Transpose",h0="Unique",sp="Unpack",ap="UnsortedSegmentSum",ip="ZerosLike",ac="Step",p0="FromPixels",f0="RotateWithOffset",op="_FusedMatMul",lp="FusedConv2D",Vw="FusedDepthwiseConv2D";/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Sr(...n){ae().getBool("IS_TEST")||ae().getBool("PROD")||console.warn(...n)}function pW(...n){ae().getBool("IS_TEST")||ae().getBool("PROD")||console.log(...n)}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const up=Sg("kernelRegistry",()=>new Map),m0=Sg("gradRegistry",()=>new Map);function g0(n,e){const t=Ow(n,e);return up.get(t)}function Pw(n){return m0.get(n)}function Xw(n){const e=up.entries(),t=[];for(;;){const{done:r,value:s}=e.next();if(r)break;const[i,l]=s,[u]=i.split("_");u===n&&t.push(l)}return t}function Cr(n){const{kernelName:e,backendName:t}=n,r=Ow(e,t);up.has(r)&&Sr(`The kernel '${e}' for backend '${t}' is already registered`),up.set(r,n)}function fW(n){const{kernelName:e}=n;m0.has(e)&&ae().getBool("DEBUG")&&Sr(`Overriding the gradient for '${e}'`),m0.set(e,n)}function Ow(n,e){return`${e}_${n}`}/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Dw(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var Fi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Gl<"u"?Gl:typeof self<"u"?self:{};function mW(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function gW(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}),t}var Aw=Ct,Ar=null;try{Ar=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Ct(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}Ct.prototype.__isLong__,Object.defineProperty(Ct.prototype,"__isLong__",{value:!0});function ur(n){return(n&&n.__isLong__)===!0}Ct.isLong=ur;var Kw={},Zw={};function Vi(n,e){var t,r,s;return e?(n>>>=0,(s=0<=n&&n<256)&&(r=Zw[n],r)?r:(t=Tt(n,(n|0)<0?-1:0,!0),s&&(Zw[n]=t),t)):(n|=0,(s=-128<=n&&n<128)&&(r=Kw[n],r)?r:(t=Tt(n,n<0?-1:0,!1),s&&(Kw[n]=t),t))}Ct.fromInt=Vi;function Kr(n,e){if(isNaN(n))return e?Pi:Zr;if(e){if(n<0)return Pi;if(n>=_w)return Qw}else{if(n<=-Hw)return cr;if(n+1>=Hw)return Yw}return n<0?Kr(-n,e).neg():Tt(n%Bo|0,n/Bo|0,e)}Ct.fromNumber=Kr;function Tt(n,e,t){return new Ct(n,e,t)}Ct.fromBits=Tt;var cp=Math.pow;function b0(n,e,t){if(n.length===0)throw Error("empty string");if(n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return Zr;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var r;if((r=n.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return b0(n.substring(1),e,t).neg();for(var s=Kr(cp(t,8)),i=Zr,l=0;l<n.length;l+=8){var u=Math.min(8,n.length-l),c=parseInt(n.substring(l,l+u),t);if(u<8){var h=Kr(cp(t,u));i=i.mul(h).add(Kr(c))}else i=i.mul(s),i=i.add(Kr(c))}return i.unsigned=e,i}Ct.fromString=b0;function ds(n,e){return typeof n=="number"?Kr(n,e):typeof n=="string"?b0(n,e):Tt(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}Ct.fromValue=ds;var Bw=65536,bW=1<<24,Bo=Bw*Bw,_w=Bo*Bo,Hw=_w/2,Uw=Vi(bW),Zr=Vi(0);Ct.ZERO=Zr;var Pi=Vi(0,!0);Ct.UZERO=Pi;var _o=Vi(1);Ct.ONE=_o;var jw=Vi(1,!0);Ct.UONE=jw;var y0=Vi(-1);Ct.NEG_ONE=y0;var Yw=Tt(-1,2147483647,!1);Ct.MAX_VALUE=Yw;var Qw=Tt(-1,-1,!0);Ct.MAX_UNSIGNED_VALUE=Qw;var cr=Tt(0,-2147483648,!1);Ct.MIN_VALUE=cr;var Ee=Ct.prototype;Ee.toInt=function(){return this.unsigned?this.low>>>0:this.low},Ee.toNumber=function(){return this.unsigned?(this.high>>>0)*Bo+(this.low>>>0):this.high*Bo+(this.low>>>0)},Ee.toString=function(n){if(n=n||10,n<2||36<n)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(cr)){var e=Kr(n),t=this.div(e),r=t.mul(e).sub(this);return t.toString(n)+r.toInt().toString(n)}else return"-"+this.neg().toString(n);for(var s=Kr(cp(n,6),this.unsigned),i=this,l="";;){var u=i.div(s),c=i.sub(u.mul(s)).toInt()>>>0,h=c.toString(n);if(i=u,i.isZero())return h+l;for(;h.length<6;)h="0"+h;l=""+h+l}},Ee.getHighBits=function(){return this.high},Ee.getHighBitsUnsigned=function(){return this.high>>>0},Ee.getLowBits=function(){return this.low},Ee.getLowBitsUnsigned=function(){return this.low>>>0},Ee.getNumBitsAbs=function(){if(this.isNegative())return this.eq(cr)?64:this.neg().getNumBitsAbs();for(var n=this.high!=0?this.high:this.low,e=31;e>0&&!(n&1<<e);e--);return this.high!=0?e+33:e+1},Ee.isZero=function(){return this.high===0&&this.low===0},Ee.eqz=Ee.isZero,Ee.isNegative=function(){return!this.unsigned&&this.high<0},Ee.isPositive=function(){return this.unsigned||this.high>=0},Ee.isOdd=function(){return(this.low&1)===1},Ee.isEven=function(){return(this.low&1)===0},Ee.equals=function(n){return ur(n)||(n=ds(n)),this.unsigned!==n.unsigned&&this.high>>>31===1&&n.high>>>31===1?!1:this.high===n.high&&this.low===n.low},Ee.eq=Ee.equals,Ee.notEquals=function(n){return!this.eq(n)},Ee.neq=Ee.notEquals,Ee.ne=Ee.notEquals,Ee.lessThan=function(n){return this.comp(n)<0},Ee.lt=Ee.lessThan,Ee.lessThanOrEqual=function(n){return this.comp(n)<=0},Ee.lte=Ee.lessThanOrEqual,Ee.le=Ee.lessThanOrEqual,Ee.greaterThan=function(n){return this.comp(n)>0},Ee.gt=Ee.greaterThan,Ee.greaterThanOrEqual=function(n){return this.comp(n)>=0},Ee.gte=Ee.greaterThanOrEqual,Ee.ge=Ee.greaterThanOrEqual,Ee.compare=function(n){if(ur(n)||(n=ds(n)),this.eq(n))return 0;var e=this.isNegative(),t=n.isNegative();return e&&!t?-1:!e&&t?1:this.unsigned?n.high>>>0>this.high>>>0||n.high===this.high&&n.low>>>0>this.low>>>0?-1:1:this.sub(n).isNegative()?-1:1},Ee.comp=Ee.compare,Ee.negate=function(){return!this.unsigned&&this.eq(cr)?cr:this.not().add(_o)},Ee.neg=Ee.negate,Ee.add=function(n){ur(n)||(n=ds(n));var e=this.high>>>16,t=this.high&65535,r=this.low>>>16,s=this.low&65535,i=n.high>>>16,l=n.high&65535,u=n.low>>>16,c=n.low&65535,h=0,p=0,m=0,g=0;return g+=s+c,m+=g>>>16,g&=65535,m+=r+u,p+=m>>>16,m&=65535,p+=t+l,h+=p>>>16,p&=65535,h+=e+i,h&=65535,Tt(m<<16|g,h<<16|p,this.unsigned)},Ee.subtract=function(n){return ur(n)||(n=ds(n)),this.add(n.neg())},Ee.sub=Ee.subtract,Ee.multiply=function(n){if(this.isZero())return Zr;if(ur(n)||(n=ds(n)),Ar){var e=Ar.mul(this.low,this.high,n.low,n.high);return Tt(e,Ar.get_high(),this.unsigned)}if(n.isZero())return Zr;if(this.eq(cr))return n.isOdd()?cr:Zr;if(n.eq(cr))return this.isOdd()?cr:Zr;if(this.isNegative())return n.isNegative()?this.neg().mul(n.neg()):this.neg().mul(n).neg();if(n.isNegative())return this.mul(n.neg()).neg();if(this.lt(Uw)&&n.lt(Uw))return Kr(this.toNumber()*n.toNumber(),this.unsigned);var t=this.high>>>16,r=this.high&65535,s=this.low>>>16,i=this.low&65535,l=n.high>>>16,u=n.high&65535,c=n.low>>>16,h=n.low&65535,p=0,m=0,g=0,y=0;return y+=i*h,g+=y>>>16,y&=65535,g+=s*h,m+=g>>>16,g&=65535,g+=i*c,m+=g>>>16,g&=65535,m+=r*h,p+=m>>>16,m&=65535,m+=s*c,p+=m>>>16,m&=65535,m+=i*u,p+=m>>>16,m&=65535,p+=t*h+r*c+s*u+i*l,p&=65535,Tt(g<<16|y,p<<16|m,this.unsigned)},Ee.mul=Ee.multiply,Ee.divide=function(n){if(ur(n)||(n=ds(n)),n.isZero())throw Error("division by zero");if(Ar){if(!this.unsigned&&this.high===-2147483648&&n.low===-1&&n.high===-1)return this;var e=(this.unsigned?Ar.div_u:Ar.div_s)(this.low,this.high,n.low,n.high);return Tt(e,Ar.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Pi:Zr;var t,r,s;if(this.unsigned){if(n.unsigned||(n=n.toUnsigned()),n.gt(this))return Pi;if(n.gt(this.shru(1)))return jw;s=Pi}else{if(this.eq(cr)){if(n.eq(_o)||n.eq(y0))return cr;if(n.eq(cr))return _o;var i=this.shr(1);return t=i.div(n).shl(1),t.eq(Zr)?n.isNegative()?_o:y0:(r=this.sub(n.mul(t)),s=t.add(r.div(n)),s)}else if(n.eq(cr))return this.unsigned?Pi:Zr;if(this.isNegative())return n.isNegative()?this.neg().div(n.neg()):this.neg().div(n).neg();if(n.isNegative())return this.div(n.neg()).neg();s=Zr}for(r=this;r.gte(n);){t=Math.max(1,Math.floor(r.toNumber()/n.toNumber()));for(var l=Math.ceil(Math.log(t)/Math.LN2),u=l<=48?1:cp(2,l-48),c=Kr(t),h=c.mul(n);h.isNegative()||h.gt(r);)t-=u,c=Kr(t,this.unsigned),h=c.mul(n);c.isZero()&&(c=_o),s=s.add(c),r=r.sub(h)}return s},Ee.div=Ee.divide,Ee.modulo=function(n){if(ur(n)||(n=ds(n)),Ar){var e=(this.unsigned?Ar.rem_u:Ar.rem_s)(this.low,this.high,n.low,n.high);return Tt(e,Ar.get_high(),this.unsigned)}return this.sub(this.div(n).mul(n))},Ee.mod=Ee.modulo,Ee.rem=Ee.modulo,Ee.not=function(){return Tt(~this.low,~this.high,this.unsigned)},Ee.and=function(n){return ur(n)||(n=ds(n)),Tt(this.low&n.low,this.high&n.high,this.unsigned)},Ee.or=function(n){return ur(n)||(n=ds(n)),Tt(this.low|n.low,this.high|n.high,this.unsigned)},Ee.xor=function(n){return ur(n)||(n=ds(n)),Tt(this.low^n.low,this.high^n.high,this.unsigned)},Ee.shiftLeft=function(n){return ur(n)&&(n=n.toInt()),(n&=63)===0?this:n<32?Tt(this.low<<n,this.high<<n|this.low>>>32-n,this.unsigned):Tt(0,this.low<<n-32,this.unsigned)},Ee.shl=Ee.shiftLeft,Ee.shiftRight=function(n){return ur(n)&&(n=n.toInt()),(n&=63)===0?this:n<32?Tt(this.low>>>n|this.high<<32-n,this.high>>n,this.unsigned):Tt(this.high>>n-32,this.high>=0?0:-1,this.unsigned)},Ee.shr=Ee.shiftRight,Ee.shiftRightUnsigned=function(n){if(ur(n)&&(n=n.toInt()),n&=63,n===0)return this;var e=this.high;if(n<32){var t=this.low;return Tt(t>>>n|e<<32-n,e>>>n,this.unsigned)}else return n===32?Tt(e,0,this.unsigned):Tt(e>>>n-32,0,this.unsigned)},Ee.shru=Ee.shiftRightUnsigned,Ee.shr_u=Ee.shiftRightUnsigned,Ee.toSigned=function(){return this.unsigned?Tt(this.low,this.high,!1):this},Ee.toUnsigned=function(){return this.unsigned?this:Tt(this.low,this.high,!0)},Ee.toBytes=function(n){return n?this.toBytesLE():this.toBytesBE()},Ee.toBytesLE=function(){var n=this.high,e=this.low;return[e&255,e>>>8&255,e>>>16&255,e>>>24,n&255,n>>>8&255,n>>>16&255,n>>>24]},Ee.toBytesBE=function(){var n=this.high,e=this.low;return[n>>>24,n>>>16&255,n>>>8&255,n&255,e>>>24,e>>>16&255,e>>>8&255,e&255]},Ct.fromBytes=function(n,e,t){return t?Ct.fromBytesLE(n,e):Ct.fromBytesBE(n,e)},Ct.fromBytesLE=function(n,e){return new Ct(n[0]|n[1]<<8|n[2]<<16|n[3]<<24,n[4]|n[5]<<8|n[6]<<16|n[7]<<24,e)},Ct.fromBytesBE=function(n,e){return new Ct(n[4]<<24|n[5]<<16|n[6]<<8|n[7],n[0]<<24|n[1]<<16|n[2]<<8|n[3],e)};const Jw=mW(Aw),yW=a({__proto__:null,default:Jw},[Aw]);/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Xi=Jw||yW;function dp(n){return Xi.fromString(n,!0,16)}const qw=dp("c3a5c85c97cb3127"),Oi=dp("b492b66fbe98f273"),Fn=dp("9ae16a3b2f90404f");function x0(n){return n.xor(n.shru(47))}function ek(n,e,t){const r=n.slice(e,e+t);return Xi.fromBytes(Array.from(r),!0,!0)}function xt(n,e){return ek(n,e,8)}function tk(n,e){return ek(n,e,4)}function fn(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function Xa(n,e,t=dp("9ddfea08eb382d69")){let r=n.xor(e).mul(t);r=r.xor(r.shru(47));let s=e.xor(r).mul(t);return s=s.xor(s.shru(47)),s=s.mul(t),s}function xW(n,e,t,r,s,i){s=s.add(n),i=fn(i.add(s).add(r),21);const l=s;return s=s.add(e),s=s.add(t),i=i.add(fn(s,44)),[s.add(r),i.add(l)]}function hp(n,e,t,r){return xW(xt(n,e),xt(n,e+8),xt(n,e+16),xt(n,e+24),t,r)}function vW(n,e=n.length){if(e>=8){const t=Fn.add(e*2),r=xt(n,0).add(Fn),s=xt(n,e-8),i=fn(s,37).mul(t).add(r),l=fn(r,25).add(s).mul(t);return Xa(i,l,t)}if(e>=4){const t=Fn.add(e*2),r=tk(n,0);return Xa(r.shl(3).add(e),tk(n,e-4),t)}if(e>0){const t=n[0],r=n[e>>1],s=n[e-1],i=t+(r<<8),l=e+(s<<2);return x0(Fn.mul(i).xor(qw.mul(l))).mul(Fn)}return Fn}function wW(n,e=n.length){const t=Fn.add(e*2),r=xt(n,0).mul(Oi),s=xt(n,8),i=xt(n,e-8).mul(t),l=xt(n,e-16).mul(Fn);return Xa(fn(r.add(s),43).add(fn(i,30)).add(l),r.add(fn(s.add(Fn),18)).add(i),t)}function kW(n,e=n.length){const t=Fn.add(e*2),r=xt(n,0).mul(Fn),s=xt(n,8),i=xt(n,e-8).mul(t),l=xt(n,e-16).mul(Fn),u=fn(r.add(s),43).add(fn(i,30)).add(l),c=Xa(u,r.add(fn(s.add(Fn),18)).add(i),t),h=xt(n,16).mul(t),p=xt(n,24),m=u.add(xt(n,e-32)).mul(t),g=c.add(xt(n,e-24)).mul(t);return Xa(fn(h.add(p),43).add(fn(m,30)).add(g),h.add(fn(p.add(r),18)).add(m),t)}function IW(n,e=n.length){const t=Xi.fromNumber(81,!0);if(e<=32)return e<=16?vW(n,e):wW(n,e);if(e<=64)return kW(n,e);let r=t,s=t.mul(Oi).add(113),i=x0(s.mul(Fn).add(113)).mul(Fn),l=[Xi.UZERO,Xi.UZERO],u=[Xi.UZERO,Xi.UZERO];r=r.mul(Fn).add(xt(n,0));let c=0;const h=(e-1>>6)*64,p=h+(e-1&63)-63;do r=fn(r.add(s).add(l[0]).add(xt(n,c+8)),37).mul(Oi),s=fn(s.add(l[1]).add(xt(n,c+48)),42).mul(Oi),r=r.xor(u[1]),s=s.add(l[0]).add(xt(n,c+40)),i=fn(i.add(u[0]),33).mul(Oi),l=hp(n,c,l[1].mul(Oi),r.add(u[0])),u=hp(n,c+32,i.add(u[1]),s.add(xt(n,c+16))),[i,r]=[r,i],c+=64;while(c!==h);const m=Oi.add(i.and(255).shl(1));return c=p,u[0]=u[0].add(e-1&63),l[0]=l[0].add(u[0]),u[0]=u[0].add(l[0]),r=fn(r.add(s).add(l[0]).add(xt(n,c+8)),37).mul(m),s=fn(s.add(l[1]).add(xt(n,c+48)),42).mul(m),r=r.xor(u[1].mul(9)),s=s.add(l[0].mul(9).add(xt(n,c+40))),i=fn(i.add(u[0]),33).mul(m),l=hp(n,c,l[1].mul(m),r.add(u[0])),u=hp(n,c+32,i.add(u[1]),s.add(xt(n,c+16))),[i,r]=[r,i],Xa(Xa(l[0],u[0],m).add(x0(s).mul(qw)).add(i),Xa(l[1],u[1],m).add(r),m)}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Oa(n,e){return e==="string"?Da(n):Di([n],e)}function SW(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function Di(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Ai(n)),ae().getBool("DEBUG")&&Ve(n,e),SW(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let r=0;r<t.length;++r)Math.round(n[r])!==0&&(t[r]=1);return t}else throw new Error(`Unknown data type ${e}`)}function Yn(){return ae().platform.now()}function Da(n,e="utf-8"){return e=e||"utf-8",ae().platform.encode(n,e)}function Aa(n,e="utf-8"){return e=e||"utf-8",ae().platform.decode(n,e)}function Br(n){return ae().platform.isTypedArray!=null?ae().platform.isTypedArray(n):Dw(n)}function Ai(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||kg(n)||n==null||Br(n)&&t)e.push(n);else if(Array.isArray(n)||Br(n))for(let r=0;r<n.length;++r)Ai(n[r],e,t);else{let r=-1;for(const s of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(s)&&(r=Math.max(r,Number(s)));for(let s=0;s<=r;s++)Ai(n[s],e,t)}return e}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class CW{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new NW)}profileKernel(e,t,r){let s;const i=()=>{s=r()};let l;const u=Yn();if(this.backendTimer.timerAvailable())l=this.backendTimer.time(i);else{i();for(const c of s)c.dataSync();l=Promise.resolve({kernelMs:Yn()-u})}if(ae().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<s.length;c++){const h=s[c];h.data().then(p=>{TW(p,h.dtype,e)})}return{kernelName:e,outputs:s,inputs:t,timeMs:l.then(c=>c.kernelMs),extraInfo:l.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:r,timeMs:s,inputs:i,extraInfo:l}=e;r.forEach(u=>{Promise.all([u.data(),s,l]).then(c=>{this.logger.logKernelProfile(t,u,c[0],c[1],i,c[2])})})}}function TW(n,e,t){if(e!=="float32")return!1;for(let r=0;r<n.length;r++){const s=n[r];if(isNaN(s)||!isFinite(s))return console.warn(`Found ${s} in the result of '${t}'`),!0}return!1}class NW{logKernelProfile(e,t,r,s,i,l){const u=typeof s=="number"?P(`${s}ms`,9):s.error,c=P(e,25),h=t.rank,p=t.size,m=P(t.shape.toString(),14);let g="";for(const y in i){const v=i[y];if(v!=null){const w=v.shape||t.shape,S=w.length;g+=`${y}: ${S}D ${S>0?w:""} `}}console.log(`%c${c}	%c${u}	%c${h}D ${m}	%c${p}	%c${g}	%c${l}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function RW(n,e,t){const r={},s={};for(let c=0;c<e.length;c++)r[e[c].id]=!0;for(let c=0;c<n.length;c++){const h=n[c],p=h.inputs;for(const m in p){const g=p[m];let y=!1;for(let v=0;v<e.length;v++)if(r[g.id]){h.outputs.forEach(w=>r[w.id]=!0),y=!0,s[h.id]=!0;break}if(y)break}}const i={};i[t.id]=!0;const l={};for(let c=n.length-1;c>=0;c--){const h=n[c],p=h.inputs;for(let m=0;m<h.outputs.length;m++)if(i[h.outputs[m].id]){for(const g in p)i[p[g].id]=!0,l[h.id]=!0;break}}const u=[];for(let c=0;c<n.length;c++){const h=n[c];if(s[h.id]&&l[h.id]){const p={};for(const g in h.inputs){const y=h.inputs[g];r[y.id]&&(p[g]=y)}const m=Object.assign({},h);m.inputs=p,m.outputs=h.outputs,u.push(m)}}return u}function EW(n,e,t,r){for(let s=e.length-1;s>=0;s--){const i=e[s],l=[];if(i.outputs.forEach(c=>{const h=n[c.id];h!=null?l.push(h):l.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);const u=i.gradient(l);for(const c in i.inputs){if(!(c in u))throw new Error(`Cannot backprop through input ${c}. Available gradients found: ${Object.keys(u)}.`);const h=t(()=>u[c]());if(h.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${c} must have 'float32' dtype, but has '${h.dtype}'`);const p=i.inputs[c];if(!B(h.shape,p.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${c}' has shape '${h.shape}', which does not match the shape of the input '${p.shape}'`);if(n[p.id]==null)n[p.id]=h;else{const m=n[p.id];n[p.id]=r(m,h),m.dispose()}}}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const nk=20,ic=3,v0=7;function LW(n,e,t,r){const s=we(e),i=GW(n,e,t,s),l=e.length,u=pp(n,e,t,s,i),c=["Tensor"];return r&&(c.push(`  dtype: ${t}`),c.push(`  rank: ${l}`),c.push(`  shape: [${e}]`),c.push("  values:")),c.push(u.map(h=>"    "+h).join(`
`)),c.join(`
`)}function GW(n,e,t,r){const s=M(e),i=r[r.length-1],l=new Array(i).fill(0),u=e.length,c=t==="complex64"?lc(n):n;if(u>1)for(let h=0;h<s/i;h++){const p=h*i;for(let m=0;m<i;m++)l[m]=Math.max(l[m],oc(c[p+m],0,t).length)}return l}function oc(n,e,t){let r;return Array.isArray(n)?r=`${parseFloat(n[0].toFixed(v0))} + ${parseFloat(n[1].toFixed(v0))}j`:Vt(n)?r=`'${n}'`:t==="bool"?r=rk(n):r=parseFloat(n.toFixed(v0)).toString(),P(r,e)}function rk(n){return n===0?"false":"true"}function pp(n,e,t,r,s,i=!0){const l=t==="complex64"?2:1,u=e[0],c=e.length;if(c===0){if(t==="complex64"){const w=lc(n);return[oc(w[0],0,t)]}return t==="bool"?[rk(n[0])]:[n[0].toString()]}if(c===1){if(u>nk){const w=ic*l;let S=Array.from(n.slice(0,w)),I=Array.from(n.slice((u-ic)*l,u*l));return t==="complex64"&&(S=lc(S),I=lc(I)),["["+S.map((C,R)=>oc(C,s[R],t)).join(", ")+", ..., "+I.map((C,R)=>oc(C,s[u-ic+R],t)).join(", ")+"]"]}return["["+(t==="complex64"?lc(n):Array.from(n)).map((w,S)=>oc(w,s[S],t)).join(", ")+"]"]}const h=e.slice(1),p=r.slice(1),m=r[0]*l,g=[];if(u>nk){for(let w=0;w<ic;w++){const S=w*m,I=S+m;g.push(...pp(n.slice(S,I),h,t,p,s,!1))}g.push("...");for(let w=u-ic;w<u;w++){const S=w*m,I=S+m;g.push(...pp(n.slice(S,I),h,t,p,s,w===u-1))}}else for(let w=0;w<u;w++){const S=w*m,I=S+m;g.push(...pp(n.slice(S,I),h,t,p,s,w===u-1))}const y=c===2?",":"";g[0]="["+(u>0?g[0]+y:"");for(let w=1;w<g.length-1;w++)g[w]=" "+g[w]+y;let v=`,
`;for(let w=2;w<c;w++)v+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":v),g}function lc(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class wn{constructor(e,t,r){if(this.dtype=t,this.shape=e.slice(),this.size=M(e),r!=null){const s=r.length;T(s===this.size,()=>`Length of values '${s}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||be(t,this.size),this.strides=we(e)}set(e,...t){t.length===0&&(t=[0]),T(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const r=this.locToIndex(t);this.values[r]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const s of e){if(s<0||s>=this.shape[t]){const i=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(i)}t++}let r=e[e.length-1];for(let s=0;s<e.length-1;++s)r+=this.strides[s]*e[s];return this.values[r]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return hs().makeTensor(this.values,this.shape,this.dtype)}}let hs=null,Ho=null;function zW(n){hs=n}function WW(n){Ho=n}class an{constructor(e,t,r,s){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=M(e),this.strides=we(e),this.dataId=r,this.id=s,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Ho.buffer(this.shape,this.dtype,e)}bufferSync(){return Ho.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return nt(this.shape,e,this.dtype==="complex64")}arraySync(){return nt(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=hs().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(r=>Aa(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),hs().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=hs().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>Aa(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await hs().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),hs().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Ho.print(this,e)}clone(){return this.throwIfDisposed(),Ho.clone(this)}toString(e=!1){const t=this.dataSync();return LW(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Ho.cast(this,e)}variable(e=!0,t,r){return this.throwIfDisposed(),hs().makeVariable(this,e,t,r)}}Object.defineProperty(an,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function de(){return Sg("Tensor",()=>an)}de();class fp extends an{constructor(e,t,r,s){super(e.shape,e.dtype,e.dataId,s),this.trainable=t,this.name=r}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!B(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);hs().disposeTensor(this),this.dataId=e.dataId,hs().incRef(this,null)}dispose(){hs().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(fp,Symbol.hasInstance,{value:n=>n instanceof an&&n.assign!=null&&n.assign instanceof Function});/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var sk;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(sk||(sk={}));var w0;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(w0||(w0={}));var k0;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(k0||(k0={}));var I0;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(I0||(I0={}));var S0;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(S0||(S0={}));const MW={float32:I0,int32:w0,bool:k0,complex64:S0};function dr(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return MW[n][e]}function C0(n){return dr(n,"int32")}function ak(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function ik(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function jt(n,e){if(n.dtype===e.dtype)return[n,e];const t=dr(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function ok(n){const e=[];return lk(n,e,new Set),e}function lk(n,e,t){if(n==null)return;if(n instanceof an){e.push(n);return}if(!$W(n))return;const r=n;for(const s in r){const i=r[s];t.has(i)||(t.add(i),lk(i,e,t))}}function $W(n){return Array.isArray(n)||typeof n=="object"}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function T0(n){return n.kernelName!=null}class uk{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class Uo{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new uk}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const r=e[t];if(await this.initializeBackend(r).success){await this.setBackend(r);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,r=1){return e in this.registryFactory?(Sr(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:r},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:r}=this.initializeBackend(e);if(!(r?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new CW(this.backendInstance),!0}setupRegisteredKernels(){Xw(this.backendName).forEach(e=>{e.setupFunc!=null&&e.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){Xw(e).forEach(t=>{t.disposeFunc!=null&&t.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const r=t.factory();if(r&&!(r instanceof b)&&typeof r.then=="function"){const s=++this.pendingBackendInitId,i=r.then(l=>s<this.pendingBackendInitId?!1:(this.registry[e]=l,this.pendingBackendInit=null,!0)).catch(l=>(s<this.pendingBackendInitId||(this.pendingBackendInit=null,Sr(`Initialization of backend ${e} failed`),Sr(l.stack||l.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(r){return Sr(`Initialization of backend ${e} failed`),Sr(r.stack||r.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const r=e[t],{success:s,asyncInit:i}=this.initializeBackend(r);if(i||s)return{name:r,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const r=this.state.tensorInfo.get(t),s=r.backend,i=this.readSync(t),l=s.refCount(t);s.disposeData(t,!0),r.backend=e,e.move(t,i,r.shape,r.dtype,l),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let r=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}let s;return this.scopedRun(()=>this.startScope(r),()=>this.endScope(s),()=>(s=t(),s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),s))}scopedRun(e,t,r){e();try{const s=r();return t(),s}catch(s){throw t(),s}}nextTensorId(){return Uo.nextTensorId++}nextVariableId(){return Uo.nextVariableId++}clone(e){const t=U.runKernel(Gu,{x:e}),r={x:e},s=l=>({x:()=>{const u="float32",c={x:l},h={dtype:u};return U.runKernel(yu,c,h)}}),i=[];return this.addTapeNode(this.state.activeScope.name,r,[t],s,i,{}),t}runKernel(e,t,r){if(this.backendName==null&&this.backend,g0(e,this.backendName)==null)throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:r})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,r){const s=this.backend.numDataIds();let i=0;r.forEach(c=>{i+=c.dtype==="complex64"?3:1});const l=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],u=s-t-i-l;if(u>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${u} data ids) after running '${e}'`)}runKernelFunc(e){let t,r=[];const s=this.isTapeOn(),i=this.state.numBytes,l=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let u;this.backendName==null&&this.backend;let c;const h=T0(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(T0(e)){const{kernelName:v,inputs:w,attrs:S}=e;this.backendName==null&&this.backend;const I=g0(v,this.backendName);T(I!=null,()=>`Cannot find registered kernel '${v}' for backend '${this.backendName}'`),u=()=>{const C=this.backend.numDataIds();c=I.kernelFunc({inputs:w,attrs:S,backend:this.backend});const R=Array.isArray(c)?c:[c];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(v,C,R);const L=R.map(G=>G.rank!=null?G:this.makeTensorFromTensorInfo(G));if(s){const G=this.getTensorsForGradient(v,w,L);r=this.saveTensorsForBackwardMode(G)}return L}}else{const{forwardFunc:v}=e,w=S=>{s&&(r=S.map(I=>this.keep(this.clone(I))))};u=()=>{const S=this.backend.numDataIds();c=this.tidy(()=>v(this.backend,w));const I=Array.isArray(c)?c:[c];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(h,S,I),I}}const{inputs:p,attrs:m}=e,g=T0(e)?null:e.backwardsFunc;let y;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=u():(y=this.profiler.profileKernel(h,p,()=>u()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(y),t=y.outputs)}),s&&this.addTapeNode(h,p,t,g,r,m),this.state.profiling&&this.state.activeProfile.kernels.push({name:h,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-l,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(p).map(v=>p[v]!=null?p[v].shape:null),outputShapes:t.map(v=>v.shape),kernelTimeMs:y.timeMs,extraInfo:y.extraInfo}),Array.isArray(c)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(t=>this.keep(this.clone(t)))}getTensorsForGradient(e,t,r){const s=Pw(e);if(s!=null){const i=s.inputsToSave||[],l=s.outputsToSave||[];let u;s.saveAllInputs?(T(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),u=Object.keys(t).map(h=>t[h])):u=i.map(h=>t[h]);const c=r.filter((h,p)=>l[p]);return u.concat(c)}return[]}makeTensor(e,t,r,s){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",s=s||this.backend;let i=e;r==="string"&&Vt(e[0])&&(i=e.map(c=>Da(c)));const l=s.write(i,t,r),u=new an(t,r,l,this.nextTensorId());if(this.trackTensor(u,s),r==="string"){const c=this.state.tensorInfo.get(l),h=zt(i);this.state.numBytes+=h-c.bytes,c.bytes=h}return u}makeTensorFromDataId(e,t,r,s){r=r||"float32";const i={dataId:e,shape:t,dtype:r};return this.makeTensorFromTensorInfo(i,s)}makeTensorFromTensorInfo(e,t){const{dataId:r,shape:s,dtype:i}=e,l=new an(s,i,r,this.nextTensorId());return this.trackTensor(l,t),l}makeVariable(e,t=!0,r,s){r=r||this.nextVariableId().toString(),s!=null&&s!==e.dtype&&(e=e.cast(s));const i=new fp(e,t,r,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let r=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(r=e.size*Ht(e.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r})),e instanceof fp||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const r=e.size*Ht(e.dtype);this.state.numBytes-=r}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,r=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(s=>s.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r;for(const s of this.state.activeProfile.kernels)s.kernelTimeMs=await s.kernelTimeMs,s.extraInfo=await s.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,r,s,i,l){const u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:i},c=Pw(e);c!=null&&(s=c.gradFunc),s!=null&&(u.gradient=h=>(h=h.map((p,m)=>{if(p==null){const g=r[m],y=Pt(g.size,g.dtype);return this.makeTensor(y,g.shape,g.dtype)}return p}),s(h.length>1?h:h[0],i,l))),this.state.activeTape.push(u)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=ok(e),r=new Set(t.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){const l=this.state.activeScope.track[i];!l.kept&&!r.has(l.id)&&l.dispose()}const s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(i=>{!i.kept&&i.scopeId===s.id&&this.track(i)})}gradients(e,t,r,s=!1){if(T(t.length>0,()=>"gradients() received an empty list of xs."),r!=null&&r.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${r.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));T(i instanceof an,()=>"The result y returned by f() must be a tensor.");const l=RW(this.state.activeTape,t,i);if(!s&&l.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const u={};u[i.id]=r??FW(i.shape),EW(u,l,h=>this.tidy(h),VW);const c=t.map(h=>u[h.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(h=>{for(const p of h.saved)p.dispose()}),this.state.activeTape=null),{value:i,grads:c}})}customGrad(e){return T(Ge(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{T(t.every(u=>u instanceof an),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let r;const s={};t.forEach((u,c)=>{s[c]=u});const i=(u,c)=>(r=e(...t,c),T(r.value instanceof an,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),T(Ge(r.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),r.value),l=(u,c)=>{const h=r.gradFunc(u,c),p=Array.isArray(h)?h:[h];T(p.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),T(p.every(g=>g instanceof an),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const m={};return p.forEach((g,y)=>{m[y]=()=>g}),m};return this.runKernelFunc({forwardFunc:i,backwardsFunc:l,inputs:s})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=Yn(),r=await this.backend.time(e);return r.wallMs=Yn()-t,r}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new uk;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}Uo.nextTensorId=0,Uo.nextVariableId=0;function FW(n){const e=$n(M(n),"float32");return U.makeTensor(e,n,"float32")}function ck(){const n=gw();if(n._tfengine==null){const e=new sW(n);n._tfengine=new Uo(e)}return lW(n._tfengine.ENV),zW(()=>n._tfengine),n._tfengine}const U=ck();function VW(n,e){const t={a:n,b:e};return U.runKernel(Ko,t)}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function PW(){return typeof navigator<"u"&&navigator!=null}function dk(n){if(n||PW()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function hk(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Qn=ae();Qn.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Qn.registerFlag("IS_BROWSER",()=>hk()),Qn.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"),Qn.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)),Qn.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)),Qn.registerFlag("PROD",()=>!1),Qn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Qn.getBool("DEBUG")),Qn.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0),Qn.registerFlag("IS_TEST",()=>!1),Qn.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Qn.getBool("DEBUG")),Qn.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1),Qn.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1),Qn.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function uc(n,e){let t=n;if(Br(n))return e==="string"?[]:[n.length];if(ak(n)){const s=n.channels||"RGBA";return[n.height,n.width*s.length]}else if(ik(n))return[n.buffer.size/(e==null?4:Ht(e))];if(!Array.isArray(n))return[];const r=[];for(;Array.isArray(t)||Br(t)&&e!=="string";)r.push(t.length),t=t[0];return Array.isArray(n)&&ae().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&pk(n,r,[]),r}function pk(n,e,t){if(t=t||[],!Array.isArray(n)&&!Br(n)){T(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}T(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),T(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const r=e.slice(1);for(let s=0;s<n.length;++s)pk(n[s],r,t.concat(s))}function fk(n,e,t,r){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${r}' must be ${n} tensor, but got ${e} tensor`)}}function K(n,e,t,r="numeric"){if(n instanceof de())return fk(r,n.dtype,e,t),n;let s=Ir(n);if(s!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(s=r),fk(r,s,e,t),n==null||!Br(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const u=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${u}'`)}const i=uc(n,s);!Br(n)&&!Array.isArray(n)&&(n=[n]);const l=s!=="string"?Di(n,s):Ai(n,[],!0);return U.makeTensor(l,i,s)}function mk(n,e,t,r="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((s,i)=>K(s,`${e}[${i}]`,t,r))}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const XW="__op";function J(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+XW;const s=(...i)=>{U.startScope(t);try{const l=r(...i);return kg(l)&&console.error("Cannot return a Promise inside of tidy."),U.endScope(l),l}catch(l){throw U.endScope(null),l}};return Object.defineProperty(s,"name",{value:t,configurable:!0}),s}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function OW(n,e){const t=K(n,"real","complex"),r=K(e,"imag","complex");A(t.shape,r.shape,`real and imag shapes, ${t.shape} and ${r.shape}, must match in call to tf.complex().`);const s={real:t,imag:r};return U.runKernel(zg,s)}const jo=J({complex_:OW});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cc(n,e,t,r){if(r==null)r=Ir(n);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(ik(n)||ak(n)){if(r!=="float32"&&r!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${r}.`);return U.backend.createTensorFromGPUData(n,e||t,r)}if(!Br(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){lr(e);const s=M(e),i=M(t);T(s===i,()=>`Based on the provided shape, [${e}], the tensor should have ${s} values but has ${i}`);for(let l=0;l<t.length;++l){const u=t[l],c=l===t.length-1?u!==M(e.slice(l)):!0;T(t[l]===e[l]||!c,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!Br(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=r!=="string"?Di(n,r):Ai(n,[],!0),U.makeTensor(n,e,r)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Tr(n,e,t){const r=uc(n,t);return cc(n,e,r,t)}class Yo{static join(e){return new Yo(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(r=>Br(r)?r.buffer:r),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let r=0;r<e.length;r++){const s=e[r];r!==e.length-1&&s.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const i=t+s.byteLength;this.shards.push({buffer:s,start:t,end:i}),t=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const r=this.findShardForByte(e);if(r===-1)throw new Error(`Could not find start shard for byte ${e}`);const s=t-e,i=new ArrayBuffer(s),l=new Uint8Array(i);let u=0;for(let c=r;c<this.shards.length;c++){const h=this.shards[c],p=e+u-h.start,m=u,g=Math.min(t,h.end)-h.start,y=new Uint8Array(h.buffer,p,g-p);if(l.set(y,m),u+=y.length,t<h.end)break}return i}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(s){return e<s.start?-1:e>=s.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const r=DW(this.shards,t);return r===-1?-1:(this.previousShardIndex=r,this.previousShardIndex)}}function DW(n,e){let t=0,r=n.length;for(;t<=r;){const s=Math.floor((r-t)/2)+t,i=e(n[s]);if(i===0)return s;i<0?r=s:t=s+1}return-1}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vt(){return U}function N0(){return U.memory()}function ee(n,e){return U.tidy(n,e)}function et(n){ok(n).forEach(e=>e.dispose())}function Nr(n){return U.keep(n)}function gk(n,e,t=1){return U.registerBackend(n,e,t)}function Ka(){return U.backend}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const bk=4;async function yk(n,e){const t=[],r=[],s=Array.isArray(n)?n.map(l=>l.name):Object.keys(n);for(let l=0;l<s.length;++l){const u=s[l],c=Array.isArray(n)?n[l].tensor:n[u];if(c.dtype!=="float32"&&c.dtype!=="int32"&&c.dtype!=="bool"&&c.dtype!=="string"&&c.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${u}': ${c.dtype}`);const h={name:u,shape:c.shape,dtype:c.dtype};if(c.dtype==="string"){const p=new Promise(async m=>{const g=await c.bytes(),y=g.reduce((S,I)=>S+I.length,0)+bk*g.length,v=new Uint8Array(y);let w=0;for(let S=0;S<g.length;S++){const I=g[S],C=new Uint8Array(new Uint32Array([I.length]).buffer);v.set(C,w),w+=bk,v.set(I,w),w+=I.length}m(v)});r.push(p)}else r.push(c.data());e!=null&&(h.group=e),t.push(h)}const i=await Promise.all(r);return{data:AW(i),specs:t}}function AW(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(i=>{if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});const r=new Uint8Array(e);let s=0;return t.forEach(i=>{r.set(new Uint8Array(i.buffer),s),s+=i.byteLength}),r.buffer}const R0=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function xk(n){return R0?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function KW(n){if(R0)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let r=0,s=e.length;r<s;r++)t+=String.fromCharCode(e[r]);return btoa(t)}function ZW(n){if(R0){const r=Buffer.from(n,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let r=0;r<e.length;++r)t.set([e.charCodeAt(r)],r);return t.buffer}function BW(n){return Yo.join(n)}function vk(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:xk(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:xk(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new Yo(n.weightData).byteLength}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Vn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Vn.instance==null&&(Vn.instance=new Vn),Vn.instance}static registerSaveRouter(e){Vn.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Vn.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Vn.getHandlers(e,"save")}static getLoadHandlers(e,t){return Vn.getHandlers(e,"load",t)}static getHandlers(e,t,r){const s=[];return(t==="load"?Vn.getInstance().loadRouters:Vn.getInstance().saveRouters).forEach(i=>{const l=i(e,r);l!==null&&s.push(l)}),s}}const _W=n=>Vn.getSaveHandlers(n);/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const E0="tensorflowjs",L0=1,Ki="models_store",Za="model_info_store";function wk(){if(!ae().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function G0(n){const e=n.result;e.createObjectStore(Ki,{keyPath:"modelPath"}),e.createObjectStore(Za,{keyPath:"modelPath"})}class Zi{constructor(e){if(this.indexedDB=wk(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((r,s)=>{const i=this.indexedDB.open(E0,L0);i.onupgradeneeded=()=>G0(i),i.onsuccess=()=>{const l=i.result;if(t==null){const u=l.transaction(Ki,"readonly"),c=u.objectStore(Ki).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return l.close(),s(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));r(c.result.modelArtifacts)},c.onerror=h=>(l.close(),s(c.error)),u.oncomplete=()=>l.close()}else{t.weightData=Yo.join(t.weightData);const u=vk(t),c=l.transaction(Za,"readwrite");let h=c.objectStore(Za),p;try{p=h.put({modelPath:this.modelPath,modelArtifactsInfo:u})}catch(g){return s(g)}let m;p.onsuccess=()=>{m=l.transaction(Ki,"readwrite");const g=m.objectStore(Ki);let y;try{y=g.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:u})}catch(v){return s(v)}y.onsuccess=()=>r({modelArtifactsInfo:u}),y.onerror=v=>{h=c.objectStore(Za);const w=h.delete(this.modelPath);w.onsuccess=()=>(l.close(),s(y.error)),w.onerror=S=>(l.close(),s(y.error))}},p.onerror=g=>(l.close(),s(p.error)),c.oncomplete=()=>{m==null?l.close():m.oncomplete=()=>l.close()}}},i.onerror=l=>s(i.error)})}}Zi.URL_SCHEME="indexeddb://";const kk=n=>ae().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Zi.URL_SCHEME)?HW(n.slice(Zi.URL_SCHEME.length)):null;Vn.registerSaveRouter(kk),Vn.registerLoadRouter(kk);function HW(n){return new Zi(n)}function UW(n){return n.startsWith(Zi.URL_SCHEME)?n.slice(Zi.URL_SCHEME.length):n}class jW{constructor(){this.indexedDB=wk()}async listModels(){return new Promise((e,t)=>{const r=this.indexedDB.open(E0,L0);r.onupgradeneeded=()=>G0(r),r.onsuccess=()=>{const s=r.result,i=s.transaction(Za,"readonly"),l=i.objectStore(Za).getAll();l.onsuccess=()=>{const u={};for(const c of l.result)u[c.modelPath]=c.modelArtifactsInfo;e(u)},l.onerror=u=>(s.close(),t(l.error)),i.oncomplete=()=>s.close()},r.onerror=s=>t(r.error)})}async removeModel(e){return e=UW(e),new Promise((t,r)=>{const s=this.indexedDB.open(E0,L0);s.onupgradeneeded=()=>G0(s),s.onsuccess=()=>{const i=s.result,l=i.transaction(Za,"readwrite"),u=l.objectStore(Za),c=u.get(e);let h;c.onsuccess=()=>{if(c.result==null)return i.close(),r(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const p=u.delete(e),m=()=>{h=i.transaction(Ki,"readwrite");const g=h.objectStore(Ki).delete(e);g.onsuccess=()=>t(c.result.modelArtifactsInfo),g.onerror=y=>r(c.error)};p.onsuccess=m,p.onerror=g=>(m(),i.close(),r(c.error))}},c.onerror=p=>(i.close(),r(c.error)),l.oncomplete=()=>{h==null?i.close():h.oncomplete=()=>i.close()}},s.onerror=i=>r(s.error)})}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const da="/",Qo="tensorflowjs_models",Ik="info",YW="model_topology",QW="weight_specs",JW="weight_data",qW="model_metadata";function Sk(n){return{info:[Qo,n,Ik].join(da),topology:[Qo,n,YW].join(da),weightSpecs:[Qo,n,QW].join(da),weightData:[Qo,n,JW].join(da),modelMetadata:[Qo,n,qW].join(da)}}function Ck(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function eM(n){const e=n.split(da);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(da)}function tM(n){return n.startsWith(Bi.URL_SCHEME)?n.slice(Bi.URL_SCHEME.length):n}class Bi{constructor(e){if(!ae().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Sk(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),s=vk(e),i=Yo.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(s)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,KW(i));const l={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(l)),{modelArtifactsInfo:s}}catch{throw Ck(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${s.modelTopologyBytes}, weightSpecsBytes=${s.weightSpecsBytes}, weightDataBytes=${s.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},r=JSON.parse(this.LS.getItem(this.keys.topology));if(r==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=r;const s=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(s==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=s;const i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){const u=JSON.parse(i);t.format=u.format,t.generatedBy=u.generatedBy,t.convertedBy=u.convertedBy,u.signature!=null&&(t.signature=u.signature),u.userDefinedMetadata!=null&&(t.userDefinedMetadata=u.userDefinedMetadata),u.modelInitializer!=null&&(t.modelInitializer=u.modelInitializer),u.initializerSignature!=null&&(t.initializerSignature=u.initializerSignature),u.trainingConfig!=null&&(t.trainingConfig=u.trainingConfig)}const l=this.LS.getItem(this.keys.weightData);if(l==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=ZW(l),t}}Bi.URL_SCHEME="localstorage://";const Tk=n=>ae().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Bi.URL_SCHEME)?nM(n.slice(Bi.URL_SCHEME.length)):null;Vn.registerSaveRouter(Tk),Vn.registerLoadRouter(Tk);function nM(n){return new Bi(n)}class rM{constructor(){T(ae().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),T(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=Qo+da,r=da+Ik;for(let s=0;s<this.LS.length;++s){const i=this.LS.key(s);if(i.startsWith(t)&&i.endsWith(r)){const l=eM(i);e[l]=JSON.parse(this.LS.getItem(i))}}return e}async removeModel(e){e=tM(e);const t=Sk(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const r=JSON.parse(this.LS.getItem(t.info));return Ck(t),r}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Nk="://";class Vs{constructor(){this.managers={}}static getInstance(){return Vs.instance==null&&(Vs.instance=new Vs),Vs.instance}static registerManager(e,t){T(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(Nk)&&(e=e.slice(0,e.indexOf(Nk))),T(e.length>0,()=>"scheme must not be an empty string.");const r=Vs.getInstance();T(r.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),r.managers[e]=t}static getManager(e){const t=Vs.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(Vs.getInstance().managers)}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class sM{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!ae().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",r=>{if(r.source===window&&r.data.name===this.messageName){r.stopPropagation();const s=this.functionRefs[r.data.index];s(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return Dw(e)}}if(ae().get("IS_BROWSER")){ae().setPlatform("browser",new sM);try{Vs.registerManager(Bi.URL_SCHEME,new rM)}catch{}try{Vs.registerManager(Zi.URL_SCHEME,new jW)}catch{}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const aM={importFetch:()=>Hue()};let z0;class iM{constructor(){this.util=Yue,this.textEncoder=new this.util.TextEncoder}fetch(e,t){return ae().global.fetch!=null?ae().global.fetch(e,t):(z0==null&&(z0=aM.importFetch()),z0(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}ae().get("IS_NODE")&&!ae().get("IS_BROWSER")&&ae().setPlatform("node",new iM);/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Je(n,e="float32",t){return e=e||"float32",lr(n),new wn(n,e,t)}/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function oM(n,e){const t=K(n,"x","cast");if(!Oe(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const r={x:t},s={dtype:e};return U.runKernel(yu,r,s)}const ze=J({cast_:oM});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function lM(n){const e={x:K(n,"x","clone","string_or_numeric")};return U.runKernel(Gu,e)}const _i=J({clone_:lM});/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function uM(n,e=!1){console.log(n.toString(e))}/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/ck(),WW({buffer:Je,cast:ze,clone:_i,print:uM});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cM(n,e){let t=K(n,"a","add"),r=K(e,"b","add");[t,r]=jt(t,r);const s={a:t,b:r};return U.runKernel(Ko,s)}const ke=J({add_:cM});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function dM(n,e){let t=K(n,"a","floorDiv"),r=K(e,"b","floorDiv");[t,r]=jt(t,r);const s={a:t,b:r};return U.runKernel(Eu,s)}const Rk=J({floorDiv_:dM});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hM(n,e){let t=K(n,"a","div"),r=K(e,"b","div");if([t,r]=jt(t,r),t.dtype==="int32"&&r.dtype==="int32")return Rk(t,r);const s={a:t,b:r},i={};return U.runKernel(Iu,s,i)}const Ke=J({div_:hM});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function pM(n,e){let t=K(n,"a","mul"),r=K(e,"b","mul");[t,r]=jt(t,r);const s={a:t,b:r};return U.runKernel(Ou,s)}const j=J({mul_:pM});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function fM(n){const e=K(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return U.runKernel(fh,t)}else{const t={x:e};return U.runKernel(oh,t)}}const Pn=J({abs_:fM});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mM(n){const e={x:K(n,"x","acos")};return U.runKernel(du,e)}const gM=J({acos_:mM});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function bM(n){const e={x:K(n,"x","acosh")};return U.runKernel(hu,e)}const yM=J({acosh_:bM});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xM(n,e=null,t=!1){const r={x:K(n,"x","all","bool")},s={axis:e,keepDims:t};return U.runKernel(Tg,r,s)}const Ek=J({all_:xM});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vM(n,e=null,t=!1){const r={x:K(n,"x","any","bool")},s={axis:e,keepDims:t};return U.runKernel(Ng,r,s)}const W0=J({any_:vM});/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function wM(n,e=0){const t={x:K(n,"x","argMax")},r={axis:e};return U.runKernel(lh,t,r)}const dc=J({argMax_:wM});/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function kM(n,e=0){const t={x:K(n,"x","argMin")},r={axis:e};return U.runKernel(uh,t,r)}const IM=J({argMin_:kM});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function SM(n){const e={x:K(n,"x","asin")};return U.runKernel(pu,e)}const CM=J({asin_:SM});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function TM(n){const e={x:K(n,"x","asinh")};return U.runKernel(fu,e)}const NM=J({asinh_:TM});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function RM(n){const e={x:K(n,"x","atan")};return U.runKernel(mu,e)}const EM=J({atan_:RM});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function LM(n,e){let t=K(n,"a","atan2"),r=K(e,"b","atan2");[t,r]=jt(t,r);const s={a:t,b:r};return U.runKernel(bu,s)}const GM=J({atan2_:LM});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function zM(n){const e={x:K(n,"x","atanh")};return U.runKernel(gu,e)}const WM=J({atanh_:zM});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hc(n,e,t,r,s="NHWC",i){const l=n[3],u=[...e,l],c=pa(s);return kn(n,u,t,i,r,null,null,c)}function _r(n,e,t,r,s,i,l="channelsLast"){const[u,c]=pc(e);let h;if(l==="channelsLast")h=[u,c,n[3],n[3]];else if(l==="channelsFirst")h=[u,c,n[1],n[1]];else throw new Error(`Unknown dataFormat ${l}`);return kn(n,h,t,r,s,i,!1,l)}function ha(n,e,t,r,s,i,l="NDHWC"){const[u,c,h]=$0(e);let p,m;if(l==="NDHWC")m="channelsLast",p=[u,c,h,n[4],n[4]];else if(l==="NCDHW")m="channelsFirst",p=[u,c,h,n[1],n[1]];else throw new Error(`Unknown dataFormat ${l}`);return Ba(n,p,t,r,s,!1,m,i)}function kn(n,e,t,r,s,i,l=!1,u="channelsLast"){let[c,h,p,m]=[-1,-1,-1,-1];if(u==="channelsLast")[c,h,p,m]=n;else if(u==="channelsFirst")[c,m,h,p]=n;else throw new Error(`Unknown dataFormat ${u}`);const[g,y,,v]=e,[w,S]=pc(t),[I,C]=pc(r),R=Jo(g,I),L=Jo(y,C),{padInfo:G,outHeight:$,outWidth:F}=FM(s,h,p,w,S,R,L,i,u),V=l?v*m:v;let D;return u==="channelsFirst"?D=[c,V,$,F]:u==="channelsLast"&&(D=[c,$,F,V]),{batchSize:c,dataFormat:u,inHeight:h,inWidth:p,inChannels:m,outHeight:$,outWidth:F,outChannels:V,padInfo:G,strideHeight:w,strideWidth:S,filterHeight:g,filterWidth:y,effectiveFilterHeight:R,effectiveFilterWidth:L,dilationHeight:I,dilationWidth:C,inShape:n,outShape:D,filterShape:e}}function Ba(n,e,t,r,s,i=!1,l="channelsLast",u){let[c,h,p,m,g]=[-1,-1,-1,-1,-1];if(l==="channelsLast")[c,h,p,m,g]=n;else if(l==="channelsFirst")[c,g,h,p,m]=n;else throw new Error(`Unknown dataFormat ${l}`);const[y,v,w,,S]=e,[I,C,R]=$0(t),[L,G,$]=$0(r),F=Jo(y,L),V=Jo(v,G),D=Jo(w,$),{padInfo:Z,outDepth:ne,outHeight:re,outWidth:se}=VM(s,h,p,m,I,C,R,F,V,D,u),ue=i?S*g:S;let le;return l==="channelsFirst"?le=[c,ue,ne,re,se]:l==="channelsLast"&&(le=[c,ne,re,se,ue]),{batchSize:c,dataFormat:l,inDepth:h,inHeight:p,inWidth:m,inChannels:g,outDepth:ne,outHeight:re,outWidth:se,outChannels:ue,padInfo:Z,strideDepth:I,strideHeight:C,strideWidth:R,filterDepth:y,filterHeight:v,filterWidth:w,effectiveFilterDepth:F,effectiveFilterHeight:V,effectiveFilterWidth:D,dilationDepth:L,dilationHeight:G,dilationWidth:$,inShape:n,outShape:le,filterShape:e}}function MM(n,e,t,r,s){r==null&&(r=M0(n,e,t));const i=n[0],l=n[1],u=fc((i-e+2*r)/t+1,s),c=fc((l-e+2*r)/t+1,s);return[u,c]}function $M(n,e,t,r,s,i){s==null&&(s=M0(n,e[0],r[0]));const l=[0,0,0,t];for(let u=0;u<3;u++)n[u]+2*s>=e[u]&&(l[u]=fc((n[u]-e[u]+2*s)/r[u]+1,i));return l}function M0(n,e,t,r=1){const s=Jo(e,r);return Math.floor((n[0]*(t-1)-t+s)/2)}function pc(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function $0(n){return typeof n=="number"?[n,n,n]:n}function Jo(n,e){return e<=1?n:n+(n-1)*(e-1)}function FM(n,e,t,r,s,i,l,u,c){let h,p,m;if(typeof n=="number"){h={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const g=MM([e,t],i,r,n,u);p=g[0],m=g[1]}else if(n==="same"){p=Math.ceil(e/r),m=Math.ceil(t/s);const g=Math.max(0,(p-1)*r+i-e),y=Math.max(0,(m-1)*s+l-t),v=Math.floor(g/2),w=g-v,S=Math.floor(y/2),I=y-S;h={top:v,bottom:w,left:S,right:I,type:"SAME"}}else if(n==="valid")h={top:0,bottom:0,left:0,right:0,type:"VALID"},p=Math.ceil((e-i+1)/r),m=Math.ceil((t-l+1)/s);else if(typeof n=="object"){const g=c==="channelsLast"?n[1][0]:n[2][0],y=c==="channelsLast"?n[1][1]:n[2][1],v=c==="channelsLast"?n[2][0]:n[3][0],w=c==="channelsLast"?n[2][1]:n[3][1];h={top:g,bottom:y,left:v,right:w,type:g===0&&y===0&&v===0&&w===0?"VALID":"EXPLICIT"},p=fc((e-i+g+y)/r+1,u),m=fc((t-l+v+w)/s+1,u)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:h,outHeight:p,outWidth:m}}function VM(n,e,t,r,s,i,l,u,c,h,p){let m,g,y,v;if(n==="valid"&&(n=0),typeof n=="number"){m={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const w=$M([e,t,r,1],[u,c,h],1,[s,i,l],n,p);g=w[0],y=w[1],v=w[2]}else if(n==="same"){g=Math.ceil(e/s),y=Math.ceil(t/i),v=Math.ceil(r/l);const w=(g-1)*s+u-e,S=(y-1)*i+c-t,I=(v-1)*l+h-r,C=Math.floor(w/2),R=w-C,L=Math.floor(S/2),G=S-L,$=Math.floor(I/2),F=I-$;m={top:L,bottom:G,left:$,right:F,front:C,back:R,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:m,outDepth:g,outHeight:y,outWidth:v}}function fc(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function Hi(n){const[e,t,r]=pc(n);return e===1&&t===1&&r===1}function Rn(n,e){return Hi(n)||Hi(e)}function Ui(n){return pc(n).every(e=>e>0)}function pa(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function Jn(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")T(H(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(r=>{r.forEach(s=>{T(H(s),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${s}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function PM(n,e){const t={x:K(n,"x","reshape","string_or_numeric")},r={shape:e};return U.runKernel(Uh,t,r)}const q=J({reshape_:PM});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function XM(n,e,t,r,s){const i=K(n,"x","avgPool","float32"),l=1;T(Rn(t,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${l}'`);let u=i,c=!1;i.rank===3&&(c=!0,u=q(i,[1,i.shape[0],i.shape[1],i.shape[2]])),T(u.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${u.rank}.`),Jn("avgPool",r,s);const h={x:u},p={filterSize:e,strides:t,pad:r,dimRoundingMode:s};let m=U.runKernel(ch,h,p);return m=ze(m,i.dtype),c?q(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const F0=J({avgPool_:XM});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function OM(n,e,t,r,s,i="NDHWC"){const l=K(n,"x","avgPool3d","float32");let u=l,c=!1;l.rank===4&&(c=!0,u=q(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),T(u.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${u.rank}.`),T(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),T(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),Jn("avgPool3d",r,s);const h={x:u},p={filterSize:e,strides:t,pad:r,dimRoundingMode:s,dataFormat:i};let m=U.runKernel(dh,h,p);return m=ze(m,u.dtype),c?q(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const DM=J({avgPool3d_:OM});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function AM(n,e=0){T(n.length>=1,()=>"Pass at least one tensor to concat");const t=mk(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),t.length===1)return _i(t[0]);const r=t,s={axis:e};return U.runKernel(mh,r,s)}const qn=J({concat_:AM});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function KM(n,e,t=!1,r=!1){let s=K(n,"a","matMul"),i=K(e,"b","matMul");[s,i]=jt(s,i);const l={a:s,b:i},u={transposeA:t,transposeB:r};return U.runKernel(hh,l,u)}const dt=J({matMul_:KM});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ZM(n){const e={x:K(n,"x","sigmoid","float32")};return U.runKernel(Qu,e)}const qo=J({sigmoid_:ZM});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function BM(n,e,t){const r=K(n,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");const s={x:r},i={begin:e,size:t};return U.runKernel(qh,s,i)}const wt=J({slice_:BM});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _M(n){const e={x:K(n,"x","tanh","float32")};return U.runKernel(rc,e)}const V0=J({tanh_:_M});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function HM(n,e,t){const r=K(n,"x","batchToSpaceND"),s=e.reduce((u,c)=>u*c);T(r.rank>=1+e.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`),T(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),T(r.shape[0]%s===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${s}`);const i={x:r},l={blockShape:e,crops:t};return U.runKernel(ph,i,l)}const P0=J({batchToSpaceND_:HM});function UM(n){let e;return n.rank===0||n.rank===1?e=q(n,[1,1,1,n.size]):n.rank===2?e=q(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=q(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function jM(n,e,t,r,s,i){i==null&&(i=.001);const l=K(n,"x","batchNorm"),u=K(e,"mean","batchNorm"),c=K(t,"variance","batchNorm");let h;s!=null&&(h=K(s,"scale","batchNorm"));let p;r!=null&&(p=K(r,"offset","batchNorm")),T(u.rank===c.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),T(p==null||u.rank===p.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),T(h==null||u.rank===h.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const m={x:UM(l),scale:h,offset:p,mean:u,variance:c},g={varianceEpsilon:i},y=U.runKernel(Sh,m,g);return q(y,l.shape)}const mp=J({batchNorm_:jM});function YM(n,e,t,r,s,i){const l=K(n,"x","batchNorm"),u=K(e,"mean","batchNorm"),c=K(t,"variance","batchNorm");let h;s!=null&&(h=K(s,"scale","batchNorm"));let p;return r!=null&&(p=K(r,"offset","batchNorm")),T(l.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${l.rank}.`),T(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${u.rank}.`),T(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${c.rank}.`),h!=null&&T(h.rank===2||h.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${h.rank}.`),p!=null&&T(p.rank===2||p.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${p.rank}.`),mp(l,u,c,p,h,i)}const QM=J({batchNorm2d_:YM});function JM(n,e,t,r,s,i){const l=K(n,"x","batchNorm"),u=K(e,"mean","batchNorm"),c=K(t,"variance","batchNorm");let h;s!=null&&(h=K(s,"scale","batchNorm"));let p;return r!=null&&(p=K(r,"offset","batchNorm")),T(l.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${l.rank}.`),T(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${u.rank}.`),T(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${c.rank}.`),h!=null&&T(h.rank===3||h.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${h.rank}.`),p!=null&&T(p.rank===3||p.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${p.rank}.`),mp(l,u,c,p,h,i)}const qM=J({batchNorm3d_:JM});function e$(n,e,t,r,s,i){const l=K(n,"x","batchNorm"),u=K(e,"mean","batchNorm"),c=K(t,"variance","batchNorm");let h;s!=null&&(h=K(s,"scale","batchNorm"));let p;return r!=null&&(p=K(r,"offset","batchNorm")),T(l.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${l.rank}.`),T(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${u.rank}.`),T(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${c.rank}.`),h!=null&&T(h.rank===4||h.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${h.rank}.`),p!=null&&T(p.rank===4||p.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${p.rank}.`),mp(l,u,c,p,h,i)}const t$=J({batchNorm4d_:e$});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function n$(n,e,t){const r=K(n,"x","bincount"),s=K(e,"weights","bincount");T(r.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`),T(t>=0,()=>`size must be non-negative, but got ${t}.`),T(s.size===r.size||s.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${s.shape}.`);const i={x:r,weights:s},l={size:t};return U.runKernel(Lg,i,l)}const r$=J({bincount_:n$});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function s$(n,e){let t=K(n,"broadcastTo","x");const r=t.shape;if(lr(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const c=t.shape.slice();for(;c.length<e.length;)c.unshift(1);t=q(t,c)}const s=t.shape,i=Array.from(e);for(let c=e.length-1;c>=0;c--)if(s[c]===e[c])i[c]=1;else if(t.shape[c]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);if(i.map((c,h)=>c>1?h:-1).filter(c=>c>=0).length===0)return _i(t);const l={x:t},u={reps:i};return U.runKernel(sc,l,u)}const mc=J({broadcastTo_:s$});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function a$(n){const e={x:K(n,"x","ceil","float32")};return U.runKernel(xu,e)}const i$=J({ceil_:a$});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function gp(n,e,t){lr(n),t=t||Ir(e);const r={shape:n,value:e,dtype:t};return U.runKernel(Hg,{},r)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function o$(n,e,t){const r=K(n,"x","clipByValue");if(T(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return gp(r.shape,e,r.dtype);const s={x:r},i={clipValueMin:e,clipValueMax:t};return U.runKernel(vu,s,i)}const Rr=J({clipByValue_:o$});function l$(n){return qn(n,0)}const u$=J({concat1d_:l$});function c$(n,e){return qn(n,e)}const d$=J({concat2d_:c$});function h$(n,e){return qn(n,e)}const p$=J({concat3d_:h$});function f$(n,e){return qn(n,e)}const m$=J({concat4d_:f$});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function g$(n,e,t,r,s="NHWC",i=[1,1],l){const u=K(n,"x","conv2d","float32"),c=K(e,"filter","conv2d","float32");let h=u,p=!1;u.rank===3&&(p=!0,h=q(u,[1,u.shape[0],u.shape[1],u.shape[2]])),T(h.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${h.rank}.`),T(c.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${c.rank}.`),Jn("conv2d",r,l);const m=s==="NHWC"?h.shape[3]:h.shape[1];T(m===c.shape[2],()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${c.shape[2]}.`),T(Rn(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),T(Ui(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),T(Ui(t),()=>"Error in conv2D: Strides should be larger than 0.");const g={x:h,filter:c},y={strides:t,pad:r,dataFormat:s,dilations:i,dimRoundingMode:l},v=U.runKernel(gh,g,y);return p?q(v,[v.shape[1],v.shape[2],v.shape[3]]):v}const ji=J({conv2d_:g$});function b$(n,e,t,r,s="NWC",i=1,l){const u=K(n,"x","conv1d"),c=K(e,"filter","conv1d");let h=u,p=!1;u.rank===2&&(p=!0,h=q(u,[1,u.shape[0],u.shape[1]])),T(h.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${h.rank}.`),T(c.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${c.rank}.`),Jn("conv1d",r,l),T(h.shape[2]===c.shape[1],()=>`Error in conv1d: depth of input (${h.shape[2]}) must match input depth for filter ${c.shape[1]}.`),T(Rn(t,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${i}'`),T(Ui(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),T(Ui(t),()=>"Error in conv1D: Stride should be larger than 0."),T(s==="NWC",()=>`Error in conv1d: got dataFormat of ${s} but only NWC is currently supported.`);const m=q(c,[1,c.shape[0],c.shape[1],c.shape[2]]),g=q(h,[h.shape[0],1,h.shape[1],h.shape[2]]),y=ji(g,m,[1,t],r,"NHWC",[1,i],l);return p?q(y,[y.shape[2],y.shape[3]]):q(y,[y.shape[0],y.shape[2],y.shape[3]])}const Lk=J({conv1d_:b$});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function y$(n,e,t,r,s,i="NHWC",l){T(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let u=n,c=e,h=!1;e.rank===3&&(h=!0,c=q(e,[1,e.shape[0],e.shape[1],e.shape[2]]),u=[1,n[0],n[1],n[2]]),T(u.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${u.length}.`),T(c.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${c.rank}`),T(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const p=i==="NHWC"?u[3]:u[1],m=i==="NHWC"?c.shape[3]:c.shape[1];T(p===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${p}) must match input depth for filter ${t.shape[2]}.`),T(m===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${m}) must match output depth for filter ${t.shape[3]}.`),Jn("conv2dDerInput",s,l);const g={dy:c,filter:t},y={strides:r,pad:s,dataFormat:i,dimRoundingMode:l,inputShape:u},v=U.runKernel(bh,g,y);return h?q(v,[v.shape[1],v.shape[2],v.shape[3]]):v}const X0=J({conv2DBackpropInput_:y$});function x$(n,e,t,r,s,i){const l=K(n,"x","conv2dTranspose"),u=K(e,"filter","conv2dTranspose");return X0(t,l,u,r,s,"NHWC",i)}const Gk=J({conv2dTranspose_:x$});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function v$(n,e,t,r,s="NDHWC",i=[1,1,1]){const l=K(n,"x","conv3d"),u=K(e,"filter","conv3d");let c=l,h=!1;l.rank===4&&(h=!0,c=q(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),T(c.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${c.rank}.`),T(u.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${u.rank}.`),T(c.shape[4]===u.shape[3],()=>`Error in conv3d: depth of input (${c.shape[4]}) must match input depth for filter ${u.shape[3]}.`),T(Rn(t,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),T(s==="NDHWC",()=>`Error in conv3d: got dataFormat of ${s} but only NDHWC is currently supported.`),T(Ui(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),T(Ui(t),()=>"Error in conv3D: Strides should be larger than 0.");const p={x:c,filter:u},m={strides:t,pad:r,dataFormat:s,dilations:i},g=U.runKernel(yh,p,m);return h?q(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const w$=J({conv3d_:v$});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function k$(n,e,t,r,s){T(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let i=n,l=e,u=!1;e.rank===4&&(u=!0,l=q(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);const c=i[4],h=l.shape[4];T(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),T(l.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${l.rank}`),T(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),T(c===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${c}) must match input depth for filter ${t.shape[3]}.`),T(h===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${h}) must match output depth for filter ${t.shape[4]}.`);const p={dy:l,filter:t},m={pad:s,strides:r,inputShape:i},g=U.runKernel($g,p,m);return u?q(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const zk=J({conv3DBackpropInput_:k$});function I$(n,e,t,r,s){const i=K(n,"x","conv3dTranspose"),l=K(e,"filter","conv3dTranspose");return zk(t,i,l,r,s)}const S$=J({conv3dTranspose_:I$});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function C$(n){const e={x:K(n,"x","cos","float32")};return U.runKernel(wu,e)}const O0=J({cos_:C$});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function T$(n){const e={x:K(n,"x","cosh","float32")};return U.runKernel(ku,e)}const Wk=J({cosh_:T$});/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function N$(n,e=0,t=!1,r=!1){const s={x:K(n,"x","cumprod")},i={axis:e,exclusive:t,reverse:r};return U.runKernel(Fg,s,i)}const D0=J({cumprod_:N$});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function R$(n,e=0,t=!1,r=!1){const s={x:K(n,"x","cumsum")},i={axis:e,exclusive:t,reverse:r};return U.runKernel(xh,s,i)}const Mk=J({cumsum_:R$});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function E$(n,e,t,r=!1){const s=K(n,"x","denseBincount"),i=K(e,"weights","denseBincount");T(s.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${s.dtype}`),T(s.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${s.rank}.`),T(t>=0,()=>`size must be non-negative, but got ${t}.`),T(i.size===s.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${s.shape}, weights shape: ${i.shape}.`);const l={x:s,weights:i},u={size:t,binaryOutput:r};return U.runKernel(Pg,l,u)}const $k=J({denseBincount_:E$});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function L$(n,e,t="NHWC"){const r=K(n,"x","depthToSpace","float32"),s=t==="NHWC"?r.shape[1]:r.shape[2],i=t==="NHWC"?r.shape[2]:r.shape[3],l=t==="NHWC"?r.shape[3]:r.shape[1];T(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),T(s*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${s} and ${e}  for depthToSpace with input shape
    ${r.shape}`),T(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${r.shape}`),T(l%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${l} for depthToSpace with input shape ${r.shape}`);const u={x:r},c={blockSize:e,dataFormat:t};return U.runKernel(Xg,u,c)}const G$=J({depthToSpace_:L$});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function z$(n,e,t,r,s="NHWC",i=[1,1],l){const u=K(n,"x","depthwiseConv2d","float32"),c=K(e,"filter","depthwiseConv2d","float32");let h=u,p=!1;u.rank===3&&(p=!0,h=q(u,[1,u.shape[0],u.shape[1],u.shape[2]])),T(h.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${h.rank}.`),T(c.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${c.rank}.`);const m=s==="NHWC"?h.shape[3]:h.shape[1];T(m===c.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${m}) must match the inChannels dimension in filter ${c.shape[2]}.`),Jn("depthwiseConv2d",r,l);const g={x:h,filter:c},y={strides:t,pad:r,dataFormat:s,dilations:i,dimRoundingMode:l},v=U.runKernel(vh,g,y);return p?q(v,[v.shape[1],v.shape[2],v.shape[3]]):v}const A0=J({depthwiseConv2d_:z$});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function W$(n,e,t,r,s=[1,1],i="NHWC"){const l=K(n,"x","dilation2d"),u=K(e,"filter","dilation2d");T(l.rank===3||l.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${l.rank}.`),T(u.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${u.rank}.`),T(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let c=l,h=!1;l.rank===3&&(c=q(l,[1,l.shape[0],l.shape[1],l.shape[2]]),h=!0),T(c.shape[3]===u.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${c.shape[3]} vs ${u.shape[2]}`);const p={x:c,filter:u},m={strides:t,pad:r,dilations:s},g=U.runKernel(wh,p,m);return h?q(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const M$=J({dilation2d_:W$});/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function el(n,e){const t=n.length,r=[];for(let s=0;s<t;s++){const i=t-1-s,l=n[i]||1;(e[e.length-1-s]||1)>1&&l===1&&r.unshift(i)}return r}function on(n,e){const t=[];for(let r=0;r<e.length;r++){const s=n[n.length-r-1],i=e.length-r-1,l=e[i];(s==null||s===1&&l>1)&&t.unshift(i)}return t}function Ye(n,e){const t=Math.max(n.length,e.length),r=new Array(t);for(let s=0;s<t;s++){let i=n[n.length-s-1];i==null&&(i=1);let l=e[e.length-s-1];if(l==null&&(l=1),i===1)r[t-s-1]=l;else if(l===1)r[t-s-1]=i;else if(i!==l){const u=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(u)}else r[t-s-1]=i}return r}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function $$(n,e){let t=K(n,"a","equal","string_or_numeric"),r=K(e,"b","equal","string_or_numeric");[t,r]=jt(t,r),Ye(t.shape,r.shape);const s={a:t,b:r};return U.runKernel(kh,s)}const Ps=J({equal_:$$});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function F$(n,e,t){const r=K(e,"a","where"),s=K(t,"b","where"),i=K(n,"condition","where","bool"),l=Ye(Ye(i.shape,r.shape),s.shape),u=mc(i,l),c=mc(r,l),h=mc(s,l),p={condition:u,t:c,e:h};return U.runKernel(Jh,p)}const Xn=J({where_:F$});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function V$(n){const e={x:K(n,"x","zerosLike")};return U.runKernel(ip,e)}const st=J({zerosLike_:V$});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function P$(n,e){let t=K(n,"a","div"),r=K(e,"b","div");[t,r]=jt(t,r);const s=Ke(t,r),i=st(s),l=Ps(r,i);return Xn(l,i,s)}const X$=J({divNoNan_:P$});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function O$(n,e){const t=K(n,"t1","dot"),r=K(e,"t2","dot");T((t.rank===1||t.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${r.rank}.`);const s=t.rank===1?t.size:t.shape[1],i=r.rank===1?r.size:r.shape[0];if(T(s===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${s} and ${i}.`),t.rank===1&&r.rank===1){const l=q(t,[1,-1]),u=q(r,[-1,1]),c=dt(l,u);return q(c,[])}else if(t.rank===1&&r.rank===2){const l=q(t,[1,-1]),u=q(r,[r.shape[0],r.shape[1]]),c=dt(l,u);return q(c,[c.size])}else if(t.rank===2&&r.rank===1){const l=q(r,[-1,1]),u=dt(t,l);return q(u,[u.size])}else{const l=q(r,[r.shape[0],r.shape[1]]);return dt(t,l)}}const D$=J({dot_:O$});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function A$(n,...e){const t=e.map((s,i)=>K(s,`tensors${i}`,"einsum")),r={equation:n};return U.runKernel(Zg,t,r)}const gc=J({einsum_:A$});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function K$(n){const e={x:K(n,"x","elu","float32")};return U.runKernel(Su,e)}const bp=J({elu_:K$});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Z$(n){let e=K(n,"x","erf");T(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=ze(e,"float32"));const t={x:e};return U.runKernel(Cu,t)}const B$=J({erf_:Z$});/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function K0(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function Fk(n,e,t){const r=n.length+e.length,s=[];let i=0,l=0;for(let u=0;u<r;u++)t.indexOf(u)===-1?s.push(n[i++]):s.push(e[l++]);return s}function mn(n,e){const t=[],r=n.length;for(let i=0;i<r;i++)e.indexOf(i)===-1&&t.push(n[i]);const s=e.map(i=>n[i]);return[t,s]}function nn(n,e){const t=e.map(r=>1);return Fk(n,t,e)}function In(n,e,t){T(K0(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function Xt(n,e){if(K0(n,e))return null;const t=[];for(let r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach(r=>t.push(r)),t}function _a(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function Yt(n,e){const t=[];for(let r=e-n;r<e;++r)t.push(r);return t}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _$(n,e=null,t=!1){const r={x:K(n,"x","max")},s={reductionIndices:e,keepDims:t};return U.runKernel(Mh,r,s)}const ps=J({max_:_$});/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function H$(n,e=null,t=!1){const r={x:K(n,"x","min")},s={axis:e,keepDims:t};return U.runKernel(Ph,r,s)}const yp=J({min_:H$});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function U$(n,e){let t=K(n,"base","pow"),r=K(e,"exp","pow");[t,r]=jt(t,r);const s={a:t,b:r};return U.runKernel(Du,s)}const tl=J({pow_:U$});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ht(n,e){if((Br(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Br(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return cc(n,[],[],e)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function j$(n){const e={x:K(n,"x","sqrt","float32")};return U.runKernel(qu,e)}const On=J({sqrt_:j$});/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Y$(n){const e=K(n,"x","square"),t={};return U.runKernel("Square",{x:e},t)}const Nt=J({square_:Y$});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Q$(n,e=null,t=!1){let r=K(n,"x","sum");r.dtype==="bool"&&(r=ze(r,"int32"));const s={x:r},i={axis:e,keepDims:t};return U.runKernel(ep,s,i)}const Xe=J({sum_:Q$});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function J$(n,e="euclidean",t=null,r=!1){n=K(n,"x","norm");const s=Vk(n,e,t);let i=s.shape;if(r){const l=oe(t,n.shape);i=nn(s.shape,l)}return q(s,i)}function Vk(n,e,t=null){if(n.rank===0)return Pn(n);if(n.rank!==1&&t===null)return Vk(q(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Xe(Pn(n),t);if(e===1/0)return ps(Pn(n),t);if(e===-1/0)return yp(Pn(n),t);if(e==="euclidean"||e===2)return On(Xe(tl(Pn(n),ht(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return ps(Xe(Pn(n),t[0]),t[1]-1);if(e===1/0)return ps(Xe(Pn(n),t[1]),t[0]);if(e===-1/0)return yp(Xe(Pn(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return On(Xe(Nt(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const xp=J({norm_:J$});/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function q$(n,e=null,t=!1){return xp(n,"euclidean",e,t)}const eF=J({euclideanNorm_:q$});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tF(n){const e={x:K(n,"x","exp")};return U.runKernel(Tu,e)}const Xs=J({exp_:tF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function nF(n,e=0){const t=K(n,"x","expandDims","string_or_numeric");T(e<=t.rank,()=>"Axis must be <= rank of the tensor");const r={input:t},s={dim:e};return U.runKernel(Ih,r,s)}const er=J({expandDims_:nF});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function rF(n){const e={x:K(n,"x","expm1")};return U.runKernel(Nu,e)}const sF=J({expm1_:rF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function aF(n,e){const t=K(n,"x","tile","string_or_numeric");T(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const r={x:t},s={reps:e};return U.runKernel(sc,r,s)}const fs=J({tile_:aF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function iF(n,e,t,r="float32"){e==null&&(e=n);const s=Je([n,e],r),i=n<=e?n:e;for(let u=0;u<i;++u)s.set(1,u,u);const l=q(s.toTensor(),[n,e]);if(t==null)return l;if(t.length===1)return fs(er(l,0),[t[0],1,1]);if(t.length===2)return fs(er(er(l,0),0),[t[0],t[1],1,1]);if(t.length===3)return fs(er(er(er(l,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const Pk=J({eye_:iF});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function oF(n){const e={x:K(n,"x","floor","float32")};return U.runKernel(Ru,e)}const vp=J({floor_:oF});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function lF(n,e,t=0,r=0){const s=K(n,"x","gather"),i=K(e,"indices","gather","int32"),l={x:s,indices:i},u={axis:t,batchDims:r};return U.runKernel(Ch,l,u)}const Z0=J({gather_:lF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function uF(n,e){let t=K(n,"a","greater","string_or_numeric"),r=K(e,"b","greater","string_or_numeric");[t,r]=jt(t,r),Ye(t.shape,r.shape);const s={a:t,b:r};return U.runKernel(Th,s)}const Er=J({greater_:uF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cF(n,e){let t=K(n,"a","greaterEqual","string_or_numeric"),r=K(e,"b","greaterEqual","string_or_numeric");[t,r]=jt(t,r),Ye(t.shape,r.shape);const s={a:t,b:r};return U.runKernel(Lu,s)}const Yi=J({greaterEqual_:cF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function dF(n){const e={input:K(n,"input","imag")};return U.runKernel(Yg,e)}const B0=J({imag_:dF});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hF(n){const e={x:K(n,"x","isFinite")};return U.runKernel(zu,e)}const pF=J({isFinite_:hF});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function fF(n){const e={x:K(n,"x","isInf")};return U.runKernel(Wu,e)}const mF=J({isInf_:fF});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function gF(n){const e={x:K(n,"x","isNaN")};return U.runKernel(Mu,e)}const bF=J({isNaN_:gF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yF(n,e=.2){const t={x:K(n,"x","leakyRelu")},r={alpha:e};return U.runKernel(Nh,t,r)}const _0=J({leakyRelu_:yF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xF(n,e){let t=K(n,"a","less","string_or_numeric"),r=K(e,"b","less","string_or_numeric");[t,r]=jt(t,r),Ye(t.shape,r.shape);const s={a:t,b:r};return U.runKernel(Rh,s)}const wp=J({less_:xF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vF(n,e){let t=K(n,"a","lessEqual","string_or_numeric"),r=K(e,"b","lessEqual","string_or_numeric");[t,r]=jt(t,r),Ye(t.shape,r.shape);const s={a:t,b:r};return U.runKernel(Eh,s)}const nl=J({lessEqual_:vF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function wF(n,e=5,t=1,r=1,s=.5){const i=K(n,"x","localResponseNormalization");T(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),T(H(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let l=i,u=!1;i.rank===3&&(u=!0,l=q(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const c={x:l},h={depthRadius:e,bias:t,alpha:r,beta:s},p=U.runKernel(Wh,c,h);return u?q(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const kF=J({localResponseNormalization_:wF});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function IF(n){const e={x:K(n,"x","log","float32")};return U.runKernel($u,e)}const Os=J({log_:IF});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function SF(n){const e={x:K(n,"x","log1p")};return U.runKernel(Fu,e)}const Xk=J({log1p_:SF});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function CF(n,e){T(Ge(n),()=>"The f passed in variableGrads(f) must be a function"),T(e==null||Array.isArray(e)&&e.every(h=>h instanceof fp),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const h in U.registeredVariables)e.push(U.registeredVariables[h])}const r=t?e.filter(h=>!h.trainable):null,s=e.length;e=e.filter(h=>h.trainable),T(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${s} variables is trainable.`);const i=!0,{value:l,grads:u}=U.gradients(n,e,null,i);T(u.some(h=>h!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),T(l.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${l.rank} tensor`);const c={};return e.forEach((h,p)=>{u[p]!=null&&(c[h.name]=u[p])}),r!=null&&r.forEach(h=>c[h.name]=null),{value:l,grads:c}}function rl(n){return U.customGrad(n)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function TF(n){const e={x:K(n,"x","neg")};return U.runKernel(Oh,e)}const Qt=J({neg_:TF});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function NF(n){const e={x:K(n,"x","softplus")};return U.runKernel(Ju,e)}const bc=J({softplus_:NF});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function RF(n){const e=K(n,"x","logSigmoid");return rl(t=>({value:Qt(bc(Qt(t))),gradFunc:r=>j(r,qo(Qt(t)))}))(e)}const EF=J({logSigmoid_:RF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function LF(n,e){let t=K(n,"a","sub"),r=K(e,"b","sub");[t,r]=jt(t,r);const s={a:t,b:r};return U.runKernel(tc,s)}const Ze=J({sub_:LF});/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function GF(n,e=-1){const t=K(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return rl((r,s)=>{const i=ps(r,e,!0),l=Ze(r,i),u=Ze(ze(l,"float32"),Os(Xe(Xs(l),e,!0)));return s([u]),{value:u,gradFunc:(c,h)=>{const[p]=h,m=!0,g=Xs(p);return Ze(c,j(Xe(c,e,m),g))}}})(t)}const Ok=J({logSoftmax_:GF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function zF(n,e=null,t=!1){const r=K(n,"x","logSumExp"),s=oe(e,r.shape),i=ps(r,s,!0),l=Ze(r,i),u=Xs(l),c=Xe(u,s),h=Os(c),p=ke(q(i,h.shape),h);if(t){const m=nn(p.shape,s);return q(p,m)}return p}const Dk=J({logSumExp_:zF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function WF(n,e){const t=K(n,"a","logicalAnd","bool"),r=K(e,"b","logicalAnd","bool");Ye(t.shape,r.shape);const s={a:t,b:r};return U.runKernel(Lh,s)}const fa=J({logicalAnd_:WF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function MF(n){const e={x:K(n,"x","logicalNot","bool")};return U.runKernel(Gh,e)}const H0=J({logicalNot_:MF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function $F(n,e){const t=K(n,"a","logicalOr","bool"),r=K(e,"b","logicalOr","bool");Ye(t.shape,r.shape);const s={a:t,b:r};return U.runKernel(zh,s)}const Ak=J({logicalOr_:$F});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function FF(n,e){const t=K(n,"a","logicalXor","bool"),r=K(e,"b","logicalXor","bool");return Ye(t.shape,r.shape),fa(Ak(n,e),H0(fa(n,e)))}const VF=J({logicalXor_:FF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function PF(n,e,t,r,s){const i=K(n,"x","maxPool"),l=1;let u=i,c=!1;i.rank===3&&(c=!0,u=q(i,[1,i.shape[0],i.shape[1],i.shape[2]])),T(u.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${u.rank}.`),T(Rn(t,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${l}'`),Jn("maxPool",r,s);const h={x:u},p={filterSize:e,strides:t,pad:r,dimRoundingMode:s},m=U.runKernel($h,h,p);return c?q(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const U0=J({maxPool_:PF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function XF(n,e=[1,1,1],t,r,s,i="NDHWC"){const l=K(n,"x","maxPool3d");let u=l,c=!1;l.rank===4&&(c=!0,u=q(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),T(u.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${u.rank}.`),T(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),Jn("maxPool3d",r,s);const h={x:u},p={filterSize:e,strides:t,pad:r,dimRoundingMode:s,dataFormat:i},m=U.runKernel(Fh,h,p);return c?q(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const OF=J({maxPool3d_:XF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function DF(n,e){let t=K(n,"a","maximum"),r=K(e,"b","maximum");[t,r]=jt(t,r),t.dtype==="bool"&&(t=ze(t,"int32"),r=ze(r,"int32")),Ye(t.shape,r.shape);const s={a:t,b:r};return U.runKernel(Vu,s)}const Ha=J({maximum_:DF});/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function AF(n,e=null,t=!1){const r={x:K(n,"x","mean")},s={axis:e,keepDims:t};return U.runKernel(Vh,r,s)}const rn=J({mean_:AF});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function gn(n,e="float32"){if(lr(n),e==="complex64"){const r=gn(n,"float32"),s=gn(n,"float32");return jo(r,s)}const t=Pt(M(n),e);return U.makeTensor(t,n,e)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ua(n,e="float32"){if(lr(n),e==="complex64"){const r=Ua(n,"float32"),s=gn(n,"float32");return jo(r,s)}const t=$n(M(n),e);return U.makeTensor(t,n,e)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function KF(n,e){let t=K(n,"a","minimum"),r=K(e,"b","minimum");[t,r]=jt(t,r),t.dtype==="bool"&&(t=ze(t,"int32"),r=ze(r,"int32")),Ye(t.shape,r.shape);const s={a:t,b:r};return U.runKernel(Pu,s)}const yc=J({minimum_:KF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ZF(n,e,t){T(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const r=K(n,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");T(e.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`);const s=t==="reflect"?1:0;for(let u=0;u<r.rank;u++)T(e[u].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),T(e[u][0]>=0&&e[u][0]<=r.shape[u]-s&&e[u][1]>=0&&e[u][1]<=r.shape[u]-s,()=>`Padding in dimension ${u} cannot be greater than or equal to ${r.shape[u]-s} or less than 0 for input of shape ${r.shape}`);const i={paddings:e,mode:t},l={x:r};return U.runKernel(Xh,l,i)}const BF=J({mirrorPad_:ZF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _F(n,e){let t=K(n,"a","mod"),r=K(e,"b","mod");[t,r]=jt(t,r);const s={a:t,b:r};return U.runKernel(Xu,s)}const HF=J({mod_:_F});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function UF(n,e=null,t=!1){n=K(n,"x","moments");const r=oe(e,n.shape),s=rn(n,r,t);let i=s.shape;t||(i=nn(s.shape,r));const l=Nt(Ze(ze(n,"float32"),q(s,i))),u=rn(l,r,t);return{mean:s,variance:u}}const j0=J({moments_:UF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function jF(n,e){let t=K(n,"a","notEqual","string_or_numeric"),r=K(e,"b","notEqual","string_or_numeric");[t,r]=jt(t,r),Ye(t.shape,r.shape);const s={a:t,b:r};return U.runKernel(Dh,s)}const kp=J({notEqual_:jF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function YF(n,e,t=1,r=0,s="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const i={indices:K(n,"indices","oneHot","int32")},l={dtype:s,depth:e,onValue:t,offValue:r};return U.runKernel(Kh,i,l)}const Kk=J({oneHot_:YF});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function QF(n){const e={x:K(n,"x","onesLike")};return U.runKernel(Ah,e)}const Hr=J({onesLike_:QF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function JF(n,e,t=0){const r=K(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const s={paddings:e,constantValue:t},i={x:r};return U.runKernel(Bh,i,s)}const Y0=J({pad_:JF});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function qF(n,e,t){const r=K(n,"x","spaceToBatchND");T(r.rank>=1+e.length,()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`),T(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),T(r.shape.reduce((l,u,c)=>c>0&&c<=e.length?l&&(u+t[c-1][0]+t[c-1][1])%e[c-1]===0:l,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const s={x:r},i={blockShape:e,paddings:t};return U.runKernel(tp,s,i)}const Q0=J({spaceToBatchND_:qF});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function eV(n,e,t,r,s,i,l){s==null&&(s=[1,1]),i==null&&(i=1),r===0&&(r="valid");const u=K(n,"x","maxPool");let c=u,h=!1;u.rank===3&&(h=!0,c=q(u,[1,u.shape[0],u.shape[1],u.shape[2]])),T(Rn(i,s),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${s}'`);const p=_r(c.shape,e,i,s,r),m=[p.dilationHeight,p.dilationWidth];let g;r==="same"?g=nV([p.filterHeight,p.filterWidth],m):g=[[0,0],[0,0]];const y=m[0]===1&&m[1]===1,[v,w]=tV([p.inHeight,p.inWidth],m,g),S=y?r:"valid",I=y?c:Q0(c,m,v),C=(t==="avg"?()=>F0(I,e,i,S,l):()=>U0(I,e,i,S,l))(),R=y?C:P0(C,m,w);return h?q(R,[R.shape[1],R.shape[2],R.shape[3]]):R}function tV(n,e,t){const r=t.map(p=>p[0]),s=t.map(p=>p[1]),i=n.concat(r,s),l=e.map((p,m)=>(p-i[m]%p)%p),u=s.map((p,m)=>p+l[m]),c=e.map((p,m)=>[r[m],u[m]]),h=e.map((p,m)=>[0,l[m]]);return[c,h]}function nV(n,e){const t=n.map((i,l)=>i+(i-1)*(e[l]-1)).map(i=>i-1),r=t.map(i=>Math.floor(i/2)),s=t.map((i,l)=>i-r[l]);return t.map((i,l)=>[r[l],s[l]])}const rV=J({pool_:eV});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sV(n,e){const t=K(n,"x","prelu"),r=K(e,"alpha","prelu"),s={x:t,alpha:r};return U.runKernel(_h,s)}const J0=J({prelu_:sV});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function aV(n,e=null,t=!1){let r=K(n,"x","prod");r.dtype==="bool"&&(r=ze(r,"int32"));const s={x:r},i={axis:e,keepDims:t};return U.runKernel(Hh,s,i)}const iV=J({prod_:aV});var Zk={exports:{}};(function(n){(function(e,t,r){function s(c){var h=this,p=u();h.next=function(){var m=2091639*h.s0+h.c*23283064365386963e-26;return h.s0=h.s1,h.s1=h.s2,h.s2=m-(h.c=m|0)},h.c=1,h.s0=p(" "),h.s1=p(" "),h.s2=p(" "),h.s0-=p(c),h.s0<0&&(h.s0+=1),h.s1-=p(c),h.s1<0&&(h.s1+=1),h.s2-=p(c),h.s2<0&&(h.s2+=1),p=null}function i(c,h){return h.c=c.c,h.s0=c.s0,h.s1=c.s1,h.s2=c.s2,h}function l(c,h){var p=new s(c),m=h&&h.state,g=p.next;return g.int32=function(){return p.next()*4294967296|0},g.double=function(){return g()+(g()*2097152|0)*11102230246251565e-32},g.quick=g,m&&(typeof m=="object"&&i(m,p),g.state=function(){return i(p,{})}),g}function u(){var c=4022871197,h=function(p){p=String(p);for(var m=0;m<p.length;m++){c+=p.charCodeAt(m);var g=.02519603282416938*c;c=g>>>0,g-=c,g*=c,c=g>>>0,g-=c,c+=g*4294967296}return(c>>>0)*23283064365386963e-26};return h}t&&t.exports?t.exports=l:this.alea=l})(Fi,n)})(Zk);var oV=Zk.exports,Bk={exports:{}};(function(n){(function(e,t,r){function s(u){var c=this,h="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var m=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^m^m>>>8},u===(u|0)?c.x=u:h+=u;for(var p=0;p<h.length+64;p++)c.x^=h.charCodeAt(p)|0,c.next()}function i(u,c){return c.x=u.x,c.y=u.y,c.z=u.z,c.w=u.w,c}function l(u,c){var h=new s(u),p=c&&c.state,m=function(){return(h.next()>>>0)/4294967296};return m.double=function(){do var g=h.next()>>>11,y=(h.next()>>>0)/4294967296,v=(g+y)/(1<<21);while(v===0);return v},m.int32=h.next,m.quick=m,p&&(typeof p=="object"&&i(p,h),m.state=function(){return i(h,{})}),m}t&&t.exports?t.exports=l:this.xor128=l})(Fi,n)})(Bk);var lV=Bk.exports,_k={exports:{}};(function(n){(function(e,t,r){function s(u){var c=this,h="";c.next=function(){var m=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^(m^m<<1))|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,u===(u|0)?c.x=u:h+=u;for(var p=0;p<h.length+64;p++)c.x^=h.charCodeAt(p)|0,p==h.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function i(u,c){return c.x=u.x,c.y=u.y,c.z=u.z,c.w=u.w,c.v=u.v,c.d=u.d,c}function l(u,c){var h=new s(u),p=c&&c.state,m=function(){return(h.next()>>>0)/4294967296};return m.double=function(){do var g=h.next()>>>11,y=(h.next()>>>0)/4294967296,v=(g+y)/(1<<21);while(v===0);return v},m.int32=h.next,m.quick=m,p&&(typeof p=="object"&&i(p,h),m.state=function(){return i(h,{})}),m}t&&t.exports?t.exports=l:this.xorwow=l})(Fi,n)})(_k);var uV=_k.exports,Hk={exports:{}};(function(n){(function(e,t,r){function s(u){var c=this;c.next=function(){var p=c.x,m=c.i,g,y;return g=p[m],g^=g>>>7,y=g^g<<24,g=p[m+1&7],y^=g^g>>>10,g=p[m+3&7],y^=g^g>>>3,g=p[m+4&7],y^=g^g<<7,g=p[m+7&7],g=g^g<<13,y^=g^g<<9,p[m]=y,c.i=m+1&7,y};function h(p,m){var g,y=[];if(m===(m|0))y[0]=m;else for(m=""+m,g=0;g<m.length;++g)y[g&7]=y[g&7]<<15^m.charCodeAt(g)+y[g+1&7]<<13;for(;y.length<8;)y.push(0);for(g=0;g<8&&y[g]===0;++g);for(g==8?y[7]=-1:y[g],p.x=y,p.i=0,g=256;g>0;--g)p.next()}h(c,u)}function i(u,c){return c.x=u.x.slice(),c.i=u.i,c}function l(u,c){u==null&&(u=+new Date);var h=new s(u),p=c&&c.state,m=function(){return(h.next()>>>0)/4294967296};return m.double=function(){do var g=h.next()>>>11,y=(h.next()>>>0)/4294967296,v=(g+y)/(1<<21);while(v===0);return v},m.int32=h.next,m.quick=m,p&&(p.x&&i(p,h),m.state=function(){return i(h,{})}),m}t&&t.exports?t.exports=l:this.xorshift7=l})(Fi,n)})(Hk);var cV=Hk.exports,Uk={exports:{}};(function(n){(function(e,t,r){function s(u){var c=this;c.next=function(){var p=c.w,m=c.X,g=c.i,y,v;return c.w=p=p+1640531527|0,v=m[g+34&127],y=m[g=g+1&127],v^=v<<13,y^=y<<17,v^=v>>>15,y^=y>>>12,v=m[g]=v^y,c.i=g,v+(p^p>>>16)|0};function h(p,m){var g,y,v,w,S,I=[],C=128;for(m===(m|0)?(y=m,m=null):(m=m+"\0",y=0,C=Math.max(C,m.length)),v=0,w=-32;w<C;++w)m&&(y^=m.charCodeAt((w+32)%m.length)),w===0&&(S=y),y^=y<<10,y^=y>>>15,y^=y<<4,y^=y>>>13,w>=0&&(S=S+1640531527|0,g=I[w&127]^=y+S,v=g==0?v+1:0);for(v>=128&&(I[(m&&m.length||0)&127]=-1),v=127,w=4*128;w>0;--w)y=I[v+34&127],g=I[v=v+1&127],y^=y<<13,g^=g<<17,y^=y>>>15,g^=g>>>12,I[v]=y^g;p.w=S,p.X=I,p.i=v}h(c,u)}function i(u,c){return c.i=u.i,c.w=u.w,c.X=u.X.slice(),c}function l(u,c){u==null&&(u=+new Date);var h=new s(u),p=c&&c.state,m=function(){return(h.next()>>>0)/4294967296};return m.double=function(){do var g=h.next()>>>11,y=(h.next()>>>0)/4294967296,v=(g+y)/(1<<21);while(v===0);return v},m.int32=h.next,m.quick=m,p&&(p.X&&i(p,h),m.state=function(){return i(h,{})}),m}t&&t.exports?t.exports=l:this.xor4096=l})(Fi,n)})(Uk);var dV=Uk.exports,jk={exports:{}};(function(n){(function(e,t,r){function s(u){var c=this,h="";c.next=function(){var m=c.b,g=c.c,y=c.d,v=c.a;return m=m<<25^m>>>7^g,g=g-y|0,y=y<<24^y>>>8^v,v=v-m|0,c.b=m=m<<20^m>>>12^g,c.c=g=g-y|0,c.d=y<<16^g>>>16^v,c.a=v-m|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,u===Math.floor(u)?(c.a=u/4294967296|0,c.b=u|0):h+=u;for(var p=0;p<h.length+20;p++)c.b^=h.charCodeAt(p)|0,c.next()}function i(u,c){return c.a=u.a,c.b=u.b,c.c=u.c,c.d=u.d,c}function l(u,c){var h=new s(u),p=c&&c.state,m=function(){return(h.next()>>>0)/4294967296};return m.double=function(){do var g=h.next()>>>11,y=(h.next()>>>0)/4294967296,v=(g+y)/(1<<21);while(v===0);return v},m.int32=h.next,m.quick=m,p&&(typeof p=="object"&&i(p,h),m.state=function(){return i(h,{})}),m}t&&t.exports?t.exports=l:this.tychei=l})(Fi,n)})(jk);var hV=jk.exports,Yk={exports:{}};const pV=gW(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));(function(n){(function(e,t,r){var s=256,i=6,l=52,u="random",c=r.pow(s,i),h=r.pow(2,l),p=h*2,m=s-1,g;function y(L,G,$){var F=[];G=G==!0?{entropy:!0}:G||{};var V=I(S(G.entropy?[L,R(t)]:L??C(),3),F),D=new v(F),Z=function(){for(var ne=D.g(i),re=c,se=0;ne<h;)ne=(ne+se)*s,re*=s,se=D.g(1);for(;ne>=p;)ne/=2,re/=2,se>>>=1;return(ne+se)/re};return Z.int32=function(){return D.g(4)|0},Z.quick=function(){return D.g(4)/4294967296},Z.double=Z,I(R(D.S),t),(G.pass||$||function(ne,re,se,ue){return ue&&(ue.S&&w(ue,D),ne.state=function(){return w(D,{})}),se?(r[u]=ne,re):ne})(Z,V,"global"in G?G.global:this==r,G.state)}function v(L){var G,$=L.length,F=this,V=0,D=F.i=F.j=0,Z=F.S=[];for($||(L=[$++]);V<s;)Z[V]=V++;for(V=0;V<s;V++)Z[V]=Z[D=m&D+L[V%$]+(G=Z[V])],Z[D]=G;(F.g=function(ne){for(var re,se=0,ue=F.i,le=F.j,he=F.S;ne--;)re=he[ue=m&ue+1],se=se*s+he[m&(he[ue]=he[le=m&le+re])+(he[le]=re)];return F.i=ue,F.j=le,se})(s)}function w(L,G){return G.i=L.i,G.j=L.j,G.S=L.S.slice(),G}function S(L,G){var $=[],F=typeof L,V;if(G&&F=="object")for(V in L)try{$.push(S(L[V],G-1))}catch{}return $.length?$:F=="string"?L:L+"\0"}function I(L,G){for(var $=L+"",F,V=0;V<$.length;)G[m&V]=m&(F^=G[m&V]*19)+$.charCodeAt(V++);return R(G)}function C(){try{var L;return g&&(L=g.randomBytes)?L=L(s):(L=new Uint8Array(s),(e.crypto||e.msCrypto).getRandomValues(L)),R(L)}catch{var G=e.navigator,$=G&&G.plugins;return[+new Date,e,$,e.screen,R(t)]}}function R(L){return String.fromCharCode.apply(0,L)}if(I(r.random(),t),n.exports){n.exports=y;try{g=pV}catch{}}else r["seed"+u]=y})(typeof self<"u"?self:Fi,[],Math)})(Yk);var fV=Yk.exports,mV=oV,gV=lV,bV=uV,yV=cV,xV=dV,vV=hV,Qi=fV;Qi.alea=mV,Qi.xor128=gV,Qi.xorwow=bV,Qi.xorshift7=yV,Qi.xor4096=xV,Qi.tychei=vV;var q0=Qi;/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Qk{constructor(e,t,r,s,i){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=s,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const l=i||Math.random();this.random=q0.alea(l.toString())}nextValue(){if(!isNaN(this.nextVal)){const s=this.nextVal;return this.nextVal=NaN,s}let e,t,r=!1;for(;!r;){let s,i,l;do s=2*this.random()-1,i=2*this.random()-1,l=s*s+i*i;while(l>=1||l===0);const u=Math.sqrt(-2*Math.log(l)/l);e=this.mean+this.stdDev*s*u,t=this.mean+this.stdDev*i*u,(!this.truncated||this.isValidTruncated(e))&&(r=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class wV{constructor(e=0,t=1,r,s){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=r,s==null&&(s=Math.random()),typeof s=="number"&&(s=s.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=q0.alea(s)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function kV(n,e=0,t=1,r,s){if(lr(n),r!=null&&r==="bool")throw new Error(`Unsupported data type ${r}`);const i=new Qk(e,t,r,!1,s),l=Je(n,r);for(let u=0;u<l.values.length;u++)l.values[u]=i.nextValue();return l.toTensor()}const IV=J({randomNormal_:kV});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function SV(n,e=0,t=1,r="float32",s){lr(n);const i=Je(n,r),l=new wV(e,t,null,s);for(let u=0;u<i.values.length;u++)i.values[u]=l.nextValue();return i.toTensor()}const xc=J({randomUniform_:SV});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vc(n,e,t=1,r="float32"){if(t===0)throw new Error("Cannot have a step of zero");const s={start:n,stop:e,step:t,dtype:r};return U.runKernel(r0,{},s)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function CV(n){const e={input:K(n,"input","real")};return U.runKernel(s0,e)}const Ip=J({real_:CV});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function TV(n){const e={x:K(n,"x","reciprocal")};return U.runKernel(Au,e)}const NV=J({reciprocal_:TV});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function RV(n){const e={x:K(n,"x","relu")};return U.runKernel(Ku,e)}const Ji=J({relu_:RV});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function EV(n){const e={x:K(n,"x","relu6")};return U.runKernel(Zu,e)}const Jk=J({relu6_:EV});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function LV(n,e){const t={x:K(n,"x","reverse")},r={dims:e};return U.runKernel(Qh,t,r)}const qi=J({reverse_:LV});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function GV(n){const e={x:K(n,"x","round")};return U.runKernel(Bu,e)}const qk=J({round_:GV});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function zV(n){const e={x:K(n,"x","rsqrt","float32")};return U.runKernel(_u,e)}const e2=J({rsqrt_:zV});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function WV(n){const e={x:K(n,"x","selu")};return U.runKernel(Hu,e)}const t2=J({selu_:WV});function MV(n,e,t,r,s,i=[1,1],l="NHWC"){const u=K(n,"x","separableConv2d"),c=K(e,"depthwiseFilter","separableConv2d"),h=K(t,"pointwiseFilter","separableConv2d");let p=u,m=!1;if(u.rank===3&&(m=!0,p=q(u,[1,u.shape[0],u.shape[1],u.shape[2]])),l==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");T(p.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${p.rank}.`),T(c.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${c.rank}.`),T(h.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${c.rank}.`),T(h.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${h.shape[0]}.`),T(h.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${h.shape[1]}.`);const g=c.shape[2],y=c.shape[3];T(h.shape[2]===g*y,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${g*y}, but got ${h.shape[2]}.`);const v=A0(p,c,r,s,l,i),w=ji(v,h,1,"valid",l);return m?q(w,[w.shape[1],w.shape[2],w.shape[3]]):w}const n2=J({separableConv2d_:MV});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function $V(n){const e={x:K(n,"x","sign")};return U.runKernel(Yu,e)}const FV=J({sign_:$V});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function VV(n){const e={x:K(n,"x","sin","float32")};return U.runKernel(Uu,e)}const r2=J({sin_:VV});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function PV(n){const e={x:K(n,"x","sinh")};return U.runKernel(ju,e)}const s2=J({sinh_:PV});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function XV(n,e,t){const r=K(n,"x","slice1d");return T(r.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),wt(r,[e],[t])}const eb=J({slice1d_:XV});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function OV(n,e,t){const r=K(n,"x","slice2d");return T(r.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),wt(r,e,t)}const a2=J({slice2d_:OV});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function DV(n,e,t){const r=K(n,"x","slice3d");return T(r.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),wt(r,e,t)}const tb=J({slice3d_:DV});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function AV(n,e,t){const r=K(n,"x","slice4d");return T(r.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),wt(r,e,t)}const Sp=J({slice4d_:AV});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function KV(n,e=-1){const t=K(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const r={logits:t},s={dim:e};return U.runKernel(rp,r,s)}const nb=J({softmax_:KV});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ZV(n){T(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return U.runKernel(_g,e)}const i2=J({fft_:ZV});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function BV(n){T(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return U.runKernel(jg,e)}const rb=J({ifft_:BV});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _V(n){const e=n.shape[n.shape.length-1],t=n.size/e;let r;if(e<=2){const s=q(n,[t,e]);r=rb(s)}else{const s=[t,2*(e-1)],i=q(Ip(n),[t,e]),l=q(B0(n),[t,e]),u=qi(wt(i,[0,1],[t,e-2]),1),c=j(qi(wt(l,[0,1],[t,e-2]),1),ht(-1)),h=qn([i,u],1),p=qn([l,c],1),m=q(jo(h,p),[s[0],s[1]]);r=rb(m)}if(r=Ip(r),n.rank===3&&n.shape[0]!==0){const s=r,i=n.shape[0];r=q(r,[i,r.shape[0]/i,r.shape[1]]),s.dispose()}return r}const HV=J({irfft_:_V});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function UV(n,e,t=0){const r={x:K(n,"x","split")},s={numOrSizeSplits:e,axis:t};return U.runKernel(np,r,s)}const Lr=J({split_:UV});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function jV(n,e){T(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const r=n.size/t;let s;if(e!=null&&e<t){const v=n.shape.map(S=>0),w=n.shape.map(S=>S);w[n.shape.length-1]=e,s=wt(n,v,w),t=e}else if(e!=null&&e>t){const v=n.shape.map(w=>w);v[n.shape.length-1]=e-t,s=qn([n,gn(v)],n.shape.length-1),t=e}else s=n;const i=st(s),l=q(jo(s,i),[r,t]),u=i2(l),c=Math.floor(t/2)+1,h=Ip(u),p=B0(u),m=Lr(h,[c,t-c],h.shape.length-1),g=Lr(p,[c,t-c],p.shape.length-1),y=s.shape.slice();return y[s.shape.length-1]=c,q(jo(m[0],g[0]),y)}const YV=J({rfft_:jV});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function QV(n,e){let t=K(n,"a","squaredDifference"),r=K(e,"b","squaredDifference");[t,r]=jt(t,r),Ye(t.shape,r.shape);const s={a:t,b:r},i={};return U.runKernel(ec,s,i)}const JV=J({squaredDifference_:QV});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function qV(n,e){const t=K(n,"x","squeeze","string_or_numeric");return q(t,fe(t.shape,e).newShape)}const wc=J({squeeze_:qV});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function eP(n,e=0){const t=mk(n,"tensors","stack","string_or_numeric");T(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&T(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const r=t,s={axis:e};return U.runKernel(Zh,r,s)}const Ds=J({stack_:eP});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tP(n,e=0){const t={x:K(n,"x","step")},r={alpha:e};return U.runKernel(ac,t,r)}const kc=J({step_:tP});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function nP(n,e,t,r,s=0,i=0,l=0,u=0,c=0){const h={x:K(n,"x","stridedSlice","string_or_numeric")},p={begin:e,end:t,strides:r,beginMask:s,endMask:i,ellipsisMask:l,newAxisMask:u,shrinkAxisMask:c};return U.runKernel(u0,h,p)}const rP=J({stridedSlice_:nP});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sP(n){const e={x:K(n,"x","tan","float32")};return U.runKernel(nc,e)}const aP=J({tan_:sP});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hr(n,e){Y(n);const t=uc(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return cc(n,null,t,e)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sb(n,e,t){if(Y(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const r=uc(n,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return cc(n,e,r,t)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function iP(n,e,t){if(Y(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const r=uc(n,t);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return cc(n,e,r,t)}function o2(n,e,t){const r=e.rank>1?e.shape[e.rank-1]:1,s=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${r}, and batchDim: ${s}.`;if(t.rank<s)throw new Error(i+` update.rank < ${s}. `);if(n.length<r+(t.rank-s))throw new Error(i+` Output shape length < ${r+(t.rank-s)}`);if(t.rank!==s+n.length-r)throw new Error(i+` update.rank != ${s+n.length-r}`);for(let l=0;l<s;++l)if(t.shape[l]!==e.shape[l])throw new Error(i+` updates.shape[${l}] (${t.shape[l]}) != indices.shape[${l}] (${e.shape[l]}).`);for(let l=0;l<t.rank-s;++l)if(t.shape[l+s]!==n[l+r])throw new Error(i+` updates.shape[${l+s}] (${t.shape[l+s]}) != shape[${l+s}] (${n[l+s]})`)}function oP(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}o2(t,e,n)}function eo(n,e,t){const r=e.shape.length,s=r>1?e.shape[r-1]:1,i=t.length;let l=1;for(let m=s;m<i;++m)l*=t[m];const u=s<1?1:s,c=M(e.shape)/u,h=[...we(t.slice(0,s)),1],p=M(t);return{sliceRank:s,numUpdates:c,sliceSize:l,strides:h,outputSize:p}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function lP(n,e=1,t=!0){const r=K(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const s=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>s)throw new Error(`'k' passed to topk() must be <= the last dimension (${s}) but got ${e}`);const i={x:r},l={k:e,sorted:t},[u,c]=U.runKernel(c0,i,l);return{values:u,indices:c}}const uP=J({topk_:lP});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cP(n,e=0,t=1,r,s){if(lr(n),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");const i=new Qk(e,t,r,!0,s),l=Je(n,r);for(let u=0;u<l.values.length;u++)l.values[u]=i.nextValue();return l.toTensor()}const l2=J({truncatedNormal_:cP});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function dP(n,e=0){const t=K(n,"x","unique","string_or_numeric");T(t.rank>0,()=>"The input tensor must be at least 1D");const r={x:t},s={axis:e},[i,l]=U.runKernel(h0,r,s);return{values:i,indices:l}}const hP=J({unique_:dP});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function pP(n,e,t){const r=K(n,"x","unsortedSegmentSum"),s=K(e,"segmentIds","unsortedSegmentSum","int32");T(H(t),()=>"numSegments must be of dtype int");const i={x:r,segmentIds:s},l={numSegments:t};return U.runKernel(ap,i,l)}const u2=J({unsortedSegmentSum_:pP});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function fP(n,e=0){const t=K(n,"x","unstack","string_or_numeric");T(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const r={value:t},s={axis:e};return U.runKernel(sp,r,s)}const to=J({unstack_:fP});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mP(n,e=!0,t,r){return U.makeVariable(n,e,t,r)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function c2(n,e){const t=[];for(let i=0;i<e.length;i++)e[i]&&t.push(i);const r=Je(n,"int32"),s=Je([t.length,n.length],"int32");for(let i=0;i<t.length;i++){const l=r.indexToLoc(t[i]),u=i*n.length;s.values.set(l,u)}return s.toTensor()}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function gP(n,e,t){const r=K(n,"x","transpose");if(e==null&&(e=r.shape.map((l,u)=>u).reverse()),T(r.rank===e.length,()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`),e.forEach(l=>{T(l>=0&&l<r.rank,()=>`All entries in 'perm' must be between 0 and ${r.rank-1} but got ${e}`)}),r.rank<=1)return r.clone();const s={x:r},i={perm:e};return r.dtype==="complex64"?ee(()=>{let l=Ip(r),u=B0(r);return l=U.runKernel(Zo,{x:l},i),u=U.runKernel(Zo,{x:u},i),t&&(u=Qt(u)),jo(l,u)}):U.runKernel(Zo,s,i)}const at=J({transpose_:gP});/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function bP(n,e){if(e==null)return n.shape.slice();if(B(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let r=0;r<n.shape.length;r++)e[r]==null&&n.shape[r]!=null?t.push(n.shape[r]):t.push(e[r]);return t}return e}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yP(n,e,t,r){const s=K(n,"x","dropout");if(T(s.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${s.dtype} tensor instead.`),T(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof an?s.clone():s;const i=bP(s,t),l=1-e,u=Ke(vp(ke(xc(i,0,1,"float32",r),l)),l);return j(s,u)}const xP=J({dropout_:yP});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vP(n,e,t,r,s,i="NHWC",l){let u=n;n.rank===3&&(u=q(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let c=e;c.rank===3&&(c=q(e,[1,e.shape[0],e.shape[1],e.shape[2]])),T(u.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${u.shape}.`),T(c.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${c.shape}.`),T(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const h=i==="NHWC"?u.shape[3]:u.shape[1],p=i==="NHWC"?c.shape[3]:c.shape[1];T(h===t[2],()=>`Error in conv2dDerFilter: depth of input ${h}) must match input depth in filter (${t[2]}.`),T(p===t[3],()=>`Error in conv2dDerFilter: depth of dy (${p}) must match output depth for filter (${t[3]}).`),Jn("conv2dDerFilter",s,l);const m={x:u,dy:c},g={strides:r,pad:s,dataFormat:i,dimRoundingMode:l,filterShape:t};return U.runKernel(Wg,m,g)}const ab=J({conv2DBackpropFilter_:vP});/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ib(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return j(n,kc(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function ob(n,e){let t=e;const r=on(n.shape,e.shape);return r.length>0&&(t=Xe(t,r)),q(t,n.shape)}function lb(n,e,t,r){if(e==="linear")return n;if(e==="relu")return Ji(n);if(e==="elu")return bp(n);if(e==="relu6")return Jk(n);if(e==="prelu")return J0(n,t);if(e==="leakyrelu")return _0(n,r);if(e==="sigmoid")return qo(n);throw new Error(`Unknown fused activation ${e}.`)}const ub=(n,e)=>!(n>0)||e==="linear";/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function wP({x:n,filter:e,strides:t,pad:r,dataFormat:s="NHWC",dilations:i=[1,1],dimRoundingMode:l,bias:u,activation:c="linear",preluActivationWeights:h,leakyreluAlpha:p}){if(c=c||"linear",ub(U.state.gradientDepth,c)===!1){T(s==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${s} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let $=ji(n,e,t,r,s,i,l);return u!=null&&($=ke($,u)),lb($,c,h,p)}const m=K(n,"x","conv2d","float32"),g=K(e,"filter","conv2d","float32");let y=m,v=!1;m.rank===3&&(v=!0,y=q(m,[1,m.shape[0],m.shape[1],m.shape[2]])),T(y.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${y.rank}.`),T(g.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${g.rank}.`),Jn("fused conv2d",r,l);const w=s==="NHWC"?y.shape[3]:y.shape[1];T(g.shape[2]===w,()=>`Error in conv2d: depth of input (${w}) must match input depth for filter ${g.shape[2]}.`),T(Rn(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);const S=kn(y.shape,g.shape,t,i,r,l);let I;u!=null&&(I=K(u,"bias","fused conv2d"),[I]=jt(I,m),s==="NHWC"?Ye(S.outShape,I.shape):(T(I.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${I.shape.length}.`),T(I.shape.length===0||I.shape[0]===S.outChannels||I.shape[0]===1,()=>`Error in fused conv2d: bias shape (${I.shape}) is not compatible with the number of output channels (${S.outChannels})`)));let C;if(h!=null){const $=h.shape;if(T($.length<=1||$.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${$.length}.`),$.length===1)T($[0]===1||$[0]===S.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${$}) is not compatible with the number of output channels (${S.outChannels}).`);else if($.length===3)try{Ye($,S.outShape)}catch{const F=`Error in fused conv2d: PReLU activation weights (${$}) is not compatible with the output shape of the conv2d (${S.outShape}).`;throw Error(F)}C=K(h,"prelu weights","fused conv2d")}const R=($,F)=>{T(s==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${s} but only NHWC is currently supported.`);const[V,D,Z,ne]=F,re=ib($,Z,c);T(Hi(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const se=X0(D.shape,re,V,t,r),ue=ab(D,re,V.shape,t,r),le=[se,ue];if(ne!=null){const he=ob(ne,re);le.push(he)}return le},L={x:y,filter:g,bias:I,preluActivationWeights:C},G={strides:t,pad:r,dataFormat:s,dilations:i,dimRoundingMode:l,activation:c,leakyreluAlpha:p};return u==null?rl(($,F,V)=>{let D=U.runKernel(lp,L,G);return V([F,$,D]),v&&(D=q(D,[D.shape[1],D.shape[2],D.shape[3]])),{value:D,gradFunc:R}})(y,g):rl(($,F,V,D)=>{let Z=U.runKernel(lp,L,G);return D([F,$,Z,V]),v&&(Z=q(Z,[Z.shape[1],Z.shape[2],Z.shape[3]])),{value:Z,gradFunc:R}})(y,g,I)}const kP=J({fusedConv2d_:wP});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function IP(n,e,t,r,s,i=[1,1],l){let u=n;n.rank===3&&(u=q(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let c=e;c.rank===3&&(c=q(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const h={x:u,dy:c},p={strides:r,pad:s,dimRoundingMode:l,dilations:i,filterShape:t};return U.runKernel(Og,h,p)}const SP=J({depthwiseConv2dNativeBackpropFilter_:IP});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function CP(n,e,t,r,s,i=[1,1],l){let u=e,c=!1;e.rank===3&&(c=!0,u=q(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const h={dy:u,filter:t},p={strides:r,pad:s,dimRoundingMode:l,dilations:i,inputShape:n},m=U.runKernel(Dg,h,p);return c?q(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const TP=J({depthwiseConv2dNativeBackpropInput_:CP});/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function NP({a:n,b:e,transposeA:t=!1,transposeB:r=!1,bias:s,activation:i="linear",preluActivationWeights:l,leakyreluAlpha:u=.2}){if(ub(U.state.gradientDepth,i)===!1){let Z=dt(n,e,t,r);return s!=null&&(Z=ke(Z,s)),lb(Z,i,l,u)}let c=K(n,"a","fused matMul"),h=K(e,"b","fused matMul");[c,h]=jt(c,h);const p=t?c.shape[c.rank-2]:c.shape[c.rank-1],m=r?h.shape[h.rank-1]:h.shape[h.rank-2],g=t?c.shape[c.rank-1]:c.shape[c.rank-2],y=r?h.shape[h.rank-2]:h.shape[h.rank-1],v=c.shape.slice(0,-2),w=h.shape.slice(0,-2),S=M(v),I=M(w);T(p===m,()=>`Error in fused matMul: inner shapes (${p}) and (${m}) of Tensors with shapes ${c.shape} and ${h.shape} and transposeA=${t} and transposeB=${r} must match.`);const C=Ye(c.shape.slice(0,-2),h.shape.slice(0,-2)).concat([g,y]),R=t?q(c,[S,p,g]):q(c,[S,g,p]),L=r?q(h,[I,y,m]):q(h,[I,m,y]);let G;s!=null&&(G=K(s,"bias","fused matMul"),[G]=jt(G,c),Ye(C,G.shape));let $;l!=null&&($=K(l,"prelu weights","fused matMul"));const F=(Z,ne)=>{const[re,se,ue,le]=ne,he=ib(q(Z,ue.shape),ue,i);let me,pe;if(!t&&!r?(me=dt(he,se,!1,!0),pe=dt(re,he,!0,!1)):!t&&r?(me=dt(he,se,!1,!1),pe=dt(he,re,!0,!1)):t&&!r?(me=dt(se,he,!1,!0),pe=dt(re,he,!1,!1)):(me=dt(se,he,!0,!0),pe=dt(he,re,!0,!0)),s!=null){const ye=ob(le,he);return[me,pe,ye]}else return[me,pe]},V={a:R,b:L,bias:G,preluActivationWeights:$},D={transposeA:t,transposeB:r,activation:i,leakyreluAlpha:u};return s==null?rl((Z,ne,re)=>{const se=U.runKernel(op,V,D);return re([Z,ne,se]),{value:q(se,C),gradFunc:F}})(R,L):rl((Z,ne,re,se)=>{const ue=U.runKernel(op,V,D);return se([Z,ne,ue,re]),{value:q(ue,C),gradFunc:F}})(R,L,G)}const d2=J({fusedMatMul_:NP});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function RP(n,e,t,r,s="bilinear",i=0){const l=K(n,"image","cropAndResize"),u=K(e,"boxes","cropAndResize","float32"),c=K(t,"boxInd","cropAndResize","int32"),h=u.shape[0];T(l.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${l.rank}.`),T(u.rank===2&&u.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${h},4] but had shape ${u.shape}.`),T(c.rank===1&&c.shape[0]===h,()=>`Error in cropAndResize: boxInd must be have size [${h}] but had shape ${u.shape}.`),T(r.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`),T(r[0]>=1&&r[1]>=1,()=>`cropSize must be atleast [1,1], but was ${r}`),T(s==="bilinear"||s==="nearest",()=>`method must be bilinear or nearest, but was ${s}`);const p={image:l,boxes:u,boxInd:c},m={method:s,extrapolationValue:i,cropSize:r};return U.runKernel(Vg,p,m)}const EP=J({cropAndResize_:RP});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function LP(n){const e=K(n,"image","flipLeftRight","float32");T(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return U.runKernel(Ug,t,{})}const GP=J({flipLeftRight_:LP});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function zP(n){const e=K(n,"image","grayscaleToRGB"),t=e.rank-1,r=e.shape[t];T(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),T(r===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`);const s=new Array(e.rank);return s.fill(1,0,t),s[t]=3,fs(e,s)}const WP=J({grayscaleToRGB_:zP});/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function MP(n){const e=K(n,"image","RGBToGrayscale"),t=e.rank-1,r=e.shape[t];T(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),T(r===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${r}.`);const s=e.dtype,i=ze(e,"float32"),l=hr([.2989,.587,.114]);let u;switch(e.rank){case 2:u=gc("ij,j->i",i,l);break;case 3:u=gc("ijk,k->ij",i,l);break;case 4:u=gc("ijkl,l->ijk",i,l);break;case 5:u=gc("ijklm,m->ijkl",i,l);break;case 6:u=gc("ijklmn,n->ijklm",i,l);break;default:throw new Error("Not a valid tensor rank.")}return u=er(u,-1),ze(u,s)}const $P=J({rgbToGrayscale_:MP});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function FP(n,e,t=0,r=.5){const s=K(n,"image","rotateWithOffset","float32");T(s.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${s.rank}.`);const i={image:s},l={radians:e,fillValue:t,center:r};return U.runKernel(f0,i,l)}const VP=J({rotateWithOffset_:FP});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sl(n,e,t,r,s,i){r==null&&(r=.5),s==null&&(s=Number.NEGATIVE_INFINITY),i==null&&(i=0);const l=n.shape[0];return t=Math.min(t,l),T(0<=r&&r<=1,()=>`iouThreshold must be in [0, 1], but was '${r}'`),T(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),T(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),T(e.rank===1,()=>"scores must be a 1D tensor"),T(e.shape[0]===l,()=>`scores has incompatible shape with boxes. Expected ${l}, but was ${e.shape[0]}`),T(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:t,iouThreshold:r,scoreThreshold:s,softNmsSigma:i}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function PP(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY){const i=K(n,"boxes","nonMaxSuppression","float32"),l=K(e,"scores","nonMaxSuppression","float32"),u=sl(i,l,t,r,s);t=u.maxOutputSize,r=u.iouThreshold,s=u.scoreThreshold;const c={maxOutputSize:t,iouThreshold:r,scoreThreshold:s};return U.runKernel(e0,{boxes:i,scores:l},c)}const XP=J({nonMaxSuppression_:PP});/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function OP(n,e,t){const r=DP(n,e,t),s=r<0?-(r+1):r;n.splice(s,0,e)}function DP(n,e,t){return KP(n,e,t||AP)}function AP(n,e){return n>e?1:n<e?-1:0}function KP(n,e,t){let r=0,s=n.length,i=0,l=!1;for(;r<s;){i=r+(s-r>>>1);const u=t(e,n[i]);u>0?r=i+1:(s=i,l=!u)}return l?r:-r-1}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cb(n,e,t,r,s){return pb(n,e,t,r,s,0)}function db(n,e,t,r,s,i){return pb(n,e,t,r,s,0,!1,i,!0)}function hb(n,e,t,r,s,i){return pb(n,e,t,r,s,i,!0)}function pb(n,e,t,r,s,i,l=!1,u=!1,c=!1){const h=[];for(let S=0;S<e.length;S++)e[S]>s&&h.push({score:e[S],boxIndex:S,suppressBeginIndex:0});h.sort(h2);const p=i>0?-.5/i:0,m=[],g=[];for(;m.length<t&&h.length>0;){const S=h.pop(),{score:I,boxIndex:C,suppressBeginIndex:R}=S;if(I<s)break;let L=!1;for(let G=m.length-1;G>=R;--G){const $=ZP(n,C,m[G]);if($>=r){L=!0;break}if(S.score=S.score*BP(r,p,$),S.score<=s)break}S.suppressBeginIndex=m.length,L||(S.score===I?(m.push(C),g.push(S.score)):S.score>s&&OP(h,S,h2))}const y=m.length,v=t-y;u&&v>0&&(m.push(...new Array(v).fill(0)),g.push(...new Array(v).fill(0)));const w={selectedIndices:m};return l&&(w.selectedScores=g),c&&(w.validOutputs=y),w}function ZP(n,e,t){const r=n.subarray(e*4,e*4+4),s=n.subarray(t*4,t*4+4),i=Math.min(r[0],r[2]),l=Math.min(r[1],r[3]),u=Math.max(r[0],r[2]),c=Math.max(r[1],r[3]),h=Math.min(s[0],s[2]),p=Math.min(s[1],s[3]),m=Math.max(s[0],s[2]),g=Math.max(s[1],s[3]),y=(u-i)*(c-l),v=(m-h)*(g-p);if(y<=0||v<=0)return 0;const w=Math.max(i,h),S=Math.max(l,p),I=Math.min(u,m),C=Math.min(c,g),R=Math.max(I-w,0)*Math.max(C-S,0);return R/(y+v-R)}function BP(n,e,t){const r=Math.exp(e*t*t);return t<=n?r:0}function h2(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/async function _P(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY){const i=K(n,"boxes","nonMaxSuppressionAsync"),l=K(e,"scores","nonMaxSuppressionAsync"),u=sl(i,l,t,r,s);t=u.maxOutputSize,r=u.iouThreshold,s=u.scoreThreshold;const c=await Promise.all([i.data(),l.data()]),h=c[0],p=c[1],{selectedIndices:m}=cb(h,p,t,r,s);return i!==n&&i.dispose(),l!==e&&l.dispose(),hr(m,"int32")}const HP=_P;/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function UP(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY,i=0){const l=K(n,"boxes","nonMaxSuppression"),u=K(e,"scores","nonMaxSuppression"),c=sl(l,u,t,r,s,i);t=c.maxOutputSize,r=c.iouThreshold,s=c.scoreThreshold,i=c.softNmsSigma;const h={boxes:l,scores:u},p={maxOutputSize:t,iouThreshold:r,scoreThreshold:s,softNmsSigma:i},m=U.runKernel(n0,h,p);return{selectedIndices:m[0],selectedScores:m[1]}}const jP=J({nonMaxSuppressionWithScore_:UP});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/async function YP(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY,i=0){const l=K(n,"boxes","nonMaxSuppressionAsync"),u=K(e,"scores","nonMaxSuppressionAsync"),c=sl(l,u,t,r,s,i);t=c.maxOutputSize,r=c.iouThreshold,s=c.scoreThreshold,i=c.softNmsSigma;const h=await Promise.all([l.data(),u.data()]),p=h[0],m=h[1],{selectedIndices:g,selectedScores:y}=hb(p,m,t,r,s,i);return l!==n&&l.dispose(),u!==e&&u.dispose(),{selectedIndices:hr(g,"int32"),selectedScores:hr(y)}}const QP=YP;/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function JP(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY,i=!1){const l=K(n,"boxes","nonMaxSuppression"),u=K(e,"scores","nonMaxSuppression"),c=sl(l,u,t,r,s,null),h=c.maxOutputSize,p=c.iouThreshold,m=c.scoreThreshold,g={boxes:l,scores:u},y={maxOutputSize:h,iouThreshold:p,scoreThreshold:m,padToMaxOutputSize:i},v=U.runKernel(t0,g,y);return{selectedIndices:v[0],validOutputs:v[1]}}const qP=J({nonMaxSuppressionPadded_:JP});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/async function eX(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY,i=!1){const l=K(n,"boxes","nonMaxSuppressionAsync"),u=K(e,"scores","nonMaxSuppressionAsync"),c=sl(l,u,t,r,s,null),h=c.maxOutputSize,p=c.iouThreshold,m=c.scoreThreshold,[g,y]=await Promise.all([l.data(),u.data()]),{selectedIndices:v,validOutputs:w}=db(g,y,h,p,m,i);return l!==n&&l.dispose(),u!==e&&u.dispose(),{selectedIndices:hr(v,"int32"),validOutputs:ht(w,"int32")}}const tX=eX;/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function nX(n,e,t=!1,r=!1){const s=K(n,"images","resizeBilinear");T(s.rank===3||s.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${s.rank}.`),T(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),T(r===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=s,l=!1;s.rank===3&&(l=!0,i=q(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const u={images:i},c={alignCorners:t,halfPixelCenters:r,size:e},h=U.runKernel(Yh,u,c);return l?q(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const p2=J({resizeBilinear_:nX});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function rX(n,e,t=!1,r=!1){const s=K(n,"images","resizeNearestNeighbor");T(s.rank===3||s.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${s.rank}.`),T(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),T(s.dtype==="float32"||s.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),T(r===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=s,l=!1;s.rank===3&&(l=!0,i=q(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const u={images:i},c={alignCorners:t,halfPixelCenters:r,size:e},h=U.runKernel(jh,u,c);return l?q(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const f2=J({resizeNearestNeighbor_:rX});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* https://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sX(n,e="binary",t=!1,r=.5){const s=K(n,"image","threshold"),i=.2989,l=.587,u=.114,c=s.shape[0]*s.shape[1];let h=j(hr([r]),255),p,m,g,y;if(T(s.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${s.rank}.`),T(s.shape[2]===3||s.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${s.shape[2]}.`),T(s.dtype==="int32"||s.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${s.dtype}.`),T(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),s.shape[2]===3){[p,m,g]=Lr(s,[1,1,1],-1);const w=j(p,i),S=j(m,l),I=j(g,u);y=ke(ke(w,S),I)}else y=n;if(e==="otsu"){const w=r$(ze(qk(y),"int32"),Tr([]),256);h=aX(w,c)}const v=t?nl(y,h):Er(y,h);return ze(j(v,255),"int32")}function aX(n,e){let t=hr([-1]),r=hr([0]),s=hr([0]),i,l,u,c,h,p;for(let m=0;m<n.size-1;m++){i=wt(n,0,m+1),l=wt(n,m+1),h=Ke(Xe(i),e),p=Ke(Xe(l),e);const g=Xe(j(i,vc(0,i.size)));u=Ke(g,Xe(i));const y=gp(l.shape,i.size),v=ke(vc(0,l.size),y),w=j(l,v);c=Ke(Xe(w),Xe(l));const S=Ze(u,c),I=Ze(u,c),C=j(h,p);s=j(j(C,S),I);const R=Er(s,r);r=Xn(R,s,r),t=Xn(R,hr([m]),t)}return t}const iX=J({threshold_:sX});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function oX(n,e,t="nearest",r="constant",s=0,i){const l=K(n,"image","transform","float32"),u=K(e,"transforms","transform","float32");T(l.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${l.rank}.`),T(u.rank===2&&(u.shape[0]===l.shape[0]||u.shape[0]===1)&&u.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),T(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);const c={image:l,transforms:u},h={interpolation:t,fillMode:r,fillValue:s,outputShape:i};return U.runKernel(d0,c,h)}const lX=J({transform_:oX});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function uX(n,e,t){const r=K(n,"a","bandPart");T(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);const s=r.shape,[i,l]=r.shape.slice(-2);let u,c;typeof e=="number"?(T(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),T(e<=i,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${i}).`),u=K(e<0?i:e,"numLower","bandPart")):(T(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),u=Xn(wp(e,0),i,yc(e,i))),typeof t=="number"?(T(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),T(t<=l,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${l}).`),c=K(t<0?l:t,"numUpper","bandPart")):(T(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),c=Xn(wp(t,0),l,yc(t,l)));const h=q(vc(0,i,1,"int32"),[-1,1]),p=vc(0,l,1,"int32"),m=Ze(h,p),g=fa(nl(m,u),Yi(m,Qt(c))),y=gn([i,l],r.dtype);return q(Ds(to(q(r,[-1,i,l])).map(v=>Xn(g,v,y))),s)}const cX=J({bandPart_:uX});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function dX(n){let e;if(Array.isArray(n)){e=!1,T(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const s=n[0].shape[0];for(let i=1;i<n.length;++i)T(n[i].shape[0]===s,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[i].shape[0]} vs. ${s})`)}else e=!0,n=Lr(n,n.shape[0],0).map(s=>wc(s,[0]));T(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],r=n;for(let s=0;s<n.length;++s)t.push(U.tidy(()=>{let i=r[s];if(s>0)for(let l=0;l<s;++l){const u=j(Xe(j(t[l],i)),t[l]);i=Ze(i,u)}return Ke(i,xp(i,"euclidean"))}));return e?Ds(t,0):t}const hX=J({gramSchmidt_:dX});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function pX(n,e=!1){if(T(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return m2(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((c,h)=>c*h),r=to(q(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),s=[],i=[];r.forEach(c=>{const[h,p]=m2(c,e);s.push(h),i.push(p)});const l=q(Ds(s,0),n.shape),u=q(Ds(i,0),n.shape);return[l,u]}}function m2(n,e=!1){return U.tidy(()=>{T(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],r=n.shape[1];let s=Pk(t),i=_i(n);const l=sb([[1]],[1,1]);let u=_i(l);const c=t>=r?r:t;for(let h=0;h<c;++h){const p=i,m=u,g=s;[u,i,s]=U.tidy(()=>{const y=wt(i,[h,h],[t-h,1]),v=xp(y),w=wt(i,[h,h],[1,1]),S=Xn(Er(w,0),sb([[-1]]),sb([[1]])),I=Ze(w,j(S,v)),C=Ke(y,I);C.shape[0]===1?u=_i(l):u=qn([l,wt(C,[1,0],[C.shape[0]-1,C.shape[1]])],0);const R=Qt(Ke(dt(S,I),v)),L=wt(i,[h,0],[t-h,r]),G=j(R,u),$=at(u);if(h===0)i=Ze(L,dt(G,dt($,L)));else{const D=Ze(L,dt(G,dt($,L)));i=qn([wt(i,[0,0],[h,r]),D],0)}const F=at(G),V=wt(s,[0,h],[t,s.shape[1]-h]);if(h===0)s=Ze(V,dt(dt(V,u),F));else{const D=Ze(V,dt(dt(V,u),F));s=qn([wt(s,[0,0],[t,h]),D],1)}return[u,i,s]}),et([p,m,g])}return!e&&t>r&&(s=wt(s,[0,0],[t,r]),i=wt(i,[0,0],[r,r])),[s,i]})}const fX=J({qr_:pX});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ma={flipLeftRight:GP,grayscaleToRGB:WP,resizeNearestNeighbor:f2,resizeBilinear:p2,rgbToGrayscale:$P,rotateWithOffset:VP,cropAndResize:EP,nonMaxSuppression:XP,nonMaxSuppressionAsync:HP,nonMaxSuppressionWithScore:jP,nonMaxSuppressionWithScoreAsync:QP,nonMaxSuppressionPadded:qP,nonMaxSuppressionPaddedAsync:tX,threshold:iX,transform:lX},mX={bandPart:cX,gramSchmidt:hX,qr:fX};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const gX=new Map,bX=new Map;class al{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class Ur{constructor(){this.classNameMap={}}static getMap(){return Ur.instance==null&&(Ur.instance=new Ur),Ur.instance}static register(e){Ur.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function xe(n,e,t){T(n.className!=null,()=>"Class being registered does not have the static className property defined."),T(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),T(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const r=t,s=e+">"+r;return Ur.register(n),gX.set(s,n),bX.set(n,s),n}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class ja extends al{minimize(e,t=!1,r){const{value:s,grads:i}=this.computeGradients(e,r);if(r!=null){const l=r.map(u=>({name:u.name,tensor:i[u.name]}));this.applyGradients(l)}else this.applyGradients(i);return et(i),t?s:(s.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return CF(e,t)}dispose(){this.iterations_!=null&&et(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:ht(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(ja,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class g2 extends ja{static get className(){return"Adadelta"}constructor(e,t,r=null){super(),this.learningRate=e,this.rho=t,this.epsilon=r,this.accumulatedGrads=[],this.accumulatedUpdates=[],r==null&&(this.epsilon=U.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,r)=>{const s=U.registeredVariables[t],i=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${t}/accum_grad`,variable:ee(()=>st(s).variable(i))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${t}/accum_var`,variable:ee(()=>st(s).variable(i))});const l=Array.isArray(e)?e[r].tensor:e[t];if(l==null)return;const u=this.accumulatedGrads[r].variable,c=this.accumulatedUpdates[r].variable;ee(()=>{const h=ke(j(u,this.rho),j(Nt(l),1-this.rho)),p=j(Ke(On(ke(c,this.epsilon)),On(ke(u,this.epsilon))),l),m=ke(j(c,this.rho),j(Nt(p),1-this.rho));u.assign(h),c.assign(m);const g=ke(j(p,-this.learningRate),s);s.assign(g)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(et(this.accumulatedGrads.map(e=>e.variable)),et(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,r=!1;this.accumulatedGrads=e.slice(0,t).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.accumulatedUpdates=e.slice(t,t*2).map(s=>({originalName:s.name,variable:s.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class b2 extends ja{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,r)=>{const s=U.registeredVariables[t];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${t}/accumulator`,variable:ee(()=>gp(s.shape,this.initialAccumulatorValue).variable(!1))});const i=Array.isArray(e)?e[r].tensor:e[t];if(i==null)return;const l=this.accumulatedGrads[r].variable;ee(()=>{const u=ke(l,Nt(i));l.assign(u);const c=ke(j(Ke(i,On(ke(u,U.backend.epsilon()))),-this.learningRate),s);s.assign(c)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&et(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(r=>({originalName:r.name,variable:r.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class y2 extends ja{static get className(){return"Adam"}constructor(e,t,r,s=null){super(),this.learningRate=e,this.beta1=t,this.beta2=r,this.epsilon=s,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],ee(()=>{this.accBeta1=ht(t).variable(),this.accBeta2=ht(r).variable()}),s==null&&(this.epsilon=U.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(r=>r.name):Object.keys(e);ee(()=>{const r=Ze(1,this.accBeta1),s=Ze(1,this.accBeta2);t.forEach((i,l)=>{const u=U.registeredVariables[i],c=!1;this.accumulatedFirstMoment[l]==null&&(this.accumulatedFirstMoment[l]={originalName:`${i}/m`,variable:ee(()=>st(u).variable(c))}),this.accumulatedSecondMoment[l]==null&&(this.accumulatedSecondMoment[l]={originalName:`${i}/v`,variable:ee(()=>st(u).variable(c))});const h=Array.isArray(e)?e[l].tensor:e[i];if(h==null)return;const p=this.accumulatedFirstMoment[l].variable,m=this.accumulatedSecondMoment[l].variable,g=ke(j(p,this.beta1),j(h,1-this.beta1)),y=ke(j(m,this.beta2),j(Nt(h),1-this.beta2)),v=Ke(g,r),w=Ke(y,s);p.assign(g),m.assign(y);const S=ke(j(Ke(v,ke(On(w),this.epsilon)),-this.learningRate),u);u.assign(S)}),this.accBeta1.assign(j(this.accBeta1,this.beta1)),this.accBeta2.assign(j(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&et(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&et(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),ee(()=>{this.accBeta1.assign(tl(this.beta1,this.iterations_+1)),this.accBeta2.assign(tl(this.beta2,this.iterations_+1))});const t=e.length/2,r=!1;this.accumulatedFirstMoment=e.slice(0,t).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(s=>({originalName:s.name,variable:s.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class x2 extends ja{static get className(){return"Adamax"}constructor(e,t,r,s=null,i=0){super(),this.learningRate=e,this.beta1=t,this.beta2=r,this.epsilon=s,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],ee(()=>{this.iteration=ht(0).variable(),this.accBeta1=ht(t).variable()}),s==null&&(this.epsilon=U.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(r=>r.name):Object.keys(e);ee(()=>{const r=Ze(1,this.accBeta1),s=Ke(-this.learningRate,ke(j(this.iteration,this.decay),1));t.forEach((i,l)=>{const u=U.registeredVariables[i],c=!1;this.accumulatedFirstMoment[l]==null&&(this.accumulatedFirstMoment[l]={originalName:`${i}/m`,variable:st(u).variable(c)}),this.accumulatedWeightedInfNorm[l]==null&&(this.accumulatedWeightedInfNorm[l]={originalName:`${i}/v`,variable:st(u).variable(c)});const h=Array.isArray(e)?e[l].tensor:e[i];if(h==null)return;const p=this.accumulatedFirstMoment[l].variable,m=this.accumulatedWeightedInfNorm[l].variable,g=ke(j(p,this.beta1),j(h,1-this.beta1)),y=j(m,this.beta2),v=Pn(h),w=Ha(y,v);p.assign(g),m.assign(w);const S=ke(j(Ke(s,r),Ke(g,ke(w,this.epsilon))),u);u.assign(S)}),this.iteration.assign(ke(this.iteration,1)),this.accBeta1.assign(j(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&et(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&et(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class fb extends ja{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,r)=>{const s=Array.isArray(e)?e[r].tensor:e[t];if(s==null)return;const i=U.registeredVariables[t];ee(()=>{const l=ke(j(this.c,s),i);i.assign(l)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Nr(ht(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class v2 extends fb{static get className(){return"Momentum"}constructor(e,t,r=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=r,this.accumulations=[],this.m=ht(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,r)=>{const s=U.registeredVariables[t];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${t}/momentum`,variable:ee(()=>st(s).variable(!1))});const i=this.accumulations[r].variable,l=Array.isArray(e)?e[r].tensor:e[t];l!=null&&ee(()=>{let u;const c=ke(j(this.m,i),l);this.useNesterov?u=ke(j(this.c,ke(l,j(c,this.m))),s):u=ke(j(this.c,c),s),i.assign(c),s.assign(u)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&et(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(r=>({originalName:r.name,variable:r.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class w2 extends ja{static get className(){return"RMSProp"}constructor(e,t=.9,r=0,s=null,i=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=r,this.epsilon=s,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,s==null&&(this.epsilon=U.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,r)=>{const s=U.registeredVariables[t],i=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${t}/rms`,variable:ee(()=>st(s).variable(i))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${t}/momentum`,variable:ee(()=>st(s).variable(i))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${t}/mg`,variable:ee(()=>st(s).variable(i))});const l=Array.isArray(e)?e[r].tensor:e[t];if(l==null)return;const u=this.accumulatedMeanSquares[r].variable,c=this.accumulatedMoments[r].variable;ee(()=>{const h=ke(j(u,this.decay),j(Nt(l),1-this.decay));if(this.centered){const p=this.accumulatedMeanGrads[r].variable,m=ke(j(p,this.decay),j(l,1-this.decay)),g=Ke(j(l,this.learningRate),On(Ze(h,ke(Nt(m),this.epsilon)))),y=ke(j(c,this.momentum),g);u.assign(h),p.assign(m),c.assign(y);const v=Ze(s,y);s.assign(v)}else{const p=ke(j(u,this.decay),j(Nt(l),1-this.decay)),m=ke(j(c,this.momentum),Ke(j(l,this.learningRate),On(ke(p,this.epsilon))));u.assign(p),c.assign(m);const g=Ze(s,m);s.assign(g)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&et(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&et(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&et(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,r=!1;this.accumulatedMeanSquares=e.slice(0,t).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.accumulatedMoments=e.slice(t,t*2).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}/**
* @license
* Copyright 2022 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const yX=[g2,b2,y2,x2,v2,w2,fb];function xX(){for(const n of yX)xe(n)}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/let no;function vX(n,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let t=!1,r=!1,s=!1,i=!1,l=!1,u=!1;if(n.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)s=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)i=!0;else if(n.getContext!=null)l=!0;else if(typeof ImageBitmap<"u"&&n instanceof ImageBitmap)u=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${n.constructor.name}`);if(g0(p0,U.backendName)!=null){const g={pixels:n},y={numChannels:e};return U.runKernel(p0,g,y)}const[c,h]=s?[n.videoWidth,n.videoHeight]:[n.width,n.height];let p;if(l)p=n.getContext("2d").getImageData(0,0,c,h).data;else if(r||t)p=n.data;else if(i||s||u){if(no==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")no=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else no=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});no.canvas.width=c,no.canvas.height=h,no.drawImage(n,0,0,c,h),p=no.getImageData(0,0,c,h).data}let m;if(e===4)m=new Int32Array(p);else{const g=c*h;m=new Int32Array(g*e);for(let y=0;y<g;y++)for(let v=0;v<e;++v)m[y*e+v]=p[y*4+v]}return iP(m,[h,c,e],"int32")}const wX=J({fromPixels_:vX});function mb(n,e){const t=n.shape.length,r=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[r-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[r-1]} vs. ${t}`);if(M(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const s=e.shape,i=s[s.length-1];let l=1;for(let m=0;m<s.length-1;++m)l*=s[m];const u=n.shape,c=s.slice();c.pop();let h=1;for(let m=i;m<t;++m)h*=u[m],c.push(u[m]);const p=[...we(n.shape).map(m=>m/h),1].slice(0,i);return[c,l,h,p]}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const gb=-2,kX=-1;function bb(n,e,t){const r=n.shape.length;T(r===e.length,()=>`Error in slice${r}D: Length of begin ${e} must match the rank of the array (${r}).`),T(r===t.length,()=>`Error in slice${r}D: Length of size ${t} must match the rank of the array (${r}).`);for(let s=0;s<r;++s)T(e[s]+t[s]<=n.shape[s],()=>`Error in slice${r}D: begin[${s}] + size[${s}] (${e[s]+t[s]}) would overflow input.shape[${s}] (${n.shape[s]})`)}function IX(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function yb(n,e,t){const r=[];for(let s=0;s<n.length;s++)r[s]=Math.ceil((e[s]-n[s])/t[s]);return r}function k2(n,e,t,r){const s=[...n];for(let i=s.length;i<r.length;i++)s.push(1);for(let i=0;i<t;i++)i===0?s[e]=1:(s.splice(e,0,1),s.pop());return s}function I2(n,e,t){return t<=n?t:t-(e-1)}function S2(n,e){const t=[];for(let r=0;r<n;r++)t.push(e+r);return t}function SX(n,e,t,r,s,i,l,u,c){const h=n.length;let p=new Array(h),m=new Array(h),g=new Array(h);if(e.length&&t>0){const y=e[0],v=t+1;p=C2(l,y,v,r,n),m=T2(u,y,v,s,n),g=k2(i,y,v,n)}else for(let y=0;y<h;y++)p[y]=R2(l,r,i,n,y,c),m[y]=E2(u,s,i,n,y,c),g[y]=N2(i,y,c);return{begin:p,end:m,strides:g}}function C2(n,e,t,r,s){const i=[...s],l=S2(t,e);for(let u=0;u<i.length;u++)if(l.indexOf(u)>-1)i[u]=0;else{const c=I2(e,t,u);let h=r[c];n&1<<c&&(h=0),i[u]=h}return i}function T2(n,e,t,r,s){const i=[...s],l=S2(t,e);for(let u=0;u<i.length;u++)if(l.indexOf(u)>-1)i[u]=Number.MAX_SAFE_INTEGER;else{const c=I2(e,t,u);let h=r[c];n&1<<c&&(h=Number.MAX_SAFE_INTEGER),i[u]=h}for(let u=0;u<i.length;u++){const c=s[u];i[u]<0&&(i[u]+=c),i[u]=N(0,i[u],s[u])}return i}function N2(n,e,t){let r=n[e];return(t&1<<e||r==null)&&(r=1),r}function R2(n,e,t,r,s,i){let l=e[s];const u=t[s]||1;(n&1<<s||i&1<<s||l==null)&&(u>0?l=Number.MIN_SAFE_INTEGER:l=Number.MAX_SAFE_INTEGER);const c=r[s];return l<0&&(l+=c),l=N(0,l,c-1),l}function E2(n,e,t,r,s,i){let l=e[s];const u=t[s]||1;(n&1<<s||i&1<<s||l==null)&&(u>0?l=Number.MAX_SAFE_INTEGER:l=Number.MIN_SAFE_INTEGER);const c=r[s];return l<0&&(l+=c),u>0?l=N(0,l,c):l=N(-1,l,c-1),l}function xb(n,e,t){let r=t.length;for(let s=0;s<t.length;s++)if(t[s]>1){r=s;break}for(let s=r+1;s<t.length;s++)if(e[s]>0||t[s]!==n[s])return!1;return!0}function vb(n,e){let t=n.length>0?n[n.length-1]:1;for(let r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function Cp(n,e,t){let r;const s=n.shape.length;typeof e=="number"?r=[e,...new Array(s-1).fill(0)]:e.length<s?r=e.concat(new Array(s-e.length).fill(0)):r=e.slice(),r.forEach(l=>{T(l!==-1,()=>"slice() does not support negative begin indexing.")});let i;return t==null?i=new Array(s).fill(-1):typeof t=="number"?i=[t,...new Array(s-1).fill(-1)]:t.length<s?i=t.concat(new Array(s-t.length).fill(-1)):i=t,i=i.map((l,u)=>l>=0?l:(T(l===-1,()=>`Negative size values should be exactly -1 but got ${l} for the slice() size at index ${u}.`),n.shape[u]-r[u])),[r,i]}function wb(n,e,t,r,s,i,l,u,c){let h;if(r==null?(h=new Array(e.length),h.fill(1)):h=r,l!=null&&l&l-1)throw new Error("Multiple ellipses in slice is not allowed.");let p=!1;const m={dims:h.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:h.slice(),beginMask:s,endMask:i,ellipsisMask:l,newAxisMask:u,shrinkAxisMask:c};for(let C=0;C<m.dims;C++)p&&1<<C&u&&m.numAddAxisAfterEllipsis++,1<<C&l&&(p=!0);p||(m.ellipsisMask|=1<<m.dims,m.dims++);const g={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};CX(m,g);let y=!0,v=!0,w=!0;const S=[],I=[];for(let C=0;C<n.length;++C){if(g.strides[C]===0)throw Error(`strides[${C}] must be non-zero`);const R=!!(g.shrinkAxisMask&1<<C),L=n[C];if(L===-1){S.push(R?1:-1);continue}const G=[g.beginMask&1<<C,g.endMask&1<<C],$=[g.strides[C]>0?0:-1,g.strides[C]>0?L:L-1];if(R&&g.strides[C]<=0)throw Error("only stride 1 allowed on non-range indexing.");w=w&&g.strides[C]===1;const F=!!(g.beginMask&1<<C&&g.endMask&1<<C);if(g.beginValid&&g.endValid){if(R){const ne=g.begin[C]<0?L+g.begin[C]:g.begin[C];if(g.begin[C]=ne,g.end[C]=g.begin[C]+1,ne<0||ne>=L)throw Error(`slice index ${g.begin[C]} of dimension ${C} out of bounds.`)}else g.begin[C]=L2(g.begin[C],0,g.strides[C],L,G,$),g.end[C]=L2(g.end[C],1,g.strides[C],L,G,$);const Z=g.strides[C]===1&&g.begin[C]===0&&g.end[C]===L;y=y&&Z,v=v&&(C===0&&g.strides[C]===1||Z)}else y=y&&g.strides[C]===1&&F,v=v&&(C===0&&g.strides[C]===1||F);let V,D=!1;if(g.beginValid&&g.endValid?(V=g.end[C]-g.begin[C],D=!0):R?(V=1,D=!0):F&&L>=0&&(g.strides[C]<0?V=-L:V=L,D=!0),D){let Z;V===0||V<0!=g.strides[C]<0?Z=0:Z=Math.trunc(V/g.strides[C])+(V%g.strides[C]!==0?1:0),S.push(Z)}else S.push(-1)}for(let C=0;C<g.finalShapeGatherIndices.length;++C){const R=g.finalShapeGatherIndices[C];R>=0?I.push(S[R]):R===gb&&I.push(1)}return{finalShapeSparse:I.filter((C,R)=>g.finalShapeGatherIndices[R]!==gb),finalShape:I,isIdentity:y,sliceDim0:v,isSimpleSlice:w,begin:g.begin,end:g.end,strides:g.strides}}function CX(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let r=0;r<n.dims;r++)if(1<<r&n.ellipsisMask){const s=Math.min(e.dims-(n.dims-r)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<s;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=r}else if(1<<r&n.newAxisMask)e.finalShapeGatherIndices.push(gb),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[r]),n.end!=null&&(e.end[t]=n.end[r]),e.strides[t]=n.strides[r],n.beginMask&1<<r&&(e.beginMask|=1<<t),n.endMask&1<<r&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<r?(e.finalShapeGatherIndices.push(kX),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(r)),e.inputShapeGatherIndicesSparse[t]=r,t++}}function L2(n,e,t,r,s,i){if(s[e])return t>0?i[e]:i[e+1&1];{const l=n<0?r+n:n;return l<i[0]?i[0]:l>i[1]?i[1]:l}}const TX=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:bb,computeFlatOffset:vb,computeOutShape:yb,getNormalizedAxes:SX,isSliceContinous:xb,maskToAxes:IX,parseSliceParams:Cp,sliceInfo:wb,startForAxis:R2,startIndicesWithElidedDims:C2,stopForAxis:E2,stopIndicesWithElidedDims:T2,stridesForAxis:N2,stridesWithElidedDims:k2},Symbol.toStringTag,{value:"Module"}));/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class NX{static sgd(e){return new fb(e)}static momentum(e,t,r=!1){return new v2(e,t,r)}static rmsprop(e,t=.9,r=0,s=null,i=!1){return new w2(e,t,r,s,i)}static adam(e=.001,t=.9,r=.999,s=null){return new y2(e,t,r,s)}static adadelta(e=.001,t=.95,r=null){return new g2(e,t,r)}static adamax(e=.002,t=.9,r=.999,s=null,i=0){return new x2(e,t,r,s,i)}static adagrad(e,t=.1){return new b2(e,t)}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const il=NX;/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const RX=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function Tp(){return new Promise(n=>RX(()=>n()))}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function kb(n,e){const t=n[0].length;n.forEach((s,i)=>{T(s.length===t,()=>`Error in concat${t}D: rank of tensors[${i}] must be the same as the rank of the rest (${t})`)}),T(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const r=n[0];n.forEach((s,i)=>{for(let l=0;l<t;l++)T(l===e||s[l]===r[l],()=>`Error in concat${t}D: Shape of tensors[${i}] (${s}) does not match the shape of the rest (${r}) along the non-concatenated axis ${i}.`)})}function As(n,e){const t=n[0].slice();for(let r=1;r<n.length;r++)t[e]+=n[r][e];return t}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var ms;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(ms||(ms={}));function G2(n,e,t){let r=new Array;if(t==null&&e==null)return r;if(e==null)for(;r.length<n+t.length;)r.push(-1);else r=e.slice();if(t==null)return r;if(n+t.length!==r.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${r.length}`);for(let s=1;s<t.length;++s){const i=t[s],l=r[r.length-t.length+s],u=r[l];if(i>=0)if(u>=0){if(u!==i)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${s+n}] = ${i} but shape[${s+n}] = ${u}`)}else r[l]=i}return r}function z2(n){const e={FIRST_DIM_SIZE:ms.FIRST_DIM_SIZE,VALUE_ROWIDS:ms.VALUE_ROWIDS,ROW_LENGTHS:ms.ROW_LENGTHS,ROW_SPLITS:ms.ROW_SPLITS,ROW_LIMITS:ms.ROW_LIMITS,ROW_STARTS:ms.ROW_STARTS},t=[];for(const r of n)if(r in e)t.push(e[r]);else break;return t}function W2(n){return n.length===0?0:n[0]===ms.FIRST_DIM_SIZE?n.length-1:n.length}function M2(n,e){if(n==null||e==null)return;const t=n.length,r=e.length;if(t>=r)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${r})`);for(let s=0;s<Math.min(t,r-1);++s){const i=n[s],l=e[s+1];if(i>=0&&l>=0&&i!==1&&i!==l)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${s-n.length}] = ${i} but ragged tensor input.flatValues.shape[${s-n.length}] = ${l}`)}}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Ib=30;function Np(n){return n<=Ib?n:_e(n,Math.floor(Math.sqrt(n)))}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Sb(n,e,t){const r=t*(typeof n=="number"?n:n[0]),s=e*(typeof n=="number"?n:n[1]);return[r,s]}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ic(n,e,t,r=!0){let s=[];if(r)s=s.concat(e.slice(0)),s.push(n[0]/t),s=s.concat(n.slice(1));else{s=s.concat(n[0]);const i=e.length;for(let l=0;l<i;++l)s=s.concat([n[l+1]/e[l],e[l]]);s=s.concat(n.slice(i+1))}return s}function Sc(n,e,t=!0){const r=[];if(t){r.push(e);for(let s=e+1;s<n;++s)s<=2*e?(r.push(s),r.push(s-(e+1))):r.push(s)}else{const s=[],i=[];for(let l=1;l<n;++l)l>=e*2+1||l%2===1?i.push(l):s.push(l);r.push(...s),r.push(0),r.push(...i)}return r}function Cc(n,e,t,r=!0){const s=[];r?s.push(n[0]/t):s.push(n[0]*t);for(let i=1;i<n.length;++i)i<=e.length?r?s.push(e[i-1]*n[i]):s.push(n[i]/e[i-1]):s.push(n[i]);return s}function Cb(n,e){const t=[0];for(let r=0;r<e;++r)t.push(n[r][0]);return t}function Tb(n,e,t){const r=n.slice(0,1);for(let s=0;s<t;++s)r.push(n[s+1]-e[s][0]-e[s][1]);return r}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Rp=1.7580993408473768,Ep=1.0507009873554805;/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Nb=.3275911,Rb=.254829592,Eb=-.284496736,Lb=1.421413741,Gb=-1.453152027,zb=1.061405429;/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ga(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function $2(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let r=0;r<n.length;r+=2)e[r/2]=n[r],t[r/2]=n[r+1];return{real:e,imag:t}}function F2(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),r=new Float32Array(e);for(let s=0;s<n.length;s+=4)t[Math.floor(s/4)]=n[s],r[Math.floor(s/4)]=n[s+1];return{real:t,imag:r}}function V2(n){const e=Math.floor(n.length/4),t=new Float32Array(e),r=new Float32Array(e);for(let s=2;s<n.length;s+=4)t[Math.floor(s/4)]=n[s],r[Math.floor(s/4)]=n[s+1];return{real:t,imag:r}}function Wb(n,e){const t=n[e*2],r=n[e*2+1];return{real:t,imag:r}}function P2(n,e,t,r){n[r*2]=e,n[r*2+1]=t}function X2(n,e){const t=new Float32Array(n/2),r=new Float32Array(n/2);for(let s=0;s<Math.ceil(n/2);s++){const i=(e?2:-2)*Math.PI*(s/n);t[s]=Math.cos(i),r[s]=Math.sin(i)}return{real:t,imag:r}}function O2(n,e,t){const r=(t?2:-2)*Math.PI*(n/e),s=Math.cos(r),i=Math.sin(r);return{real:s,imag:i}}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Mb="->",EX=/->/g,D2=",",A2="...";function $b(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(EX,"").length)/Mb.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${Mb}").`);const[r,s]=n.split(Mb);T(r.indexOf(A2)===-1,()=>`The ellipsis notation ("${A2}") is not supported yet.`);const i=r.split(D2),l=i.length;if(e!==l)throw new Error(`Expected ${l} input tensors, received ${e}`);if(l>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const u=[];for(let g=0;g<s.length;++g){const y=s[g];if(!i.some(v=>v.indexOf(y)!==-1))throw new Error(`Output subscripts contain the label ${y} not present in the input subscripts.`);u.indexOf(y)===-1&&u.push(y)}for(let g=0;g<r.length;++g){const y=r[g];u.indexOf(y)===-1&&y!==D2&&u.push(y)}const c=new Array(i.length);for(let g=0;g<l;++g){if(new Set(i[g].split("")).size!==i[g].length)throw new Error(`Found duplicate axes in input component ${i[g]}. Support for duplicate axes in input is not implemented yet.`);c[g]=[];for(let y=0;y<i[g].length;++y)c[g].push(u.indexOf(i[g][y]))}const h=u.length,p=s.length,m=[];for(let g=p;g<h;++g)m.push(g);return{allDims:u,summedDims:m,idDims:c}}function Fb(n,e){let t=new Array(n);t.fill(-1);for(let s=0;s<e.length;++s)t[e[s]]=s;const r=[];for(let s=0;s<n;++s)t[s]===-1&&r.push(s);return t=t.filter(s=>s!==-1),{permutationIndices:t,expandDims:r}}function Vb(n,e,t){const r=new Array(n);for(let s=0;s<t.length;++s){const i=t[s].shape;for(let l=0;l<e[s].length;++l)r[e[s][l]]===void 0?r[e[s][l]]=i[l]:T(r[e[s][l]]===i[l],()=>`Expected dimension ${r[e[s][l]]} at axis ${l} of input shaped ${JSON.stringify(i)}, but got dimension ${i[l]}`)}}function Pb(n,e){const t=n,r=[];let s=0;n.length===0&&t.push(-1),s=n.length+1;for(let l=0;l<s;++l)r.push([]);const i=[];for(let l=0;l<t.length;++l){const u=t[l],c=LX(e,u);for(const h of c)i.indexOf(h)===-1&&(r[l].push(h),i.push(h))}return{path:t,steps:r}}function Xb(n){return n.every((e,t)=>e===t)}function LX(n,e){const t=[];for(let r=0;r<n.length;++r)(n[r].length===0||n[r].indexOf(e)!==-1||e===-1)&&t.push(r);return t}function Ob(n,e,t=0){let r=[];if(typeof e=="number")T(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),r=new Array(e).fill(n.shape[t]/e);else{const s=e.reduce((l,u)=>(u===-1&&(l+=1),l),0);T(s<=1,()=>"There should be only one negative value in split array.");const i=e.indexOf(-1);if(i!==-1){const l=e.reduce((u,c)=>c>0?u+c:u);e[i]=n.shape[t]-l}T(n.shape[t]===e.reduce((l,u)=>l+u),()=>"The sum of sizes must match the size of the axis dimension."),r=e}return r}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function K2(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function Z2(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function B2(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _2(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function H2(n,e){return`size ${n} must be non-negative, not ${e}`}function U2(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function j2(n,e){const t=M(n),r=M(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${r}. inputShape=${n} outputShape= ${e}`}function Y2(n,e){const t=M(n),r=M(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${r}. inputShape=${n} outputShape=${e}`}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Db(){return"segment ids must be >= 0"}function Q2(){return"segment ids are not increasing"}function J2(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function q2(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function eI(n,e){let t=!1,r;for(n<=Ib?(r=n,t=!0):r=_e(n,Math.floor(Math.sqrt(n)));!t;)r>e||r===n?t=!0:r=_e(n,r+1);return r}function tI(n,e,t){const r=[],s=n.length;for(let i=0;i<s;i++)i!==e?r.push(n[i]):r.push(t);return r}function Ab(n,e,t,r){const s=e.shape.length,i=n.shape.length;if(r!==0&&(r<-s||r>s))throw new Error(`Expect batchDims in the range of [-${s}, ${s}], but got ${r}`);if(r<0&&(r+=s),r>i)throw new Error(`batchDims (${r}) must be less than rank(x) (
    ${i}).`);if(t<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${t}).`);for(let m=0;m<r;++m)if(n.shape[m]!==e.shape[m])throw new Error(`x.shape[${m}]: ${n.shape[m]} should be equal to indices.shape[${m}]: ${e.shape[m]}.`);const l=n.shape[t],u=[];let c=1,h=1,p=1;for(let m=0;m<r;++m)u.push(n.shape[m]),c*=n.shape[m];for(let m=r;m<t;m++)u.push(n.shape[m]),h*=n.shape[m];for(let m=r;m<s;m++)u.push(e.shape[m]);for(let m=t+1;m<i;m++)u.push(n.shape[m]),p*=n.shape[m];return{batchSize:c,sliceSize:p,outerSize:h,dimSize:l,outputShape:u}}const GX=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:Ab,computeOutShape:tI,segOpComputeOptimalWindowSize:eI},Symbol.toStringTag,{value:"Module"}));/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ba(n){try{return n.map(e=>Aa(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function nI(n){return n.map(e=>Da(e))}const zX=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:Rb,ERF_A2:Eb,ERF_A3:Lb,ERF_A4:Gb,ERF_A5:zb,ERF_P:Nb,PARALLELIZE_THRESHOLD:Ib,get RowPartitionType(){return ms},SELU_SCALE:Ep,SELU_SCALEALPHA:Rp,applyActivation:lb,assertAndGetBroadcastShape:Ye,assertAxesAreInnerMostDims:In,assertParamsConsistent:kb,assignToTypedArray:P2,axesAreInnerMostDims:K0,calculateShapes:eo,checkEinsumDimSizes:Vb,checkPadOnDimRoundingMode:Jn,combineLocations:Fk,combineRaggedTensorToTensorShapes:G2,complexWithEvenIndex:F2,complexWithOddIndex:V2,computeConv2DInfo:kn,computeConv3DInfo:Ba,computeDefaultPad:M0,computeDilation2DInfo:hc,computeOptimalWindowSize:Np,computeOutAndReduceShapes:mn,computeOutShape:As,computePool2DInfo:_r,computePool3DInfo:ha,convertConv2DDataFormat:pa,decodeEinsumEquation:$b,eitherStridesOrDilationsAreOne:Rn,expandShapeToKeepDim:nn,exponent:O2,exponents:X2,fromStringArrayToUint8:nI,fromUint8ToStringArray:ba,getAxesPermutation:Xt,getBroadcastDims:el,getComplexWithIndex:Wb,getEinsumComputePath:Pb,getEinsumPermutation:Fb,getFusedBiasGradient:ob,getFusedDyActivation:ib,getImageCenter:Sb,getInnerMostAxes:Yt,getPermuted:Sc,getRaggedRank:W2,getReductionAxes:on,getReshaped:Ic,getReshapedPermuted:Cc,getRowPartitionTypesHelper:z2,getSliceBeginCoords:Cb,getSliceSize:Tb,getSparseFillEmptyRowsIndicesDenseShapeMismatch:K2,getSparseFillEmptyRowsNegativeIndexErrorMessage:Z2,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:B2,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:U2,getSparseReshapeInputOutputMismatchErrorMessage:Y2,getSparseReshapeInputOutputMultipleErrorMessage:j2,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:_2,getSparseReshapeNegativeOutputDimErrorMessage:H2,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:q2,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Db,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:Q2,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:J2,getUndoAxesPermutation:_a,isIdentityPermutation:Xb,log:pW,mergeRealAndImagArrays:ga,prepareAndValidate:mb,prepareSplitSize:Ob,segment_util:GX,shouldFuse:ub,slice_util:TX,splitRealAndImagArrays:$2,stridesOrDilationsArePositive:Ui,tupleValuesAreOne:Hi,upcastType:dr,validateDefaultValueShape:M2,validateInput:oP,validateUpdateShape:o2,warn:Sr},Symbol.toStringTag,{value:"Module"}));/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/xX();/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const rI={kernelName:oh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(n,kc(ze(t,"float32"),-1))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const WX={kernelName:du,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=Nt(ze(t,"float32")),s=On(Ze(ht(1),r));return Qt(Ke(n,s))}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const MX={kernelName:hu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=On(Ze(Nt(ze(t,"float32")),1));return Ke(n,r)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const $X={kernelName:Ko,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=Ye(t.shape,r.shape);return{a:()=>{let i=n;const l=on(t.shape,s);return l.length>0&&(i=Xe(i,l)),q(i,t.shape)},b:()=>{let i=n;const l=on(r.shape,s);return l.length>0&&(i=Xe(i,l)),q(i,r.shape)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const FX={kernelName:Cg,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((r,s)=>{t[s]=()=>n.clone()}),t}};/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const VX={kernelName:lh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>st(t)}}};/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const PX={kernelName:uh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>st(t)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const XX={kernelName:pu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ke(n,On(Ze(ht(1),Nt(ze(t,"float32")))))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const OX={kernelName:fu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=On(ke(ht(1),Nt(ze(t,"float32"))));return Ke(n,r)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const DX={kernelName:bu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=Ye(t.shape,r.shape);return{a:()=>{const i=ke(Nt(t),Nt(r));let l=j(n,Ke(r,i));const u=on(t.shape,s);return u.length>0&&(l=Xe(l,u)),q(l,t.shape)},b:()=>{const i=ke(Nt(t),Nt(r));let l=Qt(j(n,Ke(t,i)));const u=on(r.shape,s);return u.length>0&&(l=Xe(l,u)),q(l,r.shape)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const AX={kernelName:mu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ke(n,ke(Nt(ze(t,"float32")),1))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const KX={kernelName:gu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ke(n,Ze(ht(1),Nt(ze(t,"float32"))))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ZX(n,e,t,r,s,i){const l=K(n,"dy","avgPool3dGrad"),u=K(e,"input","avgPool3dGrad");let c=l,h=u,p=!1;u.rank===4&&(p=!0,c=q(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),h=q(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),T(c.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),T(h.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${h.rank}.`),Jn("avgPool3dGrad",s,i);const m={dy:c,input:h},g={filterSize:t,strides:r,pad:s,dimRoundingMode:i},y=U.runKernel(Eg,m,g);return p?q(y,[y.shape[1],y.shape[2],y.shape[3],y.shape[4]]):y}const BX=J({avgPool3dGrad_:ZX});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const _X={kernelName:dh,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{filterSize:s,strides:i,pad:l,dimRoundingMode:u}=t;return{x:()=>BX(n,r,s,i,l,u)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function HX(n,e,t,r,s){const i=K(n,"dy","avgPoolGrad"),l=K(e,"input","avgPoolGrad");T(l.rank===i.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${i.rank})`);let u=l,c=i,h=!1;l.rank===3&&(h=!0,u=q(l,[1,l.shape[0],l.shape[1],l.shape[2]]),c=q(i,[1,i.shape[0],i.shape[1],i.shape[2]])),T(c.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${c.rank}.`),T(u.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${u.rank}.`);const p={dy:c,input:u},m={filterSize:t,strides:r,pad:s},g=U.runKernel(Rg,p,m);return h?q(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const UX=J({avgPoolGrad_:HX});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const jX={kernelName:ch,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{filterSize:s,strides:i,pad:l}=t;return{x:()=>UX(n,r,s,i,l)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const YX={kernelName:hh,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[r,s]=e,{transposeA:i,transposeB:l}=t;return!i&&!l?{a:()=>dt(n,s,!1,!0),b:()=>dt(r,n,!0,!1)}:!i&&l?{a:()=>dt(n,s,!1,!1),b:()=>dt(n,r,!0,!1)}:i&&!l?{a:()=>dt(s,n,!1,!0),b:()=>dt(r,n,!1,!1)}:{a:()=>dt(s,n,!0,!0),b:()=>dt(n,r,!0,!0)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const QX={kernelName:ph,gradFunc:(n,e,t)=>{const{blockShape:r,crops:s}=t;return{x:()=>Q0(n,r,s)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const JX={kernelName:cW,gradFunc:(n,e,t)=>{const r=t,s=r.inputShape,i=r.shape,l=Array.from(i);for(let c=s.length-1;c>=0;c--)if(s[c]===i[c])l[c]=1;else if(s[c]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${i}].`);const u=[];for(let c=0;c<l.length;c++)l[c]>1&&u.push(c);return{x:()=>Xe(n,u,!0)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const qX={kernelName:yu,gradFunc:n=>({x:()=>n.clone()})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const eO={kernelName:xu,gradFunc:n=>({x:()=>st(n)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const tO={kernelName:vu,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{clipValueMin:s,clipValueMax:i}=t;return{x:()=>Xn(fa(Yi(r,s),nl(r,i)),n,st(n))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const nO={kernelName:fh,inputsToSave:["x"],gradFunc:rI.gradFunc};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const rO={kernelName:mh,saveAllInputs:!0,gradFunc:(n,e,t)=>{const r=e.map(u=>u.shape),{axis:s}=t,i=oe(s,e[0].shape)[0],l=r.map(u=>u[i]);return Lr(n,l,i).map(u=>()=>u)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const sO={kernelName:gh,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[r,s]=e,{dilations:i,strides:l,pad:u,dataFormat:c}=t;return T(Hi(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>X0(r.shape,n,s,l,u,c),filter:()=>ab(r,n,s.shape,l,u,c)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const aO={kernelName:bh,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[r,s]=e,{strides:i,pad:l,dataFormat:u,dimRoundingMode:c}=t;return{dy:()=>ji(n,s,i,l,u,1,c),filter:()=>ab(n,r,s.shape,i,l,u,c)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function iO(n,e,t,r,s){let i=n;n.rank===4&&(i=q(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let l=e;l.rank===4&&(l=q(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),T(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),T(l.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${l.shape}.`),T(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),T(i.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${t[3]}.`),T(l.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${l.shape[4]}) must match output depth for filter (${t[4]}).`);const u={x:i,dy:l},c={strides:r,pad:s,filterShape:t};return U.runKernel(Mg,u,c)}const oO=J({conv3DBackpropFilter_:iO});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const lO={kernelName:yh,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:r,strides:s,pad:i}=t;T(Hi(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);const[l,u]=e;return{x:()=>zk(l.shape,n,u,s,i),filter:()=>oO(l,n,u.shape,s,i)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const uO={kernelName:wu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(Qt(r2(ze(t,"float32"))),n)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const cO={kernelName:ku,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(s2(ze(t,"float32")),n)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const dO={kernelName:xh,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{axis:s,exclusive:i,reverse:l}=t;return{x:()=>{const u=Xt([s],r.rank);let c=Mk(n,s,i,!l);return u!=null&&(c=at(c,u)),c}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const hO={kernelName:vh,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:r,strides:s,pad:i,dimRoundingMode:l}=t,u=r??[1,1];T(Hi(u),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${u}'`);const[c,h]=e;return T(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${c.rank}.`),T(h.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${h.rank}.`),T(c.shape[3]===h.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`),T(Rn(s,u),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${s} and dilations '${u}'.`),Jn("depthwiseConv2d",i,l),{x:()=>TP(c.shape,n,h,s,i,u,l),filter:()=>SP(c,n,h.shape,s,i,u,l)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const pO={kernelName:wh,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[r,s]=e,i={x:r,filter:s,dy:n},l={x:r,filter:s,dy:n};return{x:()=>U.runKernel(Ag,i,t),filter:()=>U.runKernel(Kg,l,t)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const fO={kernelName:Su,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,r={dy:n,y:t};return{x:()=>U.runKernel(Bg,r)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const mO={kernelName:Cu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,r=j(Xs(Qt(Nt(t))),2/Math.sqrt(Math.PI));return{x:()=>j(n,r)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const gO={kernelName:Tu,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(n,t)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const bO={kernelName:Ih,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>q(n,t.shape)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const yO={kernelName:Nu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(n,Xs(t))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const xO={kernelName:Ru,gradFunc:n=>({x:()=>st(n)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const vO={kernelName:Eu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=Ye(t.shape,r.shape);return{a:()=>{const i=Ke(n,ze(r,"float32")),l=on(t.shape,s);return l.length>0?q(Xe(i,l),t.shape):i},b:()=>{let i=j(n,ze(t,"float32"));const l=on(r.shape,s);l.length>0&&(i=q(Xe(i,l),r.shape));const u=Nt(r);return Qt(Ke(i,ze(u,"float32")))}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const wO={kernelName:Sh,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:r}=t,[s,i,l,u]=e,c=u??ht(1),h=on(i.shape,s.shape),p=[];if(i.rank===1){for(let w=0;w<s.shape.length-1;++w)p.push(s.shape[w]);p.push(1)}const m=Ze(s,i),g=j(n,c),y=e2(ke(l,ht(r))),v=j(j(j(y,y),y),ht(-.5));return{x:()=>i.rank===1?q(j(j(n,fs(q(y,[1,1,1,i.shape[0]]),p)),c),s.shape):q(j(j(n,y),c),s.shape),mean:()=>{let w=j(j(y,ht(-1)),g);return i.rank===1&&(w=Xe(w,h)),q(w,i.shape)},variance:()=>{let w=j(j(v,m),g);return i.rank===1&&(w=Xe(w,h)),q(w,i.shape)},scale:()=>{const w=j(m,y);let S=j(n,w);return i.rank===1&&(S=Xe(S,h)),q(S,i.shape)},offset:()=>{let w=n;return i.rank===1&&(w=Xe(w,h)),q(w,i.shape)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const kO={kernelName:Ch,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[r,s]=e,{axis:i,batchDims:l}=t,u=oe(i,r.shape)[0],c=(h,p,m)=>()=>{const g=h.shape,y=p.size,v=g.slice(0,u),w=v.length,S=g.slice(i,g.length).slice(1),I=S.length,C=sI(0,w),R=sI(w+1,w+1+I),L=aI([v,[y],S]),G=q(m,L),$=q(p,[y]),F=aI([[w],C,R]),V=at(G,F);let D=u2(V,$,h.shape[u]);const Z=_a(F);return D=at(D,Z),D};if(l===1){const h=r.shape[0],p=r.split(h,0);return{x:()=>Ds(p.map((m,g)=>c(m,s.slice(g,1),n.slice(g,1))())).reshape(r.shape),indices:()=>s}}else return{x:c(r,s,n),indices:()=>s}}};function sI(n,e){const t=[];for(let r=n;r<e;++r)t.push(r);return t}function aI(n){const e=[];for(let t=0;t<n.length;++t)for(let r=0;r<n[t].length;++r)e.push(n[t][r]);return e}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const IO={kernelName:Lu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e;return{a:()=>st(t),b:()=>st(r)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const SO={kernelName:Gu,gradFunc:n=>({x:()=>ze(n,"float32")})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const CO={kernelName:zu,gradFunc:n=>({x:()=>st(n)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const TO={kernelName:Wu,gradFunc:n=>({x:()=>st(n)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const NO={kernelName:Mu,gradFunc:n=>({x:()=>st(n)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const RO={kernelName:Nh,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{alpha:s}=t,i=Er(r,0);return{x:()=>Xn(i,n,j(n,s))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const EO={kernelName:Fu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ke(n,ke(t,1))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const LO={kernelName:$u,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ke(n,ze(t,"float32"))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const GO={kernelName:hW,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r]=e,{axis:s}=t;return{logits:()=>{const i=Xs(r);return Ze(n,j(Xe(n,s,!0),i))}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function zO(n,e,t,r=5,s=1,i=1,l=.5){const u={x:n,y:e,dy:t},c={depthRadius:r,bias:s,alpha:i,beta:l};return U.runKernel(Qg,u,c)}const WO=J({localResponseNormalizationBackprop_:zO});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const MO={kernelName:Wh,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r,s]=e,{depthRadius:i,bias:l,alpha:u,beta:c}=t;return{x:()=>WO(r,s,n,i,l,u,c)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function iI(n,e,t,r){return e.rank<t.rank&&(e=q(e,nn(e.shape,r))),n.rank<t.rank&&(n=q(n,nn(n.shape,r))),{x:()=>j(n,ze(Ps(t,e),n.dtype))}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const oI={kernelName:Mh,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const r=t,{reductionIndices:s}=r,i=e[0],l=e[1],u=oe(s,i.shape),c=iI(n,l,i,u);return{x:()=>c.x()}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const $O={kernelName:Vu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e;return{a:()=>j(n,ze(Yi(t,r),"float32")),b:()=>j(n,ze(wp(t,r),"float32"))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function FO(n,e,t,r,s,i,l){const u=K(n,"dy","maxPool3dGrad"),c=K(e,"input","maxPool3dGrad"),h=K(t,"output","maxPool3dGrad");let p=u,m=c,g=h,y=!1;c.rank===4&&(y=!0,p=q(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),m=q(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),g=q(h,[1,h.shape[0],h.shape[1],h.shape[2],h.shape[3]])),T(p.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${p.rank}.`),T(m.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${m.rank}.`),T(g.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${g.rank}.`),Jn("maxPool3dGrad",i,l);const v={dy:p,input:m,output:g},w={filterSize:r,strides:s,pad:i,dimRoundingMode:l},S=U.runKernel(qg,v,w);return y?q(S,[S.shape[1],S.shape[2],S.shape[3],S.shape[4]]):S}const VO=J({maxPool3dGrad_:FO});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const PO={kernelName:Fh,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r,s]=e,{filterSize:i,strides:l,pad:u,dimRoundingMode:c}=t;return{x:()=>VO(n,r,s,i,l,u,c)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function XO(n,e,t,r,s,i,l){const u=K(n,"dy","maxPoolGrad"),c=K(e,"input","maxPoolGrad"),h=K(t,"output","maxPoolGrad");T(c.rank===u.rank,()=>`Rank of input (${c.rank}) does not match rank of dy (${u.rank})`),T(u.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${u.rank}.`),T(c.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${c.rank}.`),Jn("maxPoolGrad",i,l);const p={dy:u,input:c,output:h},m={filterSize:r,strides:s,pad:i,dimRoundingMode:l};return U.runKernel(Jg,p,m)}const OO=J({maxPoolGrad_:XO});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const DO={kernelName:$h,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r,s]=e,{filterSize:i,strides:l,pad:u}=t;return{x:()=>OO(n,r,s,i,l,u)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const AO={kernelName:Vh,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{axis:s}=t,i=oe(s,r.shape),l=mn(r.shape,i)[1],u=M(l);return{x:()=>{const c=r.shape.slice();i.forEach(p=>{c[p]=1});const h=q(n,c);return Ke(j(h,Ua(r.shape,"float32")),u)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const KO={kernelName:Ph,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const r=t,{axis:s}=r,[i,l]=e,u=oe(s,i.shape),c=iI(n,l,i,u);return{x:()=>c.x()}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ZO={kernelName:Pu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e;return{a:()=>j(n,ze(nl(t,r),"float32")),b:()=>j(n,ze(Er(t,r),"float32"))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const BO={kernelName:Xh,inputsToSave:["x"],gradFunc:(n,e,t)=>{const r=e[0],{paddings:s}=t,i=s.map(l=>l[0]);return{x:()=>wt(n,i,r.shape)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const _O={kernelName:Xu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=Ye(t.shape,r.shape);return{a:()=>{const i=on(t.shape,s);return i.length>0?q(Xe(n,i),t.shape):n},b:()=>{const i=j(n,Qt(vp(Ke(t,r)))),l=on(r.shape,s);return l.length>0?q(Xe(i,l),r.shape):i}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const HO={kernelName:Ou,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=Ye(t.shape,r.shape);return{a:()=>{const i=j(n,ze(r,"float32")),l=on(t.shape,s);return l.length>0?q(Xe(i,l),t.shape):i},b:()=>{const i=j(n,ze(t,"float32")),l=on(r.shape,s);return l.length>0?q(Xe(i,l),r.shape):i}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const UO={kernelName:Oh,gradFunc:n=>({x:()=>Qt(n)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const jO={kernelName:Kh,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>gn(t.shape,"float32")}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const YO={kernelName:Ah,gradFunc:n=>({x:()=>st(n)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const QO={kernelName:Zh,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:r}=t;return to(n,r).map(s=>()=>s)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const lI={kernelName:Bh,inputsToSave:["x"],gradFunc:(n,e,t)=>{const r=e[0],{paddings:s}=t,i=s.map(l=>l[0]);return{x:()=>wt(n,i,r.shape)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const JO={kernelName:Du,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,r,s]=e,i=t,l=r,u=Ye(i.shape,l.shape);return{a:()=>{const c=ze(l,"float32");let h=j(n,j(c,tl(i,Ze(c,ht(1)))));const p=on(i.shape,u);return p.length>0&&(h=Xe(h,p)),q(h,i.shape)},b:()=>{const c=Er(i,0),h=Xn(c,Os(i),st(i));let p=j(n,j(s,h));const m=on(l.shape,u);return m.length>0&&(p=Xe(p,m)),q(p,l.shape)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const qO={kernelName:_h,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,r]=e,s=Er(t,0);return{x:()=>Xn(s,n,j(n,r)),alpha:()=>{let i=Xn(s,st(n),j(n,t));const l=on(r.shape,n.shape);return l.length>0&&(i=Xe(i,l)),q(i,r.shape)}}}};/**
* @license
* Copyright 2022 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function eD(n,e,t){const r=n.shape.slice();r[t]=1;const s=q(e,r),i=D0(n,t,!0,!1),l=D0(n,t,!0,!0),u=j(i,l);return j(s,u)}function tD(n,e,t){const r=n.shape.length,s=r-t.length,i=Xt(t,r);let l=n;i!=null&&(l=at(n,i));const u=l.shape.slice(),c=u.splice(r-t.length,t.length).reduce((m,g)=>m*g,1);u.push(c);const h=l.reshape(u);let p=eD(h,e,s);if(p=p.reshape(l.shape),i!=null){const m=_a(i);p=at(p,m)}return p}const nD={kernelName:Hh,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{axis:s}=t;let i=[];return s==null?i=r.shape.map((l,u)=>u):typeof s=="number"?i=[s]:i=s,{x:()=>tD(r,n,i)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const rD={kernelName:Iu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=Ye(t.shape,r.shape);return{a:()=>{const i=Ke(n,ze(r,"float32")),l=on(t.shape,s);return l.length>0?q(Xe(i,l),t.shape):i},b:()=>{let i=j(n,ze(t,"float32"));const l=on(r.shape,s);l.length>0&&(i=q(Xe(i,l),r.shape));const u=Nt(r);return Qt(Ke(i,ze(u,"float32")))}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const sD={kernelName:Au,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ke(n,Qt(Nt(t)))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const aD={kernelName:Zu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,r=j(nl(t,6),kc(t));return{x:()=>j(n,ze(r,"float32"))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const iD={kernelName:Ku,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(n,ze(kc(t),"float32"))}}};/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const oD={kernelName:Uh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>q(n,t.shape)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const lD={kernelName:Yh,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[r]=e,s={dy:n,images:r};return{images:()=>U.runKernel(i0,s,t)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const uD={kernelName:jh,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[r]=e,s={dy:n,images:r};return{images:()=>U.runKernel(a0,s,t)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const cD={kernelName:Qh,gradFunc:(n,e,t)=>{const{dims:r}=t,s=oe(r,n.shape);return{x:()=>qi(n,s)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const dD={kernelName:Bu,gradFunc:n=>({x:()=>st(n)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const hD={kernelName:_u,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Qt(Ke(n,j(tl(t,1.5),2)))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const pD={kernelName:Jh,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>ze(st(t),"float32"),t:()=>j(n,ze(t,n.dtype)),e:()=>j(n,ze(H0(t),n.dtype))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const fD={kernelName:Hu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=Er(t,ht(0)),s=ht(Rp),i=ht(Ep),l=j(n,i),u=j(j(n,s),Xs(ze(t,"float32")));return Xn(r,l,u)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const mD={kernelName:Qu,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(n,j(t,Ze(ht(1),t)))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const gD={kernelName:Yu,gradFunc:n=>({x:()=>st(n)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const bD={kernelName:Uu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(O0(ze(t,"float32")),n)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const yD={kernelName:ju,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(Wk(ze(t,"float32")),n)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const xD={kernelName:qh,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{begin:s,size:i}=t,l=r.shape,[u,c]=Cp(r,s,i),h=[];for(let p=0;p<n.rank;p++)h.push([u[p],l[p]-u[p]-c[p]]);return{x:()=>Y0(n,h)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const vD={kernelName:rp,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r]=e,{dim:s}=t,i=!0,l=j(n,r);return{logits:()=>Ze(l,j(Xe(l,[s],i),r))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const wD={kernelName:Ju,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(n,qo(t))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const uI={kernelName:tp,gradFunc:(n,e,t)=>{const{blockShape:r,paddings:s}=t;return{x:()=>P0(n,r,s)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const cI={kernelName:np,gradFunc:(n,e,t)=>{const{axis:r}=t;return{x:()=>qn(n,r)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const kD={kernelName:qu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ke(n,j(On(ze(t,"float32")),2))}}};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ID={kernelName:o0,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(n,j(ze(t,"float32"),2))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const SD={kernelName:ec,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=ht(2);return{a:()=>j(n,j(s,Ze(t,r))),b:()=>j(n,j(s,Ze(r,t)))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const CD={kernelName:ac,gradFunc:n=>({x:()=>st(n)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const TD={kernelName:tc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=Ye(t.shape,r.shape);return{a:()=>{let i=n;const l=on(t.shape,s);return l.length>0&&(i=Xe(i,l)),q(i,t.shape)},b:()=>{let i=n;const l=on(r.shape,s);return l.length>0&&(i=Xe(i,l)),q(Qt(i),r.shape)}}}};/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ND={kernelName:ep,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,s=r.shape.slice(),{axis:i}=t;oe(i,r.shape).forEach(c=>{s[c]=1});const l=q(n,s),u=j(l,Ua(r.shape,"float32"));return{x:()=>u}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const RD={kernelName:nc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ke(n,Nt(O0(t)))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ED={kernelName:rc,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(Ze(ht(1),Nt(t)),n)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const LD={kernelName:sc,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{reps:s}=t;return{x:()=>{let i=st(r);if(r.rank===1)for(let l=0;l<s[0];++l)i=ke(i,wt(n,[l*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let l=0;l<s[0];++l)for(let u=0;u<s[1];++u)i=ke(i,wt(n,[l*r.shape[0],u*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let l=0;l<s[0];++l)for(let u=0;u<s[1];++u)for(let c=0;c<s[2];++c)i=ke(i,wt(n,[l*r.shape[0],u*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let l=0;l<s[0];++l)for(let u=0;u<s[1];++u)for(let c=0;c<s[2];++c)for(let h=0;h<s[3];++h)i=ke(i,wt(n,[l*r.shape[0],u*r.shape[1],c*r.shape[2],h*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return i}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const GD={kernelName:Zo,gradFunc:(n,e,t)=>{const r=t,{perm:s}=r,i=_a(s);return{x:()=>at(n,i)}}};/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const zD={kernelName:sp,gradFunc:(n,e,t)=>{const r=t,{axis:s}=r;return{value:()=>Ds(n,s)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const WD={kernelName:ap,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>MD(n,t)}}};function MD(n,e){const t=Ha(e,st(e)),r=Z0(n,t);let s=Yi(e,ht(0,"int32"));const i=r.rank-s.rank;for(let u=0;u<i;++u)s=er(s,u+1);s=fa(s,Ua(r.shape,"bool"));const l=st(r);return Xn(s,r,l)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const $D={kernelName:ip,gradFunc:n=>({x:()=>st(n)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const FD=[rI,WX,MX,$X,FX,VX,PX,XX,OX,DX,AX,KX,_X,jX,YX,QX,JX,qX,eO,tO,nO,rO,aO,sO,lO,uO,cO,dO,hO,pO,rD,fO,mO,gO,bO,yO,vO,xO,wO,kO,IO,SO,CO,TO,NO,RO,EO,LO,GO,MO,oI,oI,$O,PO,DO,AO,KO,ZO,BO,_O,HO,UO,jO,YO,QO,lI,lI,JO,qO,nD,sD,aD,iD,oD,lD,uD,cD,dD,hD,pD,fD,mD,gD,bD,yD,xD,vD,wD,uI,uI,cI,cI,kD,SD,ID,CD,TD,ND,RD,ED,LD,GD,zD,WD,$D];for(const n of FD)fW(n);/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.abs=function(){return this.throwIfDisposed(),Pn(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.acos=function(){return this.throwIfDisposed(),gM(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.acosh=function(){return this.throwIfDisposed(),yM(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.add=function(n){return this.throwIfDisposed(),ke(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.all=function(n,e){return this.throwIfDisposed(),Ek(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.any=function(n,e){return this.throwIfDisposed(),W0(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.argMax=function(n){return this.throwIfDisposed(),dc(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.argMin=function(n){return this.throwIfDisposed(),IM(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.asScalar=function(){return this.throwIfDisposed(),T(this.size===1,()=>"The array must have only 1 element."),q(this,[])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.asType=function(n){return this.throwIfDisposed(),ze(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.as1D=function(){return this.throwIfDisposed(),q(this,[this.size])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.as2D=function(n,e){return this.throwIfDisposed(),q(this,[n,e])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),q(this,[n,e,t])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.as4D=function(n,e,t,r){return this.throwIfDisposed(),q(this,[n,e,t,r])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.as5D=function(n,e,t,r,s){return this.throwIfDisposed(),q(this,[n,e,t,r,s])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.asin=function(){return this.throwIfDisposed(),CM(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.asinh=function(){return this.throwIfDisposed(),NM(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.atan=function(){return this.throwIfDisposed(),EM(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.atan2=function(n){return this.throwIfDisposed(),GM(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.atanh=function(){return this.throwIfDisposed(),WM(this)},de().prototype.avgPool=function(n,e,t,r){return this.throwIfDisposed(),F0(this,n,e,t,r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),P0(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.batchNorm=function(n,e,t,r,s){return this.throwIfDisposed(),mp(this,n,e,t,r,s)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.broadcastTo=function(n){return this.throwIfDisposed(),mc(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.cast=function(n){return this.throwIfDisposed(),ze(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.ceil=function(){return this.throwIfDisposed(),i$(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),Rr(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof an&&(n=[n]),qn([this,...n],e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.conv1d=function(n,e,t,r,s,i){return this.throwIfDisposed(),Lk(this,n,e,t,r,s,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.conv2dTranspose=function(n,e,t,r,s){return this.throwIfDisposed(),Gk(this,n,e,t,r,s)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.conv2d=function(n,e,t,r,s,i){return this.throwIfDisposed(),ji(this,n,e,t,r,s,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.cos=function(){return this.throwIfDisposed(),O0(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.cosh=function(){return this.throwIfDisposed(),Wk(this)};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),D0(this,n,e,t)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),Mk(this,n,e,t)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),G$(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.depthwiseConv2d=function(n,e,t,r,s,i){return this.throwIfDisposed(),A0(this,n,e,t,r,s,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.dilation2d=function(n,e,t,r,s){return this.throwIfDisposed(),M$(this,n,e,t,r,s)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.divNoNan=function(n){return this.throwIfDisposed(),X$(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.div=function(n){return this.throwIfDisposed(),Ke(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.dot=function(n){return this.throwIfDisposed(),D$(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.elu=function(){return this.throwIfDisposed(),bp(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.equal=function(n){return this.throwIfDisposed(),Ps(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.erf=function(){return this.throwIfDisposed(),B$(this)};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),eF(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.exp=function(){return this.throwIfDisposed(),Xs(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.expandDims=function(n){return this.throwIfDisposed(),er(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.expm1=function(){return this.throwIfDisposed(),sF(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.fft=function(){return this.throwIfDisposed(),i2(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.flatten=function(){return this.throwIfDisposed(),q(this,[this.size])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.floor=function(){return this.throwIfDisposed(),vp(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.floorDiv=function(n){return this.throwIfDisposed(),Rk(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.gather=function(n,e,t){return this.throwIfDisposed(),Z0(this,n,e,t)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.greaterEqual=function(n){return this.throwIfDisposed(),Yi(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.greater=function(n){return this.throwIfDisposed(),Er(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.ifft=function(){return this.throwIfDisposed(),rb(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.irfft=function(){return this.throwIfDisposed(),HV(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.isFinite=function(){return this.throwIfDisposed(),pF(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.isInf=function(){return this.throwIfDisposed(),mF(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.isNaN=function(){return this.throwIfDisposed(),bF(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.leakyRelu=function(n){return this.throwIfDisposed(),_0(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.lessEqual=function(n){return this.throwIfDisposed(),nl(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.less=function(n){return this.throwIfDisposed(),wp(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.localResponseNormalization=function(n,e,t,r){return this.throwIfDisposed(),kF(this,n,e,t,r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.logSigmoid=function(){return this.throwIfDisposed(),EF(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.logSoftmax=function(n){return this.throwIfDisposed(),Ok(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),Dk(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.log=function(){return this.throwIfDisposed(),Os(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.log1p=function(){return this.throwIfDisposed(),Xk(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.logicalAnd=function(n){return this.throwIfDisposed(),fa(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.logicalNot=function(){return this.throwIfDisposed(),H0(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.logicalOr=function(n){return this.throwIfDisposed(),Ak(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.logicalXor=function(n){return this.throwIfDisposed(),VF(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),dt(this,n,e,t)},de().prototype.maxPool=function(n,e,t,r){return this.throwIfDisposed(),U0(this,n,e,t,r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.max=function(n,e){return this.throwIfDisposed(),ps(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.maximum=function(n){return this.throwIfDisposed(),Ha(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.mean=function(n,e){return this.throwIfDisposed(),rn(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.min=function(n,e){return this.throwIfDisposed(),yp(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.minimum=function(n){return this.throwIfDisposed(),yc(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),BF(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.mod=function(n){return this.throwIfDisposed(),HF(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.mul=function(n){return this.throwIfDisposed(),j(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.neg=function(){return this.throwIfDisposed(),Qt(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.norm=function(n,e,t){return this.throwIfDisposed(),xp(this,n,e,t)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.notEqual=function(n){return this.throwIfDisposed(),kp(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),Kk(this,n,e,t)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.onesLike=function(){return this.throwIfDisposed(),Hr(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.pad=function(n,e){return this.throwIfDisposed(),Y0(this,n,e)},de().prototype.pool=function(n,e,t,r,s,i){return this.throwIfDisposed(),rV(this,n,e,t,r,s,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.pow=function(n){return this.throwIfDisposed(),tl(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.prelu=function(n){return this.throwIfDisposed(),J0(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.prod=function(n,e){return this.throwIfDisposed(),iV(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.reciprocal=function(){return this.throwIfDisposed(),NV(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.relu=function(){return this.throwIfDisposed(),Ji(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.relu6=function(){return this.throwIfDisposed(),Jk(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.reshapeAs=function(n){return this.throwIfDisposed(),q(this,n.shape)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.reshape=function(n){return this.throwIfDisposed(),q(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),p2(this,n,e,t)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),f2(this,n,e,t)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.reverse=function(n){return this.throwIfDisposed(),qi(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.rfft=function(){return this.throwIfDisposed(),YV(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.round=function(){return this.throwIfDisposed(),qk(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.rsqrt=function(){return this.throwIfDisposed(),e2(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.selu=function(){return this.throwIfDisposed(),t2(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.separableConv2d=function(n,e,t,r,s,i){return this.throwIfDisposed(),n2(this,n,e,t,r,s,i)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.sigmoid=function(){return this.throwIfDisposed(),qo(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.sign=function(){return this.throwIfDisposed(),FV(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.sin=function(){return this.throwIfDisposed(),r2(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.sinh=function(){return this.throwIfDisposed(),s2(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.slice=function(n,e){return this.throwIfDisposed(),wt(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.softmax=function(n){return this.throwIfDisposed(),nb(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.softplus=function(){return this.throwIfDisposed(),bc(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),Q0(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.split=function(n,e){return this.throwIfDisposed(),Lr(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.sqrt=function(){return this.throwIfDisposed(),On(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.square=function(){return this.throwIfDisposed(),Nt(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.squaredDifference=function(n){return this.throwIfDisposed(),JV(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.squeeze=function(n){return this.throwIfDisposed(),wc(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof an?[this,n]:[this,...n];return Ds(t,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.step=function(n){return this.throwIfDisposed(),kc(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.stridedSlice=function(n,e,t,r,s,i,l,u){return this.throwIfDisposed(),rP(this,n,e,t,r,s,i,l,u)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.sub=function(n){return this.throwIfDisposed(),Ze(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.sum=function(n,e){return this.throwIfDisposed(),Xe(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.tan=function(){return this.throwIfDisposed(),aP(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.tanh=function(){return this.throwIfDisposed(),V0(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.tile=function(n){return this.throwIfDisposed(),fs(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.toBool=function(){return this.throwIfDisposed(),ze(this,"bool")};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.toFloat=function(){return this.throwIfDisposed(),ze(this,"float32")};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.toInt=function(){return this.throwIfDisposed(),ze(this,"int32")};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.topk=function(n,e){return this.throwIfDisposed(),uP(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.transpose=function(n){return this.throwIfDisposed(),at(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.unique=function(n){return this.throwIfDisposed(),hP(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),u2(this,n,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.unstack=function(n){return this.throwIfDisposed(),to(this,n)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.where=function(n,e){return this.throwIfDisposed(),Xn(n,this,e)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/de().prototype.zerosLike=function(){return this.throwIfDisposed(),st(this)};/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class Ks extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ks.prototype)}}class jr extends Error{constructor(e){super(e),Object.setPrototypeOf(this,jr.prototype)}}class _ extends Error{constructor(e){super(e),Object.setPrototypeOf(this,_.prototype)}}class Qe extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Qe.prototype)}}class Kb extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Kb.prototype)}}/**
* @license
* Copyright 2022 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class dI{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const r=this.cache.keys().next().value;this.cache.delete(r)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const r=this.cache.keys().next().value;this.cache.delete(r)}this.maxEntries=e}}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function ro(n,e){if(Array.isArray(n)){let t=[];for(let r=0;r<e;r++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function Zs(n,e){if(!n)throw new Kb(e)}function hI(n,e){let t=0;for(const r of n)r===e&&t++;return t}function tr(n){return n.length===1?n[0]:n}function pt(n){return Array.isArray(n)?n:[n]}function ya(n){const e=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return e[0]!=="_"?e:"private"+e}function so(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let Yr={};function Zb(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function Bb(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>Bb(e));else{const e=Object.keys(n);for(const t of e){const r=n[t];r!=null&&typeof r=="object"&&(!Array.isArray(r)&&r.type==="ndarray"&&typeof r.value=="number"?n[t]=r.value:Bb(r))}}}function Tc(n,e={},t={},r="object",s=!1){if(typeof n=="string"){const i=n;let l;if(i in t)l=t[i];else if(i in Yr)l=Yr[i];else if(l=e[i],l==null)throw new _(`Unknown ${r}: ${n}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return l}else{const i=n;if(i.className==null||i.config==null)throw new _(`${r}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);const l=i.className;let u,c;if(l in t?[u,c]=t[l]:l in Yr?[u,c]=Yr.className:l in e&&([u,c]=e[l]),u==null)throw new _(`Unknown ${r}: ${l}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(c!=null){const h={};for(const y of Object.keys(Yr))h[y]=Yr[y];for(const y of Object.keys(t))h[y]=t[y];const p=i.config;p.customObjects=h;const m=Object.assign({},Yr);for(const y of Object.keys(t))Yr[y]=t[y];Bb(i.config);const g=c(u,i.config,t,s);return Yr=Object.assign({},m),g}else{const h=Object.assign({},Yr);for(const m of Object.keys(t))Yr[m]=t[m];const p=new u(i.config);return Yr=Object.assign({},h),p}}}function VD(n,e){return n<e?-1:n>e?1:0}function Lp(n,e){return-1*VD(n,e)}function Ya(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function PD(n){if(n==null)throw new _(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function ao(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new _(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function _b(n,e,t=0,r=1/0){return Zs(t>=0),Zs(r>=t),Array.isArray(n)&&n.length>=t&&n.length<=r&&n.every(s=>typeof s===e)}function bn(n,e){Array.isArray(n)?(T(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,r)=>bn(t,`element ${r+1} of ${e}`))):T(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${pI(n)}.`)}function pI(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>pI(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function XD(n,e,t){let r=t!=null?t():Yn(),s;return(...i)=>{const l=t!=null?t():Yn();return l-r<e||(r=l,s=n(...i)),s}}function fI(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/let OD=0;function mI(){return OD++}const Gp={};function zp(n=""){return n in Gp||(Gp[n]=0),Gp[n]+=1,n+Gp[n].toString()}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const DD=["channelsFirst","channelsLast"],AD=["nearest","bilinear"],KD=["valid","same","causal"],ZD=["max","avg"],BD=["sum","mul","concat","ave"];/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const ol=new Map;function Jt(n){ao(DD,"DataFormat",n)}function _D(n){ao(AD,"InterpolationFormat",n)}function Gr(n){ao(KD,"PaddingMode",n)}function gI(n){ao(ZD,"PoolMode",n)}const Nc=[],bI="/";function io(n,e){Nc.push(n);try{const t=e();return Nc.pop(),t}catch(t){throw Nc.pop(),t}}function HD(){return Nc.length===0?"":Nc.join(bI)+bI}function yI(n){if(!vI(n))throw new Error("Not a valid tensor name: '"+n+"'");return HD()+n}function xI(n){if(!vI(n))throw new Error("Not a valid tensor name: '"+n+"'");ol.has(n)||ol.set(n,0);const e=ol.get(n);if(ol.set(n,ol.get(n)+1),e>0){const t=`${n}_${e}`;return ol.set(t,1),t}else return n}const UD=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function vI(n){return!!n.match(UD)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function jD(n){return n===parseInt(n.toString(),10)}function Qa(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let r=1;for(let s=e;s<t;++s)r*=n[s];return r}function ll(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const r=n[t];r<e&&(e=r)}return e}function Ja(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const r=n[t];r>e&&(e=r)}return e}function gs(n,e){if(e<n)throw new _(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let r=n;r<e;++r)t.push(r);return t}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/let Hb;function ln(){return Hb==null&&(Hb=Ka().epsilon()),Hb}function bs(){return"channelsLast"}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function xa(n,e){return ze(n,e)}function Rc(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),q(n,t)}function YD(n,e){return ee(()=>{if(n.shape.length!==2)throw new _(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=Rc(n,1);return Yb(t,[1,e,1])})}function QD(n){const e=[Qa(n.shape)];return q(n,e)}function JD(n){if(n.rank<=1)throw new _(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],Qa(n.shape,1)];return q(n,e)}function oo(n,e,t){return ee(()=>{switch(n.rank){case 1:return eb(n,e,t);case 2:return a2(n,[e,0],[t,n.shape[1]]);case 3:return tb(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return Sp(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return wt(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return wt(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new _(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Ub(n,e,t){return ee(()=>{switch(n.rank){case 1:return eb(n,e,t);case 2:return a2(n,[0,e],[n.shape[0],t]);case 3:return tb(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return Sp(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new _(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Wp(n,e,t,r){return ee(()=>{switch(n.rank){case 1:return eb(n,e,t);case 2:switch(r){case 1:return oo(n,e,t);case 2:return Ub(n,e,t);default:throw new _(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return oo(n,e,t);case 2:return tb(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return Ub(n,e,t);default:throw new _(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return oo(n,e,t);case 2:return Sp(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return Sp(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return Ub(n,e,t);default:throw new _(`The axis is not within the rank of the tensor ${r}`)}default:throw new _(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function jb(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),qn(n,e)}function wI(n,e){switch(n.rank){case 1:return u$([n,e]);case 2:return d$([n,e],0);case 3:return p$([n,e],0);case 4:return m$([n,e],0);default:throw new _(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function Yb(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new _(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return fs(n,e)}function Mp(n,e=0,t=1,r,s){return IV(n,e,t,r,s)}function Bs(n,e,t,r){if(n.rank<2||e.rank<2)throw new Qe(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const s=n.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(s!==i)throw new Qe(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return d2({a:n,b:e,transposeA:!1,transposeB:!1,bias:r?Qb(n.rank,r,bs()):null,activation:t});{const s=n.shape.slice(),i=s.pop();n=q(n,[-1,i]);const l=e.shape.slice(),u=l.pop(),c=l.pop(),h=[...l,u],p=Array.from({length:e.rank},(g,y)=>y===0?e.rank-2:y<=e.rank-2?y-1:y);e=q(at(e,p),[c,-1]);const m=[...s,...h];return q(d2({a:n,b:e,transposeA:!1,transposeB:!1,bias:r?Qb(n.rank,r,bs()):null,activation:t}),m)}}function kI(n,e,t){return ee(()=>(Array.isArray(e)?e=hr(e,"int32"):e=ze(e,"int32"),Z0(n,e,t)))}function Ec(n){return j(n,n)}function Qb(n,e,t){const r=e.shape;if(e.rank!==1&&e.rank!==n)throw new _(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return r.length===1?q(e,[1,r[0],1,1,1]):q(e,[1,r[3],r[0],r[1],r[2]]);if(t==="channelsLast")return r.length===1?q(e,[1,1,1,1,r[0]]):q(e,[1].concat(r))}else if(n===4){if(t==="channelsFirst")return r.length===1?q(e,[1,r[0],1,1]):q(e,[1,r[2],r[0],r[1]]);if(t==="channelsLast")return r.length===1?q(e,[1,1,1,r[0]]):q(e,[1].concat(r))}else if(n===3){if(t==="channelsFirst")return r.length===1?q(e,[1,r[0],1]):q(e,[1,r[1],r[0]]);if(t==="channelsLast")return r.length===1?q(e,[1,1,r[0]]):q(e,[1].concat(r))}else if(n<3)return e;throw new _(`Unsupported input rank by biasAdd: ${e.rank}`)}function ys(n,e,t){return ee(()=>(t==null&&(t=bs()),Jt(t),ke(n,Qb(n.rank,e,t))))}function qD(n,e=1){if(e!==1)throw new Qe(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return bp(n)}function eA(n){return ee(()=>Ke(n,ke(Pn(n),1)))}function II(n,e,t,r){return ee(()=>xP(n,e,t,r))}function tA(n){return ee(()=>{const e=ke(.5,j(.2,n));return Rr(e,0,1)})}function Lc(n,e,t=!1){return t?n():e()}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const nA=["fanIn","fanOut","fanAvg"],rA=["normal","uniform","truncatedNormal"];/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function sA(n){ao(nA,"FanMode",n)}function aA(n){ao(rA,"Distribution",n)}class Qr extends al{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class SI extends Qr{apply(e,t){return gn(e,t)}}SI.className="Zeros",xe(SI);class Jb extends Qr{apply(e,t){return Ua(e,t)}}Jb.className="Ones",xe(Jb);class CI extends Qr{constructor(e){if(super(),typeof e!="object")throw new _(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new _(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return ee(()=>j(ht(this.value),Ua(e,t)))}getConfig(){return{value:this.value}}}CI.className="Constant",xe(CI);class TI extends Qr{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return xc(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}TI.className="RandomUniform",xe(TI);class NI extends Qr{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Qe(`randomNormal does not support dType ${t}.`);return Mp(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}NI.className="RandomNormal",xe(NI);class RI extends Qr{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Qe(`truncatedNormal does not support dType ${t}.`);return l2(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}RI.className="TruncatedNormal",xe(RI);class EI extends Qr{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return ee(()=>{if(e.length!==2||e[0]!==e[1])throw new _("Identity matrix initializer can only be used for 2D square matrices.");return j(this.gain,Pk(e[0]))})}getConfig(){return{gain:this.gain}}}EI.className="Identity",xe(EI);function iA(n,e="channelsLast"){let t,r;if(Jt(e),n.length===2)t=n[0],r=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const s=Qa(n,2);t=n[1]*s,r=n[0]*s}else if(e==="channelsLast"){const s=Qa(n,0,n.length-2);t=n[n.length-2]*s,r=n[n.length-1]*s}}else{const s=Qa(n);t=Math.sqrt(s),r=Math.sqrt(s)}return[t,r]}class pr extends Qr{constructor(e){if(super(),e.scale<0)throw new _(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,sA(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,aA(this.distribution),this.seed=e.seed}apply(e,t){const r=iA(e),s=r[0],i=r[1];let l=this.scale;if(this.mode==="fanIn"?l/=Math.max(1,s):this.mode==="fanOut"?l/=Math.max(1,i):l/=Math.max(1,(s+i)/2),this.distribution==="normal"){const u=Math.sqrt(l);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Qe(`${this.getClassName()} does not support dType ${t}.`);return l2(e,0,u,t,this.seed)}else{const u=Math.sqrt(3*l);return xc(e,-u,u,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}pr.className="VarianceScaling",xe(pr);class qb extends pr{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return pr.className}}qb.className="GlorotUniform",xe(qb);class ey extends pr{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return pr.className}}ey.className="GlorotNormal",xe(ey);class ty extends pr{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return pr.className}}ty.className="HeNormal",xe(ty);class ny extends pr{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return pr.className}}ny.className="HeUniform",xe(ny);class ry extends pr{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return pr.className}}ry.className="LeCunNormal",xe(ry);class sy extends pr{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return pr.className}}sy.className="LeCunUniform",xe(sy);class LI extends Qr{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return ee(()=>{if(e.length<2)throw new Qe("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;const r=M(e.slice(0,-1)),s=e[e.length-1],i=r*s;i>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${i}) elements: Slowness may result.`);const l=[Math.max(s,r),Math.min(s,r)],u=Mp(l,0,1,t,this.seed),c=mX.qr(u,!1);let h=c[0];const p=c[1].flatten().stridedSlice([0],[Math.min(s,r)*Math.min(s,r)],[Math.min(s,r)+1]);return h=j(h,p.sign()),r<s&&(h=h.transpose()),j(ht(this.gain),h.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}LI.className="Orthogonal",xe(LI);const GI={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function zI(n,e={}){return Tc(n,Ur.getMap().classNameMap,e,"initializer")}function Ot(n){return Zb(n)}function Wt(n){if(typeof n=="string"){const e=n in GI?GI[n]:n;if(e==="GlorotNormal")return new ey;if(e==="GlorotUniform")return new qb;if(e==="HeNormal")return new ty;if(e==="HeUniform")return new ny;if(e==="LeCunNormal")return new ry;if(e==="LeCunUniform")return new sy;{const t={};return t.className=e,t.config={},zI(t)}}else return n instanceof Qr?n:zI(n)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function ay(n){return Array.isArray(n)&&Array.isArray(n[0])}function $p(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function Be(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new _(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function ot(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new _(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function Fp(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((r,s)=>r*s);return e}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const WI="Variable";class oA{constructor(e,t="float32",r=WI,s=!0,i=null){this.dtype=t??"float32",this.shape=e.shape,this.id=mI(),r=r??WI,this.originalName=yI(r),this.name=xI(this.originalName),this.trainable_=s,this.constraint=i,this.val=mP(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),lA(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function lA(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function iy(n){return n.map(e=>e.read())}function oy(n){n.forEach(e=>{e[0].write(e[1])})}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class un{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class _s{constructor(e,t,r,s,i,l,u){this.dtype=e,this.shape=t,this.sourceLayer=r,this.inputs=s,this.callArgs=i,this.outputTensorIndex=u,this.id=mI(),l!=null&&(this.originalName=yI(l),this.name=xI(this.originalName)),this.rank=t.length}}let uA=0;class Vp{constructor(e,t){this.callArgs=t,this.id=uA++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const r of e.inboundLayers)r!=null&&r.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let cA=0;class qe extends al{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=cA++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const r=this.getClassName();t=ya(r)+"_"+zp(r)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let r;if(e.batchInputShape!=null)r=e.batchInputShape;else if(e.inputShape!=null){let i=null;e.batchSize!=null&&(i=e.batchSize),r=[i].concat(e.inputShape)}this.batchInputShape=r;let s=e.dtype;s==null&&(s=e.inputDType),s==null&&(s="float32"),this.dtype=s}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new jr(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new _(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return tr(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return tr(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Ks(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Ks(`Layer ${this.name} is not connected, no input to return.`);return tr(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Ks(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Ks(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return tr(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=pt(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const r=pt(this.inputSpec);if(t.length!==r.length)throw new _(`Layer ${this.name} expects ${r.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let s=0;s<t.length;s++){const i=t[s],l=r[s];if(l==null)continue;const u=i.rank;if(l.ndim!=null&&u!==l.ndim)throw new _(`Input ${s} is incompatible with layer ${this.name}: expected ndim=${l.ndim}, found ndim=${u}`);if(l.maxNDim!=null&&u>l.maxNDim)throw new _(`Input ${s} is incompatible with layer ${this.name}: expected max_ndim=${l.maxNDim}, found ndim=${u}`);if(l.minNDim!=null&&u<l.minNDim)throw new _(`Input ${s} is incompatible with layer ${this.name}: expected min_ndim=${l.minNDim}, found ndim=${u}.`);if(l.dtype!=null&&i.dtype!==l.dtype)throw new _(`Input ${s} is incompatible with layer ${this.name} : expected dtype=${l.dtype}, found dtype=${i.dtype}.`);if(l.axes){const c=i.shape;for(const h in l.axes){const p=Number(h),m=l.axes[h],g=p>=0?c[p]:c[c.length+p];if(m!=null&&[m,null].indexOf(g)===-1)throw new _(`Input ${s} is incompatible with layer ${this.name}: expected axis ${p} of input shape to have value ${m} but got shape ${c}.`)}}if(l.shape!=null)for(let c=0;c<l.shape.length;++c){const h=l.shape[c],p=i.shape[c];if(h!=null&&p!=null&&h!==p)throw new _(`Input ${s} is incompatible with layer ${this.name}: expected shape=${l.shape}, found shape=${i.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const r=pt(e),s=pA(e),i=fA(e);if(s===i)throw new _("Arguments to apply() must be all SymbolicTensors or all Tensors");return io(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const l=[];for(const u of pt(e))l.push(u.shape);this.build(tr(l)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(e),i){let l=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,l);const u=pt(l),c=[];for(let h of u)r.indexOf(h)!==-1&&(h=h.clone()),c.push(h);if(l=tr(c),this.activityRegularizer!=null)throw new Qe("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}else{const l=dA(e),u=this.computeOutputShape(l);let c;const h=hA(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?l[0]:l),u!=null&&u.length>0&&Array.isArray(u[0])?c=u.map((p,m)=>new _s(h,p,this,pt(e),t,this.name,m)):c=new _s(h,u,this,pt(e),t,this.name),this.addInboundNode(e,c,null,null,l,u,t),this._refCount++,this.activityRegularizer!=null)throw new Qe("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return c}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((r,s)=>{r!=null&&e[s]!=null&&e[s]!==r&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Ks(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const r=JSON.stringify(t.outputShapes);e.indexOf(r)===-1&&e.push(r)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new Ks(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new jr(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Fp(this.weights)}build(e){this.built=!0}getWeights(e=!1){return iy(e?this.trainableWeights:this.weights)}setWeights(e){ee(()=>{const t=this.weights;if(t.length!==e.length)throw new _(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const r=[],s=iy(t);for(let i=0;i<s.length;++i){const l=s[i],u=t[i],c=e[i];if(!B(l.shape,c.shape))throw new _(`Layer weight shape ${l.shape} not compatible with provided weight shape ${c.shape}`);r.push([u,c])}oy(r)})}addWeight(e,t,r,s,i,l,u,c){if(this._addedWeightNames.indexOf(e)!==-1)throw new _(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),r==null&&(r="float32"),this.fastWeightInitDuringBuild&&(s=c!=null?c():Wt("zeros"));const h=s.apply(t,r),p=new oA(h,r,e,l,u);return h.dispose(),i!=null&&this.addLoss(()=>i.apply(p.read())),l==null&&(l=!0),l?this._trainableWeights.push(p):this._nonTrainableWeights.push(p),p}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=pt(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(r=>{if(r!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,r){if(!this.supportsMasking)return;const s=this.computeMask(e,r),i=pt(t),l=pt(s);if(i.length!==l.length)throw new Error(`${this.name} outputs ${i.length} tensors but ${i.length} masks for those tensors`);for(let u=0;u<i.length;u++)i[u].kerasMask=l[u]}addInboundNode(e,t,r,s,i,l,u=null){const c=pt(e);t=pt(t),r=pt(r),s=pt(s),i=$p(i),l=$p(l);const h=[],p=[],m=[];for(const g of c)h.push(g.sourceLayer),p.push(g.nodeIndex),m.push(g.tensorIndex);new Vp({outboundLayer:this,inboundLayers:h,nodeIndices:p,tensorIndices:m,inputTensors:c,outputTensors:t,inputMasks:r,outputMasks:s,inputShapes:i,outputShapes:l},u);for(let g=0;g<t.length;g++)t[g].sourceLayer=this,t[g].nodeIndex=this.inboundNodes.length-1,t[g].tensorIndex=g}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function dA(n){n=pt(n);const e=[];for(const t of n)e.push(t.shape);return tr(e)}function hA(n){return"float32"}function MI(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const r=e.inboundNodes[t];if(r.inboundLayers.length===0)return r.inputTensors;{const s=[];for(let i=0;i<r.inboundLayers.length;i++){const l=r.inputTensors[i],u=r.inboundLayers[i],c=r.nodeIndices[i],h=MI(l,u,c);for(const p of h)s.indexOf(p)===-1&&s.push(p)}return s}}}function pA(n){let e=!0;for(const t of pt(n))if(!(t instanceof _s)){e=!1;break}return e}function fA(n){let e=!0;for(const t of pt(n))if(t instanceof _s){e=!1;break}return e}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class Gc extends qe{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:zp("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new _("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new _("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new _("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const r=e.dtype||"float32";this.batchInputShape=t,this.dtype=r,this.inputSpec=[{shape:t}];const s=new _s(this.dtype,this.batchInputShape,this,[],{},this.name);s.nodeIndex=0,s.tensorIndex=0,new Vp({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[s],outputTensors:[s],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new _(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Gc.className="InputLayer",xe(Gc);function mA(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new _("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new Gc({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function gA(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return ze(e,n.dtype)}catch{throw new _(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class qa{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof qa)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,r){if(this.id2Value[e.id]==null)this.id2Value[e.id]=gA(e,t),this.name2Id[e.name]=e.id,r!=null&&(this.id2Mask[e.id]=r);else throw new _(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof _s){if(this.id2Value[e.id]==null)throw new _(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new _(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof _s){if(this.id2Value[e.id]==null)throw new _(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new _(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&et(this.id2Mask)}}const Pp=new dI,Xp=new dI;function bA(n){Pp!=null&&Pp.setMaxEntries(n),Xp!=null&&Xp.setMaxEntries(n)}function zc(n,e,t,r){const s=t==null?!1:t.training,i=Array.isArray(n),l=i?n:[n],u=l.map(v=>v.name),c=[],h=e.names();for(const v of u)h.indexOf(v)!==-1?c.push(e.getValue(v)):c.push(null);const p=u.join(",")+"|"+e.names().sort().join(",");let m=Pp.get(p),g;if(m==null){const v=yA(l,e);m=v.sorted,g=v.recipientCounts,Pp.put(p,m),Xp.put(p,g)}g={},s||Object.assign(g,Xp.get(p));const y=new qa(e);for(let v=0;v<m.length;++v){const w=m[v],S=w.sourceLayer;if(S instanceof Gc)continue;const I=[],C=[],R=[];let L=!1;for(const D of w.inputs){const Z=y.getValue(D),ne=y.getMask(D);I.push(Z),C.push(ne),ne!=null&&(L=!0),s||(g[D.name]--,g[D.name]===0&&!e.hasKey(D)&&u.indexOf(D.name)===-1&&!Z.isDisposed&&D.sourceLayer.stateful!==!0&&R.push(Z))}L&&(t=t||{},t.mask=C[0]);const G=pt(S.apply(I,t));let $=null;S.supportsMasking&&($=S.computeMask(I,C));const F=vA(w),V=Array.isArray(F)?F:[F];for(let D=0;D<V.length;++D){y.hasKey(V[D])||y.add(V[D],G[D],Array.isArray($)?$[0]:$);const Z=u.indexOf(V[D].name);Z!==-1&&(c[Z]=G[D])}s||et(R)}return y.disposeMasks(),i?c:c[0]}function yA(n,e){T(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],r={};if(n.length===1){const s=$I(n[0],e);t=s.sorted,r=s.recipientMap}else{const s=new Set;for(const i of n){const{sorted:l,recipientMap:u}=$I(i,e);for(const c of l)s.has(c.name)||(t.push(c),s.add(c.name));for(const c in u)r[c]==null&&(r[c]=new Set),u[c].forEach(h=>r[c].add(h))}}return{sorted:t,recipientCounts:xA(r)}}function xA(n){const e={};for(const t in n)e[t]=n[t].size;return e}function $I(n,e){const t=new Set,r=[],s={};for(const u of e.names())t.add(u);const i=[],l=[];for(i.push(n);i.length>0;){const u=i[i.length-1];if(t.has(u.name)){i.pop();continue}const c=l[l.length-1]===i.length-1;if(u.inputs.length===0||c)i.pop(),r.push(u),t.add(u.name),c&&l.pop();else{l.push(i.length-1);for(const h of u.inputs)s[h.name]==null&&(s[h.name]=new Set),s[h.name].add(u.name),!t.has(h.name)&&i.push(h)}}return{sorted:r,recipientMap:s}}function vA(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let r=0;r<n.sourceLayer.inboundNodes.length;++r)for(const s of n.sourceLayer.inboundNodes[r].outputTensors)if(s.id===n.id){t=r;break}e=n.sourceLayer.getOutputAt(t)}return e}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/ae().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,bA);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function ly(n,e){return ee(()=>On(Xe(j(n,n),e,!0)))}class Wc extends al{getConfig(){return{}}}class FI extends Wc{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ee(()=>{const t=ly(e,this.axis),r=Rr(t,0,this.maxValue);return j(e,Ke(r,ke(ln(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}FI.className="MaxNorm",xe(FI);class VI extends Wc{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ee(()=>Ke(e,ke(ln(),ly(e,this.axis))))}getConfig(){return{axis:this.axis}}}VI.className="UnitNorm",xe(VI);class PI extends Wc{apply(e){return Ji(e)}}PI.className="NonNeg",xe(PI);class XI extends Wc{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ee(()=>{const t=ly(e,this.axis),r=ke(j(this.rate,Rr(t,this.minValue,this.maxValue)),j(1-this.rate,t));return j(e,Ke(r,ke(ln(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}XI.className="MinMaxNorm",xe(XI);const OI={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function cn(n){return Zb(n)}function DI(n,e={}){return Tc(n,Ur.getMap().classNameMap,e,"constraint")}function dn(n){if(n==null)return null;if(typeof n=="string"){const e={className:n in OI?OI[n]:n,config:{}};return DI(e)}else return n instanceof Wc?n:DI(n)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/async function lo(n){if(n==null)return;const e=[],t=[],r=[];for(const s in n){const i=n[s];if(typeof i!="number"){const l=i;e.push(l.data()),t.push(s),r.push(l)}}if(e.length>0){const s=await Promise.all(e);for(let i=0;i<s.length;++i)n[t[i]]=s[i][0];et(r)}}function AI(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/var KI;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(KI||(KI={}));const wA=125;class Mc{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class kA{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class IA extends Mc{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const r=t.size==null?0:t.size;this.seen+=r;for(const s in t){const i=t[s];if(typeof i=="number")this.totals.hasOwnProperty(s)||(this.totals[s]=0),this.totals[s]=this.totals[s]+i*r;else{let l;s in this.totals?l=this.totals[s]:this.totals[s]=0;const u=ee(()=>ke(this.totals[s],j(i,r)));this.totals[s]=u,l!=null&&l.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const r of this.params.metrics)this.totals[r]!=null&&(typeof this.totals[r]=="number"?t[r]=this.totals[r]/this.seen:ee(()=>{const s=j(Ke(1,this.seen),this.totals[r]);t[r]=s,this.totals[r].dispose(),Nr(t[r])}))}}class SA extends Mc{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const r in t)this.history[r]==null&&(this.history[r]=[]),this.history[r].push(t[r])}async syncData(){const e=[],t=[],r=[];for(const i in this.history){const l=this.history[i];for(let u=0;u<l.length;++u)if(typeof l[u]!="number"){const c=l[u];e.push(c.data()),t.push(i),r.push(u)}}const s=await Promise.all(e);for(let i=0;i<s.length;++i)this.history[t[i]][r[i]].dispose(),this.history[t[i]][r[i]]=s[i][0]}}class CA extends Mc{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||Tp,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=wA),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");Ut(this.yieldEvery)&&(this.maybeWait=XD(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,r){const s=[];this.yield!=null&&(await lo(r),s.push(this.yield(e,t,r))),s.push(this.nextFrameFunc()),await Promise.all(s)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await lo(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const r=[];this.epochEnd!=null&&(await lo(t),r.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&r.push(this.nextFrameFunc()),await Promise.all(r)}async onBatchBegin(e,t){this.batchBegin!=null&&(await lo(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const r=[];this.batchEnd!=null&&(await lo(t),r.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?r.push(this.nextFrameFunc()):Ut(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(r)}async onTrainBegin(e){this.trainBegin!=null&&(await lo(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await lo(e),await this.trainEnd(e))}}function ZI(n,e){return n==null&&(n={}),n instanceof Mc?[n]:Array.isArray(n)&&n[0]instanceof Mc?n:pt(n).map(t=>new CA(t,e))}class Jr{constructor(){}static registerCallbackConstructor(e,t){T(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),Jr.checkForDuplicate(t),Jr.constructors[e]==null&&(Jr.constructors[e]=[]),Jr.constructors[e].push(t)}static checkForDuplicate(e){for(const t in Jr.constructors)Jr.constructors[+t].forEach(r=>{if(r===e)throw new _("Duplicate callback constructor.")})}static clear(){Jr.constructors={}}static createCallbacks(e){const t=[];for(const r in Jr.constructors){const s=+r;e>=s&&t.push(...Jr.constructors[s])}return t.map(r=>new r)}}Jr.constructors={};function BI(n,e,t,r,s,i,l,u,c){const h=new SA,p=[new IA,...Jr.createCallbacks(e)];n!=null&&p.push(...n),p.push(h);const m=new kA(p);return m.setParams({epochs:t,initialEpoch:r,samples:s,steps:i,batchSize:l,verbose:e,doValidation:u,metrics:c}),{callbackList:m,history:h}}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function va(n,e={},t=!1){return Tc(n,Ur.getMap().classNameMap,e,"layer",t)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function Op(n,e){return ee(()=>{n.dtype!=="float32"&&(n=ze(n,"float32"));const t=Xe(Ec(n),e,!0),r=gp(t.shape,ln()),s=On(Ha(t,r));return Ke(n,s)})}function Dp(n,e){return ee(()=>rn(Ec(Ze(e,n)),-1))}function uy(n,e){return ee(()=>rn(Pn(Ze(e,n)),-1))}function cy(n,e){return ee(()=>{const t=Ze(n,e),r=Rr(Pn(n),ln(),Number.MAX_VALUE),s=Pn(Ke(t,r));return j(100,rn(s,-1))})}function TA(n,e){return ee(()=>{const t=Rr(e,ln(),Number.MAX_VALUE),r=Os(ke(1,t)),s=Rr(n,ln(),Number.MAX_VALUE),i=Os(ke(1,s));return rn(Ec(Ze(r,i)),-1)})}function NA(n,e){return ee(()=>{const t=Ha(0,Ze(1,j(n,e)));return rn(Ec(t),-1)})}function RA(n,e){return ee(()=>{const t=Ha(0,Ze(1,j(n,e)));return rn(t,-1)})}function EA(n,e){return ee(()=>{const t=Xe(j(n,e),-1),r=ps(j(Ze(1,n),e),-1);return Ha(0,ke(1,Ze(r,t)))})}function LA(n,e){return ee(()=>{const t=Math.log(2),r=Ze(e,n),s=Ze(ke(r,bc(j(-2,r))),t);return rn(s,-1)})}function $c(n,e,t=!1){return ee(()=>{if(t)e=nb(e);else{const r=Xe(e,e.shape.length-1,!0);e=Ke(e,r)}return e=Rr(e,ln(),1-ln()),Qt(Xe(j(ze(n,"float32"),Os(e)),e.shape.length-1))})}function Ap(n,e,t=!1){return ee(()=>{const r=ze(vp(QD(n)),"int32");e=Rr(e,ln(),1-ln());const s=e.shape,i=q(Kk(r,s[s.length-1]),s);return $c(i,e,t)})}function GA(n,e){if(!B(n.shape,e.shape))throw new _(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return ee(()=>{const t=Ji(e),r=Qt(Pn(e));return ke(Ze(t,j(e,n)),Xk(Xs(r)))})}function Kp(n,e){return ee(()=>{let t;return t=Rr(e,ln(),1-ln()),t=Os(Ke(t,Ze(1,t))),rn(GA(n,t),-1)})}function zA(n,e){return ee(()=>{const t=Rr(n,ln(),1),r=Rr(e,ln(),1);return Xe(j(n,Os(Ke(t,r))),-1)})}function WA(n,e){return ee(()=>{const t=Os(ke(ln(),e));return rn(Ze(e,j(n,t)),-1)})}function _I(n,e){return ee(()=>{const t=Op(n,-1),r=Op(e,-1),s=j(t,r);return Qt(Xe(s,-1))})}const Zp={meanSquaredError:Dp,meanAbsoluteError:uy,meanAbsolutePercentageError:cy,meanSquaredLogarithmicError:TA,squaredHinge:NA,hinge:RA,categoricalHinge:EA,logcosh:LA,categoricalCrossentropy:$c,sparseCategoricalCrossentropy:Ap,binaryCrossentropy:Kp,kullbackLeiblerDivergence:zA,poisson:WA,cosineProximity:_I};function dy(n){if(typeof n=="string"){if(n in Zp)return Zp[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new _(e)}else return n}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function HI(n,e){return ee(()=>{const t=j(.5,Hr(e)),r=xa(Er(e,t),n.dtype);return rn(Ps(n,r),-1)})}function UI(n,e){return ee(()=>xa(Ps(dc(n,-1),dc(e,-1)),"float32"))}function MA(n,e){return ee(()=>ze(Xe(fa(Ps(n,1),Ps(e,1))),"float32"))}function $A(n,e){return ee(()=>ze(Xe(fa(Ps(n,0),Ps(e,1))),"float32"))}function FA(n,e){return ee(()=>{const t=MA(n,e),r=$A(n,e),s=ke(t,r);return ze(Xn(Er(s,0),Ke(t,s),0),"float32")})}function VA(n,e){return Kp(n,e)}function PA(n,e){return n.rank===e.rank&&(n=wc(n,[n.rank-1])),e=dc(e,-1),e.dtype!==n.dtype&&(e=ze(e,n.dtype)),ze(Ps(n,e),"float32")}const XA=Dp,OA=Dp,DA=uy,AA=uy,KA=cy,ZA=cy,jI=$c,BA=_I,YI=Ap,Bp={binaryAccuracy:HI,categoricalAccuracy:UI,precision:FA,categoricalCrossentropy:jI,sparseCategoricalCrossentropy:YI,mse:XA,MSE:OA,mae:DA,MAE:AA,mape:KA,MAPE:ZA,cosine:BA};function _A(n){if(typeof n=="string"&&n in Bp)return Bp[n];if(typeof n!="string"&&n!=null)return n;throw new _(`Unknown metric ${n}`)}function _p(n){if(Zs(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(Zp))if(Zp[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(Bp))if(Bp[t]===n){e=t;break}return e!==void 0?e:n.name}}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function HA(n){const e={Adagrad:()=>il.adagrad(.01),Adadelta:()=>il.adadelta(1,.95,ln()),Adam:()=>il.adam(.001,.9,.999,ln()),Adamax:()=>il.adamax(.002,.9,.999,ln(),0),RMSProp:()=>il.rmsprop(.001,.9,0,ln()),SGD:()=>il.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new _(`Unknown Optimizer ${n}`)}/**
* @license
* Copyright 2019 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const QI=1*1024*1024;function JI(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!hy(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const r=JSON.stringify(n);r.length>QI&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${r.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${QI}.`)}}function hy(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!hy(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!hy(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function UA(n,e,t,r=console.log){const s=YA(n),i=["Layer (type)","Input Shape","Output shape","Param #"];s?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(p=>Math.floor(e*p)));let l;if(!s){i.push("Receives inputs"),l=[];for(const p in n.nodesByDepth)l.push(...n.nodesByDepth[p])}r("_".repeat(e)),Hp(i,t,r),r("=".repeat(e));const u=n.layers;for(let p=0;p<u.length;++p)s?QA(u[p],t,r):JA(u[p],t,l,r),r((p===u.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const c=jA(n),h=Fp(n.nonTrainableWeights);r(`Total params: ${c+h}`),r(`Trainable params: ${c}`),r(`Non-trainable params: ${h}`),r("_".repeat(e))}function jA(n){let e;return n.collectedTrainableWeights!=null?e=Fp(n.collectedTrainableWeights):e=Fp(n.trainableWeights),e}function YA(n){let e=!0;const t=[],r=[];for(const s in n.nodesByDepth)t.push(n.nodesByDepth[s]);for(const s of t){if(s.length>1||s.length===1&&s[0].inboundLayers.length>1){e=!1;break}r.push(...s)}if(e)for(const s of n.layers){let i=!1;for(const l of s.inboundNodes)if(r.indexOf(l)!==-1)if(i){e=!1;break}else i=!0;if(!e)break}return e}function Hp(n,e,t=console.log){let r="";for(let s=0;s<n.length;++s)s>0&&(r=r.slice(0,r.length-1)+" "),r+=n[s],r=r.slice(0,e[s]),r+=" ".repeat(e[s]-r.length);t(r)}function QA(n,e,t){let r,s;try{s=n.inboundNodes.map(c=>JSON.stringify(c.inputShapes)).join(",")}catch{s="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const i=n.name,l=n.getClassName(),u=[`${i} (${l})`,s,r,n.countParams().toString()];Hp(u,e,t)}function JA(n,e,t,r){let s,i;try{i=n.inboundNodes.map(m=>JSON.stringify(m.inputShapes)).join(",")}catch{i="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const l=[];for(const m of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(m)===-1))for(let g=0;g<m.inboundLayers.length;++g){const y=m.inboundLayers[g].name,v=m.nodeIndices[g],w=m.tensorIndices[g];l.push(`${y}[${v}][${w}]`)}const u=n.name,c=n.getClassName(),h=l.length===0?"":l[0],p=[`${u} (${c})`,i,s,n.countParams().toString(),h];Hp(p,e,r);for(let m=1;m<l.length;++m)Hp(["","","","",l[m]],e,r)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function qI(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function py(n,e){if(n===null)return null;if(typeof n=="string")return so(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],r=n.length;for(let s=0;s<r;++s){const i=n[s];qI(e,s,i)?t.push(i):t.push(py(i,e))}return t}else{const t={};for(const r of Object.keys(n)){const s=n[r];if(r==="name"&&typeof s=="string")t[r]=s;else{const i=so(r);t[i]=py(s,i)}}return t}}function fy(n,e){if(n==null)return null;if(typeof n=="string")return ya(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],r=n.length;for(let s=0;s<r;++s){const i=n[s];qI(e,s,i)?t.push(i):t.push(fy(i,e))}return t}else{const t={};for(const r of Object.keys(n)){const s=n[r],i=ya(r);(r==="name"||r==="className")&&typeof s=="string"?t[i]=s:t[i]=fy(s,r)}return t}}/** @license See the LICENSE file. */const eS="4.16.0";/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const qA=n=>{const e=Object.keys(n);if(e.length===0)return!1;const t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))};class xs extends qe{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const C=this.getClassName().toLowerCase();this.name=zp(C)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],Ya(this.inputs).length!==this.inputs.length)throw new _(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(C=>C.name)}`);Ya(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(C=>C.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const C of this.outputs){const R=C.sourceLayer,L=C.nodeIndex,G=C.tensorIndex;this.outputLayers.push(R),this.outputLayersNodeIndices.push(L),this.outputLayersTensorIndices.push(G)}for(const C of this.inputs){const R=C.sourceLayer,L=C.nodeIndex,G=C.tensorIndex;Zs(L===0,"input layer has >1 nodes"),Zs(G===0,"input layer has >1 tensors"),this.inputLayers.push(R),this.inputLayersNodeIndices.push(L),this.inputLayersTensorIndices.push(G)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let C=0;C<this.inputLayers.length;C++){const R=this.inputLayers[C];if(!(R instanceof Gc))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${C} (0-based) originates from layer type ${R.getClassName()}.`);this.inputNames.push(R.name),this.feedInputShapes.push(R.batchInputShape),this.feedInputNames.push(R.name)}for(const C of this.outputLayers)this.outputNames.push(C.name);this.internalInputShapes=this.inputs.map(C=>C.shape),this.internalOutputShapes=this.outputs.map(C=>C.shape);const t={},r={},s={},i={},l={},u=[],c=(C,R,L,G,$,F)=>{(G==null||$==null||F==null)&&(G=C.sourceLayer,$=C.nodeIndex,F=C.tensorIndex);const V=G.inboundNodes[$];if(L.indexOf(V)!==-1)throw new jr(`The tensor ${C.name} at layer "${G.name}" is part of a cycle.`);if(R.indexOf(V)!==-1)return;this.containerNodes.add(xs.nodeKey(G,$)),G.id in l||(l[G.id]=Object.keys(l).length),L.indexOf(V)===-1&&L.push(V);const D=V.inboundLayers.length;for(let Z=0;Z<D;Z++){const ne=V.inputTensors[Z],re=V.inboundLayers[Z],se=V.nodeIndices[Z],ue=V.tensorIndices[Z];c(ne,R,L,re,se,ue)}for(R.push(V);L.indexOf(V)>=0;)L.splice(L.indexOf(V),1);u.push(V)},h=[],p=[];for(const C of this.outputs)c(C,h,p);const m=u.slice().reverse();for(const C of m){r[C.id]=C,C.id in t||(t[C.id]=0);let R=t[C.id];const L=s[C.outboundLayer.id]==null?0:s[C.outboundLayer.id];R=Math.max(R,L),s[C.outboundLayer.id]=R,i[C.outboundLayer.id]=C.outboundLayer,t[C.id]=R;for(let G=0;G<C.inboundLayers.length;G++){const $=C.inboundLayers[G],F=C.nodeIndices[G],V=$.inboundNodes[F],D=t[V.id]==null?0:t[V.id];t[V.id]=Math.max(R+1,D),r[V.id]=V}}const g={};for(const C in t){const R=t[C];R in g||(g[R]=[]),g[R].push(r[C])}const y={};for(const C in s){const R=s[C];R in y||(y[R]=[]),y[R].push(i[C])}let v=Object.keys(y).map(C=>parseInt(C,10)).sort(Lp);this.layers=[];for(const C of v){const R=y[C];R.sort((L,G)=>{const $=l[L.id],F=l[G.id];return $<F?-1:$>F?1:0});for(const L of R)L instanceof xs&&this.internalContainerRefs.push(L),this.layers.push(L)}this.layersByDepth=y,v=Object.keys(g).map(C=>parseInt(C,10)).sort(Lp);const w=this.inputs.slice(),S=[];for(const C of v)for(const R of g[C]){const L=R.outboundLayer;if(L!=null){for(const G of R.inputTensors)if(w.indexOf(G)===-1)throw new jr(`Graph disconnected: cannot obtain value for tensor ${G} at layer "${L.name}". The following previous layers were accessed without issue: ${S}`);for(const G of R.outputTensors)w.push(G);S.push(L.name)}}this.nodesByDepth=g;const I=this.layers.map(C=>C.name);for(const C of I){const R=I.filter(L=>L===C).length;if(R!==1)throw new jr(`The name "${C}" is used ${R} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(I))}this.outboundNodes=[],this.inboundNodes=[],new Vp({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(C=>null),outputMasks:this.outputs.map(C=>null),inputShapes:this.inputs.map(C=>C.shape),outputShapes:this.outputs.map(C=>C.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(r=>r.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new _("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const r of this.layers)t.push(...r.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const r={};let s=0;const i=qA(e);i&&this.parseWeights(e);for(const u of this.layers)for(const[c,h]of u.weights.entries()){const p=i?`${h.name.split("/").slice(0,-1).join("/")+"/"}${c}`:h.originalName;if(r[p]!=null)throw new _(`Duplicate weight name: ${p}`);r[p]=h,s++}const l=[];for(const u in e){let c=u;if(r[u]==null){const h=u.split("/");c=h.slice(0,-2).concat([h[h.length-1]]).join("/")}if(r[c]!=null)l.push([r[c],e[u]]);else if(t)throw new _(`Provided weight data has no target variable: ${u}`);delete r[c]}if(t){const u=[];for(const c in r)u.push(c);if(u.length>0)throw new _(`${u.length} of ${s} weights are not set: ${u}`)}oy(l)}parseWeights(e){for(const t in Object.keys(e)){const r=t.split("/"),s=["vars","layer_checkpoint_dependencies"],i=r.map(l=>l.startsWith("_")?l.slice(1):l).filter(l=>!s.includes(l)).join("/");i!==t&&(e[i]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${eS}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const r=fy(this.updatedConfig());return t?JSON.stringify(r):r}call(e,t){return ee(()=>{e=pt(e);const r=new qa;for(let s=0;s<this.inputs.length;++s)r.add(this.inputs[s],e[s]);return zc(this.outputs,r,t)})}computeMask(e,t){return ee(()=>{e=pt(e);let r;return t==null?r=ro(null,e.length):r=pt(t),this.runInternalGraph(e,r)[1]})}computeOutputShape(e){const t=$p(e);if(t.length!==this.inputLayers.length)throw new _(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const r={};for(let u=0;u<t.length;u++){const c=this.inputLayers[u],h=t[u],p=c.name+"_0_0";r[p]=h}const s=Object.keys(this.nodesByDepth).map(u=>parseInt(u,10)).sort(Lp);if(s.length>1)for(const u of s){const c=this.nodesByDepth[u];for(const h of c){const p=h.outboundLayer;if(this.inputLayers.map(w=>w.id).indexOf(p.id)!==-1)continue;const m=[];for(let w=0;w<h.inboundLayers.length;w++){const S=h.inboundLayers[w],I=h.nodeIndices[w],C=h.tensorIndices[w],R=`${S.name}_${I}_${C}`,L=r[R];m.push(L)}const g=p.computeOutputShape(tr(m)),y=$p(g),v=p.inboundNodes.indexOf(h);for(let w=0;w<y.length;w++){const S=`${p.name}_${v}_${w}`;r[S]=y[w]}}}const i=[],l=[];for(let u=0;u<this.outputLayers.length;u++){const c=this.outputLayers[u],h=this.outputLayersNodeIndices[u],p=this.outputLayersTensorIndices[u],m=`${c.name}_${h}_${p}`;l.push(m)}for(let u=0;u<l.length;u++){const c=l[u];Zs(c in r),i.push(r[c])}return tr(i)}runInternalGraph(e,t){t==null&&(t=ro(null,e.length));const r={};for(let c=0;c<this.inputs.length;++c){const h=this.inputs[c],p=e[c],m=t[c];r[h.id]=[p,m]}const s=Object.keys(this.nodesByDepth).map(c=>parseInt(c,10)).sort(Lp);for(const c of s){const h=this.nodesByDepth[c];for(const p of h){const m=p.outboundLayer,g=p.inputTensors,y=p.outputTensors,v=new Array;for(const w of g)w.id in r&&v.push(r[w.id]);if(v.length===g.length){let w={},S,I,C,R;if(p.callArgs!=null&&(w=p.callArgs),v.length===1){const[L,G]=v[0];w.mask==null&&(w.mask=G),C=pt(m.call(L,w)),R=pt(m.computeMask(L,G)),S=[L],I=[G]}else S=v.map(L=>L[0]),I=v.map(L=>L[1]),w.mask==null&&(w.mask=I),C=pt(m.call(S,w)),R=pt(m.computeMask(S,I));if(m.activityRegularizer)throw new Qe("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let L=0;L<y.length;++L){const G=y[L],$=C[L],F=R[L];r[G.id]=[$,F]}}}}const i=[],l=[],u=[];for(const c of this.outputs){Zs(c.id in r,`Could not compute output ${c.name} : ${c.id}`);const[h,p]=r[c.id];u.push(h.shape),i.push(h),l.push(p)}return[i,l,u]}buildNodeConversionMap(e){const t={};let r;for(const s of this.layers){r=s instanceof xs?1:0;for(let i=0;i<s.inboundNodes.length;i++){const l=xs.nodeKey(s,i);this.containerNodes.has(l)&&(t[l]=r,r+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new _("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const r of this.layers)if(r.name===e)return r;throw new _(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new _(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return ee(()=>{const e=[];for(const t of this.layers)for(let r=0;r<t.inboundNodes.length;++r){const s=xs.nodeKey(t,r);this.containerNodes.has(s)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),r=[];for(const l of this.layers){const u=l.getClassName(),c=l.getConfig(),h=[];for(let m=0;m<l.inboundNodes.length;m++){const g=l.inboundNodes[m],y=xs.nodeKey(l,m);let v={};if(this.containerNodes.has(y)){if(g.callArgs)try{JSON.stringify(g.callArgs),v=g.callArgs}catch{console.warn(`Layer ${l.name} was passed non-serializable keyword arguments: ${g.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),v={}}if(g.inboundLayers.length>0){const w=[];for(let S=0;S<g.inboundLayers.length;S++){const I=g.inboundLayers[S],C=g.nodeIndices[S],R=g.tensorIndices[S],L=xs.nodeKey(I,C);let G=t[L];G==null&&(G=0),w.push([I.name,G,R,v])}h.push(w)}}}const p={};p.name=l.name,p.className=u,p.config=c,p.inboundNodes=h,r.push(p)}e.layers=r;const s=[];for(let l=0;l<this.inputLayers.length;l++){const u=this.inputLayers[l],c=this.inputLayersNodeIndices[l],h=xs.nodeKey(u,c);if(!this.containerNodes.has(h))continue;let p=t[h];p==null&&(p=0);const m=this.inputLayersTensorIndices[l];s.push([u.name,p,m])}e.inputLayers=s;const i=[];for(let l=0;l<this.outputLayers.length;l++){const u=this.outputLayers[l],c=this.outputLayersNodeIndices[l],h=xs.nodeKey(u,c);if(!this.containerNodes.has(h))continue;let p=t[h];p==null&&(p=0);const m=this.outputLayersTensorIndices[l];i.push([u.name,p,m])}return e.outputLayers=i,e}static fromConfig(e,t,r={},s=!1){const i={},l={};function u(S,I){S.name in l?l[S.name].push(I):l[S.name]=[I]}function c(S,I){const C=[];let R;for(const L of I){const G=L[0],$=L[1],F=L[2];if(R=L[3]==null?{}:L[3],!(G in i)){u(S,I);return}const V=i[G];if(V.inboundNodes.length<=$){u(S,I);return}const D=V.inboundNodes[$];C.push(D.outputTensors[F])}C.length>0&&S.apply(tr(C),R)}function h(S){const I=S.name,C=va(S,t.customObjects!=null?t.customObjects:{});C.setFastWeightInitDuringBuild(s),i[I]=C,S.inboundNodes.forEach(R=>{if(!(R instanceof Array))throw new _(`Corrupted configuration, expected array for nodeData: ${R}`);u(C,R)})}const p=t.name,m=t.layers;for(const S of m)h(S);for(;!PD(l);)for(const S of m){const I=i[S.name];if(I.name in l){const C=l[I.name];delete l[I.name];for(const R of C)c(I,R)}}const g=[],y=[],v=t.inputLayers;for(const S of v){const I=S[0],C=S[1],R=S[2];Zs(I in i);const L=i[I].inboundNodes[C].outputTensors;g.push(L[R])}const w=t.outputLayers;for(const S of w){const I=S[0],C=S[1],R=S[2];Zs(I in i);const L=i[I].inboundNodes[C].outputTensors;y.push(L[R])}return new e({inputs:g,outputs:y,name:p})}get stateful(){if(this._stateful)throw new _("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){ee(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function eK(n,e,t){const r=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(s=>null);if(r===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==r)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const s=[];return e.forEach(i=>{i in n?s.push(n[i]):s.push(null)}),s}else throw new Error(`The model has multiple (${r}) outputs, so ${t} must be either an array with ${r} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function tS(n,e){return eK(n,e,"classWeight")}async function nS(n,e,t,r){if(t!=null){const s=ee(()=>{if(n.shape.length===1)return _i(n);if(n.shape.length===2){if(n.shape[1]>1)return dc(n,1);if(n.shape[1]===1)return q(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await s.data());et(s);const l=[];return i.forEach(u=>{if(t[u]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${u} exists in the data but not in classWeight`);l.push(t[u])}),hr(l,"float32")}else return null}function tK(n,e){return j(n,e)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const nK=32;function rS(n,e){let t,r;const s=e;t=s.xs,r=s.ys,T(t!=null&&r!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const i=sS("input",n.inputNames,t),l=sS("output",n.outputNames,r),u=i[0].shape[0];T(i.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),T(l.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${l.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let c=0;c<i.length;c++)T(i[c].shape[0]===u,()=>`Batch size mismatch: input ${n.inputNames[c]} has ${i[c].shape[0]}; expected  ${u} based on input ${n.inputNames[0]}.`);for(let c=0;c<l.length;c++)T(l[c].shape[0]===u,()=>`Batch size mismatch: output ${n.outputNames[c]} has ${l[c].shape[0]}; expected  ${u} based on input ${n.inputNames[0]}.`);return{xs:i,ys:l}}function sS(n,e,t){if(t instanceof an)return[t];if(Array.isArray(t))return T(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const r=[];for(const s of e){if(t[s]==null)throw new _(`The feature data generated by the dataset lacks the required ${n} key '${s}'.`);r.push(t[s])}return r}}function rK(n){if(n.length===3)throw new Qe("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function sK(n,e,t){const r=t.batchesPerEpoch!=null;if(T(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),T(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),T(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),T(!r||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),T(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const s=t.validationData!=null;let i,l;if(s)if(aS(t.validationData))T(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const S=rK(t.validationData);i=S.xs,l=S.ys}const u=n.makeTrainFunction(),c=n.getDedupedMetricsNames();let h;s?h=c.slice().concat(c.map(S=>"val_"+S)):h=c.slice();const p=ZI(t.callbacks,t.yieldEvery),m=t.verbose==null?1:t.verbose,{callbackList:g,history:y}=BI(p,m,t.epochs,null,null,aK(e,t),null,s,h);g.setModel(n),n.history=y,await g.onTrainBegin(),n.stopTraining_=!1;let v=t.initialEpoch==null?0:t.initialEpoch,w=await e.iterator();for(;v<t.epochs;){const S={};await g.onEpochBegin(v);let I=0,C=0;for(r||(w=await e.iterator());!r||I<t.batchesPerEpoch;){const R=await w.next();if(r&&R.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${I} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(R.value!=null){const{xs:L,ys:G}=rS(n,R.value),$={};$.batch=C,$.size=L[0].shape[0],await g.onBatchBegin(C,$);const F=[];if(t.classWeight!=null){const Z=tS(t.classWeight,n.outputNames);for(let ne=0;ne<Z.length;++ne)F.push(await nS(G[ne],null,Z[ne]))}const V=L.concat(G).concat(F),D=u(V);et(V);for(let Z=0;Z<c.length;++Z){const ne=c[Z],re=D[Z];$[ne]=re,Nr(re)}await g.onBatchEnd(C,$),AI($),C++,I++}if(r?I>=t.batchesPerEpoch:R.done){if(s){let L;aS(t.validationData)?L=pt(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):L=pt(n.evaluate(i,l,{batchSize:t.validationBatchSize==null?nK:t.validationBatchSize,verbose:0}));for(let G=0;G<n.metricsNames.length;++G)S[`val_${n.metricsNames[G]}`]=L[G]}break}if(n.stopTraining_)break}if(await g.onEpochEnd(v,S),v++,n.stopTraining_)break}return await g.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function aK(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function aS(n){return typeof n.iterator=="function"}function iK(n){return typeof n.next=="function"}async function oK(n,e,t){t=t||{};const r=t.batches!=null,s=n.testFunction;let i=[];if(t.verbose>0)throw new Qe("Verbose mode is not implemented yet.");T(!r||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const l=iK(e)?e:await e.iterator();let u=0,c=0;for(;!r||c<t.batches;){const h=await l.next();if(i=ee(()=>{if(h.value){const{xs:p,ys:m}=rS(n,h.value),g=p.concat(m),y=ee(()=>s(g));if(et(g),c===0)for(let w=0;w<y.length;++w)i.push(ht(0));const v=g[0].shape[0];for(let w=0;w<y.length;++w){const S=y[w],I=i[w];i[w]=ee(()=>ke(i[w],j(v,S))),c>0&&et(I)}et(y),u+=v,++c}return i}),h.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let h=0;h<i.length;++h){const p=i[h];i[h]=Ke(i[h],u),et(p)}return tr(i)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function my(n){T(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function Fc(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(r=>oo(r,e,t-e)):oo(n,e,t-e)}function gy(n,e){return ee(()=>n==null?null:Array.isArray(n)?n.map(t=>gy(t,e)):kI(n,e.dtype==="int32"?e:ze(e,"int32")))}function by(n,e){const t=[];let r=0,s=null;for(;r<n;)s=r+e,s>=n&&(s=n),t.push([r,s]),r=s;return t}function iS(n){const e=[];n instanceof an&&(n=[n]);for(let t=0;t<n.length;++t){const r=n[t];if(r.rank===1)e.push(Rc(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(r)}}return e}function vs(n,e){if(n==null)return;const t=[];if(e instanceof an)t.push(e.id);else if(Array.isArray(e))e.forEach(s=>t.push(s.id));else if(e!=null)for(const s in e){const i=e[s];t.push(i.id)}const r=[];if(n instanceof an)t.indexOf(n.id)===-1&&r.push(n);else if(Array.isArray(n))n.forEach(s=>{t.indexOf(s.id)===-1&&r.push(s)});else if(n!=null)for(const s in n){const i=n[s];t.indexOf(i.id)===-1&&r.push(i)}r.forEach(s=>{s.isDisposed||s.dispose()})}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function lK(n){return n instanceof an}function yy(n){return Array.isArray(n)}function oS(n){return!lK(n)&&!yy(n)}function lS(n,e,t,r=!0,s=""){if(e==null||e.length===0){if(n!=null){let l=!1;if(yy(n)&&n.length>0)l=!0;else if(oS(n)){for(const u in n)if(n.hasOwnProperty(u)){l=!0;break}}else l=!0;if(l)throw new _(`Error when checking model ${s} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(l=>null);let i;if(oS(n)){n=n,i=[];for(const l of e){if(n[l]==null)throw new _(`No data provided for "${l}". Need data for each key in: ${e}`);i.push(n[l])}}else if(yy(n)){if(n=n,n.length!==e.length)throw new _(`Error when checking model ${s}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);i=n}else{if(n=n,e.length>1)throw new _(`The model ${s} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);i=[n]}if(i=iS(i),t!=null)for(let l=0;l<e.length;++l){if(t[l]==null)continue;const u=i[l];if(u.shape.length!==t[l].length)throw new _(`Error when checking ${s}: expected ${e[l]} to have ${t[l].length} dimension(s). but got array with shape ${u.shape}`);for(let c=0;c<t[l].length;++c){if(c===0&&!r)continue;const h=u.shape[c],p=t[l][c];if(p!=null&&p>=0&&h!==p)throw new _(`${s} expected a batch of elements where each example has shape [${t[l].slice(1,t[l].length)}] (i.e.,tensor shape [*,${t[l].slice(1,t[l].length)}]) but the ${s} received an input with ${u.shape[0]} examples, each with shape [${u.shape.slice(1,u.shape.length)}] (tensor shape [${u.shape}])`)}}return i}function uK(n,e,t){const r=Ya(n.map(i=>i.shape[0]));r.sort();const s=Ya(e.map(i=>i.shape[0]));if(s.sort(),r.length>1)throw new _(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(i=>i.shape))}`);if(s.length>1)throw new _(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(i=>i.shape))}`);if(r.length>0&&s.length>0&&!B(r,s))throw new _(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${s[0]} target sample(s).`)}function cK(n,e,t){const r=[Dp,Kp,$c];for(let s=0;s<n.length;++s){const i=n[s],l=e[s],u=t[s];if(l!=null){if(l===$c&&i.shape[i.shape.length-1]===1)throw new _(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(r.indexOf(l)!==-1){const c=i.shape.slice(1),h=u.slice(1);for(let p=0;p<c.length;++p){const m=c[p],g=h[p];if(g!=null&&m!==g)throw new _(`A target Tensor with shape ${i.shape} was passed for an output of shape ${u}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function uS(n,e,t,r=!0,s=""){let i;if(Array.isArray(n)){if(n.length!==e.length)throw new _(`Error when checking model ${s}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);i=n}else{if(e.length>1)throw new _(`The model expects ${e.length} ${s} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);i=[n]}if(t!=null)for(let l=0;l<e.length;++l){if(t[l]==null)continue;const u=i[l];if(u.shape.length!==t[l].length)throw new _(`Error when checking ${s}: expected ${e[l]} to have ${t[l].length} dimension(s), but got array with shape ${JSON.stringify(u.shape)}`);for(let c=0;c<t[l].length;++c){if(c===0&&!r)continue;const h=u.shape[c],p=t[l][c];if(p!=null&&p!==h)throw new _(`Error when checking ${s}: expected ${e[l]} to have shape ${JSON.stringify(t[l])} but got array with shape ${JSON.stringify(u.shape)}.`)}}}function dK(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(r=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(r=>t);{const r=[];for(const s of e){let i=t.hasOwnProperty(s)?t[s]:[];Array.isArray(i)||(i=[i]),r.push(i)}return r}}const hK="layers-model";class ul extends xs{constructor(e){super(e),this.isTraining=!1}summary(e,t,r=console.log){if(!this.built)throw new _("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");UA(this,e,t,r)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=HA(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof ja))throw new _("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const l in e.loss)if(this.outputNames.indexOf(l)===-1)throw new _(`Unknown entry in loss dictionary: "${l}". Only expected the following keys: ${this.outputNames}`);for(const l of this.outputNames)e.loss[l]==null&&console.warn(`Output "${l}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${l} during training`),t.push(dy(e.loss[l]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new _(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(l=>dy(l))}else{const l=dy(e.loss);this.outputs.forEach(u=>{t.push(l)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let l=0;l<this.outputs.length;++l){const u=this.internalOutputShapes[l],c=this.outputNames[l];this.feedOutputNames.push(c),this.feedOutputShapes.push(u),this.feedLossFns.push(this.lossFunctions[l])}const r=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],io("loss",()=>{for(let l=0;l<this.outputs.length;++l){if(r.indexOf(l)!==-1)continue;const u=this.lossFunctions[l];this.outputs.length>1&&(this.metricsTensors.push([u,l]),this.metricsNames.push(this.outputNames[l]+"_loss"))}});const s=dK(e.metrics,this.outputNames),i=(l,u,c)=>{this.outputNames.length>1&&(u=this.outputNames[l]+"_"+u),this.metricsNames.push(u),this.metricsTensors.push([c,l])};io("metric",()=>{for(let l=0;l<this.outputs.length;++l){if(r.indexOf(l)!==-1)continue;const u=s[l];(c=>{const h="";let p,m,g;for(const y of c){if(typeof y=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(y)!==-1){const w=this.internalOutputShapes[l];w[w.length-1]===1||this.lossFunctions[l]===Kp?["accuracy","acc"].indexOf(y)!==-1?m=HI:["crossentropy","ce"].indexOf(y)!==-1&&(m=VA):this.lossFunctions[l]===Ap?["accuracy","acc"].indexOf(y)!==-1?m=PA:["crossentropy","ce"].indexOf(y)!==-1&&(m=YI):["accuracy","acc"].indexOf(y)!==-1?m=UI:["crossentropy","ce"].indexOf(y)!==-1&&(m=jI);let S;["accuracy","acc"].indexOf(y)!==-1?S="acc":["crossentropy","ce"].indexOf(y)!==-1&&(S="ce"),g=m,p=h+S}else g=_A(y),p=h+_p(y);let v;io(p,()=>{v=g}),i(l,p,v)}})(u)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,r={}){const s=r.batchSize==null?32:r.batchSize;my(s);const i=this.standardizeUserDataXY(e,t,!0,s);try{const l=i[0].concat(i[1]);this.makeTestFunction();const u=this.testFunction,c=this.testLoop(u,l,s,r.verbose,r.steps);return tr(c)}finally{vs(i[0],e),vs(i[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),oK(this,e,t)}checkNumSamples(e,t,r,s="steps"){let i;if(r!=null){if(i=null,t!=null)throw new _(`If ${s} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?i=e[0].shape[0]:i=e.shape[0];else throw new _(`Either the input data should have a defined shape, or ${s} shoud be specified.`);return i}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new _("`outputs` is an empty Array, which is not allowed.");const r=Array.isArray(t),s=r?t:[t],i=this.retrieveSymbolicTensors(s),l=new qa;if(e instanceof an&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new _(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let c=0;c<this.inputs.length;++c)l.add(this.inputs[c],e[c])}else for(const c of this.inputs){const h=e[c.name];if(h==null)throw new _(`No value is provided for the model's input ${c.name}`);l.add(c,h)}const u=zc(i,l);return r?u:u[0]}retrieveSymbolicTensors(e){const t=ro(null,e.length);let r=e.length;for(const s of this.layers){const i=Array.isArray(s.output)?s.output:[s.output],l=i.map(u=>u.name);for(let u=0;u<e.length;++u){const c=l.indexOf(e[u]);if(c!==-1&&(t[u]=i[c],r--),r===0)break}if(r===0)break}if(r>0){const s=[];throw t.forEach((i,l)=>{i==null&&s.push(e[l])}),new _(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(s)}`)}return t}predictLoop(e,t=32,r=!1){return ee(()=>{const s=this.checkNumSamples(e);if(r)throw new Qe("Verbose predictLoop() is not implemented yet.");const i=by(s,t),l=this.outputs.map(u=>[]);for(let u=0;u<i.length;++u)ee(()=>{const c=i[u][0],h=i[u][1],p=Fc(e,c,h),m=[];if(Array.isArray(p))for(let y=0;y<p.length;++y)m.push({key:this.inputs[y],value:p[y]});else m.push({key:this.inputs[0],value:p});const g=new qa(m);return zc(this.outputs,g)}).forEach((c,h)=>l[h].push(c));return tr(l.map(u=>qn(u,0)))})}predict(e,t={}){const r=iS(e);uS(r,this.inputNames,this.feedInputShapes,!1);try{const s=t.batchSize==null?32:t.batchSize;return my(s),this.predictLoop(r,s)}finally{vs(r,e)}}predictOnBatch(e){uS(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,r=!0,s){if(this.optimizer_==null)throw new jr("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let l=0;l<this.feedOutputShapes.length;++l){const u=this.feedOutputShapes[l];this.feedLossFns[l]===Ap?i.push(u.slice(0,u.length-1).concat([1])):i.push(u)}if(e=lS(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=lS(t,this.feedOutputNames,i,!1,"target"),uK(e,t),cK(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&s!=null&&s>0&&e[0].shape[0]%s!==0)throw new _(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${s}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,r,s,i=!0,l){const[u,c]=this.standardizeUserDataXY(e,t,i,l);if(r!=null)throw new Error("sample weight is not supported yet.");let h=null;if(s!=null){const p=tS(s,this.outputNames);h=[];for(let m=0;m<p.length;++m)h.push(await nS(c[m],null,p[m]))}return[u,c,h]}testLoop(e,t,r,s=0,i){return ee(()=>{const l=this.checkNumSamples(t,r,i,"steps"),u=[];if(s>0)throw new Qe("Verbose mode is not implemented yet.");if(i!=null)throw new Qe("steps mode in testLoop() is not implemented yet");{const c=by(l,r),h=hr(gs(0,l));for(let p=0;p<c.length;++p){const m=c[p][0],g=c[p][1],y=oo(h,m,g-m),v=gy(t,y),w=e(v);if(p===0)for(let S=0;S<w.length;++S)u.push(ht(0));for(let S=0;S<w.length;++S){const I=w[S];u[S]=ke(u[S],j(g-m,I))}}for(let p=0;p<u.length;++p)u[p]=Ke(u[p],l)}return u})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let r=0;r<e.length;++r){const s=e[r];let i=s;if(hI(e,s)>1){const l=hI(e.slice(0,r),s);i+=`_${l}`}t.push(i)}return t}makeTrainFunction(){return e=>{const t=[],r=e.slice(0,this.inputs.length),s=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),l=[],u=()=>{const h=[];for(let y=0;y<this.inputs.length;++y)h.push({key:this.inputs[y],value:r[y]});const p=new qa(h),m=zc(this.outputs,p,{training:!0});let g;for(let y=0;y<this.lossFunctions.length;++y){const v=this.lossFunctions[y];let w=v(s[y],m[y]);i[y]!=null&&(w=tK(w,i[y]));const S=rn(w);t.push(S),y===0?g=w:g=ke(g,w)}for(let y=0;y<this.metricsTensors.length;++y){let v;if(this.outputs.length>1&&y<this.outputs.length)v=t[y];else{const w=this.metricsTensors[y][0],S=this.metricsTensors[y][1];v=rn(w(s[S],m[S]))}Nr(v),l.push(v)}return g=rn(g),this.calculateLosses().forEach(y=>{g=ke(g,y)}),g},c=this.collectedTrainableWeights.map(h=>h.read());return[this.optimizer_.minimize(u,!0,c)].concat(l)}}makeTestFunction(){this.testFunction=e=>ee(()=>{const t=[];let r;const s=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),l=[];for(let h=0;h<this.inputs.length;++h)l.push({key:this.inputs[h],value:s[h]});const u=new qa(l),c=zc(this.outputs,u);for(let h=0;h<this.lossFunctions.length;++h){const p=this.lossFunctions[h],m=rn(p(i[h],c[h]));h===0?r=m:r=ke(r,m),t.push(r)}for(let h=0;h<this.metricsTensors.length;++h){const p=this.metricsTensors[h][0],m=this.metricsTensors[h][1],g=rn(p(i[m],c[m]));t.push(g)}return t})}async fit(e,t,r={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let s,i,l,u,c,h,p,m,g;try{const y=r.batchSize==null?32:r.batchSize;my(y);const v=await this.standardizeUserData(e,t,r.sampleWeight,r.classWeight,!1,y);s=v[0],i=v[1],g=v[2];let w=!1,S;if(r.validationData!=null&&r.validationData.length>0){if(w=!0,r.validationData.length===2)c=r.validationData[0],h=r.validationData[1];else throw r.validationData.length===3?new Qe("validationData including sample weights is not supported yet."):new _(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${r.validationData} is invalid.`);const F=await this.standardizeUserData(c,h,null,null,!0,y);p=F[0],m=F[1],S=p.concat(m)}else if(r.validationSplit!=null&&r.validationSplit>0&&r.validationSplit<1){w=!0;const F=Math.floor(s[0].shape[0]*(1-r.validationSplit)),V=s[0].shape[0];p=Fc(s,F,V),l=s,s=Fc(s,0,F),m=Fc(i,F,V),u=i,i=Fc(i,0,F),S=p.concat(m)}else r.validationSteps!=null&&(w=!0);const I=s.concat(i).concat(g);this.checkTrainableWeightsConsistency();const C=this.makeTrainFunction(),R=this.getDedupedMetricsNames();let L,G;w?(this.makeTestFunction(),L=this.testFunction,G=R.slice().concat(R.map(F=>"val_"+F))):(L=null,S=[],G=R.slice());const $=ZI(r.callbacks,r.yieldEvery);return await this.fitLoop(C,I,R,y,r.epochs,r.verbose,$,L,S,r.shuffle,G,r.initialEpoch,null,null)}finally{this.isTraining=!1,vs(s,e),vs(i,t),vs(l,e),vs(u,t),vs(p,c),vs(m,h),g!=null&&et(g)}}async fitLoop(e,t,r,s,i,l,u,c,h,p,m,g,y,v){s==null&&(s=32),i==null&&(i=1),p==null&&(p=!0),g==null&&(g=0);let w=!1;if(c!=null&&h!=null&&(w=!0),v!=null&&(w=!0,y==null))throw new _("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const S=this.checkNumSamples(t,s,y,"steps_per_epoch");let I;S!=null&&(I=gs(0,S)),l==null&&(l=1);const{callbackList:C,history:R}=BI(u,l,i,g,S,y,s,w,m);C.setModel(this),this.history=R,await C.onTrainBegin(),this.stopTraining_=!1;for(let L=g;L<i;++L){await C.onEpochBegin(L);const G={};if(y!=null)throw new Qe("stepsPerEpoch mode is not implemented yet.");{if(p==="batch")throw new Qe("batch shuffling is not implemneted yet");p&&k(I);const $=hr(I),F=by(S,s);for(let V=0;V<F.length;++V){const D={};if(await C.onBatchBegin(V,D),ee(()=>{const Z=F[V][0],ne=F[V][1],re=oo($,Z,ne-Z);D.batch=V,D.size=ne-Z;const se=gy(t,re),ue=e(se);for(let le=0;le<r.length;++le){const he=r[le],me=ue[le];D[he]=me,Nr(me)}if(V===F.length-1&&w){const le=this.testLoop(c,h,s);for(let he=0;he<r.length;++he){const me=r[he],pe=le[he];Nr(pe),G["val_"+me]=pe}}}),await C.onBatchEnd(V,D),AI(D),this.stopTraining_)break}$.dispose()}if(await C.onEpochEnd(L,G),this.stopTraining_)break}return await C.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return sK(this,e,t)}async trainOnBatch(e,t){const r=await this.standardizeUserData(e,t),s=r[0],i=r[1],l=this.makeTrainFunction()(s.concat(i)),u=[];for(const c of l){const h=await c.data();u.push(h[0])}return et(l),vs(r[0],e),vs(r[1],t),tr(u)}getNamedWeights(e){const t=[],r=e!=null&&e.trainableOnly,s=r?this.trainableWeights:this.weights,i=this.getWeights(r);for(let l=0;l<s.length;++l)r&&!s[l].trainable||t.push({name:s[l].originalName,tensor:i[l]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=N0().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-N0().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=ya(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>ya(t))}else{const t=Object.keys(this.loss);e={};const r=this.loss;for(const s of t)if(typeof r[s]=="string")e[s]=ya(r[s]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[ya(_p(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>ya(_p(e)));{const e={};for(const t in this.metrics)e[t]=ya(_p(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=py(e.optimizer_config),r=va(t);let s;if(typeof e.loss=="string")s=so(e.loss);else if(Array.isArray(e.loss))s=e.loss.map(l=>so(l));else if(e.loss!=null){s={};for(const l in e.loss)s[l]=so(e.loss[l])}let i;if(Array.isArray(e.metrics))i=e.metrics.map(l=>so(l));else if(e.metrics!=null){i={};for(const l in e.metrics)i[l]=so(e.metrics[l])}this.compile({loss:s,metrics:i,optimizer:r})}async save(e,t){if(typeof e=="string"){const i=_W(e);if(i.length===0)throw new _(`Cannot find any save handlers for URL '${e}'`);if(i.length>1)throw new _(`Found more than one (${i.length}) save handlers for URL '${e}'`);e=i[0]}if(e.save==null)throw new _("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const r=await yk(this.getNamedWeights(t)),s={modelTopology:this.toJSON(null,!1),format:hK,generatedBy:`TensorFlow.js tfjs-layers v${eS}`,convertedBy:null};if(t!=null&&t.includeOptimizer&&this.optimizer!=null){s.trainingConfig=this.getTrainingConfig();const i="optimizer",{data:l,specs:u}=await yk(await this.optimizer.getWeights(),i);r.specs.push(...u),r.data=BW([r.data,l])}return this.userDefinedMetadata!=null&&(JI(this.userDefinedMetadata,this.name,!0),s.userDefinedMetadata=this.userDefinedMetadata),s.weightData=r.data,s.weightSpecs=r.specs,e.save(s)}setUserDefinedMetadata(e){JI(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}ul.className="Model",xe(ul);class cS extends ul{}cS.className="Functional",xe(cS);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class Vc extends ul{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:zp("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(t=>t<0))throw new _(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof Vc||e instanceof ul;let r;if(t){if(r=e,r.outputs.length!==1)throw new _("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(r.inputs.length!==1)throw new _("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new _("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const s=mA({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(s)}if(t)this.outputs=r.outputs,this.inputs=r.inputs;else{if(e.inboundNodes.length!==1)throw new _(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new _("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=MI(this.outputs[0])}this.inboundNodes=[],new Vp({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:ro(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(s=>s.shape),outputShapes:this.outputs[0].shape})}else{const s=e.apply(this.outputs[0]);if(Array.isArray(s))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[s],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(ot(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new ul({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,r=console.log){this.built||this.build(),super.summary(e,t,r)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,r={}){if(!this.built)throw new jr("The model needs to be compiled before being used.");return this.model.evaluate(e,t,r)}async evaluateDataset(e,t){if(!this.built)throw new jr("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,r={}){if(!this.built)throw new jr("The model needs to be compiled before being used.");return this.model.fit(e,t,r)}async fitDataset(e,t){if(!this.built)throw new jr("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,r={},s=!1){let i,l={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new _("Legacy serialization format not supported yet.");i=t}else T(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),i=t.layers,delete t.layers,l=t;const u=new e(l);if(!(u instanceof Vc))throw new Qe(`Sequential.fromConfig called on non-Sequential input: ${u}`);for(const c of i){const h=va(c,void 0,s);s&&h.setFastWeightInitDuringBuild(!0),u.add(h)}return u}set stopTraining(e){if(this.model==null)throw new _("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new _("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const r={};r.className=t.getClassName(),r.config=t.getConfig(),e.push(r)}return{name:this.name,layers:e}}}Vc.className="Sequential",xe(Vc);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/let nr=class extends al{getConfig(){return{}}};class dS extends nr{apply(e,t=1){return qD(e,t)}}dS.className="elu",xe(dS);class hS extends nr{apply(e){return t2(e)}}hS.className="selu",xe(hS);class pS extends nr{apply(e){return Ji(e)}}pS.className="relu",xe(pS);class fS extends nr{apply(e){return ee(()=>yc(6,Ji(e)))}}fS.className="relu6",xe(fS);class mS extends nr{apply(e){return e}}mS.className="linear",xe(mS);class gS extends nr{apply(e){return qo(e)}}gS.className="sigmoid",xe(gS);class bS extends nr{apply(e){return tA(e)}}bS.className="hardSigmoid",xe(bS);class yS extends nr{apply(e){return bc(e)}}yS.className="softplus",xe(yS);class xS extends nr{apply(e){return eA(e)}}xS.className="softsign",xe(xS);class vS extends nr{apply(e){return V0(e)}}vS.className="tanh",xe(vS);let xy=class extends nr{apply(n,e=-1){return nb(n,e)}};xy.className="softmax",xe(xy);class wS extends nr{apply(e,t=-1){return Ok(e,t)}}wS.className="logSoftmax",xe(wS);class kS extends nr{apply(e,t=1){return ee(()=>j(qo(j(e,t)),e))}}kS.className="swish",xe(kS);class IS extends nr{apply(e){return ee(()=>j(e,V0(bc(e))))}}IS.className="mish",xe(IS);function ei(n){return n.getClassName()}function vy(n,e={}){return Tc(n,Ur.getMap().classNameMap,e,"activation")}function ti(n){if(n==null){const e={};return e.className="linear",e.config={},vy(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},vy(e)}else return n instanceof nr?n:vy(n)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function pK(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class SS extends al{}class CS extends SS{constructor(e){super(),pK(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return ee(()=>{let t=gn([1]);return this.hasL1&&(t=ke(t,Xe(j(this.l1,Pn(e))))),this.hasL2&&(t=ke(t,Xe(j(this.l2,Ec(e))))),q(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}CS.className="L1L2",xe(CS);const TS={l1l2:"L1L2"};function yt(n){return Zb(n)}function NS(n,e={}){return Tc(n,Ur.getMap().classNameMap,e,"regularizer")}function Mt(n){if(n==null)return null;if(typeof n=="string"){const e={className:n in TS?TS[n]:n,config:{}};return NS(e)}else return n instanceof SS?n:NS(n)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class RS extends qe{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=Be(e);let r=Ji(e);return this.maxValue!=null&&(r=Rr(r,0,this.maxValue)),r}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}RS.className="ReLU",xe(RS);class ES extends qe{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const r=Be(e);return _0(r,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}ES.className="LeakyReLU",xe(ES);class LS extends qe{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Wt(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Mt(e.alphaRegularizer),this.alphaConstraint=dn(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new _(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=ot(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const s of this.sharedAxes)t[s-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const r={};if(this.sharedAxes!=null)for(let s=1;s<e.length;++s)r[s]=e[s];this.inputSpec=[new un({ndim:e.length,axes:r})],this.built=!0}call(e,t){return e=Be(e),J0(e,this.alpha.read())}getConfig(){const e={alphaInitializer:Ot(this.alphaInitializer),alphaRegularizer:yt(this.alphaRegularizer),alphaConstraint:cn(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}LS.className="PReLU",xe(LS);let GS=class extends qe{constructor(n){if(super(n??{}),this.DEFAULT_ALPHA=1,n==null&&(n={}),n.alpha!=null&&n.alpha!==this.DEFAULT_ALPHA)throw new Qe(`Non-default alpha value (${n.alpha}) is not supported by the ELU layer yet.`);this.alpha=n.alpha==null?this.DEFAULT_ALPHA:n.alpha}call(n,e){const t=Be(n);return bp(t)}computeOutputShape(n){return n}getConfig(){const n={alpha:this.alpha},e=super.getConfig();return Object.assign(n,e),n}};GS.className="ELU",xe(GS);class zS extends qe{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const r=Be(e);return j(r,ze(Er(r,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}zS.className="ThresholdedReLU",xe(zS);class WS extends qe{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new xy().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return ee(()=>{let r=Be(e);const s=t.mask;if(s!=null){const i=j(Ze(Ua(r.shape),ze(s,r.dtype)),ht(-1e9));r=ke(r,i)}return this.axis instanceof Array?this.axis.length>1?Xs(Ze(r,Dk(r,this.axis,!0))):this.softmax(r,this.axis[0]):this.softmax(r,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}WS.className="Softmax",xe(WS);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function cl(n,e,t){if(typeof n=="number")return ro(n,e);if(n.length!==e)throw new _(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let r=0;r<e;++r){const s=n[r];if(!jD(s))throw new _(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${s}`)}return n}function ws(n,e,t,r,s=1){if(n==null)return n;const i=e+(e-1)*(s-1);let l;return t==="same"?l=n:l=n-i+1,Math.floor((l+r-1)/r)}function Hs(n,e,t,r){if(n==null)return null;if(r==="valid")n=n*e+Ja([t-e,0]);else if(r==="same")n=n*e;else throw new _(`Unsupport padding mode: ${r}.`);return n}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function wy(n,e){return ee(()=>(Jt(e),e==="channelsFirst"?at(n,[0,2,3,1]):n))}function MS(n,e){return ee(()=>(Jt(e),e==="channelsFirst"?at(n,[0,2,3,4,1]):n))}function fK(n,e,t,r=1,s="valid",i,l=1){return ee(()=>{if(i==null&&(i=bs()),Jt(i),n.shape.length!==3)throw new _(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new _(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new _(`The bias for a conv1dWithBias operation should be 1, but is ${e.shape.length} instead`);if(i==="channelsFirst"&&(n=at(n,[0,2,1])),s==="causal")throw new Qe("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let u=Lk(n,e,r,s==="same"?"same":"valid","NWC",l);return t!=null&&(u=ys(u,t)),u})}function $S(n,e,t,r=[1,1],s="valid",i,l,u=null){return ee(()=>{if(i==null&&(i=bs()),Jt(i),n.rank!==3&&n.rank!==4)throw new _(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new _(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let c=wy(n,i);if(s==="causal")throw new Qe("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return c=kP({x:c,filter:e,strides:r,pad:s==="same"?"same":"valid",dilations:l,dataFormat:"NHWC",bias:t,activation:u}),i==="channelsFirst"&&(c=at(c,[0,3,1,2])),c})}function mK(n,e,t,r=[1,1,1],s="valid",i,l){return ee(()=>{if(i==null&&(i=bs()),Jt(i),n.rank!==4&&n.rank!==5)throw new _(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new _(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let u=MS(n,i);if(s==="causal")throw new Qe("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return u=w$(u,e,r,s==="same"?"same":"valid","NDHWC",l),t!=null&&(u=ys(u,t)),i==="channelsFirst"&&(u=at(u,[0,4,1,2,3])),u})}class Up extends qe{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Up.verifyArgs(t),this.rank=e,bn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Qe(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=cl(t.kernelSize,e,"kernelSize"),this.strides=cl(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,Gr(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Jt(this.dataFormat),this.activation=ti(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=Wt(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=dn(t.biasConstraint),this.biasRegularizer=Mt(t.biasRegularizer),this.activityRegularizer=Mt(t.activityRegularizer),this.dilationRate=cl(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new _(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new _(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new _(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(Zs("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!_b(e.kernelSize,"number",1,3))throw new _(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:ei(this.activation),useBias:this.useBias,biasInitializer:Ot(this.biasInitializer),biasRegularizer:yt(this.biasRegularizer),activityRegularizer:yt(this.activityRegularizer),biasConstraint:cn(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class dl extends Up{constructor(e,t){super(e,t),this.kernel=null,dl.verifyArgs(t),this.filters=t.filters,bn(this.filters,"filters"),this.kernelInitializer=Wt(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=dn(t.kernelConstraint),this.kernelRegularizer=Mt(t.kernelRegularizer)}build(e){e=ot(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new _(`The channel dimension of the input should be defined. Found ${e[t]}`);const r=e[t],s=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",s,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:r}}],this.built=!0}call(e,t){return ee(()=>{e=Be(e);let r;const s=this.bias==null?null:this.bias.read(),i=fI(this.activation.getClassName());if(i!=null&&this.rank===2)r=$S(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)r=fK(e,this.kernel.read(),s,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)r=$S(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)r=mK(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Qe("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(r=this.activation.apply(r))}return r})}computeOutputShape(e){e=ot(e);const t=[],r=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let i=0;i<r.length;++i){const l=ws(r[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);t.push(l)}let s=[e[0]];return this.dataFormat==="channelsLast"?(s=s.concat(t),s.push(this.filters)):(s.push(this.filters),s=s.concat(t)),s}getConfig(){const e={filters:this.filters,kernelInitializer:Ot(this.kernelInitializer),kernelRegularizer:yt(this.kernelRegularizer),kernelConstraint:cn(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new _(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Pc extends dl{constructor(e){super(2,e),Pc.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!_b(e.kernelSize,"number",1,2))throw new _(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Pc.className="Conv2D",xe(Pc);class Xc extends dl{constructor(e){super(3,e),Xc.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new _(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}Xc.className="Conv3D",xe(Xc);class FS extends Pc{constructor(e){if(super(e),this.inputSpec=[new un({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new _(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=ot(e),e.length!==4)throw new _("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new _("The channel dimension of the inputs should be defined. Found `None`.");const r=e[t],s=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",s,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new un({ndim:4,axes:{[t]:r}})],this.built=!0}call(e,t){return ee(()=>{let r=Be(e);if(r.shape.length!==4)throw new _(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const s=r.shape,i=s[0];let l,u;this.dataFormat==="channelsFirst"?(l=2,u=3):(l=1,u=2);const c=s[l],h=s[u],p=this.kernelSize[0],m=this.kernelSize[1],g=this.strides[0],y=this.strides[1],v=Hs(c,g,p,this.padding),w=Hs(h,y,m,this.padding),S=[i,v,w,this.filters];this.dataFormat!=="channelsLast"&&(r=at(r,[0,2,3,1]));let I=Gk(r,this.kernel.read(),S,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(I=at(I,[0,3,1,2])),this.bias!=null&&(I=ys(I,this.bias.read(),this.dataFormat)),this.activation!=null&&(I=this.activation.apply(I)),I})}computeOutputShape(e){e=ot(e);const t=e.slice();let r,s,i;this.dataFormat==="channelsFirst"?(r=1,s=2,i=3):(r=3,s=1,i=2);const l=this.kernelSize[0],u=this.kernelSize[1],c=this.strides[0],h=this.strides[1];return t[r]=this.filters,t[s]=Hs(t[s],c,l,this.padding),t[i]=Hs(t[i],h,u,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}FS.className="Conv2DTranspose",xe(FS);class VS extends Xc{constructor(e){if(super(e),this.inputSpec=[new un({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new _(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=ot(e),e.length!==5)throw new _("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new _("The channel dimension of the inputs should be defined. Found `None`.");const r=e[t],s=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",s,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new un({ndim:5,axes:{[t]:r}})],this.built=!0}call(e,t){return ee(()=>{let r=Be(e);if(r.shape.length!==5)throw new _(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const s=r.shape,i=s[0];let l,u,c;this.dataFormat==="channelsFirst"?(c=2,l=3,u=4):(c=1,l=2,u=3);const h=s[c],p=s[l],m=s[u],g=this.kernelSize[0],y=this.kernelSize[1],v=this.kernelSize[2],w=this.strides[0],S=this.strides[1],I=this.strides[2],C=Hs(h,w,g,this.padding),R=Hs(p,S,y,this.padding),L=Hs(m,I,v,this.padding),G=[i,C,R,L,this.filters];this.dataFormat!=="channelsLast"&&(r=at(r,[0,2,3,4,1]));let $=S$(r,this.kernel.read(),G,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&($=at($,[0,4,1,2,3])),this.bias!==null&&($=ys($,this.bias.read(),this.dataFormat)),this.activation!==null&&($=this.activation.apply($)),$})}computeOutputShape(e){e=ot(e);const t=e.slice();let r,s,i,l;this.dataFormat==="channelsFirst"?(r=1,s=2,i=3,l=4):(r=4,s=1,i=2,l=3);const u=this.kernelSize[0],c=this.kernelSize[1],h=this.kernelSize[2],p=this.strides[0],m=this.strides[1],g=this.strides[2];return t[r]=this.filters,t[s]=Hs(t[s],p,u,this.padding),t[i]=Hs(t[i],m,c,this.padding),t[l]=Hs(t[l],g,h,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}VS.className="Conv3DTranspose",xe(VS);class PS extends dl{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new _("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new _("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new _(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=Wt(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Mt(t.depthwiseRegularizer),this.depthwiseConstraint=dn(t.depthwiseConstraint),this.pointwiseInitializer=Wt(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Mt(t.pointwiseRegularizer),this.pointwiseConstraint=dn(t.pointwiseConstraint)}build(e){if(e=ot(e),e.length<this.rank+2)throw new _(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new _(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const r=e[t],s=this.kernelSize.concat([r,this.depthMultiplier]),i=[];for(let u=0;u<this.rank;++u)i.push(1);i.push(r*this.depthMultiplier,this.filters);const l=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",s,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,l,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,l,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,l,this.biasConstraint):this.bias=null,this.inputSpec=[new un({ndim:this.rank+2,axes:{[t]:r}})],this.built=!0}call(e,t){return ee(()=>{e=Be(e);let r;if(this.rank===1)throw new Qe("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=at(e,[0,2,3,1])),r=n2(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(r=ys(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),this.dataFormat==="channelsFirst"&&(r=at(r,[0,3,1,2])),r})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Ot(this.depthwiseInitializer),e.pointwiseInitializer=Ot(this.pointwiseInitializer),e.depthwiseRegularizer=yt(this.depthwiseRegularizer),e.pointwiseRegularizer=yt(this.pointwiseRegularizer),e.depthwiseConstraint=cn(this.depthwiseConstraint),e.pointwiseConstraint=cn(this.pointwiseConstraint),e}}PS.className="SeparableConv";class XS extends PS{constructor(e){super(2,e)}}XS.className="SeparableConv2D",xe(XS);class jp extends dl{constructor(e){super(1,e),jp.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!_b(e.kernelSize,"number",1,1))throw new _(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}jp.className="Conv1D",xe(jp);class OS extends qe{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return ee(()=>{if(e=Be(e),this.dataFormat==="channelsLast"){const r=Wp(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Wp(r,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const r=Wp(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Wp(r,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}OS.className="Cropping2D",xe(OS);class DS extends qe{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Jt(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,_D(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],r=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,r]}else{const t=e[1]==null?null:this.size[0]*e[1],r=e[2]==null?null:this.size[1]*e[2];return[e[0],t,r,e[3]]}}call(e,t){return ee(()=>{let r=Be(e);const s=r.shape;if(this.dataFormat==="channelsFirst"){r=at(r,[0,2,3,1]);const i=this.size[0]*s[2],l=this.size[1]*s[3],u=this.interpolation==="nearest"?ma.resizeNearestNeighbor(r,[i,l]):ma.resizeBilinear(r,[i,l]);return at(u,[0,3,1,2])}else{const i=this.size[0]*s[1],l=this.size[1]*s[2];return this.interpolation==="nearest"?ma.resizeNearestNeighbor(r,[i,l]):ma.resizeBilinear(r,[i,l])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}DS.className="UpSampling2D",xe(DS);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function gK(n,e,t=[1,1],r="valid",s,i){return ee(()=>{s==null&&(s=bs()),Jt(s);let l=wy(n,s);if(n.rank!==4)throw new _(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new _(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return l=A0(l,e,t,r==="same"?"same":"valid","NHWC",i),s==="channelsFirst"&&(l=at(l,[0,3,1,2])),l})}class AS extends Up{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=Wt(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=dn(e.depthwiseConstraint),this.depthwiseRegularizer=Mt(e.depthwiseRegularizer)}build(e){if(e=ot(e),e.length<4)throw new _(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new _(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const r=e[t],s=[this.kernelSize[0],this.kernelSize[1],r,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",s,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[r*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ee(()=>{e=Be(e);let r=gK(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(r=ys(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),r})}computeOutputShape(e){e=ot(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2],s=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=ws(t,this.kernelSize[0],this.padding,this.strides[0]),l=ws(r,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],s,i,l]:[e[0],i,l,s]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Ot(this.depthwiseInitializer),e.depthwiseRegularizer=yt(this.depthwiseRegularizer),e.depthwiseConstraint=cn(this.depthwiseRegularizer),e}}AS.className="DepthwiseConv2D",xe(AS);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function KS(n,e,t,r){if(Array.isArray(n)){if(e!=null||t!=null)throw new _("When inputs is an array, neither initialState or constants should be provided");r!=null&&(t=n.slice(n.length-r,n.length),n=n.slice(0,n.length-r)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function s(i){return i==null||Array.isArray(i)?i:[i]}return e=s(e),t=s(t),{inputs:n,initialState:e,constants:t}}function ZS(n,e,t,r=!1,s,i,l=!1,u=!1){return ee(()=>{const c=e.shape.length;if(c<3)throw new _(`Input should be at least 3D, but is ${c}D.`);const h=[1,0].concat(gs(2,c));e=at(e,h),i!=null,l&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),s!=null&&(s=ze(ze(s,"bool"),"float32"),s.rank===c-1&&(s=er(s,-1)),s=at(s,h)),r&&(e=qi(e,0),s!=null&&(s=qi(s,0)));const p=[];let m,g=t;const y=e.shape[0],v=to(e);let w;s!=null&&(w=to(s));for(let I=0;I<y;++I){const C=v[I],R=ee(()=>n(C,g));if(s==null)m=R[0],g=R[1];else{const L=ee(()=>{const G=w[I],$=Ze(Hr(G),G),F=ke(j(R[0],G),j(g[0],$)),V=g.map((D,Z)=>ke(j(R[1][Z],G),j(D,$)));return{output:F,newStates:V}});m=L.output,g=L.newStates}u&&p.push(m)}let S;return u&&(S=Ds(p,1)),[m,S,g]})}class ni extends qe{constructor(e){super(e);let t;if(e.cell==null)throw new _("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new Sy({cells:e.cell}):t=e.cell,t.stateSize==null)throw new _("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new un({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return gs(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){ay(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const r=t[0];let s;if(this.returnSequences?s=[e[0],e[1],r]:s=[e[0],r],this.returnState){const i=[];for(const l of t)i.push([e[0],l]);return[s].concat(i)}else return s}computeMask(e,t){return ee(()=>{Array.isArray(t)&&(t=t[0]);const r=this.returnSequences?t:null;if(this.returnState){const s=this.states.map(i=>null);return[r].concat(s)}else return r})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let r=0;r<e;++r)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new Qe("Constants support is not implemented in RNN yet.");ay(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,r=e.slice(2);this.inputSpec[0]=new un({shape:[t,null,...r]});const s=[e[0]].concat(e.slice(2));this.cell.build(s);let i;if(Array.isArray(this.cell.stateSize)?i=this.cell.stateSize:i=[this.cell.stateSize],this.stateSpec!=null){if(!B(this.stateSpec.map(l=>l.shape[l.shape.length-1]),i))throw new _(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map(l=>new un({shape:[null,l]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){ee(()=>{if(!this.stateful)throw new Ks("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape[0];if(r==null)throw new _("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(s=>gn([r,s])):this.states_=[gn([r,this.cell.stateSize])];else if(e==null)et(this.states_),this.keptStates!=null&&(et(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(s=>gn([r,s])):this.states_[0]=gn([r,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new _(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):et(this.states_);for(let s=0;s<this.states_.length;++s){const i=e[s],l=Array.isArray(this.cell.stateSize)?this.cell.stateSize[s]:this.cell.stateSize,u=[r,l];if(!B(i.shape,u))throw new _(`State ${s} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${i.shape}`);this.states_[s]=i}}this.states_=this.states_.map(s=>Nr(s.clone()))})}apply(e,t){let r=t==null?null:t.initialState,s=t==null?null:t.constants;t==null&&(t={});const i=KS(e,r,s,this.numConstants);e=i.inputs,r=i.initialState,s=i.constants;let l=[],u=[];if(r!=null){t.initialState=r,l=l.concat(r),this.stateSpec=[];for(const c of r)this.stateSpec.push(new un({shape:c.shape}));u=u.concat(this.stateSpec)}if(s!=null&&(t.constants=s,l=l.concat(s),this.numConstants=s.length),l[0]instanceof _s){const c=[e].concat(l),h=this.inputSpec.concat(u),p=this.inputSpec;this.inputSpec=h;const m=super.apply(c,t);return this.inputSpec=p,m}else return super.apply(e,t)}call(e,t){return ee(()=>{const r=t==null?null:t.mask,s=t==null?null:t.training;let i=t==null?null:t.initialState;e=Be(e),i==null&&(this.stateful?i=this.states_:i=this.getInitialState(e));const l=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==l)throw new _(`RNN Layer has ${l} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const u={training:s},c=ZS((y,v)=>{const w=this.cell.call([y].concat(v),u);return[w[0],w.slice(1)]},e,i,this.goBackwards,r,null,this.unroll,this.returnSequences),h=c[0],p=c[1],m=c[2];this.stateful&&this.resetStates(m,s);const g=this.returnSequences?p:h;return this.returnState?[g].concat(m):g})}getInitialState(e){return ee(()=>{let t=gn(e.shape);return t=Xe(t,[1,2]),t=Rc(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(r=>r>1?Yb(t,[1,r]):t):this.cell.stateSize>1?[Yb(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const r=this.cell.getConfig();return this.getClassName()===ni.className&&(t.cell={className:this.cell.getClassName(),config:r}),Object.assign(Object.assign(Object.assign({},r),e),t)}static fromConfig(e,t,r={}){const s=t.cell,i=va(s,r);return new e(Object.assign(t,{cell:i}))}}ni.className="RNN",xe(ni);class Yp extends qe{}class ky extends Yp{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,bn(this.units,"units"),this.activation=ti(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Wt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Wt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Wt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Mt(e.kernelRegularizer),this.recurrentRegularizer=Mt(e.recurrentRegularizer),this.biasRegularizer=Mt(e.biasRegularizer),this.kernelConstraint=dn(e.kernelConstraint),this.recurrentConstraint=dn(e.recurrentConstraint),this.biasConstraint=dn(e.biasConstraint),this.dropout=ll([1,Ja([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=ll([1,Ja([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=ot(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ee(()=>{if(e=e,e.length!==2)throw new _(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let r=e[1];e=e[0];const s=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=ri({ones:()=>Hr(e),rate:this.dropout,training:s,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=ri({ones:()=>Hr(r),rate:this.recurrentDropout,training:s,dropoutFunc:this.dropoutFunc}));let i;const l=this.dropoutMask,u=this.recurrentDropoutMask;l!=null?i=Bs(j(e,l),this.kernel.read()):i=Bs(e,this.kernel.read()),this.bias!=null&&(i=ys(i,this.bias.read())),u!=null&&(r=j(r,u));let c=ke(i,Bs(r,this.recurrentKernel.read()));return this.activation!=null&&(c=this.activation.apply(c)),[c,c]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:ei(this.activation),useBias:this.useBias,kernelInitializer:Ot(this.kernelInitializer),recurrentInitializer:Ot(this.recurrentInitializer),biasInitializer:Ot(this.biasInitializer),kernelRegularizer:yt(this.kernelRegularizer),recurrentRegularizer:yt(this.recurrentRegularizer),biasRegularizer:yt(this.biasRegularizer),activityRegularizer:yt(this.activityRegularizer),kernelConstraint:cn(this.kernelConstraint),recurrentConstraint:cn(this.recurrentConstraint),biasConstraint:cn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}ky.className="SimpleRNNCell",xe(ky);class BS extends ni{constructor(e){e.cell=new ky(e),super(e)}call(e,t){return ee(()=>{this.cell.dropoutMask!=null&&(et(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(et(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=t==null?null:t.mask,s=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:i})})}static fromConfig(e,t){return new e(t)}}BS.className="SimpleRNN",xe(BS);class Iy extends Yp{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new _("GRUCell does not support reset_after parameter set to true.");this.units=e.units,bn(this.units,"units"),this.activation=ti(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=ti(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Wt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Wt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Wt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Mt(e.kernelRegularizer),this.recurrentRegularizer=Mt(e.recurrentRegularizer),this.biasRegularizer=Mt(e.biasRegularizer),this.kernelConstraint=dn(e.kernelConstraint),this.recurrentConstraint=dn(e.recurrentConstraint),this.biasConstraint=dn(e.biasConstraint),this.dropout=ll([1,Ja([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=ll([1,Ja([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=ot(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ee(()=>{if(e=e,e.length!==2)throw new _(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const r=t.training==null?!1:t.training;let s=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=ri({ones:()=>Hr(e),rate:this.dropout,training:r,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=ri({ones:()=>Hr(s),rate:this.recurrentDropout,training:r,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,l=this.recurrentDropoutMask;let u,c,h;0<this.dropout&&this.dropout<1&&(e=j(e,i[0]));let p=Bs(e,this.kernel.read());this.useBias&&(p=ys(p,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(s=j(s,l[0]));const m=this.recurrentKernel.read(),[g,y]=Lr(m,[2*this.units,this.units],m.rank-1),v=Bs(s,g),[w,S,I]=Lr(p,3,p.rank-1),[C,R]=Lr(v,2,v.rank-1);u=this.recurrentActivation.apply(ke(w,C)),c=this.recurrentActivation.apply(ke(S,R));const L=Bs(j(c,s),y);h=this.activation.apply(ke(I,L));const G=ke(j(u,s),j(ke(1,Qt(u)),h));return[G,G]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:ei(this.activation),recurrentActivation:ei(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Ot(this.kernelInitializer),recurrentInitializer:Ot(this.recurrentInitializer),biasInitializer:Ot(this.biasInitializer),kernelRegularizer:yt(this.kernelRegularizer),recurrentRegularizer:yt(this.recurrentRegularizer),biasRegularizer:yt(this.biasRegularizer),activityRegularizer:yt(this.activityRegularizer),kernelConstraint:cn(this.kernelConstraint),recurrentConstraint:cn(this.recurrentConstraint),biasConstraint:cn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}Iy.className="GRUCell",xe(Iy);class _S extends ni{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Iy(e),super(e)}call(e,t){return ee(()=>{this.cell.dropoutMask!=null&&(et(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(et(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=t==null?null:t.mask,s=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:i})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}_S.className="GRU",xe(_S);class Qp extends Yp{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,bn(this.units,"units"),this.activation=ti(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=ti(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Wt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Wt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Wt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Mt(e.kernelRegularizer),this.recurrentRegularizer=Mt(e.recurrentRegularizer),this.biasRegularizer=Mt(e.biasRegularizer),this.kernelConstraint=dn(e.kernelConstraint),this.recurrentConstraint=dn(e.recurrentConstraint),this.biasConstraint=dn(e.biasConstraint),this.dropout=ll([1,Ja([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=ll([1,Ja([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=ot(e);const r=e[e.length-1];this.kernel=this.addWeight("kernel",[r,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let s;if(this.useBias){if(this.unitForgetBias){const i=this.biasInitializer,l=this.units;s=new(t=class extends Qr{apply(u,c){const h=i.apply([l]),p=new Jb().apply([l]),m=i.apply([l*2]);return wI(wI(h,p),m)}},t.className="CustomInit",t)}else s=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,s,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return ee(()=>{const r=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new _(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let s=e[1];const i=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=ri({ones:()=>Hr(e),rate:this.dropout,training:r,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=ri({ones:()=>Hr(s),rate:this.recurrentDropout,training:r,count:4,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,u=this.recurrentDropoutMask;let c,h,p,m;0<this.dropout&&this.dropout<1&&(e=j(e,l[0]));let g=Bs(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(s=j(s,u[0])),g=ke(g,Bs(s,this.recurrentKernel.read())),this.useBias&&(g=ys(g,this.bias.read()));const[y,v,w,S]=Lr(g,4,g.rank-1);c=this.recurrentActivation.apply(y),h=this.recurrentActivation.apply(v),p=ke(j(h,i),j(c,this.activation.apply(w))),m=this.recurrentActivation.apply(S);const I=j(m,this.activation.apply(p));return[I,I,p]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:ei(this.activation),recurrentActivation:ei(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Ot(this.kernelInitializer),recurrentInitializer:Ot(this.recurrentInitializer),biasInitializer:Ot(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:yt(this.kernelRegularizer),recurrentRegularizer:yt(this.recurrentRegularizer),biasRegularizer:yt(this.biasRegularizer),activityRegularizer:yt(this.activityRegularizer),kernelConstraint:cn(this.kernelConstraint),recurrentConstraint:cn(this.recurrentConstraint),biasConstraint:cn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}Qp.className="LSTMCell",xe(Qp);class HS extends ni{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Qp(e),super(e)}call(e,t){return ee(()=>{this.cell.dropoutMask!=null&&(et(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(et(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=t==null?null:t.mask,s=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:i})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}HS.className="LSTM",xe(HS);class Sy extends Yp{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return ee(()=>{e=e;let r=e.slice(1);const s=[];for(const u of this.cells.slice().reverse())Array.isArray(u.stateSize)?s.push(r.splice(0,u.stateSize.length)):s.push(r.splice(0,1));s.reverse();const i=[];let l;for(let u=0;u<this.cells.length;++u){const c=this.cells[u];r=s[u],u===0?l=[e[0]].concat(r):l=[l[0]].concat(r),l=c.call(l,t),i.push(l.slice(1))}r=[];for(const u of i.slice().reverse())r.push(...u);return[l[0]].concat(r)})}build(e){ay(e)&&(e=e[0]),e=e;let t;this.cells.forEach((r,s)=>{io(`RNNCell_${s}`,()=>{r.build(e),Array.isArray(r.stateSize)?t=r.stateSize[0]:t=r.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=s=>({className:s.getClassName(),config:s.getConfig()}),r={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,t,r={}){const s=[];for(const i of t.cells)s.push(va(i,r));return new e({cells:s})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const r of this.cells)t.push(...r.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return iy(e)}setWeights(e){const t=[];for(const r of this.cells){const s=r.weights.length,i=e.splice(s);for(let l=0;l<r.weights.length;++l)t.push([r.weights[l],i[l]])}oy(t)}}Sy.className="StackedRNNCells",xe(Sy);function ri(n){const{ones:e,rate:t,training:r=!1,count:s=1,dropoutFunc:i}=n,l=()=>i!=null?i(e(),t):II(e(),t),u=()=>Lc(l,e,r);return!s||s<=1?Nr(u().clone()):Array(s).fill(void 0).map(u).map(c=>Nr(c.clone()))}/**
* @license
* Copyright 2020 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/var bK=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class US extends ni{constructor(e){if(e.unroll)throw new Qe("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Qe("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new un({ndim:5})]}call(e,t){return ee(()=>{if(this.cell.dropoutMask!=null&&(et(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(et(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new _("ConvRNN2D cell does not support constants");const r=t==null?null:t.mask,s=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:i})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return ee(()=>{const{stateSize:t}=this.cell,r=e.shape,s=this.computeSingleOutputShape(r),i=[s[0],...s.slice(2)],l=gn(i);return Array.isArray(t)?Array(t.length).fill(l):[l]})}resetStates(e,t=!1){ee(()=>{if(!this.stateful)throw new Ks("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape,s=this.computeSingleOutputShape(r),i=[s[0],...s.slice(2)];if(r[0]==null)throw new _("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>gn(i)):this.states_=[gn(i)];else if(e==null)et(this.states_),this.keptStates!=null&&(et(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>gn(i)):this.states_[0]=gn(i);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new _(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):et(this.states_);for(let l=0;l<this.states_.length;++l){const u=e[l],c=i;if(!B(u.shape,c))throw new _(`State ${l} is incompatible with layer ${this.name}: expected shape=${c}, received shape=${u.shape}`);this.states_[l]=u}}this.states_=this.states_.map(l=>Nr(l.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:r,kernelSize:s,padding:i,strides:l,dilationRate:u}=this.cell,c=t==="channelsFirst",h=e[c?3:2],p=e[c?4:3],m=ws(h,s[0],i,l[0],u[0]),g=ws(p,s[1],i,l[1],u[1]);return[...e.slice(0,2),...c?[r,m,g]:[m,g,r]]}}US.className="ConvRNN2D";class Cy extends Qp{constructor(e){const{filters:t,kernelSize:r,strides:s,padding:i,dataFormat:l,dilationRate:u}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,bn(this.filters,"filters"),this.kernelSize=cl(r,2,"kernelSize"),this.kernelSize.forEach(c=>bn(c,"kernelSize")),this.strides=cl(s||1,2,"strides"),this.strides.forEach(c=>bn(c,"strides")),this.padding=i||"valid",Gr(this.padding),this.dataFormat=l||"channelsLast",Jt(this.dataFormat),this.dilationRate=cl(u||1,2,"dilationRate"),this.dilationRate.forEach(c=>bn(c,"dilationRate"))}build(e){var t;e=ot(e);const r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new _(`The channel dimension of the input should be defined. Found ${e[r]}`);const s=e[r],i=4,l=this.kernelSize.concat([s,this.filters*i]);this.kernel=this.addWeight("kernel",l,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const u=this.kernelSize.concat([this.filters,this.filters*i]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",u,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let c;if(this.unitForgetBias){const h=this.biasInitializer,p=this.filters;c=new(t=class extends Qr{apply(m,g){const y=h.apply([p]),v=Ua([p]),w=h.apply([p*2]);return jb([y,v,w])}},t.className="CustomInit",t)}else c=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*i],null,c,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return ee(()=>{if(e.length!==3)throw new _(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const r=t.training||!1,s=e[0],i=e[1],l=e[2],u=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=ri({ones:()=>Hr(s),rate:this.dropout,training:r,count:u,dropoutFunc:this.dropoutFunc}));const c=this.dropoutMask,h=(Ie,ve,Ce)=>!ve||!ve[Ce]?Ie:j(ve[Ce],Ie);let p=h(s,c,0),m=h(s,c,1),g=h(s,c,2),y=h(s,c,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=ri({ones:()=>Hr(i),rate:this.recurrentDropout,training:r,count:u,dropoutFunc:this.dropoutFunc}));const v=this.recurrentDropoutMask;let w=h(i,v,0),S=h(i,v,1),I=h(i,v,2),C=h(i,v,3);const R=3,[L,G,$,F]=Lr(this.kernel.read(),u,R),[V,D,Z,ne]=this.useBias?Lr(this.bias.read(),u):[null,null,null,null];p=this.inputConv(p,L,V,this.padding),m=this.inputConv(m,G,D,this.padding),g=this.inputConv(g,$,Z,this.padding),y=this.inputConv(y,F,ne,this.padding);const[re,se,ue,le]=Lr(this.recurrentKernel.read(),u,R);w=this.recurrentConv(w,re),S=this.recurrentConv(S,se),I=this.recurrentConv(I,ue),C=this.recurrentConv(C,le);const he=this.recurrentActivation.apply(ke(p,w)),me=this.recurrentActivation.apply(ke(m,S)),pe=ke(j(me,l),j(he,this.activation.apply(ke(g,I)))),ye=j(this.recurrentActivation.apply(ke(y,C)),this.activation.apply(pe));return[ye,ye,pe]})}getConfig(){const e=super.getConfig(),t=bK(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},t),r)}inputConv(e,t,r,s){const i=ji(e,t,this.strides,s||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return r?ys(i,r,this.dataFormat):i}recurrentConv(e,t){return ji(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}Cy.className="ConvLSTM2DCell",xe(Cy);class jS extends US{constructor(e){const t=new Cy(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}jS.className="ConvLSTM2D",xe(jS);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class Ty extends qe{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,r=[];for(let s=0;s<this.noiseShape.length;++s)r.push(this.noiseShape[s]==null?t[s]:this.noiseShape[s]);return r}call(e,t){return ee(()=>{this.invokeCallHook(e,t);const r=Be(e);if(0<this.rate&&this.rate<1){const s=t.training==null?!1:t.training,i=this.getNoiseShape(r);return Lc(()=>II(r,this.rate,i,this.seed),()=>r,s)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}Ty.className="Dropout",xe(Ty);class YS extends Ty{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}YS.className="SpatialDropout1D",xe(YS);class QS extends qe{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,bn(this.units,"units"),this.activation=ti(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=Wt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Wt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=dn(e.kernelConstraint),this.biasConstraint=dn(e.biasConstraint),this.kernelRegularizer=Mt(e.kernelRegularizer),this.biasRegularizer=Mt(e.biasRegularizer),this.activityRegularizer=Mt(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=ot(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=ot(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return ee(()=>{this.invokeCallHook(e,t);const r=Be(e),s=fI(this.activation.getClassName());let i;return s!=null?i=Bs(r,this.kernel.read(),s,this.bias?this.bias.read():null):(i=Bs(r,this.kernel.read()),this.bias!=null&&(i=ys(i,this.bias.read())),this.activation!=null&&(i=this.activation.apply(i))),i})}getConfig(){const e={units:this.units,activation:ei(this.activation),useBias:this.useBias,kernelInitializer:Ot(this.kernelInitializer),biasInitializer:Ot(this.biasInitializer),kernelRegularizer:yt(this.kernelRegularizer),biasRegularizer:yt(this.biasRegularizer),activityRegularizer:yt(this.activityRegularizer),kernelConstraint:cn(this.kernelConstraint),biasConstraint:cn(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}QS.className="Dense",xe(QS);class JS extends qe{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=ot(e);for(const t of e.slice(1))if(t==null)throw new _(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Qa(e,1)]}call(e,t){return ee(()=>{this.invokeCallHook(e,t);let r=Be(e);if(this.dataFormat==="channelsFirst"&&r.rank>1){const s=[0];for(let i=2;i<r.rank;++i)s.push(i);s.push(1),r=at(r,s)}return JD(r)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}JS.className="Flatten",xe(JS);class qS extends qe{constructor(e){super(e),this.supportsMasking=!0,this.activation=ti(e.activation)}call(e,t){return ee(()=>{this.invokeCallHook(e,t);const r=Be(e);return this.activation.apply(r)})}getConfig(){const e={activation:ei(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}qS.className="Activation",xe(qS);class eC extends qe{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return ee(()=>(e=Be(e),YD(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}eC.className="RepeatVector",xe(eC);class tC extends qe{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const r="Total size of new array must be unchanged.",s=t.slice();let i=1,l=null;for(let c=0;c<s.length;++c){const h=s[c];if(this.isUnknown(h))if(l===null)l=c;else throw new _("Can only specifiy one unknown dimension.");else i*=h}const u=Qa(e);if(l!==null){if(i===0||u%i!==0)throw new _(r);s[l]=u/i}else if(u!==i)throw new _(r);return s}computeOutputShape(e){let t=!1;for(let r=0;r<e.length;++r)if(this.isUnknown(e[r])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return ee(()=>{this.invokeCallHook(e,t);const r=Be(e),s=r.shape,i=s.slice(0,1).concat(this.fixUnknownDimension(s.slice(1),this.targetShape));return q(r,i)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}tC.className="Reshape",xe(tC);class nC extends qe{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=gs(1,e.dims.length+1);if(!B(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new un({ndim:this.dims.length+1})]}computeOutputShape(e){e=ot(e);const t=e.slice();return this.dims.forEach((r,s)=>{t[s+1]=e[r]}),t}call(e,t){return at(Be(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}nC.className="Permute",xe(nC);class rC extends qe{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const r=Be(e);return W0(kp(r,this.maskValue),-1)}call(e,t){return ee(()=>{this.invokeCallHook(e,t);const r=Be(e),s=W0(kp(r,this.maskValue),-1,!0);return j(r,ze(s,r.dtype))})}}rC.className="Masking",xe(rC);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class sC extends qe{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(pt(e.inputLength))}this.inputDim=e.inputDim,bn(this.inputDim,"inputDim"),this.outputDim=e.outputDim,bn(this.outputDim,"outputDim"),this.embeddingsInitializer=Wt(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Mt(e.embeddingsRegularizer),this.activityRegularizer=Mt(e.activityRegularizer),this.embeddingsConstraint=dn(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return ee(()=>this.maskZero?(e=Be(e),kp(e,st(e))):null)}computeOutputShape(e){if(e=ot(e),this.inputLength==null)return[...e,this.outputDim];const t=pt(this.inputLength);if(t.length!==e.length-1)throw new _(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let r=0;for(let s=0;s<t.length;++s){const i=t[s],l=e[s+1];if(i!=null&&l!=null&&i!==l)throw new _(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);i==null&&(t[r]=l),r++}}return[e[0],...t,this.outputDim]}call(e,t){return ee(()=>{this.invokeCallHook(e,t);let r=Be(e);r.dtype!=="int32"&&(r=xa(r,"int32"));const s=kI(this.embeddings.read(),q(r,[r.size]));return q(s,ot(this.computeOutputShape(r.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Ot(this.embeddingsInitializer),embeddingsRegularizer:yt(this.embeddingsRegularizer),activityRegularizer:yt(this.activityRegularizer),embeddingsConstraint:cn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}sC.className="Embedding",xe(sC);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class uo extends qe{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new Qe}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const r=e.slice(0,e.length-t.length);for(let s=0;s<t.length;++s){const i=e[e.length-t.length+s],l=t[s];if(i==null||l==null||i<0||l<0)r.push(null);else if(i===1)r.push(l);else if(l===1)r.push(i);else{if(i!==l)throw new _("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));r.push(i)}}return r}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[ot(e)]),e=e,e.length<2)throw new _(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const i of e)i!=null&&i[0]!==null&&t.push(i[0]);if(t=Ya(t),t.length>1)throw new _(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let r=e[0]==null?null:e[0].slice(1);for(let i=1;i<e.length;++i){const l=e[i]==null?null:e[i].slice(1);r=this.computeElementwiseOpOutputShape(r,l)}const s=e.map(i=>i.length);e.indexOf(null)===-1&&Ya(s).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return ee(()=>{if(e=e,this.reshapeRequired){const r=[],s=e.map(i=>i.rank);if(s.indexOf(null)===-1){const i=Ja(s);for(let l of e){const u=l.rank;for(let c=0;c<i-u;++c)l=Rc(l,1);r.push(l)}return this.mergeFunction(r)}else{let i=!1;for(const c of e){const h=c.rank;if(h==null){const p=c.shape,m=p[0],g=p.slice(1).concat([m]);let y=q(c,[m].concat(Qa(p.slice(1))));y=at(y,[1,0]),y=q(y,g),r.push(y),i=!0}else if(h>1){const p=gs(1,h).concat([0]);r.push(at(c,p)),i=!0}else r.push(c)}let l=this.mergeFunction(r);const u=l.rank;if(i){if(u==null){const c=l.shape,h=c.length,p=c[h-1],m=[p].concat(c.slice(0,c.length-1));l=q(at(q(l,[-1,p]),[1,0]),m)}else if(u>1){const c=[u-1].concat(gs(0,u-1));l=at(l,c)}}return l}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let s=1;s<e.length;++s){const i=e[s]==null?null:e[s].slice(1);t=this.computeElementwiseOpOutputShape(t,i)}let r=[];for(const s of e)s!=null&&s[0]!==null&&r.push(s[0]);return r=Ya(r),r.length===1?t=r.concat(t):t=[null].concat(t),t}computeMask(e,t){return ee(()=>{if(t==null)return null;if(!Array.isArray(t))throw new _("`mask` should be an Array");if(!Array.isArray(e))throw new _("`inputs` should be an Array");if(t.length!==e.length)throw new _(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(s=>s==null))return null;t=t.map(s=>s==null?s:er(s,0));let r=t[0];for(let s=1;s<t.length-1;++s)r=fa(r,t[s]);return r})}}class aC extends uo{constructor(e){super(e)}mergeFunction(e){return ee(()=>{let t=e[0].clone();for(let r=1;r<e.length;++r)t=ke(t,e[r]);return t})}}aC.className="Add",xe(aC);class iC extends uo{constructor(e){super(e)}mergeFunction(e){return ee(()=>{let t=e[0].clone();for(let r=1;r<e.length;++r)t=j(t,e[r]);return t})}}iC.className="Multiply",xe(iC);class oC extends uo{constructor(e){super(e)}mergeFunction(e){return ee(()=>{let t=e[0].clone();for(let r=1;r<e.length;++r)t=ke(t,e[r]);return j(1/e.length,t)})}}oC.className="Average",xe(oC);class lC extends uo{constructor(e){super(e)}mergeFunction(e){return ee(()=>{let t=e[0];for(let r=1;r<e.length;++r)t=Ha(t,e[r]);return t})}}lC.className="Maximum",xe(lC);class uC extends uo{constructor(e){super(e)}mergeFunction(e){return ee(()=>{let t=e[0];for(let r=1;r<e.length;++r)t=yc(t,e[r]);return t})}}uC.className="Minimum",xe(uC);class cC extends uo{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new _("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const s of e)if(s!=null){t=!1;break}if(t)return;const r=[];for(let s=0;s<e.length;++s){const i=e[s].slice();i.splice(this.axis,1);let l=!1;for(const u of r)if(B(u,i)){l=!0;break}l||r.push(i)}if(r.length>1)throw new _("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return ee(()=>jb(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new _("A `Concatenate` layer should be called on a list of inputs.");const t=e,r=t[0].slice(),s=this.axis<0?r.length+this.axis:this.axis;for(const i of t.slice(1)){if(r[s]==null||i[s]==null){r[s]=null;break}r[s]+=i[s]}return r}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new _("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new _("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new _(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return ee(()=>{let r=!0;if(t.forEach(l=>{if(l!=null){r=!1;return}}),r)return null;const s=[];for(let l=0;l<e.length;++l)t[l]==null?s.push(ze(Hr(e[l]),"bool")):t[l].rank<e[l].rank?s.push(er(t[l],-1)):s.push(t[l]);const i=qn(s,this.axis);return Ek(i,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}cC.className="Concatenate",xe(cC);function Oc(n,e){for(;n<0;)n+=e;return n}function yK(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new Qe("batchDot is not implemented for tensors of 4D or higher rank yet");if(T(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),T(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new Qe("batchDot is not implemented for complex64-type Tensors yet.");const r=n.shape.length,s=e.shape.length;t==null&&(t=[r-1,s-2]);const i=t;return ee(()=>{let l;if(r>s){l=r-s;const c=[];for(let h=0;h<l;++h)c.push(1);e=q(e,e.shape.concat(c))}else if(s>r){l=s-r;const c=[];for(let h=0;h<l;++h)c.push(1);n=q(n,n.shape.concat(c))}else l=0;let u;if(n.shape.length===2&&e.shape.length===2)i[0]===i[1]?u=Xe(j(n,e),i[0]):u=Xe(j(at(n,[1,0]),e),i[1]);else{const c=i[0]!==n.shape.length-1,h=i[1]===e.shape.length-1;u=dt(n,e,c,h)}if(l>0){let c;r>s?c=r+s-3:c=r-1;const h=[];for(let p=c;p<c+l;++p)h.push(p);u=wc(u,h)}return u.shape.length===1&&(u=er(u,1)),u})}class dC extends uo{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){T(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],r=e[1];if(t.length>3||r.length>3)throw new Qe("Dot layer does not support tensors of 4D or higher rank yet.");const s=this.interpretAxes(t,r);if(t[s[0]]!==r[s[1]])throw new _(`Dimension incompatibility: ${t[s[0]]} !== ${r[s[1]]}`)}mergeFunction(e){if(e.length!==2)throw new _(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],r=e[1],s;return Array.isArray(this.axes)?s=this.axes.map((i,l)=>Oc(i,e[l].shape.length)):s=[Oc(this.axes,t.shape.length),Oc(this.axes,r.shape.length)],this.normalize&&(t=Op(t,s[0]),r=Op(r,s[1])),yK(t,r,s)}interpretAxes(e,t){let r;return Array.isArray(this.axes)?r=this.axes:r=[Oc(this.axes,e.length),Oc(this.axes,t.length)],r}computeOutputShape(e){T(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),r=e[1].slice();if(t.length>3||r.length>3)throw new Qe("Dot layer does not support tensors of 4D or higher rank yet.");const s=this.interpretAxes(t,r);t.splice(s[0],1),r.splice(s[1],1),r.splice(0,1);const i=t.concat(r);return i.length===1&&i.push(1),i}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}dC.className="Dot",xe(dC);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class hC extends qe{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return ee(()=>{this.invokeCallHook(e,t);const r=Be(e);return Lc(()=>ke(Mp(r.shape,0,this.stddev),r),()=>r,t.training||!1)})}}hC.className="GaussianNoise",xe(hC);class pC extends qe{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return ee(()=>{this.invokeCallHook(e,t);const r=Be(e);return this.rate>0&&this.rate<1?Lc(()=>{const s=Math.sqrt(this.rate/(1-this.rate));return j(r,Mp(r.shape,1,s))},()=>r,t.training||!1):r})}}pC.className="GaussianDropout",xe(pC);class fC extends qe{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||Be(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return ee(()=>{if(this.rate<1&&this.rate>0){const r=this._getNoiseShape(e);return Lc(()=>{const s=Be(e),i=-1.6732632423543772*1.0507009873554805;let l=Yi(xc(r),this.rate);l=xa(l,"float32");const u=((1-this.rate)*(1+this.rate*i**2))**-.5,c=-u*i*this.rate,h=ke(j(s,l),j(ke(l,-1),i));return ke(j(h,u),c)},()=>Be(e),t.training||!1)}return e})}}fC.className="AlphaDropout",xe(fC);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function Dc(n,e,t,r,s,i=.001){let l;if(n.rank===2)l=QM(n,e,t,r,s,i);else if(n.rank===3)l=qM(n,e,t,r,s,i);else if(n.rank===4)l=t$(n,e,t,r,s,i);else throw new Qe(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return l}function xK(n,e,t,r,s=.001){return ee(()=>{const i=j0(n,r),l=i.mean,u=i.variance;return[Dc(n,l,u,t,e,s),l,u]})}function vK(n,e,t,r,s=.001){return ee(()=>{const i=j0(n,r),l=i.mean,u=i.variance,c=[];for(const y of gs(0,n.rank))r.indexOf(y)!==-1?c.push(1):c.push(n.shape[y]);const h=q(l,c),p=q(u,c),m=e==null?null:q(e,c),g=t==null?null:q(t,c);return[Dc(n,h,p,g,m,s),l,u]})}function wK(n,e,t,r,s=.001){return B(r.slice().sort(),gs(0,n.rank-1))?xK(n,e,t,r,s):vK(n,e,t,r,s)}class mC extends qe{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Wt(e.betaInitializer||"zeros"),this.gammaInitializer=Wt(e.gammaInitializer||"ones"),this.movingMeanInitializer=Wt(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Wt(e.movingVarianceInitializer||"ones"),this.betaConstraint=dn(e.betaConstraint),this.gammaConstraint=dn(e.gammaConstraint),this.betaRegularizer=Mt(e.betaRegularizer),this.gammaRegularizer=Mt(e.gammaRegularizer)}build(e){e=ot(e);const t=this.axis>=0?this.axis:this.axis+e.length,r=e[t];if(r==null)throw new _(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new un({ndim:e.length,axes:{[t]:r}})];const s=[r];this.scale&&(this.gamma=this.addWeight("gamma",s,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",s,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",s,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",s,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return ee(()=>{const r=t.training==null?!1:t.training,s=Be(e),i=s.shape,l=i.length,u=gs(0,l),c=this.axis>=0?this.axis:this.axis+l;u.splice(c,1);const h=ro(1,l);h[c]=i[c];const p=u.slice();p.sort();const m=!B(p,gs(0,l).slice(0,l-1)),g=()=>{if(m){const I=q(this.movingMean.read(),h),C=q(this.movingVariance.read(),h),R=this.center?q(this.beta.read(),h):null,L=this.scale?q(this.gamma.read(),h):null;return Dc(s,I,C,R,L,this.epsilon)}else return Dc(s,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!r)return g();const[y,v,w]=wK(s,this.gamma.read(),this.beta.read(),u,this.epsilon),S=(I,C,R)=>{ee(()=>{const L=1-R,G=I.read(),$=j(Ze(G,C),L);I.write(Ze(G,$))})};return S(this.movingMean,v,this.momentum),S(this.movingVariance,w,this.momentum),y})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Ot(this.betaInitializer),gammaInitializer:Ot(this.gammaInitializer),movingMeanInitializer:Ot(this.movingMeanInitializer),movingVarianceInitializer:Ot(this.movingVarianceInitializer),betaRegularizer:yt(this.betaRegularizer),gammaRegularizer:yt(this.gammaRegularizer),betaConstraint:cn(this.betaConstraint),gammaConstraint:cn(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}mC.className="BatchNormalization",xe(mC);class gC extends qe{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Wt(e.betaInitializer||"zeros"),this.gammaInitializer=Wt(e.gammaInitializer||"ones"),this.betaRegularizer=Mt(e.betaRegularizer),this.gammaRegularizer=Mt(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=ot(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=t);for(const i of this.axis)if(i<0||i>=t)throw new Error(`Invalid axis: ${i}`);if(this.axis.length!==Ya(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const r=this.axis.map(i=>e[i]),s=!0;this.scale?this.gamma=this.addWeight("gamma",r,"float32",this.gammaInitializer,this.gammaRegularizer,s):this.gamma=null,this.center?this.beta=this.addWeight("beta",r,"float32",this.betaInitializer,this.betaRegularizer,s):this.beta=null,this.built=!0}call(e,t){const r=Be(e),s=r.shape,i=s.length;return ee(()=>{let{mean:l,variance:u}=j0(r,this.axis,!0);const c=ro(1,i);for(const v of this.axis)c[v]=s[v];const h=v=>v!=null&&v.shape.length!==i?q(v,c):v;let p=this.scale?h(this.gamma.read()):null,m=this.center?h(this.beta.read()):null;const g=[],y=[];for(let v=0;v<i;++v)this.axis.indexOf(v)!==-1?(g.push(s[v]),y.push(1)):(g.push(1),y.push(s[v]));return l=fs(l,g),u=fs(u,g),p!=null&&(p=fs(p,y)),m!=null&&(m=fs(m,y)),Dc(r,l,u,m,p,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Ot(this.betaInitializer),gammaInitializer:Ot(this.gammaInitializer),betaRegularizer:yt(this.betaRegularizer),gammaRegularizer:yt(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}gC.className="LayerNormalization",xe(gC);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function kK(n,e,t){return ee(()=>{if(n.rank!==4)throw new _(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new _("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=bs()),t!=="channelsLast"&&t!=="channelsFirst")throw new _(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return t==="channelsFirst"?r=[[0,0],[0,0],e[0],e[1]]:r=[[0,0],e[0],e[1],[0,0]],Y0(n,r)})}class bC extends qe{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?bs():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new _(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,r;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],r=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new _(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new _(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);r=e.padding[1]}this.padding=[t,r]}this.inputSpec=[new un({ndim:4})]}computeOutputShape(e){e=ot(e);let t,r;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?r=e[3]+this.padding[1][0]+this.padding[1][1]:r=null,[e[0],e[1],t,r]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?r=e[2]+this.padding[1][0]+this.padding[1][1]:r=null,[e[0],t,r,e[3]])}call(e,t){return ee(()=>kK(Be(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}bC.className="ZeroPadding2D",xe(bC);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function Jp(n,e,t,r,s,i){return ee(()=>{Jt(s),gI(i),Gr(r),t==null&&(t=[1,1]),r==null&&(r="valid"),s==null&&(s=bs()),i==null&&(i="max"),n=wy(n,s);let l;const u=r==="same"?"same":"valid";return i==="max"?l=U0(n,e,t,u):l=F0(n,e,t,u),s==="channelsFirst"&&(l=at(l,[0,3,1,2])),l})}function yC(n,e,t,r,s,i){return ee(()=>{Jt(s),gI(i),Gr(r),t==null&&(t=[1,1,1]),r==null&&(r="valid"),s==null&&(s=bs()),i==null&&(i="max"),n=MS(n,s);let l;const u=r==="same"?"same":"valid";return i==="max"?l=OF(n,e,t,u):l=DM(n,e,t,u),s==="channelsFirst"&&(l=at(l,[0,4,1,2,3])),l})}class xC extends qe{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new _(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(bn(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new _(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);bn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Gr(this.padding),this.inputSpec=[new un({ndim:3})]}computeOutputShape(e){e=ot(e);const t=ws(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return ee(()=>{this.invokeCallHook(e,t),e=Rc(Be(e),2);const r=this.poolingFunction(Be(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return wc(r,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class vC extends xC{constructor(e){super(e)}poolingFunction(e,t,r,s,i){return Jt(i),Gr(s),Jp(e,t,r,s,i,"max")}}vC.className="MaxPooling1D",xe(vC);class wC extends xC{constructor(e){super(e)}poolingFunction(e,t,r,s,i){return Jt(i),Gr(s),Jp(e,t,r,s,i,"avg")}}wC.className="AveragePooling1D",xe(wC);class kC extends qe{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new _(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];bn(this.poolSize,"poolSize"),bn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Jt(this.dataFormat),Gr(this.padding),this.inputSpec=[new un({ndim:4})]}computeOutputShape(e){e=ot(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=ws(t,this.poolSize[0],this.padding,this.strides[0]),r=ws(r,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,r]:[e[0],t,r,e[3]]}call(e,t){return ee(()=>(this.invokeCallHook(e,t),this.poolingFunction(Be(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class IC extends kC{constructor(e){super(e)}poolingFunction(e,t,r,s,i){return Jt(i),Gr(s),Jp(e,t,r,s,i,"max")}}IC.className="MaxPooling2D",xe(IC);class SC extends kC{constructor(e){super(e)}poolingFunction(e,t,r,s,i){return Jt(i),Gr(s),Jp(e,t,r,s,i,"avg")}}SC.className="AveragePooling2D",xe(SC);class CC extends qe{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new _(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];bn(this.poolSize,"poolSize"),bn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Jt(this.dataFormat),Gr(this.padding),this.inputSpec=[new un({ndim:5})]}computeOutputShape(e){e=ot(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2],s=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=ws(t,this.poolSize[0],this.padding,this.strides[0]),r=ws(r,this.poolSize[1],this.padding,this.strides[1]),s=ws(s,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,r,s]:[e[0],t,r,s,e[4]]}call(e,t){return ee(()=>(this.invokeCallHook(e,t),this.poolingFunction(Be(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class TC extends CC{constructor(e){super(e)}poolingFunction(e,t,r,s,i){return Jt(i),Gr(s),yC(e,t,r,s,i,"max")}}TC.className="MaxPooling3D",xe(TC);class NC extends CC{constructor(e){super(e)}poolingFunction(e,t,r,s,i){return Jt(i),Gr(s),yC(e,t,r,s,i,"avg")}}NC.className="AveragePooling3D",xe(NC);class RC extends qe{constructor(e){super(e),this.inputSpec=[new un({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new Qe}}class EC extends RC{constructor(e){super(e||{})}call(e,t){return ee(()=>{const r=Be(e);return rn(r,1)})}}EC.className="GlobalAveragePooling1D",xe(EC);class LC extends RC{constructor(e){super(e||{})}call(e,t){return ee(()=>{const r=Be(e);return ps(r,1)})}}LC.className="GlobalMaxPooling1D",xe(LC);class GC extends qe{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Jt(this.dataFormat),this.inputSpec=[new un({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new Qe}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class zC extends GC{call(e,t){return ee(()=>{const r=Be(e);return this.dataFormat==="channelsLast"?rn(r,[1,2]):rn(r,[2,3])})}}zC.className="GlobalAveragePooling2D",xe(zC);class WC extends GC{call(e,t){return ee(()=>{const r=Be(e);return this.dataFormat==="channelsLast"?ps(r,[1,2]):ps(r,[2,3])})}}WC.className="GlobalMaxPooling2D",xe(WC);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class MC extends qe{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,r={}){const s=t.layer,i=va(s,r);delete t.layer;const l={layer:i};return Object.assign(l,t),new e(l)}}class $C extends MC{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=ot(e),e.length<3)throw new _(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=ot(e);const t=[e[0]].concat(e.slice(2)),r=this.layer.computeOutputShape(t),s=e[1];return[r[0],s].concat(r.slice(1))}call(e,t){return ee(()=>(e=Be(e),ZS((r,s)=>[Be(this.layer.call(r,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}$C.className="TimeDistributed",xe($C);function IK(n){ao(BD,"BidirectionalMergeMode",n)}const SK="concat";class FC extends MC{constructor(e){super(e);const t=e.layer.getConfig(),r={};r.className=e.layer.getClassName(),r.config=t,this.forwardLayer=va(r),t.goBackwards=t.goBackwards!==!0;const s={};if(s.className=e.layer.getClassName(),s.config=t,this.backwardLayer=va(s),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?SK:e.mergeMode,IK(this.mergeMode),e.weights)throw new Qe("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,r=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,r)),this.backwardLayer.setWeights(e.slice(r))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let r,s,i;return this.returnState&&(i=t.slice(1)),r=t[0],r=r,this.mergeMode==="concat"?(r[r.length-1]*=2,s=[r]):this.mergeMode==null?s=[r,r.slice()]:s=[r],this.returnState?this.mergeMode==null?s.concat(i).concat(i.slice()):[r].concat(i).concat(i.slice()):tr(s)}apply(e,t){let r=t==null?null:t.initialState,s=t==null?null:t.constants;t==null&&(t={});const i=KS(e,r,s,this.numConstants);if(e=i.inputs,r=i.initialState,s=i.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(r==null||r.length===0)&&s==null)return super.apply(e,t);const l=[],u=[];if(r!=null){const h=r.length;if(h%2>0)throw new _("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=r,l.push(...r);const p=r.map(m=>new un({shape:m.shape}));this.forwardLayer.stateSpec=p.slice(0,h/2),this.backwardLayer.stateSpec=p.slice(h/2),u.push(...p)}if(s!=null)throw new Qe("Support for constants in Bidirectional layers is not implemented yet.");const c=l[0]instanceof _s;for(const h of l)if(h instanceof _s!==c)throw new _("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(c){const h=[e].concat(l),p=this.inputSpec.concat(u),m=this.inputSpec;this.inputSpec=p;const g=super.apply(h,t);return this.inputSpec=m,g}else return super.apply(e,t)}call(e,t){return ee(()=>{const r=t.initialState;let s,i;if(r==null)s=this.forwardLayer.call(e,t),i=this.backwardLayer.call(e,t);else{const c=r.slice(0,r.length/2),h=r.slice(r.length/2);s=this.forwardLayer.call(e,Object.assign(t,{initialState:c})),i=this.backwardLayer.call(e,Object.assign(t,{initialState:h}))}let l;this.returnState&&(Array.isArray(s)&&(l=s.slice(1).concat(i.slice(1))),s=s[0],i=i[0]),this.returnSequences&&(i=qi(i,1));let u;return this.mergeMode==="concat"?u=jb([s,i]):this.mergeMode==="sum"?u=ke(s,i):this.mergeMode==="ave"?u=j(.5,ke(s,i)):this.mergeMode==="mul"?u=j(s,i):this.mergeMode==null&&(u=[s,i]),this.returnState?this.mergeMode==null?u.concat(l):[u].concat(l):u})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){io(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),io(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let r;if(this.returnSequences?this.mergeMode==null?r=[t,t]:r=t:this.mergeMode==null?r=[null,null]:r=null,this.returnState){const s=this.forwardLayer.states.map(i=>null);return Array.isArray(r)?r.concat(s).concat(s):[r].concat(s).concat(s)}else return r}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const r=va(t.layer);if(delete t.layer,t.numConstants!=null)throw new Qe("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const s=t;return s.layer=r,new e(s)}}FC.className="Bidirectional",xe(FC);/**
* @license
* Copyright 2022 CodeSmith LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class VC extends qe{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return ee(()=>(e=Be(e),e.dtype!=="float32"&&(e=xa(e,"float32")),ke(j(e,this.scale),this.offset)))}}VC.className="Rescaling",xe(VC);/**
* @license
* Copyright 2022 CodeSmith LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const{resizeBilinear:CK,cropAndResize:TK}=ma;class PC extends qe{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,r,s,i,l,u,c){return ee(()=>{let h,p=!1;const m=t/l,g=r/u,y=(s+t)/l,v=(i+r)/u,w=[m,g,y,v],S=[];e.rank===3?(p=!0,h=Ds([e])):h=e;for(let L=0;L<h.shape[0];L++)S.push(w);const I=Tr(S,[S.length,4]),C=vc(0,S.length,1,"int32"),R=TK(h,I,C,[s,i],"nearest");return xa(p?Be(to(R)):R,c)})}upsize(e,t,r,s){return ee(()=>{const i=CK(e,[t,r]);return xa(i,s)})}call(e,t){return ee(()=>{const r=Be(e),s=r.dtype,i=r.shape,l=i[i.length-3],u=i[i.length-2];let c=0;l!==this.height&&(c=Math.floor((l-this.height)/2));let h=0;return u!==this.width&&(h=Math.floor((u-this.width)/2),h===0&&(h=1)),c>=0&&h>=0?this.centerCrop(r,c,h,this.height,this.width,l,u,s):this.upsize(e,this.height,this.width,s)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=ot(e);const t=e.length-3,r=e.length-2;return e[t]=this.height,e[r]=this.width,e}}PC.className="CenterCrop",xe(PC);/**
* @license
* Copyright 2022 CodeSmith LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function NK(n,e,t,r){let s=Be(n);if(s.dtype!=="int32"&&(s=xa(s,"int32")),e==="int")return s;const i=s.shape;if(s.rank===0&&(s=er(s,-1)),e==="oneHot"&&s.shape[s.shape.length-1]!==1&&(s=er(s,-1)),s.rank>2)throw new _(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${i} which would result in output rank ${s.rank}.`);const l=["multiHot","oneHot"].includes(e),u=s;let c;if(typeof r<"u"&&e==="count"?c=$k(u,r,t,l):c=$k(u,[],t,l),e!=="tfIdf")return c;if(r)return j(c,r);throw new _("When outputMode is 'tfIdf', weights must be provided.")}/**
* @license
* Copyright 2022 CodeSmith LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class XC extends qe{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=ot(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return ee(()=>{e=Be(e),e.dtype!=="int32"&&(e=xa(e,"int32"));let r;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new _(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);r=Be(t.countWeights)}const s=ps(e),i=yp(e),l=Er(this.numTokens,s).bufferSync().get(0),u=Yi(i,0).bufferSync().get(0);if(!(l&&u))throw new _(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return NK(e,this.outputMode,this.numTokens,r)})}}XC.className="CategoryEncoding",xe(XC);/**
* @license
* Copyright 2022 CodeSmith LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const RK=["bilinear","nearest"],OC=new Set(RK);class DC extends qe{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(OC.has(e.interpolation))this.interpolation=e.interpolation;else throw new _(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=ot(e);const t=e[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return ee(()=>{const r=[this.height,this.width];if(this.interpolation==="bilinear")return ma.resizeBilinear(e,r,!this.cropToAspectRatio);if(this.interpolation==="nearest")return ma.resizeNearestNeighbor(e,r,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...OC]} are supported`)})}}DC.className="Resizing",xe(DC);/**
* @license
* Copyright 2023 CodeSmith LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class AC{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}AC.className="RandomSeed";/**
* @license
* Copyright 2023 CodeSmith LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class KC extends qe{constructor(e){super(e),this.randomGenerator=new AC(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}KC.className="BaseRandomLayer";/**
* @license
* Copyright 2023 CodeSmith LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const EK=["bilinear","nearest"],ZC=new Set(EK);class BC extends KC{constructor(e){super(e);const{factor:t,interpolation:r="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new _(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new _(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new _(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(r)if(ZC.has(r))this.interpolation=r;else throw new _(`Invalid interpolation parameter: ${r} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=ot(e);const t=e[2];return[this.imgHeight,-1,t]}call(e,t){return ee(()=>{const r=Be(e);this.imgHeight=r.shape[r.shape.length-3];const s=r.shape[r.shape.length-2];this.widthFactor=xc([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let i=this.widthFactor.dataSync()[0]*s;i=Math.round(i);const l=[this.imgHeight,i];switch(this.interpolation){case"bilinear":return ma.resizeBilinear(e,l);case"nearest":return ma.resizeNearestNeighbor(e,l);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...ZC]} are supported`)}})}}BC.className="RandomWidth",xe(BC);/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/ae().registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*
* =============================================================================
*/var _C;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(_C||(_C={}));var HC;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(HC||(HC={}));/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*
* =============================================================================
*/var UC;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(UC||(UC={}));/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function $e(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&T(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const LK=c2;class qp extends b{nextDataId(){return qp.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new f(this,vt())}write(e,t,r){this.firstUse&&(this.firstUse=!1,ae().get("IS_NODE")&&Sr(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const s={id:this.nextDataId()};return this.data.set(s,{values:e,dtype:r,refCount:1}),s}makeTensorInfo(e,t,r){let s;if(t==="string"&&r!=null&&r.length>0&&Vt(r[0])){const i=r.map(l=>Da(l));s=this.write(i,e,t)}else s=this.write(r,e,t);return{dataId:s,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,r,s,i){this.data.set(e,{values:t,dtype:s,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:r}=this.data.get(e);if(t==="complex64"){const s=this.readSync(r.real.dataId),i=this.readSync(r.imag.dataId);return ga(s,i)}return Ms(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const r=t.map(s=>Aa(s));return Je(e.shape,e.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Je(e.shape,e.dtype,t)}makeOutput(e,t,r){return vt().makeTensorFromTensorInfo(this.makeTensorInfo(t,r,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:r}=this.data.get(e);r!=null&&(this.disposeData(r.real.dataId,!0),this.disposeData(r.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=Yn();return e(),{kernelMs:Yn()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){$e([e],"where");const t=this.readSync(e.dataId);return LK(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}qp.nextDataId=0;/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function jC(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const GK={kernelName:oh,backendName:"cpu",kernelFunc:n=>{const{x:e}=n.inputs,t=n.backend;$e(e,"abs");let r=new Float32Array(M(e.shape));const s=t.data.get(e.dataId).values;return r=jC(s),t.makeOutput(r,e.shape,e.dtype)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function qt(n){return(e,t,r,s,i)=>{const l=Ye(e,t),u=l.length,c=we(l),h=M(l),p=ge(i,h),m=e.length,g=t.length,y=we(e),v=we(t),w=el(e,l),S=el(t,l);if(w.length+S.length===0)for(let I=0;I<p.length;++I)p[I]=n(r[I%r.length],s[I%s.length]);else for(let I=0;I<p.length;++I){const C=Ao(I,u,c),R=C.slice(-m);w.forEach(F=>R[F]=0);const L=Fs(R,m,y),G=C.slice(-g);S.forEach(F=>G[F]=0);const $=Fs(G,g,v);p[I]=n(r[L],s[$])}return[p,l]}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function fr(n){const{inputs:e,backend:t}=n,{real:r,imag:s}=e,i=t.data.get(r.dataId).values,l=t.data.get(s.dataId).values,u=t.makeTensorInfo(r.shape,"complex64"),c=t.data.get(u.dataId);return c.complexTensorInfos={real:t.makeTensorInfo(r.shape,"float32",i),imag:t.makeTensorInfo(s.shape,"float32",l)},u}const zK={kernelName:zg,backendName:"cpu",kernelFunc:fr};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ef(n,e,t="float32"){if(t==="complex64"){const s=ef(n,e,"float32"),i=ef(n,e,"float32");return fr({inputs:{real:s,imag:i},backend:n})}const r=Pt(M(e),t);return n.makeTensorInfo(e,t,r)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Us(n){const{inputs:e,backend:t}=n,{x:r}=e;return t.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const WK={kernelName:Gu,backendName:"cpu",kernelFunc:Us};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function co(n){const{inputs:e,backend:t}=n,{input:r}=e,s=t.data.get(r.dataId).complexTensorInfos.real,i=t.data.get(s.dataId).values;return t.makeTensorInfo(s.shape,s.dtype,i)}const MK={kernelName:s0,backendName:"cpu",kernelFunc:co};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function YC(n,e,t,r){if(r==="int32"){const s=Int32Array.from(n);return[e,"int32",s]}if(r==="bool"){const s=Di([0],t),[i,l]=qt((u,c)=>u!==c?1:0)(e,[],n,s,"bool");return[l,"bool",i]}throw new Error(`Error in Cast: failed to cast ${t} to ${r}`)}function si(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{dtype:i}=r;if(i==="complex64"){if(s.dtype==="complex64")return Us({inputs:{x:s},backend:t});const p=ef(t,s.shape,s.dtype),m=si({inputs:{x:s},backend:t,attrs:{dtype:"float32"}}),g=fr({inputs:{real:m,imag:p},backend:t});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),g}if(s.dtype==="complex64"){const p=co({inputs:{input:s},backend:t}),m=si({inputs:{x:p},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(p),m}if(!Gt(s.dtype,i)){const p=Us({inputs:{x:s},backend:t});return{dataId:p.dataId,shape:p.shape,dtype:i}}const l=t.data.get(s.dataId).values,[u,c,h]=YC(l,s.shape,s.dtype,i);return t.makeTensorInfo(u,c,h)}const $K={kernelName:yu,backendName:"cpu",kernelFunc:si};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hn(n,e,t,r){return t==null?({inputs:s,backend:i})=>{const{a:l,b:u}=s,c=i;$e([l,u],n);const h=c.data.get(l.dataId).values,p=c.data.get(u.dataId).values,m=l.dtype==="string"?ba(h):h,g=l.dtype==="string"?ba(p):p,y=r||l.dtype,[v,w]=e(l.shape,u.shape,m,g,y);return c.makeTensorInfo(w,y,v)}:({inputs:s,backend:i})=>{const{a:l,b:u}=s,c=i;if(l.dtype==="complex64"||u.dtype==="complex64"){const h=si({inputs:{x:l},backend:c,attrs:{dtype:"complex64"}}),p=c.data.get(h.dataId),m=p.complexTensorInfos.real,g=p.complexTensorInfos.imag,y=c.data.get(m.dataId).values,v=c.data.get(g.dataId).values,w=si({inputs:{x:u},backend:c,attrs:{dtype:"complex64"}}),S=c.data.get(w.dataId),I=S.complexTensorInfos.real,C=S.complexTensorInfos.imag,R=c.data.get(I.dataId).values,L=c.data.get(C.dataId).values,[G,$,F]=t(l.shape,u.shape,y,v,R,L),V=c.makeTensorInfo(F,"float32",G),D=c.makeTensorInfo(F,"float32",$),Z=fr({inputs:{real:V,imag:D},backend:c});return c.disposeIntermediateTensorInfo(h),c.disposeIntermediateTensorInfo(w),c.disposeIntermediateTensorInfo(V),c.disposeIntermediateTensorInfo(D),Z}else{const h=c.data.get(l.dataId).values,p=c.data.get(u.dataId).values,m=r||l.dtype,[g,y]=e(l.shape,u.shape,h,p,m);return c.makeTensorInfo(y,m,g)}}}function Ny(n){return(e,t,r,s,i,l)=>{const u=Ye(e,t),c=M(u),h=u.length,p=we(u),m=ge("float32",c),g=ge("float32",c),y=el(e,u),v=el(t,u),w=ga(r,s),S=ga(i,l),I=e.length,C=we(e),R=t.length,L=we(t);if(y.length+v.length===0)for(let G=0;G<m.length;G++){const $=G%w.length,F=G%S.length,V=n(w[$*2],w[$*2+1],S[F*2],S[F*2+1]);m[G]=V.real,g[G]=V.imag}else for(let G=0;G<m.length;G++){const $=Ao(G,h,p),F=$.slice(-I);y.forEach(re=>F[re]=0);const V=Fs(F,I,C),D=$.slice(-R);v.forEach(re=>D[re]=0);const Z=Fs(D,R,L),ne=n(w[V*2],w[V*2+1],S[Z*2],S[Z*2+1]);m[G]=ne.real,g[G]=ne.imag}return[m,g,u]}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const QC=qt((n,e)=>n+e),FK=Ny((n,e,t,r)=>({real:n+t,imag:e+r})),hl=hn(Ko,QC,FK),VK={kernelName:Ko,backendName:"cpu",kernelFunc:hl};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ry(n,e,t,r,s){const i=M(r),l=Pt(s,t);for(let u=0;u<n.length;u++){const c=n[u];if(c<0)throw new Error("Input x must be non-negative!");c>=s||(i>0?l[c]+=e[u]:l[c]+=1)}return l}function JC(n,e,t,r=!1){const s=n.shape[0],i=n.shape[1],l=Je([s,t],e.dtype);for(let u=0;u<s;u++)for(let c=0;c<i;c++){const h=n.get(u,c);if(h<0)throw new Error("Input x must be non-negative!");h>=t||(r?l.set(1,u,h):e.size>0?l.set(l.get(u,h)+e.get(u,c),u,h):l.set(l.get(u,h)+1,u,h))}return l}/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const qC=qt((n,e)=>n&e),PK=hn(Gg,qC),XK={kernelName:Gg,backendName:"cpu",kernelFunc:PK};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function js(n){return(e,t,r)=>{const s=be(t,e.length);for(let i=0;i<e.length;++i)s[i]=n(e[i],r);return s}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ft(n,e,t){const r=js(e);return ai(n,r,t)}function ai(n,e,t){return({inputs:r,attrs:s,backend:i})=>{const{x:l}=r;$e(l,n);const u=i,c=u.data.get(l.dataId).values;let h;if(l.dtype==="string"){if(!Array.isArray(c))throw new Error("String tensor's value was not an instance of Array");h=ba(c)}else h=c;const p=t||l.dtype,m=e(h,p,s);return u.makeTensorInfo(l.shape,p,m)}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const eT=js(n=>Math.ceil(n)),OK=ai(xu,eT),DK={kernelName:xu,backendName:"cpu",kernelFunc:OK};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tT(n,e,t,r){const s=be(t,M(e));if(r&&t!=="string"){let i=0;n.forEach(l=>{const u=M(l.shape);s.set(l.vals,i),i+=u})}else{let i=0;n.forEach(l=>{const u=t==="string"?ba(l.vals):l.vals;let c=0;for(let h=0;h<l.shape[0];++h){const p=h*e[1]+i;for(let m=0;m<l.shape[1];++m)s[p+m]=u[c++]}i+=l.shape[1]})}return s}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const nT=qt((n,e)=>n===e?1:0),rT=hn(kh,nT,null,"bool"),AK={kernelName:kh,backendName:"cpu",kernelFunc:rT};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const sT=js(n=>Math.exp(n)),aT=ai(Tu,sT,"float32"),KK={kernelName:Tu,backendName:"cpu",kernelFunc:aT};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const iT=js(n=>Math.expm1(n)),ZK=ai(Nu,iT),BK={kernelName:Nu,backendName:"cpu",kernelFunc:ZK};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const oT=js(n=>Math.floor(n)),_K=ai(Ru,oT),HK={kernelName:Ru,backendName:"cpu",kernelFunc:_K};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const lT=qt((n,e)=>Math.floor(n/e)),UK=hn(Eu,lT,null,"int32"),jK={kernelName:Eu,backendName:"cpu",kernelFunc:UK};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function uT(n,e,t,r,s,i,l,u,c){const h=Je([r,i],t);for(let p=0;p<r;p++){const m=[];let g=0;for(let y=0;y<s;y++){const v=n[p*s+y];g+=v*l[y],m.push(v)}if(g<0||g>=c/i)throw new Error(`Invalid indices: ${m} does not index into ${u}`);for(let y=0;y<i;y++)h.values[p*i+y]=e.get(...e.indexToLoc(g*i+y))}return h}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cT(n,e,t){const r=Je(t,n.dtype);for(let s=0;s<r.size;++s){const i=r.indexToLoc(s).slice(),l=i[0],u=i[2],c=e.locToIndex([l,u]);i[2]=e.values[c];const h=n.locToIndex(i);0<=h&&h<n.values.length&&(r.values[s]=n.values[h])}return r}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const dT=qt((n,e)=>n>e?1:0),YK=hn(Th,dT,null,"bool"),QK={kernelName:Th,backendName:"cpu",kernelFunc:YK};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const hT=qt((n,e)=>n>=e?1:0),JK=hn(Lu,hT,null,"bool"),qK={kernelName:Lu,backendName:"cpu",kernelFunc:JK};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const pT=qt((n,e)=>n<e?1:0),eZ=hn(Rh,pT,null,"bool"),tZ={kernelName:Rh,backendName:"cpu",kernelFunc:eZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const fT=qt((n,e)=>n<=e?1:0),nZ=hn(Eh,fT,null,"bool"),rZ={kernelName:Eh,backendName:"cpu",kernelFunc:nZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mT(n,e,t){const r=(e-n)/(t-1),s=Pt(t,"float32");s[0]=n;for(let i=1;i<s.length;i++)s[i]=s[i-1]+r;return s}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const gT=js(n=>Math.log(n)),sZ=ai($u,gT),aZ={kernelName:$u,backendName:"cpu",kernelFunc:sZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function bT(n,e,t,r){const s=ge(r,M(t));for(let i=0;i<s.length;++i){const l=i*e;let u=n[l];for(let c=0;c<e;++c){const h=n[l+c];(Number.isNaN(h)||h>u)&&(u=h)}s[i]=u}return s}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const yT=qt((n,e)=>Math.max(n,e)),iZ=hn(Vu,yT),oZ={kernelName:Vu,backendName:"cpu",kernelFunc:iZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const xT=qt((n,e)=>Math.min(n,e)),lZ=hn(Pu,xT),uZ={kernelName:Pu,backendName:"cpu",kernelFunc:lZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Ey=qt((n,e)=>n*e),cZ=Ny((n,e,t,r)=>({real:n*t-e*r,imag:n*r+e*t})),tf=hn(Ou,Ey,cZ),dZ={kernelName:Ou,backendName:"cpu",kernelFunc:tf};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vT(n,e,t){const r=Oa(-1,t);return Ey([],e,r,n,t)}function hZ(n){const{inputs:e,backend:t}=n,{x:r}=e;$e(r,"neg");const s=t.data.get(r.dataId).values,[i,l]=vT(s,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,i)}const pZ={kernelName:Oh,backendName:"cpu",kernelFunc:hZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const wT=qt((n,e)=>n!==e?1:0),fZ=hn(Dh,wT,null,"bool"),mZ={kernelName:Dh,backendName:"cpu",kernelFunc:fZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ly(n,e,t,r,s){const i=e.length,l=M(e),u=we(e),c=we(s),h=ge(t,M(s));for(let p=0;p<l;++p){const m=Ao(p,i,u),g=new Array(m.length);for(let v=0;v<g.length;v++)g[v]=m[r[v]];const y=Fs(g,i,c);h[y]=n[p]}return h}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function rr(n){const{inputs:e,attrs:t,backend:r}=n,{x:s}=e,{perm:i}=t;$e(s,"transpose");const l=s.shape.length,u=new Array(l);for(let p=0;p<u.length;p++)u[p]=s.shape[i[p]];const c=r.data.get(s.dataId).values,h=Ly(c,s.shape,s.dtype,i,u);return{dataId:r.write(h,u,s.dtype),shape:u,dtype:s.dtype}}const gZ={kernelName:Zo,backendName:"cpu",kernelFunc:rr};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function kT(n,e,t,r){const[s,i]=mn(n,r),l=dr(e,"int32"),u=Pt(M(s),l),c=M(i);for(let h=0;h<u.length;++h){const p=h*c;let m=1;for(let g=0;g<c;++g)m*=t[p+g];u[h]=m}return{outVals:u,outShape:s,outDtype:l}}function bZ(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:l}=r;$e(s,"prod");const u=s.shape.length,c=oe(i,s.shape),h=Xt(c,u);let p=c,m=s;const g=[];h!=null&&(m=rr({inputs:{x:s},backend:t,attrs:{perm:h}}),g.push(m),p=Yt(p.length,u));const y=t.data.get(m.dataId).values,{outVals:v,outShape:w,outDtype:S}=kT(m.shape,m.dtype,y,p);let I=w;return l&&(I=nn(w,c)),g.forEach(C=>t.disposeIntermediateTensorInfo(C)),t.makeTensorInfo(I,S,v)}const yZ={kernelName:Hh,backendName:"cpu",kernelFunc:bZ};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xZ(n,e,t){n.forEach((r,s)=>{if(r<0||r>=t){const i=Ao(s,e.length,we(e)).join(",");throw new Error(`indices[${i}] = ${r} is not in [0, ${t})`)}})}function vZ(n,e){for(let t=0;t<n.length;++t){const r=n[t],s=t===n.length-1?e:n[t+1].length;if(r.length===0)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>s)throw new Error("Ragged splits must not point past values");for(let i=1;i<r.length;++i)if(r[i-1]>r[i])throw new Error("Ragged splits must be sorted in ascending order")}}function wZ(n,e,t,r){const s=[];let i=0;const l=e.length-1+t.length,u=new Array(l).fill(null).map(()=>[0]);vZ(t,r);let c=1;for(let h=0;h<e.length-1;++h){c*=e[h];const p=e[h+1];for(let m=1;m<c+1;++m)u[h].push(m*p)}for(let h=0;h<n.length;++h){let p=n[h],m=n[h]+1;for(let g=0;g<t.length;++g){const y=t[g],v=g+e.length-1;if(v>=0){const w=u[v],S=w[w.length-1]-y[p];for(let I=p;I<m;++I)u[v].push(y[I+1]+S)}p=y[p],m=y[m]}m!==p&&(s.push([p,m]),i+=m-p)}return{outSplits:u,valueSlices:s,numValues:i}}function kZ(n){const e=[];for(let t=0;t<n.length;++t){const r=n[t].length,s=be("int32",r);e.push(s),n[t].forEach((i,l)=>s[l]=i)}return e}function IT(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let r=e;r<n.length;r++)t[e-1]*=n[r];return t}function IZ(n,e,t,r,s,i){const l=IT(e,2)[1],u=IT(i,2)[1];let c=0;for(const h of t)for(let p=h[0];p<h[1];++p){for(let m=0;m<r;++m)s[c*u+m]=n[p*l+m];++c}}function SZ(n,e,t,r,s){const i=e.slice();i[0]=s;const l=be(t,M(i)),u=n.length,c=u===0?0:u/e[0];return IZ(n,e,r,c,l,i),[l,i]}function ST(n,e,t,r,s,i,l,u){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const c=e[0][0]-1;if(xZ(i,l,c),r.length===0)throw new Error("params.rank must be nonzero");const h=r[0],{outSplits:p,valueSlices:m,numValues:g}=wZ(i,l,n,h),y=kZ(p),v=SZ(t,r,s,m,g);return[y,v[0],v[1]]}/**
* @license
* Copyright 2022 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const CT=2147483647;function TT(n,e,t,r,s,i,l){if(e.length>1)throw new Error("starts must be a scalar or vector");if(s.length>1)throw new Error("limits must be a scalar or vector");if(l.length>1)throw new Error("deltas must be a scalar or vector");const u=e.length===0,c=s.length===0,h=l.length===0,p=[];u||p.push(e[0]),c||p.push(s[0]),h||p.push(l[0]);for(let S=1;S<p.length;++S)if(p[S]!==p[S-1])throw new Error("starts, limits, and deltas must have the same shape");const m=p.length===0?1:p[0],g=be("int32",m+1);g[0]=0;for(let S=0;S<m;++S){const I=u?n[0]:n[S],C=c?r[0]:r[S],R=h?i[0]:i[S];if(R===0)throw new Error("Requires delta != 0");let L;if(R>0&&C<I||R<0&&C>I)L=0;else if(L=Math.ceil(Math.abs((C-I)/R)),L>CT)throw new Error(`Requires ((limit - start) / delta) <= ${CT}`);g[S+1]=g[S]+L}const y=g[m],v=be(t,y);let w=0;for(let S=0;S<m;++S){const I=g[S+1]-g[S];let C=u?n[0]:n[S];const R=h?i[0]:i[S];for(let L=0;L<I;++L)v[w++]=C,C+=R}return[g,v]}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var qr=ms;class nf{constructor(e,t,r,s,i,l,u,c,h,p){this.shape=e,this.shapeShape=t,this.values=r,this.valuesShape=s,this.valuesDType=i,this.defaultValue=l,this.defaultValueShape=u,this.rowPartitionValues=c,this.rowPartitionValuesShapes=h,this.rowPartitionTypes=z2(p),this.raggedRank=W2(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===qr.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===qr.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case qr.VALUE_ROWIDS:return nf.getMaxWidthValueRowID(t);case qr.ROW_SPLITS:return nf.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${qr[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let r=0;for(let s=0;s<t-1;++s){const i=e[s+1]-e[s];i>r&&(r=i)}return r}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let r=0,s=e[0],i=0;for(let l=1;l<t;++l){const u=e[l];u!==s&&(s=u,i=Math.max(l-r,i),r=l)}return Math.max(t-r,i)}tensorShapeFromTensor(e,t,r=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return RT(e,r)}calculateOutputSize(e){const t=this.valuesShape,r=this.defaultValueShape;M2(r,t);const s=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=G2(this.raggedRank,s,t);i[0]<0&&(i[0]=e);for(let l=1;l<=this.raggedRank;++l)i[l]<0&&(i[l]=this.getMaxWidth(l));return i}calculateFirstParentOutputIndex(e,t,r){const s=Math.min(e,r),i=[];let l=0;for(let u=0;u<s;++u,l+=t)i.push(l);for(let u=s;u<e;++u)i.push(-1);return T(i.length===e,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(e,t,r,s){const i=e.length,l=[];for(let u=0;u<i-1;++u){const c=e[u+1]-e[u];let h=Math.min(s,c),p=t[u];p===-1&&(h=0);for(let m=0;m<h;++m)l.push(p),p+=r;for(let m=0;m<c-h;++m)l.push(-1)}if(i>0&&l.length!==e[i-1])throw new Error("Invalid row split size.");return l}calculateOutputIndexValueRowID(e,t,r,s){const i=e.length,l=[];if(i===0)return[];let u=0,c=e[0];if(c>=t.length)throw new Error(`Got currentValueRowId=${c}, which is not less than ${t.length}`);let h=t[c];l.push(h);for(let p=1;p<i;++p){const m=e[p];if(m===c)h>=0&&(++u,u<s?h+=r:h=-1);else{if(u=0,c=m,m>=t.length)throw new Error(`Got nextValueRowId=${m} which is not less than ${t.length}`);h=t[m]}l.push(h)}if(l.length!==e.length)throw new Error("Invalid row ids.");return l}calculateOutputIndex(e,t,r,s){const i=this.getRowPartitionTensor(e),l=this.getRowPartitionTypeByDimension(e);switch(l){case qr.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,r,s);case qr.ROW_SPLITS:if(i.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(i,t,r,s);default:throw new Error(`Unsupported partition type: ${qr[l]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case qr.FIRST_DIM_SIZE:return e[0];case qr.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case qr.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${qr[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*t[l+1];const s=RT(t,!1),i=be(this.valuesDType,M(s));if(r[0]*t[0]>0){let l=this.calculateFirstParentOutputIndex(e,r[0],t[0]);for(let u=1;u<=this.raggedRank;++u)l=this.calculateOutputIndex(u-1,l,r[u],t[u]);this.setOutput(this.raggedRank,l,i,s)}return[s,i]}setOutput(e,t,r,s){if(r.length===0)return;const i=this.values,l=r;let u=s.slice();u=u.slice(e+1);const c=M(u),h=t.length;let p=this.defaultValue;if(p.length!==c&&p.length!==1){const v=this.defaultValueShape;ee(()=>{const w=q(p,v);p=mc(w,u).dataSync()})}let m=0,g=0,y=0;for(let v=0;v<=h;++v){let w=v<h?t[v]:-1;if(w===y){++y;continue}if(g<y){const S=i.subarray(m*c),I=l.subarray(g*c),C=(y-g)*c;NT(I,S,C)}if(v>=h){const S=r.length;w=Math.floor(S/c)}if(w>y)if(this.defaultValue.length===1)l.subarray(y*c,w*c).fill(this.defaultValue[0]),y=w;else for(;w>y;){const S=l.slice(y*c);NT(S,p,c),++y}w<0?(m=v+1,g=y):(m=v,g=y,y=g+1)}}}function NT(n,e,t){for(let r=0;r<t;r++)n[r]=e[r]}function RT(n,e){const t=[];for(let r of n){if(r<0){if(!e)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}t.push(r)}return t}function ET(n,e,t,r,s,i,l,u,c,h){return new nf(n,e,t,r,s,i,l,u,c,h).compute()}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function LT(n,e,t,r){const s=n===e,i=n<e&&t<0,l=e<n&&t>1;if(s||i||l)return Pt(0,r);const u=Math.abs(Math.ceil((e-n)/t)),c=Pt(u,r);e<n&&t===1&&(t=-1),c[0]=n;for(let h=1;h<c.length;h++)c[h]=c[h-1]+t;return c}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const GT=js(n=>1/Math.sqrt(n)),CZ=ai(_u,GT),TZ={kernelName:_u,backendName:"cpu",kernelFunc:CZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ho(n,e,t,r,s,i,l,u,c,h){const p=[r/s,s],m=n.values,g=e.values;if(r===0)return Je(t,e.dtype);const y=c instanceof wn?c:Je(p,e.dtype);typeof c=="string"||typeof c=="number"?y.values.fill(c):typeof c=="boolean"&&y.values.fill(+c);for(let v=0;v<i;v++){const w=[];let S=0;for(let I=0;I<l;I++){const C=m[v*l+I];w.push(C),S+=C*u[I]}if(S<0||S>=r/s)throw new Error(`Invalid indices: ${w} does not index into ${t}`);for(let I=0;I<s;I++)h?y.values[S*s+I]+=g[v*s+I]:y.values[S*s+I]=e.rank===0?g[0]:g[v*s+I]}return y}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const NZ=js(n=>1/(1+Math.exp(-n))),zT=ft(Qu,n=>1/(1+Math.exp(-n))),RZ={kernelName:Qu,backendName:"cpu",kernelFunc:zT};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function WT(n,e,t,r,s){const i=xb(r,e,t),l=M(t),u=we(r);if(i){const m=vb(e,u);return s==="string"?n.slice(m,m+l):n.subarray(m,m+l)}const c=s==="string"?ba(n):n,h=Je(r,s,c),p=Je(t,s);for(let m=0;m<p.size;++m){const g=p.indexToLoc(m),y=g.map((v,w)=>v+e[w]);p.set(h.get(...y),...g)}return s==="string"?nI(p.values):p.values}function po(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{begin:i,size:l}=r;$e(s,"slice");const[u,c]=Cp(s,i,l);bb(s,u,c);const h=t.data.get(s.dataId).values,p=WT(h,u,c,s.shape,s.dtype);return t.makeTensorInfo(c,s.dtype,p)}const EZ={kernelName:qh,backendName:"cpu",kernelFunc:po};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function MT(n,e,t,r,s,i,l){const u=e[0],c=i[0],h=new Array(c),p=new Array(u),m=e[1];if(c===0){if(u!==0)throw new Error(K2(u));const S=be(t,0),I=be(s,0);return[S,[0,m],I,h,p]}let g=!0,y=0;const v=new Array(c).fill(0);for(let S=0;S<u;++S){const I=n[S*m];if(I<0)throw new Error(Z2(S,I));if(I>=c)throw new Error(B2(S,I,c));++v[I],g=g&&I>=y,y=I}let w=!0;for(let S=0;S<c;++S){const I=v[S]===0;h[S]=I,w=w&&!I,v[S]=Math.max(v[S],1),S>0&&(v[S]+=v[S-1])}if(w&&g){const S=n,I=r;for(let C=0;C<u;++C)p[C]=C;return[S,[u,m],I,h,p]}else{const S=v[c-1],I=be(t,S*m),C=be(s,S),R=new Array(c).fill(0);for(let L=0;L<u;++L){const G=n[L*m],$=R[G],F=(G===0?0:v[G-1])+$;R[G]++;for(let V=0;V<m;++V)I[F*m+V]=n[L*m+V];C[F]=r[L],p[L]=F}for(let L=0;L<c;++L)if(R[L]===0){const G=L===0?0:v[L-1];I[G*m+0]=L;for(let $=1;$<m;++$)I[G*m+$]=0;C[G]=l}return[I,[S,m],C,h,p]}}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function $T(n,e,t,r,s){const i=M(r),l=e[0],u=s.length,c=[];let h=1,p=-1;for(let w=0;w<u;++w){const S=s[w];if(S===-1){if(p!==-1)throw new Error(_2(p,w));p=w,c.push(1)}else{if(S<0)throw new Error(H2(w,S));h*=S,c.push(S)}}if(p!==-1){if(h<=0)throw new Error(U2());const w=Math.trunc(i/h);if(h*w!==i)throw new Error(j2(r,c));c[p]=w}if(M(c)!==i)throw new Error(Y2(r,c));const m=r.length,g=[];if(m>0){g[m-1]=1;for(let w=m-2;w>=0;--w)g[w]=g[w+1]*r[w+1]}const y=[];if(u>0){y[u-1]=1;for(let w=u-2;w>=0;--w)y[w]=y[w+1]*c[w+1]}const v=be(t,l*u);for(let w=0;w<l;++w){let S=0;for(let I=0;I<m;++I)S+=n[w*m+I]*g[I];for(let I=0;I<u;++I)v[w*u+I]=Math.trunc(S/y[I]),S%=y[I]}return[v,[l,u],c]}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Gy(n,e,t,r,s,i=!1,l=0){const u=r.length,c=[e[0],n.length/e[0]],h=c[1],p=u>0?s[u-1]+1:0;if(p<0)throw new Error(Db());const m=e.slice();m[0]=p;const g=m.reduce((C,R)=>C*R,1),y=be(t,g);if(u===0)return p>0&&y.fill(l),[y,m];if(p<=0)throw new Error(Db());let v=0,w=1,S=0,I=s[v];for(;;){let C=0;if(w<u){if(C=s[w],I===C){++w;continue}if(I>=C)throw new Error(Q2())}if(I<0||I>=p)throw new Error(J2(I,p));I>S&&y.fill(l,S*h,I*h);for(let R=v;R<w;++R){const L=r[R];if(L<0||L>=c[0])throw new Error(q2(R,r[R],c[0]));for(let G=0;G<h;G++)y[I*h+G]+=n[L*h+G]}if(i)for(let R=0;R<h;R++)y[I*h+R]/=w-v;if(v=w,++w,S=I+1,I=C,w>u)break}return S<p&&y.fill(l,S*h,p*h),[y,m]}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const LZ=js(n=>Math.sqrt(n)),GZ=ft(qu,n=>Math.sqrt(n)),zZ={kernelName:qu,backendName:"cpu",kernelFunc:GZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const FT=qt((n,e)=>{const t=n-e;return t*t}),WZ=hn(ec,FT),MZ={kernelName:ec,backendName:"cpu",kernelFunc:WZ};/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const VT=js((n,e)=>{const{pattern:t,replaceGlobal:r,rewrite:s}=e;return n.replace(new RegExp(t,r?"g":""),s)}),$Z=ai(l0,VT),FZ={kernelName:l0,backendName:"cpu",kernelFunc:$Z};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function PT(n,e,t,r){const s=Je(n,e.dtype);for(let i=0;i<s.size;i++){const l=s.indexToLoc(i),u=new Array(l.length);for(let c=0;c<u.length;c++)u[c]=l[c]*t[c]+r[c];s.set(e.get(...u),...l)}return s}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class VZ{constructor(e,t,r,s,i,l){this.separator=Da(e),this.nGramWidths=t,this.leftPad=Da(r),this.rightPad=Da(s),this.padWidth=i,this.preserveShort=l}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const r=this.getPadWidth(t);return Math.max(0,e+2*r-t+1)}createNGrams(e,t,r,s,i,l){for(let u=0;u<i;++u){const c=this.getPadWidth(l),h=Math.max(0,c-u),p=Math.max(0,c-(i-(u+1))),m=l-(h+p),g=t+(h>0?0:u-c);let y=0;y+=h*this.leftPad.length;for(let C=0;C<m;++C)y+=e[g+C].length;y+=p*this.rightPad.length;const v=h+p+m-1;y+=v*this.separator.length,r[s+u]=new Uint8Array(y);const w=r[s+u];let S=0;const I=C=>C.forEach(R=>w[S++]=R);for(let C=0;C<h;++C)I(this.leftPad),I(this.separator);for(let C=0;C<m-1;++C)I(e[g+C]),I(this.separator);if(m>0){I(e[g+m-1]);for(let C=0;C<p;++C)I(this.separator),I(this.rightPad)}else{for(let C=0;C<p-1;++C)I(this.rightPad),I(this.separator);I(this.rightPad)}}}compute(e,t){const r=e.length,s=t.length;if(s>0){let c=t[0];if(c!==0)throw new Error(`First split value must be 0, got ${c}`);for(let h=1;h<s;++h){let p=t[h]>=c;if(p=p&&t[h]<=r,!p)throw new Error(`Invalid split value ${t[h]}, must be in [${c}, ${r}]`);c=t[h]}if(c!==r)throw new Error(`Last split value must be data size. Expected ${r}, got ${c}`)}const i=s-1,l=be("int32",s);if(r===0||s===0){const c=new Array(r);for(let h=0;h<=i;++h)l[h]=0;return[c,l]}l[0]=0;for(let c=1;c<=i;++c){const h=t[c]-t[c-1];let p=0;this.nGramWidths.forEach(m=>{p+=this.getNumNGrams(h,m)}),this.preserveShort&&h>0&&p===0&&(p=1),l[c]=l[c-1]+p}const u=new Array(l[i]);for(let c=0;c<i;++c){const h=t[c];let p=l[c];if(this.nGramWidths.forEach(m=>{const g=t[c+1]-t[c],y=this.getNumNGrams(g,m);this.createNGrams(e,h,u,p,y,m),p+=y}),this.preserveShort&&p===l[c]){const m=t[c+1]-t[c];if(m===0)continue;const g=m+2*this.padWidth;this.createNGrams(e,h,u,p,1,g)}}return[u,l]}}function XT(n,e,t,r,s,i,l,u){return new VZ(t,r,s,i,l,u).compute(n,e)}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function PZ(n,e,t,r){if(!n.length)return;if(e.length===0){for(let i=0;i<n.length;++i)r.push(n.subarray(i,i+1));return}if(e.length===1){const i=e[0];let l=n.indexOf(i);for(;l!==-1;){const u=n.subarray(0,l);(!t||u.length!==0)&&r.push(u),n=n.subarray(l+1),l=n.indexOf(i)}(!t||n.length!==0)&&r.push(n);return}let s=0;for(let i=0;i<n.length+1;i++)if(i===n.length||e.indexOf(n[i])!==-1){const l=n.subarray(s,i);(!t||l.length!==0)&&r.push(l),s=i+1}}function OT(n,e,t){const r=n.length,s=[];let i=0,l=0;const u=new Array(r);for(let g=0;g<r;++g){const y=s.length;PZ(n[g],e,t,s);const v=s.length-y;u[g]=v,i+=v,l=Math.max(l,v)}const c=be("int32",i*2),h=new Array(i),p=[r,l];let m=0;for(let g=0;g<r;++g)for(let y=0;y<u[g];++y)c[m*2]=g,c[m*2+1]=y,h[m]=s[m],++m;return[c,h,p]}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function DT(n,e){const t=be("int32",n.length);for(let r=0;r<n.length;++r)t[r]=IW(n[r]).modulo(e).getLowBitsUnsigned();return t}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const AT=qt((n,e)=>n-e),XZ=Ny((n,e,t,r)=>({real:n-t,imag:e-r})),zy=hn(tc,AT,XZ),OZ={kernelName:tc,backendName:"cpu",kernelFunc:zy};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function KT(n,e){const t=new Array(n.rank);for(let s=0;s<t.length;s++)t[s]=n.shape[s]*e[s];const r=Je(t,n.dtype);for(let s=0;s<r.values.length;++s){const i=r.indexToLoc(s),l=new Array(n.rank);for(let c=0;c<l.length;c++)l[c]=i[c]%n.shape[c];const u=n.locToIndex(l);r.values[s]=n.values[u]}return r}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Ac=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function ZT(n,e,t=0,r=n.length-1){for(;r>t;){if(r-t>600){const u=r-t+1,c=e-t+1,h=Math.log(u),p=.5*Math.exp(2*h/3),m=.5*Math.sqrt(h*p*(u-p)/u)*Math.sign(c-u/2),g=Math.max(t,Math.floor(e-c*p/u+m)),y=Math.min(r,Math.floor(e+(u-c)*p/u+m));ZT(n,e,g,y)}const s=n[e];let i=t,l=r;for(z(n,t,e),Ac(n[r],s)>0&&z(n,t,r);i<l;){for(z(n,i,l),i++,l--;Ac(n[i],s)<0;)i=i+1;for(;Ac(n[l],s)>0;)l=l-1}Ac(n[t],s)===0?z(n,t,l):(l=l+1,z(n,l,r)),l<=e&&(t=l+1),e<=l&&(r=l-1)}}function BT(n,e,t,r,s){const i=e[e.length-1],[l,u]=[n.length/i,i],c=ge(t,l*r),h=ge("int32",l*r);for(let m=0;m<l;m++){const g=m*u,y=n.subarray(g,g+u);let v=new Array(y.length);y.forEach((C,R)=>v[R]={value:C,index:R}),r<v.length&&(ZT(v,r),v=v.slice(0,r)),s&&v.sort(Ac);const w=m*r,S=c.subarray(w,w+r),I=h.subarray(w,w+r);for(let C=0;C<r;C++)S[C]=v[C].value,I[C]=v[C].index}const p=e.slice();return p[p.length-1]=r,[Je(p,t,c),Je(p,"int32",h)]}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _T(n,e,t,r){const s=oe(e,t)[0],i=[1,t[0],1];for(let v=0;v<s;v++)i[0]*=t[v];i[1]=t[s];for(let v=s+1;v<t.length;v++)i[2]*=t[v];const l=new Map,u=new Int32Array(t[s]),c=new wn(i,r,n),h=[],p=i[0]===1&&i[2]===1;for(let v=0;v<t[s];v++){let w;if(p)w=n[v].toString();else{const I=[];for(let C=0;C<i[0];C++)for(let R=0;R<i[2];R++)I.push(c.get(C,v,R));w=I.join(",")}const S=l.get(w);if(S!=null)u[v]=S;else{const I=l.size;l.set(w,I),u[v]=I,h.push(v)}}const m=i.slice();m[1]=l.size;const g=new wn(m,r);h.forEach((v,w)=>{for(let S=0;S<i[0];S++)for(let I=0;I<i[2];I++)g.set(c.get(S,v,I),S,w,I)});const y=t.slice();return y[s]=m[1],{outputValues:g.values,outputShape:y,indices:u}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const DZ=Object.freeze(Object.defineProperty({__proto__:null,addImpl:QC,bincountImpl:Ry,bincountReduceImpl:JC,bitwiseAndImpl:qC,castImpl:YC,ceilImpl:eT,concatImpl:tT,equalImpl:nT,expImpl:sT,expm1Impl:iT,floorDivImpl:lT,floorImpl:oT,gatherNdImpl:uT,gatherV2Impl:cT,greaterEqualImpl:hT,greaterImpl:dT,lessEqualImpl:fT,lessImpl:pT,linSpaceImpl:mT,logImpl:gT,maxImpl:bT,maximumImpl:yT,minimumImpl:xT,multiplyImpl:Ey,negImpl:vT,notEqualImpl:wT,prodImpl:kT,raggedGatherImpl:ST,raggedRangeImpl:TT,raggedTensorToTensorImpl:ET,rangeImpl:LT,rsqrtImpl:GT,scatterImpl:ho,sigmoidImpl:NZ,simpleAbsImpl:jC,sliceImpl:WT,sparseFillEmptyRowsImpl:MT,sparseReshapeImpl:$T,sparseSegmentReductionImpl:Gy,sqrtImpl:LZ,squaredDifferenceImpl:FT,staticRegexReplaceImpl:VT,stridedSliceImpl:PT,stringNGramsImpl:XT,stringSplitImpl:OT,stringToHashBucketFastImpl:DT,subImpl:AT,tileImpl:KT,topKImpl:BT,transposeImpl:Ly,uniqueImpl:_T},Symbol.toStringTag,{value:"Module"}));/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/gk("cpu",()=>new qp,1);/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const HT=ft(Su,n=>n>=0?n:Math.exp(n)-1),AZ={kernelName:Su,backendName:"cpu",kernelFunc:HT};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function UT(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{alpha:i}=r;$e([s],"leakyRelu");const l=M(s.shape),u=t.data.get(s.dataId).values,c=ge("float32",l);for(let h=0;h<u.length;h++)c[h]=u[h]<0?i*u[h]:u[h];return t.makeTensorInfo(s.shape,"float32",c)}const KZ={kernelName:Nh,backendName:"cpu",kernelFunc:UT};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ZZ=qt((n,e)=>n<0?e*n:n);function jT(n){const{inputs:e,backend:t}=n,{x:r,alpha:s}=e;$e([r,s],"prelu");const i=t.data.get(r.dataId).values,l=t.data.get(s.dataId).values,[u,c]=ZZ(r.shape,s.shape,i,l,"float32");return t.makeTensorInfo(c,"float32",u)}const BZ={kernelName:_h,backendName:"cpu",kernelFunc:jT};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const YT=ft(Ku,n=>Math.max(0,n)),_Z={kernelName:Ku,backendName:"cpu",kernelFunc:YT};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const QT=ft(Zu,n=>Math.min(Math.max(0,n),6)),HZ={kernelName:Zu,backendName:"cpu",kernelFunc:QT};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function rf(n,e,t,r,s){if(t==="linear")return Us({inputs:{x:e},backend:n});if(t==="relu")return YT({inputs:{x:e},backend:n});if(t==="elu")return HT({inputs:{x:e},backend:n});if(t==="relu6")return QT({inputs:{x:e},backend:n});if(t==="prelu")return jT({inputs:{x:e,alpha:r},backend:n});if(t==="leakyrelu")return UT({inputs:{x:e},backend:n,attrs:{alpha:s}});if(t==="sigmoid")return zT({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function kt(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{shape:i}=r,l=M(s.shape),u=ie(i,l),c=M(u);T(l===c,()=>`The new shape (${u}) has ${c} elements and the old shape (${s.shape}) has ${l} elements. The new shape and old shape must have the same number of elements.`),t.incRef(s.dataId);const h=t.data.get(s.dataId);if(h.complexTensorInfos!=null){const p=h.complexTensorInfos.real,m=h.complexTensorInfos.imag;p.shape=u,m.shape=u}return{dataId:s.dataId,shape:u,dtype:s.dtype}}const UZ={kernelName:Uh,backendName:"cpu",kernelFunc:kt};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function JT(n){const{inputs:e,backend:t,attrs:r}=n,{a:s,b:i}=e,{transposeA:l,transposeB:u}=r;$e([s,i],"matMul");const c=s.shape.length,h=i.shape.length,p=l?s.shape[c-2]:s.shape[c-1],m=u?i.shape[h-1]:i.shape[h-2],g=l?s.shape[c-1]:s.shape[c-2],y=u?i.shape[h-2]:i.shape[h-1],v=s.shape.slice(0,-2),w=i.shape.slice(0,-2),S=M(v),I=M(w),C=Ye(s.shape.slice(0,-2),i.shape.slice(0,-2)).concat([g,y]);T(p===m,()=>`Error in matMul: inner shapes (${p}) and (${m}) of Tensors with shapes ${s.shape} and ${i.shape} and transposeA=${l} and transposeB=${u} must match.`);const R=l?[S,p,g]:[S,g,p],L=u?[I,y,m]:[I,m,y],G=kt({inputs:{x:s},backend:t,attrs:{shape:R}}),$=kt({inputs:{x:i},backend:t,attrs:{shape:L}}),F=l?G.shape[1]:G.shape[2],V=l?G.shape[2]:G.shape[1],D=u?$.shape[1]:$.shape[2],Z=Math.max(S,I),ne=t.data.get(G.dataId).values,re=t.data.get($.dataId).values,se=we(G.shape),ue=we($.shape),[le,he,me]=l?[se[0],1,se[1]]:[se[0],se[1],1],[pe,ye,Ie]=u?[1,ue[1],ue[0]]:[ue[1],1,ue[0]],ve=V*D,Ce=Je([Z,V,D],G.dtype),Te=Ce.values,Re=t.blockSize;for(let Le=0;Le<Z;Le++){const De=Le%S,Pe=Le%I;for(let Ae=0;Ae<V;Ae+=Re){const Ue=Math.min(Ae+Re,V);for(let je=0;je<D;je+=Re){const tt=Math.min(je+Re,D);for(let ut=0;ut<F;ut+=Re){const Dt=Math.min(ut+Re,F);for(let Rt=Ae;Rt<Ue;Rt++)for(let It=je;It<tt;It++){let St=0;for(let Et=ut;Et<Dt;Et++){const en=ne[De*le+Rt*he+Et*me],ka=re[Et*pe+It*ye+Pe*Ie];St+=en*ka}Te[Le*ve+(Rt*D+It)]+=St}}}}}return t.disposeIntermediateTensorInfo(G),t.disposeIntermediateTensorInfo($),t.makeTensorInfo(C,Ce.dtype,Ce.values)}const jZ={kernelName:hh,backendName:"cpu",kernelFunc:JT};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function YZ(n){const{inputs:e,backend:t,attrs:r}=n,{a:s,b:i,bias:l,preluActivationWeights:u}=e,{transposeA:c,transposeB:h,activation:p,leakyreluAlpha:m}=r;let g,y,v;const w=[];g=JT({inputs:{a:s,b:i},attrs:{transposeA:c,transposeB:h},backend:t}),l&&(y=hl({inputs:{a:g,b:l},backend:t}),w.push(g),g=y),p&&(v=rf(t,g,p,u,m),w.push(g),g=v);for(const S of w)t.disposeIntermediateTensorInfo(S);return g}const QZ={kernelName:op,backendName:"cpu",kernelFunc:YZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const JZ=ft(du,n=>Math.acos(n)),qZ={kernelName:du,backendName:"cpu",kernelFunc:JZ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const e4=ft(hu,n=>Math.acosh(n)),t4={kernelName:hu,backendName:"cpu",kernelFunc:e4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function n4(n){const{inputs:e,backend:t}=n,r=e;$e(e,"addN");const s=r.map(u=>t.data.get(u.dataId).values),i=Je(r[0].shape,r[0].dtype),l=i.values;for(let u=0;u<r.length;u++){const c=s[u];for(let h=0;h<l.length;h++)l[h]+=c[h]}return t.makeTensorInfo(i.shape,i.dtype,i.values)}const r4={kernelName:Cg,backendName:"cpu",kernelFunc:n4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function s4(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:l}=r;$e(s,"all");const u=oe(i,s.shape);let c=u;const h=Xt(c,s.shape.length);let p=s;h!=null&&(p=rr({inputs:{x:s},backend:t,attrs:{perm:h}}),c=Yt(c.length,s.shape.length)),In("all",c,p.shape.length);const[m,g]=mn(p.shape,c),y=M(g),v=Pt(M(m),p.dtype),w=t.data.get(p.dataId).values;for(let I=0;I<v.length;++I){const C=I*y;let R=w[C];for(let L=0;L<y;++L){const G=w[C+L];R=R&&G}v[I]=R}h!=null&&t.disposeIntermediateTensorInfo(p);const S=t.makeTensorInfo(m,p.dtype,v);if(l){const I=nn(m,u),C=kt({inputs:{x:S},backend:t,attrs:{shape:I}});return t.disposeIntermediateTensorInfo(S),C}return S}const a4={kernelName:Tg,backendName:"cpu",kernelFunc:s4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function i4(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:l}=r;$e(s,"any");const u=oe(i,s.shape);let c=u;const h=Xt(c,s.shape.length);let p=s;h!=null&&(p=rr({inputs:{x:s},backend:t,attrs:{perm:h}}),c=Yt(c.length,s.shape.length)),In("any",c,p.shape.length);const[m,g]=mn(p.shape,c),y=M(g),v=Pt(M(m),p.dtype),w=t.data.get(p.dataId).values;for(let I=0;I<v.length;++I){const C=I*y;let R=w[C];for(let L=0;L<y;++L){const G=w[C+L];R=R||G}v[I]=R}h!=null&&t.disposeIntermediateTensorInfo(p);const S=t.makeTensorInfo(m,p.dtype,v);if(l){const I=nn(m,u),C=kt({inputs:{x:S},backend:t,attrs:{shape:I}});return t.disposeIntermediateTensorInfo(S),C}return S}const o4={kernelName:Ng,backendName:"cpu",kernelFunc:i4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function l4(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i}=r;$e(s,"argMax");let l=oe(i,s.shape);const u=Xt(l,s.shape.length);let c=s;const h=[];u!=null&&(c=rr({inputs:{x:s},backend:t,attrs:{perm:u}}),h.push(c),l=Yt(l.length,c.shape.length)),l=[l[0]],In("argMax",l,c.shape.length);const[p,m]=mn(c.shape,l),g=M(p),y=Pt(g,"int32"),v=M(m),w=t.data.get(c.dataId).values;for(let S=0;S<y.length;++S){const I=S*v;let C=w[I],R=0;for(let L=0;L<v;++L){const G=w[I+L];G>C&&(C=G,R=L)}y[S]=R}return h.forEach(S=>t.disposeIntermediateTensorInfo(S)),t.makeTensorInfo(p,"int32",y)}const u4={kernelName:lh,backendName:"cpu",kernelFunc:l4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function c4(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i}=r;$e(s,"argMin");let l=oe(i,s.shape);const u=Xt(l,s.shape.length);let c=s;const h=[];u!=null&&(c=rr({inputs:{x:s},backend:t,attrs:{perm:u}}),h.push(c),l=Yt(l.length,c.shape.length)),l=[l[0]],In("argMin",l,c.shape.length);const[p,m]=mn(c.shape,l),g=M(p),y=Pt(g,"int32"),v=M(m),w=t.data.get(c.dataId).values;for(let S=0;S<y.length;++S){const I=S*v;let C=w[I],R=0;for(let L=0;L<v;++L){const G=w[I+L];G<C&&(C=G,R=L)}y[S]=R}return h.forEach(S=>t.disposeIntermediateTensorInfo(S)),t.makeTensorInfo(p,"int32",y)}const d4={kernelName:uh,backendName:"cpu",kernelFunc:c4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const h4=ft(pu,n=>Math.asin(n)),p4={kernelName:pu,backendName:"cpu",kernelFunc:h4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const f4=ft(fu,n=>Math.asinh(n)),m4={kernelName:fu,backendName:"cpu",kernelFunc:f4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const g4=ft(mu,n=>Math.atan(n)),b4={kernelName:mu,backendName:"cpu",kernelFunc:g4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const y4=qt((n,e)=>Math.atan2(n,e)),x4=hn(bu,y4),v4={kernelName:bu,backendName:"cpu",kernelFunc:x4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const w4=ft(gu,n=>Math.atanh(n)),k4={kernelName:gu,backendName:"cpu",kernelFunc:w4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Wy(n,e,t,r,s,i){const l=s.strideHeight,u=s.strideWidth,c=s.dilationHeight,h=s.dilationWidth,p=s.effectiveFilterHeight,m=s.effectiveFilterWidth,g=s.padInfo.top,y=s.padInfo.left,v=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=Je(s.outShape,t),S=w.values,I=s.outShape[1]*s.outShape[2]*s.outShape[3],C=s.outShape[2]*s.outShape[3],R=s.outShape[3];for(let L=0;L<s.batchSize;++L){const G=L*I,$=L*r[0];for(let F=0;F<s.inChannels;++F)for(let V=0;V<s.outHeight;++V){const D=V*l-g,Z=Math.max(0,D),ne=Math.min(s.inHeight,p+D),re=G+V*C;for(let se=0;se<s.outWidth;++se){const ue=se*u-y,le=Math.max(0,ue),he=Math.min(s.inWidth,m+ue);let me=v,pe=0,ye=0;for(let ve=Z;ve<ne;ve+=c){const Ce=$+ve*r[1];for(let Te=le;Te<he;Te+=h){const Re=Ce+Te*r[2],Le=n[Re+F];i==="max"&&Le>me?me=Le:i==="avg"&&(pe+=Le,ye++)}if(isNaN(me))break}const Ie=re+se*R+F;S[Ie]=i==="avg"?pe/ye:me}}}return w}function qT(n,e,t,r,s=!1,i=!1){const l=Je(r.outShape,"int32"),u=r.strideHeight,c=r.strideWidth,h=r.dilationHeight,p=r.dilationWidth,m=r.effectiveFilterHeight,g=r.effectiveFilterWidth,y=r.padInfo.top,v=r.padInfo.left,w=Je(e,t,n);for(let S=0;S<r.batchSize;++S)for(let I=0;I<r.inChannels;++I)for(let C=0;C<r.outHeight;++C){const R=C*u-y;let L=R;for(;L<0;)L+=h;const G=Math.min(r.inHeight,m+R);for(let $=0;$<r.outWidth;++$){const F=$*c-v;let V=F;for(;V<0;)V+=p;const D=Math.min(r.inWidth,g+F);let Z=Number.NEGATIVE_INFINITY,ne=-1;for(let re=L;re<G;re+=h){const se=re-R;for(let ue=V;ue<D;ue+=p){const le=ue-F,he=w.get(S,re,ue,I);he>Z&&(Z=he,s?ne=i?((S*r.inHeight+re)*r.inWidth+ue)*r.inChannels+I:(re*r.inWidth+ue)*r.inChannels+I:ne=se*g+le)}}l.set(ne,S,C,$,I)}}return l}function eN(n,e,t,r,s,i){const l=s.strideDepth,u=s.strideHeight,c=s.strideWidth,h=s.dilationDepth,p=s.dilationHeight,m=s.dilationWidth,g=s.effectiveFilterDepth,y=s.effectiveFilterHeight,v=s.effectiveFilterWidth,w=s.padInfo.front,S=s.padInfo.top,I=s.padInfo.left,C=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,R=Je(s.outShape,t),L=R.values,G=s.outShape[1]*s.outShape[2]*s.outShape[3]*s.outShape[4],$=s.outShape[2]*s.outShape[3]*s.outShape[4],F=s.outShape[3]*s.outShape[4],V=s.outShape[4];for(let D=0;D<s.batchSize;++D){const Z=D*G,ne=D*r[0];for(let re=0;re<s.inChannels;++re)for(let se=0;se<s.outDepth;++se){const ue=se*l-w;let le=ue;for(;le<0;)le+=h;const he=Math.min(s.inDepth,g+ue),me=Z+se*$;for(let pe=0;pe<s.outHeight;++pe){const ye=pe*u-S;let Ie=ye;for(;Ie<0;)Ie+=p;const ve=Math.min(s.inHeight,y+ye),Ce=me+pe*F;for(let Te=0;Te<s.outWidth;++Te){const Re=Te*c-I;let Le=Re;for(;Le<0;)Le+=m;const De=Math.min(s.inWidth,v+Re),Pe=Ce+Te*V;let Ae=C,Ue=0,je=0;for(let ut=le;ut<he;ut+=h){const Dt=ne+ut*r[1];for(let Rt=Ie;Rt<ve;Rt+=p){const It=Dt+Rt*r[2];for(let St=Le;St<De;St+=m){const Et=It+St*r[3],en=n[Et+re];if(i==="max"&&en>Ae?Ae=en:i==="avg"&&(Ue+=en,je++),isNaN(Ae))break}if(isNaN(Ae))break}if(isNaN(Ae))break}const tt=Pe+re;L[tt]=i==="avg"?Ue/Math.max(je,1):Ae}}}}return R}function I4(n,e){const t=Je(e.outShape,"int32"),r=e.strideDepth,s=e.strideHeight,i=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,h=e.effectiveFilterDepth,p=e.effectiveFilterHeight,m=e.effectiveFilterWidth,g=e.padInfo.front,y=e.padInfo.top,v=e.padInfo.left;for(let w=0;w<e.batchSize;++w)for(let S=0;S<e.inChannels;++S)for(let I=0;I<e.outDepth;++I){const C=I*r-g;let R=C;for(;R<0;)R+=l;const L=Math.min(e.inDepth,h+C);for(let G=0;G<e.outHeight;++G){const $=G*s-y;let F=$;for(;F<0;)F+=u;const V=Math.min(e.inHeight,p+$);for(let D=0;D<e.outWidth;++D){const Z=D*i-v;let ne=Z;for(;ne<0;)ne+=c;const re=Math.min(e.inWidth,m+Z);let se=Number.NEGATIVE_INFINITY,ue=-1;for(let le=R;le<L;le+=l){const he=le-C;for(let me=F;me<V;me+=u){const pe=me-$;for(let ye=ne;ye<re;ye+=c){const Ie=ye-Z,ve=n.get(w,le,me,ye,S);ve>=se&&(se=ve,ue=he*p*m+pe*p+Ie)}}}t.set(ue,w,I,G,D,S)}}}return t}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function S4(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;$e(s,"avgPool");const{filterSize:i,strides:l,pad:u,dimRoundingMode:c}=r,h=1;T(Rn(l,h),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${l} and dilations '${h}'`);const p=_r(s.shape,i,l,h,u,c);let m;if(p.filterWidth===1&&p.filterHeight===1&&B(p.inShape,p.outShape))m=Us({inputs:{x:s},backend:t});else{const g=t.data.get(s.dataId).values,y=we(s.shape),v=Wy(g,s.shape,s.dtype,y,p,"avg");m=t.makeTensorInfo(p.outShape,s.dtype,v.values)}return m}const C4={kernelName:ch,backendName:"cpu",kernelFunc:S4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function T4(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{filterSize:i,strides:l,pad:u,dimRoundingMode:c,dataFormat:h}=r;$e(s,"avgPool3d");const p=ha(s.shape,i,l,1,u,c,h),m=t.data.get(s.dataId).values,g=eN(m,s.shape,s.dtype,we(s.shape),p,"avg");return t.makeTensorInfo(g.shape,"float32",g.values)}const N4={kernelName:dh,backendName:"cpu",kernelFunc:T4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function R4(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i}=e,{filterSize:l,strides:u,pad:c,dimRoundingMode:h}=r;$e([s,i],"avgPool3DGrad");const p=ha(i.shape,l,u,1,c,h),m=p.strideDepth,g=p.strideHeight,y=p.strideWidth,v=p.filterDepth,w=p.filterHeight,S=p.filterWidth,I=p.dilationDepth,C=p.dilationHeight,R=p.dilationWidth,L=p.effectiveFilterDepth,G=p.effectiveFilterHeight,$=p.effectiveFilterWidth,F=L-1-p.padInfo.front,V=$-1-p.padInfo.left,D=G-1-p.padInfo.top,Z=Je(i.shape,"float32"),ne=1/(v*w*S),re=t.bufferSync(s);for(let se=0;se<p.batchSize;++se)for(let ue=0;ue<p.inChannels;++ue)for(let le=0;le<p.inDepth;++le)for(let he=0;he<p.inHeight;++he)for(let me=0;me<p.inWidth;++me){const pe=le-F,ye=he-D,Ie=me-V;let ve=0;for(let Ce=0;Ce<L;Ce+=I){const Te=(pe+Ce)/m;if(!(Te<0||Te>=p.outDepth||Math.floor(Te)!==Te))for(let Re=0;Re<G;Re+=C){const Le=(ye+Re)/g;if(!(Le<0||Le>=p.outHeight||Math.floor(Le)!==Le))for(let De=0;De<$;De+=R){const Pe=(Ie+De)/y;if(Pe<0||Pe>=p.outWidth||Math.floor(Pe)!==Pe)continue;const Ae=re.get(se,Te,Le,Pe,ue);ve+=Ae}}}Z.set(ve*ne,se,le,he,me,ue)}return t.makeTensorInfo(Z.shape,Z.dtype,Z.values)}const E4={kernelName:Eg,backendName:"cpu",kernelFunc:R4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function L4(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i}=e,l=i;$e([s,i],"avgPoolGrad");const{filterSize:u,strides:c,pad:h}=r,p=_r(l.shape,u,c,1,h),m=p.strideHeight,g=p.strideWidth,y=p.filterHeight,v=p.filterWidth,w=p.dilationHeight,S=p.dilationWidth,I=p.effectiveFilterHeight,C=p.effectiveFilterWidth,R=C-1-p.padInfo.left,L=I-1-p.padInfo.top,G=Je(l.shape,"float32"),$=1/(y*v),F=t.data.get(s.dataId).values,V=Je(s.shape,"float32",F);for(let D=0;D<p.batchSize;++D)for(let Z=0;Z<p.inChannels;++Z)for(let ne=0;ne<p.inHeight;++ne)for(let re=0;re<p.inWidth;++re){const se=ne-L,ue=re-R;let le=0;for(let he=0;he<I;he+=w){const me=(se+he)/m;if(!(me<0||me>=p.outHeight||Math.floor(me)!==me))for(let pe=0;pe<C;pe+=S){const ye=(ue+pe)/g;if(ye<0||ye>=p.outWidth||Math.floor(ye)!==ye)continue;const Ie=V.get(D,me,ye,Z);le+=Ie}}G.set(le*$,D,ne,re,Z)}return t.makeTensorInfo(G.shape,G.dtype,G.values)}const G4={kernelName:Rg,backendName:"cpu",kernelFunc:L4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function z4(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,scale:i,offset:l,mean:u,variance:c}=e;T(u.shape.length===c.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),T(l==null||u.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),T(i==null||u.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),$e([s,u,c,i,l],"batchNorm");let{varianceEpsilon:h}=r;h==null&&(h=.001);const p=t.data.get(s.dataId).values,m=t.data.get(u.dataId).values,g=t.data.get(c.dataId).values,y=i?t.data.get(i.dataId).values:new Float32Array([1]),v=l?t.data.get(l.dataId).values:new Float32Array([0]),w=new Float32Array(p.length),S=v.length,I=y.length,C=g.length,R=m.length;let L=0,G=0,$=0,F=0;for(let V=0;V<p.length;++V)w[V]=v[L++]+(p[V]-m[G++])*y[$++]/Math.sqrt(g[F++]+h),L>=S&&(L=0),G>=R&&(G=0),$>=I&&($=0),F>=C&&(F=0);return t.makeTensorInfo(s.shape,s.dtype,w)}const W4={kernelName:Sh,backendName:"cpu",kernelFunc:z4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function M4(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockShape:i,crops:l}=r;$e([s],"batchToSpaceND");const u=i.reduce((I,C)=>I*C),c=Ic(s.shape,i,u),h=Sc(c.length,i.length),p=Cc(s.shape,i,u),m=Cb(l,i.length),g=Tb(p,l,i.length),y=kt({inputs:{x:s},backend:t,attrs:{shape:c}}),v=rr({inputs:{x:y},backend:t,attrs:{perm:h}}),w=kt({inputs:{x:v},backend:t,attrs:{shape:p}}),S=po({inputs:{x:w},backend:t,attrs:{begin:m,size:g}});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(w),S}const $4={kernelName:ph,backendName:"cpu",kernelFunc:M4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function F4(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,weights:i}=e,{size:l}=r,u=t.data.get(s.dataId).values,c=t.data.get(i.dataId).values,h=Ry(u,c,i.dtype,i.shape,l);return t.makeTensorInfo([l],i.dtype,h)}const V4={kernelName:Lg,backendName:"cpu",kernelFunc:F4};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function P4(n){const{inputs:e,backend:t}=n,{s0:r,s1:s}=e,i=t.data.get(r.dataId).values,l=t.data.get(s.dataId).values,u=Ye(Array.from(i),Array.from(l));return t.makeTensorInfo([u.length],"int32",Int32Array.from(u))}const X4={kernelName:bw,backendName:"cpu",kernelFunc:P4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const O4=ft(vu,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),D4={kernelName:vu,backendName:"cpu",kernelFunc:O4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const A4={kernelName:fh,backendName:"cpu",kernelFunc:n=>{const{x:e}=n.inputs,t=n.backend,r=new Float32Array(M(e.shape)),s=t.data.get(e.dataId),i=s.complexTensorInfos.real,l=s.complexTensorInfos.imag,u=t.data.get(i.dataId).values,c=t.data.get(l.dataId).values;for(let h=0;h<u.length;h++){const p=u[h],m=c[h];r[h]=Math.hypot(p,m)}return t.makeOutput(r,e.shape,"float32")}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function pl(n){const{inputs:e,backend:t}=n,{input:r}=e,s=t.data.get(r.dataId).complexTensorInfos.imag,i=t.data.get(s.dataId).values;return t.makeTensorInfo(s.shape,s.dtype,i)}const K4={kernelName:Yg,backendName:"cpu",kernelFunc:pl};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function fl(n){const{inputs:e,backend:t,attrs:r}=n,{axis:s}=r,i=oe(s,e[0].shape)[0],l=e.map(w=>w.shape);kb(l,i);let u=As(e.map(w=>w.shape),i);if(M(u)===0)return t.makeTensorInfo(u,e[0].dtype,[]);const c=e.filter(w=>M(w.shape)>0);if(c.length===1)return Us({inputs:{x:c[0]},backend:t});if(c[0].dtype==="complex64"){const w=c.map(L=>co({inputs:{input:L},backend:t})),S=c.map(L=>pl({inputs:{input:L},backend:t})),I=fl({inputs:w,backend:t,attrs:{axis:i}}),C=fl({inputs:S,backend:t,attrs:{axis:i}}),R=fr({inputs:{real:I,imag:C},backend:t});return w.forEach(L=>t.disposeIntermediateTensorInfo(L)),S.forEach(L=>t.disposeIntermediateTensorInfo(L)),t.disposeIntermediateTensorInfo(I),t.disposeIntermediateTensorInfo(C),R}const h=c.map(w=>{const S=[-1,M(w.shape.slice(i))];return kt({inputs:{x:w},backend:t,attrs:{shape:S}})}),p=h.map(w=>({vals:t.data.get(w.dataId).values,shape:w.shape}));u=As(h.map(w=>w.shape),1);const m=h[0].shape[0]===1,g=tT(p,u,e[0].dtype,m),y=As(c.map(w=>w.shape),i),v=t.makeTensorInfo(y,e[0].dtype,g);return h.forEach(w=>t.disposeIntermediateTensorInfo(w)),v}const Z4={kernelName:mh,backendName:"cpu",kernelFunc:fl};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tN(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:p}=r;$e([s,i],"conv2d");const m=pa(c),g=kn(s.shape,i.shape,l,h,u,p,!1,m),y=g.filterHeight,v=g.filterWidth,w=g.dilationHeight,S=g.dilationWidth,I=g.padInfo.left,C=g.padInfo.top,R=g.dataFormat==="channelsLast",L=new wn(g.outShape,s.dtype),G=we(s.shape),$=we(i.shape),F=G[0],V=R?G[1]:G[2],D=R?G[2]:1,Z=R?1:G[1],ne=L.strides[0],re=R?L.strides[1]:L.strides[2],se=R?L.strides[2]:1,ue=R?1:L.strides[1],le=t.data.get(s.dataId).values,he=t.data.get(i.dataId).values,me=L.values;for(let pe=0;pe<g.batchSize;++pe){const ye=pe*F,Ie=pe*ne;for(let ve=0;ve<g.outHeight;++ve){const Ce=Ie+ve*re,Te=ve*g.strideHeight-C;for(let Re=0;Re<y;++Re){const Le=Te+Re*w;if(Le<0||Le>=g.inHeight)continue;const De=Re*$[0],Pe=ye+Le*V;for(let Ae=0;Ae<g.outWidth;++Ae){const Ue=Ce+Ae*se,je=Ae*g.strideWidth-I;for(let tt=0;tt<v;++tt){const ut=je+tt*S;if(ut<0||ut>=g.inWidth)continue;const Dt=De+tt*$[1],Rt=Pe+ut*D;let It=Dt;for(let St=0;St<g.inChannels;++St){const Et=le[Rt+St*Z];for(let en=0;en<g.outChannels;++en)me[Ue+en*ue]+=Et*he[It+en];It+=g.outChannels}}}}}}return t.makeTensorInfo(L.shape,L.dtype,me)}const B4={kernelName:gh,backendName:"cpu",kernelFunc:tN};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _4(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:i}=e,{strides:l,pad:u,dataFormat:c,dimRoundingMode:h,filterShape:p}=r;$e([s,i],"conv2dBackpropFilter");const m=pa(c),g=kn(s.shape,p,l,1,u,h,!1,m),{strideHeight:y,strideWidth:v,filterHeight:w,filterWidth:S}=g,I=g.dataFormat==="channelsLast",C=new wn(g.filterShape,"float32"),R=g.padInfo.left,L=g.padInfo.top,G=t.data.get(s.dataId).values,$=t.data.get(i.dataId).values,F=new wn(s.shape,s.dtype,G),V=new wn(i.shape,i.dtype,$);for(let D=0;D<w;++D){const Z=Math.max(0,Math.ceil((L-D)/y)),ne=Math.min(g.outHeight,(g.inHeight+L-D)/y);for(let re=0;re<S;++re){const se=Math.max(0,Math.ceil((R-re)/v)),ue=Math.min(g.outWidth,(g.inWidth+R-re)/v);for(let le=0;le<g.inChannels;++le)for(let he=0;he<g.outChannels;++he){let me=0;for(let pe=0;pe<g.batchSize;++pe)for(let ye=Z;ye<ne;++ye){const Ie=D+ye*y-L;for(let ve=se;ve<ue;++ve){const Ce=re+ve*v-R;I?me+=F.get(pe,Ie,Ce,le)*V.get(pe,ye,ve,he):me+=F.get(pe,le,Ie,Ce)*V.get(pe,he,ye,ve)}}C.set(me,D,re,le,he)}}}return t.makeTensorInfo(C.shape,C.dtype,C.values)}const H4={kernelName:Wg,backendName:"cpu",kernelFunc:_4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function U4(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:i}=e,{inputShape:l,strides:u,pad:c,dataFormat:h,dimRoundingMode:p}=r;$e([s,i],"conv2dBackpropInput");const m=we(i.shape),g=we(s.shape);let y=pa(h);const v=kn(l,i.shape,u,1,c,p,!1,y),w=new wn(v.inShape,"float32"),S=w.values,I=t.data.get(s.dataId).values,C=t.data.get(i.dataId).values,[R,L,G]=m,{batchSize:$,filterHeight:F,filterWidth:V,inChannels:D,inHeight:Z,inWidth:ne,outChannels:re,outHeight:se,outWidth:ue,strideHeight:le,strideWidth:he}=v;y=v.dataFormat;const me=F-1-v.padInfo.top,pe=V-1-v.padInfo.left,ye=y==="channelsLast",Ie=w.strides[0],ve=ye?w.strides[1]:w.strides[2],Ce=ye?w.strides[2]:1,Te=ye?1:w.strides[1],Re=g[0],Le=ye?g[1]:g[2],De=ye?g[2]:1,Pe=ye?1:g[1];for(let Ae=0;Ae<$;++Ae)for(let Ue=0;Ue<D;++Ue)for(let je=0;je<Z;++je){const tt=je-me,ut=Math.max(0,Math.ceil(tt/le)),Dt=Math.min(se,(F+tt)/le);for(let Rt=0;Rt<ne;++Rt){const It=Rt-pe,St=Math.max(0,Math.ceil(It/he)),Et=Math.min(ue,(V+It)/he);let en=0;for(let Zn=ut;Zn<Dt;++Zn){const Ia=Zn*le-tt;for(let Wr=St;Wr<Et;++Wr){const qs=Wr*he-It,ui=Re*Ae+Le*Zn+De*Wr,ea=R*(F-1-Ia)+L*(V-1-qs)+G*Ue;for(let Is=0;Is<re;++Is){const ci=I[ui+Pe*Is],sd=C[ea+Is];en+=ci*sd}}}const ka=Ie*Ae+ve*je+Ce*Rt+Te*Ue;S[ka]=en}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const j4={kernelName:bh,backendName:"cpu",kernelFunc:U4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Y4(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:l,pad:u,dilations:c}=r;$e([s,i],"conv3d");const h=Ba(s.shape,i.shape,l,c,u),{filterDepth:p,filterHeight:m,filterWidth:g,dilationDepth:y,dilationHeight:v,dilationWidth:w,padInfo:S}=h,I=S.front,C=S.left,R=S.top,L=new wn(h.outShape,s.dtype),G=t.data.get(s.dataId).values,$=t.data.get(i.dataId).values,F=L.values,V=we(s.shape),D=we(i.shape);for(let Z=0;Z<h.batchSize;++Z){const ne=Z*V[0],re=Z*L.strides[0];for(let se=0;se<h.outDepth;++se){const ue=re+se*L.strides[1],le=se*h.strideDepth-I;for(let he=0;he<p;++he){const me=le+he*y;if(me<0||me>=h.inDepth)continue;const pe=he*D[0],ye=ne+me*V[1];for(let Ie=0;Ie<h.outHeight;++Ie){const ve=ue+Ie*L.strides[2],Ce=Ie*h.strideHeight-R;for(let Te=0;Te<m;++Te){const Re=Ce+Te*v;if(Re<0||Re>=h.inHeight)continue;const Le=pe+Te*D[1],De=ye+Re*V[2];for(let Pe=0;Pe<h.outWidth;++Pe){const Ae=ve+Pe*h.outChannels,Ue=Pe*h.strideWidth-C;for(let je=0;je<g;++je){const tt=Ue+je*w;if(tt<0||tt>=h.inWidth)continue;const ut=Le+je*D[2],Dt=De+tt*h.inChannels;let Rt=ut;for(let It=0;It<h.inChannels;++It){const St=G[Dt+It];for(let Et=0;Et<h.outChannels;++Et)F[Ae+Et]+=St*$[Rt+Et];Rt+=h.outChannels}}}}}}}}return t.makeTensorInfo(L.shape,L.dtype,L.values)}const Q4={kernelName:yh,backendName:"cpu",kernelFunc:Y4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function J4(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:i}=e,{strides:l,pad:u,filterShape:c}=r;$e([s,i],"conv3dBackpropFilterV2");const h=we(s.shape),p=we(i.shape),m=Ba(s.shape,c,l,1,u),g=m.strideDepth,y=m.strideHeight,v=m.strideWidth,w=m.filterDepth,S=m.filterHeight,I=m.filterWidth,C=new wn(m.filterShape,"float32"),R=C.values,[L,G,$,F]=C.strides,V=t.data.get(i.dataId).values,[D,Z,ne,re]=p,se=t.data.get(s.dataId).values,[ue,le,he,me]=h,pe=m.padInfo.front,ye=m.padInfo.left,Ie=m.padInfo.top;for(let ve=0;ve<w;++ve){const Ce=Math.max(0,Math.ceil((pe-ve)/g)),Te=Math.min(m.outDepth,(m.inDepth+pe-ve)/g),Re=ve*L;for(let Le=0;Le<S;++Le){const De=Math.max(0,Math.ceil((Ie-Le)/y)),Pe=Math.min(m.outHeight,(m.inHeight+Ie-Le)/y),Ae=Le*G+Re;for(let Ue=0;Ue<I;++Ue){const je=Math.max(0,Math.ceil((ye-Ue)/v)),tt=Math.min(m.outWidth,(m.inWidth+ye-Ue)/v),ut=Ue*$+Ae;for(let Dt=0;Dt<m.inChannels;++Dt){const Rt=Dt*F+ut;for(let It=0;It<m.outChannels;++It){let St=0;for(let Et=0;Et<m.batchSize;++Et){const en=Et*ue,ka=Et*D;for(let Zn=Ce;Zn<Te;++Zn){const Ia=(ve+Zn*g-pe)*le+en,Wr=Zn*Z+ka;for(let qs=De;qs<Pe;++qs){const ui=(Le+qs*y-Ie)*he+Ia,ea=qs*ne+Wr;for(let Is=je;Is<tt;++Is){const ci=(Ue+Is*v-ye)*me+ui,sd=Is*re+ea;St+=se[ci+Dt]*V[sd+It]}}}}R[Rt+It]=St}}}}}return t.makeTensorInfo(C.shape,C.dtype,C.values)}const q4={kernelName:Mg,backendName:"cpu",kernelFunc:J4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function e5(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:i}=e,{pad:l,strides:u,inputShape:c}=r;$e([s],"conv3dBackpropInputV2");const h=we(s.shape),p=we(i.shape),m=Ba(c,i.shape,u,1,l),g=new wn(m.inShape,"float32"),y=g.values,[v,w,S,I]=g.strides,C=t.data.get(s.dataId).values,[R,L,G,$]=h,F=t.data.get(i.dataId).values,[V,D,Z,ne]=p,{batchSize:re,filterDepth:se,filterHeight:ue,filterWidth:le,inChannels:he,inDepth:me,inHeight:pe,inWidth:ye,outChannels:Ie,outDepth:ve,outHeight:Ce,outWidth:Te,strideDepth:Re,strideHeight:Le,strideWidth:De}=m,Pe=se-1-m.padInfo.front,Ae=ue-1-m.padInfo.top,Ue=le-1-m.padInfo.left;for(let je=0;je<re;++je)for(let tt=0;tt<he;++tt)for(let ut=0;ut<me;++ut){const Dt=ut-Pe,Rt=Math.max(0,Math.ceil(Dt/Re)),It=Math.min(ve,(se+Dt)/Re);for(let St=0;St<pe;++St){const Et=St-Ae,en=Math.max(0,Math.ceil(Et/Le)),ka=Math.min(Ce,(ue+Et)/Le);for(let Zn=0;Zn<ye;++Zn){const Ia=Zn-Ue,Wr=Math.max(0,Math.ceil(Ia/De)),qs=Math.min(Te,(le+Ia)/De);let ui=0;for(let ea=Rt;ea<It;++ea){const Is=ea*Re-Dt;for(let ci=en;ci<ka;++ci){const sd=ci*Le-Et;for(let Gf=Wr;Gf<qs;++Gf){const Zne=Gf*De-Ia,Bne=R*je+L*ea+G*ci+$*Gf,_ne=V*(se-1-Is)+D*(ue-1-sd)+Z*(le-1-Zne)+ne*tt;for(let zf=0;zf<Ie;++zf){const Hne=C[Bne+zf],Une=F[_ne+zf];ui+=Hne*Une}}}}y[v*je+w*ut+S*St+I*Zn+tt]=ui}}}return t.makeTensorInfo(g.shape,g.dtype,g.values)}const t5={kernelName:$g,backendName:"cpu",kernelFunc:e5};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const n5=ft(wu,n=>Math.cos(n)),r5={kernelName:wu,backendName:"cpu",kernelFunc:n5};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const s5=ft(ku,n=>Math.cosh(n)),a5={kernelName:ku,backendName:"cpu",kernelFunc:s5};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function i5(n){const{inputs:e,backend:t,attrs:r}=n,{image:s,boxes:i,boxInd:l}=e,{cropSize:u,method:c,extrapolationValue:h}=r,[p,m,g,y]=s.shape,v=i.shape[0],[w,S]=u,I=Je([v,w,S,y],"float32"),C=t.data.get(i.dataId).values,R=t.data.get(l.dataId).values,L=t.data.get(s.dataId).values,G=we(s.shape),$=we(I.shape);for(let F=0;F<v;F++){const V=F*4,D=C[V],Z=C[V+1],ne=C[V+2],re=C[V+3],se=R[F];if(se>=p)continue;const ue=w>1?(ne-D)*(m-1)/(w-1):0,le=S>1?(re-Z)*(g-1)/(S-1):0;for(let he=0;he<w;he++){const me=w>1?D*(m-1)+he*ue:.5*(D+ne)*(m-1);if(me<0||me>m-1){for(let pe=0;pe<S;pe++)for(let ye=0;ye<y;ye++){const Ie=ye+pe*$[2]+he*$[1]+F*$[0];I.values[Ie]=h}continue}if(c==="bilinear"){const pe=Math.floor(me),ye=Math.ceil(me),Ie=me-pe;for(let ve=0;ve<S;ve++){const Ce=S>1?Z*(g-1)+ve*le:.5*(Z+re)*(g-1);if(Ce<0||Ce>g-1){for(let De=0;De<y;De++){const Pe=De+ve*$[2]+he*$[1]+F*$[0];I.values[Pe]=h}continue}const Te=Math.floor(Ce),Re=Math.ceil(Ce),Le=Ce-Te;for(let De=0;De<y;De++){let Pe=De+Te*G[2]+pe*G[1]+se*G[0];const Ae=L[Pe];Pe=De+Re*G[2]+pe*G[1]+se*G[0];const Ue=L[Pe];Pe=De+Te*G[2]+ye*G[1]+se*G[0];const je=L[Pe];Pe=De+Re*G[2]+ye*G[1]+se*G[0];const tt=L[Pe],ut=Ae+(Ue-Ae)*Le,Dt=je+(tt-je)*Le;Pe=De+ve*$[2]+he*$[1]+F*$[0],I.values[Pe]=ut+(Dt-ut)*Ie}}}else for(let pe=0;pe<S;++pe){const ye=S>1?Z*(g-1)+pe*le:.5*(Z+re)*(g-1);if(ye<0||ye>g-1){for(let Ce=0;Ce<y;Ce++){const Te=Ce+pe*$[2]+he*$[1]+F*$[0];I.values[Te]=h}continue}const Ie=Math.round(ye),ve=Math.round(me);for(let Ce=0;Ce<y;Ce++){const Te=Ce+Ie*G[2]+ve*G[1]+se*G[0],Re=Ce+pe*$[2]+he*$[1]+F*$[0];I.values[Re]=L[Te]}}}}return t.makeTensorInfo(I.shape,I.dtype,I.values)}const o5={kernelName:Vg,backendName:"cpu",kernelFunc:i5};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function l5(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,exclusive:l,reverse:u}=r;$e(s,"cumprod");const c=Xt([i],s.shape.length);let h=s;c!=null&&(h=rr({inputs:{x:s},backend:t,attrs:{perm:c}}));const p=Yt(1,s.shape.length)[0];if(p!==h.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${h.shape.length-1} but got axis=${p}`);const m=dr(h.dtype,"int32"),g=$n(M(h.shape),m),y=t.data.get(h.dataId).values,v=h.shape[h.shape.length-1],w=u?(I,C)=>I+v-C-1:(I,C)=>I+C;for(let I=0;I<y.length;I+=v)for(let C=0;C<v;C++){const R=w(I,C);if(C===0)g[R]=l?1:y[R];else{const L=w(I,C-1);g[R]=l?y[L]*g[L]:y[R]*g[L]}}const S=t.makeTensorInfo(h.shape,m,g);if(c!=null){const I=_a(c),C=rr({inputs:{x:S},backend:t,attrs:{perm:I}});return t.disposeIntermediateTensorInfo(S),t.disposeIntermediateTensorInfo(h),C}return S}const u5={kernelName:Fg,backendName:"cpu",kernelFunc:l5};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function c5(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,exclusive:l,reverse:u}=r;$e(s,"cumsum");const c=Xt([i],s.shape.length);let h=s;c!=null&&(h=rr({inputs:{x:s},backend:t,attrs:{perm:c}}));const p=Yt(1,s.shape.length)[0];if(p!==h.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${h.shape.length-1} but got axis=${p}`);const m=dr(h.dtype,"int32"),g=Pt(M(h.shape),m),y=t.data.get(h.dataId).values,v=h.shape[h.shape.length-1],w=u?(I,C)=>I+v-C-1:(I,C)=>I+C;for(let I=0;I<y.length;I+=v)for(let C=0;C<v;C++){const R=w(I,C);if(C===0)g[R]=l?0:y[R];else{const L=w(I,C-1);g[R]=l?y[L]+g[L]:y[R]+g[L]}}const S=t.makeTensorInfo(h.shape,m,g);if(c!=null){const I=_a(c),C=rr({inputs:{x:S},backend:t,attrs:{perm:I}});return t.disposeIntermediateTensorInfo(S),t.disposeIntermediateTensorInfo(h),C}return S}const d5={kernelName:xh,backendName:"cpu",kernelFunc:c5};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function h5(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,weights:i}=e,{size:l,binaryOutput:u}=r;if(s.shape.length===1){const c=t.data.get(s.dataId).values,h=t.data.get(i.dataId).values,p=Ry(c,h,i.dtype,i.shape,l);return t.makeTensorInfo([l],i.dtype,p)}else if(s.shape.length===2){const c=t.bufferSync(s),h=t.bufferSync(i),p=JC(c,h,l,u);return t.makeTensorInfo(p.shape,i.dtype,p.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${s.shape.length}.`)}const p5={kernelName:Pg,backendName:"cpu",kernelFunc:h5};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function f5(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockSize:i,dataFormat:l}=r;T(l==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${l}`);const u=s.shape[0],c=s.shape[1],h=s.shape[2],p=s.shape[3],m=c*i,g=h*i,y=p/(i*i),v=t.data.get(s.dataId).values,w=new Float32Array(u*m*g*y);let S=0;for(let I=0;I<u;++I)for(let C=0;C<m;++C){const R=Math.floor(C/i),L=C%i;for(let G=0;G<g;++G){const $=Math.floor(G/i),F=G%i,V=(L*i+F)*y;for(let D=0;D<y;++D){const Z=D+V+p*($+h*(R+c*I));w[S++]=v[Z]}}}return t.makeTensorInfo([u,m,g,y],s.dtype,w)}const m5={kernelName:Xg,backendName:"cpu",kernelFunc:f5};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function nN(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:l,pad:u,dilations:c,dimRoundingMode:h}=r;$e([s,i],"depthwiseConv2DNative");const p=we(s.shape),m=we(i.shape);let g=c;g==null&&(g=[1,1]),T(Rn(l,g),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${g}'`);const y=kn(s.shape,i.shape,l,g,u,h,!0),{filterHeight:v,filterWidth:w,dilationHeight:S,dilationWidth:I,padInfo:C}=y,R=C.left,L=C.top,G=y.outChannels/y.inChannels,$=new wn(y.outShape,s.dtype),F=t.data.get(s.dataId).values,V=t.data.get(i.dataId).values,D=$.values;for(let Z=0;Z<y.batchSize;++Z){const ne=Z*p[0],re=Z*$.strides[0];for(let se=0;se<y.outHeight;++se){const ue=re+se*$.strides[1],le=se*y.strideHeight-L;for(let he=0;he<v;++he){const me=le+he*S;if(me<0||me>=y.inHeight)continue;const pe=he*m[0],ye=ne+me*p[1];for(let Ie=0;Ie<y.outWidth;++Ie){const ve=ue+Ie*$.strides[2],Ce=Ie*y.strideWidth-R;for(let Te=0;Te<w;++Te){const Re=Ce+Te*I;if(Re<0||Re>=y.inWidth)continue;const Le=pe+Te*m[1],De=ye+Re*y.inChannels;let Pe=ve,Ae=Le;for(let Ue=0;Ue<y.inChannels;++Ue){const je=F[De+Ue];for(let tt=0;tt<G;++tt)D[Pe+tt]+=je*V[Ae+tt];Pe+=G,Ae+=G}}}}}}return t.makeTensorInfo($.shape,$.dtype,$.values)}const g5={kernelName:vh,backendName:"cpu",kernelFunc:nN};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function b5(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:i}=e,{strides:l,dilations:u,pad:c,dimRoundingMode:h,filterShape:p}=r;$e([s,i],"depthwiseConv2dNativeBackpropFilter");const m=kn(s.shape,p,l,u,c,h,!0),{strideHeight:g,strideWidth:y,filterHeight:v,filterWidth:w}=m,S=new wn(m.filterShape,"float32"),I=m.padInfo.left,C=m.padInfo.top,R=m.outChannels/m.inChannels,L=t.data.get(s.dataId).values,G=new wn(s.shape,s.dtype,L),$=t.data.get(i.dataId).values,F=new wn(i.shape,i.dtype,$);for(let V=0;V<v;++V){const D=Math.max(0,Math.ceil((C-V)/g)),Z=Math.min(m.outHeight,(m.inHeight+C-V)/g);for(let ne=0;ne<w;++ne){const re=Math.max(0,Math.ceil((I-ne)/y)),se=Math.min(m.outWidth,(m.inWidth+I-ne)/y);for(let ue=0;ue<m.outChannels;++ue){const le=Math.trunc(ue/R),he=ue%R;let me=0;for(let pe=0;pe<m.batchSize;++pe)for(let ye=D;ye<Z;++ye){const Ie=V+ye*g-C;for(let ve=re;ve<se;++ve){const Ce=ne+ve*y-I;me+=G.get(pe,Ie,Ce,le)*F.get(pe,ye,ve,ue)}}S.set(me,V,ne,le,he)}}}return t.makeTensorInfo(S.shape,S.dtype,S.values)}const y5={kernelName:Og,backendName:"cpu",kernelFunc:b5};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function x5(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:i}=e,{strides:l,dilations:u,pad:c,dimRoundingMode:h,inputShape:p}=r;$e([s,i],"depthwiseConv2DNativeBackpropInput");const m=we(s.shape),g=we(i.shape),y=kn(p,i.shape,l,u,c,h,!0),v=new wn(y.inShape,"float32"),w=v.values,[S,I,C]=v.strides,R=t.data.get(s.dataId).values,[L,G,$]=m,F=t.data.get(i.dataId).values,[V,D,Z]=g,{batchSize:ne,filterHeight:re,filterWidth:se,inChannels:ue,inHeight:le,inWidth:he,outChannels:me,outHeight:pe,outWidth:ye,strideHeight:Ie,strideWidth:ve}=y,Ce=re-1-y.padInfo.top,Te=se-1-y.padInfo.left,Re=me/ue;for(let Le=0;Le<ne;++Le)for(let De=0;De<ue;++De)for(let Pe=0;Pe<le;++Pe){const Ae=Pe-Ce,Ue=Math.max(0,Math.ceil(Ae/Ie)),je=Math.min(pe,(re+Ae)/Ie);for(let tt=0;tt<he;++tt){const ut=tt-Te,Dt=Math.max(0,Math.ceil(ut/ve)),Rt=Math.min(ye,(se+ut)/ve);let It=0;for(let St=Ue;St<je;++St){const Et=St*Ie-Ae;for(let en=Dt;en<Rt;++en){const ka=en*ve-ut,Zn=L*Le+G*St+$*en,Ia=V*(re-1-Et)+D*(se-1-ka)+Z*De;for(let Wr=0;Wr<Re;++Wr){const qs=De*Re+Wr,ui=R[Zn+qs],ea=F[Ia+Wr];It+=ui*ea}}}w[S*Le+I*Pe+C*tt+De]=It}}return t.makeTensorInfo(v.shape,v.dtype,v.values)}const v5={kernelName:Dg,backendName:"cpu",kernelFunc:x5};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function w5(n){const{inputs:e,backend:t}=n,{x:r}=e,s=M(r.shape),i=t.data.get(r.dataId).values,l=Je([s,s],r.dtype),u=l.values;for(let h=0;h<i.length;h++)u[h*s+h]=i[h];const c=[...r.shape,...r.shape];return t.makeTensorInfo(c,l.dtype,l.values)}const k5={kernelName:yw,backendName:"cpu",kernelFunc:w5};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const I5={kernelName:wh,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:r,filter:s}=n,{strides:i,pad:l,dilations:u}=t,c=e,h=c.data.get(r.dataId).values,p=r.shape.length,m=c.data.get(s.dataId).values,g=s.shape.length,{batchSize:y,inHeight:v,inWidth:w,inChannels:S,outHeight:I,outWidth:C,padInfo:R,strideHeight:L,strideWidth:G,filterHeight:$,filterWidth:F,dilationHeight:V,dilationWidth:D,outShape:Z}=hc(r.shape,s.shape,i,l,"NHWC",u),ne=M(Z),re=Z.length,se=be(r.dtype,ne);for(let ue=0;ue<y;++ue)for(let le=0;le<I;++le){const he=le*L-R.top;for(let me=0;me<C;++me){const pe=me*G-R.left;for(let ye=0;ye<S;++ye){let Ie=Number.MIN_SAFE_INTEGER;for(let Ce=0;Ce<$;++Ce){const Te=he+Ce*V;if(Te>=0&&Te<v)for(let Re=0;Re<F;++Re){const Le=pe+Re*D;if(Le>=0&&Le<w){const De=Fs([ue,Te,Le,ye],p,we(r.shape)),Pe=Fs([Ce,Re,ye],g,we(s.shape)),Ae=h[De]+m[Pe];Ae>Ie&&(Ie=Ae)}}}const ve=Fs([ue,le,me,ye],re,we(Z));se[ve]=Ie}}}return{dataId:c.write(Di(se,r.dtype),Z,r.dtype),shape:Z,dtype:r.dtype}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const S5={kernelName:Kg,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:r,filter:s,dy:i}=n,{strides:l,pad:u,dilations:c}=t,h=e,p=nt(r.shape,h.data.get(r.dataId).values),m=nt(s.shape,h.data.get(s.dataId).values),{batchSize:g,inHeight:y,inWidth:v,inChannels:w,outHeight:S,outWidth:I,padInfo:C,strideHeight:R,strideWidth:L,filterHeight:G,filterWidth:$,dilationHeight:F,dilationWidth:V,outShape:D}=hc(r.shape,s.shape,l,u,"NHWC",c);T(i.rank===D.length,()=>`Error in ${Kg}, dy must have the same rank as output ${D.length}, but got ${i.rank}`);const Z=nt(D,h.data.get(i.dataId).values),ne=$s(s.shape,s.dtype);for(let re=0;re<g;++re)for(let se=0;se<S;++se){const ue=se*R-C.top;for(let le=0;le<I;++le){const he=le*L-C.left;for(let me=0;me<w;++me){let pe=Number.MIN_SAFE_INTEGER,ye=0,Ie=0;for(let ve=0;ve<G;++ve){const Ce=ue+ve*F;if(Ce>=0&&Ce<y)for(let Te=0;Te<$;++Te){const Re=he+Te*V;if(Re>=0&&Re<v){const Le=p[re][Ce][Re][me]+m[ve][Te][me];Le>pe&&(pe=Le,ye=ve,Ie=Te)}}}ne[ye][Ie][me]+=Z[re][se][le][me]}}}return{dataId:h.write(Di(ne,r.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const C5={kernelName:Ag,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:r,filter:s,dy:i}=n,{strides:l,pad:u,dilations:c}=t,h=e,p=nt(r.shape,h.data.get(r.dataId).values),m=nt(s.shape,h.data.get(s.dataId).values),{batchSize:g,inHeight:y,inWidth:v,inChannels:w,outHeight:S,outWidth:I,padInfo:C,strideHeight:R,strideWidth:L,filterHeight:G,filterWidth:$,dilationHeight:F,dilationWidth:V,outShape:D}=hc(r.shape,s.shape,l,u,"NHWC",c);T(i.rank===D.length,()=>`Error in ${Ag}, dy must have the same rank as output ${D.length}, but got ${i.rank}`);const Z=nt(D,h.data.get(i.dataId).values),ne=$s(r.shape,r.dtype);for(let re=0;re<g;++re)for(let se=0;se<S;++se){const ue=se*R-C.top;for(let le=0;le<I;++le){const he=le*L-C.left;for(let me=0;me<w;++me){let pe=Number.MIN_SAFE_INTEGER,ye=ue<0?0:ue,Ie=he<0?0:he;for(let ve=0;ve<G;++ve){const Ce=ue+ve*F;if(Ce>=0&&Ce<y)for(let Te=0;Te<$;++Te){const Re=he+Te*V;if(Re>=0&&Re<v){const Le=p[re][Ce][Re][me]+m[ve][Te][me];Le>pe&&(pe=Le,ye=Ce,Ie=Re)}}}ne[re][ye][Ie][me]+=Z[re][se][le][me]}}}return{dataId:h.write(Di(ne,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function T5(n){const{inputs:e,backend:t,attrs:r}=n,{image:s}=e,{canvas:i,options:l}=r,{contextOptions:u,imageOptions:c}=l||{},h=(c==null?void 0:c.alpha)||1,p=(u==null?void 0:u.contextType)||"2d";if(p!=="2d")throw new Error(`Context type ${u.contextType} is not supported by the CPU backend.`);const m=i.getContext(p,(u==null?void 0:u.contextAttributes)||{});if(m==null)throw new Error(`Could not get the context with ${p} type.`);const[g,y]=s.shape.slice(0,2),v=s.shape.length===2?1:s.shape[2],w=t.data.get(s.dataId).values,S=s.dtype==="float32"?255:1,I=new Uint8ClampedArray(y*g*4);for(let R=0;R<g*y;++R){const L=[0,0,0,255*h];for(let $=0;$<v;$++){const F=w[R*v+$];if(s.dtype==="float32"){if(F<0||F>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${F}.`)}else if(s.dtype==="int32"&&(F<0||F>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${F}.`);v===1?(L[0]=F*S,L[1]=F*S,L[2]=F*S):L[$]=F*S}const G=R*4;I[G+0]=Math.round(L[0]),I[G+1]=Math.round(L[1]),I[G+2]=Math.round(L[2]),I[G+3]=Math.round(L[3])}i.width=y,i.height=g;const C=new ImageData(I,y,g);return m.putImageData(C,0,0),s}const N5={kernelName:dW,backendName:"cpu",kernelFunc:T5};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Kc(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:l}=r;$e(s,"sum");let u;s.dtype==="bool"?u=si({inputs:{x:s},backend:t,attrs:{dtype:"int32"}}):u=Us({inputs:{x:s},backend:t});const c=u.shape.length,h=oe(i,u.shape),p=Xt(h,c);let m=h,g=u;p!=null&&(g=rr({inputs:{x:u},backend:t,attrs:{perm:p}}),m=Yt(m.length,c)),In("sum",m,g.shape.length);const[y,v]=mn(g.shape,m),w=dr(g.dtype,"int32");let S=ef(t,y,w);const I=M(v),C=t.data.get(S.dataId).values,R=t.data.get(g.dataId).values;for(let L=0;L<C.length;++L){const G=L*I;let $=0;for(let F=0;F<I;++F)$+=R[G+F];C[L]=$}if(l){const L=nn(S.shape,h),G=S;S=kt({inputs:{x:S},backend:t,attrs:{shape:L}}),t.disposeIntermediateTensorInfo(G)}return t.disposeIntermediateTensorInfo(u),p!=null&&t.disposeIntermediateTensorInfo(g),S}const R5={kernelName:ep,backendName:"cpu",kernelFunc:Kc};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function E5(n){const{inputs:e,backend:t,attrs:r}=n,{equation:s}=r,i=e,{allDims:l,summedDims:u,idDims:c}=$b(s,i.length);Vb(l.length,c,i);const{path:h,steps:p}=Pb(u,c),m=p.length;let g=null,y=l.length;const v=[];for(let w=0;w<m;++w){for(const S of p[w]){const{permutationIndices:I,expandDims:C}=Fb(y,c[S]);let R;Xb(I)?R=i[S]:(R=rr({inputs:{x:i[S]},backend:t,attrs:{perm:I}}),v.push(R));const L=R.shape.slice();for(let G=0;G<C.length;++G)L.splice(C[G],0,1);B(R.shape,L)||(R=kt({inputs:{x:R},backend:t,attrs:{shape:L}}),v.push(R)),g===null?g=R:(g=tf({inputs:{a:R,b:g},backend:t}),v.push(g))}w<m-1&&(h[w]>=0&&(g=Kc({inputs:{x:g},backend:t,attrs:{axis:h[w]-(l.length-y),keepDims:!1}}),v.push(g)),y--)}for(const w of v)w!==g&&t.disposeIntermediateTensorInfo(w);return g}const L5={kernelName:Zg,backendName:"cpu",kernelFunc:E5};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function G5(n){const{inputs:e,backend:t}=n,{dy:r,y:s}=e;$e([r,s],"eluGrad");const i=new Float32Array(M(s.shape)),l=t.data.get(s.dataId).values,u=t.data.get(r.dataId).values;for(let c=0;c<l.length;++c){const h=l[c];h>=0?i[c]=u[c]:i[c]=u[c]*(h+1)}return t.makeTensorInfo(s.shape,"float32",i)}const z5={kernelName:Bg,backendName:"cpu",kernelFunc:G5};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const W5=Nb,M5=Rb,$5=Eb,F5=Lb,V5=Gb,P5=zb,X5=ft(Cu,n=>{const e=Math.sign(n),t=Math.abs(n),r=1/(1+W5*t);return e*(1-((((P5*r+V5)*r+F5)*r+$5)*r+M5)*r*Math.exp(-t*t))}),O5={kernelName:Cu,backendName:"cpu",kernelFunc:X5};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sf(n){const{inputs:e,backend:t,attrs:r}=n,{input:s}=e,{dim:i}=r,l=s.shape.length,u=s.shape.slice();let c=i;return i<0&&(T(-(l+1)<=i,()=>`Axis must be in the interval [${-(l+1)}, ${l}]`),c=l+i+1),u.splice(c,0,1),kt({inputs:{x:s},backend:t,attrs:{shape:u}})}const D5={kernelName:Ih,backendName:"cpu",kernelFunc:sf};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const A5=qt((n,e)=>n/e),My=hn(Iu,A5),$y={kernelName:Iu,backendName:"cpu",kernelFunc:My};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function rN(n,e,t){const r=n.shape,s=r[0],i=r[1],l=t.data.get(n.dataId),u=l.complexTensorInfos.real,c=l.complexTensorInfos.imag,h=[s,i],p=M(h),m=ge("float32",p),g=ge("float32",p);for(let S=0;S<s;S++){const I=po({inputs:{x:u},backend:t,attrs:{begin:[S,0],size:[1,i]}}),C=po({inputs:{x:c},backend:t,attrs:{begin:[S,0],size:[1,i]}}),R=fr({inputs:{real:I,imag:C},backend:t}),{real:L,imag:G}=K5(R,e,t),$=ga(L,G);for(let F=0;F<i;F++){const V=Wb($,F);m[S*i+F]=V.real,g[S*i+F]=V.imag}t.disposeIntermediateTensorInfo(I),t.disposeIntermediateTensorInfo(C),t.disposeIntermediateTensorInfo(R)}const y=t.makeTensorInfo(h,"float32",m),v=t.makeTensorInfo(h,"float32",g),w=fr({inputs:{real:y,imag:v},backend:t});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(v),w}function K5(n,e,t){const r=M(n.shape),s=t.data.get(n.dataId),i=t.data.get(s.complexTensorInfos.real.dataId).values,l=t.data.get(s.complexTensorInfos.imag.dataId).values;if(Z5(r)){const u=Fy(i,l,r,e,t),c=[n.shape[0],n.shape[1]];if(e){const h=t.makeTensorInfo(c,"float32",u.real),p=t.makeTensorInfo(c,"float32",u.imag),m=t.makeTensorInfo([],"float32",Oa(r,"float32")),g=Us({inputs:{x:m},backend:t}),y=$y.kernelFunc({inputs:{a:h,b:m},backend:t}),v=$y.kernelFunc({inputs:{a:p,b:g},backend:t}),w=t.data.get(y.dataId).values,S=t.data.get(v.dataId).values;return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(v),{real:w,imag:S}}return u}else{const u=ga(i,l),c=B5(u,r,e);return $2(c)}}function Z5(n){return(n&n-1)===0}function Fy(n,e,t,r,s){if(t===1)return{real:n,imag:e};const i=ga(n,e),l=t/2,u=F2(i),c=u.real,h=u.imag,p=[c.length],m=s.makeTensorInfo(p,"float32",c),g=s.makeTensorInfo(p,"float32",h),y=fr({inputs:{real:m,imag:g},backend:s}),v=V2(i),w=v.real,S=v.imag,I=[w.length],C=s.makeTensorInfo(I,"float32",w),R=s.makeTensorInfo(I,"float32",S),L=fr({inputs:{real:C,imag:R},backend:s}),G=Fy(c,h,l,r,s),$=G.real,F=G.imag,V=[$.length],D=s.makeTensorInfo(V,"float32",$),Z=s.makeTensorInfo(V,"float32",F),ne=fr({inputs:{real:D,imag:Z},backend:s}),re=Fy(w,S,l,r,s),se=re.real,ue=re.imag,le=[se.length],he=s.makeTensorInfo(le,"float32",se),me=s.makeTensorInfo(le,"float32",ue),pe=fr({inputs:{real:he,imag:me},backend:s}),ye=X2(t,r),Ie=[ye.real.length],ve=s.makeTensorInfo(Ie,"float32",ye.real),Ce=s.makeTensorInfo(Ie,"float32",ye.imag),Te=fr({inputs:{real:ve,imag:Ce},backend:s}),Re=tf({inputs:{a:Te,b:pe},backend:s}),Le=hl({inputs:{a:ne,b:Re},backend:s}),De=zy({inputs:{a:ne,b:Re},backend:s}),Pe=co({inputs:{input:Le},backend:s}),Ae=co({inputs:{input:De},backend:s}),Ue=pl({inputs:{input:Le},backend:s}),je=pl({inputs:{input:De},backend:s}),tt=fl({inputs:[Pe,Ae],backend:s,attrs:{axis:0}}),ut=fl({inputs:[Ue,je],backend:s,attrs:{axis:0}}),Dt=s.data.get(tt.dataId).values,Rt=s.data.get(ut.dataId).values;return s.disposeIntermediateTensorInfo(m),s.disposeIntermediateTensorInfo(g),s.disposeIntermediateTensorInfo(y),s.disposeIntermediateTensorInfo(C),s.disposeIntermediateTensorInfo(R),s.disposeIntermediateTensorInfo(L),s.disposeIntermediateTensorInfo(D),s.disposeIntermediateTensorInfo(Z),s.disposeIntermediateTensorInfo(ne),s.disposeIntermediateTensorInfo(he),s.disposeIntermediateTensorInfo(me),s.disposeIntermediateTensorInfo(pe),s.disposeIntermediateTensorInfo(ve),s.disposeIntermediateTensorInfo(Ce),s.disposeIntermediateTensorInfo(Te),s.disposeIntermediateTensorInfo(Re),s.disposeIntermediateTensorInfo(Le),s.disposeIntermediateTensorInfo(De),s.disposeIntermediateTensorInfo(Pe),s.disposeIntermediateTensorInfo(Ue),s.disposeIntermediateTensorInfo(Ae),s.disposeIntermediateTensorInfo(je),s.disposeIntermediateTensorInfo(tt),s.disposeIntermediateTensorInfo(ut),{real:Dt,imag:Rt}}function B5(n,e,t){const r=new Float32Array(e*2);for(let s=0;s<e;s++){let i=0,l=0;for(let u=0;u<e;u++){const c=O2(s*u,e,t),h=Wb(n,u);i+=h.real*c.real-h.imag*c.imag,l+=h.real*c.imag+h.imag*c.real}t&&(i/=e,l/=e),P2(r,i,l,s)}return r}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _5(n){const{inputs:e,backend:t}=n,{input:r}=e,s=M(r.shape),i=r.shape[r.shape.length-1],l=s/i,u=kt({inputs:{x:r},backend:t,attrs:{shape:[l,i]}}),c=rN(u,!1,t),h=kt({inputs:{x:c},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(c),h}const H5={kernelName:_g,backendName:"cpu",kernelFunc:_5};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Vy(n){const{backend:e,attrs:t}=n,{shape:r,value:s,dtype:i}=t,l=i||Ir(s),u=be(l,M(r));return j5(u,s),e.makeTensorInfo(r,l,u)}const U5={kernelName:Hg,backendName:"cpu",kernelFunc:Vy};function j5(n,e,t){n.fill(e)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Y5={kernelName:Ug,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:r}=n,s=t,i=ge(r.dtype,M(r.shape)),[l,u,c,h]=r.shape,p=s.data.get(r.dataId).values;for(let m=0;m<l;m++){const g=m*c*u*h;for(let y=0;y<u;y++){const v=y*(c*h);for(let w=0;w<c;w++){const S=w*h;for(let I=0;I<h;I++){const C=Math.round(c-w-1),R=g+v+S+I;let L=p[R];if(C>=0&&C<c){const G=C*h,$=g+v+G+I;L=p[$]}i[R]=L}}}}return{dataId:s.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Q5(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i,bias:l,preluActivationWeights:u}=e,{strides:c,pad:h,dataFormat:p,dilations:m,dimRoundingMode:g,activation:y,leakyreluAlpha:v}=r;let w=tN({inputs:{x:s,filter:i},backend:t,attrs:{strides:c,pad:h,dataFormat:p,dilations:m,dimRoundingMode:g}});if(l){const S=w;if(p==="NCHW"&&l.shape.length===1&&l.shape[0]!==1){const I=kt({inputs:{x:l},backend:t,attrs:{shape:[l.shape[0],1,1]}});w=hl({inputs:{a:w,b:I},backend:t}),t.disposeIntermediateTensorInfo(I)}else w=hl({inputs:{a:w,b:l},backend:t});t.disposeIntermediateTensorInfo(S)}if(y){const S=w;if(p==="NCHW"&&y==="prelu"&&u.shape.length===1&&u.shape[0]!==1){const I=kt({inputs:{x:u},backend:t,attrs:{shape:[u.shape[0],1,1]}});w=rf(t,w,y,I,v),t.disposeIntermediateTensorInfo(I)}else w=rf(t,w,y,u,v);t.disposeIntermediateTensorInfo(S)}return w}const J5={kernelName:lp,backendName:"cpu",kernelFunc:Q5};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function q5(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i,bias:l,preluActivationWeights:u}=e,{strides:c,pad:h,dataFormat:p,dilations:m,dimRoundingMode:g,activation:y,leakyreluAlpha:v}=r;let w=nN({inputs:{x:s,filter:i},backend:t,attrs:{strides:c,pad:h,dataFormat:p,dilations:m,dimRoundingMode:g}});if(l){const S=w;w=hl({inputs:{a:w,b:l},backend:t}),t.disposeIntermediateTensorInfo(S)}if(y){const S=w;w=rf(t,w,y,u,v),t.disposeIntermediateTensorInfo(S)}return w}const e9={kernelName:Vw,backendName:"cpu",kernelFunc:q5};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function t9(n){const{inputs:e,backend:t}=n,{params:r,indices:s}=e,i=M(r.shape),l=s.shape,u=l[l.length-1],[c,h,p,m]=mb(r,s);if(h===0)return t.makeTensorInfo(c,r.dtype,[]);const g=t.data.get(s.dataId).values,y=t.bufferSync(r),v=uT(g,y,r.dtype,h,u,p,m,r.shape,i);return t.makeTensorInfo(c,r.dtype,v.values)}const n9={kernelName:xw,backendName:"cpu",kernelFunc:t9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function r9(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,indices:i}=e,{axis:l,batchDims:u}=r;$e([s,i],"gatherV2");const c=oe(l,s.shape)[0],h=t.data.get(i.dataId).values,p=s.shape[c];for(let L=0;L<h.length;++L){const G=h[L];T(G<=p-1&&G>=0,()=>`GatherV2: the index value ${G} is not in [0, ${p-1}]`)}let m=u;u==null&&(m=0);const g=M(i.shape),y=Ab(s,i,c,m),v=kt({inputs:{x:s},backend:t,attrs:{shape:[y.batchSize,y.outerSize,y.dimSize,y.sliceSize]}}),w=kt({inputs:{x:i},backend:t,attrs:{shape:[y.batchSize,g/y.batchSize]}}),S=[y.batchSize,y.outerSize,g/y.batchSize,y.sliceSize],I=t.bufferSync(w),C=t.bufferSync(v),R=cT(C,I,S);return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(w),t.makeTensorInfo(y.outputShape,R.dtype,R.values)}const s9={kernelName:Ch,backendName:"cpu",kernelFunc:r9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function a9(n){const{inputs:e,backend:t}=n,{input:r}=e,s=M(r.shape),i=r.shape[r.shape.length-1],l=s/i,u=kt({inputs:{x:r},backend:t,attrs:{shape:[l,i]}}),c=rN(u,!0,t),h=kt({inputs:{x:c},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(c),h}const i9={kernelName:jg,backendName:"cpu",kernelFunc:a9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const o9=ft(zu,n=>Number.isFinite(n)?1:0,"bool"),l9={kernelName:zu,backendName:"cpu",kernelFunc:o9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const u9=ft(Wu,n=>Math.abs(n)===1/0?1:0,"bool"),c9={kernelName:Wu,backendName:"cpu",kernelFunc:u9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const d9=ft(Mu,n=>Number.isNaN(n)?1:0,"bool"),h9={kernelName:Mu,backendName:"cpu",kernelFunc:d9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function p9(n){const{backend:e,attrs:t}=n,{start:r,stop:s,num:i}=t,l=mT(r,s,i);return e.makeTensorInfo([l.length],"float32",l)}const f9={kernelName:vw,backendName:"cpu",kernelFunc:p9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const m9=ft(Fu,n=>Math.log1p(n)),g9={kernelName:Fu,backendName:"cpu",kernelFunc:m9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const b9=qt((n,e)=>n&&e),y9=hn(Lh,b9,null,"bool"),x9={kernelName:Lh,backendName:"cpu",kernelFunc:y9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const v9=ft(Gh,n=>n?0:1,"bool"),w9={kernelName:Gh,backendName:"cpu",kernelFunc:v9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const k9=qt((n,e)=>n||e),I9=hn(zh,k9,null,"bool"),S9={kernelName:zh,backendName:"cpu",kernelFunc:I9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function C9(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{depthRadius:i,bias:l,alpha:u,beta:c}=r;$e(s,"LRN");const h=s.shape[3],p=h-1,m=t.data.get(s.dataId).values,g=M(s.shape),y=new Float32Array(g);function v(w){const S=w%h;let I=w-S+Math.max(0,S-i);const C=w-S+Math.min(S+i,p);let R=0;for(;I<=C;I++){const L=m[I];R+=L*L}return R}for(let w=0;w<g;w++){const S=v(w),I=m[w]*Math.pow(l+u*S,-c);y[w]=I}return t.makeTensorInfo(s.shape,s.dtype,y)}const T9={kernelName:Wh,backendName:"cpu",kernelFunc:C9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function N9(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,y:i,dy:l}=e,{depthRadius:u,bias:c,alpha:h,beta:p}=r;$e(l,"LRNGrad");const m=M(l.shape),g=l.shape[3],y=t.data.get(l.dataId).values,v=t.data.get(s.dataId).values,w=t.data.get(i.dataId).values,S=new Float32Array(m),I=m;for(let C=0;C<I;C++){const R=C%g,L=C-R+Math.max(0,R-u),G=C-R+Math.min(g,R+u+1);let $=0;for(let F=L;F<G;F++)$+=Math.pow(v[F],2);$=h*$+c;for(let F=L;F<G;F++){let V=-2*h*p*v[F]*w[C]/$;C===F&&(V+=Math.pow($,-p)),V*=y[C],S[F]+=V}}return t.makeTensorInfo(l.shape,s.dtype,S)}const R9={kernelName:Qg,backendName:"cpu",kernelFunc:N9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sN(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{reductionIndices:i,keepDims:l}=r,u=t;let c=s.shape;const h=c.length,p=oe(i,c);let m=p;const g=Xt(m,h);let y=u.data.get(s.dataId).values;if(g!=null){const L=new Array(h);for(let G=0;G<L.length;G++)L[G]=c[g[G]];y=Ly(y,c,s.dtype,g,L),m=Yt(m.length,h),c=L}$e(s,"max"),In("max",m,h);const[v,w]=mn(c,m),S=M(w),I=bT(y,S,v,s.dtype),C=u.write(I,v,s.dtype);let R=v;return l&&(R=nn(v,p)),{dataId:C,shape:R,dtype:s.dtype}}const E9={kernelName:Mh,backendName:"cpu",kernelFunc:sN};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function L9(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;$e(s,"maxPool");const{filterSize:i,strides:l,pad:u,dimRoundingMode:c}=r,h=1;T(Rn(l,h),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${l} and dilations '${h}'`);const p=_r(s.shape,i,l,h,u,c);let m;if(p.filterWidth===1&&p.filterHeight===1&&B(p.inShape,p.outShape))m=Us({inputs:{x:s},backend:t});else{const g=t.data.get(s.dataId).values,y=we(s.shape),v=Wy(g,s.shape,s.dtype,y,p,"max");m=t.makeTensorInfo(p.outShape,s.dtype,v.values)}return m}const G9={kernelName:$h,backendName:"cpu",kernelFunc:L9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function z9(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{filterSize:i,strides:l,pad:u,dimRoundingMode:c,dataFormat:h}=r;$e(s,"maxPool3d");const p=ha(s.shape,i,l,1,u,c,h),m=t.data.get(s.dataId).values,g=eN(m,s.shape,s.dtype,we(s.shape),p,"max");return t.makeTensorInfo(g.shape,"float32",g.values)}const W9={kernelName:Fh,backendName:"cpu",kernelFunc:z9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function M9(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i}=e,{filterSize:l,strides:u,pad:c,dimRoundingMode:h}=r;$e([s,i],"maxPool3DGrad");const p=ha(i.shape,l,u,1,c,h),m=t.bufferSync(i),g=I4(m,p),y=p.strideDepth,v=p.strideHeight,w=p.strideWidth,S=p.dilationDepth,I=p.dilationHeight,C=p.dilationWidth,R=p.effectiveFilterDepth,L=p.effectiveFilterHeight,G=p.effectiveFilterWidth,$=R-1-p.padInfo.front,F=G-1-p.padInfo.left,V=L-1-p.padInfo.top,D=Je(i.shape,"float32"),Z=t.bufferSync(s);for(let ne=0;ne<p.batchSize;++ne)for(let re=0;re<p.inChannels;++re)for(let se=0;se<p.inDepth;++se)for(let ue=0;ue<p.inHeight;++ue)for(let le=0;le<p.inWidth;++le){const he=se-$,me=ue-V,pe=le-F;let ye=0;for(let Ie=0;Ie<R;Ie+=S){const ve=(he+Ie)/y;if(!(ve<0||ve>=p.outDepth||Math.floor(ve)!==ve))for(let Ce=0;Ce<L;Ce+=I){const Te=(me+Ce)/v;if(!(Te<0||Te>=p.outHeight||Math.floor(Te)!==Te))for(let Re=0;Re<G;Re+=C){const Le=(pe+Re)/w;if(Le<0||Le>=p.outWidth||Math.floor(Le)!==Le)continue;const De=R*L*G-1-g.get(ne,ve,Te,Le,re),Pe=Ie*L*G+Ce*G+Re,Ae=De===Pe?1:0;if(Ae===0)continue;const Ue=Z.get(ne,ve,Te,Le,re);ye+=Ue*Ae}}}D.set(ye,ne,se,ue,le,re)}return t.makeTensorInfo(D.shape,D.dtype,D.values)}const $9={kernelName:qg,backendName:"cpu",kernelFunc:M9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function F9(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i,output:l}=e,u=i;$e([i,l],"maxPoolGrad");const{filterSize:c,strides:h,pad:p,dimRoundingMode:m}=r,g=_r(u.shape,c,h,1,p,m),y=t.data.get(u.dataId).values,v=Je(g.outShape,u.dtype,qT(y,u.shape,u.dtype,g).values),w=g.strideHeight,S=g.strideWidth,I=g.dilationHeight,C=g.dilationWidth,R=g.effectiveFilterHeight,L=g.effectiveFilterWidth,G=L-1-g.padInfo.left,$=R-1-g.padInfo.top,F=Je(u.shape,"float32"),V=t.data.get(s.dataId).values,D=Je(s.shape,"float32",V);for(let Z=0;Z<g.batchSize;++Z)for(let ne=0;ne<g.inChannels;++ne)for(let re=0;re<g.inHeight;++re)for(let se=0;se<g.inWidth;++se){const ue=re-$,le=se-G;let he=0;for(let me=0;me<R;me+=I){const pe=(ue+me)/w;if(!(pe<0||pe>=g.outHeight||Math.floor(pe)!==pe))for(let ye=0;ye<L;ye+=C){const Ie=(le+ye)/S;if(Ie<0||Ie>=g.outWidth||Math.floor(Ie)!==Ie)continue;const ve=R*L-1-v.get(Z,pe,Ie,ne),Ce=me*L+ye,Te=ve===Ce?1:0;if(Te===0)continue;const Re=D.get(Z,pe,Ie,ne);he+=Re*Te}}F.set(he,Z,re,se,ne)}return t.makeTensorInfo(F.shape,F.dtype,F.values)}const V9={kernelName:Jg,backendName:"cpu",kernelFunc:F9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function P9(n,e,t,r,s){const i=we(e),l=Wy(n,e,t,i,s,"max"),u=qT(n,e,t,s,!0,r);return[l.values,u.values]}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const X9={kernelName:ww,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:r}=n,{filterSize:s,strides:i,pad:l,includeBatchInIndex:u}=e,c=t;$e(r,"MaxPoolWithArgmax");const h=c.data.get(r.dataId).values,p=_r(r.shape,s,i,[1,1],l),[m,g]=P9(h,r.shape,r.dtype,u,p),y=c.write(m,p.outShape,r.dtype),v=c.write(g,p.outShape,r.dtype);return[{dataId:y,shape:p.outShape,dtype:r.dtype},{dataId:v,shape:p.outShape,dtype:"int32"}]}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function O9(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:l}=r,u=oe(i,s.shape),c=mn(s.shape,u)[1],h=M(c),p=[],m=t.makeTensorInfo([],"float32",new Float32Array([h]));p.push(m);const g=si({inputs:{x:s},backend:t,attrs:{dtype:"float32"}});p.push(g);const y=My({inputs:{a:g,b:m},backend:t});p.push(y);const v=Kc({inputs:{x:y},backend:t,attrs:{axis:i,keepDims:l}});return p.forEach(w=>t.disposeIntermediateTensorInfo(w)),v}const D9={kernelName:Vh,backendName:"cpu",kernelFunc:O9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function A9(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:l}=r;$e(s,"min");const u=oe(i,s.shape);let c=u;const h=Xt(c,s.shape.length);let p=s;h!=null&&(p=rr({inputs:{x:s},backend:t,attrs:{perm:h}}),c=Yt(c.length,s.shape.length)),In("min",c,p.shape.length);const[m,g]=mn(p.shape,c),y=M(g),v=Pt(M(m),p.dtype),w=t.data.get(p.dataId).values;for(let I=0;I<v.length;++I){const C=I*y;let R=w[C];for(let L=0;L<y;++L){const G=w[C+L];(Number.isNaN(G)||G<R)&&(R=G)}v[I]=R}h!=null&&t.disposeIntermediateTensorInfo(p);const S=t.makeTensorInfo(m,p.dtype,v);if(l){const I=nn(m,u),C=kt({inputs:{x:S},backend:t,attrs:{shape:I}});return t.disposeIntermediateTensorInfo(S),C}return S}const K9={kernelName:Ph,backendName:"cpu",kernelFunc:A9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Z9(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{paddings:i,mode:l}=r;$e(s,"mirrorPad");const u=i.map((C,R)=>C[0]+s.shape[R]+C[1]),c=i.map(C=>C[0]),h=i.map((C,R)=>C[0]+s.shape[R]),p=l==="reflect"?0:1,m=t.data.get(s.dataId).values,g=s.shape.length,y=we(s.shape),v=M(u),w=u.length,S=we(u),I=ge(s.dtype,v);for(let C=0;C<v;C++){let R=Ao(C,w,S);for(let G=0;G<w;G++)R[G]<c[G]?R[G]=c[G]*2-R[G]-p:R[G]>=h[G]&&(R[G]=(h[G]-1)*2-R[G]+p);R=R.map((G,$)=>G-c[$]);const L=Fs(R,g,y);I[C]=m[L]}return{dataId:t.write(I,u,s.dtype),shape:u,dtype:s.dtype}}const B9={kernelName:Xh,backendName:"cpu",kernelFunc:Z9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const _9=qt((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e}),H9=hn(Xu,_9),U9={kernelName:Xu,backendName:"cpu",kernelFunc:H9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function aN(n){const{inputs:e,backend:t,attrs:r}=n,{logits:s}=e,{dim:i}=r,l=s.shape.length;let u=i;if(u===-1&&(u=l-1),u!==l-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${l} and dim was ${u}`);const c=oe([u],s.shape),h=sN({inputs:{x:s},backend:t,attrs:{reductionIndices:c,keepDims:!1}}),p=nn(h.shape,c),m=kt({inputs:{x:h},backend:t,attrs:{shape:p}}),g=zy({inputs:{a:s,b:m},backend:t}),y=aT({inputs:{x:g},backend:t}),v=Kc({inputs:{x:y},backend:t,attrs:{axis:c,keepDims:!1}}),w=kt({inputs:{x:v},backend:t,attrs:{shape:p}}),S=My({inputs:{a:y,b:w},backend:t});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(w),S}const j9={kernelName:rp,backendName:"cpu",kernelFunc:aN};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Y9(n){const{inputs:e,backend:t,attrs:r}=n,{logits:s}=e,{numSamples:i,seed:l,normalized:u}=r;$e(s,"multinomial");const c=u?s:aN({inputs:{logits:s},backend:t,attrs:{dim:-1}}),h=c.shape[0],p=c.shape[1],m=t.data.get(c.dataId).values,g=[h,i],y=Pt(M(g),"int32");for(let v=0;v<h;++v){const w=v*p,S=new Float32Array(p-1);S[0]=m[w];for(let R=1;R<S.length;++R)S[R]=S[R-1]+m[w+R];const I=q0.alea(l.toString()),C=v*i;for(let R=0;R<i;++R){const L=I();y[C+R]=S.length;for(let G=0;G<S.length;G++)if(L<S[G]){y[C+R]=G;break}}}return u||t.disposeIntermediateTensorInfo(c),t.makeTensorInfo(g,"int32",y)}const Q9={kernelName:kw,backendName:"cpu",kernelFunc:Y9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const J9=cb;function q9(n){const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:i}=e,{maxOutputSize:l,iouThreshold:u,scoreThreshold:c}=r;$e(s,"NonMaxSuppression");const h=t.data.get(s.dataId).values,p=t.data.get(i.dataId).values,{selectedIndices:m}=J9(h,p,l,u,c);return t.makeTensorInfo([m.length],"int32",new Int32Array(m))}const eB={kernelName:e0,backendName:"cpu",kernelFunc:q9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const tB=db;function nB(n){const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:i}=e,{maxOutputSize:l,iouThreshold:u,scoreThreshold:c,padToMaxOutputSize:h}=r;$e(s,"NonMaxSuppressionPadded");const p=t.data.get(s.dataId).values,m=t.data.get(i.dataId).values,{selectedIndices:g,validOutputs:y}=tB(p,m,l,u,c,h);return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([],"int32",new Int32Array([y]))]}const rB={kernelName:t0,backendName:"cpu",kernelFunc:nB};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const sB=hb;function aB(n){const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:i}=e,{maxOutputSize:l,iouThreshold:u,scoreThreshold:c,softNmsSigma:h}=r;$e(s,"NonMaxSuppressionWithScore");const p=t.data.get(s.dataId).values,m=t.data.get(i.dataId).values,g=l,y=u,v=c,w=h,{selectedIndices:S,selectedScores:I}=sB(p,m,g,y,v,w);return[t.makeTensorInfo([S.length],"int32",new Int32Array(S)),t.makeTensorInfo([I.length],"float32",new Float32Array(I))]}const iB={kernelName:n0,backendName:"cpu",kernelFunc:aB};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function oB(n){const{inputs:e,backend:t,attrs:r}=n,{indices:s}=e,{dtype:i,depth:l,onValue:u,offValue:c}=r;$e(s,"oneHot");const h=M(s.shape),p=new Float32Array(h*l);p.fill(c);const m=t.data.get(s.dataId).values;for(let g=0;g<h;++g)m[g]>=0&&m[g]<l&&(p[g*l+m[g]]=u);return t.makeTensorInfo([...s.shape,l],i,p)}const lB={kernelName:Kh,backendName:"cpu",kernelFunc:oB};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function af(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){const s=co({inputs:{input:r},backend:t}),i=af({inputs:{x:s},backend:t}),l=pl({inputs:{input:r},backend:t}),u=af({inputs:{x:l},backend:t}),c=fr({inputs:{real:i,imag:u},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(u),c}else return Vy({backend:t,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}const uB={kernelName:ip,backendName:"cpu",kernelFunc:af};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function iN(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){const s=co({inputs:{input:r},backend:t}),i=iN({inputs:{x:s},backend:t}),l=pl({inputs:{input:r},backend:t}),u=af({inputs:{x:l},backend:t}),c=fr({inputs:{real:i,imag:u},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(u),c}else return Vy({backend:t,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}const cB={kernelName:Ah,backendName:"cpu",kernelFunc:iN};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function oN(n){const{inputs:e,backend:t,attrs:r}=n,{axis:s}=r;if(e.length===1)return sf({inputs:{input:e[0]},backend:t,attrs:{dim:s}});const i=e[0].shape,l=e[0].dtype;e.forEach(p=>{A(i,p.shape,"All tensors passed to stack must have matching shapes"),T(l===p.dtype,()=>"All tensors passed to stack must have matching dtypes")});const u=[],c=e.map(p=>{const m=sf({inputs:{input:p},backend:t,attrs:{dim:s}});return u.push(m),m}),h=fl({inputs:c,backend:t,attrs:{axis:s}});return u.forEach(p=>t.disposeIntermediateTensorInfo(p)),h}const dB={kernelName:Zh,backendName:"cpu",kernelFunc:oN};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hB(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{paddings:i,constantValue:l}=r;$e(s,"pad");const u=i.map((I,C)=>I[0]+s.shape[C]+I[1]),c=i.map(I=>I[0]),h=t.data.get(s.dataId).values,p=M(s.shape),m=s.shape.length,g=we(s.shape),y=M(u),v=u.length,w=we(u),S=ge(s.dtype,y);l!==0&&S.fill(l);for(let I=0;I<p;I++){const C=Ao(I,m,g).map((L,G)=>L+c[G]),R=Fs(C,v,w);S[R]=h[I]}return{dataId:t.write(S,u,s.dtype),shape:u,dtype:s.dtype}}const lN={kernelName:Bh,backendName:"cpu",kernelFunc:hB};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const pB=qt((n,e)=>Math.pow(n,e)),fB=hn(Du,pB),mB={kernelName:Du,backendName:"cpu",kernelFunc:fB};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function gB(n){const{inputs:e,backend:t,attrs:r}=n,{paramsNestedSplits:s,paramsDenseValues:i,indices:l}=e,u=s.map(S=>t.data.get(S.dataId).values),c=s.map(S=>S.shape),h=t.data.get(i.dataId).values,p=t.data.get(l.dataId).values,[m,g,y]=ST(u,c,h,i.shape,i.dtype,p,l.shape),v=m.map(S=>t.makeTensorInfo([S.length],"int32",S)),w=t.makeTensorInfo(y,i.dtype,g);return v.concat([w])}const bB={kernelName:Iw,backendName:"cpu",kernelFunc:gB};/**
* @license
* Copyright 2022 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yB(n){const{inputs:e,backend:t}=n,{starts:r,limits:s,deltas:i}=e,l=t.data.get(r.dataId).values,u=t.data.get(s.dataId).values,c=t.data.get(i.dataId).values,[h,p]=TT(l,r.shape,r.dtype,u,s.shape,c,i.shape),m=t.makeTensorInfo([h.length],"int32",h),g=t.makeTensorInfo([p.length],r.dtype,p);return[m,g]}const xB={kernelName:Sw,backendName:"cpu",kernelFunc:yB};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vB(n){const{inputs:e,backend:t,attrs:r}=n,{shape:s,values:i,defaultValue:l,rowPartitionTensors:u}=e,{rowPartitionTypes:c}=r,h=t.data.get(s.dataId).values,p=t.data.get(i.dataId).values,m=t.data.get(l.dataId).values,g=u.map(S=>t.data.get(S.dataId).values),y=u.map(S=>S.shape),[v,w]=ET(h,s.shape,p,i.shape,i.dtype,m,l.shape,g,y,c);return t.makeTensorInfo(v,i.dtype,w)}const wB={kernelName:Cw,backendName:"cpu",kernelFunc:vB};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function kB(n){const{backend:e,attrs:t}=n,{start:r,stop:s,dtype:i,step:l}=t,u=LT(r,s,l,i);return e.makeTensorInfo([u.length],i,u)}const IB={kernelName:r0,backendName:"cpu",kernelFunc:kB};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const SB=ft(Au,n=>1/n),CB={kernelName:Au,backendName:"cpu",kernelFunc:SB};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function TB(n){const{inputs:e,backend:t,attrs:r}=n,{images:s}=e,{alignCorners:i,halfPixelCenters:l,size:u}=r;$e(s,"resizeBilinear");const c=we(s.shape),[h,p]=u,[m,g,y,v]=s.shape,w=t.data.get(s.dataId).values,S=new Float32Array(M([m,h,p,v])),I=[i&&h>1?g-1:g,i&&p>1?y-1:y],C=[i&&h>1?h-1:h,i&&p>1?p-1:p];let R=0;const L=I[0]/C[0],G=I[1]/C[1];for(let $=0;$<m;$++)for(let F=0;F<h;F++){let V;l?V=L*(F+.5)-.5:V=L*F;const D=Math.max(0,Math.floor(V)),Z=V-D,ne=Math.min(g-1,Math.ceil(V)),re=$*c[0]+D*c[1],se=$*c[0]+ne*c[1];for(let ue=0;ue<p;ue++){let le;l?le=G*(ue+.5)-.5:le=G*ue;const he=Math.max(0,Math.floor(le)),me=le-he,pe=Math.min(y-1,Math.ceil(le)),ye=re+he*c[2],Ie=se+he*c[2],ve=re+pe*c[2],Ce=se+pe*c[2];for(let Te=0;Te<v;Te++){const Re=w[ye+Te],Le=w[Ie+Te],De=w[ve+Te],Pe=w[Ce+Te],Ae=Re+(De-Re)*me,Ue=Le+(Pe-Le)*me,je=Ae+(Ue-Ae)*Z;S[R++]=je}}}return t.makeTensorInfo([m,h,p,v],"float32",S)}const NB={kernelName:Yh,backendName:"cpu",kernelFunc:TB};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function RB(n){const{inputs:e,backend:t,attrs:r}=n,{images:s,dy:i}=e,{alignCorners:l}=r;$e([i,s],"resizeBilinearGrad");const u=we(s.shape),[c,h,p,m]=s.shape,[,g,y]=i.shape,v=new Float32Array(c*h*p*m),w=[l&&g>1?h-1:h,l&&y>1?p-1:p],S=[l&&g>1?g-1:g,l&&y>1?y-1:y],I=w[0]/S[0],C=w[1]/S[1],R=t.data.get(i.dataId).values;let L=0;for(let G=0;G<c;G++){const $=G*u[0];for(let F=0;F<g;F++){const V=F*I,D=Math.floor(V),Z=Math.min(Math.ceil(V),h-1),ne=$+D*u[1],re=$+Z*u[1],se=V-D,ue=1-se;for(let le=0;le<y;le++){const he=le*C,me=Math.floor(he),pe=Math.min(Math.ceil(he),p-1),ye=he-me,Ie=1-ye,ve=ne+me*u[2],Ce=ne+pe*u[2],Te=re+me*u[2],Re=re+pe*u[2],Le=ue*Ie,De=ue*ye,Pe=se*Ie,Ae=se*ye;for(let Ue=0;Ue<m;Ue++){const je=R[L++];v[ve+Ue]+=je*Le,v[Ce+Ue]+=je*De,v[Te+Ue]+=je*Pe,v[Re+Ue]+=je*Ae}}}}return t.makeTensorInfo([c,p,h,m],"float32",v)}const EB={kernelName:i0,backendName:"cpu",kernelFunc:RB};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function LB(n){const{inputs:e,backend:t,attrs:r}=n,{images:s}=e,{alignCorners:i,halfPixelCenters:l,size:u}=r;$e(s,"resizeNearestNeighbor");const c=we(s.shape),[h,p]=u,[m,g,y,v]=s.shape,w=t.data.get(s.dataId).values,S=new Float32Array(m*h*p*v),I=[i&&h>1?g-1:g,i&&p>1?y-1:y],C=[i&&h>1?h-1:h,i&&p>1?p-1:p],R=I[0]/C[0],L=I[1]/C[1];let G=0;for(let $=0;$<m;$++){const F=$*c[0];for(let V=0;V<h;V++){const D=l?R*(V+.5):R*V;let Z=Math.min(g-1,i?Math.round(D):Math.floor(D));l&&(Z=Math.max(0,Z));const ne=F+Z*c[1];for(let re=0;re<p;re++){const se=l?L*(re+.5):L*re;let ue=Math.min(y-1,i?Math.round(se):Math.floor(se));l&&(ue=Math.max(0,ue));const le=ne+ue*c[2];for(let he=0;he<v;he++){const me=w[le+he];S[G++]=me}}}}return t.makeTensorInfo([m,h,p,v],s.dtype,S)}const GB={kernelName:jh,backendName:"cpu",kernelFunc:LB};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function zB(n){const{inputs:e,backend:t,attrs:r}=n,{images:s,dy:i}=e,{alignCorners:l}=r;$e([i,s],"resizeNearestNeighborGrad");const u=we(s.shape),c=we(i.shape),[h,p,m,g]=s.shape,[,y,v]=i.shape,w=new Float32Array(h*p*m*g),S=t.data.get(i.dataId).values,I=[l&&y>1?p-1:p,l&&v>1?m-1:m],C=[l&&y>1?y-1:y,l&&v>1?v-1:v],R=I[0]/C[0],L=I[1]/C[1],G=1/R,$=1/L,F=Math.ceil(G)*2+2,V=Math.ceil($)*2+2;for(let D=0;D<h;D++){const Z=D*u[0];for(let ne=0;ne<p;ne++){const re=Z+ne*u[1],se=Math.floor(ne*G),ue=Math.floor(se-F/2);for(let le=0;le<m;le++){const he=re+le*u[2],me=Math.floor(le*$),pe=Math.floor(me-V/2);for(let ye=0;ye<g;ye++){let Ie=0;for(let ve=0;ve<F;ve++){const Ce=ve+ue;if(Ce<0||Ce>=y)continue;const Te=Z+Ce*c[1],Re=Ce*R,Le=Math.min(p-1,l?Math.round(Re):Math.floor(Re));if(ne===Le)for(let De=0;De<V;De++){const Pe=De+pe;if(Pe<0||Pe>=v)continue;const Ae=Te+Pe*c[2],Ue=Pe*L,je=Math.min(m-1,l?Math.round(Ue):Math.floor(Ue));le===je&&(Ie+=S[Ae+ye])}}w[he+ye]=Ie}}}}return t.makeTensorInfo(s.shape,s.dtype,w)}const WB={kernelName:a0,backendName:"cpu",kernelFunc:zB};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function MB(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{dims:i}=r;$e(s,"reverse");const l=s.shape.length,u=oe(i,s.shape);if(l===0)return Us({inputs:{x:s},backend:t});const c=new wn(s.shape,s.dtype),h=t.bufferSync(s);for(let p=0;p<c.size;p++){const m=c.indexToLoc(p),g=m.slice();u.forEach(y=>g[y]=s.shape[y]-1-g[y]),c.set(h.get(...g),...m)}return t.makeTensorInfo(c.shape,c.dtype,c.values)}const $B={kernelName:Qh,backendName:"cpu",kernelFunc:MB};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const FB={kernelName:f0,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:r}=n,{radians:s,fillValue:i,center:l}=e,u=t,c=ge(r.dtype,M(r.shape)),[h,p,m,g]=r.shape,[y,v]=Sb(l,p,m),w=255,S=Math.sin(s),I=Math.cos(s),C=u.data.get(r.dataId).values;for(let R=0;R<h;R++){const L=R*m*p*g;for(let G=0;G<p;G++){const $=G*(m*g);for(let F=0;F<m;F++){const V=F*g;for(let D=0;D<g;D++){const Z=[h,G,F,D],ne=Z[2],re=Z[1];let se=(ne-y)*I-(re-v)*S,ue=(ne-y)*S+(re-v)*I;se=Math.round(se+y),ue=Math.round(ue+v);let le=i;if(typeof i!="number"&&(D===3?le=w:le=i[D]),se>=0&&se<m&&ue>=0&&ue<p){const me=ue*(m*g),pe=se*g,ye=L+me+pe+D;le=C[ye]}const he=L+$+V+D;c[he]=le}}}}return{dataId:u.write(c,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const VB=ft(Bu,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),PB={kernelName:Bu,backendName:"cpu",kernelFunc:VB};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function XB(n){const{inputs:e,backend:t,attrs:r}=n,{indices:s,updates:i}=e,{shape:l}=r,{sliceRank:u,numUpdates:c,sliceSize:h,strides:p,outputSize:m}=eo(i,s,l),g=!0,y=t.bufferSync(s),v=t.bufferSync(i),w=ho(y,v,l,m,h,c,u,p,0,g);return t.makeTensorInfo(l,w.dtype,w.values)}const OB={kernelName:Tw,backendName:"cpu",kernelFunc:XB};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function DB(n,e){let t=0,r=n.length,s=0;for(;t<r;)s=Math.floor((t+r)/2),n[s]<e?t=s+1:r=s;return r}function AB(n,e){let t=0,r=n.length,s=0;for(;t<r;)s=Math.floor((t+r)/2),n[s]<=e?t=s+1:r=s;return r}function KB(n,e,t,r,s,i){const l=be("int32",t*s);for(let u=0;u<t;++u){const c=n.slice(u*r,(u+1)*r),h=u*s;for(let p=0;p<s;++p)l[h+p]=i==="left"?DB(c,e[p+h]):AB(c,e[p+h])}return l}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ZB(n){const{inputs:e,backend:t,attrs:r}=n,{sortedSequence:s,values:i}=e,{side:l}=r,u=t.data.get(s.dataId).values,c=t.data.get(i.dataId).values,h=KB(u,c,s.shape[0],s.shape[1],i.shape[1],l);return t.makeTensorInfo(i.shape,"int32",h)}const BB={kernelName:Rw,backendName:"cpu",kernelFunc:ZB};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _B(n){const{inputs:e,backend:t}=n,{condition:r,t:s,e:i}=e;$e([r,s,i],"select");const l=r.shape.length,u=t.data.get(r.dataId).values,c=t.data.get(s.dataId).values,h=t.data.get(i.dataId).values,p=dr(s.dtype,i.dtype),m=Pt(M(s.shape),p);let g=0;const y=l===0||l>1||s.shape.length===1?1:M(s.shape.slice(1));for(let v=0;v<u.length;v++)for(let w=0;w<y;w++)u[v]===1?m[g++]=c[v]:m[g++]=h[v];return t.makeTensorInfo(s.shape,p,m)}const HB={kernelName:Jh,backendName:"cpu",kernelFunc:_B};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const UB=Rp,jB=Ep,YB=ft(Hu,n=>n>=0?jB*n:UB*(Math.exp(n)-1)),QB={kernelName:Hu,backendName:"cpu",kernelFunc:YB};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const JB=ft(Yu,n=>n<0?-1:n>0?1:0),qB={kernelName:Yu,backendName:"cpu",kernelFunc:JB};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const e_=ft(Uu,n=>Math.sin(n)),t_={kernelName:Uu,backendName:"cpu",kernelFunc:e_};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const n_=ft(ju,n=>Math.sinh(n)),r_={kernelName:ju,backendName:"cpu",kernelFunc:n_};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const uN=Math.log(11920928955078125e-23)+2,s_=ft(Ju,n=>{const e=n>-uN,t=n<uN,r=Math.exp(n);let s;return t?s=r:e?s=n:s=Math.log(1+r),s}),a_={kernelName:Ju,backendName:"cpu",kernelFunc:s_};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function i_(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockShape:i,paddings:l}=r;$e([s],"spaceToBatchND");const u=M(i),c=[[0,0]];c.push(...l);for(let S=1+i.length;S<s.shape.length;++S)c.push([0,0]);const h=lN.kernelFunc({inputs:{x:s},backend:t,attrs:{paddings:c,constantValue:0}}),p=Ic(h.shape,i,u,!1),m=Sc(p.length,i.length,!1),g=Cc(h.shape,i,u,!1),y=kt({inputs:{x:h},backend:t,attrs:{shape:p}}),v=rr({inputs:{x:y},backend:t,attrs:{perm:m}}),w=kt({inputs:{x:v},backend:t,attrs:{shape:g}});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(v),w}const o_={kernelName:tp,backendName:"cpu",kernelFunc:i_};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function l_(n){const{inputs:e,backend:t}=n,{indices:r,values:s,denseShape:i,defaultValue:l}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${r.shape}`);if(s.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${s.shape}`);if(l.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${l.shape}`);const u=t.data.get(r.dataId).values,c=t.data.get(s.dataId).values,h=t.data.get(i.dataId).values,p=t.data.get(l.dataId).values[0],[m,g,y,v,w]=MT(u,r.shape,r.dtype,c,s.dtype,h,p);return[t.makeTensorInfo(g,r.dtype,m),t.makeTensorInfo([g[0]],s.dtype,y),t.makeTensorInfo([v.length],"bool",new Uint8Array(v.map(S=>Number(S)))),t.makeTensorInfo([w.length],r.dtype,new Int32Array(w))]}const u_={kernelName:Ew,backendName:"cpu",kernelFunc:l_};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function c_(n){const{inputs:e,backend:t}=n,{inputIndices:r,inputShape:s,newShape:i}=e;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(s.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${s.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const l=Array.from(t.data.get(s.dataId).values),u=t.data.get(r.dataId).values,c=Array.from(t.data.get(i.dataId).values),[h,p,m]=$T(u,r.shape,r.dtype,l,c);return[t.makeTensorInfo(p,r.dtype,h),t.makeTensorInfo([m.length],i.dtype,new Int32Array(m))]}const d_={kernelName:Lw,backendName:"cpu",kernelFunc:c_};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function h_(n){const{inputs:e,backend:t}=n,{data:r,indices:s,segmentIds:i}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${s.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${i.shape}`);if(s.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const l=t.data.get(r.dataId).values,u=t.data.get(s.dataId).values,c=t.data.get(i.dataId).values,[h,p]=Gy(l,r.shape,r.dtype,u,c,!0);return t.makeTensorInfo(p,r.dtype,h)}const p_={kernelName:Gw,backendName:"cpu",kernelFunc:h_};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function f_(n){const{inputs:e,backend:t}=n,{data:r,indices:s,segmentIds:i}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${s.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${i.shape}`);if(s.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const l=t.data.get(r.dataId).values,u=t.data.get(s.dataId).values,c=t.data.get(i.dataId).values,[h,p]=Gy(l,r.shape,r.dtype,u,c);return t.makeTensorInfo(p,r.dtype,h)}const m_={kernelName:zw,backendName:"cpu",kernelFunc:f_};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function g_(n){const{inputs:e,backend:t,attrs:r}=n,{sparseIndices:s,sparseValues:i,defaultValue:l}=e,{outputShape:u}=r,{sliceRank:c,numUpdates:h,sliceSize:p,strides:m,outputSize:g}=eo(i,s,u),y=!1,v=t.bufferSync(s);let w;switch(i.dtype){case"bool":{const S=t.bufferSync(i),I=!!t.data.get(l.dataId).values[0];w=ho(v,S,u,g,p,h,c,m,I,y);break}case"float32":{const S=t.bufferSync(i),I=t.data.get(l.dataId).values[0];w=ho(v,S,u,g,p,h,c,m,I,y);break}case"int32":{const S=t.bufferSync(i),I=t.data.get(l.dataId).values[0];w=ho(v,S,u,g,p,h,c,m,I,y);break}case"string":{const S=t.bufferSync(i),I=Aa(t.data.get(l.dataId).values[0]);w=ho(v,S,u,g,p,h,c,m,I,y);break}default:throw new Error(`Unsupported type ${i.dtype}`)}return t.makeTensorInfo(u,w.dtype,w.values)}const b_={kernelName:Ww,backendName:"cpu",kernelFunc:g_};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function y_(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{numOrSizeSplits:i,axis:l}=r,u=oe(l,s.shape)[0],c=Ob(s,i,u),h=new Array(s.shape.length).fill(0),p=s.shape.slice();return c.map(m=>{const g=[...p];g[u]=m;const y=po({inputs:{x:s},backend:t,attrs:{begin:h,size:g}});return h[u]+=m,y})}const x_={kernelName:np,backendName:"cpu",kernelFunc:y_};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const v_={kernelName:o0,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,r=e;$e(t,"square");const s=r.data.get(t.dataId).values,i=new Float32Array(s.length);for(let l=0;l<s.length;++l){const u=s[l];i[l]=u*u}return{dataId:r.write(i,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const w_=ft(ac,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),k_={kernelName:ac,backendName:"cpu",kernelFunc:w_};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function I_(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{begin:i,end:l,strides:u,beginMask:c,endMask:h,ellipsisMask:p,newAxisMask:m,shrinkAxisMask:g}=r;$e(s,"stridedSlice");const{finalShapeSparse:y,finalShape:v,isIdentity:w,sliceDim0:S,isSimpleSlice:I,begin:C,end:R,strides:L}=wb(s.shape,i,l,u,c,h,p,m,g);let G;if(w)G=kt({inputs:{x:s},backend:t,attrs:{shape:v}});else if(S||I){T(s.shape.length>=1,()=>`Input must have rank at least 1, got: ${s.shape.length}`);const $=yb(C,R,L),F=po({inputs:{x:s},backend:t,attrs:{begin:C,size:$}});G=kt({inputs:{x:F},backend:t,attrs:{shape:v}}),t.disposeIntermediateTensorInfo(F)}else{const $=t.bufferSync(s),F=PT(y,$,L,C);G=t.makeTensorInfo(v,F.dtype,F.values)}return G}const S_={kernelName:u0,backendName:"cpu",kernelFunc:I_};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function C_(n){const{inputs:e,backend:t,attrs:r}=n,{separator:s,nGramWidths:i,leftPad:l,rightPad:u,padWidth:c,preserveShortSequences:h}=r,{data:p,dataSplits:m}=e,g=t.data.get(p.dataId).values,y=t.data.get(m.dataId).values,[v,w]=XT(g,y,s,i,l,u,c,h);return[t.makeTensorInfo([v.length],"string",v),t.makeTensorInfo(m.shape,"int32",w)]}const T_={kernelName:Mw,backendName:"cpu",kernelFunc:C_};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function N_(n){const{inputs:e,backend:t,attrs:r}=n,{skipEmpty:s}=r,{input:i,delimiter:l}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(l.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${l.shape}`);const u=t.data.get(i.dataId).values,c=t.data.get(l.dataId).values[0],[h,p,m]=OT(u,c,s),g=p.length;return[t.makeTensorInfo([g,2],"int32",h),t.makeTensorInfo([g],"string",p),t.makeTensorInfo([2],"int32",new Int32Array(m))]}const R_={kernelName:$w,backendName:"cpu",kernelFunc:N_};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function E_(n){const{inputs:e,backend:t,attrs:r}=n,{numBuckets:s}=r,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(s<=0)throw new Error("Number of buckets must be at least 1");const l=t.data.get(i.dataId).values,u=DT(l,s);return t.makeTensorInfo(i.shape,"int32",u)}const L_={kernelName:Fw,backendName:"cpu",kernelFunc:E_};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const G_=ft(nc,n=>Math.tan(n)),z_={kernelName:nc,backendName:"cpu",kernelFunc:G_};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const W_=ft(rc,n=>Math.tanh(n)),M_={kernelName:rc,backendName:"cpu",kernelFunc:W_};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function $_(n){const{inputs:e,backend:t}=n,{tensor:r,indices:s,updates:i}=e,{sliceRank:l,numUpdates:u,sliceSize:c,strides:h,outputSize:p}=eo(i,s,r.shape),m=!1,g=t.bufferSync(s),y=t.bufferSync(i),v=t.bufferSync(r),w=ho(g,y,r.shape,p,c,u,l,h,v,m);return t.makeTensorInfo(r.shape,w.dtype,w.values)}const F_={kernelName:Nw,backendName:"cpu",kernelFunc:$_};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function V_(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{reps:i}=r;$e(s,"tile");const l=KT(t.bufferSync(s),i);return t.makeTensorInfo(l.shape,l.dtype,l.values)}const P_={kernelName:sc,backendName:"cpu",kernelFunc:V_};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function X_(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{k:i,sorted:l}=r;$e(s,"topk");const u=t.data.get(s.dataId).values,[c,h]=BT(u,s.shape,s.dtype,i,l);return[t.makeTensorInfo(c.shape,c.dtype,c.values),t.makeTensorInfo(h.shape,h.dtype,h.values)]}const O_={kernelName:c0,backendName:"cpu",kernelFunc:X_};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function D_(n){const{inputs:e,attrs:t,backend:r}=n,{image:s,transforms:i}=e,{interpolation:l,fillMode:u,fillValue:c,outputShape:h}=t,[p,m,g,y]=s.shape,[v,w]=h??[m,g],S=[p,v,w,y],I=we(s.shape),C=I[0],R=I[1],L=I[2],G=we(S),$=G[0],F=G[1],V=G[2],D=ge(s.dtype,M(S));D.fill(c);const Z=r.data.get(s.dataId).values,ne=r.data.get(i.dataId).values;for(let re=0;re<p;++re){const se=i.shape[0]===1?ne:ne.subarray(re*8,re*8+8);for(let ue=0;ue<v;++ue)for(let le=0;le<w;++le)for(let he=0;he<y;++he){let me;const pe=se[6]*le+se[7]*ue+1;if(pe===0)continue;const ye=(se[0]*le+se[1]*ue+se[2])/pe,Ie=(se[3]*le+se[4]*ue+se[5])/pe,ve=cN(ye,g,u),Ce=cN(Ie,m,u);switch(l){case"nearest":me=H_(Z,m,g,C,R,L,re,Ce,ve,he,c);break;case"bilinear":me=U_(Z,m,g,C,R,L,re,Ce,ve,he,c);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${l}`)}const Te=re*$+ue*F+le*V+he;D[Te]=me}return r.makeTensorInfo(S,s.dtype,D)}return{dataId:r.write(D,S,s.dtype),shape:s.shape,dtype:s.dtype}}const A_={kernelName:d0,backendName:"cpu",kernelFunc:D_};function cN(n,e,t){switch(t){case"reflect":return K_(n,e);case"wrap":return Z_(n,e);case"nearest":return __(n,e);case"constant":default:return B_(n)}}function K_(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const r=2*e;t<r&&(t=r*Math.trunc(-t/r)+t),t=t<-e?t+r:-t-1}else if(t>e-1)if(e<=1)t=0;else{const r=2*e;t-=r*Math.trunc(t/r),t>=e&&(t=r-t-1)}return N(0,t,e-1)}function Z_(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const r=e-1;t+=e*(Math.trunc(-t/r)+1)}else if(t>e-1)if(e<=1)t=0;else{const r=e-1;t-=e*Math.trunc(t/r)}return N(0,t,e-1)}function B_(n,e){return n}function __(n,e){return N(0,n,e-1)}function Zc(n,e,t,r,s,i,l,u,c,h,p){const m=l*r+u*s+c*i+h;return 0<=u&&u<e&&0<=c&&c<t?n[m]:p}function H_(n,e,t,r,s,i,l,u,c,h,p){const m=Math.round(u),g=Math.round(c);return Zc(n,e,t,r,s,i,l,m,g,h,p)}function U_(n,e,t,r,s,i,l,u,c,h,p){const m=Math.floor(u),g=Math.floor(c),y=m+1,v=g+1,w=(v-c)*Zc(n,e,t,r,s,i,l,m,g,h,p)+(c-g)*Zc(n,e,t,r,s,i,l,m,v,h,p),S=(v-c)*Zc(n,e,t,r,s,i,l,y,g,h,p)+(c-g)*Zc(n,e,t,r,s,i,l,y,v,h,p);return(y-u)*w+(u-m)*S}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function j_(n){const{inputs:e,attrs:t,backend:r}=n,{axis:s}=t,{x:i}=e;$e(i,"unique");const l=r.data.get(i.dataId).values,{outputValues:u,outputShape:c,indices:h}=_T(l,s,i.shape,i.dtype);return[r.makeTensorInfo(c,i.dtype,u),r.makeTensorInfo([h.length],"int32",h)]}const Y_={kernelName:h0,backendName:"cpu",kernelFunc:j_};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Q_(n){const{inputs:e,backend:t,attrs:r}=n,{value:s}=e;let{axis:i}=r;i<0&&(i+=s.shape.length);const l=s.shape.length,u=s.shape[i],c=new Array(l-1);let h=0;for(let y=0;y<l;y++)y!==i&&(c[h++]=s.shape[y]);const p=new Array(l).fill(0),m=s.shape.slice();m[i]=1;const g=new Array(u);for(let y=0;y<g.length;y++){p[i]=y;const v=po({inputs:{x:s},backend:t,attrs:{begin:p,size:m}});g[y]=kt({inputs:{x:v},backend:t,attrs:{shape:c}}),t.disposeIntermediateTensorInfo(v)}return g}const J_={kernelName:sp,backendName:"cpu",kernelFunc:Q_};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function q_(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,segmentIds:i}=e,{numSegments:l}=r;$e(s,"unsortedSegmentSum");const u=s.shape.length,c=i.shape.length,h=[],p=[],m=u-c;let g=i;for(let v=0;v<m;++v){const w=sf({inputs:{input:g},backend:t,attrs:{dim:v+1}});g=w,p.push(w)}for(let v=0;v<l;++v){const w=Oa(v,"int32"),S=t.makeTensorInfo([],"int32",w),I=rT({inputs:{a:S,b:g},backend:t}),C=si({inputs:{x:I},backend:t,attrs:{dtype:"float32"}}),R=tf({inputs:{a:C,b:s},backend:t}),L=Kc({inputs:{x:R},backend:t,attrs:{axis:0,keepDims:!1}});h.push(L),p.push(S),p.push(I),p.push(C),p.push(R),p.push(L)}const y=oN({inputs:h,backend:t,attrs:{axis:0}});return p.forEach(v=>t.disposeIntermediateTensorInfo(v)),y}const eH={kernelName:ap,backendName:"cpu",kernelFunc:q_};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const tH=[QZ,GK,qZ,t4,VK,r4,a4,o4,u4,d4,p4,m4,b4,v4,k4,C4,N4,E4,G4,jZ,W4,$4,V4,XK,X4,$K,DK,D4,zK,A4,Z4,B4,H4,j4,Q4,q4,t5,r5,a5,o5,u5,d5,p5,m5,g5,y5,v5,k5,I5,S5,C5,N5,L5,AZ,z5,AK,O5,KK,D5,BK,H5,U5,Y5,HK,jK,J5,e9,n9,s9,QK,qK,WK,i9,K4,l9,c9,h9,KZ,tZ,rZ,f9,aZ,g9,x9,w9,S9,T9,R9,E9,oZ,G9,W9,$9,V9,X9,D9,K9,uZ,B9,U9,Q9,dZ,pZ,eB,rB,iB,mZ,lB,cB,dB,lN,mB,BZ,yZ,bB,xB,wB,IB,MK,$y,CB,_Z,HZ,UZ,NB,EB,GB,WB,$B,FB,PB,TZ,OB,BB,HB,QB,RZ,qB,t_,r_,EZ,j9,a_,o_,u_,d_,p_,m_,b_,x_,zZ,v_,MZ,FZ,k_,S_,T_,R_,L_,OZ,R5,z_,M_,F_,P_,O_,A_,gZ,Y_,J_,eH,uB];for(const n of tH)Cr(n);/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const fo={},of={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function nH(n,e){fo[n]=e}function ks(n,e){if(!(n in fo)||e!=null){const r=sH(n,e);if(r!==null)fo[n]=r;else return console.log("Could not get context for WebGL version",n),null}const t=fo[n];return t==null||t.isContextLost()?(delete fo[n],ks(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),fo[n])}function rH(n){if(!ae().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function sH(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??rH(n);return t.addEventListener("webglcontextlost",r=>{r.preventDefault(),delete fo[n]},!1),ae().getBool("SOFTWARE_WEBGL_ENABLED")&&(of.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",of)||t.getContext("experimental-webgl",of):t.getContext("webgl2",of)}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var Bc;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(Bc||(Bc={}));var zr;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(zr||(zr={}));var Sn;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Sn||(Sn={}));function _c(n,e){return[e,n]}function aH(n,e){return n*e}function lf(n){const e=M(n),t=Math.ceil(e/4);return O(t)}function ml(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function iH(n,e){const[t,r]=ml(n,e);return t*r*4}function Py(n,e){const t=n;let r,s,i,l,u,c,h,p,m,g;return ae().getNumber("WEBGL_VERSION")===2?(r=t.R32F,s=t.R16F,i=t.RGBA16F,l=t.RGBA32F,u=t.RED,h=4,p=1,m=t.HALF_FLOAT,g=t.FLOAT,c=t.RGBA8):(r=n.RGBA,s=n.RGBA,i=n.RGBA,l=t.RGBA,u=n.RGBA,h=4,p=4,m=e!=null?e.HALF_FLOAT_OES:null,g=n.FLOAT,c=n.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:s,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:l,textureFormatFloat:u,downloadTextureFormat:c,downloadUnpackNumChannels:h,defaultNumChannels:p,textureTypeHalfFloat:m,textureTypeFloat:g}}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function We(n,e){const t=e();return ae().getBool("DEBUG")&&oH(n),t}function oH(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+dH(n,e))}const lH=596e-10,uH=65504;function cH(n){return!!(ae().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||lH<Math.abs(n)&&Math.abs(n)<uH)}function dH(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function uf(n,e){return wa(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function hH(n,e){const t=wa(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(We(n,()=>n.shaderSource(t,e)),We(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function pH(n,e){const t=wa(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(We(n,()=>n.shaderSource(t,e)),We(n,()=>n.compileShader(t)),ae().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw dN(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const fH=/ERROR: [0-9]+:([0-9]+):/g;function dN(n,e){const t=fH.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const r=+t[1],s=n.split(`
`),i=s.length.toString().length+2,l=s.map((m,g)=>P((g+1).toString(),i)+m);let u=0;for(let m=0;m<l.length;m++)u=Math.max(l[m].length,u);const c=l.slice(0,r-1),h=l.slice(r-1,r),p=l.slice(r);console.log(c.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${P(h[0],u)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(p.join(`
`))}function mH(n){return wa(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function gH(n,e){if(We(n,()=>n.linkProgram(e)),!ae().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Xy(n,e){if(We(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function bH(n,e){const t=wa(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return We(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),We(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function yH(n,e){const t=wa(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return We(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),We(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function xH(n){return wa(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function vH(n,e){const t=ae().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const r=`[${n}x${e}]`;throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t){const r=`[${n}x${e}]`,s=`[${t}x${t}]`;throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+s+".")}}function wH(n){return wa(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function hN(n,e,t,r,s,i,l){const u=n.getAttribLocation(e,t);return u===-1?!1:(We(n,()=>n.bindBuffer(n.ARRAY_BUFFER,r)),We(n,()=>n.vertexAttribPointer(u,s,n.FLOAT,!1,i,l)),We(n,()=>n.enableVertexAttribArray(u)),!0)}function kH(n,e,t){NH(n,t),We(n,()=>n.activeTexture(n.TEXTURE0+t)),We(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function IH(n,e,t){return wa(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function SH(n,e,t){return n.getUniformLocation(e,t)}function CH(n,e,t,r){We(n,()=>kH(n,e,r)),We(n,()=>n.uniform1i(t,r))}function Oy(n,e,t){We(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),We(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function pN(n,e){We(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),We(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function cf(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+TH(n,e))}function TH(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function wa(n,e,t){const r=We(n,()=>e());if(r==null)throw new Error(t);return r}function NH(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t){const s=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${s}.`)}}function gl(n,e=2){return M(n.slice(0,n.length-e))}function bl(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function df(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[gl(n),...bl(n)]),e}function RH(n,e=!1){let t=ae().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=ae().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");r===1/0&&ae().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=t/2),e&&(t=t*2,r=r*2,n=n.map((u,c)=>c>=n.length-2?E(n[c]):n[c]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=fe(n).newShape);let s=M(n),i=null;n.length<=1&&s<=t?i=[1,s]:n.length===2&&n[0]<=t&&n[1]<=t?i=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?i=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?i=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?i=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(i=[n[0],n[1]*n[2]*n[3]]);const l=i!=null&&Math.max(...i)>r&&Math.min(...i)<=(e?2:1)&&Math.min(...i)>0;if(i==null||l)if(e){const u=gl(n);let c=2,h=2;n.length&&([c,h]=bl(n)),s=u*(c/2)*(h/2),i=O(s).map(p=>p*2)}else i=O(s);return i}function hf(n){return n%2===0}function pf(n,e){if(n=n.slice(-2),e=e.slice(-2),B(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n[n.length-1],r=e[e.length-1];if(t===r||hf(t)&&hf(r)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&hf(n[0])&&hf(e[0])}let Dy,Ay;function EH(n){if(Dy==null){const e=ks(n);Dy=e.getParameter(e.MAX_TEXTURE_SIZE)}return Dy}function LH(n){if(Ay==null){const e=ks(n);Ay=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Ay)}function GH(n){if(n===0)return 0;let e;const t=ks(n);return es(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:es(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function es(n,e){return n.getExtension(e)!=null}function fN(n){try{if(ks(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function zH(n){if(n===0)return!1;const e=ks(n);if(n===1){if(!es(e,"OES_texture_float"))return!1}else if(!es(e,"EXT_color_buffer_float"))return!1;return Ky(e)}function WH(n){if(n===0)return!1;const e=ks(n);if(n===1){if(!es(e,"OES_texture_float")||!es(e,"WEBGL_color_buffer_float"))return!1}else{if(es(e,"EXT_color_buffer_float"))return Ky(e);const t="EXT_color_buffer_half_float";if(es(e,t)){const r=e.getExtension(t);return MH(e,r)}return!1}return Ky(e)}function Ky(n){const e=Py(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const r=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const s=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(r),s}function MH(n,e){const t=Py(n,e),r=n.createTexture();n.bindTexture(n.TEXTURE_2D,r),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const s=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,s),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r,0);const i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(r),n.deleteFramebuffer(s),i}function $H(n){return n!==2?!1:ks(n).fenceSync!=null}function Hc(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&T(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Fe=ae();Fe.registerFlag("HAS_WEBGL",()=>Fe.getNumber("WEBGL_VERSION")>0),Fe.registerFlag("WEBGL_VERSION",()=>fN(2)?2:fN(1)?1:0),Fe.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1),Fe.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Fe.get("WEBGL_VERSION")===2),Fe.registerFlag("WEBGL_CPU_FORWARD",()=>!0),Fe.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1),Fe.registerFlag("WEBGL_PACK",()=>Fe.getBool("HAS_WEBGL")),Fe.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Fe.getBool("WEBGL_PACK")),Fe.registerFlag("WEBGL_PACK_CLIP",()=>Fe.getBool("WEBGL_PACK")),Fe.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Fe.getBool("WEBGL_PACK")),Fe.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Fe.getBool("WEBGL_PACK")),Fe.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Fe.getBool("WEBGL_PACK")),Fe.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Fe.getBool("WEBGL_PACK")),Fe.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Fe.getBool("WEBGL_PACK")),Fe.registerFlag("WEBGL_PACK_REDUCE",()=>Fe.getBool("WEBGL_PACK")),Fe.registerFlag("WEBGL_LAZILY_UNPACK",()=>Fe.getBool("WEBGL_PACK")),Fe.registerFlag("WEBGL_CONV_IM2COL",()=>Fe.getBool("WEBGL_PACK")),Fe.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Fe.getBool("WEBGL_PACK")),Fe.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>EH(Fe.getNumber("WEBGL_VERSION"))),Fe.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>LH(Fe.getNumber("WEBGL_VERSION"))),Fe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=Fe.getNumber("WEBGL_VERSION");return n===0?0:GH(n)}),Fe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Fe.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!dk()),Fe.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>zH(Fe.getNumber("WEBGL_VERSION"))),Fe.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Fe.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Fe.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")),Fe.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>WH(Fe.getNumber("WEBGL_VERSION"))),Fe.registerFlag("WEBGL_FENCE_API_ENABLED",()=>$H(Fe.getNumber("WEBGL_VERSION"))),Fe.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Fe.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0),Fe.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)}),Fe.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>dk()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)}),Fe.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128),Fe.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1),Fe.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5),Fe.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128),Fe.registerFlag("WEBGL_EXP_CONV",()=>!1),Fe.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Fe.getBool("IS_TEST")),Fe.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0),Fe.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1),Fe.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1),Fe.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Dn(){let n,e,t,r,s,i,l,u,c,h;return ae().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",r="in",s="texture",i="outputColor",l="out vec4 outputColor;",u=ae().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",c="",h=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",r="varying",s="texture2D",i="gl_FragColor",l="",u=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,c=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,h=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:s,output:i,defineOutput:l,defineSpecialNaN:u,defineSpecialInf:c,defineRound:h}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mo(n,e,t="index"){const r=we(e);return r.map((s,i)=>{const l=`int ${n[i]} = ${t} / ${s}`,u=i===r.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * ${s}`:`index -= ${n[i]} * ${s}`;return`${l}; ${u};`}).join("")}function ff(n,e,t="index"){const r=we(e);return r.map((s,i)=>{const l=`int ${n[i]} = ${t} / outShapeStrides[${i}]`,u=i===r.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * outShapeStrides[${i}]`:`index -= ${n[i]} * outShapeStrides[${i}]`;return`${l}; ${u};`}).join("")}function FH(n,e){const t=n.length,r=n.map(i=>`${e}[${i}]`),s=new Array(t-1);s[t-2]=r[t-1];for(let i=t-3;i>=0;--i)s[i]=`(${s[i+1]} * ${r[i+1]})`;return s}function VH(n,e,t="index"){const r=n.map((i,l)=>l),s=FH(r,e);return s.map((i,l)=>{const u=`int ${n[l]} = ${t} / ${s[l]}`,c=l===s.length-1?`int ${n[l+1]} = ${t} - ${n[l]} * ${s[l]}`:`index -= ${n[l]} * ${s[l]}`;return`${u}; ${c};`}).join("")}function Zy(n){const e=we(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function By(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const mN=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const{getBroadcastDims:gN}=zX;function PH(n,e,t){const r=[];if(n.forEach(g=>{const y=M(g.shapeInfo.logicalShape);if(g.shapeInfo.isUniform?r.push(`uniform float ${g.name}${y>1?`[${y}]`:""};`):(r.push(`uniform sampler2D ${g.name};`),r.push(`uniform int offset${g.name};`)),t.enableShapeUniforms){const{uniformShape:v}=_y(t.packedInputs,g.shapeInfo.logicalShape,g.shapeInfo.texShape);switch(v.length){case 1:r.push(`uniform int ${g.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${g.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${g.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${g.name}Shape;`);break}r.push(`uniform ivec2 ${g.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;");break}r.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(g=>{r.push(`uniform ${g.type} ${g.name}${g.arrayIndex?`[${g.arrayIndex}]`:""};`)});const s=r.join(`
`),i=n.map(g=>XH(g,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),l=e.texShape,u=Dn(),c=AH(u);let h,p,m=BH(u);return e.isPacked?(h=OH(e.logicalShape,l,t.enableShapeUniforms),p=ZH(u)):(h=DH(e.logicalShape,l,t.enableShapeUniforms),p=KH(u)),t.packedInputs&&(m+=jH),[m,c,p,s,h,i,t.userCode].join(`
`)}function yl(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return oU(n,e);case 1:return uU(n,e);case 2:return dU(n,e);case 3:return pU(n,e);case 4:return mU(n,e);case 5:return gU(n);case 6:return bU(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function bN(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return iU(n);case 1:return lU(n,e);case 2:return cU(n,e);case 3:return hU(n,e);default:return fU(n,e)}}function XH(n,e,t=!1,r){let s="";t?s+=bN(n,r):s+=yl(n,r);const i=n.shapeInfo.logicalShape,l=e.logicalShape;return i.length<=l.length&&(t?s+=yU(n,e):s+=xU(n,e)),s}function OH(n,e,t){switch(n.length){case 0:return yN();case 1:return YH(n,e,t);case 2:return sU(n,e,t);case 3:return JH(n,e,t);default:return eU(n,e,t)}}function DH(n,e,t){switch(n.length){case 0:return yN();case 1:return QH(n,e,t);case 2:return aU(n,e,t);case 3:return qH(n,e,t);case 4:return tU(n,e,t);case 5:return nU(n,e);case 6:return rU(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function AH(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function KH(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function ZH(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function BH(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${_H}
    ${HH}
    ${UH}
  `}const _H=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,HH=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,UH=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,jH=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function yN(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function YH(n,e,t){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return r[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${r[1]}.0);
      }
    `:r[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${r[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);
    }
  `}function QH(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function JH(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],s=Math.ceil(n[2]/2),i=s*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec3(b, r, c);
    }
  `}function qH(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${ff(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const r=mo(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${r}
      return ivec3(r, c, d);
    }
  `}function eU(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],s=Math.ceil(n[n.length-1]/2),i=s*Math.ceil(n[n.length-2]/2);let l=i,u="",c="b, r, c";for(let h=2;h<n.length-1;h++)l*=n[n.length-h-1],u=`
      int b${h} = index / ${l};
      index -= b${h} * ${l};
    `+u,c=`b${h}, `+c;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      ${u}

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec${n.length}(${c});
    }
  `}function tU(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${ff(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const r=mo(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${r}
      return ivec4(r, c, d, d2);
    }
  `}function nU(n,e){const t=mo(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function rU(n,e){const t=mo(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function sU(n,e,t){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(B(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));
      }
    `;const s=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));

      int index = resTexRC.x * ${r[1]} + resTexRC.y;
      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec2(r, c);
    }
  `}function aU(n,e,t){return B(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function go(n){return`offset${n}`}function iU(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=Dn();return`
    vec4 ${t}() {
      return ${r.texture2D}(${e}, halfCR);
    }
  `}function oU(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${r}() {return ${t};}`;const[s,i]=n.shapeInfo.texShape;if(s===1&&i===1)return`
      float ${r}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const l=go(t);if(e)return`
    float ${r}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${l});
      return sampleTexture(${t}, uv);
    }
  `;const[u,c]=n.shapeInfo.texShape;return`
    float ${r}() {
      vec2 uv = uvFromFlat(${u}, ${c}, ${l});
      return sampleTexture(${t}, uv);
    }
  `}function lU(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),s=n.shapeInfo.texShape,i=Dn();if(e)return`
    vec4 ${r}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${i.texture2D}(${t}, uv);
    }
  `;const l=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];return`
    vec4 ${r}(int index) {
      vec2 uv = packedUVfrom1D(
        ${l[0]}, ${l[1]}, index);
      return ${i.texture2D}(${t}, uv);
    }
  `}function uU(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${r}(int index) {
        ${xl(n)}
      }
    `;const s=n.shapeInfo.texShape,i=s[0],l=s[1];if(l===1&&i===1)return`
      float ${r}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const u=go(t);return l===1?e?`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${u}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${u}) + 0.5) / ${i}.0);
        return sampleTexture(${t}, uv);
      }
    `:i===1?e?`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${u}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${u}) + 0.5) / ${l}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${u});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${i}, ${l}, index + ${u});
      return sampleTexture(${t}, uv);
    }
  `}function cU(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape,l=i[0],u=i[1],c=Dn();if(i!=null&&B(t,i))return e?`
      vec4 ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);

        return ${c.texture2D}(${r}, uv);
      }
    `:`
      vec4 ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${u}.0, ${l}.0);

        return ${c.texture2D}(${r}, uv);
      }
    `;if(e)return`
    vec4 ${s}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${c.texture2D}(${r}, uv);
    }
  `;const h=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],p=Math.ceil(t[1]/2);return`
    vec4 ${s}(int row, int col) {
      vec2 uv = packedUVfrom2D(${p}, ${h[0]}, ${h[1]}, row, col);
      return ${c.texture2D}(${r}, uv);
    }
  `}function dU(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape;if(i!=null&&B(t,i)){if(e)return`
      float ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `;const g=i[0],y=i[1];return`
    float ${s}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${y}.0, ${g}.0);
      return sampleTexture(${r}, uv);
    }
  `}const{newShape:l,keptDims:u}=fe(t),c=l;if(c.length<t.length){const g=vl(n,c),y=["row","col"];return`
      ${yl(g,e)}
      float ${s}(int row, int col) {
        return ${s}(${wl(y,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${xl(n)}
      }
    `;const h=i[0],p=i[1],m=go(r);return p===1?e?`
      float ${s}(int row, int col) {
        float index = dot(vec3(row, col, ${m}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${s}(int row, int col) {
      float index = dot(vec3(row, col, ${m}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${h}.0);
      return sampleTexture(${r}, uv);
    }
  `:h===1?e?`
      float ${s}(int row, int col) {
        float index = dot(vec3(row, col, ${m}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${s}(int row, int col) {
      float index = dot(vec3(row, col, ${m}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${p}.0, 0.5);
      return sampleTexture(${r}, uv);
    }
  `:e?`
      float ${s}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${r}Shape[1] + col + ${m};
        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
        return sampleTexture(${r}, uv);
      }
    `:`
  float ${s}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${m};
    vec2 uv = uvFromFlat(${h}, ${p}, index);
    return sampleTexture(${r}, uv);
  }
`}function hU(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape,l=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(t[0]===1){const g=t.slice(1),y=[1,2],v=vl(n,g),w=["b","row","col"];return`
        ${bN(v,e)}
        vec4 ${s}(int b, int row, int col) {
          return ${s}(${wl(w,y)});
        }
      `}const u=Dn();if(e)return`
    vec4 ${s}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${u.texture2D}(${r}, uv);
    }
  `;const c=l[0],h=l[1],p=Math.ceil(t[2]/2),m=p*Math.ceil(t[1]/2);return`
    vec4 ${s}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${c}, ${h}, ${m}, ${p}, b, row, col);
      return ${u.texture2D}(${r}, uv);
    }
  `}function pU(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t[1]*t[2],l=t[2],{newShape:u,keptDims:c}=fe(t),h=u;if(h.length<t.length){const w=vl(n,h),S=["row","col","depth"];return`
        ${yl(w,e)}
        float ${s}(int row, int col, int depth) {
          return ${s}(${wl(S,c)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${i}, ${l}, 1)));
        ${xl(n)}
      }
    `;const p=n.shapeInfo.texShape,m=p[0],g=p[1],y=n.shapeInfo.flatOffset;if(g===i&&y==null)return e?`
      float ${s}(int row, int col, int depth) {
        int stride1 = ${r}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
        float ${s}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${l}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${g}.0, ${m}.0);
          return sampleTexture(${r}, uv);
        }
      `;if(g===l&&y==null)return e?`
      float ${s}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${s}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${g}.0, ${m}.0);
      return sampleTexture(${r}, uv);
    }
  `;const v=go(r);return e?`
    float ${s}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${r}Shape[1] * ${r}Shape[2];
      int stride1 = ${r}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${v};
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
      return sampleTexture(${r}, uv);
    }
    `:`
      float ${s}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i} + col * ${l} + depth + ${v};
        vec2 uv = uvFromFlat(${m}, ${g}, index);
        return sampleTexture(${r}, uv);
      }
  `}function fU(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),s=Dn();if(e)return`
    vec4 ${r}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${s.texture2D}(${t}, uv);
    }
  `;const i=n.shapeInfo.logicalShape,l=i.length,u=n.shapeInfo.texShape,c=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],h=c[0],p=c[1],m=Math.ceil(i[l-1]/2);let g=m*Math.ceil(i[l-2]/2),y="int b, int row, int col",v=`b * ${g} + (row / 2) * ${m} + (col / 2)`;for(let w=2;w<l-1;w++)y=`int b${w}, `+y,g*=i[l-w-1],v=`b${w} * ${g} + `+v;return`
    vec4 ${r}(${y}) {
      int index = ${v};
      int texR = index / ${p};
      int texC = index - texR * ${p};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${p}, ${h});
      return ${s.texture2D}(${t}, uv);
    }
  `}function mU(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t[3],l=t[2]*i,u=t[1]*l,{newShape:c,keptDims:h}=fe(t);if(c.length<t.length){const C=vl(n,c),R=["row","col","depth","depth2"];return`
      ${yl(C,e)}
      float ${s}(int row, int col, int depth, int depth2) {
        return ${s}(${wl(R,h)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${u}, ${l}, ${i}, 1)));
        ${xl(n)}
      }
    `;const p=n.shapeInfo.flatOffset,m=n.shapeInfo.texShape,g=m[0],y=m[1],v=`int stride2 = ${r}Shape[3];`,w=`int stride1 = ${r}Shape[2] * stride2;`,S=`int stride0 = ${r}Shape[1] * stride1;`;if(y===u&&p==null)return e?`
      float ${s}(int row, int col, int depth, int depth2) {
        ${v}
        ${w}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${l}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${y}.0, ${g}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(y===i&&p==null)return e?`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${y}.0, ${g}.0);
        return sampleTexture(${r}, uv);
      }
    `;const I=go(r);return e?`
    float ${s}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${v}
      ${w}
      ${S}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${I});
      return sampleTexture(${r}, uv);
    }
  `:`
    float ${s}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${u} + col * ${l} +
          depth * ${i} + depth2;
      vec2 uv = uvFromFlat(${g}, ${y}, index + ${I});
      return sampleTexture(${r}, uv);
    }
  `}function gU(n){const e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),s=e[4],i=e[3]*s,l=e[2]*i,u=e[1]*l,{newShape:c,keptDims:h}=fe(e);if(c.length<e.length){const w=vl(n,c),S=["row","col","depth","depth2","depth3"];return`
      ${yl(w)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${wl(S,h)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${u}, ${l}, ${i}, ${s})) +
          depth3;
        ${xl(n)}
      }
    `;const p=n.shapeInfo.flatOffset,m=n.shapeInfo.texShape,g=m[0],y=m[1];if(y===u&&p==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${l}, ${i}, ${s}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${y}.0, ${g}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(y===s&&p==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${y}.0, ${g}.0);
        return sampleTexture(${t}, uv);
      }
    `;const v=go(t);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${u} + col * ${l} + depth * ${i} +
          depth2 * ${s} + depth3 + ${v};
      vec2 uv = uvFromFlat(${g}, ${y}, index);
      return sampleTexture(${t}, uv);
    }
  `}function bU(n){const e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:s,keptDims:i}=fe(e);if(s.length<e.length){const S=vl(n,s),I=["row","col","depth","depth2","depth3","depth4"];return`
      ${yl(S)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${wl(I,i)});
      }
    `}const l=e[5],u=e[4]*l,c=e[3]*u,h=e[2]*c,p=e[1]*h;if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${p}, ${h}, ${c}, ${u})) +
          dot(
            vec2(depth3, depth4),
            vec2(${l}, 1)));
        ${xl(n)}
      }
    `;const m=n.shapeInfo.flatOffset,g=n.shapeInfo.texShape,y=g[0],v=g[1];if(v===p&&m==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${h}, ${c}, ${u}, ${l})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${v}.0, ${y}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(v===l&&m==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${v}.0, ${y}.0);
        return sampleTexture(${t}, uv);
      }
    `;const w=go(t);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${p} + col * ${h} + depth * ${c} +
          depth2 * ${u} + depth3 * ${l} + depth4 + ${w};
      vec2 uv = uvFromFlat(${y}, ${v}, index);
      return sampleTexture(${t}, uv);
    }
  `}function xl(n){const e=n.name,t=M(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function yU(n,e){const t=n.name,r=t.charAt(0).toUpperCase()+t.slice(1),s="get"+r+"AtOutCoords",i=n.shapeInfo.logicalShape.length,l=e.logicalShape.length,u=gN(n.shapeInfo.logicalShape,e.logicalShape),c=gt(l),h=l-i;let p;const m=["x","y","z","w","u","v"];i===0?p="":l<2&&u.length>=1?p="coords = 0;":p=u.map(S=>`coords.${m[S+h]} = 0;`).join(`
`);let g="";l<2&&i>0?g="coords":g=n.shapeInfo.logicalShape.map((S,I)=>`coords.${m[I+h]}`).join(", ");let y="return outputValue;";const v=M(n.shapeInfo.logicalShape)===1,w=M(e.logicalShape)===1;if(i===1&&!v&&!w)y=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(v&&!w)l===1?y=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:y=`
        return vec4(outputValue.x);
      `;else if(u.length){const S=i-2,I=i-1;u.indexOf(S)>-1&&u.indexOf(I)>-1?y="return vec4(outputValue.x);":u.indexOf(S)>-1?y="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(I)>-1&&(y="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${s}() {
      ${c} coords = getOutputCoords();
      ${p}
      vec4 outputValue = get${r}(${g});
      ${y}
    }
  `}function xU(n,e){const t=n.name,r=t.charAt(0).toUpperCase()+t.slice(1),s="get"+r+"AtOutCoords",i=e.texShape,l=n.shapeInfo.texShape,u=n.shapeInfo.logicalShape.length,c=e.logicalShape.length;if(!n.shapeInfo.isUniform&&u===c&&n.shapeInfo.flatOffset==null&&B(l,i))return`
      float ${s}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const h=gt(c),p=gN(n.shapeInfo.logicalShape,e.logicalShape),m=c-u;let g;const y=["x","y","z","w","u","v"];u===0?g="":c<2&&p.length>=1?g="coords = 0;":g=p.map(w=>`coords.${y[w+m]} = 0;`).join(`
`);let v="";return c<2&&u>0?v="coords":v=n.shapeInfo.logicalShape.map((w,S)=>`coords.${y[S+m]}`).join(", "),`
    float ${s}() {
      ${h} coords = getOutputCoords();
      ${g}
      return get${r}(${v});
    }
  `}function gt(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function _y(n,e,t){const{newShape:r,keptDims:s}=fe(e),i=e.length,l=n&&i===3&&e[0]===1,u=l?e.slice(1):r,c=!n&&i>1&&!B(e,t)&&r.length<i||l;return{useSqueezeShape:c,uniformShape:c?u:e,keptDims:s}}function vl(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function wl(n,e){return e.map(t=>n[t]).join(", ")}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vU(n,e,t,r){const s=t.map((p,m)=>{const g={logicalShape:p.shape,texShape:p.isUniform?null:p.texData.texShape,isUniform:p.isUniform,isPacked:p.isUniform?!1:p.texData.isPacked,flatOffset:null};return p.texData!=null&&p.texData.slice!=null&&p.texData.slice.flatOffset>0&&(g.flatOffset=p.texData.slice.flatOffset),{name:e.variableNames[m],shapeInfo:g}}),i=s.map(p=>p.shapeInfo),l={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=PH(s,l,e),c=pH(n.gl,u),h=n.createProgram(c);return ae().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:c,source:u,webGLProgram:h,inShapeInfos:i,outShapeInfo:l,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(h),Object.assign({program:e,fragmentShader:c,source:u,webGLProgram:h,inShapeInfos:i,outShapeInfo:l},xN(n,e,h)))}function xN(n,e,t){const r=[],s=[];let i,l,u,c=null,h=null;h=n.getUniformLocation(t,"NAN",!1),ae().getNumber("WEBGL_VERSION")===1&&(c=n.getUniformLocation(t,"INFINITY",!1));const p=!1;for(const m of e.variableNames){const g={name:m,uniform:n.getUniformLocation(t,m,p),offset:n.getUniformLocation(t,`offset${m}`,p)};e.enableShapeUniforms&&(g.shape=n.getUniformLocation(t,`${m}Shape`,p),g.texShape=n.getUniformLocation(t,`${m}TexShape`,p)),r.push(g)}if(e.enableShapeUniforms&&(i=n.getUniformLocation(t,"outShape",p),u=n.getUniformLocation(t,"outShapeStrides",p),l=n.getUniformLocation(t,"outTexShape",p)),e.customUniforms)for(const m of e.customUniforms)s.push(n.getUniformLocation(t,m.name,p));return{variablesLocations:r,customUniformLocations:s,infLoc:c,nanLoc:h,outShapeLocation:i,outShapeStridesLocation:u,outTexShapeLocation:l}}function vN(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,r)=>{const s=t.logicalShape,i=e[r],l=i.shape;if(!B(s,l))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${s} and ${l} must match`);if(t.isUniform&&i.isUniform)return;const u=t.texShape,c=i.isUniform?null:i.texData.texShape;if(!B(u,c))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${u} and ${c} must match`)})}function wU(n,e,t,r,s){e.program.enableShapeUniforms||(vN(e.inShapeInfos,t),vN([e.outShapeInfo],[r]));const i=r.texData.texture,l=r.texData.texShape;r.texData.isPacked?n.setOutputPackedMatrixTexture(i.texture,l[0],l[1]):n.setOutputMatrixTexture(i.texture,l[0],l[1]),n.setProgram(e.webGLProgram),n.bindVertexArray(e.webGLProgram.vao),ae().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN);for(let c=0;c<t.length;++c){const h=t[c],{uniform:p,offset:m,shape:g,texShape:y}=e.variablesLocations[c];if(g){const{uniformShape:v}=_y(e.program.packedInputs,h.shape,h.texData.texShape);switch(v.length){case 1:n.gl.uniform1iv(g,new Int32Array(v));break;case 2:n.gl.uniform2iv(g,new Int32Array(v));break;case 3:n.gl.uniform3iv(g,new Int32Array(v));break;case 4:n.gl.uniform4iv(g,new Int32Array(v));break}}if(y&&n.gl.uniform2i(y,h.texData.texShape[0],h.texData.texShape[1]),p!=null){if(h.isUniform){if(M(h.shape)<2)n.gl.uniform1f(p,h.uniformValues[0]);else{let v=h.uniformValues;v instanceof Float32Array||(v=new Float32Array(v)),n.gl.uniform1fv(p,v)}continue}h.texData.slice!=null&&m!=null&&n.gl.uniform1i(m,h.texData.slice.flatOffset),n.setInputMatrixTexture(h.texData.texture.texture,p,c)}}const u=e.outShapeLocation;if(u)switch(r.shape.length){case 1:n.gl.uniform1iv(u,new Int32Array(r.shape));break;case 2:n.gl.uniform2iv(u,new Int32Array(r.shape));break;case 3:n.gl.uniform3iv(u,new Int32Array(r.shape));break;case 4:n.gl.uniform4iv(u,new Int32Array(r.shape));break}if(e.outShapeStridesLocation){const c=we(r.shape);switch(r.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(c));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(c));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(c));break}}if(e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),e.program.customUniforms&&s)for(let c=0;c<e.program.customUniforms.length;++c){const h=e.program.customUniforms[c],p=e.customUniformLocations[c],m=s[c];if(h.type==="float")n.gl.uniform1fv(p,m);else if(h.type==="vec2")n.gl.uniform2fv(p,m);else if(h.type==="vec3")n.gl.uniform3fv(p,m);else if(h.type==="vec4")n.gl.uniform4fv(p,m);else if(h.type==="int")n.gl.uniform1iv(p,m);else if(h.type==="ivec2")n.gl.uniform2iv(p,m);else if(h.type==="ivec3")n.gl.uniform3iv(p,m);else if(h.type==="ivec4")n.gl.uniform4iv(p,m);else throw Error(`uniform type ${h.type} is not supported yet.`)}n.executeProgram()}function kU(n,e,t){let r="";e.concat(t).forEach(l=>{const u=l.texData!=null&&l.texData.slice!=null&&l.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!l.isUniform){const c=l.texData.texShape,{useSqueezeShape:h,uniformShape:p,keptDims:m}=_y(n.packedInputs,l.shape,c);let g="",y="",v="";if(p.length===1&&n.packedInputs){const G=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];g=`${G[0]>1}_${G[1]>1}`}else if(p.length===2&&!n.packedInputs)y=`${p[0]>1}_${p[1]>1}`;else if(p.length>2&&!n.packedInputs){const G=we(p);v=`${G[0]===c[1]}_${G[G.length-1]===c[1]}`}const w=l.shape.length,S=p.length===2&&B(l.shape,c),I=M(l.shape)===1,C=el(l.shape,t.shape),R=!n.packedInputs&&w===t.shape.length&&B(c,t.texData.texShape),L=n.packedInputs||p.length>2?"":`${c[0]>1}_${c[1]>1}`;r+=`${w}_${R}_${h?m:""}_${p.length}_${I}_${C}_${S}_${g}_${y}_${v}_${L}_${u}`}else{const c=l.isUniform?"uniform":l.texData.texShape;r+=`${l.shape}_${c}_${u}`}});const s=n.userCode;let i=n.constructor.name;return i+="_"+r+"_"+s+`${ae().getNumber("WEBGL_VERSION")}`,i}function En(n){return ae().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class IU{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Bc.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Dn();this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?ff(["r","c","d"],e):mo(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class SU{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Bc.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Dn();this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?ff(["r","c","d"],e):mo(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class CU{constructor(e){this.variableNames=["A"],this.outTexUsage=zr.DOWNLOAD;const t=Dn();this.outputShape=e,this.userCode=`
      ${mN}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class TU{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=zr.DOWNLOAD;const t=Dn();this.outputShape=e,this.userCode=`
      ${mN}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const NU={R:0,G:1,B:2,A:3};class wN{constructor(e,t=!1,r="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=Dn();this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length);let i="result";t&&(i="floor(result * 255. + 0.5)");let l="";for(let u=0;u<r.length;u++){const c=r[u];l+=`
          if(offset == ${u}) {
            result = values[${NU[c]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?By():Zy(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${r.length});

        flatIndex = idiv(flatIndex, ${r.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${s.texture2D}(A, uv);
          ${l}
        }
        ${s.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class RU{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=Dn();this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length);let s="",i="result";t&&(i="floor(result * 255. + 0.5)");for(let l=0;l<=1;l++)for(let u=0;u<=1;u++){const c=l*2+u;s+=`
          localCoords = coords;
          if(localCoords[2] + ${u} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${u};
          if (localCoords[1] + ${l} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${l};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${r.texture2D}(A, uv);

            if (offset == 0) {
              result[${c}] = values[0];
            } else if (offset == 1) {
              result[${c}] = values[1];
            } else if (offset == 2) {
              result[${c}] = values[2];
            } else {
              result[${c}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?By():Zy(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${s}

          ${r.output} = ${i};
        }
    `}}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function EU(n){const e=Dn(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return hH(n,t)}function LU(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return bH(n,e)}function GU(n){const e=new Uint16Array([0,1,2,2,1,3]);return yH(n,e)}function Uc(n,e,t,r,s,i){vH(e,t);const l=xH(n),u=n.TEXTURE_2D;return We(n,()=>n.bindTexture(u,l)),We(n,()=>n.texParameteri(u,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),We(n,()=>n.texParameteri(u,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),We(n,()=>n.texParameteri(u,n.TEXTURE_MIN_FILTER,n.NEAREST)),We(n,()=>n.texParameteri(u,n.TEXTURE_MAG_FILTER,n.NEAREST)),ae().getNumber("WEBGL_VERSION")===1?We(n,()=>n.texImage2D(u,0,r,e,t,0,s,i,null)):We(n,()=>n.texStorage2D(u,1,r,e,t)),We(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:l,texShape:[t,e]}}function kN(n){return n.internalFormatFloat}function zU(n,e,t,r){const[s,i]=_c(e,t);return Uc(n,s,i,kN(r),r.textureFormatFloat,n.FLOAT)}function IN(n){return n.internalFormatHalfFloat}function WU(n,e,t,r){const[s,i]=_c(e,t);return Uc(n,s,i,IN(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function SN(n){return n.downloadTextureFormat}function MU(n,e,t,r){const[s,i]=_c(e,t);return Uc(n,s,i,SN(r),n.RGBA,n.UNSIGNED_BYTE)}function CN(n){return n.internalFormatPackedFloat}function $U(n,e,t,r){const[s,i]=ml(e,t);return Uc(n,s,i,CN(r),n.RGBA,n.FLOAT)}function TN(n){return n.internalFormatPackedHalfFloat}function FU(n,e,t,r){const[s,i]=ml(e,t);return Uc(n,s,i,TN(r),n.RGBA,r.textureTypeHalfFloat)}function VU(n,e,t){return We(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),hN(n,e,"clipSpacePos",t,3,20,0)&&hN(n,e,"uv",t,2,20,12)}function PU(n,e,t,r,s,i){We(n,()=>n.bindTexture(n.TEXTURE_2D,e));let l,u,c;s instanceof Uint8Array?(l=new Uint8Array(t*r*4),u=n.UNSIGNED_BYTE,c=n.RGBA):(l=new Float32Array(t*r*4),u=n.FLOAT,c=i.internalFormatPackedFloat),l.set(s),ae().getNumber("WEBGL_VERSION")===2?We(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,r,n.RGBA,u,l)):We(n,()=>n.texImage2D(n.TEXTURE_2D,0,c,t,r,0,n.RGBA,u,l)),We(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function XU(n,e,t){We(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?ae().getNumber("WEBGL_VERSION")===2?We(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):We(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):ae().getNumber("WEBGL_VERSION")===2?We(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):We(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),We(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function OU(n,e,t,r){const s=n.createBuffer();We(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,s));const i=4*4*e*t;return We(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,i,n.STREAM_READ)),We(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),We(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),s}function DU(n,e,t){const r=n,s=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,s),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),s}function AU(n,e,t,r){const[s,i]=_c(e,t),l=4,u=new Uint8Array(aH(e*t,l));return We(n,()=>n.readPixels(0,0,s,i,r.downloadTextureFormat,n.UNSIGNED_BYTE,u)),new Float32Array(u.buffer)}function KU(n,e,t,r,s,i,l,u){const c=n,h=new Float32Array(iH(i,l));return c.bindBuffer(c.PIXEL_PACK_BUFFER,e),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,h),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),h}function ZU(n,e,t){const r=new Float32Array(e*t*4);return We(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,r)),r}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Hy{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=ae().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,nH(t,e)):this.gl=ks(t),e=this.gl,ae().getNumber("WEBGL_VERSION")===2){const i=e;this.createVertexArray=()=>We(i,()=>i.createVertexArray()),this.bindVertexArray=l=>We(i,()=>i.bindVertexArray(l)),this.deleteVertexArray=l=>We(i,()=>i.deleteVertexArray(l)),this.getVertexArray=()=>We(i,()=>i.getParameter(i.VERTEX_ARRAY_BINDING))}else if(e!=null){const i=e.getExtension("OES_vertex_array_object");if(i==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>We(e,()=>i.createVertexArrayOES()),this.bindVertexArray=l=>We(e,()=>i.bindVertexArrayOES(l)),this.deleteVertexArray=l=>We(e,()=>i.deleteVertexArrayOES(l)),this.getVertexArray=()=>We(e,()=>e.getParameter(i.VERTEX_ARRAY_BINDING_OES))}let r="WEBGL_color_buffer_float";const s="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),ae().getNumber("WEBGL_VERSION")===1){const i="OES_texture_float",l="OES_texture_half_float";if(this.textureFloatExtension=uf(this.gl,i),es(this.gl,l))this.textureHalfFloatExtension=uf(this.gl,l);else if(ae().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),es(this.gl,s))this.colorBufferHalfFloatExtension=uf(this.gl,s);else if(ae().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",es(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else if(es(this.gl,s))this.colorBufferHalfFloatExtension=this.gl.getExtension(s);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=LU(this.gl),this.indexBuffer=GU(this.gl),this.framebuffer=wH(this.gl),this.textureConfig=Py(this.gl,this.textureHalfFloatExtension)}get debug(){return ae().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;We(e,()=>e.finish()),We(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),We(e,()=>e.deleteFramebuffer(this.framebuffer)),We(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),We(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),We(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),zU(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),WU(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),MU(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),XU(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,r,s){this.throwIfDisposed(),PU(this.gl,e,t,r,s,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),FU(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),$U(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(pN(this.gl,this.framebuffer),this.outputTexture=null),We(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,r){return this.downloadMatrixDriver(e,()=>AU(this.gl,t,r,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,r,s,i,l){return KU(this.gl,e,t,r,s,i,l,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return DU(this.gl,e,t)}createBufferFromTexture(e,t,r){this.bindTextureToFrameBuffer(e);const s=OU(this.gl,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),s}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,r;if(ae().getBool("WEBGL_FENCE_API_ENABLED")){const s=e,i=s.fenceSync(s.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=()=>{const l=s.clientWaitSync(i,0,0);return l===s.ALREADY_SIGNALED||l===s.CONDITION_SATISFIED},t=i}else ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=()=>this.isQueryAvailable(t,ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):r=()=>!0;return{query:t,isFencePassed:r}}downloadMatrixFromPackedTexture(e,t,r){return this.downloadMatrixDriver(e,()=>ZU(this.gl,t,r))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=EU(t));const r=mH(t);We(t,()=>t.attachShader(r,this.vertexShader)),We(t,()=>t.attachShader(r,e)),gH(t,r);const s=Object.assign(r,{vao:this.createVertexArray()});return this.debug&&Xy(t,s),s}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;We(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),VU(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(We(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&Xy(this.gl,this.program),We(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,r=!0){return this.throwIfDisposed(),r?IH(this.gl,e,t):SH(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),We(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),CH(this.gl,e,t,r)}setOutputMatrixTexture(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)}setOutputPackedMatrixTexture(e,t,r){this.throwIfDisposed();const[s,i]=ml(t,r);this.setOutputMatrixTextureDriver(e,s,i)}setOutputMatrixWriteRegion(e,t,r,s){this.setOutputMatrixWriteRegionDriver(r,e,s,t)}setOutputPackedMatrixWriteRegion(e,t,r,s){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&Xy(this.gl,this.program),cf(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}We(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),We(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=uf(this.gl,ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const r=this.gl,s=this.getQueryTimerExtensionWebGL2(),i=r.createQuery();return r.beginQuery(s.TIME_ELAPSED_EXT,i),i}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await X(()=>this.disposed||this.isQueryAvailable(e,ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}else{const r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const r=this.gl,s=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{const r=this.getQueryTimerExtensionWebGL1(),s=r.getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),s&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=BU(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:r}=this.itemsToPoll[t];r()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let r;"setTimeoutCustom"in ae().platform&&(r=ae().platform.setTimeoutCustom.bind(ae().platform)),X(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,r)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),Oy(this.gl,e,this.framebuffer),this.debug&&cf(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(Oy(this.gl,this.outputTexture,this.framebuffer),this.debug&&cf(this.gl)):pN(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const r=t();return this.unbindTextureToFrameBuffer(),r}setOutputMatrixTextureDriver(e,t,r){this.throwIfDisposed();const s=this.gl;Oy(s,e,this.framebuffer),this.debug&&cf(s),this.outputTexture=e,We(s,()=>s.viewport(0,0,t,r)),We(s,()=>s.scissor(0,0,t,r))}setOutputMatrixWriteRegionDriver(e,t,r,s){this.throwIfDisposed(),We(this.gl,()=>this.gl.scissor(e,t,r,s))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function BU(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const{addImpl:_U,bincountImpl:NN,bincountReduceImpl:HU,bitwiseAndImpl:UU,castImpl:jU,ceilImpl:YU,concatImpl:QU,equalImpl:JU,expImpl:qU,expm1Impl:ej,floorImpl:tj,gatherNdImpl:nj,gatherV2Impl:rj,greaterImpl:sj,greaterEqualImpl:aj,lessImpl:ij,lessEqualImpl:oj,linSpaceImpl:lj,logImpl:uj,maxImpl:cj,maximumImpl:dj,minimumImpl:hj,multiplyImpl:pj,negImpl:fj,notEqualImpl:mj,prodImpl:gj,raggedGatherImpl:bj,raggedRangeImpl:yj,raggedTensorToTensorImpl:xj,rangeImpl:vj,rsqrtImpl:wj,scatterImpl:kj,sigmoidImpl:Ij,simpleAbsImpl:RN,sliceImpl:Sj,sparseFillEmptyRowsImpl:Cj,sparseReshapeImpl:Tj,sparseSegmentReductionImpl:EN,sqrtImpl:Nj,staticRegexReplaceImpl:Rj,stridedSliceImpl:Ej,stringNGramsImpl:Lj,stringSplitImpl:Gj,stringToHashBucketFastImpl:zj,subImpl:Wj,tileImpl:Mj,topKImpl:$j,transposeImpl:Uy,uniqueImpl:Fj}=DZ;/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function LN(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function An(n,e){return e===1?[n]:LN(n,e)}function Vj(n,e){if(n===1)return"rc";let t="";for(let r=0;r<n;r++)t+=e[r],r<n-1&&(t+=",");return t}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Pj{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=En(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=An("rc",this.rank),r=gt(this.rank),s=this.getOutOfBoundsCondition(t),i=this.getSetup(t),l=this.getOutput(t);this.userCode=`
        void main() {
          ${r} rc = getOutputCoords();

          if(${s}) {
            setOutput(vec4(0));
          } else {
            ${i}

            setOutput(vec4(${l}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let r=0;r<=1;r++)for(let s=0;s<=1;s++){let i=`${r===0?"r":"rp1"}, ${s===0?"c":"cp1"}`;for(let l=2;l<this.rank;l++)i=`${e[e.length-1-l]},`+i;t.push(i)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let r=this.rank-2;r<this.rank;r++)t+=`${e[r]} >= ${this.enableShapeUniforms?`outShape[${r}]`:this.outputShape[r]}`,r<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),r=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],s=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${r};
      bool rEdge = rp1 >= ${s};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class GN{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length);let r="";for(let s=0;s<4;s++){let i="thisRC = rc;";s%2===1&&(i+="thisRC.z += 1;"),s>1&&(i+="thisRC.y += 1;"),r+=`
        ${i}
        ${s>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${s}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${s>0?"}":""}
      `}this.userCode=`
      ${Xj(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?By():Zy(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${r}

        setOutput(result);
      }
    `}}function Xj(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?VH(["r","c","d"],"inputShape"):mo(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Oj{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,r){const s=WN(t,r),i=MN(e,s,r);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const l=zN(e,s,this.gpgpu.gl,this.gpgpu.textureConfig,r);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=l,this.log();const c=this.freeTextures[i].pop();return this.usedTextures[i].push(c),c}let u;return s===Sn.PACKED_2X2_FLOAT32?u=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):s===Sn.PACKED_2X2_FLOAT16?u=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):s===Sn.UNPACKED_FLOAT32?u=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):s===Sn.UNPACKED_FLOAT16?u=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):s===Sn.PACKED_4X1_UNSIGNED_BYTE&&(u=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(u),this.numUsedTextures++,this._numBytesAllocated+=l,this.log(),u}releaseTexture(e,t,r,s){if(this.freeTextures==null)return;const i=WN(r,s),l=MN(t,i,s);l in this.freeTextures||(this.freeTextures[l]=[]);const u=zN(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,s),c=ae().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");c!==-1&&this._numBytesAllocated>c?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=u):(this.freeTextures[l].push(e),this.numFreeTextures++,this._numBytesFree+=u),this.numUsedTextures--;const h=this.usedTextures[l],p=h&&h.indexOf(e);if(p==null||p<0)throw new Error("Cannot release a texture that was never provided by this texture manager");h[p]=h[h.length-1],h.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function Dj(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F||e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function zN(n,e,t,r,s){const i=Aj(e,r);let l;if(s){const[c,h]=ml(n[0],n[1]);l=c*h}else{const[c,h]=_c(n[0],n[1]);l=c*h}const u=Dj(t,i);return l*u}function Aj(n,e){switch(n){case Sn.PACKED_2X2_FLOAT32:return CN(e);case Sn.PACKED_2X2_FLOAT16:return TN(e);case Sn.UNPACKED_FLOAT32:return kN(e);case Sn.UNPACKED_FLOAT16:return IN(e);case Sn.PACKED_4X1_UNSIGNED_BYTE:return SN(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function Kj(n){return ae().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?Sn.PACKED_2X2_FLOAT32:Sn.UNPACKED_FLOAT32:n?Sn.PACKED_2X2_FLOAT16:Sn.UNPACKED_FLOAT16}function WN(n,e){if(n===zr.UPLOAD)return Sn.PACKED_2X2_FLOAT32;if(n===zr.RENDER||n==null)return Kj(e);if(n===zr.DOWNLOAD||n===zr.PIXELS)return Sn.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function MN(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Ys{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const ts="if (isnan(x)) return x;",Zj="return x;",$N="return abs(x);",Bj="return (x >= 0.0) ? x : (exp(x) - 1.0);",_j=ts+`
  return (x < 0.0) ? 0.0 : x;
`,Hj=ts+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,ii="return x;",Uj="return 1.0 / (1.0 + exp(-1.0 * x));";/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const jj="return x;",Yj=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Qj=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Jj=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,qj="return 1.0 / (1.0 + exp(-1.0 * x));";class oi{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class eY{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length);const t=e.length,r=An("rc",t),s=gt(t),i=Vj(t,r),l=r.slice(-2),u=t<=1?"rc":`vec2(${l.join(",")})`;this.userCode=`
      void main() {
        ${s} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${u}));
      }
    `}}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const tY=c2,nY=1e-7,rY=1e-4,jy={};function sY(n){return n in jy||(jy[n]={}),jy[n]}const aY=ae().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),iY=600;function oY(){return ae().global.screen==null?1024:ae().global.screen.height*ae().global.screen.width*window.devicePixelRatio*iY/1024/1024}class mf extends b{nextDataId(){return mf.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!ae().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof Hy)t=e;else{const r=ks(ae().getNumber("WEBGL_VERSION"),e);t=new Hy(r)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const r=ks(ae().getNumber("WEBGL_VERSION"));t=new Hy(r),this.binaryCache=sY(ae().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new Oj(this.gpgpu),this.numMBBeforeWarning=oY(),this.texData=new f(this,vt())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,r,s,i,l){const u=this.makeTensorInfo(t,r),c=this.texData.get(u.dataId);c.isPacked=!1,c.texture={texture:e,texShape:[s,i]},c.texShape=[s,i];const h=df(t),p=new wN(h,!1,l),m=this.runWebGLProgram(p,[u],r,[[s,i]]);return m.shape=t,c.texture=null,this.disposeIntermediateTensorInfo(u),m.dataId}write(e,t,r){if((ae().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||ae().getBool("DEBUG"))&&this.checkNumericalProblems(e),r==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const s={id:this.nextDataId()};return this.texData.set(s,{shape:t,dtype:r,values:e,usage:zr.UPLOAD,refCount:1}),s}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,r,s,i){if(ae().getBool("DEBUG")&&this.checkNumericalProblems(t),s==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:r,dtype:s,values:t,usage:zr.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:r,dtype:s,complexTensorInfos:i,slice:l,shape:u,isPacked:c}=t;if(l!=null){let g;c?g=new oi(u,ii):g=new Ys(u,ii);const y=this.runWebGLProgram(g,[{dataId:e,shape:u,dtype:s}],s),v=this.readSync(y.dataId);return this.disposeIntermediateTensorInfo(y),v}if(r!=null)return this.convertAndCacheOnCPU(e);if(s==="string")return r;const h=this.activeTimers!=null;let p;h&&(p=Yn());let m;if(s==="complex64"){const g=this.readSync(i.real.dataId),y=this.readSync(i.imag.dataId);m=ga(g,y)}else m=this.getValuesFromTexture(e);return h&&(this.downloadWaitMs+=Yn()-p),this.convertAndCacheOnCPU(e,m)}async read(e){if(this.pendingRead.has(e)){const v=this.pendingRead.get(e);return new Promise(w=>v.push(w))}const t=this.texData.get(e),{values:r,shape:s,slice:i,dtype:l,complexTensorInfos:u,isPacked:c}=t;if(i!=null){let v;c?v=new oi(s,ii):v=new Ys(s,ii);const w=this.runWebGLProgram(v,[{dataId:e,shape:s,dtype:l}],l),S=this.read(w.dataId);return this.disposeIntermediateTensorInfo(w),S}if(r!=null)return this.convertAndCacheOnCPU(e);if(ae().getBool("DEBUG")&&!ae().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&ae().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let h=null,p;if(l!=="complex64"&&ae().get("WEBGL_BUFFER_SUPPORTED")){p=this.decode(e);const v=this.texData.get(p.dataId);h=this.gpgpu.createBufferFromTexture(v.texture.texture,...lf(s))}this.pendingRead.set(e,[]),l!=="complex64"&&await this.gpgpu.createAndWaitForFence();let m;if(l==="complex64"){const v=await Promise.all([this.read(u.real.dataId),this.read(u.imag.dataId)]),w=v[0],S=v[1];m=ga(w,S)}else if(h==null)m=this.getValuesFromTexture(e);else{const v=M(s);m=this.gpgpu.downloadFloat32MatrixFromBuffer(h,v)}if(p!=null&&this.disposeIntermediateTensorInfo(p),h!=null){const v=this.gpgpu.gl;We(v,()=>v.deleteBuffer(h))}const g=this.convertAndCacheOnCPU(e,m),y=this.pendingRead.get(e);return this.pendingRead.delete(e),y.forEach(v=>v(g)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&vt().removeDataId(e,this),this.pendingDeletes--),g}readToGPU(e,t={}){const r=this.texData.get(e),{values:s,shape:i,slice:l,dtype:u,isPacked:c,texture:h}=r;if(u==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(l!=null){let y;c?y=new oi(i,ii):y=new Ys(i,ii);const v=this.runWebGLProgram(y,[{dataId:e,shape:i,dtype:u}],u),w=this.readToGPU(v,t);return this.disposeIntermediateTensorInfo(v),w}if(h==null)throw s!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const p=this.decode(e,t.customTexShape),m=vt().makeTensorFromTensorInfo(p),g=this.texData.get(p.dataId);return Object.assign({tensorRef:m},g.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const r=t.map(s=>Aa(s));return Je(e.shape,e.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Je(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const r=e[t];if(!cH(r))throw ae().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${r} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${r} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:r,isPacked:s}=this.texData.get(e),i=M(t);if(ae().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const g=this.decode(e),y=this.texData.get(g.dataId),v=this.gpgpu.downloadMatrixFromPackedTexture(y.texture.texture,...lf(t)).subarray(0,i);return this.disposeIntermediateTensorInfo(g),v}const l=ae().getBool("WEBGL_PACK")&&s===!0,u=l?df(t):t,c=l?new TU(u):new CU(u),h=this.runWebGLProgram(c,[{shape:u,dtype:r,dataId:e}],"float32"),p=this.texData.get(h.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(p.texture.texture,p.texShape[0],p.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(h),m}timerAvailable(){return ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,r=[];let s=!1;this.programTimersStack==null?(this.programTimersStack=r,s=!0):this.activeTimers.push(r),this.activeTimers=r,e();const i=Ai(this.activeTimers.map(c=>c.query)).filter(c=>c!=null),l=Ai(this.activeTimers.map(c=>c.name)).filter(c=>c!=null);this.activeTimers=t,s&&(this.programTimersStack=null);const u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const c=await Promise.all(i);u.kernelMs=W(c),u.getExtraProfileInfo=()=>c.map((h,p)=>({name:l[p],ms:h})).map(h=>`${h.name}: ${h.ms}`).join(", ")}else u.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,u})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Yn(),endMs:null}}endTimer(e){return ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Yn(),e)}async getQueryTime(e){if(ae().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:r}=this.texData.get(e);return r!=null&&(this.disposeData(r.real.dataId,t),this.disposeData(r.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:r,texShape:s,usage:i,isPacked:l,slice:u}=this.texData.get(e),c=u&&u.origDataId||e,h=this.dataRefCount.get(c);h>1?this.dataRefCount.set(c,h-1):(this.dataRefCount.delete(c),t!=null&&(this.numBytesInGPU-=this.computeBytes(s,r),this.textureManager.releaseTexture(t,s,i,l)));const p=this.texData.get(e);p.texture=null,p.texShape=null,p.isPacked=!1,p.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=aY){return ae().getBool("WEBGL_CPU_FORWARD")&&e.every(r=>this.texData.get(r.dataId).texture==null&&M(r.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){Sr("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return tY(e.shape,t)}packedUnaryOp(e,t,r){const s=new oi(e.shape,t),i=this.compileAndRun(s,[e],r);return vt().makeTensorFromTensorInfo(i)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const s=RN(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,s)}if(ae().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,$N,e.dtype);const t=new Ys(e.shape,$N),r=this.compileAndRun(t,[e]);return vt().makeTensorFromTensorInfo(r)}makeTensorInfo(e,t,r){let s;if(t==="string"&&r!=null&&r.length>0&&Vt(r[0])){const i=r.map(l=>Da(l));s=this.write(i,e,t)}else s=this.write(r,e,t);return this.texData.get(s).usage=null,{dataId:s,shape:e,dtype:t}}makeOutput(e,t,r){return vt().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,r),this)}unpackTensor(e){const t=new eY(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new Pj(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const r=[gl(e.shape),...bl(e.shape)],s={dtype:e.dtype,shape:r,dataId:e.dataId},i=[gl(t),...bl(t)],l=new GN(i,r),u=!0,c=[r],h=this.runWebGLProgram(l,[s],e.dtype,c,u);return{dataId:h.dataId,shape:t,dtype:h.dtype}}decode(e,t){const r=this.texData.get(e),{isPacked:s,shape:i,dtype:l}=r;if(t!=null){const g=M(i),y=t[0]*t[1]*4;T(g<=y,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const u=df(i);let c;s?c=new SU(u):c=new IU(u);const h=!0,p=[t??lf(u)],m=this.runWebGLProgram(c,[{shape:u,dtype:l,dataId:e}],l,p,h,t);return{dtype:l,shape:i,dataId:m.dataId}}runWebGLProgram(e,t,r,s,i=!1,l){const u=this.makeTensorInfo(e.outputShape,r),c=this.texData.get(u.dataId);if(e.packedOutput&&(c.isPacked=!0),e.outPackingScheme===Bc.DENSE){const I=l??lf(e.outputShape);c.texShape=I.map(C=>C*2)}if(e.outTexUsage!=null&&(c.usage=e.outTexUsage),M(u.shape)===0)return c.values=ge(u.dtype,0),u;const h=[],p=t.map(I=>{if(I.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let C=this.texData.get(I.dataId);if(C.texture==null){if(!e.packedInputs&&M(I.shape)<=ae().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:I.shape,texData:null,isUniform:!0,uniformValues:C.values};e.packedInputs&&(C.isPacked=!0,C.shape=I.shape)}if(this.uploadToGPU(I.dataId),!!C.isPacked!=!!e.packedInputs)I=C.isPacked?this.unpackTensor(I):this.packTensor(I),h.push(I),C=this.texData.get(I.dataId);else if(C.isPacked&&!pf(C.shape,I.shape)){const R=I,L=I.shape;I.shape=C.shape,I=this.packedReshape(I,L),h.push(I),C=this.texData.get(I.dataId),R.shape=L}return{shape:I.shape,texData:C,isUniform:!1}});this.uploadToGPU(u.dataId);const m={shape:u.shape,texData:c,isUniform:!1},g=kU(e,p,m),y=this.getAndSaveBinary(g,()=>vU(this.gpgpu,e,p,m)),v=this.activeTimers!=null;let w;v&&(w=this.startTimer()),ae().get("ENGINE_COMPILE_ONLY")||wU(this.gpgpu,y,p,m,s),h.forEach(I=>this.disposeIntermediateTensorInfo(I)),v&&(w=this.endTimer(w),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(w)}));const S=ae().getNumber("WEBGL_FLUSH_THRESHOLD");if(S>0){const I=Yn();I-this.lastGlFlushTime>S&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=I)}if(!ae().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&i===!1){const I=this.unpackTensor(u);return this.disposeIntermediateTensorInfo(u),I}return u}compileAndRun(e,t,r,s,i=!1){return r=r||t[0].dtype,this.runWebGLProgram(e,t,r,s,i)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(ae().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ee(()=>{if(!ae().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=ae().getBool("DEBUG");ae().set("DEBUG",!1);const t=this.abs(ht(1e-8)).dataSync()[0];if(ae().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?nY:rY}uploadToGPU(e){const t=this.texData.get(e),{shape:r,dtype:s,values:i,texture:l,usage:u,isPacked:c}=t;if(l!=null)return;const h=this.activeTimers!=null;let p;h&&(p=Yn());let m=t.texShape;if(m==null&&(m=RH(r,c),t.texShape=m),i!=null){const g=df(r);let y,v=m[1],w=m[0];const S=i instanceof Uint8Array||i instanceof Uint8ClampedArray;(c||!S)&&([v,w]=ml(m[0],m[1])),c?y=new RU(g,S):y=new wN(g,S);const I=S?[w,v]:m,C=this.makeTensorInfo(I,s),R=this.texData.get(C.dataId);S?R.usage=zr.PIXELS:R.usage=zr.UPLOAD,R.texShape=I,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(C.dataId),v,w,i);const L=[[w,v]],G=this.runWebGLProgram(y,[C],s,L,!0),$=this.texData.get(G.dataId);t.texShape=$.texShape,t.isPacked=$.isPacked,t.usage=$.usage,ae().get("ENGINE_COMPILE_ONLY")?this.disposeData(G.dataId):(t.texture=$.texture,t.values=null,this.texData.delete(G.dataId)),this.disposeIntermediateTensorInfo(C),h&&(this.uploadWaitMs+=Yn()-p)}else{const g=this.acquireTexture(m,u,s,c);t.texture=g}}convertAndCacheOnCPU(e,t){const r=this.texData.get(e),{dtype:s}=r;return t!=null&&(r.values=lY(t,s)),r.values}acquireTexture(e,t,r,s){if(this.numBytesInGPU+=this.computeBytes(e,r),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${i} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,s)}computeBytes(e,t){return e[0]*e[1]*Ht(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const r=new Promise(s=>{try{this.checkCompletion_(t),s(!0)}catch(i){throw i}});e.push(r)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await Tp(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(dN(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:r,infLoc:s,nanLoc:i,outShapeLocation:l,outShapeStridesLocation:u,outTexShapeLocation:c}=xN(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=r,e.infLoc=s,e.nanLoc=i,e.outShapeLocation=l,e.outShapeStridesLocation=u,e.outTexShapeLocation=c}}createTensorFromGPUData(e,t,r){e.channels=e.channels||"RGBA";const{texture:s,height:i,width:l,channels:u}=e,c=vt().backend;if(!c.gpgpu.gl.isTexture(s))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const h=c.writeTexture(s,t,r,i,l,u);return vt().makeTensorFromDataId(h,t,r,c)}}mf.nextDataId=0;function lY(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let r=0;r<t.length;++r)t[r]=Math.round(n[r]);return t}else throw new Error(`Unknown dtype ${e}`)}/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/hk()&&gk("webgl",()=>new mf,2);/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Yy=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class bo{constructor(e,t,r){this.variableNames=["A","B"],this.outputShape=Ye(t,r),this.enableShapeUniforms=En(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const yo=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class kl{constructor(e,t,r,s=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ye(t,r);const i=this.outputShape.length;this.enableShapeUniforms=En(i);let l="";if(s)if(i===0||M(this.outputShape)===1)l=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(l=`
          ${gt(i)} coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?l+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:l+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const u=An("coords",i);this.enableShapeUniforms?l+=`
            bool nextRowOutOfBounds =
              (${u[i-2]} + 1) >= outShape[${i} - 2];
            bool nextColOutOfBounds =
              (${u[i-1]} + 1) >= outShape[${i} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:l+=`
            bool nextRowOutOfBounds =
              (${u[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${u[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${l}

        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mr(n){const{inputs:e,backend:t}=n,{x:r}=e;return t.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const uY={kernelName:Gu,backendName:"webgl",kernelFunc:mr};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function li(n){const{inputs:e,backend:t}=n,{real:r,imag:s}=e,i=t.makeTensorInfo(r.shape,"complex64"),l=t.texData.get(i.dataId),u=mr({inputs:{x:r},backend:t}),c=mr({inputs:{x:s},backend:t});return l.complexTensorInfos={real:u,imag:c},i}const cY={kernelName:zg,backendName:"webgl",kernelFunc:li};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const FN="return (a < 0.) ? b * a : a;",VN=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function dY(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{alpha:i}=r,l=t.makeTensorInfo([],"float32",Oa(i,"float32")),u=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new kl(VN,s.shape,l.shape):new bo(FN,s.shape,l.shape),c=t.runWebGLProgram(u,[s,l],"float32");return t.disposeIntermediateTensorInfo(l),c}const hY={kernelName:Nh,backendName:"webgl",kernelFunc:dY};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const PN="return (a < 0.) ? b * a : a;",XN=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function pY(n){const{inputs:e,backend:t}=n,{x:r,alpha:s}=e,i=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new kl(XN,r.shape,s.shape):new bo(PN,r.shape,s.shape);return t.runWebGLProgram(i,[r,s],"float32")}const fY={kernelName:_h,backendName:"webgl",kernelFunc:pY};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Il="if (isnan(x)) return x;";function it({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:r}){return({inputs:s,backend:i})=>{const{x:l}=s,u=i,c=r||l.dtype;if(u.shouldExecuteOnCPU([l])&&t!=null){const m=u.texData.get(l.dataId),g=t(m.values,c);return u.makeTensorInfo(l.shape,c,g)}const h=ae().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let p;return h?p=new oi(l.shape,e):p=new Ys(l.shape,n),u.runWebGLProgram(p,[l],c)}}function Cn({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:r=!1,cpuKernelImpl:s,dtype:i}){return({inputs:l,backend:u})=>{const{a:c,b:h}=l,p=u;if(r&&c.dtype==="complex64"){const v=p.texData.get(c.dataId),w=p.texData.get(h.dataId),[S,I]=[[v.complexTensorInfos.real,w.complexTensorInfos.real],[v.complexTensorInfos.imag,w.complexTensorInfos.imag]].map(R=>{const[L,G]=R,$={dataId:L.dataId,dtype:L.dtype,shape:c.shape},F={dataId:G.dataId,dtype:G.dtype,shape:h.shape},V=new bo(n,c.shape,h.shape);return p.runWebGLProgram(V,[$,F],dr(L.dtype,G.dtype))}),C=li({inputs:{real:S,imag:I},backend:p});return p.disposeIntermediateTensorInfo(S),p.disposeIntermediateTensorInfo(I),C}const m=i||dr(c.dtype,h.dtype);if((c.dtype==="string"||h.dtype==="string"||p.shouldExecuteOnCPU([c,h]))&&s!=null){const v=p.texData.get(c.dataId).values,w=p.texData.get(h.dataId).values,S=c.dtype==="string"?ba(v):v,I=c.dtype==="string"?ba(w):w,[C,R]=s(c.shape,h.shape,S,I,m),L=p.makeTensorInfo(R,m),G=p.texData.get(L.dataId);return G.values=C,L}const g=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let y;return g?y=new kl(e,c.shape,h.shape,t):y=new bo(n,c.shape,h.shape),p.runWebGLProgram(y,[c,h],m)}}function jc(n,e=!1){if(n==="linear")return e?jj:Zj;if(n==="relu")return e?Qj:_j;if(n==="elu")return e?Yj:Bj;if(n==="relu6")return e?Jj:Hj;if(n==="prelu")return e?XN:PN;if(n==="leakyrelu")return e?VN:FN;if(n==="sigmoid")return e?qj:Uj;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class ON{constructor(e,t,r,s=!1,i=!1,l=!1,u=null,c=!1,h=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=En(this.outputShape.length);const p=s?e[1]:e[2],m=Math.ceil(p/2),g=s?"i * 2, rc.y":"rc.y, i * 2",y=i?"rc.z, i * 2":"i * 2, rc.z",v=s?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],w=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let S="",I="";u&&(c?S=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${u}
        }`:h?S=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${u}
        }`:S=`vec4 activation(vec4 x) {
          ${u}
        }`,I="result = activation(result);");const C=l?"result += getBiasAtOutCoords();":"";l&&this.variableNames.push("bias"),c&&this.variableNames.push("preluActivationWeights"),h&&this.variableNames.push("leakyreluAlpha");let R="rc.x",L="rc.x";e[0]<t[0]?R=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(L=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${S}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${m}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${R};
        int batchB = ${L};
        for (int i = 0; i < ${m}; i++) {
          vec4 a = getMatrixA(batchA, ${g});
          vec4 b = getMatrixB(batchB, ${y});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${v[0]} * ${w[0]});
          result += (${v[1]} * ${w[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${C}

        ${I}

        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const DN={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class AN{constructor(e,t,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ye(t,r),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const KN="return a * b;";function Qy(n){const{inputs:e,backend:t}=n,{a:r,b:s}=e,i=dr(r.dtype,s.dtype);if(r.dtype==="complex64"){const u=t.texData.get(r.dataId),c=t.texData.get(s.dataId),h=new AN(DN.REAL,r.shape,s.shape),p=new AN(DN.IMAG,r.shape,s.shape),m=[{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:r.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:c.complexTensorInfos.real.dataId,dtype:c.complexTensorInfos.real.dtype,shape:s.shape},{dataId:c.complexTensorInfos.imag.dataId,dtype:c.complexTensorInfos.imag.dtype,shape:s.shape}],g=t.runWebGLProgram(h,m,"float32"),y=t.runWebGLProgram(p,m,"float32"),v=li({inputs:{real:g,imag:y},backend:t});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),v}if(t.shouldExecuteOnCPU([r,s])){const u=t.texData.get(r.dataId),c=t.texData.get(s.dataId),[h,p]=pj(r.shape,s.shape,u.values,c.values,i),m=t.makeTensorInfo(p,i),g=t.texData.get(m.dataId);return g.values=h,m}let l;return ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?l=new kl(KN,r.shape,s.shape):l=new bo(KN,r.shape,s.shape),t.runWebGLProgram(l,[r,s],i)}const mY={kernelName:Ou,backendName:"webgl",kernelFunc:Qy};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function gY(n,e,t){const r=[gl(n.shape),...bl(n.shape)],s={dtype:n.dtype,shape:r,dataId:n.dataId},i=[gl(e),...bl(e)],l=new GN(i,r),u=!0,c=[r],h=t.runWebGLProgram(l,[s],n.dtype,c,u);return{dataId:h.dataId,shape:e,dtype:h.dtype}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ne(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{shape:i}=r,l=t,u=M(s.shape),c=ie(i,u),h=M(c);T(u===h,()=>`The new shape (${c}) has ${h} elements and the old shape (${s.shape}) has ${u} elements. The new shape and old shape must have the same number of elements.`);const p=l.texData.get(s.dataId);return p.isPacked&&!pf(s.shape,c)&&!(p.texture!==null&&pf(p.shape,c))?gY(s,c,l):(l.incRef(s.dataId),{dataId:s.dataId,shape:c,dtype:s.dtype})}const bY={kernelName:Uh,backendName:"webgl",kernelFunc:Ne};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class ZN{constructor(e,t){this.variableNames=["x"];const{windowSize:r,batchSize:s,inSize:i,outSize:l}=e;this.outputShape=[s,l];const u=Math.floor(r/4)*4,c=r%4;let h="sumValue += dot(values, ones);";if(t!=null){const m=1/t;h=`sumValue += dot(values * ${H(m)?m.toPrecision(2):m}, ones);`}let p="";i%r>0&&(p=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        float sumValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${h}
        }

        int inIdx = inOffset + ${u};
        if (${c===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${h}
        } else if (${c===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${h}
        } else if (${c===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${h}
        }
        setOutput(sumValue);
      }
    `}}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class yY{constructor(e,t){this.variableNames=["x"];const{windowSize:r,batchSize:s,inSize:i,outSize:l}=e;this.outputShape=[s,l];let u="0.0",c="";t==="prod"?u="1.0":t==="min"?(u="1.0 / 1e-20",c="min"):t==="max"&&(u="-1.0 / 1e-20",c="max");let h=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?h="sumValue":t==="prod"?h="prodValue":t==="all"?h="allValue":t==="any"&&(h="anyValue");const p=Math.floor(r/4)*4,m=r%4;let g=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${c}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${c}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,y="vec4";t==="all"?(u="1.0",g=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,y="bvec4"):t==="any"&&(u="0.0",g=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,y="bvec4");let v="";i%r>0&&(v=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${u};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${v}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        vec4 minMaxValue = vec4(${u});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${p}; i += 4) {
          int inIdx = inOffset + i;
          ${y} values = ${y}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${g}
        }

        int inIdx = inOffset + ${p};
        if (${m===1}) {
          ${y} values = ${y}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${g}
        } else if (${m===2}) {
          ${y} values = ${y}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${g}
        } else if (${m===3}) {
          ${y} values = ${y}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${g}
        }
        setOutput(${h});
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xY(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],r=Np(t);e.push({inSize:t,windowSize:r,outSize:Math.ceil(t/r)})}return e}function xo(n,e,t,r){const s=xY(n.shape);let i=n;for(let l=0;l<s.length;l++){const{inSize:u,windowSize:c,outSize:h}=s[l];let p,m;t==="mean"?p=l===0?new ZN({windowSize:c,inSize:u,batchSize:n.shape[0],outSize:h},u):new ZN({windowSize:c,inSize:u,batchSize:n.shape[0],outSize:h}):p=new yY({windowSize:c,inSize:u,batchSize:n.shape[0],outSize:h},t),m=i,i=r.runWebGLProgram(p,[i],e),m.dataId!==n.dataId&&r.disposeIntermediateTensorInfo(m)}return i}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class vY{constructor(e,t){this.variableNames=["A"];const r=new Array(e.length);for(let l=0;l<r.length;l++)r[l]=e[t[l]];this.outputShape=r,this.rank=r.length;const s=gt(this.rank),i=wY(t);this.userCode=`
    void main() {
      ${s} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}}function wY(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e);for(let s=0;s<n.length;s++)r[n[s]]=t[s];return r.join()}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class kY{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const r=new Array(e.length);for(let p=0;p<r.length;p++)r[p]=e[t[p]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const s=gt(this.rank),i=LN("rc",this.rank),l=new Array(this.rank);for(let p=0;p<t.length;p++)l[t[p]]=i[p];const u=`vec2(${l.slice(-2).join()})`,c=`++${i[this.rank-1]} < ${r[this.rank-1]}`,h=`getChannel(getA(${l.join()}), ${u})`;this.userCode=`
    void main() {
      ${s} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${h};
      if(${c}) {
        result[1] = ${h};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${r[this.rank-2]}) {
        result[2] = ${h};
        if(${c}) {
          result[3] = ${h};
        }
      }
      setOutput(result);
    }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function gf(n,e,t){const r=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new kY(n.shape,e):new vY(n.shape,e);return t.runWebGLProgram(r,[n],n.dtype)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function IY(n,e,t,r){const s=e,i=n.shape.length,l=oe(s,n.shape);let u=l;const c=Xt(u,i),h=c!=null;let p=n;h&&(p=gf(n,c,r),u=Yt(u.length,i)),In("sum",u,i);const[m,g]=mn(p.shape,u);let y=m;t&&(y=nn(m,l));const v=M(g),w=M(n.shape)/v,S=Ne({inputs:{x:p},attrs:{shape:[w,v]},backend:r}),I=C0(n.dtype),C=xo(S,I,"sum",r),R=Ne({inputs:{x:C},attrs:{shape:y},backend:r});return r.disposeIntermediateTensorInfo(S),r.disposeIntermediateTensorInfo(C),h&&r.disposeIntermediateTensorInfo(p),R}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function bf(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:l}=r;return IY(s,i,l,t)}const SY={kernelName:ep,backendName:"webgl",kernelFunc:bf};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Kn(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{perm:i}=r,l=t,u=s.shape.length,c=new Array(u);for(let p=0;p<c.length;p++)c[p]=s.shape[i[p]];let h;if(l.shouldExecuteOnCPU([s])){const p=l.texData.get(s.dataId).values,m=Uy(p,s.shape,s.dtype,i,c);h=l.makeTensorInfo(c,s.dtype);const g=l.texData.get(h.dataId);g.values=m}else h=gf(s,i,l);return h}const CY={kernelName:Zo,backendName:"webgl",kernelFunc:Kn};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const BN=1e3;function yf({a:n,b:e,transposeA:t,transposeB:r,backend:s,bias:i=null,preluActivationWeights:l=null,leakyreluAlpha:u=0,activation:c=null}){const h=n.shape.length,p=e.shape.length,m=t?n.shape[h-2]:n.shape[h-1],g=r?e.shape[p-1]:e.shape[p-2],y=t?n.shape[h-1]:n.shape[h-2],v=r?e.shape[p-2]:e.shape[p-1],w=n.shape.slice(0,-2),S=e.shape.slice(0,-2),I=M(w),C=M(S),R=Ye(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([y,v]);T(m===g,()=>`Error in matMul: inner shapes (${m}) and (${g}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${r} must match.`);const L=t?[I,m,y]:[I,y,m],G=r?[C,v,g]:[C,g,v],$=Ne({inputs:{x:n},backend:s,attrs:{shape:L}}),F=Ne({inputs:{x:e},backend:s,attrs:{shape:G}}),V=[$,F],D=Math.max(I,C),Z=t?$.shape[1]:$.shape[2],ne=i!=null,re=l!=null,se=c==="leakyrelu",ue=c!=null?jc(c,!0):null,le=ne||re||se||ue!=null;let he;if((y===1||v===1)&&Z>BN&&le===!1){let pe=$,ye=F;t&&(pe=Kn({inputs:{x:$},backend:s,attrs:{perm:[0,2,1]}}),V.push(pe)),r&&(ye=Kn({inputs:{x:F},backend:s,attrs:{perm:[0,2,1]}}),V.push(ye));const Ie=v!==1,ve=v===1;let Ce=pe;Ie&&(Ce=Ne({inputs:{x:pe},backend:s,attrs:{shape:[D,Z,1]}}),V.push(Ce));const Te=v===1?2:1;let Re=ye;ve&&(Re=Ne({inputs:{x:ye},backend:s,attrs:{shape:[D,1,Z]}}),V.push(Re));const Le=Qy({inputs:{a:Ce,b:Re},backend:s});he=bf({inputs:{x:Le},backend:s,attrs:{axis:Te,keepDims:!0}}),V.push(Le)}else{const pe=dr(n.dtype,e.dtype),ye=new ON(L,G,[D,y,v],t,r,ne,ue,re,se),Ie=[$,F];if(i!=null&&Ie.push(i),re&&Ie.push(l),se){const ve=s.makeTensorInfo([],"float32",Oa(u,"float32"));Ie.push(ve),V.push(ve)}he=s.runWebGLProgram(ye,Ie,pe)}const me=Ne({inputs:{x:he},backend:s,attrs:{shape:R}});V.push(he);for(const pe of V)s.disposeIntermediateTensorInfo(pe);return me}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function TY(n){const{inputs:e,backend:t,attrs:r}=n,{a:s,b:i,bias:l,preluActivationWeights:u}=e,{transposeA:c,transposeB:h,activation:p,leakyreluAlpha:m}=r;return yf({a:s,b:i,transposeA:c,transposeB:h,backend:t,bias:l,preluActivationWeights:u,leakyreluAlpha:m,activation:p})}const NY={kernelName:op,backendName:"webgl",kernelFunc:TY};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const _N="return abs(x);";function RY(n){const{inputs:e,backend:t}=n,{x:r}=e;if(t.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){const i=t.texData.get(r.dataId),l=RN(i.values);return t.makeTensorInfo(r.shape,r.dtype,l)}let s;return ae().getBool("WEBGL_PACK_UNARY_OPERATIONS")?s=new oi(r.shape,_N):s=new Ys(r.shape,_N),t.runWebGLProgram(s,[r],r.dtype)}const EY={kernelName:oh,backendName:"webgl",kernelFunc:RY};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const LY=ts+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,GY=it({opSnippet:LY}),zY={kernelName:du,backendName:"webgl",kernelFunc:GY};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const WY=ts+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,MY=it({opSnippet:WY}),$Y={kernelName:hu,backendName:"webgl",kernelFunc:MY};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const HN="return a + b;",FY=Cn({opSnippet:HN,packedOpSnippet:HN,supportsComplex:!0,cpuKernelImpl:_U}),VY={kernelName:Ko,backendName:"webgl",kernelFunc:FY};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class PY{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((i,l)=>`T${l}`);const r=[];this.variableNames.forEach(i=>{r.push(`float v${i} = get${i}AtOutCoords();`)});const s=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        float result = ${s};
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class XY{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((i,l)=>`T${l}`);const r=[];this.variableNames.forEach(i=>{r.push(`vec4 v${i} = get${i}AtOutCoords();`)});const s=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        vec4 result = ${s};
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xf(n){const{inputs:e,backend:t}=n,r=e;if(r.length===1)return mr({inputs:{x:r[0]},backend:t});if(r.length>ae().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const u=Math.floor(r.length/2),c=xf({inputs:r.slice(0,u),backend:t}),h=xf({inputs:r.slice(u),backend:t});return xf({inputs:[c,h],backend:t})}const s=r.map(u=>u.dtype).reduce((u,c)=>dr(u,c)),i=r.map(u=>u.shape),l=ae().getBool("WEBGL_PACK")?new XY(r[0].shape,i):new PY(r[0].shape,i);return t.runWebGLProgram(l,r,s)}const OY={kernelName:Cg,backendName:"webgl",kernelFunc:xf};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function DY(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:l}=r,u=s.shape.length,c=oe(i,s.shape);let h=c;const p=Xt(h,u);let m=s;p!=null&&(m=Kn({inputs:{x:s},backend:t,attrs:{perm:p}}),h=Yt(h.length,u)),In("all",h,u);const[g,y]=mn(m.shape,h),v=M(y),w=Ne({inputs:{x:m},backend:t,attrs:{shape:[-1,v]}}),S=xo(w,w.dtype,"all",t);let I;if(l){const C=nn(g,c);I=Ne({inputs:{x:S},backend:t,attrs:{shape:C}})}else I=Ne({inputs:{x:S},backend:t,attrs:{shape:g}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(S),p!=null&&t.disposeIntermediateTensorInfo(m),I}const AY={kernelName:Tg,backendName:"webgl",kernelFunc:DY};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function KY(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:l}=r,u=s.shape.length,c=oe(i,s.shape);let h=c;const p=Xt(h,u);let m=s;p!=null&&(m=Kn({inputs:{x:s},backend:t,attrs:{perm:p}}),h=Yt(h.length,u)),In("any",h,u);const[g,y]=mn(m.shape,h),v=M(y),w=Ne({inputs:{x:m},backend:t,attrs:{shape:[-1,v]}}),S=xo(w,w.dtype,"any",t);let I;if(l){const C=nn(g,c);I=Ne({inputs:{x:S},backend:t,attrs:{shape:C}})}else I=Ne({inputs:{x:S},backend:t,attrs:{shape:g}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(S),p!=null&&t.disposeIntermediateTensorInfo(m),I}const ZY={kernelName:Ng,backendName:"webgl",kernelFunc:KY};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class BY{constructor(e,t,r){this.variableNames=["A"];const{windowSize:s,batchSize:i,outSize:l}=e;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,l];const u=t==="max"?">":"<",c=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${s}; i++) {
          int inIdx = ${c};
          float candidate = getA(batch, inIdx);
          if (candidate ${u} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class _Y{constructor(e,t,r,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,T(e.length>2,()=>`Packed arg${r.charAt(0).toUpperCase()+r.slice(1)} supports only inputs with rank above 2.`);const i=e[e.length-1],l=Math.ceil(i/t);this.outputShape=e.slice(0,-1),l>1&&this.outputShape.push(l),s||this.variableNames.push("bestIndicesA");const u=this.outputShape,c=u.length,h=gt(c),p=An("coords",c);let m,g;if(l===1){g=c+1;const V=gt(g);m=`
        ${V} sourceLocR = ${V}(${p.join()}, 0);
        ++${p[c-1]};
        ${V} sourceLocG = ${V}(${p.join()}, 0);
        ++${p[c-2]};
        ${V} sourceLocA = ${V}(${p.join()}, 0);
        --${p[c-1]};
        ${V} sourceLocB = ${V}(${p.join()}, 0);
        --${p[c-2]};`}else g=c,m=`
        ${h} sourceLocR = coords;
        ++${p[c-1]};
        ${h} sourceLocG = coords;
        ++${p[c-2]};
        ${h} sourceLocA = coords;
        --${p[c-1]};
        ${h} sourceLocB = coords;
        --${p[c-2]};`;const y=["x","y","z","w","u","v"].slice(0,g),v="."+y[g-1],w=y.map(V=>"int "+V),S=An("sourceLocR",g-1).concat("inIdx.r"),I=An("sourceLocG",g-1).concat("inIdx.g"),C=An("sourceLocB",g-1).concat("inIdx.b"),R=An("sourceLocA",g-1).concat("inIdx.a"),L=r==="max"?"greaterThan":"lessThan",G=s?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${S.join()}),
                             getBestIndicesAChannel(${I.join()}),
                             getBestIndicesAChannel(${C.join()}),
                             getBestIndicesAChannel(${R.join()})));`,$=`vec4(
            getAChannel(${S.join()}),
            hasNextCol ? getAChannel(${I.join()}) : 0.,
            hasNextRow ? getAChannel(${C.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${R.join()}) : 0.)`,F=s?"":`
      float getBestIndicesAChannel(${w.join()}) {
        return getChannel(getBestIndicesA(${y.join()}),
                                          vec2(${y.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${w.join()}) {
        return getChannel(getA(${y.join()}),
                               vec2(${y.slice(-2).join()}));
      }
      ${F}
      void main() {
        ${h} coords = getOutputCoords();
        bool hasNextCol = ${p[c-1]} < ${u[c-1]-1};
        bool hasNextRow = ${p[c-2]} < ${u[c-2]-1};
        ${m}
        ivec4 srcIdx = ivec4(sourceLocR${v}, sourceLocG${v},
          sourceLocB${v}, sourceLocA${v}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${$};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${G}
          vec4 candidate = ${$};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${L}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function UN(n,e,t,r=null){let s=e.shape[0],i=e.shape[1];r!=null&&(s=r.shape[0],i=r.shape[1]);const l=Np(i),u={windowSize:l,inSize:i,batchSize:s,outSize:Math.ceil(i/l)},c=new BY(u,t,r==null),h=[e];r!=null&&h.push(r);const p=n.runWebGLProgram(c,h,"int32");if(p.shape[1]===1)return p;const m=UN(n,e,t,p);return n.disposeIntermediateTensorInfo(p),m}function jN(n,e,t,r=null){const s=r!=null?r.shape:e.shape,i=s[s.length-1],l=Np(i),u=new _Y(s,l,t,r==null),c=r==null?[e]:[e,r],h=n.runWebGLProgram(u,c,"int32");if(h.shape.length===e.shape.length){const p=jN(n,e,t,h);return n.disposeIntermediateTensorInfo(h),p}return h}function YN(n,e,t,r){const s=[t];if(In("arg"+r.charAt(0).toUpperCase()+r.slice(1),s,e.shape.length),!ae().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const i=[],l=n.texData.get(e.dataId),u=l!==null&&l.isPacked;let c=e;u&&(c=n.unpackTensor(e),i.push(c));const[h,p]=mn(c.shape,s),m=M(p),g=Ne({inputs:{x:c},backend:n,attrs:{shape:[-1,m]}});i.push(g);const y=UN(n,g,r);i.push(y);const v=Ne({inputs:{x:y},backend:n,attrs:{shape:h}});return i.forEach(w=>n.disposeIntermediateTensorInfo(w)),v}return jN(n,e,r)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function HY(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i}=r;let l=oe(i,s.shape);const u=Xt(l,s.shape.length);let c=s;const h=[];u!=null&&(c=Kn({inputs:{x:s},backend:t,attrs:{perm:u}}),h.push(c),l=Yt(l.length,c.shape.length)),In("argMax",[l[0]],c.shape.length);const p=YN(t,c,l[0],"max");return h.forEach(m=>t.disposeIntermediateTensorInfo(m)),p}const UY={kernelName:lh,backendName:"webgl",kernelFunc:HY};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function jY(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i}=r;let l=oe(i,s.shape);const u=Xt(l,s.shape.length);let c=s;const h=[];u!=null&&(c=Kn({inputs:{x:s},backend:t,attrs:{perm:u}}),h.push(c),l=Yt(l.length,c.shape.length)),In("argMin",[l[0]],c.shape.length);const p=YN(t,c,l[0],"min");return h.forEach(m=>t.disposeIntermediateTensorInfo(m)),p}const YY={kernelName:uh,backendName:"webgl",kernelFunc:jY};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const QY=ts+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,JY=it({opSnippet:QY}),qY={kernelName:pu,backendName:"webgl",kernelFunc:JY};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const eQ=ts+"return log(x + sqrt(x * x + 1.0));",tQ=it({opSnippet:eQ}),nQ={kernelName:fu,backendName:"webgl",kernelFunc:tQ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const rQ=ts+`
  return atan(x);
`,sQ=it({opSnippet:rQ}),aQ={kernelName:mu,backendName:"webgl",kernelFunc:sQ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const iQ=Yy+`
  return atan(a, b);
`,oQ=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+yo+`
  return result;
`,lQ=Cn({opSnippet:iQ,packedOpSnippet:oQ}),uQ={kernelName:bu,backendName:"webgl",kernelFunc:lQ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const cQ=ts+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,dQ=it({opSnippet:cQ}),hQ={kernelName:gu,backendName:"webgl",kernelFunc:dQ};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Yc{constructor(e,t,r,s=!1,i=!1){if(this.variableNames=["x"],t==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const l=e.filterWidth,u=e.strideHeight,c=e.strideWidth,h=e.dilationHeight,p=e.dilationWidth,m=e.effectiveFilterHeight,g=e.effectiveFilterWidth,y=e.padInfo.top,v=e.padInfo.left;this.outputShape=e.outShape;const w=t==="avg",S=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,I=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let C="0.0";if(w||(C="-1.0 / 1e-20"),r){const V=">=";this.userCode=`
        const ivec2 strides = ivec2(${u}, ${c});
        const ivec2 pads = ivec2(${y}, ${v});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${m};
              wR += ${h}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${g};
                wC += ${p}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${V} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${s?i?S:I:`wR * ${g} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const R="max";let L=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(L="avgValue / max(count, 1.0)");const G=Math.floor(l/4)*4,$=l%4,F=`
      if (${w}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${R}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${u}, ${c});
      const ivec2 pads = ivec2(${y}, ${v});
      const float initializationValue = ${C};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${C});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${m};
            wR += ${h}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${G}; wC += 4) {
            int xC = xCCorner + wC * ${p};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${p}, d),
              getValue(batch, xR, xC + 2 * ${p}, d),
              getValue(batch, xR, xC + 3 * ${p}, d)
            );

            ${F}
          }

          int xC = xCCorner + ${G};
          if (${$===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${F}
          } else if (${$===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${p}, d),
              initializationValue,
              initializationValue
            );

            ${F}
          } else if (${$===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${p}, d),
              getValue(batch, xR, xC + 2 * ${p}, d),
              initializationValue
            );

            ${F}
          }
        }
        setOutput(${L});
      }
    `}}class Jy{constructor(e,t,r,s=!1,i=!1){if(this.variableNames=["x"],t==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const l=e.filterWidth,u=e.strideDepth,c=e.strideHeight,h=e.strideWidth,p=e.dilationDepth,m=e.dilationHeight,g=e.dilationWidth,y=e.effectiveFilterDepth,v=e.effectiveFilterHeight,w=e.effectiveFilterWidth,S=e.padInfo.front,I=e.padInfo.top,C=e.padInfo.left;this.outputShape=e.outShape;const R=t==="avg";let L="0.0";if(R||(L="-1.0 / 1e-20"),r){const Z=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${u}, ${c}, ${h});
        const ivec3 pads = ivec3(${S}, ${I}, ${C});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${y};
              wD += ${p}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${v};
                wR += ${m}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${w};
                  wC += ${g}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${Z} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${s?i?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${v} * ${w} +
                      wR * ${w} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const G="max";let $=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&($="avgValue / max(count, 1.0)");const F=Math.floor(l/4)*4,V=l%4,D=`
      if (${R}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${G}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${u}, ${c}, ${h});
      const ivec3 pads = ivec3(${S}, ${I}, ${C});
      const float initializationValue = ${L};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${L});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${y};
            wD += ${p}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${v};
            wR += ${m}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${F}; wC += 4) {
              int xC = xCCorner + wC * ${g};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${g}, ch),
                getValue(batch, xD, xR, xC + 2 * ${g}, ch),
                getValue(batch, xD, xR, xC + 3 * ${g}, ch)
              );

              ${D}
            }

            int xC = xCCorner + ${F};
            if (${V===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${D}
            } else if (${V===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${g}, ch),
                initializationValue,
                initializationValue
              );

              ${D}
            } else if (${V===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${g}, ch),
                getValue(batch, xD, xR, xC + 2 * ${g}, ch),
                initializationValue
              );

              ${D}
            }
          }
        }
        setOutput(${$});
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function pQ(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;Hc(s,"avgPool");const{filterSize:i,strides:l,pad:u,dimRoundingMode:c}=r,h=1;T(Rn(l,h),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${l} and dilations '${h}'`);const p=_r(s.shape,i,l,h,u,c);if(p.filterWidth===1&&p.filterHeight===1&&B(p.inShape,p.outShape))return mr({inputs:{x:s},backend:t});const m=new Yc(p,"avg",!1);return t.runWebGLProgram(m,[s],"float32")}const fQ={kernelName:ch,backendName:"webgl",kernelFunc:pQ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mQ(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{filterSize:i,strides:l,pad:u,dimRoundingMode:c,dataFormat:h}=r,p=[1,1,1],m=ha(s.shape,i,l,p,u,c,h),g=new Jy(m,"avg",!1);return t.runWebGLProgram(g,[s],"float32")}const gQ={kernelName:dh,backendName:"webgl",kernelFunc:mQ};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class bQ{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,r=e.filterWidth,s=e.strideHeight,i=e.strideWidth,l=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=c-1-e.padInfo.top,m=h-1-e.padInfo.left,g=1/(t*r);this.userCode=`
      const ivec2 pads = ivec2(${p}, ${m});
      const float avgMultiplier = float(${g});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${c};
            wR += ${l}) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${h};
            wC+= ${u}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class yQ{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,r=e.filterHeight,s=e.filterWidth,i=e.strideDepth,l=e.strideHeight,u=e.strideWidth,c=e.dilationDepth,h=e.dilationHeight,p=e.dilationWidth,m=e.effectiveFilterDepth,g=e.effectiveFilterHeight,y=e.effectiveFilterWidth,v=m-1-e.padInfo.front,w=g-1-e.padInfo.top,S=y-1-e.padInfo.left,I=1/(t*r*s);this.userCode=`
      const ivec3 pads = ivec3(${v}, ${w}, ${S});
      const float avgMultiplier = float(${I});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${m};
            wD += ${c}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${g};
              wR += ${h}) {
            float dyR = float(dyRCorner + wR) / ${l}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${y};
                wC += ${p}) {
              float dyC = float(dyCCorner + wC) / ${u}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xQ(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i}=e,l=i,{filterSize:u,strides:c,pad:h,dimRoundingMode:p}=r,m=[1,1,1],g=ha(l.shape,u,c,m,h,p),y=new yQ(g);return t.runWebGLProgram(y,[s],l.dtype)}const vQ={kernelName:Eg,backendName:"webgl",kernelFunc:xQ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function wQ(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i}=e,l=i;Hc([s,i],"avgPoolGrad");const{filterSize:u,strides:c,pad:h}=r,p=_r(l.shape,u,c,1,h),m=new bQ(p);return t.runWebGLProgram(m,[s],l.dtype)}const kQ={kernelName:Rg,backendName:"webgl",kernelFunc:wQ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function IQ(n){const{inputs:e,backend:t,attrs:r}=n,{a:s,b:i}=e,{transposeA:l,transposeB:u}=r;return yf({a:s,b:i,transposeA:l,transposeB:u,backend:t})}const SQ={kernelName:hh,backendName:"webgl",kernelFunc:IQ};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class CQ{constructor(e,t,r,s,i,l){this.outputShape=[],this.variableNames=["x","mean","variance"],Ye(e,t),Ye(e,r);let u="0.0";s!=null&&(Ye(e,s),this.variableNames.push("offset"),u="getOffsetAtOutCoords()");let c="1.0";i!=null&&(Ye(e,i),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${u};
        float scale = ${c};
        float inv = scale * inversesqrt(variance + float(${l}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class TQ{constructor(e,t,r,s,i,l){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ye(e,t),Ye(e,r);let u="vec4(0.0)";s!=null&&(Ye(e,s),this.variableNames.push("offset"),u="getOffsetAtOutCoords()");let c="vec4(1.0)";i!=null&&(Ye(e,i),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${u};
        vec4 scale = ${c};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${l}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const NQ={kernelName:Sh,backendName:"webgl",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:r,mean:s,variance:i,offset:l,scale:u}=n;T(s.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),T(l==null||s.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),T(u==null||s.shape.length===u.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:c}=t;c==null&&(c=.001);const h=[r,s,i];let p=null;l!=null&&(p=l.shape,h.push(l));let m=null;u!=null&&(m=u.shape,h.push(u));const g=ae().getBool("WEBGL_PACK_NORMALIZATION")?new TQ(r.shape,s.shape,i.shape,p,m,c):new CQ(r.shape,s.shape,i.shape,p,m,c);return e.runWebGLProgram(g,h,h[0].dtype)}};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class RQ{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=gt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const r=EQ(this.rank);let s;const i=e.map((l,u)=>`sourceLoc.${qy[u]} = start[${u}] + coords.${qy[u]};`);s=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${i.join(`
`)}
      `,this.userCode=`
      void main() {
        ${s}
        setOutput(getSource(${r}));
      }
    `}}const qy=["x","y","z","w","u","v"];function EQ(n){if(n===1)return"sourceLoc";if(n<=6)return qy.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class LQ{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=gt(this.rank),r=An("coords",this.rank),s=An("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${s.slice(-2).join()})`,l=`getChannel(getSource(${s.join()}), ${i})`,u=`
      result.x = ${l};
      if (++${r[this.rank-1]} < ${e[this.rank-1]}) {
        ++${s[this.rank-1]};
        result.y = ${l};
        --${s[this.rank-1]};
      }
    `,c=this.rank===1?"":`
      --${r[this.rank-1]};
      if (++${r[this.rank-2]} < ${e[this.rank-2]}) {
        ++${s[this.rank-2]};
        result.z = ${l};
        if (++${r[this.rank-1]} < ${e[this.rank-1]}) {
          ++${s[this.rank-1]};
          result.w = ${l};
        }
      }
    `,h=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((p,m)=>`start[${m}]`).join()});`:e.map((p,m)=>`${s[m]} = ${r[m]} + start[${m}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${h}
        vec4 result = vec4(0.);
        ${u}
        ${c}
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function GQ(n,e,t,r){const s=r.texData.get(n.dataId),i=r.makeTensorInfo(t,n.dtype),l=r.texData.get(i.dataId);Object.assign(l,s),l.refCount=1,l.shape=t,l.dtype=n.dtype;let u=vb(e,we(n.shape));s.slice&&(u+=s.slice.flatOffset),l.slice={flatOffset:u,origDataId:s.slice&&s.slice.origDataId||n.dataId};const c=r.dataRefCount.get(l.slice.origDataId)||1;return r.dataRefCount.set(l.slice.origDataId,c+1),i}function Sl(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{begin:i,size:l}=r,[u,c]=Cp(s,i,l);if(bb(s,u,c),M(c)===0)return t.makeTensorInfo(c,s.dtype,[]);if(t.shouldExecuteOnCPU([s])||s.dtype==="string"){const m=t.texData.get(s.dataId),g=Sj(m.values,u,c,s.shape,s.dtype);return t.makeTensorInfo(c,s.dtype,g)}const{isPacked:h}=t.texData.get(s.dataId),p=xb(s.shape,u,c);if(h||!p){const m=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new LQ(c):new RQ(c),g=[u];return t.runWebGLProgram(m,[s],s.dtype,g)}return t.uploadToGPU(s.dataId),GQ(s,u,c,t)}const zQ={kernelName:qh,backendName:"webgl",kernelFunc:Sl};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const WQ={kernelName:ph,backendName:"webgl",kernelFunc:n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockShape:i,crops:l}=r;T(s.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const u=i.reduce((C,R)=>C*R),c=Ic(s.shape,i,u),h=Sc(c.length,i.length),p=Cc(s.shape,i,u),m=Cb(l,i.length),g=Tb(p,l,i.length),y=[],v=Ne({inputs:{x:s},backend:t,attrs:{shape:c}}),w=Kn({inputs:{x:v},backend:t,attrs:{perm:h}}),S=Ne({inputs:{x:w},backend:t,attrs:{shape:p}}),I=Sl({inputs:{x:S},backend:t,attrs:{begin:m,size:g}});return y.push(v),y.push(w),y.push(S),y.forEach(C=>t.disposeIntermediateTensorInfo(C)),I}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function MQ(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,weights:i}=e,{size:l}=r,u=t.readSync(s.dataId),c=t.readSync(i.dataId),h=NN(u,c,i.dtype,i.shape,l);return t.makeTensorInfo([l],i.dtype,h)}const $Q={kernelName:Lg,backendName:"webgl",kernelFunc:MQ};/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const FQ=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,VQ=`
  return float(int(a.r) & int(b.r));
`;function PQ(n){const{inputs:e,backend:t}=n,{a:r,b:s}=e,i=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS"),l=ae().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([r,s])||l===1){const c=t.texData.get(r.dataId).values,h=t.texData.get(s.dataId).values,[p,m]=UU(r.shape,s.shape,c,h,r.dtype),g=t.makeTensorInfo(m,r.dtype),y=t.texData.get(g.dataId);return y.values=p,g}let u;return i?u=new kl(FQ,r.shape,s.shape,!1):u=new bo(VQ,r.shape,s.shape),t.runWebGLProgram(u,[r,s],r.dtype)}const XQ={kernelName:Gg,backendName:"webgl",kernelFunc:PQ};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function OQ(n){const{inputs:e,backend:t}=n,{s0:r,s1:s}=e,i=t.readSync(r.dataId),l=t.readSync(s.dataId),u=Ye(Array.from(i),Array.from(l));return t.makeTensorInfo([u.length],"int32",Int32Array.from(u))}const DQ={kernelName:bw,backendName:"webgl",kernelFunc:OQ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const QN=Cn({opSnippet:"return float(a != b);",cpuKernelImpl:mj,dtype:"bool"}),AQ={kernelName:Dh,backendName:"webgl",kernelFunc:QN};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Qc(n){const{inputs:e,backend:t}=n,{input:r}=e,s=t.texData.get(r.dataId);return mr({inputs:{x:s.complexTensorInfos.real},backend:t})}const KQ={kernelName:s0,backendName:"webgl",kernelFunc:Qc};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ZQ="return float(int(x));";function BQ(n,e){const t=new Ys(n.shape,ZQ),r=e.runWebGLProgram(t,[n],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ex(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{dtype:i}=r;if(i==="complex64"){if(s.dtype==="complex64")return mr({inputs:{x:s},backend:t});const l=gn(s.shape),u=ex({inputs:{x:s},backend:t,attrs:{dtype:"float32"}}),c=li({inputs:{real:u,imag:l},backend:t});return l.dispose(),t.disposeIntermediateTensorInfo(u),c}if(s.dtype==="complex64"){const l=Qc({inputs:{input:s},backend:t}),u=ex({inputs:{x:l},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(l),u}if(!Gt(s.dtype,i)){const l=mr({inputs:{x:s},backend:t});return{dataId:l.dataId,shape:l.shape,dtype:i}}if(t.shouldExecuteOnCPU([s])){const l=t.texData.get(s.dataId).values,[u,c,h]=jU(l,s.shape,s.dtype,i);return t.makeTensorInfo(u,c,h)}if(i==="int32")return BQ(s,t);if(i==="bool"){const l=t.makeTensorInfo([],"bool",ge("bool",1)),u=QN({inputs:{a:s,b:l},backend:t});return t.disposeIntermediateTensorInfo(l),u}throw new Error(`Error in Cast: failed to cast ${s.dtype} to ${i}`)}const _Q={kernelName:yu,backendName:"webgl",kernelFunc:ex};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const JN="return ceil(x);",HQ=it({opSnippet:JN,packedOpSnippet:JN,cpuKernelImpl:YU}),UQ={kernelName:xu,backendName:"webgl",kernelFunc:HQ};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class jQ{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class YQ{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function QQ(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{clipValueMin:i,clipValueMax:l}=r;let u;ae().getBool("WEBGL_PACK_CLIP")?u=new YQ(s.shape):u=new jQ(s.shape);const c=[[i],[l]];return t.runWebGLProgram(u,[s],s.dtype,c)}const JQ={kernelName:vu,backendName:"webgl",kernelFunc:QQ};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class qQ{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function qN(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function e7(n){const{inputs:e,backend:t}=n,{x:r}=e,s=t.texData.get(r.dataId),i=new qQ(r.shape),l=[qN(r,s.complexTensorInfos.real),qN(r,s.complexTensorInfos.imag)];return t.runWebGLProgram(i,l,l[0].dtype)}const t7={kernelName:fh,backendName:"webgl",kernelFunc:e7};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class n7{constructor(e){this.outputShape=[],this.outputShape=As(e,1),this.variableNames=e.map((l,u)=>`T${u}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let l=1;l<t.length;l++)t[l]=t[l-1]+e[l][1];const r=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let l=1;l<t.length;l++){const u=t[l-1];r.push(`else if (yC < ${t[l]}) setOutput(getT${l}(yR, yC-${u}));`)}const s=t.length,i=t[t.length-1];r.push(`else setOutput(getT${s}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${r.join(`
        `)}
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class r7{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=As(e,t);const r=this.outputShape,s=r.length,i=gt(s),l=An("coords",s),u=["x","y","z","w","u","v"].slice(0,s);this.variableNames=e.map((w,S)=>`T${S}`);const c=new Array(e.length-1);c[0]=e[0][t];for(let w=1;w<c.length;w++)c[w]=c[w-1]+e[w][t];const h=u[t],p=u.slice(-2),m=u.join();let g=`if (${h} < ${c[0]}) {
        return getChannel(
            getT0(${m}), vec2(${p.join()}));
        }`;for(let w=1;w<c.length;w++){const S=c[w-1];g+=`
        if (${h} < ${c[w]}  && ${h} >= ${c[w-1]}) {
          return getChannel(
            getT${w}(${vf(u,h,S)}),
            vec2(${vf(p,h,S)}));
        }`}const y=c.length,v=c[c.length-1];g+=`
        return getChannel(
          getT${y}(${vf(u,h,v)}),
          vec2(${vf(p,h,v)}));`,this.userCode=`
      float getValue(${u.map(w=>"int "+w)}) {
        ${g}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${l}), 0., 0., 0.);

        ${l[s-1]} = ${l[s-1]} + 1;
        if (${l[s-1]} < ${r[s-1]}) {
          result.g = getValue(${l});
        }

        ${l[s-2]} = ${l[s-2]} + 1;
        if (${l[s-2]} < ${r[s-2]}) {
          result.a = getValue(${l});
        }

        ${l[s-1]} = ${l[s-1]} - 1;
        if (${l[s-2]} < ${r[s-2]} &&
            ${l[s-1]} < ${r[s-1]}) {
          result.b = getValue(${l});
        }
        setOutput(result);
      }
    `}}function vf(n,e,t){const r=n.indexOf(e);return n.map((s,i)=>i===r?`${s} - ${t}`:s).join()}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function wf(n){const{inputs:e,backend:t}=n,{input:r}=e,s=t.texData.get(r.dataId);return mr({inputs:{x:s.complexTensorInfos.imag},backend:t})}const s7={kernelName:Yg,backendName:"webgl",kernelFunc:wf};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Jc(n,e,t){const r=n[0].dtype;if(r==="complex64"){const y=n.map(C=>Qc({inputs:{input:C},backend:t})),v=n.map(C=>wf({inputs:{input:C},backend:t})),w=Jc(y,e,t),S=Jc(v,e,t),I=li({inputs:{real:w,imag:S},backend:t});return y.forEach(C=>t.disposeIntermediateTensorInfo(C)),v.forEach(C=>t.disposeIntermediateTensorInfo(C)),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(S),I}let s=t.shouldExecuteOnCPU(n);if(r==="string"&&(s=!0),s){const y=n.map(L=>{const G=[-1,M(L.shape.slice(e))];return Ne({inputs:{x:L},backend:t,attrs:{shape:G}})}),v=y.map(L=>({vals:t.readSync(L.dataId),shape:L.shape})),w=As(y.map(L=>L.shape),1),S=y[0].shape[0]===1,I=QU(v,w,r,S),C=As(n.map(L=>L.shape),e),R=t.makeTensorInfo(C,r,I);return y.forEach(L=>t.disposeIntermediateTensorInfo(L)),R}const i=n.filter(y=>M(y.shape)>0),l=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(i.length===1){const y=l?new Ys(n[0].shape,ii):new oi(n[0].shape,ii);return t.runWebGLProgram(y,n,r)}const u=ae().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>u){const y=[];for(let w=0;w<i.length;w+=u){const S=i.slice(w,w+u);y.push(Jc(S,e,t))}const v=Jc(y,e,t);for(const w of y)t.disposeIntermediateTensorInfo(w);return v}if(l){const y=new r7(i.map(v=>v.shape),e);return t.runWebGLProgram(y,i,r)}const{tensors2D:c,outShape:h}=a7(i,e,t),p=new n7(c.map(y=>y.shape)),m=t.runWebGLProgram(p,c,r);c.forEach(y=>t.disposeIntermediateTensorInfo(y));const g=Ne({inputs:{x:m},attrs:{shape:h},backend:t});return t.disposeIntermediateTensorInfo(m),g}function a7(n,e,t){const r=As(n.map(s=>s.shape),e);return{tensors2D:n.map(s=>Ne({inputs:{x:s},attrs:{shape:[-1,M(s.shape.slice(e))]},backend:t})),outShape:r}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function eR(n){const{inputs:e,backend:t,attrs:r}=n,{axis:s}=r,i=oe(s,e[0].shape)[0],l=e.map(h=>h.shape);kb(l,i);const u=As(e.map(h=>h.shape),i);if(M(u)===0)return t.makeTensorInfo(u,e[0].dtype,[]);const c=e.filter(h=>M(h.shape)>0);return c.length===1?mr({inputs:{x:c[0]},backend:t}):Jc(c,i,t)}const i7={kernelName:mh,backendName:"webgl",kernelFunc:eR};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class tR{constructor(e,t=!1,r=null,s=!1,i=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const l=e.padInfo.top,u=e.padInfo.left,c=e.strideHeight,h=e.strideWidth,p=e.dilationHeight,m=e.dilationWidth,g=e.filterHeight,y=e.filterWidth,v=Math.floor(e.inChannels/4)*4,w=e.inChannels%4,S=e.dataFormat==="channelsLast",I=S?1:2,C=S?2:3,R=S?3:1;let L="",G="";r&&(s?L=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?L=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:L=`
          float activation(float x) {
            ${r}
          }
        `,G="result = activation(result);");const $=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${L}

      const ivec2 strides = ivec2(${c}, ${h});
      const ivec2 pads = ivec2(${l}, ${u});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${R}];

        ivec2 xRCCorner =
            ivec2(coords[${I}], coords[${C}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${g}; wR++) {
          int xR = xRCorner + wR * ${p};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${y}; wC++) {
            int xC = xCCorner + wC * ${m};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${v}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${S}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${w===1}) {

              if (${S}) {
                dotProd +=
                    getX(batch, xR, xC, ${v}) *
                    getW(wR, wC, ${v}, d2);
              } else {
                dotProd +=
                    getX(batch, ${v}, xR, xC) *
                    getW(wR, wC, ${v}, d2);
              }

            } else if (${w===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${v}, d2),
                getW(wR, wC, ${v} + 1, d2)
              );

              if (${S}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${v}),
                  getX(batch, xR, xC, ${v} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${v}, xR, xC),
                  getX(batch, ${v} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${w===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${v}, d2),
                getW(wR, wC, ${v} + 1, d2),
                getW(wR, wC, ${v} + 2, d2)
              );

              if (${S}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${v}),
                  getX(batch, xR, xC, ${v} + 1),
                  getX(batch, xR, xC, ${v} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${v}, xR, xC),
                  getX(batch, ${v} + 1, xR, xC),
                  getX(batch, ${v} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${$}
        ${G}
        setOutput(result);
      }
    `}}class o7{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,r=e.padInfo.top,s=e.padInfo.left,i=e.strideDepth,l=e.strideHeight,u=e.strideWidth,c=e.dilationDepth,h=e.dilationHeight,p=e.dilationWidth,m=e.filterDepth,g=e.filterHeight,y=e.filterWidth,v=Math.floor(e.inChannels/4)*4,w=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${l}, ${u});
      const ivec3 pads = ivec3(${t}, ${r}, ${s});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${m}; wF++) {
          int xF = xFCorner + wF * ${c};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${g}; wR++) {
            int xR = xRCorner + wR * ${h};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${y}; wC++) {
              int xC = xCCorner + wC * ${p};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${v}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${w===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${v}) *
                  getW(wF, wR, wC, ${v}, d2);
              } else if (${w===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${v}),
                  getX(batch, xF, xR, xC, ${v} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${v}, d2),
                  getW(wF, wR, wC, ${v} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${w===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${v}),
                  getX(batch, xF, xR, xC, ${v} + 1),
                  getX(batch, xF, xR, xC, ${v} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${v}, d2),
                  getW(wF, wR, wC, ${v} + 1, d2),
                  getW(wF, wR, wC, ${v} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class nR{constructor(e,t=!1,r=null,s=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=En(this.outputShape.length);const l=e.padInfo.left,u=e.strideWidth,c=e.dilationWidth,h=e.filterHeight,p=e.filterWidth,m=p;let g=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let S=0;S<p;S++)g+=`
           vec4 xTexelC${S*2};
           int xTexelC${S*2}Ready;
           vec4 xTexelC${S*2+1};
           int xTexelC${S*2+1}Ready;
           vec4 xC${S};`;g+=`
     for (int r = 0; r < ${h}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let S=0;S<p;S++)g+=`
           xTexelC${S*2} = vec4(0.0);
           xTexelC${S*2}Ready = 0;
           xTexelC${S*2+1} = vec4(0.0);
           xTexelC${S*2+1}Ready = 0;
           xC${S} = vec4(0.0);`;g+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let S=0;S<(m+1)/2;S++){const I=S*2;if(g+=`
           xC = xCCorner + ${I*c};
           `,u===1){if(I<p&&(l%2===1?(g+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${I}Ready == 0) {
                   xTexelC${I} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${I}.zw = vec2(0.0);
                   }
                   xTexelC${I}Ready = 1;
                 }
               `,c===1&&I>0?g+=`
                 xC${I} = vec4(xTexelC${I-2}.zw, xTexelC${I}.xy);
                 `:g+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${I} = vec4(previous.zw, xTexelC${I}.xy);
                   } else {
                     xC${I} = vec4(0.0, 0.0, xTexelC${I}.xy);
                   }
                   `):g+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${I}Ready == 0) {
                   xTexelC${I} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${I}.zw = vec2(0.0);
                   }
                   xTexelC${I}Ready = 1;
                 }

                 xC${I} = xTexelC${I};
                 `,I+1<p)){const C=l%2===0?E(c):c;c%2===0&&l%2===1||c%2!==0&&l%2!==1?(g+=`
                   xCOffset = xC + imod(pads[1], 2) + ${C};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${I+1}Ready == 0) {
                     xTexelC${I+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${I+1}.zw = vec2(0.0);
                     }
                     xTexelC${I+1}Ready = 1;
                   }
                   `,c>1?g+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${I+1} = vec4(previous.zw, xTexelC${I+1}.xy);
                     } else {
                      xC${I+1} = vec4(0.0, 0.0, xTexelC${I+1}.xy);
                     }
                     `:g+=`
                     xC${I+1} = vec4(xTexelC${I}.zw, xTexelC${I+1}.xy);
                     `):C===1?g+=`
                     xC${I+1} = xTexelC${I};
                     `:g+=`
                     xCOffset = xC + ${C};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${I+1}Ready == 0) {
                       xTexelC${I+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${I+1}.zw = vec2(0.0);
                       }
                       xTexelC${I+1}Ready = 1;
                     }

                     xC${I+1} = xTexelC${I+1};
                     `}}else I<p&&(l%2===1?(g+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${I}Ready == 0) {
                   xTexelC${I} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${I}.zw = vec2(0.0);
                   }
                   xTexelC${I}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${I+1}Ready == 0) {
                   xTexelC${I+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${I+1}.zw = vec2(0.0);
                   }
                   xTexelC${I+1}Ready = 1;
                 }

                 xC${I} = vec4(xTexelC${I}.zw, xTexelC${I+1}.zw);
               `,I+1<p&&(g+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${I+1} = vec4(xTexelC${I+1}.xy, final.xy);
                 `)):(g+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${I}Ready == 0) {
                   xTexelC${I} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${I}.zw = vec2(0.0);
                   }
                   xTexelC${I}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${I+1}Ready == 0) {
                   xTexelC${I+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${I+1}.zw = vec2(0.);
                   }
                   xTexelC${I+1}Ready = 1;
                 }

                 xC${I} = vec4(
                   xTexelC${I}.xy, xTexelC${I+1}.xy);
               `,I+1<p&&(g+=`
                   xC${I+1} = vec4(xTexelC${I}.zw, xTexelC${I+1}.zw);
                 `)));I<p&&(g+=`
             wTexel = getW(r, ${I}, d1, d2);
             dotProd += xC${I}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${I}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,I+1<p&&(g+=`
               wTexel = getW(r, ${I+1}, d1, d2);
               dotProd += xC${I+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${I+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}g+=`
     }
   `,g+=`
     }
   `,g+=`
     }
   `;let y="",v="";r&&(s?y=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${r}
         }`:i?y=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${r}
         }`:y=`vec4 activation(vec4 x) {
           ${r}
         }`,v="result = activation(result);");const w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${y}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${g}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${w}
         ${v}
         setOutput(result);
       }
     `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class l7{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length);const{dataFormat:r}=t,s=Dn(),i=r==="channelsLast",l=i?1:2,u=i?2:3,c=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let h="";for(let p=0;p<=1;p++)for(let m=0;m<=1;m++)h+=`
          blockIndex = rc.z + ${m};
          pos = rc.y + ${p};

          ${c}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${l}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${u}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${i}) {
                  innerDims = vec2(d1, ch);
                  result[${p*2+m}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${p*2+m}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${h}

        ${s.output} = result;
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function kf(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function rR({x:n,filter:e,convInfo:t,backend:r,bias:s=null,preluActivationWeights:i=null,leakyreluAlpha:l=0,activation:u=null}){const c=n.shape,h=r.texData.get(n.dataId),p=t.inChannels,m=c[0]*c[1]*c[2],g=t.outChannels,y=t.dataFormat==="channelsLast",v=!1,w=!1;let S;const I=[];if(i!=null){const C=kf(i.shape,y);C!=null&&(i=Ne({inputs:{x:i},backend:r,attrs:{shape:C}}),I.push(i))}if(s!=null){const C=kf(s.shape,y);C!=null&&(s=Ne({inputs:{x:s},backend:r,attrs:{shape:C}}),I.push(s))}if(!((m===1||g===1)&&p>BN)&&h.isPacked&&y&&h.texture!=null&&c[2]%2!==0&&B(h.shape.slice(-3),c.slice(-3))){const C=c[0]*c[1]*(c[2]+1),R={dataId:n.dataId,shape:[1,C,t.inChannels],dtype:n.dtype},L=h.shape;h.shape=h.shape.slice(),h.shape[h.shape.length-2]++,T(pf(h.shape,R.shape),()=>`packed reshape ${h.shape} to ${R.shape} isn't free`);const G=Ne({inputs:{x:e},backend:r,attrs:{shape:[1,t.inChannels,t.outChannels]}});I.push(G);const $=yf({a:R,b:G,backend:r,transposeA:v,transposeB:w,bias:s,activation:u,preluActivationWeights:i,leakyreluAlpha:l}),F=r.texData.get($.dataId);T(F.isPacked,()=>"batchMatMul result is expected to be packed"),h.shape=L,F.shape=t.outShape,S=mr({inputs:{x:$},backend:r}),S.shape=t.outShape,I.push($)}else{const C=t.outHeight*t.outWidth,R=Ne({inputs:{x:n},backend:r,attrs:{shape:y?[t.batchSize,C,t.inChannels]:[t.batchSize,t.inChannels,C]}}),L=Ne({inputs:{x:e},backend:r,attrs:{shape:[1,t.inChannels,t.outChannels]}}),G=yf({a:y?R:L,b:y?L:R,transposeA:!y,transposeB:w,backend:r,bias:s,activation:u,preluActivationWeights:i,leakyreluAlpha:l});S=Ne({inputs:{x:G},backend:r,attrs:{shape:t.outShape}}),I.push(R),I.push(L),I.push(G)}for(const C of I)r.disposeIntermediateTensorInfo(C);return S}function sR({x:n,filter:e,convInfo:t,backend:r,bias:s=null,preluActivationWeights:i=null,leakyreluAlpha:l=0,activation:u=null}){const{filterWidth:c,filterHeight:h,inChannels:p,outWidth:m,outHeight:g,dataFormat:y}=t,v=y==="channelsLast",w=c*h*p,S=g*m,I=[t.batchSize,w,S],C=!0,R=!1,L=[];if(i!=null){const pe=kf(i.shape,v);pe!=null&&(i=Ne({inputs:{x:i},backend:r,attrs:{shape:pe}}),L.push(i))}if(s!=null){const pe=kf(s.shape,v);pe!=null&&(s=Ne({inputs:{x:s},backend:r,attrs:{shape:pe}}),L.push(s))}const G=Ne({inputs:{x:e},backend:r,attrs:{shape:[1,w,M(e.shape)/w]}});L.push(G);const $=new l7(I,t),F=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],V=r.runWebGLProgram($,[n],"float32",F),D=Ne({inputs:{x:V},backend:r,attrs:{shape:I}});L.push(V),L.push(D);const Z=s!=null,ne=i!=null,re=u==="leakyrelu",se=u?jc(u,!0):null,ue=new ON(v?D.shape:G.shape,v?G.shape:D.shape,v?[t.batchSize,S,t.outChannels]:[t.batchSize,t.outChannels,S],C,R,Z,se,ne,re),le=v?[D,G]:[G,D];if(s&&le.push(s),ne&&le.push(i),re){const pe=r.makeTensorInfo([],"float32",Oa(l,"float32"));le.push(pe),L.push(pe)}const he=r.runWebGLProgram(ue,le,"float32"),me=Ne({inputs:{x:he},backend:r,attrs:{shape:t.outShape}});L.push(he);for(const pe of L)r.disposeIntermediateTensorInfo(pe);return me}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function u7(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:p}=r,m=pa(c),g=kn(s.shape,i.shape,l,h,u,p,!1,m);let y;if(g.filterHeight===1&&g.filterWidth===1&&g.dilationHeight===1&&g.dilationWidth===1&&g.strideHeight===1&&g.strideWidth===1&&(g.padInfo.type==="SAME"||g.padInfo.type==="VALID"))y=rR({x:s,filter:i,convInfo:g,backend:t});else if(g.strideWidth<=2&&m==="channelsLast"&&ae().getBool("WEBGL_EXP_CONV")){const w=new nR(g),S=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]];y=t.runWebGLProgram(w,[s,i],"float32",S)}else if(ae().getBool("WEBGL_CONV_IM2COL"))y=sR({x:s,filter:i,convInfo:g,backend:t});else{const w=new tR(g);y=t.runWebGLProgram(w,[s,i],"float32")}const v=Ne({inputs:{x:y},backend:t,attrs:{shape:g.outShape}});return t.disposeIntermediateTensorInfo(y),v}const c7={kernelName:gh,backendName:"webgl",kernelFunc:u7};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class d7{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,r=e.strideWidth,s=e.padInfo.top,i=e.padInfo.left,l=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${s};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${l?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class h7{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,r=e.filterWidth,s=e.strideHeight,i=e.strideWidth,l=e.dataFormat==="channelsLast",u=t-1-e.padInfo.top,c=r-1-e.padInfo.left,h=l?1:2,p=l?2:3,m=l?3:1;this.userCode=`
      const ivec2 pads = ivec2(${u}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${m}];

        ivec2 dyCorner = ivec2(coords[${h}], coords[${p}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${l}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class p7{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,r=e.strideHeight,s=e.strideWidth,i=e.padInfo.front,l=e.padInfo.top,u=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${i};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${r} - ${l};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${s} - ${u};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class f7{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,r=e.filterHeight,s=e.filterWidth,i=e.strideDepth,l=e.strideHeight,u=e.strideWidth,c=t-1-e.padInfo.front,h=r-1-e.padInfo.top,p=s-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${c}, ${h}, ${p});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${r}; wR++) {
            float dyR = float(dyRCorner + wR) / ${l}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${r} - 1 - wR;

            for (int wC = 0; wC < ${s}; wC++) {
              float dyC = float(dyCCorner + wC) / ${u}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${s} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function m7(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:i}=e,{strides:l,pad:u,dataFormat:c,dimRoundingMode:h,filterShape:p}=r,m=pa(c),g=kn(s.shape,p,l,1,u,h,!1,m),y=new d7(g);return t.runWebGLProgram(y,[s,i],"float32")}const g7={kernelName:Wg,backendName:"webgl",kernelFunc:m7};/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class b7{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=En(this.outputShape.length);const t=e.filterHeight,r=e.filterWidth,s=t-1-e.padInfo.top,i=r-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${s}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            int wCPerm = ${r} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function y7(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:i}=e,{inputShape:l,strides:u,pad:c,dataFormat:h,dimRoundingMode:p}=r,m=pa(h),g=kn(l,i.shape,u,1,c,p,!1,m);if(ae().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&m==="channelsLast"){const y=[[g.strideHeight,g.strideWidth]],v=new b7(g);return t.runWebGLProgram(v,[s,i],"float32",y)}else{const y=new h7(g);return t.runWebGLProgram(y,[s,i],"float32")}}const x7={kernelName:bh,backendName:"webgl",kernelFunc:y7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function v7(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:l,pad:u,dilations:c}=r,h=Ba(s.shape,i.shape,l,c,u),p=new o7(h);return t.runWebGLProgram(p,[s,i],"float32")}const w7={kernelName:yh,backendName:"webgl",kernelFunc:v7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function k7(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:i}=e,{strides:l,pad:u,filterShape:c}=r,h=Ba(s.shape,c,l,1,u),p=new p7(h);return t.runWebGLProgram(p,[s,i],"float32")}const I7={kernelName:Mg,backendName:"webgl",kernelFunc:k7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function S7(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:i}=e,{pad:l,strides:u,inputShape:c}=r,h=Ba(c,i.shape,u,1,l),p=new f7(h);return t.runWebGLProgram(p,[s,i],"float32")}const C7={kernelName:$g,backendName:"webgl",kernelFunc:S7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const T7=Il+`
  return cos(x);
`,N7=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${yo}
  return result;
`,R7=it({opSnippet:T7,packedOpSnippet:N7}),E7={kernelName:wu,backendName:"webgl",kernelFunc:R7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const L7=it({opSnippet:`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`}),G7={kernelName:ku,backendName:"webgl",kernelFunc:L7};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class z7{constructor(e,t,r,s,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[l,u,c,h]=e,[p]=t,[m,g]=r;this.outputShape=[p,m,g,h];const y=s==="bilinear"?1:0,[v,w]=[`${u-1}.0`,`${c-1}.0`],[S,I,C]=m>1?[`${(u-1)/(m-1)}`,"(y2-y1) * height_ratio",`y1*${v} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${v}`],[R,L,G]=g>1?[`${(c-1)/(g-1)}`,"(x2-x1) * width_ratio",`x1*${w} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${w}`];this.userCode=`
      const float height_ratio = float(${S});
      const float width_ratio = float(${R});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${l}) {
          return;
        }

        float height_scale = ${I};
        float width_scale = ${L};

        float in_y = ${C};
        if( in_y < 0.0 || in_y > ${v} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${G};
        if( in_x < 0.0 || in_x > ${w} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${y} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const W7={kernelName:Vg,backendName:"webgl",kernelFunc:n=>{const{inputs:e,backend:t,attrs:r}=n,{image:s,boxes:i,boxInd:l}=e,{cropSize:u,method:c,extrapolationValue:h}=r,p=new z7(s.shape,i.shape,u,c,h);return t.runWebGLProgram(p,[s,i,l],"float32")}};var qc;(function(n){n.Prod="*",n.Sum="+"})(qc||(qc={}));class aR{constructor(e,t,r,s){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,l=this.op===qc.Prod?"1.0":"0.0",u=r?l:`getX(${iR(i,"coords",this.op)})`,c=this.outputShape[this.outputShape.length-1];let h="",p="";r?(h=s?`end != ${c-1}`:"end != 0",p=s?"end + 1":"end - 1"):(h=s?`end + pow2 < ${c}`:"end >= pow2",p=s?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${gt(i)} coords = getOutputCoords();
        int end = ${oR(i,"coords",this.op)};
        float val = ${u};
        int pow2 = int(pow(2.0, index));
        if (${h}) {
          int idx = ${p};
          ${oR(i,"coords",this.op)} = idx;
          val ${this.op}= getX(${iR(i,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function iR(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function oR(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function lR(n,e,t,r,s,i){const l=e.shape.length,u=Xt([r],l);let c=e;u!=null&&(c=Kn({inputs:{x:e},backend:t,attrs:{perm:u}}));const h=Yt(1,l)[0];if(h!==l-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${r}`);const p=c.shape[h];let m=mr({inputs:{x:c},backend:t});for(let g=0;g<=Math.ceil(Math.log2(p))-1;g++){const y=new aR(n,c.shape,!1,i),v=[[g]],w=m;m=t.runWebGLProgram(y,[m],m.dtype,v),t.disposeIntermediateTensorInfo(w)}if(s){const g=new aR(n,c.shape,s,i),y=m;m=t.runWebGLProgram(g,[m],m.dtype),t.disposeIntermediateTensorInfo(y)}if(u!=null){const g=_a(u),y=Kn({inputs:{x:m},backend:t,attrs:{perm:g}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(c),y}return m}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function M7(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,exclusive:l,reverse:u}=r;return lR(qc.Prod,s,t,i,l,u)}const $7={kernelName:Fg,backendName:"webgl",kernelFunc:M7};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function F7(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,exclusive:l,reverse:u}=r;return lR(qc.Sum,s,t,i,l,u)}const V7={kernelName:xh,backendName:"webgl",kernelFunc:F7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function P7(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,weights:i}=e,{size:l,binaryOutput:u}=r;if(s.shape.length===1){const c=t.readSync(s.dataId),h=t.readSync(i.dataId),p=NN(c,h,i.dtype,i.shape,l);return t.makeTensorInfo([l],i.dtype,p)}else if(s.shape.length===2){const c=t.bufferSync(s),h=t.bufferSync(i),p=HU(c,h,l,u);return t.makeTensorInfo(p.shape,i.dtype,p.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${s.shape.length}.`)}const X7={kernelName:Pg,backendName:"webgl",kernelFunc:P7};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class O7{constructor(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function D7(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockSize:i,dataFormat:l}=r,u=s.shape[0],c=l==="NHWC"?s.shape[1]:s.shape[2],h=l==="NHWC"?s.shape[2]:s.shape[3],p=l==="NHWC"?s.shape[3]:s.shape[1],m=c*i,g=h*i,y=p/(i*i),v=l==="NHWC"?[u,m,g,y]:[u,y,m,g],w=new O7(v,i,l);return t.runWebGLProgram(w,[s],s.dtype)}const A7={kernelName:Xg,backendName:"webgl",kernelFunc:D7};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class uR{constructor(e,t=!1,r=null,s=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=En(this.outputShape.length);const l=e.filterHeight,u=e.filterWidth,c=e.outChannels/e.inChannels;let h="",p="";r&&(s?h=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?h=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:h=`
          float activation(float x) {
            ${r}
          }
        `,p="result = activation(result);");const m=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${h}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${c};
        int q = d2 - d1 * ${c};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${l}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${u}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${m}
        ${p}
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class cR{constructor(e,t=!1,r=null,s=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=En(this.outputShape.length);const l=e.outChannels/e.inChannels,u=e.padInfo.left,c=e.strideWidth,h=e.dilationWidth,p=e.filterHeight,m=e.filterWidth,g=m;let y=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let I=0;I<m;I++)y+=`
          vec4 xTexelC${I*2};
          int xTexelC${I*2}Ready;
          vec4 xTexelC${I*2+1};
          int xTexelC${I*2+1}Ready;
          vec4 xC${I};`;y+=`
    for (int r = 0; r < ${p}; r++) {
      `;for(let I=0;I<m;I++)y+=`
          xTexelC${I*2} = vec4(0.0);
          xTexelC${I*2}Ready = 0;
          xTexelC${I*2+1} = vec4(0.0);
          xTexelC${I*2+1}Ready = 0;
          xC${I} = vec4(0.0);`;y+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let I=0;I<(g+1)/2;I++){const C=I*2;if(y+=`
          xC = xCCorner + ${C*h};
          `,c===1){if(C<m&&(u%2===1?(y+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }
              `,h===1&&C>0?y+=`
                xC${C} = vec4(xTexelC${C-2}.zw, xTexelC${C}.xy);
                `:y+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${C} = vec4(previous.zw, xTexelC${C}.xy);
                  } else {
                    xC${C} = vec4(0.0, 0.0, xTexelC${C}.xy);
                  }
                  `):y+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                xC${C} = xTexelC${C};
                `,C+1<m)){const R=u%2===0?E(h):h;h%2===0&&u%2===1||h%2!==0&&u%2!==1?(y+=`
                  xCOffset = xC + imod(pads[1], 2) + ${R};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                    xTexelC${C+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${C+1}.zw = vec2(0.0);
                    }
                    xTexelC${C+1}Ready = 1;
                  }
                  `,h>1?y+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${C+1} = vec4(previous.zw, xTexelC${C+1}.xy);
                    } else {
                     xC${C+1} = vec4(0.0, 0.0, xTexelC${C+1}.xy);
                    }
                    `:y+=`
                    xC${C+1} = vec4(xTexelC${C}.zw, xTexelC${C+1}.xy);
                    `):R===1?y+=`
                    xC${C+1} = xTexelC${C};
                    `:y+=`
                    xCOffset = xC + ${R};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                      xTexelC${C+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${C+1}.zw = vec2(0.0);
                      }
                      xTexelC${C+1}Ready = 1;
                    }

                    xC${C+1} = xTexelC${C+1};
                    `}}else C<m&&(u%2===1?(y+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${C+1}Ready == 0) {
                  xTexelC${C+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${C+1}.zw = vec2(0.0);
                  }
                  xTexelC${C+1}Ready = 1;
                }

                xC${C} = vec4(xTexelC${C}.zw, xTexelC${C+1}.zw);
              `,C+1<m&&(y+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${C+1} = vec4(xTexelC${C+1}.xy, final.xy);
                `)):(y+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                  xTexelC${C+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C+1}.zw = vec2(0.);
                  }
                  xTexelC${C+1}Ready = 1;
                }

                xC${C} = vec4(
                  xTexelC${C}.xy, xTexelC${C+1}.xy);
              `,C+1<m&&(y+=`
                  xC${C+1} = vec4(xTexelC${C}.zw, xTexelC${C+1}.zw);
                `)));C<m&&(y+=`
            wTexel = getW(r, ${C}, d1, q);
            dotProd += xC${C} * vec4(wTexel.xz, wTexel.xz);
          `,C+1<m&&(y+=`
              wTexel = getW(r, ${C+1}, d1, q);
              dotProd += xC${C+1} * vec4(wTexel.xz, wTexel.xz);
            `))}y+=`
    }
  `,y+=`
      }
    `;let v="",w="";r&&(s?v=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?v=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:v=`vec4 activation(vec4 x) {
          ${r}
        }`,w="result = activation(result);");const S=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${v}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${y}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${S}
        ${w}
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function K7(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:l,pad:u,dilations:c,dimRoundingMode:h}=r;let p=c;p==null&&(p=[1,1]),T(Rn(l,p),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${p}'`);const m=kn(s.shape,i.shape,l,p,u,h,!0);let g;ae().getBool("WEBGL_PACK_DEPTHWISECONV")&&m.strideWidth<=2&&m.outChannels/m.inChannels===1?g=new cR(m):g=new uR(m);const y=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]];return t.runWebGLProgram(g,[s,i],"float32",y)}const Z7={kernelName:vh,backendName:"webgl",kernelFunc:K7};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class B7{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,r=e.strideWidth,s=e.padInfo.top,i=e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${l} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${s};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class _7{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,r=e.filterWidth,s=e.strideHeight,i=e.strideWidth,l=t-1-e.padInfo.top,u=r-1-e.padInfo.left,c=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${l}, ${u});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${c}; dm++) {
              int d2 = d1 * ${c} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function H7(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:i}=e,{strides:l,dilations:u,pad:c,dimRoundingMode:h,filterShape:p}=r,m=kn(s.shape,p,l,u,c,h,!0),g=new B7(m);return t.runWebGLProgram(g,[s,i],"float32")}const U7={kernelName:Og,backendName:"webgl",kernelFunc:H7};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function j7(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:i}=e,{strides:l,dilations:u,pad:c,dimRoundingMode:h,inputShape:p}=r,m=kn(p,i.shape,l,u,c,h,!0),g=new _7(m);return t.runWebGLProgram(g,[s,i],"float32")}const Y7={kernelName:Dg,backendName:"webgl",kernelFunc:j7};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Q7{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function J7(n){const{inputs:e,backend:t}=n,{x:r}=e,s=[...r.shape,...r.shape],i=M(r.shape),l=Ne({inputs:{x:r},backend:t,attrs:{shape:[i]}}),u=new Q7(i),c=t.runWebGLProgram(u,[l],l.dtype),h=Ne({inputs:{x:c},backend:t,attrs:{shape:s}});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(c),h}const q7={kernelName:yw,backendName:"webgl",kernelFunc:J7};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class e6{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:r,padInfo:s,strideHeight:i,strideWidth:l,filterHeight:u,filterWidth:c,dilationHeight:h,dilationWidth:p}=e,{top:m,left:g}=s;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${l});
      const ivec2 pads = ivec2(${m}, ${g});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${u}; h++) {
          int hIn = hBeg + h * ${h};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${c}; w++) {
              int wIn = wBeg + w * ${p};

              if (wIn >= 0 && wIn < ${r}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function t6(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i}=e,{strides:l,pad:u,dilations:c}=r,h=hc(s.shape,i.shape,l,u,"NHWC",c);let p;const m=new e6(h);p=t.runWebGLProgram(m,[s,i],"float32");const g=Ne({inputs:{x:p},backend:t,attrs:{shape:h.outShape}});return t.disposeIntermediateTensorInfo(p),g}const n6={kernelName:wh,backendName:"webgl",kernelFunc:t6};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function r6(n){const{inputs:e,backend:t,attrs:r}=n,{equation:s}=r,i=e,{allDims:l,summedDims:u,idDims:c}=$b(s,i.length);Vb(l.length,c,i);const{path:h,steps:p}=Pb(u,c),m=p.length;let g=null,y=l.length;const v=[];for(let w=0;w<m;++w){for(const S of p[w]){const{permutationIndices:I,expandDims:C}=Fb(y,c[S]);let R;Xb(I)?R=i[S]:(R=Kn({inputs:{x:i[S]},backend:t,attrs:{perm:I}}),v.push(R));const L=R.shape.slice();for(let G=0;G<C.length;++G)L.splice(C[G],0,1);B(R.shape,L)||(R=Ne({inputs:{x:R},backend:t,attrs:{shape:L}}),v.push(R)),g===null?g=R:(g=Qy({inputs:{a:R,b:g},backend:t}),v.push(g))}w<m-1&&(h[w]>=0&&(g=bf({inputs:{x:g},backend:t,attrs:{axis:h[w]-(l.length-y),keepDims:!1}}),v.push(g)),y--)}for(const w of v)w!==g&&t.disposeIntermediateTensorInfo(w);return g}const s6={kernelName:Zg,backendName:"webgl",kernelFunc:r6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const a6=it({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`}),i6={kernelName:Su,backendName:"webgl",kernelFunc:a6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const o6="return (b >= 0.0) ? a : a * (b + 1.0);",l6=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,u6={kernelName:Bg,backendName:"webgl",kernelFunc:n=>{const{inputs:e,backend:t}=n,{dy:r,y:s}=e,i=ae().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new kl(l6,r.shape,s.shape):new bo(o6,r.shape,s.shape);return t.runWebGLProgram(i,[r,s],r.dtype)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const c6=Cn({opSnippet:"return float(a == b);",packedOpSnippet:`
  return vec4(equal(a, b));
`,dtype:"bool",cpuKernelImpl:JU}),d6={kernelName:kh,backendName:"webgl",kernelFunc:c6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const h6=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${Nb};
  float a1 = ${Rb};
  float a2 = ${Eb};
  float a3 = ${Lb};
  float a4 = ${Gb};
  float a5 = ${zb};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,p6=it({opSnippet:h6}),f6={kernelName:Cu,backendName:"webgl",kernelFunc:p6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const m6=Il+`
  return exp(x);
`,dR=it({opSnippet:m6,packedOpSnippet:`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cpuKernelImpl:qU,dtype:"float32"}),g6={kernelName:Tu,backendName:"webgl",kernelFunc:dR};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tx(n){const{inputs:e,attrs:t,backend:r}=n,{dim:s}=t,{input:i}=e,l=i.shape.length,u=i.shape.slice();let c=s;return s<0&&(T(-(l+1)<=s,()=>`Axis must be in the interval [${-(l+1)}, ${l}]`),c=l+s+1),u.splice(c,0,1),Ne({inputs:{x:i},backend:r,attrs:{shape:u}})}const b6={kernelName:Ih,backendName:"webgl",kernelFunc:tx};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const hR="return exp(x) - 1.0;",y6=it({opSnippet:hR,packedOpSnippet:hR,cpuKernelImpl:ej}),x6={kernelName:Nu,backendName:"webgl",kernelFunc:y6};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class pR{constructor(e,t,r){this.variableNames=["real","imag"];const s=t[1];this.outputShape=t;const i=r?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,l=r?`${s}.0`:"1.0";let u;if(e==="real")u="return real * expR - imag * expI;";else if(e==="imag")u="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${u}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${s});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${s}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${l};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function fR(n,e,t){const r=t.texData.get(n.dataId),s=M(n.shape),i=n.shape[n.shape.length-1],l=s/i,u=Ne({inputs:{x:n},backend:t,attrs:{shape:[l,i]}}),c=u.shape,h=new pR("real",c,e),p=new pR("imag",c,e),m=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:c},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:c}],g=t.runWebGLProgram(h,m,"float32"),y=t.runWebGLProgram(p,m,"float32"),v=li({inputs:{real:g,imag:y},backend:t});t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y);const w=Ne({inputs:{x:v},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(v),w}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function v6(n){const{inputs:e,backend:t}=n,{input:r}=e;return fR(r,!1,t)}const w6={kernelName:_g,backendName:"webgl",kernelFunc:v6};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class k6{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ed(n){const{backend:e,attrs:t}=n,{shape:r,value:s}=t;let{dtype:i}=t;if(i=i||Ir(s),i==="string"){const l=be(i,M(r));return l.fill(s),e.makeTensorInfo(r,i,l)}else{const l=new k6(r,s),u=[[s]];return e.runWebGLProgram(l,[],i,u)}}const I6={kernelName:Hg,backendName:"webgl",kernelFunc:ed};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class S6{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const C6={kernelName:Ug,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,r=e,s=new S6(t.shape);return r.runWebGLProgram(s,[t],t.dtype)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const mR="return floor(x);",T6=it({opSnippet:mR,packedOpSnippet:mR,cpuKernelImpl:tj}),N6={kernelName:Ru,backendName:"webgl",kernelFunc:T6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const R6=Cn({opSnippet:`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,packedOpSnippet:`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,dtype:"int32"}),E6={kernelName:Eu,backendName:"webgl",kernelFunc:R6};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class L6{constructor(e){this.variableNames=["A"];const t=Dn(),[r,s]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}.0, ${r}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class G6{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=Dn(),[r,s]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${s}.0, ${r}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const z6={kernelName:p0,backendName:"webgl",kernelFunc:W6};let Cl,nx=ae().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function W6(n){const{inputs:e,backend:t,attrs:r}=n;let{pixels:s}=e;const{numChannels:i}=r,l=typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement,u=typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement,[c,h]=l?[s.videoWidth,s.videoHeight]:[s.width,s.height],p=[h,c],m=[h,c,i];if(u||l){const w=ae().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Cl==null||w!==nx)&&(nx=w,Cl=document.createElement("canvas").getContext("2d",{willReadFrequently:nx})),Cl.canvas.width=c,Cl.canvas.height=h,Cl.drawImage(s,0,0,c,h),s=Cl.canvas}const g=t.makeTensorInfo(p,"int32");t.texData.get(g.dataId).usage=zr.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(g.dataId),s);const y=ae().getBool("WEBGL_PACK")?new G6(m):new L6(m),v=t.runWebGLProgram(y,[g],"int32");return t.disposeData(g.dataId),v}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function M6(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i,bias:l,preluActivationWeights:u}=e,{strides:c,pad:h,dataFormat:p,dilations:m,dimRoundingMode:g,activation:y,leakyreluAlpha:v}=r,w=pa(p),S=kn(s.shape,i.shape,c,m,h,g,!1,w);let I;const C=[],R=l!=null,L=u!=null,G=y==="leakyrelu",$=()=>{const V=[s,i],D=(Z,ne)=>{if(ne==="NCHW"&&Z.shape.length===1&&Z.shape[0]!==1){const re=Ne({inputs:{x:Z},backend:t,attrs:{shape:[Z.shape[0],1,1]}});return C.push(re),re}return Z};if(R&&V.push(D(l,p)),L&&V.push(D(u,p)),G){const Z=t.makeTensorInfo([],"float32",Oa(v,"float32"));V.push(Z),C.push(Z)}return V};if(S.filterHeight===1&&S.filterWidth===1&&S.dilationHeight===1&&S.dilationWidth===1&&S.strideHeight===1&&S.strideWidth===1&&(S.padInfo.type==="SAME"||S.padInfo.type==="VALID"))I=rR({x:s,filter:i,convInfo:S,backend:t,bias:l,activation:y,preluActivationWeights:u,leakyreluAlpha:v});else if(S.strideWidth<=2&&w==="channelsLast"&&ae().getBool("WEBGL_EXP_CONV")){const V=y?jc(y,!0):null,D=new nR(S,R,V,L,G),Z=[[S.padInfo.top,S.padInfo.left],[S.strideHeight,S.strideWidth],[S.dilationHeight,S.dilationWidth],[S.inHeight,S.inWidth]],ne=$();I=t.runWebGLProgram(D,ne,"float32",Z)}else if(ae().getBool("WEBGL_CONV_IM2COL"))I=sR({x:s,filter:i,convInfo:S,backend:t,bias:l,activation:y,preluActivationWeights:u,leakyreluAlpha:v});else{const V=y?jc(y,!1):null,D=new tR(S,R,V,L,G),Z=$();I=t.runWebGLProgram(D,Z,"float32")}const F=Ne({inputs:{x:I},backend:t,attrs:{shape:S.outShape}});return C.push(I),C.forEach(V=>t.disposeIntermediateTensorInfo(V)),F}const $6={kernelName:lp,backendName:"webgl",kernelFunc:M6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function F6(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:i,bias:l,preluActivationWeights:u}=e,{strides:c,pad:h,dilations:p,dimRoundingMode:m,activation:g,leakyreluAlpha:y}=r,v=[];let w=p;w==null&&(w=[1,1]),T(Rn(c,w),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${c} and dilations '${w}'`);const S=kn(s.shape,i.shape,c,w,h,m,!0),I=ae().getBool("WEBGL_PACK_DEPTHWISECONV")&&S.strideWidth<=2&&S.outChannels/S.inChannels===1,C=g?jc(g,I):null,R=[s,i],L=l!=null,G=u!=null,$=g==="leakyrelu";if(L&&R.push(l),G&&R.push(u),$){const Z=t.makeTensorInfo([],"float32",Oa(y,"float32"));R.push(Z),v.push(Z)}let F;I?F=new cR(S,L,C,G,$):F=new uR(S,L,C,G,$);const V=[[S.padInfo.top,S.padInfo.left],[S.strideHeight,S.strideWidth],[S.dilationHeight,S.dilationWidth],[S.inHeight,S.inWidth]],D=t.runWebGLProgram(F,R,"float32",V);return v.forEach(Z=>t.disposeIntermediateTensorInfo(Z)),D}const V6={kernelName:Vw,backendName:"webgl",kernelFunc:F6};class P6{constructor(e,t,r,s){this.sliceDim=e,this.strides=t,this.paramsShape=s,this.variableNames=["x","indices"],this.outputShape=r;const i=gt(r.length);let l=`
    int index;`;for(let u=0;u<this.sliceDim;u++)l+=`
          index = round(getIndices(coords[0], ${u}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[u]};
          flattenIndex += index * ${this.strides[u]};`;this.userCode=`
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${l}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function X6(n){const{inputs:e,backend:t}=n,{params:r,indices:s}=e,i=s.shape,l=i[i.length-1],u=M(r.shape),[c,h,p,m]=mb(r,s),g=Ne({inputs:{x:s},backend:t,attrs:{shape:[h,l]}}),y=Ne({inputs:{x:r},backend:t,attrs:{shape:[M(r.shape)/p,p]}});if(t.shouldExecuteOnCPU([r,s])||r.dtype==="string"){const I=t.readSync(s.dataId),C=t.bufferSync(r),R=nj(I,C,r.dtype,h,l,p,m,r.shape,u);return t.makeTensorInfo(c,r.dtype,R.values)}const v=new P6(l,m,[h,p],r.shape),w=t.runWebGLProgram(v,[y,g],y.dtype),S=Ne({inputs:{x:w},backend:t,attrs:{shape:c}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(w),S}const O6={kernelName:xw,backendName:"webgl",kernelFunc:X6};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class D6{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const r=gt(this.rank),s=A6(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${s}));
      }
    `}}function A6(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let s=0;s<n.length;s++)s===2?r.push("index"):r.push(`${t[s]}`);return r.join()}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function gR(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,indices:i}=e,{axis:l,batchDims:u}=r,c=oe(l,s.shape)[0];if(ae().get("DEBUG")){const C=t.readSync(i.dataId),R=s.shape[c];for(let L=0;L<C.length;++L){const G=C[L];T(G<=R-1&&G>=0,()=>`GatherV2: the index value ${G} is not in [0, ${R-1}]`)}}const h=Ab(s,i,c,u),p=M(i.shape),m=[],g=Ne({inputs:{x:s},backend:t,attrs:{shape:[h.batchSize,h.outerSize,h.dimSize,h.sliceSize]}}),y=Ne({inputs:{x:i},backend:t,attrs:{shape:[h.batchSize,p/h.batchSize]}});m.push(g),m.push(y);const v=[h.batchSize,h.outerSize,p/h.batchSize,h.sliceSize];if(t.shouldExecuteOnCPU([s,i])||s.dtype==="string"){const C=t.bufferSync(y),R=t.bufferSync(g),L=rj(R,C,v);return m.forEach(G=>t.disposeIntermediateTensorInfo(G)),t.makeTensorInfo(h.outputShape,L.dtype,L.values)}const w=new D6(g.shape,v),S=t.runWebGLProgram(w,[g,y],g.dtype);m.push(S);const I=Ne({inputs:{x:S},backend:t,attrs:{shape:h.outputShape}});return m.forEach(C=>t.disposeIntermediateTensorInfo(C)),I}const K6={kernelName:Ch,backendName:"webgl",kernelFunc:gR};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Z6=Cn({opSnippet:"return float(a > b);",packedOpSnippet:`
  return vec4(greaterThan(a, b));
`,cpuKernelImpl:sj,dtype:"bool"}),B6={kernelName:Th,backendName:"webgl",kernelFunc:Z6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const _6=Cn({opSnippet:"return float(a >= b);",packedOpSnippet:`
  return vec4(greaterThanEqual(a, b));
`,dtype:"bool",cpuKernelImpl:aj}),H6={kernelName:Lu,backendName:"webgl",kernelFunc:_6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function U6(n){const{inputs:e,backend:t}=n,{input:r}=e;return fR(r,!0,t)}const j6={kernelName:jg,backendName:"webgl",kernelFunc:U6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Y6=it({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),Q6={kernelName:zu,backendName:"webgl",kernelFunc:Y6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const J6=it({opSnippet:"return float(isinf(x));",dtype:"bool"}),q6={kernelName:Wu,backendName:"webgl",kernelFunc:J6};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const eJ=it({opSnippet:"return float(isnan(x));",dtype:"bool"}),tJ={kernelName:Mu,backendName:"webgl",kernelFunc:eJ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const nJ=Cn({opSnippet:"return float(a < b);",packedOpSnippet:`
  return vec4(lessThan(a, b));
`,cpuKernelImpl:ij,dtype:"bool"}),rJ={kernelName:Rh,backendName:"webgl",kernelFunc:nJ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const sJ=Cn({opSnippet:"return float(a <= b);",packedOpSnippet:`
  return vec4(lessThanEqual(a, b));
`,cpuKernelImpl:oj,dtype:"bool"}),aJ={kernelName:Eh,backendName:"webgl",kernelFunc:sJ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function iJ(n){const{backend:e,attrs:t}=n,{start:r,stop:s,num:i}=t,l=lj(r,s,i);return e.makeTensorInfo([l.length],"float32",l)}const oJ={kernelName:vw,backendName:"webgl",kernelFunc:iJ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const lJ=Il+`
  return x < 0.0 ? 0./0. : log(x);
`,uJ=it({opSnippet:lJ,packedOpSnippet:`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,cpuKernelImpl:uj}),cJ={kernelName:$u,backendName:"webgl",kernelFunc:uJ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const dJ=Il+`
  return log(1.0 + x);
`,hJ=it({opSnippet:dJ}),pJ={kernelName:Fu,backendName:"webgl",kernelFunc:hJ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const fJ=Cn({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,dtype:"bool"}),mJ={kernelName:Lh,backendName:"webgl",kernelFunc:fJ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const gJ=it({opSnippet:"return float(!(x >= 1.0));"}),bJ={kernelName:Gh,backendName:"webgl",kernelFunc:gJ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const yJ=Cn({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,dtype:"bool"}),xJ={kernelName:zh,backendName:"webgl",kernelFunc:yJ};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class vJ{constructor(e,t,r,s,i){this.variableNames=["x"],this.outputShape=[];const l=t,u=e[3]-1;this.outputShape=e;let c;const h=`float(${r}) + float(${s}) * sum`;i===.5?c=`inversesqrt(${h})`:i===1?c=`1.0/(${h})`:c=`exp(log(${h}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${l}; j <= ${l}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${u}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${c};
        setOutput(val);
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class wJ{constructor(e,t,r,s,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const l=t,u=e[3]-1;this.outputShape=e;let c;const h=`float(${r}) + float(${s}) * sum`;i===.5?c=`inversesqrt(${h})`:i===1?c=`1.0/(${h})`:c=`exp(log(${h}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${l};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${l}; j <= ${l}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${u}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${c};
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const kJ={kernelName:Wh,backendName:"webgl",kernelFunc:n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{depthRadius:i,bias:l,alpha:u,beta:c}=r,h=ae().getBool("WEBGL_PACK_NORMALIZATION")?new wJ(s.shape,i,l,u,c):new vJ(s.shape,i,l,u,c);return t.runWebGLProgram(h,[s],s.dtype)}};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class IJ{constructor(e,t,r,s,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=r,this.alpha=s,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${s}) * norm + float(${r});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${s})
                * float(${i})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const SJ={kernelName:Qg,backendName:"webgl",kernelFunc:n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s,y:i,dy:l}=e,{depthRadius:u,bias:c,alpha:h,beta:p}=r,m=new IJ(s.shape,u,c,h,p);return t.runWebGLProgram(m,[s,i,l],s.dtype)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function CJ(n,e,t,r){const s=M(e),i=M(n.shape)/s,l=Ne({inputs:{x:n},attrs:{shape:[i,s]},backend:r}),u=xo(l,n.dtype,"max",r),c=Ne({inputs:{x:u},attrs:{shape:t},backend:r});return r.disposeIntermediateTensorInfo(l),r.disposeIntermediateTensorInfo(u),c}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function bR(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{reductionIndices:i,keepDims:l}=r,u=s.shape.length,c=oe(i,s.shape);let h=c;const p=Xt(h,u),m=p!=null,g=t.shouldExecuteOnCPU([s]);let y=s;if(m){if(g){const C=t.texData.get(y.dataId).values,R=new Array(u);for(let $=0;$<R.length;$++)R[$]=s.shape[p[$]];const L=Uy(C,s.shape,s.dtype,p,R);y=t.makeTensorInfo(R,s.dtype);const G=t.texData.get(y.dataId);G.values=L}else y=gf(s,p,t);h=Yt(h.length,u)}In("max",h,u);const[v,w]=mn(y.shape,h);let S=v;l&&(S=nn(v,c));let I;if(g){const C=t.texData.get(y.dataId).values,R=cj(C,M(w),S,s.dtype);I=t.makeTensorInfo(S,s.dtype);const L=t.texData.get(I.dataId);L.values=R}else I=CJ(y,w,S,t);return m&&t.disposeIntermediateTensorInfo(y),I}const TJ={kernelName:Mh,backendName:"webgl",kernelFunc:bR};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const NJ=Yy+`
  return max(a, b);
`,RJ=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+yo+`
  return result;
`,EJ=Cn({opSnippet:NJ,packedOpSnippet:RJ,cpuKernelImpl:dj}),LJ={kernelName:Vu,backendName:"webgl",kernelFunc:EJ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function GJ(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;Hc(s,"maxPool");const{filterSize:i,strides:l,pad:u,dimRoundingMode:c}=r,h=1;T(Rn(l,h),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${l} and dilations '${h}'`);const p=_r(s.shape,i,l,h,u,c);if(p.filterWidth===1&&p.filterHeight===1&&B(p.inShape,p.outShape))return mr({inputs:{x:s},backend:t});const m=new Yc(p,"max",!1);return t.runWebGLProgram(m,[s],s.dtype)}const zJ={kernelName:$h,backendName:"webgl",kernelFunc:GJ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function WJ(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{filterSize:i,strides:l,pad:u,dataFormat:c,dimRoundingMode:h}=r,p=[1,1,1],m=ha(s.shape,i,l,p,u,h,c),g=new Jy(m,"max",!1);return t.runWebGLProgram(g,[s],s.dtype)}const MJ={kernelName:Fh,backendName:"webgl",kernelFunc:WJ};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class $J{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,r=e.strideWidth,s=e.dilationHeight,i=e.effectiveFilterHeight,l=e.effectiveFilterWidth,u=i-1-e.padInfo.top,c=l-1-e.padInfo.left,h=i*l-1;this.userCode=`
      const ivec2 pads = ivec2(${u}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${s}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${l}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${h} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${l} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class FJ{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,r=e.strideHeight,s=e.strideWidth,i=e.dilationDepth,l=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterDepth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,m=c-1-e.padInfo.front,g=h-1-e.padInfo.top,y=p-1-e.padInfo.left,v=c*h*p-1;this.userCode=`
      const ivec3 pads = ivec3(${m}, ${g}, ${y});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${c};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${h};
              wR += ${l}) {
            float dyR = float(dyRCorner + wR) / ${r}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${p};
                wC += ${u}) {
              float dyC = float(dyCCorner + wC) / ${s}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${v} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${h} * ${p} +
                  wR * ${p} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function VJ(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i}=e,l=i,{filterSize:u,strides:c,pad:h,dimRoundingMode:p}=r,m=[1,1,1],g=ha(l.shape,u,c,m,h,p),y=new Jy(g,"max",!0),v=t.runWebGLProgram(y,[l],l.dtype),w=new FJ(g),S=t.runWebGLProgram(w,[s,v],l.dtype);return t.disposeIntermediateTensorInfo(v),S}const PJ={kernelName:qg,backendName:"webgl",kernelFunc:VJ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function XJ(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:i,output:l}=e,u=i;Hc([i,l],"maxPoolGrad");const{filterSize:c,strides:h,pad:p,dimRoundingMode:m}=r,g=_r(u.shape,c,h,1,p,m),y=!0,v=new Yc(g,"max",y),w=t.runWebGLProgram(v,[u],u.dtype),S=new $J(g),I=t.runWebGLProgram(S,[s,w],u.dtype);return t.disposeIntermediateTensorInfo(w),I}const OJ={kernelName:Jg,backendName:"webgl",kernelFunc:XJ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function DJ(n,e,t,r){let s=new Yc(t,"max",!1);const i=r.runWebGLProgram(s,[n],"float32");s=new Yc(t,"max",!0,!0,e);const l=r.runWebGLProgram(s,[n],"float32");return[i,l]}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const AJ={kernelName:ww,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:r}=n,{filterSize:s,strides:i,pad:l,includeBatchInIndex:u}=e,c=t;T(r.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);const h=[1,1];T(Rn(i,h),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${h}'`);const p=_r(r.shape,s,i,h,l),[m,g]=DJ(r,u,p,c);return[m,g]}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function KJ(n,e,t,r){const s=M(e),i=M(n.shape)/s,l=Ne({inputs:{x:n},attrs:{shape:[i,s]},backend:r}),u=xo(l,"float32","mean",r),c=Ne({inputs:{x:u},attrs:{shape:t},backend:r});return r.disposeIntermediateTensorInfo(l),r.disposeIntermediateTensorInfo(u),c}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ZJ={kernelName:Vh,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:r}=n,{keepDims:s,axis:i}=e,l=t,u=r.shape.length,c=oe(i,r.shape);let h=c;const p=Xt(h,u),m=p!=null,g=l.shouldExecuteOnCPU([r]),y=[];let v=r;if(m){if(g){const R=l.texData.get(v.dataId).values,L=new Array(u);for(let F=0;F<L.length;F++)L[F]=r.shape[p[F]];const G=Uy(R,r.shape,r.dtype,p,L);v=l.makeTensorInfo(L,r.dtype);const $=l.texData.get(v.dataId);$.values=G}else v=gf(r,p,l);y.push(v),h=Yt(h.length,u)}In("sum",h,u);const[w,S]=mn(v.shape,h);let I=w;s&&(I=nn(w,c));const C=KJ(v,S,I,l);for(const R of y)l.disposeIntermediateTensorInfo(R);return C}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function BJ(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:l}=r,u=s.shape.length,c=oe(i,s.shape);let h=c;const p=Xt(h,u);let m=s;p!=null&&(m=Kn({inputs:{x:s},backend:t,attrs:{perm:p}}),h=Yt(h.length,s.shape.length)),In("min",h,u);const[g,y]=mn(m.shape,h),v=M(y),w=Ne({inputs:{x:m},backend:t,attrs:{shape:[-1,v]}}),S=xo(w,w.dtype,"min",t);let I;if(l){const C=nn(g,c);I=Ne({inputs:{x:S},backend:t,attrs:{shape:C}})}else I=Ne({inputs:{x:S},backend:t,attrs:{shape:g}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(S),p!=null&&t.disposeIntermediateTensorInfo(m),I}const _J={kernelName:Ph,backendName:"webgl",kernelFunc:BJ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const HJ=Yy+`
  return min(a, b);
`,UJ=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+yo+`
  return result;
`,jJ=Cn({opSnippet:HJ,packedOpSnippet:UJ,cpuKernelImpl:hj}),YJ={kernelName:Pu,backendName:"webgl",kernelFunc:jJ};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class QJ{constructor(e,t,r){this.variableNames=["x"],this.outputShape=t.map((p,m)=>p[0]+e[m]+p[1]);const s=e.length,i=gt(s),l=t.map(p=>p[0]).join(","),u=t.map((p,m)=>p[0]+e[m]).join(","),c=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,s),h=r==="reflect"?0:1;if(s===1){this.userCode=`
        int start = ${l};
        int end = ${u};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${h};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${h};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${l});
      ${i} end = ${i}(${u});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${s}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${h};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${h};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${c}));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class JJ{constructor(e,t,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((v,w)=>v[0]+e[w]+v[1]);const s=e.length,i=gt(s),l=t.map(v=>v[0]).join(","),u=t.map((v,w)=>v[0]+e[w]).join(","),c=An("rc",s),h=An("source",s),p=`${c[s-1]} < ${this.outputShape[s-1]}`,m=s===1?"source":`vec2(${h.slice(-2).join()})`,g=r==="reflect"?0:1;let y="";if(s===1){const v=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${g};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${g};
        }
        source -= start;
      `;y=`
        ${i} rc = outputLoc;
        ${v}
        result[0] = getChannel(getX(${h.join()}), ${m});
        ${c[s-1]} += 1;
        if(${p}) {
          ${v}
          result[1] = getChannel(getX(${h.join()}), ${m});
        }
      `}else{const v=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${g}) +
                gte * ((end - 1) * 2 - source + ${g});
        source -= start;
      `;y=`
        ${i} rc = outputLoc;
        ${v}
        result[0] = getChannel(getX(${h.join()}), ${m});
        ${c[s-1]} += 1;
        if(${p}) {
          ${v}
          result[1] = getChannel(getX(${h.join()}), ${m});
        }
        rc = outputLoc;
        ${c[s-2]} += 1;
        if(${c[s-2]} < ${this.outputShape[s-2]}) {
          ${v}
          result[2] = getChannel(getX(${h.join()}), ${m});
          ${c[s-1]} += 1;
          if(${p}) {
            ${v}
            result[3] = getChannel(getX(${h.join()}), ${m});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${l});
      const ${i} end = ${i}(${u});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${y}
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const qJ={kernelName:Xh,backendName:"webgl",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:r}=n,{paddings:s,mode:i}=t,l=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new JJ(r.shape,s,i):new QJ(r.shape,s,i);return e.runWebGLProgram(l,[r],r.dtype)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const e8=`if (b == 0.0) return NAN;
  return mod(a, b);`,t8=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+yo+`
  return result;
`,n8=Cn({opSnippet:e8,packedOpSnippet:t8}),r8={kernelName:Xu,backendName:"webgl",kernelFunc:n8};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class s8{constructor(e,t,r){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,r],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const yR=Cn({opSnippet:`
if (a == b) {
  return 1.0;
};
return a / b;`,packedOpSnippet:`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,checkOutOfBounds:!0}),a8={kernelName:Iu,backendName:"webgl",kernelFunc:yR};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const xR="return a - b;",vR=Cn({opSnippet:xR,packedOpSnippet:xR,supportsComplex:!0,cpuKernelImpl:Wj}),i8={kernelName:tc,backendName:"webgl",kernelFunc:vR};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function wR(n){const{inputs:e,backend:t,attrs:r}=n,{logits:s}=e,{dim:i}=r,l=oe([i],s.shape),u=bR({inputs:{x:s},backend:t,attrs:{reductionIndices:l,keepDims:!1}}),c=nn(u.shape,l),h=Ne({inputs:{x:u},backend:t,attrs:{shape:c}}),p=vR({inputs:{a:s,b:h},backend:t}),m=dR({inputs:{x:p},backend:t}),g=bf({inputs:{x:m},backend:t,attrs:{axis:l,keepDims:!1}}),y=Ne({inputs:{x:g},backend:t,attrs:{shape:c}}),v=yR({inputs:{a:m,b:y},backend:t});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),v}const o8={kernelName:rp,backendName:"webgl",kernelFunc:wR};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function l8(n){const{inputs:e,backend:t,attrs:r}=n,{logits:s}=e,{numSamples:i,seed:l,normalized:u}=r,c=u?s:wR({inputs:{logits:s},backend:t,attrs:{dim:s.shape.length-1}}),h=c.shape[0],p=c.shape[1],m=new s8(h,p,i),g=[[l]],y=t.runWebGLProgram(m,[c],"int32",g);return u||t.disposeIntermediateTensorInfo(c),y}const u8={kernelName:kw,backendName:"webgl",kernelFunc:l8};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const c8=ts+`
  return -x;
`,d8=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function h8(n){const{inputs:e,backend:t}=n,{x:r}=e;if(t.shouldExecuteOnCPU([r])){const i=t.texData.get(r.dataId),[l,u]=fj(i.values,r.shape,r.dtype);return t.makeTensorInfo(u,r.dtype,l)}let s;return ae().getBool("WEBGL_PACK_UNARY_OPERATIONS")?s=new oi(r.shape,d8):s=new Ys(r.shape,c8),t.runWebGLProgram(s,[r],r.dtype)}const p8={kernelName:Oh,backendName:"webgl",kernelFunc:h8};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const f8=cb;function m8(n){Sr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:i}=e,{maxOutputSize:l,iouThreshold:u,scoreThreshold:c}=r,h=t.readSync(s.dataId),p=t.readSync(i.dataId),{selectedIndices:m}=f8(h,p,l,u,c);return t.makeTensorInfo([m.length],"int32",new Int32Array(m))}const g8={kernelName:e0,backendName:"webgl",kernelFunc:m8};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const b8=db;function y8(n){Sr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:i}=e,{maxOutputSize:l,iouThreshold:u,scoreThreshold:c,padToMaxOutputSize:h}=r,p=t.readSync(s.dataId),m=t.readSync(i.dataId),{selectedIndices:g,validOutputs:y}=b8(p,m,l,u,c,h);return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([],"int32",new Int32Array([y]))]}const x8={kernelName:t0,backendName:"webgl",kernelFunc:y8};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const v8=hb;function w8(n){Sr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:i}=e,{maxOutputSize:l,iouThreshold:u,scoreThreshold:c,softNmsSigma:h}=r,p=t.readSync(s.dataId),m=t.readSync(i.dataId),g=l,y=u,v=c,w=h,{selectedIndices:S,selectedScores:I}=v8(p,m,g,y,v,w);return[t.makeTensorInfo([S.length],"int32",new Int32Array(S)),t.makeTensorInfo([I.length],"float32",new Float32Array(I))]}const k8={kernelName:n0,backendName:"webgl",kernelFunc:w8};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class I8{constructor(e,t,r,s){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${s}), float(${r}),
                      float(index == coords.y)));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const S8={kernelName:Kh,backendName:"webgl",kernelFunc:n=>{const{inputs:e,backend:t,attrs:r}=n,{indices:s}=e,{dtype:i,depth:l,onValue:u,offValue:c}=r,h=M(s.shape),p=new I8(h,l,u,c),m=Ne({inputs:{x:s},backend:t,attrs:{shape:[h]}}),g=t.runWebGLProgram(p,[m],i);t.disposeIntermediateTensorInfo(m);const y=[...s.shape,l],v=Ne({inputs:{x:g},backend:t,attrs:{shape:y}});return t.disposeIntermediateTensorInfo(g),v}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function If(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="complex64"){const s=Qc({inputs:{input:r},backend:t}),i=If({inputs:{x:s},backend:t}),l=wf({inputs:{input:r},backend:t}),u=If({inputs:{x:l},backend:t}),c=li({inputs:{real:i,imag:u},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(u),c}else return ed({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:t})}const C8={kernelName:ip,backendName:"webgl",kernelFunc:If};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function kR(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){const s=Qc({inputs:{input:r},backend:t}),i=kR({inputs:{x:s},backend:t}),l=wf({inputs:{input:r},backend:t}),u=If({inputs:{x:l},backend:t}),c=li({inputs:{real:i,imag:u},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(u),c}else return ed({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:t})}const T8={kernelName:Ah,backendName:"webgl",kernelFunc:kR};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function N8(n){const{inputs:e,backend:t,attrs:r}=n,{axis:s}=r;if(e.length===1)return tx({inputs:{input:e[0]},backend:t,attrs:{dim:s}});const i=e[0].shape,l=e[0].dtype;e.forEach(p=>{A(i,p.shape,"All tensors passed to stack must have matching shapes"),T(l===p.dtype,()=>"All tensors passed to stack must have matching dtypes")});const u=[],c=e.map(p=>{const m=tx({inputs:{input:p},backend:t,attrs:{dim:s}});return u.push(m),m}),h=eR({inputs:c,backend:t,attrs:{axis:s}});return u.forEach(p=>t.disposeIntermediateTensorInfo(p)),h}const R8={kernelName:Zh,backendName:"webgl",kernelFunc:N8};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class E8{constructor(e,t,r){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((h,p)=>h[0]+e[p]+h[1]);const s=e.length,i=gt(s),l=t.map(h=>h[0]).join(","),u=t.map((h,p)=>h[0]+e[p]).join(","),c=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,s);if(s===1){this.userCode=`
        int start = ${l};
        int end = ${u};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${l});
      ${i} end = ${i}(${u});

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${c}));
        }
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class L8{constructor(e,t,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((w,S)=>w[0]+e[S]+w[1]);const s=e.length,i=gt(s),l=t.map(w=>w[0]).join(","),u=t.map((w,S)=>w[0]+e[S]).join(","),c=An("rc",s),h=An("source",s),p=`${c[s-1]} < ${this.outputShape[s-1]}`,m=s===1?"source":`vec2(${h.slice(-2).join()})`,g=[`${i} rc = outputLoc;`,`${c[s-1]} += 1;
       if(${p}) {
      `,s===1?"":`}
       rc = outputLoc;
       ${c[s-2]} += 1;
       if(${c[s-2]} < ${this.outputShape[s-2]}) {`,s===1?"":`  ${c[s-1]} += 1;
         if(${p}) {`],y=s===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let v="";for(let w=0,S=s===1?2:4;w<S;w++)v+=`
        ${g[w]}
        if (${y}) {
          result[${w}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${w}] = getChannel(getX(${h.join()}), ${m});
        }
      `;v+=s===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${l});
      const ${i} end = ${i}(${u});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${v}
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const IR=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{paddings:i,constantValue:l}=r;if(M(s.shape)===0){const h=i.map((p,m)=>p[0]+s.shape[m]+p[1]);return ed({backend:t,attrs:{shape:h,value:l,dtype:s.dtype}})}const u=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new L8(s.shape,i,l):new E8(s.shape,i,l),c=[[l]];return t.runWebGLProgram(u,[s],s.dtype,c)},G8={kernelName:Bh,backendName:"webgl",kernelFunc:IR};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const z8=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,W8=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+yo+`
  return result;
`,M8=Cn({opSnippet:z8,packedOpSnippet:W8}),$8={kernelName:Du,backendName:"webgl",kernelFunc:M8};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function F8(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:i,keepDims:l}=r,u=s.shape.length,c=[],h=oe(i,s.shape);let p=h;const m=Xt(p,u);let g=s;m!=null&&(g=Kn({inputs:{x:s},backend:t,attrs:{perm:m}}),p=Yt(p.length,u),c.push(g)),In("prod",p,u);let y;if(t.shouldExecuteOnCPU([g])){const v=t.texData.get(g.dataId).values,{outVals:w,outShape:S,outDtype:I}=gj(g.shape,g.dtype,v,p);y=t.makeTensorInfo(S,I,w)}else{const[v,w]=mn(g.shape,p),S=M(w),I=Ne({inputs:{x:g},backend:t,attrs:{shape:[-1,S]}}),C=C0(s.dtype),R=xo(I,C,"prod",t);y=Ne({inputs:{x:R},backend:t,attrs:{shape:v}}),c.push(I),c.push(R)}if(l){c.push(y);const v=nn(y.shape,h);y=Ne({inputs:{x:y},backend:t,attrs:{shape:v}})}return c.forEach(v=>t.disposeIntermediateTensorInfo(v)),y}const V8={kernelName:Hh,backendName:"webgl",kernelFunc:F8};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function P8(n){const{inputs:e,backend:t,attrs:r}=n,{paramsNestedSplits:s,paramsDenseValues:i,indices:l}=e,{outputRaggedRank:u}=r,c=s.map(I=>t.readSync(I.dataId)),h=s.map(I=>I.shape),p=t.readSync(i.dataId),m=t.readSync(l.dataId),[g,y,v]=bj(c,h,p,i.shape,i.dtype,m,l.shape,u),w=g.map(I=>t.makeTensorInfo([I.length],"int32",I)),S=t.makeTensorInfo(v,i.dtype,y);return w.concat([S])}const X8={kernelName:Iw,backendName:"webgl",kernelFunc:P8};/**
* @license
* Copyright 2022 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function O8(n){const{inputs:e,backend:t}=n,{starts:r,limits:s,deltas:i}=e,l=t.readSync(r.dataId),u=t.readSync(s.dataId),c=t.readSync(i.dataId),[h,p]=yj(l,r.shape,r.dtype,u,s.shape,c,i.shape),m=t.makeTensorInfo([h.length],"int32",h),g=t.makeTensorInfo([p.length],r.dtype,p);return[m,g]}const D8={kernelName:Sw,backendName:"webgl",kernelFunc:O8};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function A8(n){const{inputs:e,backend:t,attrs:r}=n,{shape:s,values:i,defaultValue:l,rowPartitionTensors:u}=e,{rowPartitionTypes:c}=r,h=t.readSync(s.dataId),p=t.readSync(i.dataId),m=t.readSync(l.dataId),g=u.map(S=>t.readSync(S.dataId)),y=u.map(S=>S.shape),[v,w]=xj(h,s.shape,p,i.shape,i.dtype,m,l.shape,g,y,c);return t.makeTensorInfo(v,i.dtype,w)}const K8={kernelName:Cw,backendName:"webgl",kernelFunc:A8};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const SR=n=>{const{backend:e,attrs:t}=n,{start:r,stop:s,step:i,dtype:l}=t,u=vj(r,s,i,l);return e.makeTensorInfo([u.length],l,u)},Z8={kernelName:r0,backendName:"webgl",kernelFunc:SR};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const B8=it({opSnippet:"return 1.0 / x;"}),_8={kernelName:Au,backendName:"webgl",kernelFunc:B8};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const H8=ts+`
  return (x < 0.0) ? 0.0 : x;
`,U8=it({opSnippet:H8,packedOpSnippet:`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`}),j8={kernelName:Ku,backendName:"webgl",kernelFunc:U8};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Y8=ts+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Q8=it({opSnippet:Y8,packedOpSnippet:`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`}),J8={kernelName:Zu,backendName:"webgl",kernelFunc:Q8};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class q8{constructor(e,t,r,s,i){this.variableNames=["A"],this.outputShape=[];const[l,u,c,h]=e;this.outputShape=[l,t,r,h];const p=[s&&t>1?u-1:u,s&&r>1?c-1:c],m=[s&&t>1?t-1:t,s&&r>1?r-1:r];let g;i?g="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":g="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${p[0]/m[0]},
          ${p[1]/m[1]});
      const vec2 inputShapeRC = vec2(${u}.0, ${c}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${g};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class eq{constructor(e,t,r,s,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[l,u,c,h]=e;this.outputShape=[l,t,r,h];const p=[s&&t>1?u-1:u,s&&r>1?c-1:c],m=[s&&t>1?t-1:t,s&&r>1?r-1:r];let g;i?g="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":g="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${p[0]/m[0]},
          ${p[1]/m[1]},
          ${p[1]/m[1]});
      const vec3 inputShapeRC = vec3(${u}.0, ${c}.0,
                                     ${c}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${g};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${h-1};
        bool hasNextRow = coords.z < ${r-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tq(n){const{inputs:e,backend:t,attrs:r}=n,{images:s}=e,{alignCorners:i,halfPixelCenters:l,size:u}=r,[c,h]=u,p=ae().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new eq(s.shape,c,h,i,l):new q8(s.shape,c,h,i,l);return t.runWebGLProgram(p,[s],"float32")}const nq={kernelName:Yh,backendName:"webgl",kernelFunc:tq};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class rq{constructor(e,t,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,s,i]=t,[,l,u]=e,c=[r&&l>1?s-1:s,r&&u>1?i-1:i],h=[r&&l>1?l-1:l,r&&u>1?u-1:u],p=c[0]/h[0],m=c[1]/h[1],g=1/p,y=1/m,v=Math.ceil(g)*2+2,w=Math.ceil(y)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${p});
        const float widthScale = float(${m});

        const float invHeightScale = float(${g});
        const float invWidthScale = float(${y});

        const int winHeight = int(${v});
        const int winWidth = int(${w});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${l}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${u}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${s-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sq(n){const{inputs:e,backend:t,attrs:r}=n,{images:s,dy:i}=e,{alignCorners:l}=r,u=new rq(i.shape,s.shape,l);return t.runWebGLProgram(u,[i],i.dtype)}const aq={kernelName:i0,backendName:"webgl",kernelFunc:sq};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class iq{constructor(e,t,r,s,i){this.variableNames=["A"],this.outputShape=[];const[l,u,c,h]=e;this.outputShape=[l,t,r,h];const p=[s&&t>1?u-1:u,s&&r>1?c-1:c],m=[s&&t>1?t-1:t,s&&r>1?r-1:r],g=s?"0.5":"0.0";let y;i?y="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":y="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${p[0]/m[0]},
          ${p[1]/m[1]});
      const vec2 inputShapeRC = vec2(${u}.0, ${c}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${y};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${g})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class oq{constructor(e,t,r,s,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[l,u,c,h]=e;this.outputShape=[l,t,r,h];const p=[s&&t>1?u-1:u,s&&r>1?c-1:c],m=[s&&t>1?t-1:t,s&&r>1?r-1:r],g=s?"0.5":"0.0";let y;i?y="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":y="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${p[0]/m[0]},
          ${p[1]/m[1]},
          ${p[1]/m[1]});
      const vec3 inputShapeRC = vec3(${u}.0, ${c}.0,
                                     ${c}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${y};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${g})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${h-1};
        bool hasNextRow = coords.z < ${r-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function lq(n){const{inputs:e,backend:t,attrs:r}=n,{images:s}=e,{alignCorners:i,halfPixelCenters:l,size:u}=r,[c,h]=u,p=ae().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new oq(s.shape,c,h,i,l):new iq(s.shape,c,h,i,l);return t.runWebGLProgram(p,[s],s.dtype)}const uq={kernelName:jh,backendName:"webgl",kernelFunc:lq};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class cq{constructor(e,t,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,s,i]=t,[,l,u]=e,c=[r&&l>1?s-1:s,r&&u>1?i-1:i],h=[r&&l>1?l-1:l,r&&u>1?u-1:u],p=c[0]/h[0],m=c[1]/h[1],g=1/p,y=1/m,v=Math.ceil(g)*2+2,w=Math.ceil(y)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${p});
        const float widthScale = float(${m});

        const float invHeightScale = float(${g});
        const float invWidthScale = float(${y});

        const int winHeight = int(${v});
        const int winWidth = int(${w});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${l}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${u}) {
              continue;
            }

            float sourceFracRow =
              float(${c[0]}) *
                (float(dyR) / float(${h[0]}));

            float sourceFracCol =
                float(${c[1]}) *
                  (float(dyC) / float(${h[1]}));

            int sourceNearestRow = int(min(
                float(int(${s}) - 1),
                ${r} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${r} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function dq(n){const{inputs:e,backend:t,attrs:r}=n,{images:s,dy:i}=e,{alignCorners:l}=r,u=new cq(i.shape,s.shape,l);return t.runWebGLProgram(u,[i],i.dtype)}const hq={kernelName:a0,backendName:"webgl",kernelFunc:dq};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class pq{constructor(e,t){this.variableNames=["x"];const r=e.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);if(this.outputShape=e,r===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const s=u=>t.indexOf(u)!==-1&&e[u]!==1?`${e[u]} - coords[${u}] - 1`:`coords[${u}]`,i=e.map((u,c)=>s(c)).join(","),l=gt(r);this.userCode=`
      void main() {
        ${l} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class fq{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const r=e.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);this.outputShape=e;const s=An("rc",r),i=`${s[r-1]} + 1 < ${this.outputShape[r-1]}`,l=`${s[r-2]} + 1 < ${this.outputShape[r-2]}`,u=gt(r);r===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${u} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${c(s.slice())};
          if(${i}){
            result.g = ${h(s.slice())};
          }
          if(${l}) {
            result.b = ${p(s.slice())};
            if(${i}) {
              result.a = ${m(s.slice())};
            }
          }
          setOutput(result);
        }
    `;function c(v){return g(v)}function h(v){return v[r-1]="("+v[r-1]+" + 1)",g(v)}function p(v){return v[r-2]="("+v[r-2]+" + 1)",g(v)}function m(v){return v[r-1]="("+v[r-1]+" + 1)",v[r-2]="("+v[r-2]+" + 1)",g(v)}function g(v){const w=e.map((C,R)=>y(R,v)),S=w.join(","),I=w.slice(-2).join(",");return`getChannel(getX(${S}), vec2(${I}))`}function y(v,w){return t.indexOf(v)!==-1&&e[v]!==1?`${e[v]} - ${w[v]} - 1`:`${w[v]}`}}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mq(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{dims:i}=r,l=s.shape.length,u=oe(i,s.shape);if(l===0)return mr({inputs:{x:s},backend:t});const c=ae().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new fq(s.shape,u):new pq(s.shape,u);return t.runWebGLProgram(c,[s],s.dtype)}const gq={kernelName:Qh,backendName:"webgl",kernelFunc:mq};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class bq{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const r=e[1],s=e[2];this.outputShape=e;let i="";typeof t=="number"?i=`float outputValue = ${t.toFixed(2)};`:i=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${s} && coordY >= 0 && coordY < ${r}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const yq={kernelName:f0,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:r}=n,{radians:s,fillValue:i,center:l}=e,u=t,c=new bq(r.shape,i),[h,p]=Sb(l,r.shape[1],r.shape[2]),m=[[h,p,Math.sin(s),Math.cos(s)]];return u.runWebGLProgram(c,[r],r.dtype,m)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const xq=it({opSnippet:`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`}),vq={kernelName:Bu,backendName:"webgl",kernelFunc:xq};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const wq=it({opSnippet:"return inversesqrt(x);",cpuKernelImpl:wj}),kq={kernelName:_u,backendName:"webgl",kernelFunc:wq};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class rx{constructor(e,t,r,s,i,l,u=!0,c=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=l;const h=gt(i.length),p=gt(l.length);let m="";r===1?m="i":r===2&&(m="i, j");const g=`getIndices(${m})`;let y="";s===1?y="i":s===2&&(y="i, coords[1]");const v=`getUpdates(${y})`;let w="";c&&(w="coords[0], coords[1]");const S=`getDefaultValue(${w})`,I=t>1?"strides[j]":"strides";this.userCode=`
        ${h} strides = ${h}(${i});

        void main() {
          ${p} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${g});
              flattenedIndex += index * ${I};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${v};
              found = true;
            }
          }
          setOutput(mix(${S}, sum, float(found)));
        }
      `}}/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Iq{constructor(e,t,r,s,i,l,u=!0,c=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=l;const h=gt(i.length),p=gt(l.length);let m="";r===1?m="i":r===2&&(m="i, j");const g=`getIndices(${m})`;let y="";s===1?y="i":s===2&&(y="i, coords[1]");const v=`getUpdates(${y})`;let w="";c&&(w="coords[0], coords[1]");const S=`getDefaultValue(${w})`,I=t>1?"strides[j]":"strides",C=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${h} strides = ${h}(${i});

        void main() {
          ${p} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${g});
              flattenedIndex += index.xz * ${I};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${C};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${v};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${S}, sum, found));
        }
      `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Sq(n){const{inputs:e,backend:t,attrs:r}=n,{indices:s,updates:i}=e,{shape:l}=r,{sliceRank:u,numUpdates:c,sliceSize:h,strides:p,outputSize:m}=eo(i,s,l),g=[m/h,h];if(m===0)return t.makeTensorInfo(l,s.dtype);const y=Ne({inputs:{x:s},backend:t,attrs:{shape:[c,u]}}),v=Ne({inputs:{x:i},backend:t,attrs:{shape:[c,h]}}),w=t.makeTensorInfo([],"float32",new Float32Array([0]));let S;ae().getBool("WEBGL_PACK")?S=new Iq(c,u,y.shape.length,v.shape.length,p,g):S=new rx(c,u,y.shape.length,v.shape.length,p,g);const I=t.runWebGLProgram(S,[v,y,w],v.dtype),C=Ne({inputs:{x:I},backend:t,attrs:{shape:l}});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(I),t.disposeIntermediateTensorInfo(w),C}const Cq={kernelName:Tw,backendName:"webgl",kernelFunc:Sq};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Tq{constructor(e,t,r,s){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,r];const i="while (left < right) {",l=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,u=ae().getNumber("WEBGL_VERSION")===2?i:l,c=s==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${u}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${c} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Nq(n){const{inputs:e,backend:t,attrs:r}=n,{sortedSequence:s,values:i}=e,{side:l}=r,u=new Tq(s.shape[0],s.shape[1],i.shape[1],l),c=[[s.shape[1]]];return t.runWebGLProgram(u,[s,i],"int32",c)}const Rq={kernelName:Rw,backendName:"webgl",kernelFunc:Nq};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Eq{constructor(e,t,r){this.variableNames=["c","a","b"],this.outputShape=t;let s,i;if(r>4)throw Error(`Where for rank ${r} is not yet supported`);if(r===1)i="resRC",s="resRC";else{const u=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],h=[];for(let p=0;p<t.length;p++)h.push(`${u[p]}`),p<e&&c.push(`${u[p]}`);s=c.join(),i=h.join()}const l=gt(r);this.userCode=`
      void main() {
        ${l} resRC = getOutputCoords();
        float cVal = getC(${s});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Lq(n){const{inputs:e,backend:t}=n,{condition:r,t:s,e:i}=e,l=new Eq(r.shape.length,s.shape,s.shape.length);return t.runWebGLProgram(l,[r,s,i],dr(s.dtype,i.dtype))}const Gq={kernelName:Jh,backendName:"webgl",kernelFunc:Lq};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const zq=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Rp};
  float scale = ${Ep};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Wq=it({opSnippet:zq}),Mq={kernelName:Hu,backendName:"webgl",kernelFunc:Wq};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const $q=Il+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,Fq=it({opSnippet:$q,packedOpSnippet:`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cpuKernelImpl:Ij}),Vq={kernelName:Qu,backendName:"webgl",kernelFunc:Fq};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Pq=it({opSnippet:`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`}),Xq={kernelName:Yu,backendName:"webgl",kernelFunc:Pq};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Oq=Il+`
  return sin(x);
`,Dq=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${yo}
  return result;
`,Aq=it({opSnippet:Oq,packedOpSnippet:Dq}),Kq={kernelName:Uu,backendName:"webgl",kernelFunc:Aq};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Zq=it({opSnippet:`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`}),Bq={kernelName:ju,backendName:"webgl",kernelFunc:Zq};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const _q=it({opSnippet:`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`}),Hq={kernelName:Ju,backendName:"webgl",kernelFunc:_q};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Uq={kernelName:tp,backendName:"webgl",kernelFunc:n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockShape:i,paddings:l}=r;T(s.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const u=i.reduce((I,C)=>I*C),c=[[0,0]];c.push(...l);for(let I=1+i.length;I<s.shape.length;++I)c.push([0,0]);const h=[],p=IR({inputs:{x:s},backend:t,attrs:{paddings:c,constantValue:0}}),m=Ic(p.shape,i,u,!1),g=Sc(m.length,i.length,!1),y=Cc(p.shape,i,u,!1),v=Ne({inputs:{x:p},backend:t,attrs:{shape:m}}),w=Kn({inputs:{x:v},backend:t,attrs:{perm:g}}),S=Ne({inputs:{x:w},backend:t,attrs:{shape:y}});return h.push(p),h.push(v),h.push(w),h.forEach(I=>t.disposeIntermediateTensorInfo(I)),S}};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function jq(n){const{inputs:e,backend:t}=n,{indices:r,values:s,denseShape:i,defaultValue:l}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${r.shape}`);if(s.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${s.shape}`);if(l.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${l.shape}`);const u=t.readSync(r.dataId),c=t.readSync(s.dataId),h=t.readSync(i.dataId),p=t.readSync(l.dataId)[0],[m,g,y,v,w]=Cj(u,r.shape,r.dtype,c,s.dtype,h,p);return[t.makeTensorInfo(g,r.dtype,m),t.makeTensorInfo([g[0]],s.dtype,y),t.makeTensorInfo([v.length],"bool",new Uint8Array(v.map(S=>Number(S)))),t.makeTensorInfo([w.length],r.dtype,new Int32Array(w))]}const Yq={kernelName:Ew,backendName:"webgl",kernelFunc:jq};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Qq(n){const{inputs:e,backend:t}=n,{inputIndices:r,inputShape:s,newShape:i}=e;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(s.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${s.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const l=Array.from(t.readSync(s.dataId)),u=t.readSync(r.dataId),c=Array.from(t.readSync(i.dataId)),[h,p,m]=Tj(u,r.shape,r.dtype,l,c);return[t.makeTensorInfo(p,r.dtype,h),t.makeTensorInfo([m.length],i.dtype,new Int32Array(m))]}const Jq={kernelName:Lw,backendName:"webgl",kernelFunc:Qq};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function qq(n){const{inputs:e,backend:t}=n,{data:r,indices:s,segmentIds:i}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${s.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${i.shape}`);const l=t.readSync(r.dataId),u=t.readSync(s.dataId),c=t.readSync(i.dataId),[h,p]=EN(l,r.shape,r.dtype,u,c,!0);return t.makeTensorInfo(p,r.dtype,h)}const eee={kernelName:Gw,backendName:"webgl",kernelFunc:qq};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tee(n){const{inputs:e,backend:t}=n,{data:r,indices:s,segmentIds:i}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${s.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${i.shape}`);const l=t.readSync(r.dataId),u=t.readSync(s.dataId),c=t.readSync(i.dataId),[h,p]=EN(l,r.shape,r.dtype,u,c);return t.makeTensorInfo(p,r.dtype,h)}const nee={kernelName:zw,backendName:"webgl",kernelFunc:tee};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ree(n){const{inputs:e,backend:t,attrs:r}=n,{sparseIndices:s,sparseValues:i,defaultValue:l}=e,{outputShape:u}=r,{sliceRank:c,numUpdates:h,sliceSize:p,strides:m,outputSize:g}=eo(i,s,u),y=!1;if(i.dtype==="string"){const I=t.bufferSync(s),C=t.bufferSync(i),R=Aa(t.readSync(l.dataId)[0]),L=kj(I,C,u,g,p,h,c,m,R,y);return t.makeTensorInfo(u,L.dtype,L.values)}const v=new rx(h,c,s.shape.length,i.shape.length,m,[g,1],y),w=t.runWebGLProgram(v,[i,s,l],i.dtype),S=Ne({inputs:{x:w},backend:t,attrs:{shape:u}});return t.disposeIntermediateTensorInfo(w),S}const see={kernelName:Ww,backendName:"webgl",kernelFunc:ree};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function aee(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{numOrSizeSplits:i,axis:l}=r,u=oe(l,s.shape)[0],c=Ob(s,i,u),h=s.shape.length,p=new Array(h).fill(0),m=s.shape.slice();return c.map(g=>{const y=[...m];y[u]=g;const v=Sl({inputs:{x:s},backend:t,attrs:{begin:p,size:y}});return p[u]+=g,v})}const iee={kernelName:np,backendName:"webgl",kernelFunc:aee};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const CR="return sqrt(x);",oee=it({opSnippet:CR,packedOpSnippet:CR,cpuKernelImpl:Nj}),lee={kernelName:qu,backendName:"webgl",kernelFunc:oee};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const uee=it({opSnippet:"return x * x;"}),cee={kernelName:o0,backendName:"webgl",kernelFunc:uee};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const TR="return (a - b) * (a - b);",dee=Cn({opSnippet:TR,packedOpSnippet:TR}),hee={kernelName:ec,backendName:"webgl",kernelFunc:dee};/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function pee(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");const i=t.readSync(s.dataId),l=ba(i),u=Rj(l,"string",r);return t.makeTensorInfo(s.shape,"string",u)}const fee={kernelName:l0,backendName:"webgl",kernelFunc:pee};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mee({inputs:n,attrs:e,backend:t}){const{x:r}=n,s=ts+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,i=new Ys(r.shape,s);return t.runWebGLProgram(i,[r],r.dtype)}const gee={kernelName:ac,backendName:"webgl",kernelFunc:mee};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class bee{constructor(e,t,r){this.variableNames=["x"],this.outputShape=r;const s=r.length,i=gt(r.length),l=gt(r.length);let u="";if(s===1)u="coords * strides + begin";else{let c=0;u=r.map((h,p)=>(c++,r.length===1?`coords * strides[${p}] + begin[${p}]`:`coords[${c-1}] * strides[${p}] + begin[${p}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${e});
      ${i} strides = ${i}(${t});

      void main() {
        ${l} coords = getOutputCoords();
        setOutput(getX(${u}));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yee(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{begin:i,end:l,strides:u,beginMask:c,endMask:h,ellipsisMask:p,newAxisMask:m,shrinkAxisMask:g}=r,{finalShapeSparse:y,finalShape:v,isIdentity:w,sliceDim0:S,isSimpleSlice:I,begin:C,end:R,strides:L}=wb(s.shape,i,l,u,c,h,p,m,g);let G;if(w)G=Ne({inputs:{x:s},backend:t,attrs:{shape:v}});else if(S||I){T(s.shape.length>=1,()=>`Input must have rank at least 1, got: ${s.shape.length}`);const F=yb(C,R,L),V=Sl({inputs:{x:s},backend:t,attrs:{begin:C,size:F}});G=Ne({inputs:{x:V},backend:t,attrs:{shape:v}}),t.disposeIntermediateTensorInfo(V)}else if(t.shouldExecuteOnCPU([s])){const F=t.readSync(s.dataId),V=Je(s.shape,s.dtype,F),D=Ej(y,V,L,C);G=t.makeTensorInfo(v,s.dtype,D.values)}else{const F=new bee(C,L,y);G=t.runWebGLProgram(F,[s],s.dtype)}const $=Ne({inputs:{x:G},backend:t,attrs:{shape:v}});return t.disposeIntermediateTensorInfo(G),$}const xee={kernelName:u0,backendName:"webgl",kernelFunc:yee};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vee(n){const{inputs:e,backend:t,attrs:r}=n,{separator:s,nGramWidths:i,leftPad:l,rightPad:u,padWidth:c,preserveShortSequences:h}=r,{data:p,dataSplits:m}=e,g=t.readSync(p.dataId),y=t.readSync(m.dataId),[v,w]=Lj(g,y,s,i,l,u,c,h);return[t.makeTensorInfo([v.length],"string",v),t.makeTensorInfo(m.shape,"int32",w)]}const wee={kernelName:Mw,backendName:"webgl",kernelFunc:vee};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function kee(n){const{inputs:e,backend:t,attrs:r}=n,{skipEmpty:s}=r,{input:i,delimiter:l}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(l.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${l.shape}`);const u=t.readSync(i.dataId),c=t.readSync(l.dataId)[0],[h,p,m]=Gj(u,c,s),g=p.length;return[t.makeTensorInfo([g,2],"int32",h),t.makeTensorInfo([g],"string",p),t.makeTensorInfo([2],"int32",new Int32Array(m))]}const Iee={kernelName:$w,backendName:"webgl",kernelFunc:kee};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function See(n){const{inputs:e,backend:t,attrs:r}=n,{numBuckets:s}=r,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(s<=0)throw new Error("Number of buckets must be at least 1");const l=t.readSync(i.dataId),u=zj(l,s);return t.makeTensorInfo(i.shape,"int32",u)}const Cee={kernelName:Fw,backendName:"webgl",kernelFunc:See};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Tee=it({opSnippet:"return tan(x);"}),Nee={kernelName:nc,backendName:"webgl",kernelFunc:Tee};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Ree=it({opSnippet:`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`}),Eee={kernelName:rc,backendName:"webgl",kernelFunc:Ree};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Lee(n){const{inputs:e,backend:t,attrs:r}=n,{tensor:s,indices:i,updates:l}=e,{sliceRank:u,numUpdates:c,sliceSize:h,strides:p,outputSize:m}=eo(l,i,s.shape),g=[m/h,h];if(m===0)return t.makeTensorInfo(s.shape,i.dtype);const y=Ne({inputs:{x:i},backend:t,attrs:{shape:[c,u]}}),v=Ne({inputs:{x:l},backend:t,attrs:{shape:[c,h]}}),w=Ne({inputs:{x:s},backend:t,attrs:{shape:g}}),S=new rx(c,u,y.shape.length,v.shape.length,p,g,!1,!0),I=t.runWebGLProgram(S,[v,y,w],w.dtype),C=Ne({inputs:{x:I},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(I),C}const Gee={kernelName:Nw,backendName:"webgl",kernelFunc:Lee};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class zee{constructor(e,t){this.variableNames=["A"];const r=new Array(e.length);for(let l=0;l<r.length;l++)r[l]=e[l]*t[l];this.outputShape=r,this.rank=r.length;const s=gt(this.rank),i=Wee(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}}function Wee(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let s=0;s<n.length;s++)r.push(`imod(${t[s]}, ${n[s]})`);return r.join()}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function NR(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{reps:i}=r;if(s.dtype==="string"||s.shape.length>5){const u=t.readSync(s.dataId),c=s.dtype==="string"?u.map(m=>Aa(m)):u,h=Je(s.shape,s.dtype,c),p=Mj(h,i);return t.makeTensorInfo(p.shape,p.dtype,p.values)}const l=new zee(s.shape,i);return t.runWebGLProgram(l,[s],s.dtype)}const Mee={kernelName:sc,backendName:"webgl",kernelFunc:NR};class $ee{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class Fee{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vo(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function RR(n){let e=1;for(;e<n;)e*=2;return e}function Vee(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{k:i,sorted:l}=r,u=ae().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),c=ae().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),h=s.shape,p=h[h.length-1];if(t.shouldExecuteOnCPU([s])||p<u||i>c){const D=t.readSync(s.dataId),[Z,ne]=$j(D,h,s.dtype,i,l);return[t.makeTensorInfo(Z.shape,Z.dtype,Z.values),t.makeTensorInfo(ne.shape,ne.dtype,ne.values)]}if(i===0)return h[h.length-1]=0,[t.makeTensorInfo(h,s.dtype,[]),t.makeTensorInfo(h,"int32",[])];if(p===1)return[s,ed({attrs:{shape:h,dtype:"int32",value:0},backend:t})];const m=t.texData.get(s.dataId),g=m!==null&&m.isPacked,y=g?t.unpackTensor(s):s,v=M(h)/p,w=Ne({inputs:{x:y},attrs:{shape:[v,p]},backend:t});g&&vo(t,y);const S=RR(i),I=RR(p);let C=null;const R=()=>C===null?[w,w]:[w,C],L=(D,Z,ne)=>{const re=R(),se=new $ee(ne),ue=[[p],[C===null?1:0],[Number.NEGATIVE_INFINITY],[D],[Z]],le=C;C=t.runWebGLProgram(se,re,"int32",ue),vo(t,le)};for(let D=1;D<S;D*=2){const Z=D*2;for(let ne=D;ne>=1;ne/=2)L(Z,ne,[v,I])}for(let D=I;D>S;D/=2){const Z=R(),ne=new Fee([v,D/2]),re=[[p],[C===null?1:0],[S]],se=C;C=t.runWebGLProgram(ne,Z,"int32",re),vo(t,se);const ue=S/2,le=ue*2;for(let he=ue;he>=1;he/=2)L(le,he,C.shape)}let G=C;C=Sl({inputs:{x:C},backend:t,attrs:{begin:0,size:[v,i]}}),vo(t,G);let $=gR({inputs:{x:w,indices:C},backend:t,attrs:{axis:1,batchDims:1}});vo(t,w);const F=h.slice(0,-1);F.push(i),G=C,C=Ne({inputs:{x:C},attrs:{shape:F},backend:t}),vo(t,G);const V=$;return $=Ne({inputs:{x:$},attrs:{shape:F},backend:t}),vo(t,V),[$,C]}const Pee={kernelName:c0,backendName:"webgl",kernelFunc:Vee};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Xee{constructor(e,t,r,s,i,l){this.variableNames=["Image","Transforms"],this.outputShape=l;const u=r==="nearest"?1:2;let c;switch(s){case"constant":c=1;break;case"reflect":c=2;break;case"wrap":c=3;break;case"nearest":c=4;break;default:c=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${c} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${c} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${c} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${u} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Oee(n){const{inputs:e,backend:t,attrs:r}=n,{image:s,transforms:i}=e,{interpolation:l,fillMode:u,fillValue:c,outputShape:h}=r,[p,m,g,y]=s.shape,[v,w]=h??[m,g],S=[p,v,w,y],I=new Xee(m,g,l,u,c,S);return t.runWebGLProgram(I,[s,i],"float32")}const Dee={kernelName:d0,backendName:"webgl",kernelFunc:Oee};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Aee(n){const{inputs:e,attrs:t,backend:r}=n,{axis:s}=t,{x:i}=e;Hc(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const l=r.readSync(i.dataId),{outputValues:u,outputShape:c,indices:h}=Fj(l,s,i.shape,i.dtype);return[r.makeTensorInfo(c,i.dtype,u),r.makeTensorInfo([h.length],"int32",h)]}const Kee={kernelName:h0,backendName:"webgl",kernelFunc:Aee};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Zee(n){const{inputs:e,backend:t,attrs:r}=n,{value:s}=e;let{axis:i}=r;i<0&&(i+=s.shape.length);const l=s,u=l.shape.length,c=s.shape[i],h=new Array(u-1);let p=0;for(let w=0;w<u;w++)w!==i&&(h[p++]=l.shape[w]);const m=[],g=new Array(u).fill(0),y=l.shape.slice();y[i]=1;const v=new Array(c);for(let w=0;w<v.length;w++){g[i]=w;const S=Sl({inputs:{x:l},backend:t,attrs:{begin:g,size:y}}),I=Ne({inputs:{x:S},backend:t,attrs:{shape:h}});v[w]=I,m.push(S)}return m.forEach(w=>t.disposeIntermediateTensorInfo(w)),v}const Bee={kernelName:sp,backendName:"webgl",kernelFunc:Zee};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class _ee{constructor(e,t){this.variableNames=["x","segmentIds"];const r=e.windowSize,s=e.batchSize,i=e.inSize,l=e.numSegments,u=l*Math.ceil(i/r);this.outputShape=[s,u];const c="0.0",h="sumValue",p=Math.floor(r/4)*4,m=r%4,g=`
        sumValue += dot(values, segFilter);
    `;let y="";i%r>0&&(y=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let v="";i%r>0&&(v=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${c};

      float getValue(int batch, int inIdx) {
        ${y}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${v}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${l})) * float(${r}));
        int currentSeg = int(mod(float(outIdx), float(${l})));

        float sumValue = 0.0;

        for (int i = 0; i < ${p}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${g}
        }

        int inIdx = inOffset + ${p};
        if (${m===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${g}
        } else if (${m===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${g}
        } else if (${m===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${g}
        }
        setOutput(${h});
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Hee(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,segmentIds:i}=e,{numSegments:l}=r,u=s.shape.length,c=[];let h=0;const p=Xt([h],u);let m=s;p!=null&&(m=Kn({inputs:{x:s},backend:t,attrs:{perm:p}}),c.push(m),h=Yt(1,u)[0]);const g=tI(m.shape,h,l),y=M([m.shape[h]]),v=Ne({inputs:{x:m},backend:t,attrs:{shape:[-1,y]}});c.push(v);const w=C0(s.dtype),S=(L,G,$,F,V)=>{const D=L.shape[0],Z=L.shape[1],ne=eI(Z,V),re={windowSize:ne,inSize:Z,batchSize:D,numSegments:V},se=new _ee(re,G),ue=t.compileAndRun(se,[L,$],F);if(c.push(ue),ue.shape[1]===V)return ue;const le=SR({backend:t,attrs:{start:0,stop:V,step:1,dtype:"float32"}}),he=NR({inputs:{x:le},backend:t,attrs:{reps:[Z/ne]}});return c.push(le),c.push(he),S(ue,G,he,F,V)},I=S(v,"unsortedSegmentSum",i,w,l),C=Ne({inputs:{x:I},backend:t,attrs:{shape:g}});let R=C;if(p!=null){c.push(C);const L=_a(p);R=Kn({inputs:{x:R},backend:t,attrs:{perm:L}})}return c.forEach(L=>t.disposeIntermediateTensorInfo(L)),R}const Uee={kernelName:ap,backendName:"webgl",kernelFunc:Hee};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const jee=[NY,EY,zY,$Y,VY,OY,AY,ZY,UY,YY,qY,nQ,aQ,uQ,hQ,fQ,gQ,vQ,kQ,SQ,NQ,WQ,$Q,XQ,DQ,_Q,UQ,JQ,cY,t7,i7,c7,g7,x7,w7,I7,C7,E7,G7,W7,$7,V7,X7,A7,Z7,U7,Y7,q7,n6,s6,i6,u6,d6,f6,g6,b6,x6,w6,I6,C6,N6,E6,z6,$6,V6,O6,K6,B6,H6,uY,j6,s7,Q6,q6,tJ,hY,rJ,aJ,oJ,cJ,pJ,mJ,bJ,xJ,kJ,SJ,TJ,LJ,zJ,MJ,PJ,OJ,AJ,ZJ,_J,YJ,qJ,r8,u8,mY,p8,g8,x8,k8,AQ,S8,T8,R8,G8,$8,fY,V8,X8,D8,K8,Z8,KQ,a8,_8,j8,J8,bY,nq,aq,uq,hq,gq,yq,vq,kq,Cq,Rq,Gq,Mq,Vq,Xq,Kq,Bq,zQ,o8,Hq,Uq,Yq,Jq,eee,nee,see,iee,lee,cee,hee,fee,gee,xee,wee,Iee,Cee,i8,SY,Nee,Eee,Gee,Mee,Pee,Dee,CY,Kee,Bee,Uee,C8];for(const n of jee)Cr(n);const ER="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NsYXNzIFd0e2NvbnN0cnVjdG9yKG49W10sZT1RdCl7aWYodGhpcy5kYXRhPW4sdGhpcy5sZW5ndGg9dGhpcy5kYXRhLmxlbmd0aCx0aGlzLmNvbXBhcmU9ZSx0aGlzLmxlbmd0aD4wKWZvcihsZXQgdD0odGhpcy5sZW5ndGg+PjEpLTE7dD49MDt0LS0pdGhpcy5fZG93bih0KX1wdXNoKG4pe3RoaXMuZGF0YS5wdXNoKG4pLHRoaXMubGVuZ3RoKyssdGhpcy5fdXAodGhpcy5sZW5ndGgtMSl9cG9wKCl7aWYodGhpcy5sZW5ndGg9PT0wKXJldHVybjtjb25zdCBuPXRoaXMuZGF0YVswXSxlPXRoaXMuZGF0YS5wb3AoKTtyZXR1cm4gdGhpcy5sZW5ndGgtLSx0aGlzLmxlbmd0aD4wJiYodGhpcy5kYXRhWzBdPWUsdGhpcy5fZG93bigwKSksbn1wZWVrKCl7cmV0dXJuIHRoaXMuZGF0YVswXX1fdXAobil7Y29uc3R7ZGF0YTplLGNvbXBhcmU6dH09dGhpcyxzPWVbbl07Zm9yKDtuPjA7KXtjb25zdCByPW4tMT4+MSxpPWVbcl07aWYodChzLGkpPj0wKWJyZWFrO2Vbbl09aSxuPXJ9ZVtuXT1zfV9kb3duKG4pe2NvbnN0e2RhdGE6ZSxjb21wYXJlOnR9PXRoaXMscz10aGlzLmxlbmd0aD4+MSxyPWVbbl07Zm9yKDtuPHM7KXtsZXQgaT0objw8MSkrMSxoPWVbaV07Y29uc3QgbD1pKzE7aWYobDx0aGlzLmxlbmd0aCYmdChlW2xdLGgpPDAmJihpPWwsaD1lW2xdKSx0KGgscik+PTApYnJlYWs7ZVtuXT1oLG49aX1lW25dPXJ9fWZ1bmN0aW9uIFF0KG8sbil7cmV0dXJuIG88bj8tMTpvPm4/MTowfWNvbnN0IHl0PW89Pntjb25zdHt2MTpuLHYyOmV9PW87bGV0IHQ9MDtmb3IobGV0IHM9MDtzPG4ubGVuZ3RoO3MrKyl7bGV0IHI9KG5bc11eZVtzXSk+Pj4wO3QrPVp0KHIpfXJldHVybiB0fSxadD1vPT57dmFyIG49by0obz4+MSYxNDMxNjU1NzY1KTtyZXR1cm4gbj0obj4+MiY4NTg5OTM0NTkpKyhuJjg1ODk5MzQ1OSksbj0obj4+NCkrbiYyNTI2NDUxMzUsbj0obj4+OCkrbiYxNjcxMTkzNSxuPShuPj4xNikrbiY2NTUzNSxufSxjdD0xLHZ0PW89Pntjb25zdHtrZXl3aWR0aDpuLGtleWhlaWdodDplLHF1ZXJ5d2lkdGg6dCxxdWVyeWhlaWdodDpzLG1hdGNoZXM6cn09byxpPXQqMS4yLGg9LWksbD1zKjEuMix1PS1sLGY9MTIsZz0xMCxhPS0xLGo9MSx5PTEvTWF0aC5sb2coMTApLG09TWF0aC5tYXgobixlKSxNPU1hdGguZmxvb3Iobi8yKSxUPU1hdGguZmxvb3IoZS8yKSxFPVtdO2ZvcihsZXQgTj0wO048ci5sZW5ndGg7TisrKXtjb25zdCAkPXJbTl0ucXVlcnlwb2ludC5zY2FsZSxLPXJbTl0ua2V5cG9pbnQuc2NhbGU7Sz09MCYmY29uc29sZS5sb2coIkVSUk9SIGRpdmlkZSB6ZXJvIik7Y29uc3Qgdj0kL0s7RS5wdXNoKHYqbSl9RS5zb3J0KChOLCQpPT5OLSQpO2NvbnN0IFI9LjI1KkVbTWF0aC5mbG9vcihFLmxlbmd0aC8yKS0oRS5sZW5ndGglMj09MD8xOjApLTFdLHE9TWF0aC5tYXgoNSxNYXRoLmNlaWwoKGktaCkvUikpLEk9TWF0aC5tYXgoNSxNYXRoLmNlaWwoKGwtdSkvUikpLHo9cSpJLEI9eipmLGM9W10scD1bXSxTPXt9O2ZvcihsZXQgTj0wO048ci5sZW5ndGg7TisrKXtjb25zdCAkPXJbTl0ucXVlcnlwb2ludCxLPXJbTl0ua2V5cG9pbnQse3g6dix5OlYsc2NhbGU6TCxhbmdsZTpDfT14dCh7cXVlcnlwb2ludDokLGtleXBvaW50Okssa2V5Y2VudGVyWDpNLGtleWNlbnRlclk6VCxzY2FsZU9uZU92ZXJMb2dLOnl9KTtpZih2PGh8fHY+PWl8fFY8dXx8Vj49bHx8Qzw9LU1hdGguUEl8fEM+TWF0aC5QSXx8TDxhfHxMPj1qKXtjW05dPSExO2NvbnRpbnVlfWxldCBYPXEqKHYtaCkvKGktaCksd3Q9SSooVi11KS8obC11KSxwdD1mKihDK01hdGguUEkpLygyKk1hdGguUEkpLGR0PWcqKEwtYSkvKGotYSk7cFtOXT17YmluWDpYLGJpblk6d3QsYmluQW5nbGU6cHQsYmluU2NhbGU6ZHR9O2xldCBpdD1NYXRoLmZsb29yKFgtLjUpLGx0PU1hdGguZmxvb3Iod3QtLjUpLGh0PU1hdGguZmxvb3IoZHQtLjUpLGp0PShNYXRoLmZsb29yKHB0LS41KStmKSVmO2lmKGl0PDB8fGl0KzE+PXF8fGx0PDB8fGx0KzE+PUl8fGh0PDB8fGh0KzE+PWcpe2NbTl09ITE7Y29udGludWV9Zm9yKGxldCB1dD0wO3V0PDI7dXQrKyl7bGV0IGt0PWl0K3V0O2ZvcihsZXQgYnQ9MDtidDwyO2J0Kyspe2xldCB1bj1sdCtidDtmb3IobGV0IEl0PTA7SXQ8MjtJdCsrKXtsZXQgY249KGp0K0l0KSVmO2ZvcihsZXQgUnQ9MDtSdDwyO1J0Kyspe2xldCBmbj1odCtSdDtjb25zdCBOdD1rdCt1bipxK2NuKnorZm4qQjtTW050XT09PXZvaWQgMCYmKFNbTnRdPTApLFNbTnRdKz0xfX19fWNbTl09ITB9bGV0IGQ9MCxEPS0xO2lmKE9iamVjdC5rZXlzKFMpLmZvckVhY2goTj0+e1NbTl0+ZCYmKGQ9U1tOXSxEPU4pfSksZDwzKXJldHVybltdO2NvbnN0IFU9TWF0aC5mbG9vcihEJUIleiVxKSxGPU1hdGguZmxvb3IoKEQtVSklQiV6L3EpLFA9TWF0aC5mbG9vcigoRC1VLUYqcSklQi96KSxZPU1hdGguZmxvb3IoKEQtVS1GKnEtUCp6KS9CKSxHPVtdO2ZvcihsZXQgTj0wO048ci5sZW5ndGg7TisrKXtpZighY1tOXSljb250aW51ZTtjb25zdCAkPXBbTl07aWYoTWF0aC5hYnMoJC5iaW5YLShVKy41KSk+PWN0fHxNYXRoLmFicygkLmJpblktKEYrLjUpKT49Y3R8fE1hdGguYWJzKCQuYmluU2NhbGUtKFkrLjUpKT49Y3QpY29udGludWU7Y29uc3QgTD1NYXRoLmFicygkLmJpbkFuZ2xlLShQKy41KSk7TWF0aC5taW4oTCxmLUwpPj1jdHx8Ry5wdXNoKHJbTl0pfXJldHVybiBHfSx4dD0oe3F1ZXJ5cG9pbnQ6byxrZXlwb2ludDpuLGtleWNlbnRlclg6ZSxrZXljZW50ZXJZOnQsc2NhbGVPbmVPdmVyTG9nSzpzfSk9PntsZXQgcj1vLmFuZ2xlLW4uYW5nbGU7cjw9LU1hdGguUEk/cis9MipNYXRoLlBJOnI+TWF0aC5QSSYmKHItPTIqTWF0aC5QSSk7Y29uc3QgaT1vLnNjYWxlL24uc2NhbGUsaD1pKk1hdGguY29zKHIpLGw9aSpNYXRoLnNpbihyKSx1PVtoLC1sLGwsaF0sZj1bdVswXSpuLngrdVsxXSpuLnksdVsyXSpuLngrdVszXSpuLnldLGc9by54LWZbMF0sYT1vLnktZlsxXTtyZXR1cm57eDp1WzBdKmUrdVsxXSp0K2cseTp1WzJdKmUrdVszXSp0K2EsYW5nbGU6cixzY2FsZTpNYXRoLmxvZyhpKSpzfX0sQXQ9T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZztmdW5jdGlvbiBXKG8pe3JldHVybiBBdC5jYWxsKG8pLmVuZHNXaXRoKCJBcnJheV0iKX1mdW5jdGlvbiB0ZShvKXt2YXIgbj1hcmd1bWVudHMubGVuZ3RoPjEmJmFyZ3VtZW50c1sxXSE9PXZvaWQgMD9hcmd1bWVudHNbMV06e307aWYoIVcobykpdGhyb3cgbmV3IFR5cGVFcnJvcigiaW5wdXQgbXVzdCBiZSBhbiBhcnJheSIpO2lmKG8ubGVuZ3RoPT09MCl0aHJvdyBuZXcgVHlwZUVycm9yKCJpbnB1dCBtdXN0IG5vdCBiZSBlbXB0eSIpO3ZhciBlPW4uZnJvbUluZGV4LHQ9ZT09PXZvaWQgMD8wOmUscz1uLnRvSW5kZXgscj1zPT09dm9pZCAwP28ubGVuZ3RoOnM7aWYodDwwfHx0Pj1vLmxlbmd0aHx8IU51bWJlci5pc0ludGVnZXIodCkpdGhyb3cgbmV3IEVycm9yKCJmcm9tSW5kZXggbXVzdCBiZSBhIHBvc2l0aXZlIGludGVnZXIgc21hbGxlciB0aGFuIGxlbmd0aCIpO2lmKHI8PXR8fHI+by5sZW5ndGh8fCFOdW1iZXIuaXNJbnRlZ2VyKHIpKXRocm93IG5ldyBFcnJvcigidG9JbmRleCBtdXN0IGJlIGFuIGludGVnZXIgZ3JlYXRlciB0aGFuIGZyb21JbmRleCBhbmQgYXQgbW9zdCBlcXVhbCB0byBsZW5ndGgiKTtmb3IodmFyIGk9b1t0XSxoPXQrMTtoPHI7aCsrKW9baF0+aSYmKGk9b1toXSk7cmV0dXJuIGl9ZnVuY3Rpb24gZWUobyl7dmFyIG49YXJndW1lbnRzLmxlbmd0aD4xJiZhcmd1bWVudHNbMV0hPT12b2lkIDA/YXJndW1lbnRzWzFdOnt9O2lmKCFXKG8pKXRocm93IG5ldyBUeXBlRXJyb3IoImlucHV0IG11c3QgYmUgYW4gYXJyYXkiKTtpZihvLmxlbmd0aD09PTApdGhyb3cgbmV3IFR5cGVFcnJvcigiaW5wdXQgbXVzdCBub3QgYmUgZW1wdHkiKTt2YXIgZT1uLmZyb21JbmRleCx0PWU9PT12b2lkIDA/MDplLHM9bi50b0luZGV4LHI9cz09PXZvaWQgMD9vLmxlbmd0aDpzO2lmKHQ8MHx8dD49by5sZW5ndGh8fCFOdW1iZXIuaXNJbnRlZ2VyKHQpKXRocm93IG5ldyBFcnJvcigiZnJvbUluZGV4IG11c3QgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyIHNtYWxsZXIgdGhhbiBsZW5ndGgiKTtpZihyPD10fHxyPm8ubGVuZ3RofHwhTnVtYmVyLmlzSW50ZWdlcihyKSl0aHJvdyBuZXcgRXJyb3IoInRvSW5kZXggbXVzdCBiZSBhbiBpbnRlZ2VyIGdyZWF0ZXIgdGhhbiBmcm9tSW5kZXggYW5kIGF0IG1vc3QgZXF1YWwgdG8gbGVuZ3RoIik7Zm9yKHZhciBpPW9bdF0saD10KzE7aDxyO2grKylvW2hdPGkmJihpPW9baF0pO3JldHVybiBpfWZ1bmN0aW9uIHF0KG8pe3ZhciBuPWFyZ3VtZW50cy5sZW5ndGg+MSYmYXJndW1lbnRzWzFdIT09dm9pZCAwP2FyZ3VtZW50c1sxXTp7fTtpZihXKG8pKXtpZihvLmxlbmd0aD09PTApdGhyb3cgbmV3IFR5cGVFcnJvcigiaW5wdXQgbXVzdCBub3QgYmUgZW1wdHkiKX1lbHNlIHRocm93IG5ldyBUeXBlRXJyb3IoImlucHV0IG11c3QgYmUgYW4gYXJyYXkiKTt2YXIgZTtpZihuLm91dHB1dCE9PXZvaWQgMCl7aWYoIVcobi5vdXRwdXQpKXRocm93IG5ldyBUeXBlRXJyb3IoIm91dHB1dCBvcHRpb24gbXVzdCBiZSBhbiBhcnJheSBpZiBzcGVjaWZpZWQiKTtlPW4ub3V0cHV0fWVsc2UgZT1uZXcgQXJyYXkoby5sZW5ndGgpO3ZhciB0PWVlKG8pLHM9dGUobyk7aWYodD09PXMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIm1pbmltdW0gYW5kIG1heGltdW0gaW5wdXQgdmFsdWVzIGFyZSBlcXVhbC4gQ2Fubm90IHJlc2NhbGUgYSBjb25zdGFudCBhcnJheSIpO3ZhciByPW4ubWluLGk9cj09PXZvaWQgMD9uLmF1dG9NaW5NYXg/dDowOnIsaD1uLm1heCxsPWg9PT12b2lkIDA/bi5hdXRvTWluTWF4P3M6MTpoO2lmKGk+PWwpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIm1pbiBvcHRpb24gbXVzdCBiZSBzbWFsbGVyIHRoYW4gbWF4IG9wdGlvbiIpO2Zvcih2YXIgdT0obC1pKS8ocy10KSxmPTA7ZjxvLmxlbmd0aDtmKyspZVtmXT0ob1tmXS10KSp1K2k7cmV0dXJuIGV9Y29uc3QgZnQ9IiAiLnJlcGVhdCgyKSxfdD0iICIucmVwZWF0KDQpO2Z1bmN0aW9uIG5lKCl7cmV0dXJuIFR0KHRoaXMpfWZ1bmN0aW9uIFR0KG8sbj17fSl7Y29uc3R7bWF4Um93czplPTE1LG1heENvbHVtbnM6dD0xMCxtYXhOdW1TaXplOnM9OCxwYWRNaW51czpyPSJhdXRvIn09bjtyZXR1cm5gJHtvLmNvbnN0cnVjdG9yLm5hbWV9IHsKJHtmdH1bCiR7X3R9JHtzZShvLGUsdCxzLHIpfQoke2Z0fV0KJHtmdH1yb3dzOiAke28ucm93c30KJHtmdH1jb2x1bW5zOiAke28uY29sdW1uc30KfWB9ZnVuY3Rpb24gc2UobyxuLGUsdCxzKXtjb25zdHtyb3dzOnIsY29sdW1uczppfT1vLGg9TWF0aC5taW4ocixuKSxsPU1hdGgubWluKGksZSksdT1bXTtpZihzPT09ImF1dG8iKXtzPSExO3Q6Zm9yKGxldCBmPTA7ZjxoO2YrKylmb3IobGV0IGc9MDtnPGw7ZysrKWlmKG8uZ2V0KGYsZyk8MCl7cz0hMDticmVhayB0fX1mb3IobGV0IGY9MDtmPGg7ZisrKXtsZXQgZz1bXTtmb3IobGV0IGE9MDthPGw7YSsrKWcucHVzaChvZShvLmdldChmLGEpLHQscykpO3UucHVzaChgJHtnLmpvaW4oIiAiKX1gKX1yZXR1cm4gbCE9PWkmJih1W3UubGVuZ3RoLTFdKz1gIC4uLiAke2ktZX0gbW9yZSBjb2x1bW5zYCksaCE9PXImJnUucHVzaChgLi4uICR7ci1ufSBtb3JlIHJvd3NgKSx1LmpvaW4oYAoke190fWApfWZ1bmN0aW9uIG9lKG8sbixlKXtyZXR1cm4obz49MCYmZT9gICR7enQobyxuLTEpfWA6enQobyxuKSkucGFkRW5kKG4pfWZ1bmN0aW9uIHp0KG8sbil7bGV0IGU9by50b1N0cmluZygpO2lmKGUubGVuZ3RoPD1uKXJldHVybiBlO2xldCB0PW8udG9GaXhlZChuKTtpZih0Lmxlbmd0aD5uJiYodD1vLnRvRml4ZWQoTWF0aC5tYXgoMCxuLSh0Lmxlbmd0aC1uKSkpKSx0Lmxlbmd0aDw9biYmIXQuc3RhcnRzV2l0aCgiMC4wMDAiKSYmIXQuc3RhcnRzV2l0aCgiLTAuMDAwIikpcmV0dXJuIHQ7bGV0IHM9by50b0V4cG9uZW50aWFsKG4pO3JldHVybiBzLmxlbmd0aD5uJiYocz1vLnRvRXhwb25lbnRpYWwoTWF0aC5tYXgoMCxuLShzLmxlbmd0aC1uKSkpKSxzLnNsaWNlKDApfWZ1bmN0aW9uIHJlKG8sbil7by5wcm90b3R5cGUuYWRkPWZ1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdD09Im51bWJlciI/dGhpcy5hZGRTKHQpOnRoaXMuYWRkTSh0KX0sby5wcm90b3R5cGUuYWRkUz1mdW5jdGlvbih0KXtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpK3QpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5hZGRNPWZ1bmN0aW9uKHQpe2lmKHQ9bi5jaGVja01hdHJpeCh0KSx0aGlzLnJvd3MhPT10LnJvd3N8fHRoaXMuY29sdW1ucyE9PXQuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiTWF0cmljZXMgZGltZW5zaW9ucyBtdXN0IGJlIGVxdWFsIik7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKSt0LmdldChzLHIpKTtyZXR1cm4gdGhpc30sby5hZGQ9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IG4odCkuYWRkKHMpfSxvLnByb3RvdHlwZS5zdWI9ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0PT0ibnVtYmVyIj90aGlzLnN1YlModCk6dGhpcy5zdWJNKHQpfSxvLnByb3RvdHlwZS5zdWJTPWZ1bmN0aW9uKHQpe2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMsciktdCk7cmV0dXJuIHRoaXN9LG8ucHJvdG90eXBlLnN1Yk09ZnVuY3Rpb24odCl7aWYodD1uLmNoZWNrTWF0cml4KHQpLHRoaXMucm93cyE9PXQucm93c3x8dGhpcy5jb2x1bW5zIT09dC5jb2x1bW5zKXRocm93IG5ldyBSYW5nZUVycm9yKCJNYXRyaWNlcyBkaW1lbnNpb25zIG11c3QgYmUgZXF1YWwiKTtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpLXQuZ2V0KHMscikpO3JldHVybiB0aGlzfSxvLnN1Yj1mdW5jdGlvbih0LHMpe3JldHVybiBuZXcgbih0KS5zdWIocyl9LG8ucHJvdG90eXBlLnN1YnRyYWN0PW8ucHJvdG90eXBlLnN1YixvLnByb3RvdHlwZS5zdWJ0cmFjdFM9by5wcm90b3R5cGUuc3ViUyxvLnByb3RvdHlwZS5zdWJ0cmFjdE09by5wcm90b3R5cGUuc3ViTSxvLnN1YnRyYWN0PW8uc3ViLG8ucHJvdG90eXBlLm11bD1mdW5jdGlvbih0KXtyZXR1cm4gdHlwZW9mIHQ9PSJudW1iZXIiP3RoaXMubXVsUyh0KTp0aGlzLm11bE0odCl9LG8ucHJvdG90eXBlLm11bFM9ZnVuY3Rpb24odCl7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKSp0KTtyZXR1cm4gdGhpc30sby5wcm90b3R5cGUubXVsTT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscikqdC5nZXQocyxyKSk7cmV0dXJuIHRoaXN9LG8ubXVsPWZ1bmN0aW9uKHQscyl7cmV0dXJuIG5ldyBuKHQpLm11bChzKX0sby5wcm90b3R5cGUubXVsdGlwbHk9by5wcm90b3R5cGUubXVsLG8ucHJvdG90eXBlLm11bHRpcGx5Uz1vLnByb3RvdHlwZS5tdWxTLG8ucHJvdG90eXBlLm11bHRpcGx5TT1vLnByb3RvdHlwZS5tdWxNLG8ubXVsdGlwbHk9by5tdWwsby5wcm90b3R5cGUuZGl2PWZ1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdD09Im51bWJlciI/dGhpcy5kaXZTKHQpOnRoaXMuZGl2TSh0KX0sby5wcm90b3R5cGUuZGl2Uz1mdW5jdGlvbih0KXtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpL3QpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5kaXZNPWZ1bmN0aW9uKHQpe2lmKHQ9bi5jaGVja01hdHJpeCh0KSx0aGlzLnJvd3MhPT10LnJvd3N8fHRoaXMuY29sdW1ucyE9PXQuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiTWF0cmljZXMgZGltZW5zaW9ucyBtdXN0IGJlIGVxdWFsIik7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKS90LmdldChzLHIpKTtyZXR1cm4gdGhpc30sby5kaXY9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IG4odCkuZGl2KHMpfSxvLnByb3RvdHlwZS5kaXZpZGU9by5wcm90b3R5cGUuZGl2LG8ucHJvdG90eXBlLmRpdmlkZVM9by5wcm90b3R5cGUuZGl2UyxvLnByb3RvdHlwZS5kaXZpZGVNPW8ucHJvdG90eXBlLmRpdk0sby5kaXZpZGU9by5kaXYsby5wcm90b3R5cGUubW9kPWZ1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdD09Im51bWJlciI/dGhpcy5tb2RTKHQpOnRoaXMubW9kTSh0KX0sby5wcm90b3R5cGUubW9kUz1mdW5jdGlvbih0KXtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpJXQpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5tb2RNPWZ1bmN0aW9uKHQpe2lmKHQ9bi5jaGVja01hdHJpeCh0KSx0aGlzLnJvd3MhPT10LnJvd3N8fHRoaXMuY29sdW1ucyE9PXQuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiTWF0cmljZXMgZGltZW5zaW9ucyBtdXN0IGJlIGVxdWFsIik7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKSV0LmdldChzLHIpKTtyZXR1cm4gdGhpc30sby5tb2Q9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IG4odCkubW9kKHMpfSxvLnByb3RvdHlwZS5tb2R1bHVzPW8ucHJvdG90eXBlLm1vZCxvLnByb3RvdHlwZS5tb2R1bHVzUz1vLnByb3RvdHlwZS5tb2RTLG8ucHJvdG90eXBlLm1vZHVsdXNNPW8ucHJvdG90eXBlLm1vZE0sby5tb2R1bHVzPW8ubW9kLG8ucHJvdG90eXBlLmFuZD1mdW5jdGlvbih0KXtyZXR1cm4gdHlwZW9mIHQ9PSJudW1iZXIiP3RoaXMuYW5kUyh0KTp0aGlzLmFuZE0odCl9LG8ucHJvdG90eXBlLmFuZFM9ZnVuY3Rpb24odCl7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKSZ0KTtyZXR1cm4gdGhpc30sby5wcm90b3R5cGUuYW5kTT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscikmdC5nZXQocyxyKSk7cmV0dXJuIHRoaXN9LG8uYW5kPWZ1bmN0aW9uKHQscyl7cmV0dXJuIG5ldyBuKHQpLmFuZChzKX0sby5wcm90b3R5cGUub3I9ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0PT0ibnVtYmVyIj90aGlzLm9yUyh0KTp0aGlzLm9yTSh0KX0sby5wcm90b3R5cGUub3JTPWZ1bmN0aW9uKHQpe2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscil8dCk7cmV0dXJuIHRoaXN9LG8ucHJvdG90eXBlLm9yTT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscil8dC5nZXQocyxyKSk7cmV0dXJuIHRoaXN9LG8ub3I9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IG4odCkub3Iocyl9LG8ucHJvdG90eXBlLnhvcj1mdW5jdGlvbih0KXtyZXR1cm4gdHlwZW9mIHQ9PSJudW1iZXIiP3RoaXMueG9yUyh0KTp0aGlzLnhvck0odCl9LG8ucHJvdG90eXBlLnhvclM9ZnVuY3Rpb24odCl7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKV50KTtyZXR1cm4gdGhpc30sby5wcm90b3R5cGUueG9yTT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMsciledC5nZXQocyxyKSk7cmV0dXJuIHRoaXN9LG8ueG9yPWZ1bmN0aW9uKHQscyl7cmV0dXJuIG5ldyBuKHQpLnhvcihzKX0sby5wcm90b3R5cGUubGVmdFNoaWZ0PWZ1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdD09Im51bWJlciI/dGhpcy5sZWZ0U2hpZnRTKHQpOnRoaXMubGVmdFNoaWZ0TSh0KX0sby5wcm90b3R5cGUubGVmdFNoaWZ0Uz1mdW5jdGlvbih0KXtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpPDx0KTtyZXR1cm4gdGhpc30sby5wcm90b3R5cGUubGVmdFNoaWZ0TT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscik8PHQuZ2V0KHMscikpO3JldHVybiB0aGlzfSxvLmxlZnRTaGlmdD1mdW5jdGlvbih0LHMpe3JldHVybiBuZXcgbih0KS5sZWZ0U2hpZnQocyl9LG8ucHJvdG90eXBlLnNpZ25Qcm9wYWdhdGluZ1JpZ2h0U2hpZnQ9ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0PT0ibnVtYmVyIj90aGlzLnNpZ25Qcm9wYWdhdGluZ1JpZ2h0U2hpZnRTKHQpOnRoaXMuc2lnblByb3BhZ2F0aW5nUmlnaHRTaGlmdE0odCl9LG8ucHJvdG90eXBlLnNpZ25Qcm9wYWdhdGluZ1JpZ2h0U2hpZnRTPWZ1bmN0aW9uKHQpe2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscik+PnQpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5zaWduUHJvcGFnYXRpbmdSaWdodFNoaWZ0TT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscik+PnQuZ2V0KHMscikpO3JldHVybiB0aGlzfSxvLnNpZ25Qcm9wYWdhdGluZ1JpZ2h0U2hpZnQ9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IG4odCkuc2lnblByb3BhZ2F0aW5nUmlnaHRTaGlmdChzKX0sby5wcm90b3R5cGUucmlnaHRTaGlmdD1mdW5jdGlvbih0KXtyZXR1cm4gdHlwZW9mIHQ9PSJudW1iZXIiP3RoaXMucmlnaHRTaGlmdFModCk6dGhpcy5yaWdodFNoaWZ0TSh0KX0sby5wcm90b3R5cGUucmlnaHRTaGlmdFM9ZnVuY3Rpb24odCl7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKT4+PnQpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5yaWdodFNoaWZ0TT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscik+Pj50LmdldChzLHIpKTtyZXR1cm4gdGhpc30sby5yaWdodFNoaWZ0PWZ1bmN0aW9uKHQscyl7cmV0dXJuIG5ldyBuKHQpLnJpZ2h0U2hpZnQocyl9LG8ucHJvdG90eXBlLnplcm9GaWxsUmlnaHRTaGlmdD1vLnByb3RvdHlwZS5yaWdodFNoaWZ0LG8ucHJvdG90eXBlLnplcm9GaWxsUmlnaHRTaGlmdFM9by5wcm90b3R5cGUucmlnaHRTaGlmdFMsby5wcm90b3R5cGUuemVyb0ZpbGxSaWdodFNoaWZ0TT1vLnByb3RvdHlwZS5yaWdodFNoaWZ0TSxvLnplcm9GaWxsUmlnaHRTaGlmdD1vLnJpZ2h0U2hpZnQsby5wcm90b3R5cGUubm90PWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsfnRoaXMuZ2V0KHQscykpO3JldHVybiB0aGlzfSxvLm5vdD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkubm90KCl9LG8ucHJvdG90eXBlLmFicz1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguYWJzKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5hYnM9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmFicygpfSxvLnByb3RvdHlwZS5hY29zPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5hY29zKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5hY29zPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5hY29zKCl9LG8ucHJvdG90eXBlLmFjb3NoPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5hY29zaCh0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8uYWNvc2g9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmFjb3NoKCl9LG8ucHJvdG90eXBlLmFzaW49ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmFzaW4odGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmFzaW49ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmFzaW4oKX0sby5wcm90b3R5cGUuYXNpbmg9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmFzaW5oKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5hc2luaD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkuYXNpbmgoKX0sby5wcm90b3R5cGUuYXRhbj1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguYXRhbih0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8uYXRhbj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkuYXRhbigpfSxvLnByb3RvdHlwZS5hdGFuaD1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguYXRhbmgodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmF0YW5oPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5hdGFuaCgpfSxvLnByb3RvdHlwZS5jYnJ0PWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5jYnJ0KHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5jYnJ0PWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5jYnJ0KCl9LG8ucHJvdG90eXBlLmNlaWw9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmNlaWwodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmNlaWw9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmNlaWwoKX0sby5wcm90b3R5cGUuY2x6MzI9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmNsejMyKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5jbHozMj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkuY2x6MzIoKX0sby5wcm90b3R5cGUuY29zPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5jb3ModGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmNvcz1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkuY29zKCl9LG8ucHJvdG90eXBlLmNvc2g9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmNvc2godGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmNvc2g9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmNvc2goKX0sby5wcm90b3R5cGUuZXhwPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5leHAodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmV4cD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkuZXhwKCl9LG8ucHJvdG90eXBlLmV4cG0xPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5leHBtMSh0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8uZXhwbTE9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmV4cG0xKCl9LG8ucHJvdG90eXBlLmZsb29yPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5mbG9vcih0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8uZmxvb3I9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmZsb29yKCl9LG8ucHJvdG90eXBlLmZyb3VuZD1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguZnJvdW5kKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5mcm91bmQ9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmZyb3VuZCgpfSxvLnByb3RvdHlwZS5sb2c9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmxvZyh0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8ubG9nPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5sb2coKX0sby5wcm90b3R5cGUubG9nMXA9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmxvZzFwKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5sb2cxcD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkubG9nMXAoKX0sby5wcm90b3R5cGUubG9nMTA9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmxvZzEwKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5sb2cxMD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkubG9nMTAoKX0sby5wcm90b3R5cGUubG9nMj1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGgubG9nMih0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8ubG9nMj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkubG9nMigpfSxvLnByb3RvdHlwZS5yb3VuZD1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGgucm91bmQodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLnJvdW5kPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5yb3VuZCgpfSxvLnByb3RvdHlwZS5zaWduPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5zaWduKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5zaWduPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5zaWduKCl9LG8ucHJvdG90eXBlLnNpbj1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguc2luKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5zaW49ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLnNpbigpfSxvLnByb3RvdHlwZS5zaW5oPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5zaW5oKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5zaW5oPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5zaW5oKCl9LG8ucHJvdG90eXBlLnNxcnQ9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLnNxcnQodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLnNxcnQ9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLnNxcnQoKX0sby5wcm90b3R5cGUudGFuPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC50YW4odGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLnRhbj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkudGFuKCl9LG8ucHJvdG90eXBlLnRhbmg9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLnRhbmgodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLnRhbmg9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLnRhbmgoKX0sby5wcm90b3R5cGUudHJ1bmM9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLnRydW5jKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby50cnVuYz1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkudHJ1bmMoKX0sby5wb3c9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IG4odCkucG93KHMpfSxvLnByb3RvdHlwZS5wb3c9ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0PT0ibnVtYmVyIj90aGlzLnBvd1ModCk6dGhpcy5wb3dNKHQpfSxvLnByb3RvdHlwZS5wb3dTPWZ1bmN0aW9uKHQpe2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLE1hdGgucG93KHRoaXMuZ2V0KHMsciksdCkpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5wb3dNPWZ1bmN0aW9uKHQpe2lmKHQ9bi5jaGVja01hdHJpeCh0KSx0aGlzLnJvd3MhPT10LnJvd3N8fHRoaXMuY29sdW1ucyE9PXQuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiTWF0cmljZXMgZGltZW5zaW9ucyBtdXN0IGJlIGVxdWFsIik7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsTWF0aC5wb3codGhpcy5nZXQocyxyKSx0LmdldChzLHIpKSk7cmV0dXJuIHRoaXN9fWZ1bmN0aW9uIFEobyxuLGUpe2xldCB0PWU/by5yb3dzOm8ucm93cy0xO2lmKG48MHx8bj50KXRocm93IG5ldyBSYW5nZUVycm9yKCJSb3cgaW5kZXggb3V0IG9mIHJhbmdlIil9ZnVuY3Rpb24gWihvLG4sZSl7bGV0IHQ9ZT9vLmNvbHVtbnM6by5jb2x1bW5zLTE7aWYobjwwfHxuPnQpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkNvbHVtbiBpbmRleCBvdXQgb2YgcmFuZ2UiKX1mdW5jdGlvbiB0dChvLG4pe2lmKG4udG8xREFycmF5JiYobj1uLnRvMURBcnJheSgpKSxuLmxlbmd0aCE9PW8uY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigidmVjdG9yIHNpemUgbXVzdCBiZSB0aGUgc2FtZSBhcyB0aGUgbnVtYmVyIG9mIGNvbHVtbnMiKTtyZXR1cm4gbn1mdW5jdGlvbiBldChvLG4pe2lmKG4udG8xREFycmF5JiYobj1uLnRvMURBcnJheSgpKSxuLmxlbmd0aCE9PW8ucm93cyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigidmVjdG9yIHNpemUgbXVzdCBiZSB0aGUgc2FtZSBhcyB0aGUgbnVtYmVyIG9mIHJvd3MiKTtyZXR1cm4gbn1mdW5jdGlvbiBpZShvLG4pe2lmKCFXKG4pKXRocm93IG5ldyBUeXBlRXJyb3IoInJvdyBpbmRpY2VzIG11c3QgYmUgYW4gYXJyYXkiKTtmb3IobGV0IGU9MDtlPG4ubGVuZ3RoO2UrKylpZihuW2VdPDB8fG5bZV0+PW8ucm93cyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigicm93IGluZGljZXMgYXJlIG91dCBvZiByYW5nZSIpfWZ1bmN0aW9uIGxlKG8sbil7aWYoIVcobikpdGhyb3cgbmV3IFR5cGVFcnJvcigiY29sdW1uIGluZGljZXMgbXVzdCBiZSBhbiBhcnJheSIpO2ZvcihsZXQgZT0wO2U8bi5sZW5ndGg7ZSsrKWlmKG5bZV08MHx8bltlXT49by5jb2x1bW5zKXRocm93IG5ldyBSYW5nZUVycm9yKCJjb2x1bW4gaW5kaWNlcyBhcmUgb3V0IG9mIHJhbmdlIil9ZnVuY3Rpb24gRnQobyxuLGUsdCxzKXtpZihhcmd1bWVudHMubGVuZ3RoIT09NSl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiZXhwZWN0ZWQgNCBhcmd1bWVudHMiKTtpZihhdCgic3RhcnRSb3ciLG4pLGF0KCJlbmRSb3ciLGUpLGF0KCJzdGFydENvbHVtbiIsdCksYXQoImVuZENvbHVtbiIscyksbj5lfHx0PnN8fG48MHx8bj49by5yb3dzfHxlPDB8fGU+PW8ucm93c3x8dDwwfHx0Pj1vLmNvbHVtbnN8fHM8MHx8cz49by5jb2x1bW5zKXRocm93IG5ldyBSYW5nZUVycm9yKCJTdWJtYXRyaXggaW5kaWNlcyBhcmUgb3V0IG9mIHJhbmdlIil9ZnVuY3Rpb24gZ3QobyxuPTApe2xldCBlPVtdO2ZvcihsZXQgdD0wO3Q8bzt0KyspZS5wdXNoKG4pO3JldHVybiBlfWZ1bmN0aW9uIGF0KG8sbil7aWYodHlwZW9mIG4hPSJudW1iZXIiKXRocm93IG5ldyBUeXBlRXJyb3IoYCR7b30gbXVzdCBiZSBhIG51bWJlcmApfWZ1bmN0aW9uIG50KG8pe2lmKG8uaXNFbXB0eSgpKXRocm93IG5ldyBFcnJvcigiRW1wdHkgbWF0cml4IGhhcyBubyBlbGVtZW50cyB0byBpbmRleCIpfWZ1bmN0aW9uIGhlKG8pe2xldCBuPWd0KG8ucm93cyk7Zm9yKGxldCBlPTA7ZTxvLnJvd3M7KytlKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zOysrdCluW2VdKz1vLmdldChlLHQpO3JldHVybiBufWZ1bmN0aW9uIHVlKG8pe2xldCBuPWd0KG8uY29sdW1ucyk7Zm9yKGxldCBlPTA7ZTxvLnJvd3M7KytlKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zOysrdCluW3RdKz1vLmdldChlLHQpO3JldHVybiBufWZ1bmN0aW9uIGNlKG8pe2xldCBuPTA7Zm9yKGxldCBlPTA7ZTxvLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zO3QrKyluKz1vLmdldChlLHQpO3JldHVybiBufWZ1bmN0aW9uIGZlKG8pe2xldCBuPWd0KG8ucm93cywxKTtmb3IobGV0IGU9MDtlPG8ucm93czsrK2UpZm9yKGxldCB0PTA7dDxvLmNvbHVtbnM7Kyt0KW5bZV0qPW8uZ2V0KGUsdCk7cmV0dXJuIG59ZnVuY3Rpb24gZ2Uobyl7bGV0IG49Z3Qoby5jb2x1bW5zLDEpO2ZvcihsZXQgZT0wO2U8by5yb3dzOysrZSlmb3IobGV0IHQ9MDt0PG8uY29sdW1uczsrK3Qpblt0XSo9by5nZXQoZSx0KTtyZXR1cm4gbn1mdW5jdGlvbiBhZShvKXtsZXQgbj0xO2ZvcihsZXQgZT0wO2U8by5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PG8uY29sdW1uczt0Kyspbio9by5nZXQoZSx0KTtyZXR1cm4gbn1mdW5jdGlvbiBtZShvLG4sZSl7Y29uc3QgdD1vLnJvd3Mscz1vLmNvbHVtbnMscj1bXTtmb3IobGV0IGk9MDtpPHQ7aSsrKXtsZXQgaD0wLGw9MCx1PTA7Zm9yKGxldCBmPTA7ZjxzO2YrKyl1PW8uZ2V0KGksZiktZVtpXSxoKz11LGwrPXUqdTtuP3IucHVzaCgobC1oKmgvcykvKHMtMSkpOnIucHVzaCgobC1oKmgvcykvcyl9cmV0dXJuIHJ9ZnVuY3Rpb24gd2UobyxuLGUpe2NvbnN0IHQ9by5yb3dzLHM9by5jb2x1bW5zLHI9W107Zm9yKGxldCBpPTA7aTxzO2krKyl7bGV0IGg9MCxsPTAsdT0wO2ZvcihsZXQgZj0wO2Y8dDtmKyspdT1vLmdldChmLGkpLWVbaV0saCs9dSxsKz11KnU7bj9yLnB1c2goKGwtaCpoL3QpLyh0LTEpKTpyLnB1c2goKGwtaCpoL3QpL3QpfXJldHVybiByfWZ1bmN0aW9uIHBlKG8sbixlKXtjb25zdCB0PW8ucm93cyxzPW8uY29sdW1ucyxyPXQqcztsZXQgaT0wLGg9MCxsPTA7Zm9yKGxldCB1PTA7dTx0O3UrKylmb3IobGV0IGY9MDtmPHM7ZisrKWw9by5nZXQodSxmKS1lLGkrPWwsaCs9bCpsO3JldHVybiBuPyhoLWkqaS9yKS8oci0xKTooaC1pKmkvcikvcn1mdW5jdGlvbiBkZShvLG4pe2ZvcihsZXQgZT0wO2U8by5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PG8uY29sdW1uczt0Kyspby5zZXQoZSx0LG8uZ2V0KGUsdCktbltlXSl9ZnVuY3Rpb24geWUobyxuKXtmb3IobGV0IGU9MDtlPG8ucm93cztlKyspZm9yKGxldCB0PTA7dDxvLmNvbHVtbnM7dCsrKW8uc2V0KGUsdCxvLmdldChlLHQpLW5bdF0pfWZ1bmN0aW9uIE1lKG8sbil7Zm9yKGxldCBlPTA7ZTxvLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zO3QrKylvLnNldChlLHQsby5nZXQoZSx0KS1uKX1mdW5jdGlvbiBFZShvKXtjb25zdCBuPVtdO2ZvcihsZXQgZT0wO2U8by5yb3dzO2UrKyl7bGV0IHQ9MDtmb3IobGV0IHM9MDtzPG8uY29sdW1ucztzKyspdCs9TWF0aC5wb3coby5nZXQoZSxzKSwyKS8oby5jb2x1bW5zLTEpO24ucHVzaChNYXRoLnNxcnQodCkpfXJldHVybiBufWZ1bmN0aW9uIFNlKG8sbil7Zm9yKGxldCBlPTA7ZTxvLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zO3QrKylvLnNldChlLHQsby5nZXQoZSx0KS9uW2VdKX1mdW5jdGlvbiBqZShvKXtjb25zdCBuPVtdO2ZvcihsZXQgZT0wO2U8by5jb2x1bW5zO2UrKyl7bGV0IHQ9MDtmb3IobGV0IHM9MDtzPG8ucm93cztzKyspdCs9TWF0aC5wb3coby5nZXQocyxlKSwyKS8oby5yb3dzLTEpO24ucHVzaChNYXRoLnNxcnQodCkpfXJldHVybiBufWZ1bmN0aW9uIGtlKG8sbil7Zm9yKGxldCBlPTA7ZTxvLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zO3QrKylvLnNldChlLHQsby5nZXQoZSx0KS9uW3RdKX1mdW5jdGlvbiBiZShvKXtjb25zdCBuPW8uc2l6ZS0xO2xldCBlPTA7Zm9yKGxldCB0PTA7dDxvLmNvbHVtbnM7dCsrKWZvcihsZXQgcz0wO3M8by5yb3dzO3MrKyllKz1NYXRoLnBvdyhvLmdldChzLHQpLDIpL247cmV0dXJuIE1hdGguc3FydChlKX1mdW5jdGlvbiBJZShvLG4pe2ZvcihsZXQgZT0wO2U8by5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PG8uY29sdW1uczt0Kyspby5zZXQoZSx0LG8uZ2V0KGUsdCkvbil9Y2xhc3MgX3tzdGF0aWMgZnJvbTFEQXJyYXkobixlLHQpe2lmKG4qZSE9PXQubGVuZ3RoKXRocm93IG5ldyBSYW5nZUVycm9yKCJkYXRhIGxlbmd0aCBkb2VzIG5vdCBtYXRjaCBnaXZlbiBkaW1lbnNpb25zIik7bGV0IHI9bmV3IGIobixlKTtmb3IobGV0IGk9MDtpPG47aSsrKWZvcihsZXQgaD0wO2g8ZTtoKyspci5zZXQoaSxoLHRbaSplK2hdKTtyZXR1cm4gcn1zdGF0aWMgcm93VmVjdG9yKG4pe2xldCBlPW5ldyBiKDEsbi5sZW5ndGgpO2ZvcihsZXQgdD0wO3Q8bi5sZW5ndGg7dCsrKWUuc2V0KDAsdCxuW3RdKTtyZXR1cm4gZX1zdGF0aWMgY29sdW1uVmVjdG9yKG4pe2xldCBlPW5ldyBiKG4ubGVuZ3RoLDEpO2ZvcihsZXQgdD0wO3Q8bi5sZW5ndGg7dCsrKWUuc2V0KHQsMCxuW3RdKTtyZXR1cm4gZX1zdGF0aWMgemVyb3MobixlKXtyZXR1cm4gbmV3IGIobixlKX1zdGF0aWMgb25lcyhuLGUpe3JldHVybiBuZXcgYihuLGUpLmZpbGwoMSl9c3RhdGljIHJhbmQobixlLHQ9e30pe2lmKHR5cGVvZiB0IT0ib2JqZWN0Iil0aHJvdyBuZXcgVHlwZUVycm9yKCJvcHRpb25zIG11c3QgYmUgYW4gb2JqZWN0Iik7Y29uc3R7cmFuZG9tOnM9TWF0aC5yYW5kb219PXQ7bGV0IHI9bmV3IGIobixlKTtmb3IobGV0IGk9MDtpPG47aSsrKWZvcihsZXQgaD0wO2g8ZTtoKyspci5zZXQoaSxoLHMoKSk7cmV0dXJuIHJ9c3RhdGljIHJhbmRJbnQobixlLHQ9e30pe2lmKHR5cGVvZiB0IT0ib2JqZWN0Iil0aHJvdyBuZXcgVHlwZUVycm9yKCJvcHRpb25zIG11c3QgYmUgYW4gb2JqZWN0Iik7Y29uc3R7bWluOnM9MCxtYXg6cj0xZTMscmFuZG9tOmk9TWF0aC5yYW5kb219PXQ7aWYoIU51bWJlci5pc0ludGVnZXIocykpdGhyb3cgbmV3IFR5cGVFcnJvcigibWluIG11c3QgYmUgYW4gaW50ZWdlciIpO2lmKCFOdW1iZXIuaXNJbnRlZ2VyKHIpKXRocm93IG5ldyBUeXBlRXJyb3IoIm1heCBtdXN0IGJlIGFuIGludGVnZXIiKTtpZihzPj1yKXRocm93IG5ldyBSYW5nZUVycm9yKCJtaW4gbXVzdCBiZSBzbWFsbGVyIHRoYW4gbWF4Iik7bGV0IGg9ci1zLGw9bmV3IGIobixlKTtmb3IobGV0IHU9MDt1PG47dSsrKWZvcihsZXQgZj0wO2Y8ZTtmKyspe2xldCBnPXMrTWF0aC5yb3VuZChpKCkqaCk7bC5zZXQodSxmLGcpfXJldHVybiBsfXN0YXRpYyBleWUobixlLHQpe2U9PT12b2lkIDAmJihlPW4pLHQ9PT12b2lkIDAmJih0PTEpO2xldCBzPU1hdGgubWluKG4sZSkscj10aGlzLnplcm9zKG4sZSk7Zm9yKGxldCBpPTA7aTxzO2krKylyLnNldChpLGksdCk7cmV0dXJuIHJ9c3RhdGljIGRpYWcobixlLHQpe2xldCBzPW4ubGVuZ3RoO2U9PT12b2lkIDAmJihlPXMpLHQ9PT12b2lkIDAmJih0PWUpO2xldCByPU1hdGgubWluKHMsZSx0KSxpPXRoaXMuemVyb3MoZSx0KTtmb3IobGV0IGg9MDtoPHI7aCsrKWkuc2V0KGgsaCxuW2hdKTtyZXR1cm4gaX1zdGF0aWMgbWluKG4sZSl7bj10aGlzLmNoZWNrTWF0cml4KG4pLGU9dGhpcy5jaGVja01hdHJpeChlKTtsZXQgdD1uLnJvd3Mscz1uLmNvbHVtbnMscj1uZXcgYih0LHMpO2ZvcihsZXQgaT0wO2k8dDtpKyspZm9yKGxldCBoPTA7aDxzO2grKylyLnNldChpLGgsTWF0aC5taW4obi5nZXQoaSxoKSxlLmdldChpLGgpKSk7cmV0dXJuIHJ9c3RhdGljIG1heChuLGUpe249dGhpcy5jaGVja01hdHJpeChuKSxlPXRoaXMuY2hlY2tNYXRyaXgoZSk7bGV0IHQ9bi5yb3dzLHM9bi5jb2x1bW5zLHI9bmV3IHRoaXModCxzKTtmb3IobGV0IGk9MDtpPHQ7aSsrKWZvcihsZXQgaD0wO2g8cztoKyspci5zZXQoaSxoLE1hdGgubWF4KG4uZ2V0KGksaCksZS5nZXQoaSxoKSkpO3JldHVybiByfXN0YXRpYyBjaGVja01hdHJpeChuKXtyZXR1cm4gXy5pc01hdHJpeChuKT9uOm5ldyBiKG4pfXN0YXRpYyBpc01hdHJpeChuKXtyZXR1cm4gbiE9bnVsbCYmbi5rbGFzcz09PSJNYXRyaXgifWdldCBzaXplKCl7cmV0dXJuIHRoaXMucm93cyp0aGlzLmNvbHVtbnN9YXBwbHkobil7aWYodHlwZW9mIG4hPSJmdW5jdGlvbiIpdGhyb3cgbmV3IFR5cGVFcnJvcigiY2FsbGJhY2sgbXVzdCBiZSBhIGZ1bmN0aW9uIik7Zm9yKGxldCBlPTA7ZTx0aGlzLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyluLmNhbGwodGhpcyxlLHQpO3JldHVybiB0aGlzfXRvMURBcnJheSgpe2xldCBuPVtdO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0Kyspbi5wdXNoKHRoaXMuZ2V0KGUsdCkpO3JldHVybiBufXRvMkRBcnJheSgpe2xldCBuPVtdO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKyl7bi5wdXNoKFtdKTtmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspbltlXS5wdXNoKHRoaXMuZ2V0KGUsdCkpfXJldHVybiBufXRvSlNPTigpe3JldHVybiB0aGlzLnRvMkRBcnJheSgpfWlzUm93VmVjdG9yKCl7cmV0dXJuIHRoaXMucm93cz09PTF9aXNDb2x1bW5WZWN0b3IoKXtyZXR1cm4gdGhpcy5jb2x1bW5zPT09MX1pc1ZlY3Rvcigpe3JldHVybiB0aGlzLnJvd3M9PT0xfHx0aGlzLmNvbHVtbnM9PT0xfWlzU3F1YXJlKCl7cmV0dXJuIHRoaXMucm93cz09PXRoaXMuY29sdW1uc31pc0VtcHR5KCl7cmV0dXJuIHRoaXMucm93cz09PTB8fHRoaXMuY29sdW1ucz09PTB9aXNTeW1tZXRyaWMoKXtpZih0aGlzLmlzU3F1YXJlKCkpe2ZvcihsZXQgbj0wO248dGhpcy5yb3dzO24rKylmb3IobGV0IGU9MDtlPD1uO2UrKylpZih0aGlzLmdldChuLGUpIT09dGhpcy5nZXQoZSxuKSlyZXR1cm4hMTtyZXR1cm4hMH1yZXR1cm4hMX1pc0VjaGVsb25Gb3JtKCl7bGV0IG49MCxlPTAsdD0tMSxzPSEwLHI9ITE7Zm9yKDtuPHRoaXMucm93cyYmczspe2ZvcihlPTAscj0hMTtlPHRoaXMuY29sdW1ucyYmcj09PSExOyl0aGlzLmdldChuLGUpPT09MD9lKys6dGhpcy5nZXQobixlKT09PTEmJmU+dD8ocj0hMCx0PWUpOihzPSExLHI9ITApO24rK31yZXR1cm4gc31pc1JlZHVjZWRFY2hlbG9uRm9ybSgpe2xldCBuPTAsZT0wLHQ9LTEscz0hMCxyPSExO2Zvcig7bjx0aGlzLnJvd3MmJnM7KXtmb3IoZT0wLHI9ITE7ZTx0aGlzLmNvbHVtbnMmJnI9PT0hMTspdGhpcy5nZXQobixlKT09PTA/ZSsrOnRoaXMuZ2V0KG4sZSk9PT0xJiZlPnQ/KHI9ITAsdD1lKToocz0hMSxyPSEwKTtmb3IobGV0IGk9ZSsxO2k8dGhpcy5yb3dzO2krKyl0aGlzLmdldChuLGkpIT09MCYmKHM9ITEpO24rK31yZXR1cm4gc31lY2hlbG9uRm9ybSgpe2xldCBuPXRoaXMuY2xvbmUoKSxlPTAsdD0wO2Zvcig7ZTxuLnJvd3MmJnQ8bi5jb2x1bW5zOyl7bGV0IHM9ZTtmb3IobGV0IHI9ZTtyPG4ucm93cztyKyspbi5nZXQocix0KT5uLmdldChzLHQpJiYocz1yKTtpZihuLmdldChzLHQpPT09MCl0Kys7ZWxzZXtuLnN3YXBSb3dzKGUscyk7bGV0IHI9bi5nZXQoZSx0KTtmb3IobGV0IGk9dDtpPG4uY29sdW1ucztpKyspbi5zZXQoZSxpLG4uZ2V0KGUsaSkvcik7Zm9yKGxldCBpPWUrMTtpPG4ucm93cztpKyspe2xldCBoPW4uZ2V0KGksdCkvbi5nZXQoZSx0KTtuLnNldChpLHQsMCk7Zm9yKGxldCBsPXQrMTtsPG4uY29sdW1ucztsKyspbi5zZXQoaSxsLG4uZ2V0KGksbCktbi5nZXQoZSxsKSpoKX1lKyssdCsrfX1yZXR1cm4gbn1yZWR1Y2VkRWNoZWxvbkZvcm0oKXtsZXQgbj10aGlzLmVjaGVsb25Gb3JtKCksZT1uLmNvbHVtbnMsdD1uLnJvd3Mscz10LTE7Zm9yKDtzPj0wOylpZihuLm1heFJvdyhzKT09PTApcy0tO2Vsc2V7bGV0IHI9MCxpPSExO2Zvcig7cjx0JiZpPT09ITE7KW4uZ2V0KHMscik9PT0xP2k9ITA6cisrO2ZvcihsZXQgaD0wO2g8cztoKyspe2xldCBsPW4uZ2V0KGgscik7Zm9yKGxldCB1PXI7dTxlO3UrKyl7bGV0IGY9bi5nZXQoaCx1KS1sKm4uZ2V0KHMsdSk7bi5zZXQoaCx1LGYpfX1zLS19cmV0dXJuIG59c2V0KCl7dGhyb3cgbmV3IEVycm9yKCJzZXQgbWV0aG9kIGlzIHVuaW1wbGVtZW50ZWQiKX1nZXQoKXt0aHJvdyBuZXcgRXJyb3IoImdldCBtZXRob2QgaXMgdW5pbXBsZW1lbnRlZCIpfXJlcGVhdChuPXt9KXtpZih0eXBlb2YgbiE9Im9iamVjdCIpdGhyb3cgbmV3IFR5cGVFcnJvcigib3B0aW9ucyBtdXN0IGJlIGFuIG9iamVjdCIpO2NvbnN0e3Jvd3M6ZT0xLGNvbHVtbnM6dD0xfT1uO2lmKCFOdW1iZXIuaXNJbnRlZ2VyKGUpfHxlPD0wKXRocm93IG5ldyBUeXBlRXJyb3IoInJvd3MgbXVzdCBiZSBhIHBvc2l0aXZlIGludGVnZXIiKTtpZighTnVtYmVyLmlzSW50ZWdlcih0KXx8dDw9MCl0aHJvdyBuZXcgVHlwZUVycm9yKCJjb2x1bW5zIG11c3QgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyIik7bGV0IHM9bmV3IGIodGhpcy5yb3dzKmUsdGhpcy5jb2x1bW5zKnQpO2ZvcihsZXQgcj0wO3I8ZTtyKyspZm9yKGxldCBpPTA7aTx0O2krKylzLnNldFN1Yk1hdHJpeCh0aGlzLHRoaXMucm93cypyLHRoaXMuY29sdW1ucyppKTtyZXR1cm4gc31maWxsKG4pe2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5zZXQoZSx0LG4pO3JldHVybiB0aGlzfW5lZygpe3JldHVybiB0aGlzLm11bFMoLTEpfWdldFJvdyhuKXtRKHRoaXMsbik7bGV0IGU9W107Zm9yKGxldCB0PTA7dDx0aGlzLmNvbHVtbnM7dCsrKWUucHVzaCh0aGlzLmdldChuLHQpKTtyZXR1cm4gZX1nZXRSb3dWZWN0b3Iobil7cmV0dXJuIGIucm93VmVjdG9yKHRoaXMuZ2V0Um93KG4pKX1zZXRSb3cobixlKXtRKHRoaXMsbiksZT10dCh0aGlzLGUpO2ZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChuLHQsZVt0XSk7cmV0dXJuIHRoaXN9c3dhcFJvd3MobixlKXtRKHRoaXMsbiksUSh0aGlzLGUpO2ZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl7bGV0IHM9dGhpcy5nZXQobix0KTt0aGlzLnNldChuLHQsdGhpcy5nZXQoZSx0KSksdGhpcy5zZXQoZSx0LHMpfXJldHVybiB0aGlzfWdldENvbHVtbihuKXtaKHRoaXMsbik7bGV0IGU9W107Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWUucHVzaCh0aGlzLmdldCh0LG4pKTtyZXR1cm4gZX1nZXRDb2x1bW5WZWN0b3Iobil7cmV0dXJuIGIuY29sdW1uVmVjdG9yKHRoaXMuZ2V0Q29sdW1uKG4pKX1zZXRDb2x1bW4obixlKXtaKHRoaXMsbiksZT1ldCh0aGlzLGUpO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKyl0aGlzLnNldCh0LG4sZVt0XSk7cmV0dXJuIHRoaXN9c3dhcENvbHVtbnMobixlKXtaKHRoaXMsbiksWih0aGlzLGUpO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKyl7bGV0IHM9dGhpcy5nZXQodCxuKTt0aGlzLnNldCh0LG4sdGhpcy5nZXQodCxlKSksdGhpcy5zZXQodCxlLHMpfXJldHVybiB0aGlzfWFkZFJvd1ZlY3RvcihuKXtuPXR0KHRoaXMsbik7Zm9yKGxldCBlPTA7ZTx0aGlzLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChlLHQsdGhpcy5nZXQoZSx0KStuW3RdKTtyZXR1cm4gdGhpc31zdWJSb3dWZWN0b3Iobil7bj10dCh0aGlzLG4pO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5zZXQoZSx0LHRoaXMuZ2V0KGUsdCktblt0XSk7cmV0dXJuIHRoaXN9bXVsUm93VmVjdG9yKG4pe249dHQodGhpcyxuKTtmb3IobGV0IGU9MDtlPHRoaXMucm93cztlKyspZm9yKGxldCB0PTA7dDx0aGlzLmNvbHVtbnM7dCsrKXRoaXMuc2V0KGUsdCx0aGlzLmdldChlLHQpKm5bdF0pO3JldHVybiB0aGlzfWRpdlJvd1ZlY3RvcihuKXtuPXR0KHRoaXMsbik7Zm9yKGxldCBlPTA7ZTx0aGlzLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChlLHQsdGhpcy5nZXQoZSx0KS9uW3RdKTtyZXR1cm4gdGhpc31hZGRDb2x1bW5WZWN0b3Iobil7bj1ldCh0aGlzLG4pO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5zZXQoZSx0LHRoaXMuZ2V0KGUsdCkrbltlXSk7cmV0dXJuIHRoaXN9c3ViQ29sdW1uVmVjdG9yKG4pe249ZXQodGhpcyxuKTtmb3IobGV0IGU9MDtlPHRoaXMucm93cztlKyspZm9yKGxldCB0PTA7dDx0aGlzLmNvbHVtbnM7dCsrKXRoaXMuc2V0KGUsdCx0aGlzLmdldChlLHQpLW5bZV0pO3JldHVybiB0aGlzfW11bENvbHVtblZlY3RvcihuKXtuPWV0KHRoaXMsbik7Zm9yKGxldCBlPTA7ZTx0aGlzLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChlLHQsdGhpcy5nZXQoZSx0KSpuW2VdKTtyZXR1cm4gdGhpc31kaXZDb2x1bW5WZWN0b3Iobil7bj1ldCh0aGlzLG4pO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5zZXQoZSx0LHRoaXMuZ2V0KGUsdCkvbltlXSk7cmV0dXJuIHRoaXN9bXVsUm93KG4sZSl7USh0aGlzLG4pO2ZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChuLHQsdGhpcy5nZXQobix0KSplKTtyZXR1cm4gdGhpc31tdWxDb2x1bW4obixlKXtaKHRoaXMsbik7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKXRoaXMuc2V0KHQsbix0aGlzLmdldCh0LG4pKmUpO3JldHVybiB0aGlzfW1heChuKXtpZih0aGlzLmlzRW1wdHkoKSlyZXR1cm4gTmFOO3N3aXRjaChuKXtjYXNlInJvdyI6e2NvbnN0IGU9bmV3IEFycmF5KHRoaXMucm93cykuZmlsbChOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkpO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5nZXQodCxzKT5lW3RdJiYoZVt0XT10aGlzLmdldCh0LHMpKTtyZXR1cm4gZX1jYXNlImNvbHVtbiI6e2NvbnN0IGU9bmV3IEFycmF5KHRoaXMuY29sdW1ucykuZmlsbChOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkpO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5nZXQodCxzKT5lW3NdJiYoZVtzXT10aGlzLmdldCh0LHMpKTtyZXR1cm4gZX1jYXNlIHZvaWQgMDp7bGV0IGU9dGhpcy5nZXQoMCwwKTtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuZ2V0KHQscyk+ZSYmKGU9dGhpcy5nZXQodCxzKSk7cmV0dXJuIGV9ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgb3B0aW9uOiAke259YCl9fW1heEluZGV4KCl7bnQodGhpcyk7bGV0IG49dGhpcy5nZXQoMCwwKSxlPVswLDBdO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5nZXQodCxzKT5uJiYobj10aGlzLmdldCh0LHMpLGVbMF09dCxlWzFdPXMpO3JldHVybiBlfW1pbihuKXtpZih0aGlzLmlzRW1wdHkoKSlyZXR1cm4gTmFOO3N3aXRjaChuKXtjYXNlInJvdyI6e2NvbnN0IGU9bmV3IEFycmF5KHRoaXMucm93cykuZmlsbChOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5nZXQodCxzKTxlW3RdJiYoZVt0XT10aGlzLmdldCh0LHMpKTtyZXR1cm4gZX1jYXNlImNvbHVtbiI6e2NvbnN0IGU9bmV3IEFycmF5KHRoaXMuY29sdW1ucykuZmlsbChOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5nZXQodCxzKTxlW3NdJiYoZVtzXT10aGlzLmdldCh0LHMpKTtyZXR1cm4gZX1jYXNlIHZvaWQgMDp7bGV0IGU9dGhpcy5nZXQoMCwwKTtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuZ2V0KHQscyk8ZSYmKGU9dGhpcy5nZXQodCxzKSk7cmV0dXJuIGV9ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgb3B0aW9uOiAke259YCl9fW1pbkluZGV4KCl7bnQodGhpcyk7bGV0IG49dGhpcy5nZXQoMCwwKSxlPVswLDBdO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5nZXQodCxzKTxuJiYobj10aGlzLmdldCh0LHMpLGVbMF09dCxlWzFdPXMpO3JldHVybiBlfW1heFJvdyhuKXtpZihRKHRoaXMsbiksdGhpcy5pc0VtcHR5KCkpcmV0dXJuIE5hTjtsZXQgZT10aGlzLmdldChuLDApO2ZvcihsZXQgdD0xO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLmdldChuLHQpPmUmJihlPXRoaXMuZ2V0KG4sdCkpO3JldHVybiBlfW1heFJvd0luZGV4KG4pe1EodGhpcyxuKSxudCh0aGlzKTtsZXQgZT10aGlzLmdldChuLDApLHQ9W24sMF07Zm9yKGxldCBzPTE7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuZ2V0KG4scyk+ZSYmKGU9dGhpcy5nZXQobixzKSx0WzFdPXMpO3JldHVybiB0fW1pblJvdyhuKXtpZihRKHRoaXMsbiksdGhpcy5pc0VtcHR5KCkpcmV0dXJuIE5hTjtsZXQgZT10aGlzLmdldChuLDApO2ZvcihsZXQgdD0xO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLmdldChuLHQpPGUmJihlPXRoaXMuZ2V0KG4sdCkpO3JldHVybiBlfW1pblJvd0luZGV4KG4pe1EodGhpcyxuKSxudCh0aGlzKTtsZXQgZT10aGlzLmdldChuLDApLHQ9W24sMF07Zm9yKGxldCBzPTE7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuZ2V0KG4scyk8ZSYmKGU9dGhpcy5nZXQobixzKSx0WzFdPXMpO3JldHVybiB0fW1heENvbHVtbihuKXtpZihaKHRoaXMsbiksdGhpcy5pc0VtcHR5KCkpcmV0dXJuIE5hTjtsZXQgZT10aGlzLmdldCgwLG4pO2ZvcihsZXQgdD0xO3Q8dGhpcy5yb3dzO3QrKyl0aGlzLmdldCh0LG4pPmUmJihlPXRoaXMuZ2V0KHQsbikpO3JldHVybiBlfW1heENvbHVtbkluZGV4KG4pe1oodGhpcyxuKSxudCh0aGlzKTtsZXQgZT10aGlzLmdldCgwLG4pLHQ9WzAsbl07Zm9yKGxldCBzPTE7czx0aGlzLnJvd3M7cysrKXRoaXMuZ2V0KHMsbik+ZSYmKGU9dGhpcy5nZXQocyxuKSx0WzBdPXMpO3JldHVybiB0fW1pbkNvbHVtbihuKXtpZihaKHRoaXMsbiksdGhpcy5pc0VtcHR5KCkpcmV0dXJuIE5hTjtsZXQgZT10aGlzLmdldCgwLG4pO2ZvcihsZXQgdD0xO3Q8dGhpcy5yb3dzO3QrKyl0aGlzLmdldCh0LG4pPGUmJihlPXRoaXMuZ2V0KHQsbikpO3JldHVybiBlfW1pbkNvbHVtbkluZGV4KG4pe1oodGhpcyxuKSxudCh0aGlzKTtsZXQgZT10aGlzLmdldCgwLG4pLHQ9WzAsbl07Zm9yKGxldCBzPTE7czx0aGlzLnJvd3M7cysrKXRoaXMuZ2V0KHMsbik8ZSYmKGU9dGhpcy5nZXQocyxuKSx0WzBdPXMpO3JldHVybiB0fWRpYWcoKXtsZXQgbj1NYXRoLm1pbih0aGlzLnJvd3MsdGhpcy5jb2x1bW5zKSxlPVtdO2ZvcihsZXQgdD0wO3Q8bjt0KyspZS5wdXNoKHRoaXMuZ2V0KHQsdCkpO3JldHVybiBlfW5vcm0obj0iZnJvYmVuaXVzIil7bGV0IGU9MDtpZihuPT09Im1heCIpcmV0dXJuIHRoaXMubWF4KCk7aWYobj09PSJmcm9iZW5pdXMiKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKWU9ZSt0aGlzLmdldCh0LHMpKnRoaXMuZ2V0KHQscyk7cmV0dXJuIE1hdGguc3FydChlKX1lbHNlIHRocm93IG5ldyBSYW5nZUVycm9yKGB1bmtub3duIG5vcm0gdHlwZTogJHtufWApfWN1bXVsYXRpdmVTdW0oKXtsZXQgbj0wO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0Kyspbis9dGhpcy5nZXQoZSx0KSx0aGlzLnNldChlLHQsbik7cmV0dXJuIHRoaXN9ZG90KG4pe18uaXNNYXRyaXgobikmJihuPW4udG8xREFycmF5KCkpO2xldCBlPXRoaXMudG8xREFycmF5KCk7aWYoZS5sZW5ndGghPT1uLmxlbmd0aCl0aHJvdyBuZXcgUmFuZ2VFcnJvcigidmVjdG9ycyBkbyBub3QgaGF2ZSB0aGUgc2FtZSBzaXplIik7bGV0IHQ9MDtmb3IobGV0IHM9MDtzPGUubGVuZ3RoO3MrKyl0Kz1lW3NdKm5bc107cmV0dXJuIHR9bW11bChuKXtuPWIuY2hlY2tNYXRyaXgobik7bGV0IGU9dGhpcy5yb3dzLHQ9dGhpcy5jb2x1bW5zLHM9bi5jb2x1bW5zLHI9bmV3IGIoZSxzKSxpPW5ldyBGbG9hdDY0QXJyYXkodCk7Zm9yKGxldCBoPTA7aDxzO2grKyl7Zm9yKGxldCBsPTA7bDx0O2wrKylpW2xdPW4uZ2V0KGwsaCk7Zm9yKGxldCBsPTA7bDxlO2wrKyl7bGV0IHU9MDtmb3IobGV0IGY9MDtmPHQ7ZisrKXUrPXRoaXMuZ2V0KGwsZikqaVtmXTtyLnNldChsLGgsdSl9fXJldHVybiByfXN0cmFzc2VuMngyKG4pe249Yi5jaGVja01hdHJpeChuKTtsZXQgZT1uZXcgYigyLDIpO2NvbnN0IHQ9dGhpcy5nZXQoMCwwKSxzPW4uZ2V0KDAsMCkscj10aGlzLmdldCgwLDEpLGk9bi5nZXQoMCwxKSxoPXRoaXMuZ2V0KDEsMCksbD1uLmdldCgxLDApLHU9dGhpcy5nZXQoMSwxKSxmPW4uZ2V0KDEsMSksZz0odCt1KSoocytmKSxhPShoK3UpKnMsaj10KihpLWYpLHc9dSoobC1zKSx5PSh0K3IpKmYsbT0oaC10KSoocytpKSxNPShyLXUpKihsK2YpLFQ9Zyt3LXkrTSxFPWoreSxrPWErdyxSPWctYStqK207cmV0dXJuIGUuc2V0KDAsMCxUKSxlLnNldCgwLDEsRSksZS5zZXQoMSwwLGspLGUuc2V0KDEsMSxSKSxlfXN0cmFzc2VuM3gzKG4pe249Yi5jaGVja01hdHJpeChuKTtsZXQgZT1uZXcgYigzLDMpO2NvbnN0IHQ9dGhpcy5nZXQoMCwwKSxzPXRoaXMuZ2V0KDAsMSkscj10aGlzLmdldCgwLDIpLGk9dGhpcy5nZXQoMSwwKSxoPXRoaXMuZ2V0KDEsMSksbD10aGlzLmdldCgxLDIpLHU9dGhpcy5nZXQoMiwwKSxmPXRoaXMuZ2V0KDIsMSksZz10aGlzLmdldCgyLDIpLGE9bi5nZXQoMCwwKSxqPW4uZ2V0KDAsMSksdz1uLmdldCgwLDIpLHk9bi5nZXQoMSwwKSxtPW4uZ2V0KDEsMSksTT1uLmdldCgxLDIpLFQ9bi5nZXQoMiwwKSxFPW4uZ2V0KDIsMSksaz1uLmdldCgyLDIpLFI9KHQrcytyLWktaC1mLWcpKm0scT0odC1pKSooLWorbSksST1oKigtYStqK3ktbS1NLVQrayksej0oLXQraStoKSooYS1qK20pLEI9KGkraCkqKC1hK2opLGM9dCphLHA9KC10K3UrZikqKGEtdytNKSxTPSgtdCt1KSoody1NKSxkPSh1K2YpKigtYSt3KSxEPSh0K3Mrci1oLWwtdS1mKSpNLFU9ZiooLWErdyt5LW0tTS1UK0UpLEY9KC1yK2YrZykqKG0rVC1FKSxQPShyLWcpKihtLUUpLFk9cipULEc9KGYrZykqKC1UK0UpLE49KC1yK2grbCkqKE0rVC1rKSwkPShyLWwpKihNLWspLEs9KGgrbCkqKC1UK2spLHY9cyp5LFY9bCpFLEw9aSp3LEM9dSpqLFg9ZyprLHd0PWMrWSt2LHB0PVIreitCK2MrRitZK0csZHQ9YytwK2QrRCtZK04rSyxpdD1xK0kreitjK1krTiskLGx0PXEreitCK2MrVixodD1ZK04rJCtLK0wsanQ9YytwK1MrVStGK1ArWSx1dD1GK1ArWStHK0Msa3Q9YytwK1MrZCtYO3JldHVybiBlLnNldCgwLDAsd3QpLGUuc2V0KDAsMSxwdCksZS5zZXQoMCwyLGR0KSxlLnNldCgxLDAsaXQpLGUuc2V0KDEsMSxsdCksZS5zZXQoMSwyLGh0KSxlLnNldCgyLDAsanQpLGUuc2V0KDIsMSx1dCksZS5zZXQoMiwyLGt0KSxlfW1tdWxTdHJhc3NlbihuKXtuPWIuY2hlY2tNYXRyaXgobik7bGV0IGU9dGhpcy5jbG9uZSgpLHQ9ZS5yb3dzLHM9ZS5jb2x1bW5zLHI9bi5yb3dzLGk9bi5jb2x1bW5zO3MhPT1yJiZjb25zb2xlLndhcm4oYE11bHRpcGx5aW5nICR7dH0geCAke3N9IGFuZCAke3J9IHggJHtpfSBtYXRyaXg6IGRpbWVuc2lvbnMgZG8gbm90IG1hdGNoLmApO2Z1bmN0aW9uIGgoZyxhLGope2xldCB3PWcucm93cyx5PWcuY29sdW1ucztpZih3PT09YSYmeT09PWopcmV0dXJuIGc7e2xldCBtPV8uemVyb3MoYSxqKTtyZXR1cm4gbT1tLnNldFN1Yk1hdHJpeChnLDAsMCksbX19bGV0IGw9TWF0aC5tYXgodCxyKSx1PU1hdGgubWF4KHMsaSk7ZT1oKGUsbCx1KSxuPWgobixsLHUpO2Z1bmN0aW9uIGYoZyxhLGosdyl7aWYoajw9NTEyfHx3PD01MTIpcmV0dXJuIGcubW11bChhKTtqJTI9PT0xJiZ3JTI9PT0xPyhnPWgoZyxqKzEsdysxKSxhPWgoYSxqKzEsdysxKSk6aiUyPT09MT8oZz1oKGcsaisxLHcpLGE9aChhLGorMSx3KSk6dyUyPT09MSYmKGc9aChnLGosdysxKSxhPWgoYSxqLHcrMSkpO2xldCB5PXBhcnNlSW50KGcucm93cy8yLDEwKSxtPXBhcnNlSW50KGcuY29sdW1ucy8yLDEwKSxNPWcuc3ViTWF0cml4KDAseS0xLDAsbS0xKSxUPWEuc3ViTWF0cml4KDAseS0xLDAsbS0xKSxFPWcuc3ViTWF0cml4KDAseS0xLG0sZy5jb2x1bW5zLTEpLGs9YS5zdWJNYXRyaXgoMCx5LTEsbSxhLmNvbHVtbnMtMSksUj1nLnN1Yk1hdHJpeCh5LGcucm93cy0xLDAsbS0xKSxxPWEuc3ViTWF0cml4KHksYS5yb3dzLTEsMCxtLTEpLEk9Zy5zdWJNYXRyaXgoeSxnLnJvd3MtMSxtLGcuY29sdW1ucy0xKSx6PWEuc3ViTWF0cml4KHksYS5yb3dzLTEsbSxhLmNvbHVtbnMtMSksQj1mKF8uYWRkKE0sSSksXy5hZGQoVCx6KSx5LG0pLGM9ZihfLmFkZChSLEkpLFQseSxtKSxwPWYoTSxfLnN1YihrLHopLHksbSksUz1mKEksXy5zdWIocSxUKSx5LG0pLGQ9ZihfLmFkZChNLEUpLHoseSxtKSxEPWYoXy5zdWIoUixNKSxfLmFkZChULGspLHksbSksVT1mKF8uc3ViKEUsSSksXy5hZGQocSx6KSx5LG0pLEY9Xy5hZGQoQixTKTtGLnN1YihkKSxGLmFkZChVKTtsZXQgUD1fLmFkZChwLGQpLFk9Xy5hZGQoYyxTKSxHPV8uc3ViKEIsYyk7Ry5hZGQocCksRy5hZGQoRCk7bGV0IE49Xy56ZXJvcygyKkYucm93cywyKkYuY29sdW1ucyk7cmV0dXJuIE49Ti5zZXRTdWJNYXRyaXgoRiwwLDApLE49Ti5zZXRTdWJNYXRyaXgoUCxGLnJvd3MsMCksTj1OLnNldFN1Yk1hdHJpeChZLDAsRi5jb2x1bW5zKSxOPU4uc2V0U3ViTWF0cml4KEcsRi5yb3dzLEYuY29sdW1ucyksTi5zdWJNYXRyaXgoMCxqLTEsMCx3LTEpfXJldHVybiBmKGUsbixsLHUpfXNjYWxlUm93cyhuPXt9KXtpZih0eXBlb2YgbiE9Im9iamVjdCIpdGhyb3cgbmV3IFR5cGVFcnJvcigib3B0aW9ucyBtdXN0IGJlIGFuIG9iamVjdCIpO2NvbnN0e21pbjplPTAsbWF4OnQ9MX09bjtpZighTnVtYmVyLmlzRmluaXRlKGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIm1pbiBtdXN0IGJlIGEgbnVtYmVyIik7aWYoIU51bWJlci5pc0Zpbml0ZSh0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJtYXggbXVzdCBiZSBhIG51bWJlciIpO2lmKGU+PXQpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIm1pbiBtdXN0IGJlIHNtYWxsZXIgdGhhbiBtYXgiKTtsZXQgcz1uZXcgYih0aGlzLnJvd3MsdGhpcy5jb2x1bW5zKTtmb3IobGV0IHI9MDtyPHRoaXMucm93cztyKyspe2NvbnN0IGk9dGhpcy5nZXRSb3cocik7aS5sZW5ndGg+MCYmcXQoaSx7bWluOmUsbWF4OnQsb3V0cHV0Oml9KSxzLnNldFJvdyhyLGkpfXJldHVybiBzfXNjYWxlQ29sdW1ucyhuPXt9KXtpZih0eXBlb2YgbiE9Im9iamVjdCIpdGhyb3cgbmV3IFR5cGVFcnJvcigib3B0aW9ucyBtdXN0IGJlIGFuIG9iamVjdCIpO2NvbnN0e21pbjplPTAsbWF4OnQ9MX09bjtpZighTnVtYmVyLmlzRmluaXRlKGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIm1pbiBtdXN0IGJlIGEgbnVtYmVyIik7aWYoIU51bWJlci5pc0Zpbml0ZSh0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJtYXggbXVzdCBiZSBhIG51bWJlciIpO2lmKGU+PXQpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIm1pbiBtdXN0IGJlIHNtYWxsZXIgdGhhbiBtYXgiKTtsZXQgcz1uZXcgYih0aGlzLnJvd3MsdGhpcy5jb2x1bW5zKTtmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspe2NvbnN0IGk9dGhpcy5nZXRDb2x1bW4ocik7aS5sZW5ndGgmJnF0KGkse21pbjplLG1heDp0LG91dHB1dDppfSkscy5zZXRDb2x1bW4ocixpKX1yZXR1cm4gc31mbGlwUm93cygpe2NvbnN0IG49TWF0aC5jZWlsKHRoaXMuY29sdW1ucy8yKTtmb3IobGV0IGU9MDtlPHRoaXMucm93cztlKyspZm9yKGxldCB0PTA7dDxuO3QrKyl7bGV0IHM9dGhpcy5nZXQoZSx0KSxyPXRoaXMuZ2V0KGUsdGhpcy5jb2x1bW5zLTEtdCk7dGhpcy5zZXQoZSx0LHIpLHRoaXMuc2V0KGUsdGhpcy5jb2x1bW5zLTEtdCxzKX1yZXR1cm4gdGhpc31mbGlwQ29sdW1ucygpe2NvbnN0IG49TWF0aC5jZWlsKHRoaXMucm93cy8yKTtmb3IobGV0IGU9MDtlPHRoaXMuY29sdW1ucztlKyspZm9yKGxldCB0PTA7dDxuO3QrKyl7bGV0IHM9dGhpcy5nZXQodCxlKSxyPXRoaXMuZ2V0KHRoaXMucm93cy0xLXQsZSk7dGhpcy5zZXQodCxlLHIpLHRoaXMuc2V0KHRoaXMucm93cy0xLXQsZSxzKX1yZXR1cm4gdGhpc31rcm9uZWNrZXJQcm9kdWN0KG4pe249Yi5jaGVja01hdHJpeChuKTtsZXQgZT10aGlzLnJvd3MsdD10aGlzLmNvbHVtbnMscz1uLnJvd3Mscj1uLmNvbHVtbnMsaT1uZXcgYihlKnMsdCpyKTtmb3IobGV0IGg9MDtoPGU7aCsrKWZvcihsZXQgbD0wO2w8dDtsKyspZm9yKGxldCB1PTA7dTxzO3UrKylmb3IobGV0IGY9MDtmPHI7ZisrKWkuc2V0KHMqaCt1LHIqbCtmLHRoaXMuZ2V0KGgsbCkqbi5nZXQodSxmKSk7cmV0dXJuIGl9a3JvbmVja2VyU3VtKG4pe2lmKG49Yi5jaGVja01hdHJpeChuKSwhdGhpcy5pc1NxdWFyZSgpfHwhbi5pc1NxdWFyZSgpKXRocm93IG5ldyBFcnJvcigiS3JvbmVja2VyIFN1bSBuZWVkcyB0d28gU3F1YXJlIE1hdHJpY2VzIik7bGV0IGU9dGhpcy5yb3dzLHQ9bi5yb3dzLHM9dGhpcy5rcm9uZWNrZXJQcm9kdWN0KGIuZXllKHQsdCkpLHI9Yi5leWUoZSxlKS5rcm9uZWNrZXJQcm9kdWN0KG4pO3JldHVybiBzLmFkZChyKX10cmFuc3Bvc2UoKXtsZXQgbj1uZXcgYih0aGlzLmNvbHVtbnMsdGhpcy5yb3dzKTtmb3IobGV0IGU9MDtlPHRoaXMucm93cztlKyspZm9yKGxldCB0PTA7dDx0aGlzLmNvbHVtbnM7dCsrKW4uc2V0KHQsZSx0aGlzLmdldChlLHQpKTtyZXR1cm4gbn1zb3J0Um93cyhuPVB0KXtmb3IobGV0IGU9MDtlPHRoaXMucm93cztlKyspdGhpcy5zZXRSb3coZSx0aGlzLmdldFJvdyhlKS5zb3J0KG4pKTtyZXR1cm4gdGhpc31zb3J0Q29sdW1ucyhuPVB0KXtmb3IobGV0IGU9MDtlPHRoaXMuY29sdW1ucztlKyspdGhpcy5zZXRDb2x1bW4oZSx0aGlzLmdldENvbHVtbihlKS5zb3J0KG4pKTtyZXR1cm4gdGhpc31zdWJNYXRyaXgobixlLHQscyl7RnQodGhpcyxuLGUsdCxzKTtsZXQgcj1uZXcgYihlLW4rMSxzLXQrMSk7Zm9yKGxldCBpPW47aTw9ZTtpKyspZm9yKGxldCBoPXQ7aDw9cztoKyspci5zZXQoaS1uLGgtdCx0aGlzLmdldChpLGgpKTtyZXR1cm4gcn1zdWJNYXRyaXhSb3cobixlLHQpe2lmKGU9PT12b2lkIDAmJihlPTApLHQ9PT12b2lkIDAmJih0PXRoaXMuY29sdW1ucy0xKSxlPnR8fGU8MHx8ZT49dGhpcy5jb2x1bW5zfHx0PDB8fHQ+PXRoaXMuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiQXJndW1lbnQgb3V0IG9mIHJhbmdlIik7bGV0IHM9bmV3IGIobi5sZW5ndGgsdC1lKzEpO2ZvcihsZXQgcj0wO3I8bi5sZW5ndGg7cisrKWZvcihsZXQgaT1lO2k8PXQ7aSsrKXtpZihuW3JdPDB8fG5bcl0+PXRoaXMucm93cyl0aHJvdyBuZXcgUmFuZ2VFcnJvcihgUm93IGluZGV4IG91dCBvZiByYW5nZTogJHtuW3JdfWApO3Muc2V0KHIsaS1lLHRoaXMuZ2V0KG5bcl0saSkpfXJldHVybiBzfXN1Yk1hdHJpeENvbHVtbihuLGUsdCl7aWYoZT09PXZvaWQgMCYmKGU9MCksdD09PXZvaWQgMCYmKHQ9dGhpcy5yb3dzLTEpLGU+dHx8ZTwwfHxlPj10aGlzLnJvd3N8fHQ8MHx8dD49dGhpcy5yb3dzKXRocm93IG5ldyBSYW5nZUVycm9yKCJBcmd1bWVudCBvdXQgb2YgcmFuZ2UiKTtsZXQgcz1uZXcgYih0LWUrMSxuLmxlbmd0aCk7Zm9yKGxldCByPTA7cjxuLmxlbmd0aDtyKyspZm9yKGxldCBpPWU7aTw9dDtpKyspe2lmKG5bcl08MHx8bltyXT49dGhpcy5jb2x1bW5zKXRocm93IG5ldyBSYW5nZUVycm9yKGBDb2x1bW4gaW5kZXggb3V0IG9mIHJhbmdlOiAke25bcl19YCk7cy5zZXQoaS1lLHIsdGhpcy5nZXQoaSxuW3JdKSl9cmV0dXJuIHN9c2V0U3ViTWF0cml4KG4sZSx0KXtpZihuPWIuY2hlY2tNYXRyaXgobiksbi5pc0VtcHR5KCkpcmV0dXJuIHRoaXM7bGV0IHM9ZStuLnJvd3MtMSxyPXQrbi5jb2x1bW5zLTE7RnQodGhpcyxlLHMsdCxyKTtmb3IobGV0IGk9MDtpPG4ucm93cztpKyspZm9yKGxldCBoPTA7aDxuLmNvbHVtbnM7aCsrKXRoaXMuc2V0KGUraSx0K2gsbi5nZXQoaSxoKSk7cmV0dXJuIHRoaXN9c2VsZWN0aW9uKG4sZSl7aWUodGhpcyxuKSxsZSh0aGlzLGUpO2xldCB0PW5ldyBiKG4ubGVuZ3RoLGUubGVuZ3RoKTtmb3IobGV0IHM9MDtzPG4ubGVuZ3RoO3MrKyl7bGV0IHI9bltzXTtmb3IobGV0IGk9MDtpPGUubGVuZ3RoO2krKyl7bGV0IGg9ZVtpXTt0LnNldChzLGksdGhpcy5nZXQocixoKSl9fXJldHVybiB0fXRyYWNlKCl7bGV0IG49TWF0aC5taW4odGhpcy5yb3dzLHRoaXMuY29sdW1ucyksZT0wO2ZvcihsZXQgdD0wO3Q8bjt0KyspZSs9dGhpcy5nZXQodCx0KTtyZXR1cm4gZX1jbG9uZSgpe2xldCBuPW5ldyBiKHRoaXMucm93cyx0aGlzLmNvbHVtbnMpO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0Kyspbi5zZXQoZSx0LHRoaXMuZ2V0KGUsdCkpO3JldHVybiBufXN1bShuKXtzd2l0Y2gobil7Y2FzZSJyb3ciOnJldHVybiBoZSh0aGlzKTtjYXNlImNvbHVtbiI6cmV0dXJuIHVlKHRoaXMpO2Nhc2Ugdm9pZCAwOnJldHVybiBjZSh0aGlzKTtkZWZhdWx0OnRocm93IG5ldyBFcnJvcihgaW52YWxpZCBvcHRpb246ICR7bn1gKX19cHJvZHVjdChuKXtzd2l0Y2gobil7Y2FzZSJyb3ciOnJldHVybiBmZSh0aGlzKTtjYXNlImNvbHVtbiI6cmV0dXJuIGdlKHRoaXMpO2Nhc2Ugdm9pZCAwOnJldHVybiBhZSh0aGlzKTtkZWZhdWx0OnRocm93IG5ldyBFcnJvcihgaW52YWxpZCBvcHRpb246ICR7bn1gKX19bWVhbihuKXtjb25zdCBlPXRoaXMuc3VtKG4pO3N3aXRjaChuKXtjYXNlInJvdyI6e2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKyllW3RdLz10aGlzLmNvbHVtbnM7cmV0dXJuIGV9Y2FzZSJjb2x1bW4iOntmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspZVt0XS89dGhpcy5yb3dzO3JldHVybiBlfWNhc2Ugdm9pZCAwOnJldHVybiBlL3RoaXMuc2l6ZTtkZWZhdWx0OnRocm93IG5ldyBFcnJvcihgaW52YWxpZCBvcHRpb246ICR7bn1gKX19dmFyaWFuY2UobixlPXt9KXtpZih0eXBlb2Ygbj09Im9iamVjdCImJihlPW4sbj12b2lkIDApLHR5cGVvZiBlIT0ib2JqZWN0Iil0aHJvdyBuZXcgVHlwZUVycm9yKCJvcHRpb25zIG11c3QgYmUgYW4gb2JqZWN0Iik7Y29uc3R7dW5iaWFzZWQ6dD0hMCxtZWFuOnM9dGhpcy5tZWFuKG4pfT1lO2lmKHR5cGVvZiB0IT0iYm9vbGVhbiIpdGhyb3cgbmV3IFR5cGVFcnJvcigidW5iaWFzZWQgbXVzdCBiZSBhIGJvb2xlYW4iKTtzd2l0Y2gobil7Y2FzZSJyb3ciOntpZighVyhzKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJtZWFuIG11c3QgYmUgYW4gYXJyYXkiKTtyZXR1cm4gbWUodGhpcyx0LHMpfWNhc2UiY29sdW1uIjp7aWYoIVcocykpdGhyb3cgbmV3IFR5cGVFcnJvcigibWVhbiBtdXN0IGJlIGFuIGFycmF5Iik7cmV0dXJuIHdlKHRoaXMsdCxzKX1jYXNlIHZvaWQgMDp7aWYodHlwZW9mIHMhPSJudW1iZXIiKXRocm93IG5ldyBUeXBlRXJyb3IoIm1lYW4gbXVzdCBiZSBhIG51bWJlciIpO3JldHVybiBwZSh0aGlzLHQscyl9ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgb3B0aW9uOiAke259YCl9fXN0YW5kYXJkRGV2aWF0aW9uKG4sZSl7dHlwZW9mIG49PSJvYmplY3QiJiYoZT1uLG49dm9pZCAwKTtjb25zdCB0PXRoaXMudmFyaWFuY2UobixlKTtpZihuPT09dm9pZCAwKXJldHVybiBNYXRoLnNxcnQodCk7Zm9yKGxldCBzPTA7czx0Lmxlbmd0aDtzKyspdFtzXT1NYXRoLnNxcnQodFtzXSk7cmV0dXJuIHR9Y2VudGVyKG4sZT17fSl7aWYodHlwZW9mIG49PSJvYmplY3QiJiYoZT1uLG49dm9pZCAwKSx0eXBlb2YgZSE9Im9iamVjdCIpdGhyb3cgbmV3IFR5cGVFcnJvcigib3B0aW9ucyBtdXN0IGJlIGFuIG9iamVjdCIpO2NvbnN0e2NlbnRlcjp0PXRoaXMubWVhbihuKX09ZTtzd2l0Y2gobil7Y2FzZSJyb3ciOntpZighVyh0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJjZW50ZXIgbXVzdCBiZSBhbiBhcnJheSIpO3JldHVybiBkZSh0aGlzLHQpLHRoaXN9Y2FzZSJjb2x1bW4iOntpZighVyh0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJjZW50ZXIgbXVzdCBiZSBhbiBhcnJheSIpO3JldHVybiB5ZSh0aGlzLHQpLHRoaXN9Y2FzZSB2b2lkIDA6e2lmKHR5cGVvZiB0IT0ibnVtYmVyIil0aHJvdyBuZXcgVHlwZUVycm9yKCJjZW50ZXIgbXVzdCBiZSBhIG51bWJlciIpO3JldHVybiBNZSh0aGlzLHQpLHRoaXN9ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgb3B0aW9uOiAke259YCl9fXNjYWxlKG4sZT17fSl7aWYodHlwZW9mIG49PSJvYmplY3QiJiYoZT1uLG49dm9pZCAwKSx0eXBlb2YgZSE9Im9iamVjdCIpdGhyb3cgbmV3IFR5cGVFcnJvcigib3B0aW9ucyBtdXN0IGJlIGFuIG9iamVjdCIpO2xldCB0PWUuc2NhbGU7c3dpdGNoKG4pe2Nhc2Uicm93Ijp7aWYodD09PXZvaWQgMCl0PUVlKHRoaXMpO2Vsc2UgaWYoIVcodCkpdGhyb3cgbmV3IFR5cGVFcnJvcigic2NhbGUgbXVzdCBiZSBhbiBhcnJheSIpO3JldHVybiBTZSh0aGlzLHQpLHRoaXN9Y2FzZSJjb2x1bW4iOntpZih0PT09dm9pZCAwKXQ9amUodGhpcyk7ZWxzZSBpZighVyh0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJzY2FsZSBtdXN0IGJlIGFuIGFycmF5Iik7cmV0dXJuIGtlKHRoaXMsdCksdGhpc31jYXNlIHZvaWQgMDp7aWYodD09PXZvaWQgMCl0PWJlKHRoaXMpO2Vsc2UgaWYodHlwZW9mIHQhPSJudW1iZXIiKXRocm93IG5ldyBUeXBlRXJyb3IoInNjYWxlIG11c3QgYmUgYSBudW1iZXIiKTtyZXR1cm4gSWUodGhpcyx0KSx0aGlzfWRlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKGBpbnZhbGlkIG9wdGlvbjogJHtufWApfX10b1N0cmluZyhuKXtyZXR1cm4gVHQodGhpcyxuKX19Xy5wcm90b3R5cGUua2xhc3M9Ik1hdHJpeCIsdHlwZW9mIFN5bWJvbDwidSImJihfLnByb3RvdHlwZVtTeW1ib2wuZm9yKCJub2RlanMudXRpbC5pbnNwZWN0LmN1c3RvbSIpXT1uZSk7ZnVuY3Rpb24gUHQobyxuKXtyZXR1cm4gby1ufWZ1bmN0aW9uIFJlKG8pe3JldHVybiBvLmV2ZXJ5KG49PnR5cGVvZiBuPT0ibnVtYmVyIil9Xy5yYW5kb209Xy5yYW5kLF8ucmFuZG9tSW50PV8ucmFuZEludCxfLmRpYWdvbmFsPV8uZGlhZyxfLnByb3RvdHlwZS5kaWFnb25hbD1fLnByb3RvdHlwZS5kaWFnLF8uaWRlbnRpdHk9Xy5leWUsXy5wcm90b3R5cGUubmVnYXRlPV8ucHJvdG90eXBlLm5lZyxfLnByb3RvdHlwZS50ZW5zb3JQcm9kdWN0PV8ucHJvdG90eXBlLmtyb25lY2tlclByb2R1Y3Q7Y2xhc3MgYiBleHRlbmRzIF97Y29uc3RydWN0b3IobixlKXtpZihzdXBlcigpLGIuaXNNYXRyaXgobikpcmV0dXJuIG4uY2xvbmUoKTtpZihOdW1iZXIuaXNJbnRlZ2VyKG4pJiZuPj0wKWlmKHRoaXMuZGF0YT1bXSxOdW1iZXIuaXNJbnRlZ2VyKGUpJiZlPj0wKWZvcihsZXQgdD0wO3Q8bjt0KyspdGhpcy5kYXRhLnB1c2gobmV3IEZsb2F0NjRBcnJheShlKSk7ZWxzZSB0aHJvdyBuZXcgVHlwZUVycm9yKCJuQ29sdW1ucyBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlciIpO2Vsc2UgaWYoVyhuKSl7Y29uc3QgdD1uO2lmKG49dC5sZW5ndGgsZT1uP3RbMF0ubGVuZ3RoOjAsdHlwZW9mIGUhPSJudW1iZXIiKXRocm93IG5ldyBUeXBlRXJyb3IoIkRhdGEgbXVzdCBiZSBhIDJEIGFycmF5IHdpdGggYXQgbGVhc3Qgb25lIGVsZW1lbnQiKTt0aGlzLmRhdGE9W107Zm9yKGxldCBzPTA7czxuO3MrKyl7aWYodFtzXS5sZW5ndGghPT1lKXRocm93IG5ldyBSYW5nZUVycm9yKCJJbmNvbnNpc3RlbnQgYXJyYXkgZGltZW5zaW9ucyIpO2lmKCFSZSh0W3NdKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnB1dCBkYXRhIGNvbnRhaW5zIG5vbi1udW1lcmljIHZhbHVlcyIpO3RoaXMuZGF0YS5wdXNoKEZsb2F0NjRBcnJheS5mcm9tKHRbc10pKX19ZWxzZSB0aHJvdyBuZXcgVHlwZUVycm9yKCJGaXJzdCBhcmd1bWVudCBtdXN0IGJlIGEgcG9zaXRpdmUgbnVtYmVyIG9yIGFuIGFycmF5Iik7dGhpcy5yb3dzPW4sdGhpcy5jb2x1bW5zPWV9c2V0KG4sZSx0KXtyZXR1cm4gdGhpcy5kYXRhW25dW2VdPXQsdGhpc31nZXQobixlKXtyZXR1cm4gdGhpcy5kYXRhW25dW2VdfXJlbW92ZVJvdyhuKXtyZXR1cm4gUSh0aGlzLG4pLHRoaXMuZGF0YS5zcGxpY2UobiwxKSx0aGlzLnJvd3MtPTEsdGhpc31hZGRSb3cobixlKXtyZXR1cm4gZT09PXZvaWQgMCYmKGU9bixuPXRoaXMucm93cyksUSh0aGlzLG4sITApLGU9RmxvYXQ2NEFycmF5LmZyb20odHQodGhpcyxlKSksdGhpcy5kYXRhLnNwbGljZShuLDAsZSksdGhpcy5yb3dzKz0xLHRoaXN9cmVtb3ZlQ29sdW1uKG4pe1oodGhpcyxuKTtmb3IobGV0IGU9MDtlPHRoaXMucm93cztlKyspe2NvbnN0IHQ9bmV3IEZsb2F0NjRBcnJheSh0aGlzLmNvbHVtbnMtMSk7Zm9yKGxldCBzPTA7czxuO3MrKyl0W3NdPXRoaXMuZGF0YVtlXVtzXTtmb3IobGV0IHM9bisxO3M8dGhpcy5jb2x1bW5zO3MrKyl0W3MtMV09dGhpcy5kYXRhW2VdW3NdO3RoaXMuZGF0YVtlXT10fXJldHVybiB0aGlzLmNvbHVtbnMtPTEsdGhpc31hZGRDb2x1bW4obixlKXt0eXBlb2YgZT4idSImJihlPW4sbj10aGlzLmNvbHVtbnMpLFoodGhpcyxuLCEwKSxlPWV0KHRoaXMsZSk7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKXtjb25zdCBzPW5ldyBGbG9hdDY0QXJyYXkodGhpcy5jb2x1bW5zKzEpO2xldCByPTA7Zm9yKDtyPG47cisrKXNbcl09dGhpcy5kYXRhW3RdW3JdO2ZvcihzW3IrK109ZVt0XTtyPHRoaXMuY29sdW1ucysxO3IrKylzW3JdPXRoaXMuZGF0YVt0XVtyLTFdO3RoaXMuZGF0YVt0XT1zfXJldHVybiB0aGlzLmNvbHVtbnMrPTEsdGhpc319cmUoXyxiKTtjbGFzcyBzdCBleHRlbmRzIF97Y29uc3RydWN0b3Iobil7c3VwZXIoKSx0aGlzLmRhdGE9bix0aGlzLnJvd3M9bi5sZW5ndGgsdGhpcy5jb2x1bW5zPW5bMF0ubGVuZ3RofXNldChuLGUsdCl7cmV0dXJuIHRoaXMuZGF0YVtuXVtlXT10LHRoaXN9Z2V0KG4sZSl7cmV0dXJuIHRoaXMuZGF0YVtuXVtlXX19Y2xhc3MgTmV7Y29uc3RydWN0b3Iobil7bj1zdC5jaGVja01hdHJpeChuKTtsZXQgZT1uLmNsb25lKCksdD1lLnJvd3Mscz1lLmNvbHVtbnMscj1uZXcgRmxvYXQ2NEFycmF5KHQpLGk9MSxoLGwsdSxmLGcsYSxqLHcseTtmb3IoaD0wO2g8dDtoKyspcltoXT1oO2Zvcih3PW5ldyBGbG9hdDY0QXJyYXkodCksbD0wO2w8cztsKyspe2ZvcihoPTA7aDx0O2grKyl3W2hdPWUuZ2V0KGgsbCk7Zm9yKGg9MDtoPHQ7aCsrKXtmb3IoeT1NYXRoLm1pbihoLGwpLGc9MCx1PTA7dTx5O3UrKylnKz1lLmdldChoLHUpKndbdV07d1toXS09ZyxlLnNldChoLGwsd1toXSl9Zm9yKGY9bCxoPWwrMTtoPHQ7aCsrKU1hdGguYWJzKHdbaF0pPk1hdGguYWJzKHdbZl0pJiYoZj1oKTtpZihmIT09bCl7Zm9yKHU9MDt1PHM7dSsrKWE9ZS5nZXQoZix1KSxlLnNldChmLHUsZS5nZXQobCx1KSksZS5zZXQobCx1LGEpO2o9cltmXSxyW2ZdPXJbbF0scltsXT1qLGk9LWl9aWYobDx0JiZlLmdldChsLGwpIT09MClmb3IoaD1sKzE7aDx0O2grKyllLnNldChoLGwsZS5nZXQoaCxsKS9lLmdldChsLGwpKX10aGlzLkxVPWUsdGhpcy5waXZvdFZlY3Rvcj1yLHRoaXMucGl2b3RTaWduPWl9aXNTaW5ndWxhcigpe2xldCBuPXRoaXMuTFUsZT1uLmNvbHVtbnM7Zm9yKGxldCB0PTA7dDxlO3QrKylpZihuLmdldCh0LHQpPT09MClyZXR1cm4hMDtyZXR1cm4hMX1zb2x2ZShuKXtuPWIuY2hlY2tNYXRyaXgobik7bGV0IGU9dGhpcy5MVTtpZihlLnJvd3MhPT1uLnJvd3MpdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIG1hdHJpeCBkaW1lbnNpb25zIik7aWYodGhpcy5pc1Npbmd1bGFyKCkpdGhyb3cgbmV3IEVycm9yKCJMVSBtYXRyaXggaXMgc2luZ3VsYXIiKTtsZXQgcz1uLmNvbHVtbnMscj1uLnN1Yk1hdHJpeFJvdyh0aGlzLnBpdm90VmVjdG9yLDAscy0xKSxpPWUuY29sdW1ucyxoLGwsdTtmb3IodT0wO3U8aTt1KyspZm9yKGg9dSsxO2g8aTtoKyspZm9yKGw9MDtsPHM7bCsrKXIuc2V0KGgsbCxyLmdldChoLGwpLXIuZ2V0KHUsbCkqZS5nZXQoaCx1KSk7Zm9yKHU9aS0xO3U+PTA7dS0tKXtmb3IobD0wO2w8cztsKyspci5zZXQodSxsLHIuZ2V0KHUsbCkvZS5nZXQodSx1KSk7Zm9yKGg9MDtoPHU7aCsrKWZvcihsPTA7bDxzO2wrKylyLnNldChoLGwsci5nZXQoaCxsKS1yLmdldCh1LGwpKmUuZ2V0KGgsdSkpfXJldHVybiByfWdldCBkZXRlcm1pbmFudCgpe2xldCBuPXRoaXMuTFU7aWYoIW4uaXNTcXVhcmUoKSl0aHJvdyBuZXcgRXJyb3IoIk1hdHJpeCBtdXN0IGJlIHNxdWFyZSIpO2xldCBlPXRoaXMucGl2b3RTaWduLHQ9bi5jb2x1bW5zO2ZvcihsZXQgcz0wO3M8dDtzKyspZSo9bi5nZXQocyxzKTtyZXR1cm4gZX1nZXQgbG93ZXJUcmlhbmd1bGFyTWF0cml4KCl7bGV0IG49dGhpcy5MVSxlPW4ucm93cyx0PW4uY29sdW1ucyxzPW5ldyBiKGUsdCk7Zm9yKGxldCByPTA7cjxlO3IrKylmb3IobGV0IGk9MDtpPHQ7aSsrKXI+aT9zLnNldChyLGksbi5nZXQocixpKSk6cj09PWk/cy5zZXQocixpLDEpOnMuc2V0KHIsaSwwKTtyZXR1cm4gc31nZXQgdXBwZXJUcmlhbmd1bGFyTWF0cml4KCl7bGV0IG49dGhpcy5MVSxlPW4ucm93cyx0PW4uY29sdW1ucyxzPW5ldyBiKGUsdCk7Zm9yKGxldCByPTA7cjxlO3IrKylmb3IobGV0IGk9MDtpPHQ7aSsrKXI8PWk/cy5zZXQocixpLG4uZ2V0KHIsaSkpOnMuc2V0KHIsaSwwKTtyZXR1cm4gc31nZXQgcGl2b3RQZXJtdXRhdGlvblZlY3Rvcigpe3JldHVybiBBcnJheS5mcm9tKHRoaXMucGl2b3RWZWN0b3IpfX1mdW5jdGlvbiB4KG8sbil7bGV0IGU9MDtyZXR1cm4gTWF0aC5hYnMobyk+TWF0aC5hYnMobik/KGU9bi9vLE1hdGguYWJzKG8pKk1hdGguc3FydCgxK2UqZSkpOm4hPT0wPyhlPW8vbixNYXRoLmFicyhuKSpNYXRoLnNxcnQoMStlKmUpKTowfWNsYXNzIHZle2NvbnN0cnVjdG9yKG4pe249c3QuY2hlY2tNYXRyaXgobik7bGV0IGU9bi5jbG9uZSgpLHQ9bi5yb3dzLHM9bi5jb2x1bW5zLHI9bmV3IEZsb2F0NjRBcnJheShzKSxpLGgsbCx1O2ZvcihsPTA7bDxzO2wrKyl7bGV0IGY9MDtmb3IoaT1sO2k8dDtpKyspZj14KGYsZS5nZXQoaSxsKSk7aWYoZiE9PTApe2ZvcihlLmdldChsLGwpPDAmJihmPS1mKSxpPWw7aTx0O2krKyllLnNldChpLGwsZS5nZXQoaSxsKS9mKTtmb3IoZS5zZXQobCxsLGUuZ2V0KGwsbCkrMSksaD1sKzE7aDxzO2grKyl7Zm9yKHU9MCxpPWw7aTx0O2krKyl1Kz1lLmdldChpLGwpKmUuZ2V0KGksaCk7Zm9yKHU9LXUvZS5nZXQobCxsKSxpPWw7aTx0O2krKyllLnNldChpLGgsZS5nZXQoaSxoKSt1KmUuZ2V0KGksbCkpfX1yW2xdPS1mfXRoaXMuUVI9ZSx0aGlzLlJkaWFnPXJ9c29sdmUobil7bj1iLmNoZWNrTWF0cml4KG4pO2xldCBlPXRoaXMuUVIsdD1lLnJvd3M7aWYobi5yb3dzIT09dCl0aHJvdyBuZXcgRXJyb3IoIk1hdHJpeCByb3cgZGltZW5zaW9ucyBtdXN0IGFncmVlIik7aWYoIXRoaXMuaXNGdWxsUmFuaygpKXRocm93IG5ldyBFcnJvcigiTWF0cml4IGlzIHJhbmsgZGVmaWNpZW50Iik7bGV0IHM9bi5jb2x1bW5zLHI9bi5jbG9uZSgpLGk9ZS5jb2x1bW5zLGgsbCx1LGY7Zm9yKHU9MDt1PGk7dSsrKWZvcihsPTA7bDxzO2wrKyl7Zm9yKGY9MCxoPXU7aDx0O2grKylmKz1lLmdldChoLHUpKnIuZ2V0KGgsbCk7Zm9yKGY9LWYvZS5nZXQodSx1KSxoPXU7aDx0O2grKylyLnNldChoLGwsci5nZXQoaCxsKStmKmUuZ2V0KGgsdSkpfWZvcih1PWktMTt1Pj0wO3UtLSl7Zm9yKGw9MDtsPHM7bCsrKXIuc2V0KHUsbCxyLmdldCh1LGwpL3RoaXMuUmRpYWdbdV0pO2ZvcihoPTA7aDx1O2grKylmb3IobD0wO2w8cztsKyspci5zZXQoaCxsLHIuZ2V0KGgsbCktci5nZXQodSxsKSplLmdldChoLHUpKX1yZXR1cm4gci5zdWJNYXRyaXgoMCxpLTEsMCxzLTEpfWlzRnVsbFJhbmsoKXtsZXQgbj10aGlzLlFSLmNvbHVtbnM7Zm9yKGxldCBlPTA7ZTxuO2UrKylpZih0aGlzLlJkaWFnW2VdPT09MClyZXR1cm4hMTtyZXR1cm4hMH1nZXQgdXBwZXJUcmlhbmd1bGFyTWF0cml4KCl7bGV0IG49dGhpcy5RUixlPW4uY29sdW1ucyx0PW5ldyBiKGUsZSkscyxyO2ZvcihzPTA7czxlO3MrKylmb3Iocj0wO3I8ZTtyKyspczxyP3Quc2V0KHMscixuLmdldChzLHIpKTpzPT09cj90LnNldChzLHIsdGhpcy5SZGlhZ1tzXSk6dC5zZXQocyxyLDApO3JldHVybiB0fWdldCBvcnRob2dvbmFsTWF0cml4KCl7bGV0IG49dGhpcy5RUixlPW4ucm93cyx0PW4uY29sdW1ucyxzPW5ldyBiKGUsdCkscixpLGgsbDtmb3IoaD10LTE7aD49MDtoLS0pe2ZvcihyPTA7cjxlO3IrKylzLnNldChyLGgsMCk7Zm9yKHMuc2V0KGgsaCwxKSxpPWg7aTx0O2krKylpZihuLmdldChoLGgpIT09MCl7Zm9yKGw9MCxyPWg7cjxlO3IrKylsKz1uLmdldChyLGgpKnMuZ2V0KHIsaSk7Zm9yKGw9LWwvbi5nZXQoaCxoKSxyPWg7cjxlO3IrKylzLnNldChyLGkscy5nZXQocixpKStsKm4uZ2V0KHIsaCkpfX1yZXR1cm4gc319Y2xhc3MgRHR7Y29uc3RydWN0b3IobixlPXt9KXtpZihuPXN0LmNoZWNrTWF0cml4KG4pLG4uaXNFbXB0eSgpKXRocm93IG5ldyBFcnJvcigiTWF0cml4IG11c3QgYmUgbm9uLWVtcHR5Iik7bGV0IHQ9bi5yb3dzLHM9bi5jb2x1bW5zO2NvbnN0e2NvbXB1dGVMZWZ0U2luZ3VsYXJWZWN0b3JzOnI9ITAsY29tcHV0ZVJpZ2h0U2luZ3VsYXJWZWN0b3JzOmk9ITAsYXV0b1RyYW5zcG9zZTpoPSExfT1lO2xldCBsPSEhcix1PSEhaSxmPSExLGc7aWYodDxzKWlmKCFoKWc9bi5jbG9uZSgpLGNvbnNvbGUud2FybigiQ29tcHV0aW5nIFNWRCBvbiBhIG1hdHJpeCB3aXRoIG1vcmUgY29sdW1ucyB0aGFuIHJvd3MuIENvbnNpZGVyIGVuYWJsaW5nIGF1dG9UcmFuc3Bvc2UiKTtlbHNle2c9bi50cmFuc3Bvc2UoKSx0PWcucm93cyxzPWcuY29sdW1ucyxmPSEwO2xldCBjPWw7bD11LHU9Y31lbHNlIGc9bi5jbG9uZSgpO2xldCBhPU1hdGgubWluKHQscyksaj1NYXRoLm1pbih0KzEscyksdz1uZXcgRmxvYXQ2NEFycmF5KGopLHk9bmV3IGIodCxhKSxtPW5ldyBiKHMscyksTT1uZXcgRmxvYXQ2NEFycmF5KHMpLFQ9bmV3IEZsb2F0NjRBcnJheSh0KSxFPW5ldyBGbG9hdDY0QXJyYXkoaik7Zm9yKGxldCBjPTA7YzxqO2MrKylFW2NdPWM7bGV0IGs9TWF0aC5taW4odC0xLHMpLFI9TWF0aC5tYXgoMCxNYXRoLm1pbihzLTIsdCkpLHE9TWF0aC5tYXgoayxSKTtmb3IobGV0IGM9MDtjPHE7YysrKXtpZihjPGspe3dbY109MDtmb3IobGV0IHA9YztwPHQ7cCsrKXdbY109eCh3W2NdLGcuZ2V0KHAsYykpO2lmKHdbY10hPT0wKXtnLmdldChjLGMpPDAmJih3W2NdPS13W2NdKTtmb3IobGV0IHA9YztwPHQ7cCsrKWcuc2V0KHAsYyxnLmdldChwLGMpL3dbY10pO2cuc2V0KGMsYyxnLmdldChjLGMpKzEpfXdbY109LXdbY119Zm9yKGxldCBwPWMrMTtwPHM7cCsrKXtpZihjPGsmJndbY10hPT0wKXtsZXQgUz0wO2ZvcihsZXQgZD1jO2Q8dDtkKyspUys9Zy5nZXQoZCxjKSpnLmdldChkLHApO1M9LVMvZy5nZXQoYyxjKTtmb3IobGV0IGQ9YztkPHQ7ZCsrKWcuc2V0KGQscCxnLmdldChkLHApK1MqZy5nZXQoZCxjKSl9TVtwXT1nLmdldChjLHApfWlmKGwmJmM8aylmb3IobGV0IHA9YztwPHQ7cCsrKXkuc2V0KHAsYyxnLmdldChwLGMpKTtpZihjPFIpe01bY109MDtmb3IobGV0IHA9YysxO3A8cztwKyspTVtjXT14KE1bY10sTVtwXSk7aWYoTVtjXSE9PTApe01bYysxXTwwJiYoTVtjXT0wLU1bY10pO2ZvcihsZXQgcD1jKzE7cDxzO3ArKylNW3BdLz1NW2NdO01bYysxXSs9MX1pZihNW2NdPS1NW2NdLGMrMTx0JiZNW2NdIT09MCl7Zm9yKGxldCBwPWMrMTtwPHQ7cCsrKVRbcF09MDtmb3IobGV0IHA9YysxO3A8dDtwKyspZm9yKGxldCBTPWMrMTtTPHM7UysrKVRbcF0rPU1bU10qZy5nZXQocCxTKTtmb3IobGV0IHA9YysxO3A8cztwKyspe2xldCBTPS1NW3BdL01bYysxXTtmb3IobGV0IGQ9YysxO2Q8dDtkKyspZy5zZXQoZCxwLGcuZ2V0KGQscCkrUypUW2RdKX19aWYodSlmb3IobGV0IHA9YysxO3A8cztwKyspbS5zZXQocCxjLE1bcF0pfX1sZXQgST1NYXRoLm1pbihzLHQrMSk7aWYoazxzJiYod1trXT1nLmdldChrLGspKSx0PEkmJih3W0ktMV09MCksUisxPEkmJihNW1JdPWcuZ2V0KFIsSS0xKSksTVtJLTFdPTAsbCl7Zm9yKGxldCBjPWs7YzxhO2MrKyl7Zm9yKGxldCBwPTA7cDx0O3ArKyl5LnNldChwLGMsMCk7eS5zZXQoYyxjLDEpfWZvcihsZXQgYz1rLTE7Yz49MDtjLS0paWYod1tjXSE9PTApe2ZvcihsZXQgcD1jKzE7cDxhO3ArKyl7bGV0IFM9MDtmb3IobGV0IGQ9YztkPHQ7ZCsrKVMrPXkuZ2V0KGQsYykqeS5nZXQoZCxwKTtTPS1TL3kuZ2V0KGMsYyk7Zm9yKGxldCBkPWM7ZDx0O2QrKyl5LnNldChkLHAseS5nZXQoZCxwKStTKnkuZ2V0KGQsYykpfWZvcihsZXQgcD1jO3A8dDtwKyspeS5zZXQocCxjLC15LmdldChwLGMpKTt5LnNldChjLGMsMSt5LmdldChjLGMpKTtmb3IobGV0IHA9MDtwPGMtMTtwKyspeS5zZXQocCxjLDApfWVsc2V7Zm9yKGxldCBwPTA7cDx0O3ArKyl5LnNldChwLGMsMCk7eS5zZXQoYyxjLDEpfX1pZih1KWZvcihsZXQgYz1zLTE7Yz49MDtjLS0pe2lmKGM8UiYmTVtjXSE9PTApZm9yKGxldCBwPWMrMTtwPHM7cCsrKXtsZXQgUz0wO2ZvcihsZXQgZD1jKzE7ZDxzO2QrKylTKz1tLmdldChkLGMpKm0uZ2V0KGQscCk7Uz0tUy9tLmdldChjKzEsYyk7Zm9yKGxldCBkPWMrMTtkPHM7ZCsrKW0uc2V0KGQscCxtLmdldChkLHApK1MqbS5nZXQoZCxjKSl9Zm9yKGxldCBwPTA7cDxzO3ArKyltLnNldChwLGMsMCk7bS5zZXQoYyxjLDEpfWxldCB6PUktMSxCPU51bWJlci5FUFNJTE9OO2Zvcig7ST4wOyl7bGV0IGMscDtmb3IoYz1JLTI7Yz49LTEmJmMhPT0tMTtjLS0pe2NvbnN0IFM9TnVtYmVyLk1JTl9WQUxVRStCKk1hdGguYWJzKHdbY10rTWF0aC5hYnMod1tjKzFdKSk7aWYoTWF0aC5hYnMoTVtjXSk8PVN8fE51bWJlci5pc05hTihNW2NdKSl7TVtjXT0wO2JyZWFrfX1pZihjPT09SS0yKXA9NDtlbHNle2xldCBTO2ZvcihTPUktMTtTPj1jJiZTIT09YztTLS0pe2xldCBkPShTIT09ST9NYXRoLmFicyhNW1NdKTowKSsoUyE9PWMrMT9NYXRoLmFicyhNW1MtMV0pOjApO2lmKE1hdGguYWJzKHdbU10pPD1CKmQpe3dbU109MDticmVha319Uz09PWM/cD0zOlM9PT1JLTE/cD0xOihwPTIsYz1TKX1zd2l0Y2goYysrLHApe2Nhc2UgMTp7bGV0IFM9TVtJLTJdO01bSS0yXT0wO2ZvcihsZXQgZD1JLTI7ZD49YztkLS0pe2xldCBEPXgod1tkXSxTKSxVPXdbZF0vRCxGPVMvRDtpZih3W2RdPUQsZCE9PWMmJihTPS1GKk1bZC0xXSxNW2QtMV09VSpNW2QtMV0pLHUpZm9yKGxldCBQPTA7UDxzO1ArKylEPVUqbS5nZXQoUCxkKStGKm0uZ2V0KFAsSS0xKSxtLnNldChQLEktMSwtRiptLmdldChQLGQpK1UqbS5nZXQoUCxJLTEpKSxtLnNldChQLGQsRCl9YnJlYWt9Y2FzZSAyOntsZXQgUz1NW2MtMV07TVtjLTFdPTA7Zm9yKGxldCBkPWM7ZDxJO2QrKyl7bGV0IEQ9eCh3W2RdLFMpLFU9d1tkXS9ELEY9Uy9EO2lmKHdbZF09RCxTPS1GKk1bZF0sTVtkXT1VKk1bZF0sbClmb3IobGV0IFA9MDtQPHQ7UCsrKUQ9VSp5LmdldChQLGQpK0YqeS5nZXQoUCxjLTEpLHkuc2V0KFAsYy0xLC1GKnkuZ2V0KFAsZCkrVSp5LmdldChQLGMtMSkpLHkuc2V0KFAsZCxEKX1icmVha31jYXNlIDM6e2NvbnN0IFM9TWF0aC5tYXgoTWF0aC5hYnMod1tJLTFdKSxNYXRoLmFicyh3W0ktMl0pLE1hdGguYWJzKE1bSS0yXSksTWF0aC5hYnMod1tjXSksTWF0aC5hYnMoTVtjXSkpLGQ9d1tJLTFdL1MsRD13W0ktMl0vUyxVPU1bSS0yXS9TLEY9d1tjXS9TLFA9TVtjXS9TLFk9KChEK2QpKihELWQpK1UqVSkvMixHPWQqVSooZCpVKTtsZXQgTj0wOyhZIT09MHx8RyE9PTApJiYoWTwwP049MC1NYXRoLnNxcnQoWSpZK0cpOk49TWF0aC5zcXJ0KFkqWStHKSxOPUcvKFkrTikpO2xldCAkPShGK2QpKihGLWQpK04sSz1GKlA7Zm9yKGxldCB2PWM7djxJLTE7disrKXtsZXQgVj14KCQsSyk7Vj09PTAmJihWPU51bWJlci5NSU5fVkFMVUUpO2xldCBMPSQvVixDPUsvVjtpZih2IT09YyYmKE1bdi0xXT1WKSwkPUwqd1t2XStDKk1bdl0sTVt2XT1MKk1bdl0tQyp3W3ZdLEs9Qyp3W3YrMV0sd1t2KzFdPUwqd1t2KzFdLHUpZm9yKGxldCBYPTA7WDxzO1grKylWPUwqbS5nZXQoWCx2KStDKm0uZ2V0KFgsdisxKSxtLnNldChYLHYrMSwtQyptLmdldChYLHYpK0wqbS5nZXQoWCx2KzEpKSxtLnNldChYLHYsVik7aWYoVj14KCQsSyksVj09PTAmJihWPU51bWJlci5NSU5fVkFMVUUpLEw9JC9WLEM9Sy9WLHdbdl09ViwkPUwqTVt2XStDKndbdisxXSx3W3YrMV09LUMqTVt2XStMKndbdisxXSxLPUMqTVt2KzFdLE1bdisxXT1MKk1bdisxXSxsJiZ2PHQtMSlmb3IobGV0IFg9MDtYPHQ7WCsrKVY9TCp5LmdldChYLHYpK0MqeS5nZXQoWCx2KzEpLHkuc2V0KFgsdisxLC1DKnkuZ2V0KFgsdikrTCp5LmdldChYLHYrMSkpLHkuc2V0KFgsdixWKX1NW0ktMl09JDticmVha31jYXNlIDQ6e2lmKHdbY108PTAmJih3W2NdPXdbY108MD8td1tjXTowLHUpKWZvcihsZXQgUz0wO1M8PXo7UysrKW0uc2V0KFMsYywtbS5nZXQoUyxjKSk7Zm9yKDtjPHomJiEod1tjXT49d1tjKzFdKTspe2xldCBTPXdbY107aWYod1tjXT13W2MrMV0sd1tjKzFdPVMsdSYmYzxzLTEpZm9yKGxldCBkPTA7ZDxzO2QrKylTPW0uZ2V0KGQsYysxKSxtLnNldChkLGMrMSxtLmdldChkLGMpKSxtLnNldChkLGMsUyk7aWYobCYmYzx0LTEpZm9yKGxldCBkPTA7ZDx0O2QrKylTPXkuZ2V0KGQsYysxKSx5LnNldChkLGMrMSx5LmdldChkLGMpKSx5LnNldChkLGMsUyk7YysrfUktLTticmVha319fWlmKGYpe2xldCBjPW07bT15LHk9Y310aGlzLm09dCx0aGlzLm49cyx0aGlzLnM9dyx0aGlzLlU9eSx0aGlzLlY9bX1zb2x2ZShuKXtsZXQgZT1uLHQ9dGhpcy50aHJlc2hvbGQscz10aGlzLnMubGVuZ3RoLHI9Yi56ZXJvcyhzLHMpO2ZvcihsZXQgYT0wO2E8czthKyspTWF0aC5hYnModGhpcy5zW2FdKTw9dD9yLnNldChhLGEsMCk6ci5zZXQoYSxhLDEvdGhpcy5zW2FdKTtsZXQgaT10aGlzLlUsaD10aGlzLnJpZ2h0U2luZ3VsYXJWZWN0b3JzLGw9aC5tbXVsKHIpLHU9aC5yb3dzLGY9aS5yb3dzLGc9Yi56ZXJvcyh1LGYpO2ZvcihsZXQgYT0wO2E8dTthKyspZm9yKGxldCBqPTA7ajxmO2orKyl7bGV0IHc9MDtmb3IobGV0IHk9MDt5PHM7eSsrKXcrPWwuZ2V0KGEseSkqaS5nZXQoaix5KTtnLnNldChhLGosdyl9cmV0dXJuIGcubW11bChlKX1zb2x2ZUZvckRpYWdvbmFsKG4pe3JldHVybiB0aGlzLnNvbHZlKGIuZGlhZyhuKSl9aW52ZXJzZSgpe2xldCBuPXRoaXMuVixlPXRoaXMudGhyZXNob2xkLHQ9bi5yb3dzLHM9bi5jb2x1bW5zLHI9bmV3IGIodCx0aGlzLnMubGVuZ3RoKTtmb3IobGV0IGY9MDtmPHQ7ZisrKWZvcihsZXQgZz0wO2c8cztnKyspTWF0aC5hYnModGhpcy5zW2ddKT5lJiZyLnNldChmLGcsbi5nZXQoZixnKS90aGlzLnNbZ10pO2xldCBpPXRoaXMuVSxoPWkucm93cyxsPWkuY29sdW1ucyx1PW5ldyBiKHQsaCk7Zm9yKGxldCBmPTA7Zjx0O2YrKylmb3IobGV0IGc9MDtnPGg7ZysrKXtsZXQgYT0wO2ZvcihsZXQgaj0wO2o8bDtqKyspYSs9ci5nZXQoZixqKSppLmdldChnLGopO3Uuc2V0KGYsZyxhKX1yZXR1cm4gdX1nZXQgY29uZGl0aW9uKCl7cmV0dXJuIHRoaXMuc1swXS90aGlzLnNbTWF0aC5taW4odGhpcy5tLHRoaXMubiktMV19Z2V0IG5vcm0yKCl7cmV0dXJuIHRoaXMuc1swXX1nZXQgcmFuaygpe2xldCBuPU1hdGgubWF4KHRoaXMubSx0aGlzLm4pKnRoaXMuc1swXSpOdW1iZXIuRVBTSUxPTixlPTAsdD10aGlzLnM7Zm9yKGxldCBzPTAscj10Lmxlbmd0aDtzPHI7cysrKXRbc10+biYmZSsrO3JldHVybiBlfWdldCBkaWFnb25hbCgpe3JldHVybiBBcnJheS5mcm9tKHRoaXMucyl9Z2V0IHRocmVzaG9sZCgpe3JldHVybiBOdW1iZXIuRVBTSUxPTi8yKk1hdGgubWF4KHRoaXMubSx0aGlzLm4pKnRoaXMuc1swXX1nZXQgbGVmdFNpbmd1bGFyVmVjdG9ycygpe3JldHVybiB0aGlzLlV9Z2V0IHJpZ2h0U2luZ3VsYXJWZWN0b3JzKCl7cmV0dXJuIHRoaXMuVn1nZXQgZGlhZ29uYWxNYXRyaXgoKXtyZXR1cm4gYi5kaWFnKHRoaXMucyl9fWZ1bmN0aW9uIE10KG8sbj0hMSl7cmV0dXJuIG89c3QuY2hlY2tNYXRyaXgobyksbj9uZXcgRHQobykuaW52ZXJzZSgpOnFlKG8sYi5leWUoby5yb3dzKSl9ZnVuY3Rpb24gcWUobyxuLGU9ITEpe3JldHVybiBvPXN0LmNoZWNrTWF0cml4KG8pLG49c3QuY2hlY2tNYXRyaXgobiksZT9uZXcgRHQobykuc29sdmUobik6by5pc1NxdWFyZSgpP25ldyBOZShvKS5zb2x2ZShuKTpuZXcgdmUobykuc29sdmUobil9Y29uc3QgX2U9MTIzNCxUZT0oKT0+KHtzZWVkOl9lLGFycmF5U2h1ZmZsZShuKXtjb25zdHthcnI6ZSxzYW1wbGVTaXplOnR9PW47Zm9yKGxldCBzPTA7czx0O3MrKyl7dGhpcy5zZWVkPSgyMTQwMTMqdGhpcy5zZWVkKzI1MzEwMTEpJS0yMTQ3NDgzNjQ4O2xldCByPXRoaXMuc2VlZD4+MTYmMzI3Njc7cj1yJWUubGVuZ3RoO2xldCBpPWVbc107ZVtzXT1lW3JdLGVbcl09aX19LG5leHRJbnQobil7dGhpcy5zZWVkPSgyMTQwMTMqdGhpcy5zZWVkKzI1MzEwMTEpJS0yMTQ3NDgzNjQ4O2xldCBlPXRoaXMuc2VlZD4+MTYmMzI3Njc7cmV0dXJuIGU9ZSVuLGV9fSksSj0obyxuLGUpPT4oblswXS1vWzBdKSooZVsxXS1vWzFdKS0oblsxXS1vWzFdKSooZVswXS1vWzBdKSx6ZT0obyxuLGUsdCxzLHIsaSxoKT0+IShKKG8sbixlKT4wIT1KKHMscixpKT4wfHxKKG4sZSx0KT4wIT1KKHIsaSxoKT4wfHxKKGUsdCxvKT4wIT1KKGksaCxzKT4wfHxKKHQsbyxuKT4wIT1KKGgscyxyKT4wKSxGZT0obyxuLGUsdCxzLHIpPT5KKG8sbixlKT4wPT1KKHQscyxyKT4wLFBlPW89Pntjb25zdCBuPW9bNF0qb1s4XS1vWzVdKm9bN10sZT1vWzNdKm9bOF0tb1s1XSpvWzZdLHQ9b1szXSpvWzddLW9bNF0qb1s2XTtyZXR1cm4gb1swXSpuLW9bMV0qZStvWzJdKnR9LEJ0PShvLG4pPT57Y29uc3QgZT1QZShvKTtpZihNYXRoLmFicyhlKTw9bilyZXR1cm4gbnVsbDtjb25zdCB0PTEvZTtyZXR1cm5bKG9bNF0qb1s4XS1vWzVdKm9bN10pKnQsKG9bMl0qb1s3XS1vWzFdKm9bOF0pKnQsKG9bMV0qb1s1XS1vWzJdKm9bNF0pKnQsKG9bNV0qb1s2XS1vWzNdKm9bOF0pKnQsKG9bMF0qb1s4XS1vWzJdKm9bNl0pKnQsKG9bMl0qb1szXS1vWzBdKm9bNV0pKnQsKG9bM10qb1s3XS1vWzRdKm9bNl0pKnQsKG9bMV0qb1s2XS1vWzBdKm9bN10pKnQsKG9bMF0qb1s0XS1vWzFdKm9bM10pKnRdfSxvdD0obyxuKT0+e2NvbnN0IGU9bls2XSpvWzBdK25bN10qb1sxXStuWzhdLHQ9W107cmV0dXJuIHRbMF09KG5bMF0qb1swXStuWzFdKm9bMV0rblsyXSkvZSx0WzFdPShuWzNdKm9bMF0rbls0XSpvWzFdK25bNV0pL2UsdH0sRGU9KG8sbixlLHQpPT57Y29uc3Qgcz1ydChuLG8pLHI9cnQoZSxvKSxpPXJ0KHQsbyksaD1ydChuLGUpLGw9cnQodCxlKSx1PW10KHMsciksZj1tdChyLGkpLGc9bXQocyxpKSxhPW10KGgsbCk7cmV0dXJuIE1hdGgubWluKE1hdGgubWluKE1hdGgubWluKHUsZiksZyksYSl9LEJlPShvLG4sZSx0KT0+e2NvbnN0IHM9SihvLG4sZSk8PTA7cmV0dXJuIShKKG4sZSx0KTw9MCE9PXN8fEooZSx0LG8pPD0wIT09c3x8Sih0LG8sbik8PTAhPT1zKX0scnQ9KG8sbik9PltvWzBdLW5bMF0sb1sxXS1uWzFdXSxtdD0obyxuKT0+e2NvbnN0IGU9b1swXSpuWzFdLW9bMV0qblswXTtyZXR1cm4gTWF0aC5hYnMoZSkqLjV9LFZ0PShvLG4pPT57Y29uc3R7bm9ybVBvaW50czplLHBhcmFtOnR9PVh0KG8pLHtub3JtUG9pbnRzOnMscGFyYW06cn09WHQobiksaT1zLmxlbmd0aCxoPVtdLGw9W107Zm9yKGxldCB1PTA7dTxpO3UrKyl7Y29uc3QgZj1bZVt1XVswXSxlW3VdWzFdLDEsMCwwLDAsLShlW3VdWzBdKnNbdV1bMF0pLC0oZVt1XVsxXSpzW3VdWzBdKV0sZz1bMCwwLDAsZVt1XVswXSxlW3VdWzFdLDEsLShlW3VdWzBdKnNbdV1bMV0pLC0oZVt1XVsxXSpzW3VdWzFdKV07aC5wdXNoKGYpLGgucHVzaChnKSxsLnB1c2goW3NbdV1bMF1dKSxsLnB1c2goW3NbdV1bMV1dKX10cnl7Y29uc3QgdT1uZXcgYihoKSxmPW5ldyBiKGwpLGc9dS50cmFuc3Bvc2UoKSxhPWcubW11bCh1KSxqPWcubW11bChmKSx5PU10KGEpLm1tdWwoaikudG8xREFycmF5KCk7cmV0dXJuIFZlKHksdCxyKX1jYXRjaHtyZXR1cm4gbnVsbH19LFh0PW89PntsZXQgbj0wLGU9MDtmb3IobGV0IGw9MDtsPG8ubGVuZ3RoO2wrKyluKz1vW2xdWzBdLGUrPW9bbF1bMV07bGV0IHQ9bi9vLmxlbmd0aCxzPWUvby5sZW5ndGgscj0wO2ZvcihsZXQgbD0wO2w8by5sZW5ndGg7bCsrKXtjb25zdCB1PW9bbF1bMF0tdCxmPW9bbF1bMV0tcztyKz1NYXRoLnNxcnQodSp1K2YqZil9bGV0IGk9TWF0aC5zcXJ0KDIpKm8ubGVuZ3RoL3I7Y29uc3QgaD1bXTtmb3IobGV0IGw9MDtsPG8ubGVuZ3RoO2wrKyloLnB1c2goWyhvW2xdWzBdLXQpKmksKG9bbF1bMV0tcykqaV0pO3JldHVybntub3JtUG9pbnRzOmgscGFyYW06e21lYW5YOnQsbWVhblk6cyxzOml9fX0sVmU9KG8sbixlKT0+e2NvbnN0IHQ9ZS5zKmUubWVhblgscz1lLnMqZS5tZWFuWSxyPVtvWzBdK3Qqb1s2XSxvWzFdK3Qqb1s3XSwob1swXSt0Km9bNl0pKi1uLm1lYW5YKyhvWzFdK3Qqb1s3XSkqLW4ubWVhblkrKG9bMl0rdCkvbi5zLG9bM10rcypvWzZdLG9bNF0rcypvWzddLChvWzNdK3Mqb1s2XSkqLW4ubWVhblgrKG9bNF0rcypvWzddKSotbi5tZWFuWSsob1s1XStzKS9uLnMsZS5zKm9bNl0sZS5zKm9bN10sZS5zKm9bNl0qLW4ubWVhblgrZS5zKm9bN10qLW4ubWVhblkrZS5zL24uc107Zm9yKGxldCBpPTA7aTw5O2krKylyW2ldPXJbaV0vcls4XTtyZXR1cm4gcn0sWGU9LjAxLFVlPTEwLCRlPTIwLExlPTEwLFV0PW89Pntjb25zdHtzcmNQb2ludHM6bixkc3RQb2ludHM6ZSxrZXlmcmFtZTp0LHF1aWNrTW9kZTpzfT1vLHI9W1swLDBdLFt0LndpZHRoLDBdLFt0LndpZHRoLHQuaGVpZ2h0XSxbMCx0LmhlaWdodF1dLGk9NDtpZihuLmxlbmd0aDxpKXJldHVybiBudWxsO2NvbnN0IGg9WGUsbD0xLyhoKmgpLHU9TWF0aC5taW4oVWUsbi5sZW5ndGgpLGY9VGUoKSxnPVtdO2ZvcihsZXQgRT0wO0U8bi5sZW5ndGg7RSsrKWdbRV09RTtmLmFycmF5U2h1ZmZsZSh7YXJyOmcsc2FtcGxlU2l6ZTpnLmxlbmd0aH0pO2NvbnN0IGE9cz9MZTokZSxqPWEqMjtsZXQgdz0wO2NvbnN0IHk9W107Zm9yKDt3PGomJnkubGVuZ3RoPGE7KXtpZih3Kz0xLGYuYXJyYXlTaHVmZmxlKHthcnI6ZyxzYW1wbGVTaXplOml9KSwhemUobltnWzBdXSxuW2dbMV1dLG5bZ1syXV0sbltnWzNdXSxlW2dbMF1dLGVbZ1sxXV0sZVtnWzJdXSxlW2dbM11dKSljb250aW51ZTtjb25zdCBFPVZ0KFtuW2dbMF1dLG5bZ1sxXV0sbltnWzJdXSxuW2dbM11dXSxbZVtnWzBdXSxlW2dbMV1dLGVbZ1syXV0sZVtnWzNdXV0pO0UhPT1udWxsJiZIZSh7SDpFLHRlc3RQb2ludHM6cn0pJiZ5LnB1c2goRSl9aWYoeS5sZW5ndGg9PT0wKXJldHVybiBudWxsO2NvbnN0IG09W107Zm9yKGxldCBFPTA7RTx5Lmxlbmd0aDtFKyspbS5wdXNoKHtIOnlbRV0sY29zdDowfSk7bGV0IE09dTtmb3IobGV0IEU9MDtFPG4ubGVuZ3RoJiZtLmxlbmd0aD4yO0UrPU0pe009TWF0aC5taW4odSxuLmxlbmd0aC1FKTtsZXQgaz1FK007Zm9yKGxldCBSPTA7UjxtLmxlbmd0aDtSKyspZm9yKGxldCBxPUU7cTxrO3ErKyl7Y29uc3QgST1DZSh7SDptW1JdLkgsc3JjUG9pbnQ6bltxXSxkc3RQb2ludDplW3FdLG9uZU92ZXJTY2FsZTI6bH0pO21bUl0uY29zdCs9SX1tLnNvcnQoKFIscSk9PlIuY29zdC1xLmNvc3QpLG0uc3BsaWNlKC1NYXRoLmZsb29yKChtLmxlbmd0aCsxKS8yKSl9bGV0IFQ9bnVsbDtmb3IobGV0IEU9MDtFPG0ubGVuZ3RoO0UrKyl7Y29uc3Qgaz1ZZSh7aW5IOm1bRV0uSH0pO2lmKE9lKHtIOmssdGVzdFBvaW50czpyLGtleWZyYW1lOnR9KSl7VD1rO2JyZWFrfX1yZXR1cm4gVH0sT2U9KHtIOm8sdGVzdFBvaW50czpuLGtleWZyYW1lOmV9KT0+e2NvbnN0IHQ9QnQobywxZS01KTtpZih0PT09bnVsbClyZXR1cm4hMTtjb25zdCBzPVtdO2ZvcihsZXQgaT0wO2k8bi5sZW5ndGg7aSsrKXMucHVzaChvdChuW2ldLHQpKTtyZXR1cm4hKERlKHNbMF0sc1sxXSxzWzJdLHNbM10pPGUud2lkdGgqZS5oZWlnaHQqMWUtNHx8IUJlKHNbMF0sc1sxXSxzWzJdLHNbM10pKX0sWWU9KHtpbkg6b30pPT57Y29uc3Qgbj0xL29bOF0sZT1bXTtmb3IobGV0IHQ9MDt0PDg7dCsrKWVbdF09b1t0XSpuO3JldHVybiBlWzhdPTEsZX0sQ2U9KHtIOm8sc3JjUG9pbnQ6bixkc3RQb2ludDplLG9uZU92ZXJTY2FsZTI6dH0pPT57Y29uc3Qgcz1vdChuLG8pLHI9W3NbMF0tZVswXSxzWzFdLWVbMV1dO3JldHVybiBNYXRoLmxvZygxKyhyWzBdKnJbMF0rclsxXSpyWzFdKSp0KX0sSGU9KHtIOm8sdGVzdFBvaW50czpufSk9Pntjb25zdCBlPVtdO2ZvcihsZXQgdD0wO3Q8bi5sZW5ndGg7dCsrKWVbdF09b3Qoblt0XSxvKTtmb3IobGV0IHQ9MDt0PG4ubGVuZ3RoO3QrKyl7Y29uc3Qgcz10LHI9KHQrMSklbi5sZW5ndGgsaT0odCsyKSVuLmxlbmd0aDtpZighRmUobltzXSxuW3JdLG5baV0sZVtzXSxlW3JdLGVbaV0pKXJldHVybiExfXJldHVybiEwfSwkdD0zLEx0PTYsS2U9OCxPdD0uNyxKZT0oe2tleWZyYW1lOm8scXVlcnlwb2ludHM6bixxdWVyeXdpZHRoOmUscXVlcnloZWlnaHQ6dCxkZWJ1Z01vZGU6c30pPT57bGV0IHI9e307Y29uc3QgaT1bXTtmb3IobGV0IG09MDttPG4ubGVuZ3RoO20rKyl7Y29uc3QgTT1uW21dLFQ9TS5tYXhpbWE/by5tYXhpbWFQb2ludHM6by5taW5pbWFQb2ludHM7aWYoVC5sZW5ndGg9PT0wKWNvbnRpbnVlO2NvbnN0IEU9TS5tYXhpbWE/by5tYXhpbWFQb2ludHNDbHVzdGVyLnJvb3ROb2RlOm8ubWluaW1hUG9pbnRzQ2x1c3Rlci5yb290Tm9kZSxrPVtdLFI9bmV3IFd0KFtdLChCLGMpPT5CLmQtYy5kKTtFdCh7bm9kZTpFLGtleXBvaW50czpULHF1ZXJ5cG9pbnQ6TSxxdWV1ZTpSLGtleXBvaW50SW5kZXhlczprLG51bVBvcDowfSk7bGV0IHE9LTEsST1OdW1iZXIuTUFYX1NBRkVfSU5URUdFUix6PU51bWJlci5NQVhfU0FGRV9JTlRFR0VSO2ZvcihsZXQgQj0wO0I8ay5sZW5ndGg7QisrKXtjb25zdCBjPVRba1tCXV0scD15dCh7djE6Yy5kZXNjcmlwdG9ycyx2MjpNLmRlc2NyaXB0b3JzfSk7cDxJPyh6PUksST1wLHE9a1tCXSk6cDx6JiYoej1wKX1xIT09LTEmJih6PT09TnVtYmVyLk1BWF9TQUZFX0lOVEVHRVJ8fDEqSS96PE90KSYmaS5wdXNoKHtxdWVyeXBvaW50Ok0sa2V5cG9pbnQ6VFtxXX0pfWlmKHMmJihyLm1hdGNoZXM9aSksaS5sZW5ndGg8THQpcmV0dXJue2RlYnVnRXh0cmE6cn07Y29uc3QgaD12dCh7a2V5d2lkdGg6by53aWR0aCxrZXloZWlnaHQ6by5oZWlnaHQscXVlcnl3aWR0aDplLHF1ZXJ5aGVpZ2h0OnQsbWF0Y2hlczppfSk7cyYmKHIuaG91Z2hNYXRjaGVzPWgpO2NvbnN0IGw9VXQoe3NyY1BvaW50czpoLm1hcChtPT5bbS5rZXlwb2ludC54LG0ua2V5cG9pbnQueV0pLGRzdFBvaW50czpoLm1hcChtPT5bbS5xdWVyeXBvaW50LngsbS5xdWVyeXBvaW50LnldKSxrZXlmcmFtZTpvfSk7aWYobD09PW51bGwpcmV0dXJue2RlYnVnRXh0cmE6cn07Y29uc3QgdT1ZdCh7SDpsLG1hdGNoZXM6aCx0aHJlc2hvbGQ6JHR9KTtpZihzJiYoci5pbmxpZXJNYXRjaGVzPXUpLHUubGVuZ3RoPEx0KXJldHVybntkZWJ1Z0V4dHJhOnJ9O2NvbnN0IGY9QnQobCwxZS01KSxnPTEwKjEwLGE9W107Zm9yKGxldCBtPTA7bTxuLmxlbmd0aDttKyspe2NvbnN0IE09blttXSxUPW90KFtNLngsTS55XSxmKTtsZXQgRT0tMSxrPU51bWJlci5NQVhfU0FGRV9JTlRFR0VSLFI9TnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7Y29uc3QgcT1NLm1heGltYT9vLm1heGltYVBvaW50czpvLm1pbmltYVBvaW50cztmb3IobGV0IEk9MDtJPHEubGVuZ3RoO0krKyl7Y29uc3Qgej1xW0ldO2lmKCh6LngtVFswXSkqKHoueC1UWzBdKSsoei55LVRbMV0pKih6LnktVFsxXSk+Zyljb250aW51ZTtjb25zdCBjPXl0KHt2MTp6LmRlc2NyaXB0b3JzLHYyOk0uZGVzY3JpcHRvcnN9KTtjPGs/KFI9ayxrPWMsRT1JKTpjPFImJihSPWMpfUUhPT0tMSYmKFI9PT1OdW1iZXIuTUFYX1NBRkVfSU5URUdFUnx8MSprL1I8T3QpJiZhLnB1c2goe3F1ZXJ5cG9pbnQ6TSxrZXlwb2ludDpxW0VdfSl9cyYmKHIubWF0Y2hlczI9YSk7Y29uc3Qgaj12dCh7a2V5d2lkdGg6by53aWR0aCxrZXloZWlnaHQ6by5oZWlnaHQscXVlcnl3aWR0aDplLHF1ZXJ5aGVpZ2h0OnQsbWF0Y2hlczphfSk7cyYmKHIuaG91Z2hNYXRjaGVzMj1qKTtjb25zdCB3PVV0KHtzcmNQb2ludHM6ai5tYXAobT0+W20ua2V5cG9pbnQueCxtLmtleXBvaW50LnldKSxkc3RQb2ludHM6ai5tYXAobT0+W20ucXVlcnlwb2ludC54LG0ucXVlcnlwb2ludC55XSksa2V5ZnJhbWU6b30pO2lmKHc9PT1udWxsKXJldHVybntkZWJ1Z0V4dHJhOnJ9O2NvbnN0IHk9WXQoe0g6dyxtYXRjaGVzOmosdGhyZXNob2xkOiR0fSk7cmV0dXJuIHMmJihyLmlubGllck1hdGNoZXMyPXkpLHtIOncsbWF0Y2hlczp5LGRlYnVnRXh0cmE6cn19LEV0PSh7bm9kZTpvLGtleXBvaW50czpuLHF1ZXJ5cG9pbnQ6ZSxxdWV1ZTp0LGtleXBvaW50SW5kZXhlczpzLG51bVBvcDpyfSk9PntpZihvLmxlYWYpe2ZvcihsZXQgbD0wO2w8by5wb2ludEluZGV4ZXMubGVuZ3RoO2wrKylzLnB1c2goby5wb2ludEluZGV4ZXNbbF0pO3JldHVybn1jb25zdCBpPVtdO2ZvcihsZXQgbD0wO2w8by5jaGlsZHJlbi5sZW5ndGg7bCsrKXtjb25zdCBmPW8uY2hpbGRyZW5bbF0uY2VudGVyUG9pbnRJbmRleCxnPXl0KHt2MTpuW2ZdLmRlc2NyaXB0b3JzLHYyOmUuZGVzY3JpcHRvcnN9KTtpLnB1c2goZyl9bGV0IGg9TnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7Zm9yKGxldCBsPTA7bDxvLmNoaWxkcmVuLmxlbmd0aDtsKyspaD1NYXRoLm1pbihoLGlbbF0pO2ZvcihsZXQgbD0wO2w8by5jaGlsZHJlbi5sZW5ndGg7bCsrKWlbbF0hPT1oJiZ0LnB1c2goe25vZGU6by5jaGlsZHJlbltsXSxkOmlbbF19KTtmb3IobGV0IGw9MDtsPG8uY2hpbGRyZW4ubGVuZ3RoO2wrKylpW2xdPT09aCYmRXQoe25vZGU6by5jaGlsZHJlbltsXSxrZXlwb2ludHM6bixxdWVyeXBvaW50OmUscXVldWU6dCxrZXlwb2ludEluZGV4ZXM6cyxudW1Qb3A6cn0pO2lmKHI8S2UmJnQubGVuZ3RoPjApe2NvbnN0e25vZGU6bCxkOnV9PXQucG9wKCk7cis9MSxFdCh7bm9kZTpsLGtleXBvaW50czpuLHF1ZXJ5cG9pbnQ6ZSxxdWV1ZTp0LGtleXBvaW50SW5kZXhlczpzLG51bVBvcDpyfSl9fSxZdD1vPT57Y29uc3R7SDpuLG1hdGNoZXM6ZSx0aHJlc2hvbGQ6dH09byxzPXQqdCxyPVtdO2ZvcihsZXQgaT0wO2k8ZS5sZW5ndGg7aSsrKXtjb25zdCBoPWVbaV0ucXVlcnlwb2ludCxsPWVbaV0ua2V5cG9pbnQsdT1vdChbbC54LGwueV0sbik7KHVbMF0taC54KSoodVswXS1oLngpKyh1WzFdLWgueSkqKHVbMV0taC55KTw9cyYmci5wdXNoKGVbaV0pfXJldHVybiByfTtjbGFzcyBHZXtjb25zdHJ1Y3RvcihuLGUsdD0hMSl7dGhpcy5xdWVyeVdpZHRoPW4sdGhpcy5xdWVyeUhlaWdodD1lLHRoaXMuZGVidWdNb2RlPXR9bWF0Y2hEZXRlY3Rpb24obixlKXtsZXQgdD17ZnJhbWVzOltdfSxzPW51bGw7Zm9yKGxldCBsPTA7bDxuLmxlbmd0aDtsKyspe2NvbnN0e0g6dSxtYXRjaGVzOmYsZGVidWdFeHRyYTpnfT1KZSh7a2V5ZnJhbWU6bltsXSxxdWVyeXBvaW50czplLHF1ZXJ5d2lkdGg6dGhpcy5xdWVyeVdpZHRoLHF1ZXJ5aGVpZ2h0OnRoaXMucXVlcnlIZWlnaHQsZGVidWdNb2RlOnRoaXMuZGVidWdNb2RlfSk7dC5mcmFtZXMucHVzaChnKSx1JiYocz09PW51bGx8fHMubWF0Y2hlcy5sZW5ndGg8Zi5sZW5ndGgpJiYocz17a2V5ZnJhbWVJbmRleDpsLEg6dSxtYXRjaGVzOmZ9KX1pZihzPT09bnVsbClyZXR1cm57a2V5ZnJhbWVJbmRleDotMSxkZWJ1Z0V4dHJhOnR9O2NvbnN0IHI9W10saT1bXSxoPW5bcy5rZXlmcmFtZUluZGV4XTtmb3IobGV0IGw9MDtsPHMubWF0Y2hlcy5sZW5ndGg7bCsrKXtjb25zdCB1PXMubWF0Y2hlc1tsXS5xdWVyeXBvaW50LGY9cy5tYXRjaGVzW2xdLmtleXBvaW50O3IucHVzaCh7eDp1LngseTp1Lnl9KSxpLnB1c2goe3g6KGYueCsuNSkvaC5zY2FsZSx5OihmLnkrLjUpL2guc2NhbGUsejowfSl9cmV0dXJue3NjcmVlbkNvb3JkczpyLHdvcmxkQ29vcmRzOmksa2V5ZnJhbWVJbmRleDpzLmtleWZyYW1lSW5kZXgsZGVidWdFeHRyYTp0fX19Y29uc3QgV2U9KHtzY3JlZW5Db29yZHM6byx3b3JsZENvb3JkczpuLHByb2plY3Rpb25UcmFuc2Zvcm06ZX0pPT57Y29uc3QgdD1WdChuLm1hcChtPT5bbS54LG0ueV0pLG8ubWFwKG09PlttLngsbS55XSkpLHM9bmV3IGIoW1t0WzBdLHRbMV0sdFsyXV0sW3RbM10sdFs0XSx0WzVdXSxbdFs2XSx0WzddLHRbOF1dXSkscj1uZXcgYihlKSxsPU10KHIpLm1tdWwocykudG8xREFycmF5KCksdT1NYXRoLnNxcnQobFswXSpsWzBdK2xbM10qbFszXStsWzZdKmxbNl0pLGY9TWF0aC5zcXJ0KGxbMV0qbFsxXStsWzRdKmxbNF0rbFs3XSpsWzddKSxnPSh1K2YpLzIsYT1bXTthWzBdPWxbMF0vdSxhWzNdPWxbM10vdSxhWzZdPWxbNl0vdSxhWzFdPWxbMV0vZixhWzRdPWxbNF0vZixhWzddPWxbN10vZixhWzJdPWFbM10qYVs3XS1hWzZdKmFbNF0sYVs1XT1hWzZdKmFbMV0tYVswXSphWzddLGFbOF09YVswXSphWzRdLWFbMV0qYVszXTtjb25zdCBqPU1hdGguc3FydChhWzJdKmFbMl0rYVs1XSphWzVdK2FbOF0qYVs4XSk7YVsyXS89aixhWzVdLz1qLGFbOF0vPWo7Y29uc3Qgdz1bXTtyZXR1cm4gd1swXT1sWzJdL2csd1sxXT1sWzVdL2csd1syXT1sWzhdL2csW1thWzBdLGFbMV0sYVsyXSx3WzBdXSxbYVszXSxhWzRdLGFbNV0sd1sxXV0sW2FbNl0sYVs3XSxhWzhdLHdbMl1dXX0sUWU9KG8sbik9Pltbb1swXVswXSpuWzBdWzBdK29bMF1bMl0qblsyXVswXSxvWzBdWzBdKm5bMF1bMV0rb1swXVsyXSpuWzJdWzFdLG9bMF1bMF0qblswXVsyXStvWzBdWzJdKm5bMl1bMl0sb1swXVswXSpuWzBdWzNdK29bMF1bMl0qblsyXVszXV0sW29bMV1bMV0qblsxXVswXStvWzFdWzJdKm5bMl1bMF0sb1sxXVsxXSpuWzFdWzFdK29bMV1bMl0qblsyXVsxXSxvWzFdWzFdKm5bMV1bMl0rb1sxXVsyXSpuWzJdWzJdLG9bMV1bMV0qblsxXVszXStvWzFdWzJdKm5bMl1bM11dLFtuWzJdWzBdLG5bMl1bMV0sblsyXVsyXSxuWzJdWzNdXV0sQ3Q9KG8sbixlLHQpPT57Y29uc3Qgcz1vWzBdWzBdKm4rb1swXVsxXSplK29bMF1bM10scj1vWzFdWzBdKm4rb1sxXVsxXSplK29bMV1bM10saT1vWzJdWzBdKm4rb1syXVsxXSplK29bMl1bM107cmV0dXJue3g6cyx5OnIsejppfX0sWmU9KG8sbixlLHQpPT57Y29uc3R7eDpzLHk6cix6Oml9PUN0KG8sbixlKTtyZXR1cm57eDpzL2kseTpyL2l9fSx4ZT01LEFlPTQsSHQ9MTAsdG49LjEsZW49Ljk5O2xldCBIPVtbXSxbXSxbXV0sQT1bW10sW11dLE89W1tdLFtdLFtdXTtjb25zdCBubj0oe2luaXRpYWxNb2RlbFZpZXdUcmFuc2Zvcm06byxwcm9qZWN0aW9uVHJhbnNmb3JtOm4sd29ybGRDb29yZHM6ZSxzY3JlZW5Db29yZHM6dH0pPT57bGV0IHM9MCxyPTA7Zm9yKGxldCBnPTA7ZzxlLmxlbmd0aDtnKyspcys9ZVtnXS54LHIrPWVbZ10ueTtzLz1lLmxlbmd0aCxyLz1lLmxlbmd0aDtjb25zdCBpPVtdO2ZvcihsZXQgZz0wO2c8ZS5sZW5ndGg7ZysrKWkucHVzaCh7eDplW2ddLngtcyx5OmVbZ10ueS1yLHo6ZVtnXS56fSk7Y29uc3QgaD1bW10sW10sW11dO2ZvcihsZXQgZz0wO2c8MztnKyspZm9yKGxldCBhPTA7YTwzO2ErKyloW2ddW2FdPW9bZ11bYV07aFswXVszXT1vWzBdWzBdKnMrb1swXVsxXSpyK29bMF1bM10saFsxXVszXT1vWzFdWzBdKnMrb1sxXVsxXSpyK29bMV1bM10saFsyXVszXT1vWzJdWzBdKnMrb1syXVsxXSpyK29bMl1bM107Y29uc3QgbD1bMSwuOCwuNiwuNCwwXTtsZXQgdT1oLGY9bnVsbDtmb3IobGV0IGc9MDtnPGwubGVuZ3RoO2crKyl7Y29uc3QgYT1zbih7aW5pdGlhbE1vZGVsVmlld1RyYW5zZm9ybTp1LHByb2plY3Rpb25UcmFuc2Zvcm06bix3b3JsZENvb3JkczppLHNjcmVlbkNvb3Jkczp0LGlubGllclByb2I6bFtnXX0pO2lmKHU9YS5tb2RlbFZpZXdUcmFuc2Zvcm0sYS5lcnI8eGUpe2Y9dTticmVha319cmV0dXJuIGY9PT1udWxsP251bGw6KGZbMF1bM109ZlswXVszXS1mWzBdWzBdKnMtZlswXVsxXSpyLGZbMV1bM109ZlsxXVszXS1mWzFdWzBdKnMtZlsxXVsxXSpyLGZbMl1bM109ZlsyXVszXS1mWzJdWzBdKnMtZlsyXVsxXSpyLGYpfSxzbj0oe2luaXRpYWxNb2RlbFZpZXdUcmFuc2Zvcm06byxwcm9qZWN0aW9uVHJhbnNmb3JtOm4sd29ybGRDb29yZHM6ZSxzY3JlZW5Db29yZHM6dCxpbmxpZXJQcm9iOnN9KT0+e2NvbnN0IHI9czwxO2xldCBpPW8saD0wLGw9MCx1PW5ldyBBcnJheShlLmxlbmd0aCksZj1uZXcgQXJyYXkoZS5sZW5ndGgpLGc9bmV3IEFycmF5KGUubGVuZ3RoKSxhPW5ldyBBcnJheShlLmxlbmd0aCk7Zm9yKGxldCBqPTA7ajw9SHQ7aisrKXtjb25zdCB3PVFlKG4saSk7Zm9yKGxldCBFPTA7RTxlLmxlbmd0aDtFKyspe2NvbnN0IGs9WmUodyxlW0VdLngsZVtFXS55LGVbRV0ueiksUj10W0VdLngtay54LHE9dFtFXS55LWsueTtnW0VdPVIsYVtFXT1xLHVbRV09UipSK3EqcX1sZXQgeTtpZihsPTAscil7Y29uc3QgRT1NYXRoLm1heCgzLE1hdGguZmxvb3IoZS5sZW5ndGgqcyktMSk7Zm9yKGxldCBrPTA7azxlLmxlbmd0aDtrKyspZltrXT11W2tdO2Yuc29ydCgoayxSKT0+ay1SKSx5PU1hdGgubWF4KGZbRV0qQWUsMTYpO2ZvcihsZXQgaz0wO2s8ZS5sZW5ndGg7aysrKWZba10+eT9sKz15LzY6bCs9eS82KigxLSgxLWZba10veSkqKDEtZltrXS95KSooMS1mW2tdL3kpKX1lbHNlIGZvcihsZXQgRT0wO0U8ZS5sZW5ndGg7RSsrKWwrPXVbRV07aWYobC89ZS5sZW5ndGgsbDx0bnx8aj4wJiZsL2g+ZW58fGo9PT1IdClicmVhaztoPWw7Y29uc3QgbT1bXSxNPVtdO2ZvcihsZXQgRT0wO0U8ZS5sZW5ndGg7RSsrKXtpZihyJiZ1W0VdPnkpY29udGludWU7Y29uc3Qgaz1sbih7bW9kZWxWaWV3UHJvamVjdGlvblRyYW5zZm9ybTp3LG1vZGVsVmlld1RyYW5zZm9ybTppLHByb2plY3Rpb25UcmFuc2Zvcm06bix3b3JsZENvb3JkOmVbRV19KTtpZihyKXtjb25zdCBSPSgxLXVbRV0veSkqKDEtdVtFXS95KTtmb3IobGV0IHE9MDtxPDI7cSsrKWZvcihsZXQgST0wO0k8NjtJKyspa1txXVtJXSo9UjttLnB1c2goW2dbRV0qUl0pLG0ucHVzaChbYVtFXSpSXSl9ZWxzZSBtLnB1c2goW2dbRV1dKSxtLnB1c2goW2FbRV1dKTtmb3IobGV0IFI9MDtSPGsubGVuZ3RoO1IrKylNLnB1c2goa1tSXSl9Y29uc3QgVD1ybih7ZFU6bSxKX1VfUzpNfSk7aWYoVD09PW51bGwpYnJlYWs7aT1vbih7bW9kZWxWaWV3VHJhbnNmb3JtOmksZFM6VH0pfXJldHVybnttb2RlbFZpZXdUcmFuc2Zvcm06aSxlcnI6bH19LG9uPSh7bW9kZWxWaWV3VHJhbnNmb3JtOm8sZFM6bn0pPT57bGV0IGU9blswXSpuWzBdK25bMV0qblsxXStuWzJdKm5bMl0sdCxzLHI7ZTwxZS02Pyh0PTEscz0wLHI9MCxlPTApOihlPU1hdGguc3FydChlKSx0PW5bMF0vZSxzPW5bMV0vZSxyPW5bMl0vZSk7Y29uc3QgaT1NYXRoLmNvcyhlKSxoPU1hdGguc2luKGUpLGw9MS1pO0hbMF1bMF09dCp0KmwraSxIWzBdWzFdPXQqcypsLXIqaCxIWzBdWzJdPXQqcipsK3MqaCxIWzBdWzNdPW5bM10sSFsxXVswXT1zKnQqbCtyKmgsSFsxXVsxXT1zKnMqbCtpLEhbMV1bMl09cypyKmwtdCpoLEhbMV1bM109bls0XSxIWzJdWzBdPXIqdCpsLXMqaCxIWzJdWzFdPXIqcypsK3QqaCxIWzJdWzJdPXIqcipsK2ksSFsyXVszXT1uWzVdO2NvbnN0IHU9W1tdLFtdLFtdXTtmb3IobGV0IGY9MDtmPDM7ZisrKXtmb3IobGV0IGc9MDtnPDQ7ZysrKXVbZl1bZ109b1tmXVswXSpIWzBdW2ddK29bZl1bMV0qSFsxXVtnXStvW2ZdWzJdKkhbMl1bZ107dVtmXVszXSs9b1tmXVszXX1yZXR1cm4gdX0scm49KHtkVTpvLEpfVV9TOm59KT0+e2NvbnN0IGU9bmV3IGIobiksdD1uZXcgYihvKSxzPWUudHJhbnNwb3NlKCkscj1zLm1tdWwoZSksaT1zLm1tdWwodCk7bGV0IGg7dHJ5e2g9TXQocil9Y2F0Y2h7cmV0dXJuIG51bGx9cmV0dXJuIGgubW11bChpKS50bzFEQXJyYXkoKX0sbG49KHttb2RlbFZpZXdQcm9qZWN0aW9uVHJhbnNmb3JtOm8sbW9kZWxWaWV3VHJhbnNmb3JtOm4scHJvamVjdGlvblRyYW5zZm9ybTplLHdvcmxkQ29vcmQ6dH0pPT57Y29uc3Qgcz1uLHt4OnIseTppLHo6aH09dCxsPUN0KG8scixpKSx1PWwueipsLno7QVswXVswXT1lWzBdWzBdKmwuei91LEFbMF1bMV09ZVswXVsxXSpsLnovdSxBWzBdWzJdPShlWzBdWzJdKmwuei1lWzJdWzJdKmwueCkvdSxBWzFdWzBdPWVbMV1bMF0qbC56L3UsQVsxXVsxXT1lWzFdWzFdKmwuei91LEFbMV1bMl09KGVbMV1bMl0qbC56LWVbMl1bMl0qbC55KS91LE9bMF1bMF09c1swXVsyXSppLE9bMF1bMV09LXNbMF1bMl0qcixPWzBdWzJdPXNbMF1bMV0qci1zWzBdWzBdKmksT1swXVszXT1zWzBdWzBdLE9bMF1bNF09c1swXVsxXSxPWzBdWzVdPXNbMF1bMl0sT1sxXVswXT1zWzFdWzJdKmksT1sxXVsxXT0tc1sxXVsyXSpyLE9bMV1bMl09c1sxXVsxXSpyLXNbMV1bMF0qaSxPWzFdWzNdPXNbMV1bMF0sT1sxXVs0XT1zWzFdWzFdLE9bMV1bNV09c1sxXVsyXSxPWzJdWzBdPXNbMl1bMl0qaSxPWzJdWzFdPS1zWzJdWzJdKnIsT1syXVsyXT1zWzJdWzFdKnItc1syXVswXSppLE9bMl1bM109c1syXVswXSxPWzJdWzRdPXNbMl1bMV0sT1syXVs1XT1zWzJdWzJdO2NvbnN0IGY9W1tdLFtdXTtmb3IobGV0IGc9MDtnPDI7ZysrKWZvcihsZXQgYT0wO2E8NjthKyspe2ZbZ11bYV09MDtmb3IobGV0IGo9MDtqPDM7aisrKWZbZ11bYV0rPUFbZ11bal0qT1tqXVthXX1yZXR1cm4gZn07Y2xhc3MgaG57Y29uc3RydWN0b3Iobil7dGhpcy5wcm9qZWN0aW9uVHJhbnNmb3JtPW59ZXN0aW1hdGUoe3NjcmVlbkNvb3JkczpuLHdvcmxkQ29vcmRzOmV9KXtyZXR1cm4gV2Uoe3NjcmVlbkNvb3JkczpuLHdvcmxkQ29vcmRzOmUscHJvamVjdGlvblRyYW5zZm9ybTp0aGlzLnByb2plY3Rpb25UcmFuc2Zvcm19KX1yZWZpbmVFc3RpbWF0ZSh7aW5pdGlhbE1vZGVsVmlld1RyYW5zZm9ybTpuLHdvcmxkQ29vcmRzOmUsc2NyZWVuQ29vcmRzOnR9KXtyZXR1cm4gbm4oe2luaXRpYWxNb2RlbFZpZXdUcmFuc2Zvcm06bix3b3JsZENvb3JkczplLHNjcmVlbkNvb3Jkczp0LHByb2plY3Rpb25UcmFuc2Zvcm06dGhpcy5wcm9qZWN0aW9uVHJhbnNmb3JtfSl9fWxldCBLdD1udWxsLEp0PSExLEd0PW51bGwsU3Q9bnVsbDtvbm1lc3NhZ2U9bz0+e2NvbnN0e2RhdGE6bn09bztzd2l0Y2gobi50eXBlKXtjYXNlInNldHVwIjpuLnByb2plY3Rpb25UcmFuc2Zvcm0sS3Q9bi5tYXRjaGluZ0RhdGFMaXN0LEp0PW4uZGVidWdNb2RlLEd0PW5ldyBHZShuLmlucHV0V2lkdGgsbi5pbnB1dEhlaWdodCxKdCksU3Q9bmV3IGhuKG4ucHJvamVjdGlvblRyYW5zZm9ybSk7YnJlYWs7Y2FzZSJtYXRjaCI6Y29uc3QgZT1uLnRhcmdldEluZGV4ZXM7bGV0IHQ9LTEscz1udWxsLHI9bnVsbDtmb3IobGV0IGY9MDtmPGUubGVuZ3RoO2YrKyl7Y29uc3QgZz1lW2ZdLHtrZXlmcmFtZUluZGV4OmEsc2NyZWVuQ29vcmRzOmosd29ybGRDb29yZHM6dyxkZWJ1Z0V4dHJhOnl9PUd0Lm1hdGNoRGV0ZWN0aW9uKEt0W2ddLG4uZmVhdHVyZVBvaW50cyk7aWYocj15LGEhPT0tMSl7Y29uc3QgbT1TdC5lc3RpbWF0ZSh7c2NyZWVuQ29vcmRzOmosd29ybGRDb29yZHM6d30pO20mJih0PWcscz1tKTticmVha319cG9zdE1lc3NhZ2Uoe3R5cGU6Im1hdGNoRG9uZSIsdGFyZ2V0SW5kZXg6dCxtb2RlbFZpZXdUcmFuc2Zvcm06cyxkZWJ1Z0V4dHJhOnJ9KTticmVhaztjYXNlInRyYWNrVXBkYXRlIjpjb25zdHttb2RlbFZpZXdUcmFuc2Zvcm06aSx3b3JsZENvb3JkczpoLHNjcmVlbkNvb3JkczpsfT1uLHU9U3QucmVmaW5lRXN0aW1hdGUoe2luaXRpYWxNb2RlbFZpZXdUcmFuc2Zvcm06aSx3b3JsZENvb3JkczpoLHNjcmVlbkNvb3JkczpsfSk7cG9zdE1lc3NhZ2Uoe3R5cGU6InRyYWNrVXBkYXRlRG9uZSIsbW9kZWxWaWV3VHJhbnNmb3JtOnV9KTticmVhaztjYXNlImRpc3Bvc2UiOmNsb3NlKCk7YnJlYWs7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgbWVzc2FnZSB0eXBlICcke24udHlwZX0nYCl9fX0pKCk7Cg==",LR=typeof window<"u"&&window.Blob&&new Blob([atob(ER)],{type:"text/javascript;charset=utf-8"});function Yee(n){let e;try{if(e=LR&&(window.URL||window.webkitURL).createObjectURL(LR),!e)throw"";const t=new Worker(e,{name:n==null?void 0:n.name});return t.addEventListener("error",()=>{(window.URL||window.webkitURL).revokeObjectURL(e)}),t}catch{return new Worker("data:application/javascript;base64,"+ER,{name:n==null?void 0:n.name})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}const Qee=(n,e)=>[[n[0][0]*e[0][0]+n[0][2]*e[2][0],n[0][0]*e[0][1]+n[0][2]*e[2][1],n[0][0]*e[0][2]+n[0][2]*e[2][2],n[0][0]*e[0][3]+n[0][2]*e[2][3]],[n[1][1]*e[1][0]+n[1][2]*e[2][0],n[1][1]*e[1][1]+n[1][2]*e[2][1],n[1][1]*e[1][2]+n[1][2]*e[2][2],n[1][1]*e[1][3]+n[1][2]*e[2][3]],[e[2][0],e[2][1],e[2][2],e[2][3]]],Jee=(n,e,t,r)=>{const s=n[0][0]*e+n[0][1]*t+n[0][3],i=n[1][0]*e+n[1][1]*t+n[1][3],l=n[2][0]*e+n[2][1]*t+n[2][3];return{x:s,y:i,z:l}},qee=(n,e,t,r)=>{const{x:s,y:i,z:l}=Jee(n,e,t);return{x:s/l,y:i/l}},ete=6,tte=1,nte=10,rte=1,ste=.8,ate=1,Qs=1e3;class ite{constructor(e,t,r,s,i,l=!1){this.markerDimensions=e,this.trackingDataList=t,this.projectionTransform=r,this.debugMode=l,this.trackingKeyframeList=[];for(let c=0;c<t.length;c++)this.trackingKeyframeList.push(t[c][ate]);let u=0;for(let c=0;c<this.trackingKeyframeList.length;c++)u=Math.max(u,this.trackingKeyframeList[c].points.length);this.featurePointsListT=[],this.imagePixelsListT=[],this.imagePropertiesListT=[];for(let c=0;c<this.trackingKeyframeList.length;c++){const{featurePoints:h,imagePixels:p,imageProperties:m}=this._prebuild(this.trackingKeyframeList[c],u);this.featurePointsListT[c]=h,this.imagePixelsListT[c]=p,this.imagePropertiesListT[c]=m}this.kernelCaches={}}dummyRun(e){let t=[[1,1,1,1],[1,1,1,1],[1,1,1,1]];for(let r=0;r<this.featurePointsListT.length;r++)this.track(e,t,r)}track(e,t,r){let s={};const i=Qee(this.projectionTransform,t),l=this._buildAdjustedModelViewTransform(i);this.markerDimensions[r][0],this.markerDimensions[r][1],this.trackingKeyframeList[r].width,this.trackingKeyframeList[r].height;const u=this.featurePointsListT[r],c=this.imagePixelsListT[r],h=this.imagePropertiesListT[r],p=this._computeProjection(l,e,r),{matchingPointsT:m,simT:g}=this._computeMatching(u,c,h,p),y=m.arraySync(),v=g.arraySync(),w=this.trackingKeyframeList[r],S=[],I=[],C=[];for(let R=0;R<y.length;R++)if(v[R]>ste&&R<w.points.length){C.push(R);const L=qee(i,y[R][0],y[R][1]);I.push(L),S.push({x:w.points[R].x/w.scale,y:w.points[R].y/w.scale,z:0})}return this.debugMode&&(s={projectedImage:p.arraySync(),matchingPoints:m.arraySync(),goodTrack:C,trackedPoints:I}),l.dispose(),p.dispose(),m.dispose(),g.dispose(),{worldCoords:S,screenCoords:I,debugExtra:s}}_computeMatching(e,t,r,s){const i=ete,l=i*2+1,u=nte*tte,c=rte,h=u*2+1,p=s.shape[0],m=s.shape[1],g=e.shape[0];if(!this.kernelCaches.computeMatching){const y={variableNames:["features","markerPixels","markerProperties","targetPixels"],outputShape:[g,h*h],userCode:`
	  void main() {
	    ivec2 coords = getOutputCoords();

	    int featureIndex = coords[0];
	    int searchOffsetIndex = coords[1];

	    int markerWidth = int(getMarkerProperties(0));
	    int markerHeight = int(getMarkerProperties(1));
	    float markerScale = getMarkerProperties(2);

	    int searchOffsetX = imod(searchOffsetIndex, ${h}) * ${c};
	    int searchOffsetY = searchOffsetIndex / ${h} * ${c};

	    int sCenterX = int(getFeatures(featureIndex, 0) * markerScale);
	    int sCenterY = int(getFeatures(featureIndex, 1) * markerScale);

	    int sx = sCenterX + searchOffsetX - ${u};
	    int sy = sCenterY + searchOffsetY - ${u};

	    if (sx < ${i} || sx >= (${m} - ${i}) || sy < ${i} || sy >= (${p} - ${i})) {
	      setOutput(-2.);
	    } 
	    else {
	      float sumPoint = 0.;
	      float sumPointSquare = 0.;
	      float sumTemplate = 0.;
	      float sumTemplateSquare = 0.;
	      float sumPointTemplate = 0.;

	      for (int templateOffsetY = 0; templateOffsetY < ${l}; templateOffsetY++) {
		for (int templateOffsetX = 0; templateOffsetX < ${l}; templateOffsetX++) {
		  int fx2 = sCenterX + templateOffsetX - ${i};
		  int fy2 = sCenterY + templateOffsetY - ${i};

		  int sx2 = sx + templateOffsetX - ${i};
		  int sy2 = sy + templateOffsetY - ${i};

		  int markerPixelIndex = fy2 * markerWidth + fx2;
		  float markerPixel = getMarkerPixels(markerPixelIndex);
		  float targetPixel = getTargetPixels(sy2, sx2);

		  sumTemplate += markerPixel;
		  sumTemplateSquare += markerPixel * markerPixel;
		  sumPoint += targetPixel;
		  sumPointSquare += targetPixel * targetPixel;
		  sumPointTemplate += targetPixel * markerPixel;
		}
	      }

	      // Normalized cross-correlation
	      // !important divide first avoid overflow (e.g. sumPoint / count * sumPoint)
	      float count = float(${l} * ${l});
	      float pointVariance = sqrt(sumPointSquare - sumPoint / count * sumPoint);
	      float templateVariance = sqrt(sumTemplateSquare - sumTemplate / count * sumTemplate);

	      if (pointVariance < 0.0000001) {
		setOutput(-3.);
	      } else if (templateVariance < 0.0000001) {
		//setOutput(sumTemplate);
		setOutput(-4.);
	      } else {
		sumPointTemplate -= sumPoint / count * sumTemplate;
		float sim = sumPointTemplate / pointVariance / templateVariance;  
		setOutput(sim);
	      }
	    }
	  }
	`},v={variableNames:["featurePoints","markerProperties","maxIndex"],outputShape:[g,2],userCode:`
	  void main() {
	    ivec2 coords = getOutputCoords();

	    float markerScale = getMarkerProperties(2);

	    int featureIndex = coords[0];

	    int maxIndex = int(getMaxIndex(featureIndex));
	    int searchLocationIndex = maxIndex / ${h*h};
	    int searchOffsetIndex = imod(maxIndex, ${h*h});

	    if (coords[1] == 0) {
	      int searchOffsetX = imod(searchOffsetIndex, ${h}) * ${c};
	      setOutput(getFeaturePoints(featureIndex, 0) + float(searchOffsetX - ${u}) / markerScale);
	    }
	    else if (coords[1] == 1) {
	      int searchOffsetY = searchOffsetIndex / ${h} * ${c};
	      setOutput(getFeaturePoints(featureIndex, 1) + float(searchOffsetY - ${u}) / markerScale);
	    }
	  }
	`},w={variableNames:["sims","maxIndex"],outputShape:[g],userCode:`
	  void main() {
	    int featureIndex = getOutputCoords();
	    int maxIndex = int(getMaxIndex(featureIndex));
	    setOutput(getSims(featureIndex, maxIndex));
	  }
	`};this.kernelCaches.computeMatching=[y,v,w]}return ee(()=>{const y=this.kernelCaches.computeMatching,v=this._compileAndRun(y[0],[e,t,r,s]),w=v.argMax(1),S=this._compileAndRun(y[1],[e,r,w]),I=this._compileAndRun(y[2],[v,w]);return{matchingPointsT:S,simT:I}})}_computeProjection(e,t,r){const s=this.trackingKeyframeList[r].width,i=this.trackingKeyframeList[r].height,l=this.trackingKeyframeList[r].scale,u=s+"-"+i+"-"+l;if(this.kernelCaches.computeProjection||(this.kernelCaches.computeProjection={}),!this.kernelCaches.computeProjection[u]){const c={variableNames:["M","pixel"],outputShape:[i,s],userCode:`
	  void main() {
	      ivec2 coords = getOutputCoords();

	      float m00 = getM(0, 0) * ${Qs}.;
	      float m01 = getM(0, 1) * ${Qs}.;
	      float m03 = getM(0, 3) * ${Qs}.;
	      float m10 = getM(1, 0) * ${Qs}.;
	      float m11 = getM(1, 1) * ${Qs}.;
	      float m13 = getM(1, 3) * ${Qs}.;
	      float m20 = getM(2, 0) * ${Qs}.;
	      float m21 = getM(2, 1) * ${Qs}.;
	      float m23 = getM(2, 3) * ${Qs}.;

	      float y = float(coords[0]) / float(${l});
	      float x = float(coords[1]) / float(${l});
	      float uz = (x * m20) + (y * m21) + m23;
	      float oneOverUz = 1. / uz;

	      float ux = (x * m00) + (y * m01) + m03;
	      float uy = (x * m10) + (y * m11) + m13;

	      ux = floor(ux * oneOverUz + 0.5);
	      uy = floor(uy * oneOverUz + 0.5);
	      setOutput(getPixel(int(uy), int(ux)));
	    }
	`};this.kernelCaches.computeProjection[u]=c}return ee(()=>{const c=this.kernelCaches.computeProjection[u];return this._compileAndRun(c,[e,t])})}_buildAdjustedModelViewTransform(e){return ee(()=>{let t=[];for(let r=0;r<e.length;r++){t.push([]);for(let s=0;s<e[r].length;s++)t[r].push(e[r][s]/Qs)}return Tr(t,[3,4])})}_prebuild(e,t){return ee(()=>{const r=e.scale,s=[];for(let u=0;u<t;u++)u<e.points.length?s.push([e.points[u].x/r,e.points[u].y/r]):s.push([-1,-1]);const i=Tr(e.data,[e.width*e.height]),l=Tr([e.width,e.height,e.scale],[3]);return{featurePoints:Tr(s,[s.length,2],"float32"),imagePixels:i,imageProperties:l}})}_compileAndRun(e,t){const r=Ka().compileAndRun(e,t);return vt().makeTensorFromDataId(r.dataId,r.shape,r.dtype)}}const Sf=[{sigma:.55,points:[[-1,0],[-.5,-.866025],[.5,-.866025],[1,-0],[.5,.866025],[-.5,.866025]]},{sigma:.475,points:[[0,.930969],[-.806243,.465485],[-.806243,-.465485],[-0,-.930969],[.806243,-.465485],[.806243,.465485]]},{sigma:.4,points:[[.847306,-0],[.423653,.733789],[-.423653,.733789],[-.847306,0],[-.423653,-.733789],[.423653,-.733789]]},{sigma:.325,points:[[-0,-.741094],[.641806,-.370547],[.641806,.370547],[0,.741094],[-.641806,.370547],[-.641806,-.370547]]},{sigma:.25,points:[[-.595502,0],[-.297751,-.51572],[.297751,-.51572],[.595502,-0],[.297751,.51572],[-.297751,.51572]]},{sigma:.175,points:[[0,.362783],[-.314179,.181391],[-.314179,-.181391],[-0,-.362783],[.314179,-.181391],[.314179,.181391]]},{sigma:.1,points:[[0,0]]}],wo=[];for(let n=0;n<Sf.length;n++){const e=Sf[n].sigma;for(let t=0;t<Sf[n].points.length;t++){const r=Sf[n].points[t];wo.push([e,r[0],r[1]])}}const sx={};function ote(n){const e=n.shape[1],t=n.shape[0],r="w"+e+"h"+t;if(!sx.hasOwnProperty(r)){const s={variableNames:["p"],outputShape:[t,e],userCode:`
        void main() {
          ivec2 coords = getOutputCoords();

          float sum = getP(coords[0], coords[1]-2);
          sum += getP(coords[0], coords[1]-1) * 4.;
          sum += getP(coords[0], coords[1]) * 6.;
          sum += getP(coords[0], coords[1]+1) * 4.;
          sum += getP(coords[0], coords[1]+2);
          setOutput(sum);
        }
      `},i={variableNames:["p"],outputShape:[t,e],userCode:`
        void main() {
          ivec2 coords = getOutputCoords();

          float sum = getP(coords[0]-2, coords[1]);
          sum += getP(coords[0]-1, coords[1]) * 4.;
          sum += getP(coords[0], coords[1]) * 6.;
          sum += getP(coords[0]+1, coords[1]) * 4.;
          sum += getP(coords[0]+2, coords[1]);
          sum /= 256.;
          setOutput(sum);
        }
      `};sx[r]=[s,i]}return sx[r]}const lte={kernelName:"BinomialFilter",backendName:"webgl",kernelFunc:n=>{const e=n.inputs.image,t=n.backend,[r,s]=ote(e),i=t.runWebGLProgram(r,[e],e.dtype),l=t.runWebGLProgram(s,[i],e.dtype);return t.disposeIntermediateTensorInfo(i),l}},Cf=7,GR=3,ute=GR*GR,ax=4,cte=(ax+1)*(ax+1)/ax,ix={};function dte(n){const e=n.shape[1],t=n.shape[0],r="w"+e+"h"+t;if(!ix.hasOwnProperty(r)){const s={variableNames:["image0","image1","image2"],outputShape:[t,e],userCode:`
        void main() {
          ivec2 coords = getOutputCoords();
    
          int y = coords[0];
          int x = coords[1];
    
          float value = getImage1(y, x);
    
          // Step 1: find local maxima/minima
          if (value * value < ${ute}.) {
            setOutput(0.);
            return;
          }
          if (y < ${Cf} || y > ${t-1-Cf}) {
            setOutput(0.);
            return;
          }
          if (x < ${Cf} || x > ${e-1-Cf}) {
            setOutput(0.);
            return;
          }
    
          bool isMax = true;
          bool isMin = true;
          for (int dy = -1; dy <= 1; dy++) {
            for (int dx = -1; dx <= 1; dx++) {
              float value0 = getImage0(y+dy, x+dx);
              float value1 = getImage1(y+dy, x+dx);
              float value2 = getImage2(y+dy, x+dx);
    
        if (value < value0 || value < value1 || value < value2) {
          isMax = false;
        }
        if (value > value0 || value > value1 || value > value2) {
          isMin = false;
        }
            }
          }
    
          if (!isMax && !isMin) {
            setOutput(0.);
            return;
          }
    
          // compute edge score and reject based on threshold
          float dxx = getImage1(y, x+1) + getImage1(y, x-1) - 2. * getImage1(y, x);
          float dyy = getImage1(y+1, x) + getImage1(y-1, x) - 2. * getImage1(y, x);
          float dxy = 0.25 * (getImage1(y-1,x-1) + getImage1(y+1,x+1) - getImage1(y-1,x+1) - getImage1(y+1,x-1));
    
          float det = (dxx * dyy) - (dxy * dxy);
    
          if (abs(det) < 0.0001) { // determinant undefined. no solution
            setOutput(0.);
            return;
          }
    
          float edgeScore = (dxx + dyy) * (dxx + dyy) / det;
    
          if (abs(edgeScore) >= ${cte} ) {
            setOutput(0.);
            return;
          }
          setOutput(getImage1(y,x));
        }
      `};ix[r]=s}return ix[r]}const hte={kernelName:"BuildExtremas",backendName:"webgl",kernelFunc:n=>{let{image0:e,image1:t,image2:r}=n.inputs;const s=n.backend,i=dte(t);return e=vt().runKernel("DownsampleBilinear",{image:e}),r=vt().runKernel("UpsampleBilinear",{image:r,targetImage:t}),s.runWebGLProgram(i,[e,t,r],t.dtype)}},td=36,ox={};function pte(n){const e=n.shape[0];if(!ox.hasOwnProperty(e)){const t={variableNames:["histogram"],outputShape:[n.shape[0]],userCode:`
            void main() {
                int featureIndex = getOutputCoords();

                int maxIndex = 0;
                for (int i = 1; i < ${td}; i++) {
                    if (getHistogram(featureIndex, i) > getHistogram(featureIndex, maxIndex)) {
                        maxIndex = i;
                    }
                }

                int prev = imod(maxIndex - 1 + ${td}, ${td});
                int next = imod(maxIndex + 1, ${td});

                /**
                 * Fit a quatratic to 3 points. The system of equations is:
                 *
                 * y0 = A*x0^2 + B*x0 + C
                 * y1 = A*x1^2 + B*x1 + C
                 * y2 = A*x2^2 + B*x2 + C
                 *
                 * This system of equations is solved for A,B,C.
                 */
                float p10 = float(maxIndex - 1);
                float p11 = getHistogram(featureIndex, prev); 
                float p20 = float(maxIndex);
                float p21 = getHistogram(featureIndex, maxIndex); 
                float p30 = float(maxIndex + 1);
                float p31 = getHistogram(featureIndex, next); 

                float d1 = (p30-p20)*(p30-p10);
                float d2 = (p10-p20)*(p30-p10);
                float d3 = p10-p20;

                // If any of the denominators are zero then, just use maxIndex.
                    float fbin = float(maxIndex);
                if ( abs(d1) > 0.00001 && abs(d2) > 0.00001 && abs(d3) > 0.00001) {
                float a = p10*p10;
                float b = p20*p20;

                // Solve for the coefficients A,B,C
                float A = ((p31-p21)/d1)-((p11-p21)/d2);
                float B = ((p11-p21)+(A*(b-a)))/d3;
                float C = p11-(A*a)-(B*p10);
                fbin = -B / (2. * A);
                }

                float an = 2.0 *${Math.PI} * (fbin + 0.5) / ${td}. - ${Math.PI};
                setOutput(an);
            }
            `};ox[e]=t}return ox[e]}const fte={kernelName:"ComputeExtremaAngles",backendName:"webgl",kernelFunc:n=>{const{histograms:e}=n.inputs,t=n.backend,r=pte(e);return t.runWebGLProgram(r,[e],e.dtype)}},zR=7,lx={};function mte(n,e){const t=`${n}|${e.shape[0]}`;if(!lx.hasOwnProperty(t)){const r=[];for(let l=1;l<n;l++)r.push("image"+l);let s="float getPixel(int octave, int y, int x) {";for(let l=1;l<n;l++)s+=`
  if (octave == ${l}) {
	return getImage${l}(y, x);
  }
`;s+="}";const i={variableNames:[...r,"extrema","angles","freakPoints"],outputShape:[e.shape[0],wo.length],userCode:`
  ${s}
  void main() {
	ivec2 coords = getOutputCoords();
	int featureIndex = coords[0];
	int freakIndex = coords[1];

	float freakSigma = getFreakPoints(freakIndex, 0);
	float freakX = getFreakPoints(freakIndex, 1);
	float freakY = getFreakPoints(freakIndex, 2);

	int octave = int(getExtrema(featureIndex, 1));
	float inputY = getExtrema(featureIndex, 2);
	float inputX = getExtrema(featureIndex, 3);
	float inputAngle = getAngles(featureIndex);
	float cos = ${zR}. * cos(inputAngle);
	float sin = ${zR}. * sin(inputAngle);

	float yp = inputY + freakX * sin + freakY * cos;
	float xp = inputX + freakX * cos + freakY * -sin;

	int x0 = int(floor(xp));
	int x1 = x0 + 1;
	int y0 = int(floor(yp));
	int y1 = y0 + 1;

	float f1 = getPixel(octave, y0, x0);
	float f2 = getPixel(octave, y0, x1);
	float f3 = getPixel(octave, y1, x0);
	float f4 = getPixel(octave, y1, x1);

	float x1f = float(x1);
	float y1f = float(y1);
	float x0f = float(x0);
	float y0f = float(y0);

	// ratio for interpolation between four neighbouring points
	float value = (x1f - xp) * (y1f - yp) * f1
		+ (xp - x0f) * (y1f - yp) * f2
		+ (x1f - xp) * (yp - y0f) * f3
		+ (xp - x0f) * (yp - y0f) * f4;

	setOutput(value);
  }
`};lx[t]=i}return lx[t]}const gte={kernelName:"ComputeExtremaFreak",backendName:"webgl",kernelFunc:n=>{const{gaussianImagesT:e,prunedExtremas:t,prunedExtremasAngles:r,freakPointsT:s,pyramidImagesLength:i}=n.inputs,l=n.backend,u=mte(i,t);return l.runWebGLProgram(u,[...e,t,r,s],"float32")}},WR=(wo.length-1)*wo.length/2,bte=Math.ceil(WR/8),ux={};function yte(n){const e=`${n.shape[0]}`;if(!ux.hasOwnProperty(e)){const t={variableNames:["freak","p"],outputShape:[n.shape[0],bte],userCode:`
  void main() {
    ivec2 coords = getOutputCoords();
    int featureIndex = coords[0];
    int descIndex = coords[1] * 8;

    int sum = 0;
    for (int i = 0; i < 8; i++) {
      if (descIndex + i >= ${WR}) {
        continue;
      }

      int p1 = int(getP(descIndex + i, 0));
      int p2 = int(getP(descIndex + i, 1));

      float v1 = getFreak(featureIndex, p1);
      float v2 = getFreak(featureIndex, p2);

      if (v1 < v2 + 0.01) {
        sum += int(pow(2.0, float(7 - i)));
      }
    }
    setOutput(float(sum));
  }
`};ux[e]=t}return ux[e]}const xte={kernelName:"ComputeFreakDescriptors",backendName:"webgl",kernelFunc:n=>{const{extremaFreaks:e,positionT:t}=n.inputs,{backend:r}=n,s=yte(e);return r.runWebGLProgram(s,[e,t],"int32")}},cx={};function vte(n,e){const t=`${n}|${e}`;if(!cx.hasOwnProperty(t)){const r=[];let s="float getPixel(int octave, int y, int x) {";for(let i=1;i<n;i++)r.push("image"+i),s+=`
				if (octave == ${i}) {
					return getImage${i}(y, x);
				}
			`;s+="}",cx[t]={variableNames:[...r,"extrema"],outputShape:[e,3,3],userCode:`
			${s}
		
			void main() {
				ivec3 coords = getOutputCoords();
				int featureIndex = coords[0];
				float score = getExtrema(featureIndex, 0);
				if (score == 0.0) {
					return;
				}
		
				int dy = coords[1]-1;
				int dx = coords[2]-1;
				int octave = int(getExtrema(featureIndex, 1));
				int y = int(getExtrema(featureIndex, 2));
				int x = int(getExtrema(featureIndex, 3));
				setOutput(getPixel(octave, y+dy, x+dx));
			}
			`}}return cx[t]}const wte={kernelName:"ComputeLocalization",backendName:"webgl",kernelFunc:n=>{const{prunedExtremasList:e,dogPyramidImagesT:t}=n.inputs,r=n.backend,s=vte(t.length,e.length),i=Tr(e,[e.length,e[0].length],"int32");return r.runWebGLProgram(s,[...t.slice(1),i],t[0].dtype)}},kte=.159154943091895,Tl=36,dx={};function Ite(n,e,t){const r=`${t}|${n.shape[0]}|${e.shape[0]}`;if(!dx.hasOwnProperty(r)){const s=[];for(let c=1;c<t;c++)s.push("image"+c);let i="float getPixel(int octave, int y, int x) {";for(let c=1;c<t;c++)i+=`
            if (octave == ${c}) {
                return getImage${c}(y, x);
            }
            `;i+="}";const l={variableNames:[...s,"extrema","radial"],outputShape:[n.shape[0],e.shape[0],2],userCode:`
                ${i}

                void main() {
                    ivec3 coords = getOutputCoords();
                    int featureIndex = coords[0];
                    int radialIndex = coords[1];
                    int propertyIndex = coords[2];

                    int radialY = int(getRadial(radialIndex, 0));
                    int radialX = int(getRadial(radialIndex, 1));
                    float radialW = getRadial(radialIndex, 2);

                    int octave = int(getExtrema(featureIndex, 1));
                    int y = int(getExtrema(featureIndex, 2));
                    int x = int(getExtrema(featureIndex, 3));

                    int xp = x + radialX;
                    int yp = y + radialY;

                    float dy = getPixel(octave, yp+1, xp) - getPixel(octave, yp-1, xp);
                    float dx = getPixel(octave, yp, xp+1) - getPixel(octave, yp, xp-1);

                    if (propertyIndex == 0) {
                    // be careful that atan(0, 0) gives 1.57 instead of 0 (different from js), but doesn't matter here, coz magnitude is 0
                    
                    float angle = atan(dy, dx) + ${Math.PI};
                    float fbin = angle * ${Tl}. * ${kte};
                    setOutput(fbin);
                    return;
                    }

                    if (propertyIndex == 1) {
                        float mag = sqrt(dx * dx + dy * dy);
                        float magnitude = radialW * mag;
                        setOutput(magnitude);
                        return;
                    }
                }

                `},u={variableNames:["fbinMag"],outputShape:[n.shape[0],Tl],userCode:`
            void main() {
                ivec2 coords = getOutputCoords();
                int featureIndex = coords[0];
                int binIndex = coords[1];

                float sum = 0.;
                for (int i = 0; i < ${e.shape[0]}; i++) {
                    float fbin = getFbinMag(featureIndex, i, 0);
                    int bin = int(floor(fbin - 0.5));
                    int b1 = imod(bin + ${Tl}, ${Tl});
                    int b2 = imod(bin + 1 + ${Tl}, ${Tl});

                    if (b1 == binIndex || b2 == binIndex) {
                        float magnitude = getFbinMag(featureIndex, i, 1);
                        float w2 = fbin - float(bin) - 0.5;
                        float w1 = w2 * -1. + 1.;

                        if (b1 == binIndex) {
                            sum += w1 * magnitude;
                        }
                        if (b2 == binIndex) {
                            sum += w2 * magnitude;
                        }
                    }
                }
                setOutput(sum);
            }
            `};dx[r]=[l,u]}return dx[r]}const Ste={kernelName:"ComputeOrientationHistograms",backendName:"webgl",kernelFunc:n=>{const{gaussianImagesT:e,prunedExtremasT:t,radialPropertiesT:r,pyramidImagesLength:s}=n.inputs,i=n.backend,[l,u]=Ite(t,r,s),c=i.runWebGLProgram(l,[...e,t,r],r.dtype),h=i.runWebGLProgram(u,[c],r.dtype);return i.disposeIntermediateTensorInfo(c),h}},hx={};function Cte(n){const e=n.shape[1],t=n.shape[0],r="w"+e+"h"+t;if(!hx.hasOwnProperty(r)){const s={variableNames:["p"],outputShape:[Math.floor(t/2),Math.floor(e/2)],userCode:`
            void main() {
                ivec2 coords = getOutputCoords();
                int y = coords[0] * 2;
                int x = coords[1] * 2;
        
                float sum = getP(y, x) * 0.25;
                sum += getP(y+1,x) * 0.25; 
                sum += getP(y, x+1) * 0.25; 
                sum += getP(y+1,x+1) * 0.25;
                setOutput(sum);
            }
            `};hx[r]=s}return hx[r]}const Tte={kernelName:"DownsampleBilinear",backendName:"webgl",kernelFunc:n=>{const e=n.inputs.image,t=n.backend,r=Cte(e);return t.runWebGLProgram(r,[e],e.dtype)}},Nte={kernelName:"ExtremaReduction",backendName:"webgl",kernelFunc:n=>{const{extremasResultT:e}=n.inputs,t=n.backend,r=e.shape[0],s=e.shape[1],i={variableNames:["extrema"],outputShape:[Math.floor(r/2),Math.floor(s/2)],userCode:`
		  void main() {
			ivec2 coords = getOutputCoords();
			int y = coords[0] * 2;
			int x = coords[1] * 2;
  
			float location = 0.0;
			float values = getExtrema(y, x);
  
			if (getExtrema(y+1, x) != 0.0) {
			  location = 1.0;
		  values = getExtrema(y+1, x);
			}
			else if (getExtrema(y, x+1) != 0.0) {
			  location = 2.0;
		  values = getExtrema(y, x+1);
			}
			else if (getExtrema(y+1, x+1) != 0.0) {
			  location = 3.0;
		  values = getExtrema(y+1, x+1);
			}
  
			if (values < 0.0) {
			  setOutput(location * -1000.0 + values);
			} else {
			  setOutput(location * 1000.0 + values);
			}
		  }
		`};return t.runWebGLProgram(i,[e],e.dtype)}},Tf=36,Rte=5,px={};function Ete(n){const e=`h${n.shape[0]}`;if(!px.hasOwnProperty(e)){const t={variableNames:["histogram"],outputShape:[n.shape[0],Tf],userCode:`
            void main() {
                ivec2 coords = getOutputCoords();

                int featureIndex = coords[0];
                int binIndex = coords[1];

                int prevBin = imod(binIndex - 1 + ${Tf}, ${Tf});
                int nextBin = imod(binIndex + 1, ${Tf});
                float result = 0.274068619061197 * getHistogram(featureIndex, prevBin) + 0.451862761877606 * getHistogram(featureIndex, binIndex) + 0.274068619061197 * getHistogram(featureIndex, nextBin);

                setOutput(result);
            }
            `};px[e]=t}return px[e]}const Lte={kernelName:"SmoothHistograms",backendName:"webgl",kernelFunc:n=>{let{histograms:e}=n.inputs;const t=n.backend,r=Ete(e);for(let s=0;s<Rte;s++){const i=e;e=t.runWebGLProgram(r,[e],e.dtype),s>0&&t.disposeIntermediateTensorInfo(i)}return e}},fx={};function Gte(n,e){const t=e.shape[1],r=e.shape[0],s="w"+t+"h"+r;if(!fx.hasOwnProperty(s)){const i={variableNames:["p"],outputShape:[r,t],userCode:`
              void main() {
                ivec2 coords = getOutputCoords();
                int j = coords[0];
                int i = coords[1];
        
                float sj = 0.5 * float(j) - 0.25; 
                float si = 0.5 * float(i) - 0.25;
        
                float sj0 = floor(sj);
                float sj1 = ceil(sj);
                float si0 = floor(si);
                float si1 = ceil(si);
        
                int sj0I = int(sj0);
                int sj1I = int(sj1);
                int si0I = int(si0);
                int si1I = int(si1);
        
                float sum = 0.0;
                sum += getP(sj0I, si0I) * (si1 - si) * (sj1 - sj);
                sum += getP(sj1I, si0I) * (si1 - si) * (sj - sj0);
                sum += getP(sj0I, si1I) * (si - si0) * (sj1 - sj);
                sum += getP(sj1I, si1I) * (si - si0) * (sj - sj0);
                setOutput(sum);
              }
            `};fx[s]=i}return fx[s]}const zte={kernelName:"UpsampleBilinear",backendName:"webgl",kernelFunc:n=>{const{image:e,targetImage:t}=n.inputs,r=n.backend,s=Gte(e,t);return r.runWebGLProgram(s,[e],e.dtype)}};Cr(lte),Cr(hte),Cr(fte),Cr(gte),Cr(xte),Cr(wte),Cr(Ste),Cr(Tte),Cr(Nte),Cr(Lte),Cr(zte);const MR=8,Wte=5,nd=10,Mte=5,mx=3,$te=1.5;(wo.length-1)*wo.length/2;class $R{constructor(e,t,r=!1){this.debugMode=r,this.width=e,this.height=t;let s=0;for(;e>=MR&&t>=MR&&(e/=2,t/=2,s++,s!==Wte););this.numOctaves=s,this.tensorCaches={},this.kernelCaches={}}detectImageData(e){const t=new Uint8ClampedArray(4*e.length);for(let s=0;s<e.length;s++)t[4*s]=e[s],t[4*s+1]=e[s],t[4*s+2]=e[s],t[4*s+3]=255;const r=new ImageData(t,this.width,this.height);return this.detect(r)}detect(e){let t=null;const r=[];for(let I=0;I<this.numOctaves;I++){let C,R;I===0?C=this._applyFilter(e):C=this._downsampleBilinear(r[I-1][r[I-1].length-1]),R=this._applyFilter(C),r.push([C,R])}const s=[];for(let I=0;I<this.numOctaves;I++){let C=this._differenceImageBinomial(r[I][0],r[I][1]);s.push(C)}const i=[];for(let I=1;I<this.numOctaves-1;I++){const C=this._buildExtremas(s[I-1],s[I],s[I+1]);i.push(C)}const l=this._applyPrune(i),u=this._computeLocalization(l,s),c=this._computeOrientationHistograms(u,r),h=this._smoothHistograms(c),p=this._computeExtremaAngles(h),m=this._computeExtremaFreak(r,u,p),g=this._computeFreakDescriptors(m),y=u.arraySync(),v=p.arraySync(),w=g.arraySync();this.debugMode&&(t={pyramidImages:r.map(I=>I.map(C=>C.arraySync())),dogPyramidImages:s.map(I=>I?I.arraySync():null),extremasResults:i.map(I=>I.arraySync()),extremaAngles:p.arraySync(),prunedExtremas:l,localizedExtremas:u.arraySync()}),r.forEach(I=>I.forEach(C=>C.dispose())),s.forEach(I=>I&&I.dispose()),i.forEach(I=>I.dispose()),u.dispose(),c.dispose(),h.dispose(),p.dispose(),m.dispose(),g.dispose();const S=[];for(let I=0;I<y.length;I++){if(y[I][0]==0)continue;const C=[];for(let V=0;V<w[I].length;V+=4){const D=w[I][V],Z=w[I][V+1],ne=w[I][V+2],re=w[I][V+3];let se=D*16777216+Z*65536+ne*256+re;C.push(se)}const R=y[I][1],L=y[I][2],G=y[I][3]*Math.pow(2,R)+Math.pow(2,R-1)-.5,$=L*Math.pow(2,R)+Math.pow(2,R-1)-.5,F=Math.pow(2,R);S.push({maxima:y[I][0]>0,x:G,y:$,scale:F,angle:v[I],descriptors:C})}return{featurePoints:S,debugExtra:t}}_computeFreakDescriptors(e){if(!this.tensorCaches.computeFreakDescriptors){const r=[],s=[];for(let u=0;u<e.shape[1];u++)for(let c=u+1;c<e.shape[1];c++)r.push(u),s.push(c);const i=Tr(r,[r.length]).cast("int32"),l=Tr(s,[s.length]).cast("int32");this.tensorCaches.computeFreakDescriptors={positionT:Nr(Ds([i,l],1))}}const{positionT:t}=this.tensorCaches.computeFreakDescriptors;return ee(()=>vt().runKernel("ComputeFreakDescriptors",{extremaFreaks:e,positionT:t}))}_computeExtremaFreak(e,t,r){this.tensorCaches._computeExtremaFreak||ee(()=>{const l=Tr(wo);this.tensorCaches._computeExtremaFreak={freakPointsT:Nr(l)}});const{freakPointsT:s}=this.tensorCaches._computeExtremaFreak,i=[];for(let l=1;l<e.length;l++)i.push(e[l][1]);return ee(()=>vt().runKernel("ComputeExtremaFreak",{gaussianImagesT:i,prunedExtremas:t,prunedExtremasAngles:r,freakPointsT:s,pyramidImagesLength:e.length}))}_computeExtremaAngles(e){return ee(()=>vt().runKernel("ComputeExtremaAngles",{histograms:e}))}_computeOrientationHistograms(e,t){const r=[];for(let i=1;i<t.length;i++)r.push(t[i][1]);this.tensorCaches.orientationHistograms||ee(()=>{const i=-1/(2*mx*mx),l=mx*$te,u=Math.ceil(l),c=[];for(let h=-u;h<=u;h++)for(let p=-u;p<=u;p++){const m=p*p+h*h;if(m<=l*l){const g=m*i;let y=(720+g*(720+g*(360+g*(120+g*(30+g*(6+g))))))*.0013888888;c.push([h,p,y])}}this.tensorCaches.orientationHistograms={radialPropertiesT:Nr(Tr(c,[c.length,3]))}});const{radialPropertiesT:s}=this.tensorCaches.orientationHistograms;return ee(()=>vt().runKernel("ComputeOrientationHistograms",{gaussianImagesT:r,prunedExtremasT:e,radialPropertiesT:s,pyramidImagesLength:t.length}))}_smoothHistograms(e){return ee(()=>vt().runKernel("SmoothHistograms",{histograms:e}))}_computeLocalization(e,t){return ee(()=>{const r=vt().runKernel("ComputeLocalization",{prunedExtremasList:e,dogPyramidImagesT:t}).arraySync(),s=[];for(let l=0;l<r.length;l++){s.push([]);for(let u=0;u<r[l].length;u++)s[l].push([])}const i=[];for(let l=0;l<e.length;l++)i[l]=[e[l][0],e[l][1],e[l][2],e[l][3]];for(let l=0;l<i.length;l++){if(i[l][0]===0)continue;const u=r[l],c=.5*(u[1][2]-u[1][0]),h=.5*(u[2][1]-u[0][1]),p=u[1][2]+u[1][0]-2*u[1][1],m=u[2][1]+u[0][1]-2*u[1][1],g=.25*(u[0][0]+u[2][2]-u[0][2]-u[2][0]),y=p*m-g*g,v=(m*-c+-g*-h)/y,w=(-g*-c+p*-h)/y,S=i[l][2]+w,I=i[l][3]+v;Math.abs(y)<1e-4||(i[l][2]=S,i[l][3]=I)}return Tr(i,[i.length,i[0].length],"float32")})}_applyPrune(e){const t=nd*nd,r=Mte,s=[],i=[];for(let u=0;u<t;u++){i.push([]),s.push([]);for(let c=0;c<r;c++)i[u].push([0,0,0,0]),s[u].push(0)}ee(()=>{for(let u=0;u<e.length;u++){const c=vt().runKernel("ExtremaReduction",{extremasResultT:e[u]}),h=u+1,p=c.arraySync(),m=c.shape[0],g=c.shape[1],y=g*2/nd,v=m*2/nd;for(let w=0;w<m;w++)for(let S=0;S<g;S++){const I=p[w][S];if(I==0)continue;const C=I%1e3,R=Math.floor(Math.abs(I)/1e3),L=S*2+(R===2||R===3?1:0),G=w*2+(R===1||R===3?1:0),$=Math.floor(L/y),F=Math.floor(G/v)*nd+$,V=Math.abs(C);let D=r;for(;D>=1&&V>s[F][D-1];)D-=1;if(D<r){for(let Z=r-1;Z>=D+1;Z--)s[F][Z]=s[F][Z-1],i[F][Z][0]=i[F][Z-1][0],i[F][Z][1]=i[F][Z-1][1],i[F][Z][2]=i[F][Z-1][2],i[F][Z][3]=i[F][Z-1][3];s[F][D]=V,i[F][D][0]=C,i[F][D][1]=h,i[F][D][2]=G,i[F][D][3]=L}}}});const l=[];for(let u=0;u<t;u++)for(let c=0;c<r;c++)l.push(i[u][c]);return l}_buildExtremas(e,t,r){return ee(()=>vt().runKernel("BuildExtremas",{image0:e,image1:t,image2:r}))}_differenceImageBinomial(e,t){return ee(()=>e.sub(t))}_applyFilter(e){return ee(()=>vt().runKernel("BinomialFilter",{image:e}))}_downsampleBilinear(e){return ee(()=>vt().runKernel("DownsampleBilinear",{image:e}))}_compileAndRun(e,t){const r=Ka().compileAndRun(e,t);return vt().makeTensorFromDataId(r.dataId,r.shape,r.dtype)}_runWebGLProgram(e,t,r){const s=Ka().runWebGLProgram(e,t,r);return vt().makeTensorFromDataId(s.dataId,s.shape,s.dtype)}}class Fte{constructor(e,t,r=!1){this.debugMode=r,this.width=e,this.height=t;let s=Math.min(e,t)/2,i=Math.pow(2,Math.round(Math.log(s)/Math.log(2)));this.cropSize=i,this.detector=new $R(i,i,r),this.kernelCaches={},this.lastRandomIndex=4}detect(e){const t=Math.floor(this.height/2-this.cropSize/2),r=Math.floor(this.width/2-this.cropSize/2),s=this._detect(e,r,t);return this.debugMode&&(s.debugExtra.crop={startX:r,startY:t,cropSize:this.cropSize}),s}detectMoving(e){const t=this.lastRandomIndex%3,r=Math.floor(this.lastRandomIndex/3);let s=Math.floor(this.height/2-this.cropSize+r*this.cropSize/2),i=Math.floor(this.width/2-this.cropSize+t*this.cropSize/2);return i<0&&(i=0),s<0&&(s=0),i>=this.width-this.cropSize&&(i=this.width-this.cropSize-1),s>=this.height-this.cropSize&&(s=this.height-this.cropSize-1),this.lastRandomIndex=(this.lastRandomIndex+1)%9,this._detect(e,i,s)}_detect(e,t,r){const s=e.slice([r,t],[this.cropSize,this.cropSize]),{featurePoints:i,debugExtra:l}=this.detector.detect(s);return i.forEach(u=>{u.x+=t,u.y+=r}),this.debugMode&&(l.projectedImage=s.arraySync()),s.dispose(),{featurePoints:i,debugExtra:l}}}const FR=({image:n,ratio:e})=>{const t=Math.round(n.width*e),r=Math.round(n.height*e),s=new Uint8Array(t*r);for(let i=0;i<t;i++){let l=Math.round(1*i/e),u=Math.round(1*(i+1)/e)-1;u>=n.width&&(u=n.width-1);for(let c=0;c<r;c++){let h=Math.round(1*c/e),p=Math.round(1*(c+1)/e)-1;p>=n.height&&(p=n.height-1);let m=0,g=0;for(let y=l;y<=u;y++)for(let v=h;v<=p;v++)m+=1*n.data[v*n.width+y],g+=1;s[c*t+i]=Math.floor(m/g)}}return{data:s,width:t,height:r}},Vte=100,Pte=n=>{const e=Vte/Math.min(n.width,n.height),t=[];let r=e;for(;;)if(t.push(r),r*=Math.pow(2,1/3),r>=.95){r=1;break}t.push(r),t.reverse();const s=[];for(let i=0;i<t.length;i++)n.width*t[i],n.height*t[i],s.push(Object.assign(FR({image:n,ratio:t[i]}),{scale:t[i]}));return s},Xte=n=>{const e=Math.min(n.width,n.height),t=[],r=[];t.push(256/e),t.push(128/e);for(let s=0;s<t.length;s++)r.push(Object.assign(FR({image:n,ratio:t[s]}),{scale:t[s]}));return r},Ote=n=>{const{v1:e,v2:t}=n;let r=0;for(let s=0;s<e.length;s++){let i=(e[s]^t[s])>>>0;r+=Dte(i)}return r},Dte=n=>{var e=n-(n>>1&1431655765);return e=(e>>2&858993459)+(e&858993459),e=(e>>4)+e&252645135,e=(e>>8)+e&16711935,e=(e>>16)+e&65535,e},Ate=1234,Kte=()=>({seed:Ate,arrayShuffle(n){const{arr:e,sampleSize:t}=n;for(let r=0;r<t;r++){this.seed=(214013*this.seed+2531011)%-2147483648;let s=this.seed>>16&32767;s=s%e.length;let i=e[r];e[r]=e[s],e[s]=i}},nextInt(n){this.seed=(214013*this.seed+2531011)%-2147483648;let e=this.seed>>16&32767;return e=e%n,e}}),Zte=16,Bte=128,gx=8,_te=n=>{const{points:e,pointIndexes:t,randomizer:r}=n,s=[];for(let c=0;c<t.length;c++)s.push(c);let i=Number.MAX_SAFE_INTEGER,l=-1;const u=[];for(let c=0;c<Bte;c++){r.arrayShuffle({arr:s,sampleSize:gx});let h=0;const p=[];for(let m=0;m<t.length;m++){let g=Number.MAX_SAFE_INTEGER;for(let y=0;y<gx;y++){const v=t[s[y]],w=Ote({v1:e[t[m]].descriptors,v2:e[v].descriptors});w<g&&(p[m]=s[y],g=w)}h+=g}u.push(p),h<i&&(i=h,l=c)}return u[l]},VR=({points:n})=>{const e=[];for(let r=0;r<n.length;r++)e.push(r);const t=Kte();return{rootNode:PR({points:n,pointIndexes:e,centerPointIndex:null,randomizer:t})}},PR=n=>{const{points:e,pointIndexes:t,centerPointIndex:r,randomizer:s}=n;let i=!1;(t.length<=gx||t.length<=Zte)&&(i=!0);const l={};if(!i){const c=_te({points:e,pointIndexes:t,randomizer:s});for(let h=0;h<c.length;h++)l[t[c[h]]]===void 0&&(l[t[c[h]]]=[]),l[t[c[h]]].push(t[h])}Object.keys(l).length===1&&(i=!0);const u={centerPointIndex:r};if(i){u.leaf=!0,u.pointIndexes=[];for(let c=0;c<t.length;c++)u.pointIndexes.push(t[c]);return u}return u.leaf=!1,u.children=[],Object.keys(l).forEach(c=>{u.children.push(PR({points:e,pointIndexes:l[c],centerPointIndex:c,randomizer:s}))}),u};var ko=4294967295;function Hte(n,e,t){var r=t/4294967296,s=t;n.setUint32(e,r),n.setUint32(e+4,s)}function XR(n,e,t){var r=Math.floor(t/4294967296),s=t;n.setUint32(e,r),n.setUint32(e+4,s)}function OR(n,e){var t=n.getInt32(e),r=n.getUint32(e+4);return t*4294967296+r}function Ute(n,e){var t=n.getUint32(e),r=n.getUint32(e+4);return t*4294967296+r}var bx,yx,xx,Nf=(typeof process>"u"||((bx=process==null?void 0:r1)===null||bx===void 0?void 0:bx.TEXT_ENCODING)!=="never")&&typeof TextEncoder<"u"&&typeof TextDecoder<"u";function DR(n){for(var e=n.length,t=0,r=0;r<e;){var s=n.charCodeAt(r++);if(s&4294967168)if(!(s&4294965248))t+=2;else{if(s>=55296&&s<=56319&&r<e){var i=n.charCodeAt(r);(i&64512)===56320&&(++r,s=((s&1023)<<10)+(i&1023)+65536)}s&4294901760?t+=4:t+=3}else{t++;continue}}return t}function jte(n,e,t){for(var r=n.length,s=t,i=0;i<r;){var l=n.charCodeAt(i++);if(l&4294967168)if(!(l&4294965248))e[s++]=l>>6&31|192;else{if(l>=55296&&l<=56319&&i<r){var u=n.charCodeAt(i);(u&64512)===56320&&(++i,l=((l&1023)<<10)+(u&1023)+65536)}l&4294901760?(e[s++]=l>>18&7|240,e[s++]=l>>12&63|128,e[s++]=l>>6&63|128):(e[s++]=l>>12&15|224,e[s++]=l>>6&63|128)}else{e[s++]=l;continue}e[s++]=l&63|128}}var Rf=Nf?new TextEncoder:void 0,Yte=Nf?typeof process<"u"&&((yx=process==null?void 0:r1)===null||yx===void 0?void 0:yx.TEXT_ENCODING)!=="force"?200:0:ko;function Qte(n,e,t){e.set(Rf.encode(n),t)}function Jte(n,e,t){Rf.encodeInto(n,e.subarray(t))}var qte=Rf!=null&&Rf.encodeInto?Jte:Qte,ene=4096;function AR(n,e,t){for(var r=e,s=r+t,i=[],l="";r<s;){var u=n[r++];if(!(u&128))i.push(u);else if((u&224)===192){var c=n[r++]&63;i.push((u&31)<<6|c)}else if((u&240)===224){var c=n[r++]&63,h=n[r++]&63;i.push((u&31)<<12|c<<6|h)}else if((u&248)===240){var c=n[r++]&63,h=n[r++]&63,p=n[r++]&63,m=(u&7)<<18|c<<12|h<<6|p;m>65535&&(m-=65536,i.push(m>>>10&1023|55296),m=56320|m&1023),i.push(m)}else i.push(u);i.length>=ene&&(l+=String.fromCharCode.apply(String,i),i.length=0)}return i.length>0&&(l+=String.fromCharCode.apply(String,i)),l}var tne=Nf?new TextDecoder:null,nne=Nf?typeof process<"u"&&((xx=process==null?void 0:r1)===null||xx===void 0?void 0:xx.TEXT_DECODER)!=="force"?200:0:ko;function rne(n,e,t){var r=n.subarray(e,e+t);return tne.decode(r)}var Ef=function(){function n(e,t){this.type=e,this.data=t}return n}(),sne=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(r[i]=s[i])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Js=function(n){sne(e,n);function e(t){var r=n.call(this,t)||this,s=Object.create(e.prototype);return Object.setPrototypeOf(r,s),Object.defineProperty(r,"name",{configurable:!0,enumerable:!1,value:e.name}),r}return e}(Error),ane=-1,ine=4294967296-1,one=17179869184-1;function lne(n){var e=n.sec,t=n.nsec;if(e>=0&&t>=0&&e<=one)if(t===0&&e<=ine){var r=new Uint8Array(4),s=new DataView(r.buffer);return s.setUint32(0,e),r}else{var i=e/4294967296,l=e&4294967295,r=new Uint8Array(8),s=new DataView(r.buffer);return s.setUint32(0,t<<2|i&3),s.setUint32(4,l),r}else{var r=new Uint8Array(12),s=new DataView(r.buffer);return s.setUint32(0,t),XR(s,4,e),r}}function une(n){var e=n.getTime(),t=Math.floor(e/1e3),r=(e-t*1e3)*1e6,s=Math.floor(r/1e9);return{sec:t+s,nsec:r-s*1e9}}function cne(n){if(n instanceof Date){var e=une(n);return lne(e)}else return null}function dne(n){var e=new DataView(n.buffer,n.byteOffset,n.byteLength);switch(n.byteLength){case 4:{var t=e.getUint32(0),r=0;return{sec:t,nsec:r}}case 8:{var s=e.getUint32(0),i=e.getUint32(4),t=(s&3)*4294967296+i,r=s>>>2;return{sec:t,nsec:r}}case 12:{var t=OR(e,4),r=e.getUint32(0);return{sec:t,nsec:r}}default:throw new Js("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(n.length))}}function hne(n){var e=dne(n);return new Date(e.sec*1e3+e.nsec/1e6)}var pne={type:ane,encode:cne,decode:hne},KR=function(){function n(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(pne)}return n.prototype.register=function(e){var t=e.type,r=e.encode,s=e.decode;if(t>=0)this.encoders[t]=r,this.decoders[t]=s;else{var i=1+t;this.builtInEncoders[i]=r,this.builtInDecoders[i]=s}},n.prototype.tryToEncode=function(e,t){for(var r=0;r<this.builtInEncoders.length;r++){var s=this.builtInEncoders[r];if(s!=null){var i=s(e,t);if(i!=null){var l=-1-r;return new Ef(l,i)}}}for(var r=0;r<this.encoders.length;r++){var s=this.encoders[r];if(s!=null){var i=s(e,t);if(i!=null){var l=r;return new Ef(l,i)}}}return e instanceof Ef?e:null},n.prototype.decode=function(e,t,r){var s=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return s?s(e,t,r):new Ef(t,e)},n.defaultCodec=new n,n}();function Lf(n){return n instanceof Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n instanceof ArrayBuffer?new Uint8Array(n):Uint8Array.from(n)}function fne(n){if(n instanceof ArrayBuffer)return new DataView(n);var e=Lf(n);return new DataView(e.buffer,e.byteOffset,e.byteLength)}var mne=100,gne=2048,bne=function(){function n(e,t,r,s,i,l,u,c){e===void 0&&(e=KR.defaultCodec),t===void 0&&(t=void 0),r===void 0&&(r=mne),s===void 0&&(s=gne),i===void 0&&(i=!1),l===void 0&&(l=!1),u===void 0&&(u=!1),c===void 0&&(c=!1),this.extensionCodec=e,this.context=t,this.maxDepth=r,this.initialBufferSize=s,this.sortKeys=i,this.forceFloat32=l,this.ignoreUndefined=u,this.forceIntegerToFloat=c,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return n.prototype.reinitializeState=function(){this.pos=0},n.prototype.encodeSharedRef=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)},n.prototype.encode=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)},n.prototype.doEncode=function(e,t){if(t>this.maxDepth)throw new Error("Too deep objects in depth ".concat(t));e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.encodeObject(e,t)},n.prototype.ensureBufferSizeToWrite=function(e){var t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(t*2)},n.prototype.resizeBuffer=function(e){var t=new ArrayBuffer(e),r=new Uint8Array(t),s=new DataView(t);r.set(this.bytes),this.view=s,this.bytes=r},n.prototype.encodeNil=function(){this.writeU8(192)},n.prototype.encodeBoolean=function(e){e===!1?this.writeU8(194):this.writeU8(195)},n.prototype.encodeNumber=function(e){Number.isSafeInteger(e)&&!this.forceIntegerToFloat?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):(this.writeU8(211),this.writeI64(e)):this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))},n.prototype.writeStringHeader=function(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error("Too long string: ".concat(e," bytes in UTF-8"))},n.prototype.encodeString=function(e){var t=5,r=e.length;if(r>Yte){var s=DR(e);this.ensureBufferSizeToWrite(t+s),this.writeStringHeader(s),qte(e,this.bytes,this.pos),this.pos+=s}else{var s=DR(e);this.ensureBufferSizeToWrite(t+s),this.writeStringHeader(s),jte(e,this.bytes,this.pos),this.pos+=s}},n.prototype.encodeObject=function(e,t){var r=this.extensionCodec.tryToEncode(e,this.context);if(r!=null)this.encodeExtension(r);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,t);else throw new Error("Unrecognized object: ".concat(Object.prototype.toString.apply(e)))},n.prototype.encodeBinary=function(e){var t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else if(t<4294967296)this.writeU8(198),this.writeU32(t);else throw new Error("Too large binary: ".concat(t));var r=Lf(e);this.writeU8a(r)},n.prototype.encodeArray=function(e,t){var r=e.length;if(r<16)this.writeU8(144+r);else if(r<65536)this.writeU8(220),this.writeU16(r);else if(r<4294967296)this.writeU8(221),this.writeU32(r);else throw new Error("Too large array: ".concat(r));for(var s=0,i=e;s<i.length;s++){var l=i[s];this.doEncode(l,t+1)}},n.prototype.countWithoutUndefined=function(e,t){for(var r=0,s=0,i=t;s<i.length;s++){var l=i[s];e[l]!==void 0&&r++}return r},n.prototype.encodeMap=function(e,t){var r=Object.keys(e);this.sortKeys&&r.sort();var s=this.ignoreUndefined?this.countWithoutUndefined(e,r):r.length;if(s<16)this.writeU8(128+s);else if(s<65536)this.writeU8(222),this.writeU16(s);else if(s<4294967296)this.writeU8(223),this.writeU32(s);else throw new Error("Too large map object: ".concat(s));for(var i=0,l=r;i<l.length;i++){var u=l[i],c=e[u];this.ignoreUndefined&&c===void 0||(this.encodeString(u),this.doEncode(c,t+1))}},n.prototype.encodeExtension=function(e){var t=e.data.length;if(t===1)this.writeU8(212);else if(t===2)this.writeU8(213);else if(t===4)this.writeU8(214);else if(t===8)this.writeU8(215);else if(t===16)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else if(t<4294967296)this.writeU8(201),this.writeU32(t);else throw new Error("Too large extension object: ".concat(t));this.writeI8(e.type),this.writeU8a(e.data)},n.prototype.writeU8=function(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++},n.prototype.writeU8a=function(e){var t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t},n.prototype.writeI8=function(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++},n.prototype.writeU16=function(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2},n.prototype.writeI16=function(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2},n.prototype.writeU32=function(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4},n.prototype.writeI32=function(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4},n.prototype.writeF32=function(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4},n.prototype.writeF64=function(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8},n.prototype.writeU64=function(e){this.ensureBufferSizeToWrite(8),Hte(this.view,this.pos,e),this.pos+=8},n.prototype.writeI64=function(e){this.ensureBufferSizeToWrite(8),XR(this.view,this.pos,e),this.pos+=8},n}(),yne={};function xne(n,e){e===void 0&&(e=yne);var t=new bne(e.extensionCodec,e.context,e.maxDepth,e.initialBufferSize,e.sortKeys,e.forceFloat32,e.ignoreUndefined,e.forceIntegerToFloat);return t.encodeSharedRef(n)}function vx(n){return"".concat(n<0?"-":"","0x").concat(Math.abs(n).toString(16).padStart(2,"0"))}var vne=16,wne=16,kne=function(){function n(e,t){e===void 0&&(e=vne),t===void 0&&(t=wne),this.maxKeyLength=e,this.maxLengthPerKey=t,this.hit=0,this.miss=0,this.caches=[];for(var r=0;r<this.maxKeyLength;r++)this.caches.push([])}return n.prototype.canBeCached=function(e){return e>0&&e<=this.maxKeyLength},n.prototype.find=function(e,t,r){var s=this.caches[r-1];e:for(var i=0,l=s;i<l.length;i++){for(var u=l[i],c=u.bytes,h=0;h<r;h++)if(c[h]!==e[t+h])continue e;return u.str}return null},n.prototype.store=function(e,t){var r=this.caches[e.length-1],s={bytes:e,str:t};r.length>=this.maxLengthPerKey?r[Math.random()*r.length|0]=s:r.push(s)},n.prototype.decode=function(e,t,r){var s=this.find(e,t,r);if(s!=null)return this.hit++,s;this.miss++;var i=AR(e,t,r),l=Uint8Array.prototype.slice.call(e,t,t+r);return this.store(l,i),i},n}(),Ine=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(l){l(i)})}return new(t||(t=Promise))(function(i,l){function u(p){try{h(r.next(p))}catch(m){l(m)}}function c(p){try{h(r.throw(p))}catch(m){l(m)}}function h(p){p.done?i(p.value):s(p.value).then(u,c)}h((r=r.apply(n,[])).next())})},wx=function(n,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,l;return l={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function u(h){return function(p){return c([h,p])}}function c(h){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,s&&(i=h[0]&2?s.return:h[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,h[1])).done)return i;switch(s=0,i&&(h=[h[0]&2,i.value]),h[0]){case 0:case 1:i=h;break;case 4:return t.label++,{value:h[1],done:!1};case 5:t.label++,s=h[1],h=[0];continue;case 7:h=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(h[0]===6||h[0]===2)){t=0;continue}if(h[0]===3&&(!i||h[1]>i[0]&&h[1]<i[3])){t.label=h[1];break}if(h[0]===6&&t.label<i[1]){t.label=i[1],i=h;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(h);break}i[2]&&t.ops.pop(),t.trys.pop();continue}h=e.call(n,t)}catch(p){h=[6,p],s=0}finally{r=i=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}},ZR=function(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof __values=="function"?__values(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(i){t[i]=n[i]&&function(l){return new Promise(function(u,c){l=n[i](l),s(u,c,l.done,l.value)})}}function s(i,l,u,c){Promise.resolve(c).then(function(h){i({value:h,done:u})},l)}},Nl=function(n){return this instanceof Nl?(this.v=n,this):new Nl(n)},Sne=function(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,i=[];return s={},l("next"),l("throw"),l("return"),s[Symbol.asyncIterator]=function(){return this},s;function l(g){r[g]&&(s[g]=function(y){return new Promise(function(v,w){i.push([g,y,v,w])>1||u(g,y)})})}function u(g,y){try{c(r[g](y))}catch(v){m(i[0][3],v)}}function c(g){g.value instanceof Nl?Promise.resolve(g.value.v).then(h,p):m(i[0][2],g)}function h(g){u("next",g)}function p(g){u("throw",g)}function m(g,y){g(y),i.shift(),i.length&&u(i[0][0],i[0][1])}},Cne=function(n){var e=typeof n;return e==="string"||e==="number"},rd=-1,kx=new DataView(new ArrayBuffer(0)),Tne=new Uint8Array(kx.buffer),Ix=function(){try{kx.getInt8(0)}catch(n){return n.constructor}throw new Error("never reached")}(),BR=new Ix("Insufficient data"),Nne=new kne,Rne=function(){function n(e,t,r,s,i,l,u,c){e===void 0&&(e=KR.defaultCodec),t===void 0&&(t=void 0),r===void 0&&(r=ko),s===void 0&&(s=ko),i===void 0&&(i=ko),l===void 0&&(l=ko),u===void 0&&(u=ko),c===void 0&&(c=Nne),this.extensionCodec=e,this.context=t,this.maxStrLength=r,this.maxBinLength=s,this.maxArrayLength=i,this.maxMapLength=l,this.maxExtLength=u,this.keyDecoder=c,this.totalPos=0,this.pos=0,this.view=kx,this.bytes=Tne,this.headByte=rd,this.stack=[]}return n.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=rd,this.stack.length=0},n.prototype.setBuffer=function(e){this.bytes=Lf(e),this.view=fne(this.bytes),this.pos=0},n.prototype.appendBuffer=function(e){if(this.headByte===rd&&!this.hasRemaining(1))this.setBuffer(e);else{var t=this.bytes.subarray(this.pos),r=Lf(e),s=new Uint8Array(t.length+r.length);s.set(t),s.set(r,t.length),this.setBuffer(s)}},n.prototype.hasRemaining=function(e){return this.view.byteLength-this.pos>=e},n.prototype.createExtraByteError=function(e){var t=this,r=t.view,s=t.pos;return new RangeError("Extra ".concat(r.byteLength-s," of ").concat(r.byteLength," byte(s) found at buffer[").concat(e,"]"))},n.prototype.decode=function(e){this.reinitializeState(),this.setBuffer(e);var t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t},n.prototype.decodeMulti=function(e){return wx(this,function(t){switch(t.label){case 0:this.reinitializeState(),this.setBuffer(e),t.label=1;case 1:return this.hasRemaining(1)?[4,this.doDecodeSync()]:[3,3];case 2:return t.sent(),[3,1];case 3:return[2]}})},n.prototype.decodeAsync=function(e){var t,r,s,i;return Ine(this,void 0,void 0,function(){var l,u,c,h,p,m,g,y;return wx(this,function(v){switch(v.label){case 0:l=!1,v.label=1;case 1:v.trys.push([1,6,7,12]),t=ZR(e),v.label=2;case 2:return[4,t.next()];case 3:if(r=v.sent(),!!r.done)return[3,5];if(c=r.value,l)throw this.createExtraByteError(this.totalPos);this.appendBuffer(c);try{u=this.doDecodeSync(),l=!0}catch(w){if(!(w instanceof Ix))throw w}this.totalPos+=this.pos,v.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return h=v.sent(),s={error:h},[3,12];case 7:return v.trys.push([7,,10,11]),r&&!r.done&&(i=t.return)?[4,i.call(t)]:[3,9];case 8:v.sent(),v.label=9;case 9:return[3,11];case 10:if(s)throw s.error;return[7];case 11:return[7];case 12:if(l){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,u]}throw p=this,m=p.headByte,g=p.pos,y=p.totalPos,new RangeError("Insufficient data in parsing ".concat(vx(m)," at ").concat(y," (").concat(g," in the current buffer)"))}})})},n.prototype.decodeArrayStream=function(e){return this.decodeMultiAsync(e,!0)},n.prototype.decodeStream=function(e){return this.decodeMultiAsync(e,!1)},n.prototype.decodeMultiAsync=function(e,t){return Sne(this,arguments,function(){var r,s,i,l,u,c,h,p,m;return wx(this,function(g){switch(g.label){case 0:r=t,s=-1,g.label=1;case 1:g.trys.push([1,13,14,19]),i=ZR(e),g.label=2;case 2:return[4,Nl(i.next())];case 3:if(l=g.sent(),!!l.done)return[3,12];if(u=l.value,t&&s===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(u),r&&(s=this.readArraySize(),r=!1,this.complete()),g.label=4;case 4:g.trys.push([4,9,,10]),g.label=5;case 5:return[4,Nl(this.doDecodeSync())];case 6:return[4,g.sent()];case 7:return g.sent(),--s===0?[3,8]:[3,5];case 8:return[3,10];case 9:if(c=g.sent(),!(c instanceof Ix))throw c;return[3,10];case 10:this.totalPos+=this.pos,g.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return h=g.sent(),p={error:h},[3,19];case 14:return g.trys.push([14,,17,18]),l&&!l.done&&(m=i.return)?[4,Nl(m.call(i))]:[3,16];case 15:g.sent(),g.label=16;case 16:return[3,18];case 17:if(p)throw p.error;return[7];case 18:return[7];case 19:return[2]}})})},n.prototype.doDecodeSync=function(){e:for(;;){var e=this.readHeadByte(),t=void 0;if(e>=224)t=e-256;else if(e<192)if(e<128)t=e;else if(e<144){var r=e-128;if(r!==0){this.pushMapState(r),this.complete();continue e}else t={}}else if(e<160){var r=e-144;if(r!==0){this.pushArrayState(r),this.complete();continue e}else t=[]}else{var s=e-160;t=this.decodeUtf8String(s,0)}else if(e===192)t=null;else if(e===194)t=!1;else if(e===195)t=!0;else if(e===202)t=this.readF32();else if(e===203)t=this.readF64();else if(e===204)t=this.readU8();else if(e===205)t=this.readU16();else if(e===206)t=this.readU32();else if(e===207)t=this.readU64();else if(e===208)t=this.readI8();else if(e===209)t=this.readI16();else if(e===210)t=this.readI32();else if(e===211)t=this.readI64();else if(e===217){var s=this.lookU8();t=this.decodeUtf8String(s,1)}else if(e===218){var s=this.lookU16();t=this.decodeUtf8String(s,2)}else if(e===219){var s=this.lookU32();t=this.decodeUtf8String(s,4)}else if(e===220){var r=this.readU16();if(r!==0){this.pushArrayState(r),this.complete();continue e}else t=[]}else if(e===221){var r=this.readU32();if(r!==0){this.pushArrayState(r),this.complete();continue e}else t=[]}else if(e===222){var r=this.readU16();if(r!==0){this.pushMapState(r),this.complete();continue e}else t={}}else if(e===223){var r=this.readU32();if(r!==0){this.pushMapState(r),this.complete();continue e}else t={}}else if(e===196){var r=this.lookU8();t=this.decodeBinary(r,1)}else if(e===197){var r=this.lookU16();t=this.decodeBinary(r,2)}else if(e===198){var r=this.lookU32();t=this.decodeBinary(r,4)}else if(e===212)t=this.decodeExtension(1,0);else if(e===213)t=this.decodeExtension(2,0);else if(e===214)t=this.decodeExtension(4,0);else if(e===215)t=this.decodeExtension(8,0);else if(e===216)t=this.decodeExtension(16,0);else if(e===199){var r=this.lookU8();t=this.decodeExtension(r,1)}else if(e===200){var r=this.lookU16();t=this.decodeExtension(r,2)}else if(e===201){var r=this.lookU32();t=this.decodeExtension(r,4)}else throw new Js("Unrecognized type byte: ".concat(vx(e)));this.complete();for(var i=this.stack;i.length>0;){var l=i[i.length-1];if(l.type===0)if(l.array[l.position]=t,l.position++,l.position===l.size)i.pop(),t=l.array;else continue e;else if(l.type===1){if(!Cne(t))throw new Js("The type of key must be string or number but "+typeof t);if(t==="__proto__")throw new Js("The key __proto__ is not allowed");l.key=t,l.type=2;continue e}else if(l.map[l.key]=t,l.readCount++,l.readCount===l.size)i.pop(),t=l.map;else{l.key=null,l.type=1;continue e}}return t}},n.prototype.readHeadByte=function(){return this.headByte===rd&&(this.headByte=this.readU8()),this.headByte},n.prototype.complete=function(){this.headByte=rd},n.prototype.readArraySize=function(){var e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new Js("Unrecognized array type byte: ".concat(vx(e)))}}},n.prototype.pushMapState=function(e){if(e>this.maxMapLength)throw new Js("Max length exceeded: map length (".concat(e,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:1,size:e,key:null,readCount:0,map:{}})},n.prototype.pushArrayState=function(e){if(e>this.maxArrayLength)throw new Js("Max length exceeded: array length (".concat(e,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:0,size:e,array:new Array(e),position:0})},n.prototype.decodeUtf8String=function(e,t){var r;if(e>this.maxStrLength)throw new Js("Max length exceeded: UTF-8 byte length (".concat(e,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+t+e)throw BR;var s=this.pos+t,i;return this.stateIsMapKey()&&!((r=this.keyDecoder)===null||r===void 0)&&r.canBeCached(e)?i=this.keyDecoder.decode(this.bytes,s,e):e>nne?i=rne(this.bytes,s,e):i=AR(this.bytes,s,e),this.pos+=t+e,i},n.prototype.stateIsMapKey=function(){if(this.stack.length>0){var e=this.stack[this.stack.length-1];return e.type===1}return!1},n.prototype.decodeBinary=function(e,t){if(e>this.maxBinLength)throw new Js("Max length exceeded: bin length (".concat(e,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining(e+t))throw BR;var r=this.pos+t,s=this.bytes.subarray(r,r+e);return this.pos+=t+e,s},n.prototype.decodeExtension=function(e,t){if(e>this.maxExtLength)throw new Js("Max length exceeded: ext length (".concat(e,") > maxExtLength (").concat(this.maxExtLength,")"));var r=this.view.getInt8(this.pos+t),s=this.decodeBinary(e,t+1);return this.extensionCodec.decode(s,r,this.context)},n.prototype.lookU8=function(){return this.view.getUint8(this.pos)},n.prototype.lookU16=function(){return this.view.getUint16(this.pos)},n.prototype.lookU32=function(){return this.view.getUint32(this.pos)},n.prototype.readU8=function(){var e=this.view.getUint8(this.pos);return this.pos++,e},n.prototype.readI8=function(){var e=this.view.getInt8(this.pos);return this.pos++,e},n.prototype.readU16=function(){var e=this.view.getUint16(this.pos);return this.pos+=2,e},n.prototype.readI16=function(){var e=this.view.getInt16(this.pos);return this.pos+=2,e},n.prototype.readU32=function(){var e=this.view.getUint32(this.pos);return this.pos+=4,e},n.prototype.readI32=function(){var e=this.view.getInt32(this.pos);return this.pos+=4,e},n.prototype.readU64=function(){var e=Ute(this.view,this.pos);return this.pos+=8,e},n.prototype.readI64=function(){var e=OR(this.view,this.pos);return this.pos+=8,e},n.prototype.readF32=function(){var e=this.view.getFloat32(this.pos);return this.pos+=4,e},n.prototype.readF64=function(){var e=this.view.getFloat64(this.pos);return this.pos+=8,e},n}(),Ene={};function Lne(n,e){e===void 0&&(e=Ene);var t=new Rne(e.extensionCodec,e.context,e.maxStrLength,e.maxBinLength,e.maxArrayLength,e.maxMapLength,e.maxExtLength);return t.decode(n)}const _R=2;class Gne{constructor(){this.data=null}compileImageTargets(e,t){return new Promise(async(r,s)=>{const i=[];for(let h=0;h<e.length;h++){const p=e[h],m=this.createProcessCanvas(p).getContext("2d");m.drawImage(p,0,0,p.width,p.height);const g=m.getImageData(0,0,p.width,p.height),y=new Uint8Array(p.width*p.height);for(let w=0;w<y.length;w++){const S=w*4;y[w]=Math.floor((g.data[S]+g.data[S+1]+g.data[S+2])/3)}const v={data:y,height:p.height,width:p.width};i.push(v)}const l=50/i.length;let u=0;this.data=[];for(let h=0;h<i.length;h++){const p=i[h],m=Pte(p),g=l/m.length,y=await zne(m,()=>{u+=g,t(u)});this.data.push({targetImage:p,imageList:m,matchingData:y})}for(let h=0;h<i.length;h++){const p=Xte(i[h]);this.data[h].trackingImageList=p}const c=await this.compileTrack({progressCallback:t,targetImages:i,basePercent:50});for(let h=0;h<i.length;h++)this.data[h].trackingData=c[h];r(this.data)})}exportData(){const e=[];for(let t=0;t<this.data.length;t++)e.push({targetImage:{width:this.data[t].targetImage.width,height:this.data[t].targetImage.height},trackingData:this.data[t].trackingData,matchingData:this.data[t].matchingData});return xne({v:_R,dataList:e})}importData(e){const t=Lne(new Uint8Array(e));if(!t.v||t.v!==_R)return console.error("Your compiled .mind might be outdated. Please recompile"),[];const{dataList:r}=t;this.data=[];for(let s=0;s<r.length;s++)this.data.push({targetImage:r[s].targetImage,trackingData:r[s].trackingData,matchingData:r[s].matchingData});return this.data}createProcessCanvas(e){console.warn("missing createProcessCanvas implementation")}compileTrack({progressCallback:e,targetImages:t,basePercent:r}){console.warn("missing compileTrack implementation")}}const zne=async(n,e)=>{const t=[];for(let r=0;r<n.length;r++){const s=n[r],i=new $R(s.width,s.height);await Tp(),ee(()=>{const l=Tr(s.data,[s.data.length],"float32").reshape([s.height,s.width]),{featurePoints:u}=i.detect(l),c=u.filter(g=>g.maxima),h=u.filter(g=>!g.maxima),p=VR({points:c}),m=VR({points:h});t.push({maximaPoints:c,minimaPoints:h,maximaPointsCluster:p,minimaPointsCluster:m,width:s.width,height:s.height,scale:s.scale}),e(r)})}return t},HR="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NsYXNzIHp7Y29uc3RydWN0b3Iocyx0LG8pe3RoaXMuY3Vtc3VtPVtdO2ZvcihsZXQgZT0wO2U8bztlKyspe3RoaXMuY3Vtc3VtLnB1c2goW10pO2ZvcihsZXQgbj0wO248dDtuKyspdGhpcy5jdW1zdW1bZV0ucHVzaCgwKX10aGlzLmN1bXN1bVswXVswXT1zWzBdO2ZvcihsZXQgZT0xO2U8dDtlKyspdGhpcy5jdW1zdW1bMF1bZV09dGhpcy5jdW1zdW1bMF1bZS0xXStzW2VdO2ZvcihsZXQgZT0xO2U8bztlKyspdGhpcy5jdW1zdW1bZV1bMF09dGhpcy5jdW1zdW1bZS0xXVswXStzW2UqdF07Zm9yKGxldCBlPTE7ZTxvO2UrKylmb3IobGV0IG49MTtuPHQ7bisrKXRoaXMuY3Vtc3VtW2VdW25dPXNbZSp0K25dK3RoaXMuY3Vtc3VtW2UtMV1bbl0rdGhpcy5jdW1zdW1bZV1bbi0xXS10aGlzLmN1bXN1bVtlLTFdW24tMV19cXVlcnkocyx0LG8sZSl7bGV0IG49dGhpcy5jdW1zdW1bZV1bb107cmV0dXJuIHQ+MCYmKG4tPXRoaXMuY3Vtc3VtW3QtMV1bb10pLHM+MCYmKG4tPXRoaXMuY3Vtc3VtW2VdW3MtMV0pLHM+MCYmdD4wJiYobis9dGhpcy5jdW1zdW1bdC0xXVtzLTFdKSxufX1jb25zdCBDPTEwLGI9MixNPTYsRj01LEk9Ljk1LEw9LjksTz0uMixaPTgsTj0yNCoyLzMsVT1yPT57Y29uc3R7ZGF0YTpzLHdpZHRoOnQsaGVpZ2h0Om8sc2NhbGU6ZX09cixuPVt0Km9dO2ZvcihsZXQgaT0wO2k8bi5sZW5ndGg7aSsrKW5baV09ITE7Y29uc3QgYT1uZXcgRmxvYXQzMkFycmF5KHMubGVuZ3RoKTtmb3IobGV0IGk9MDtpPHQ7aSsrKWFbaV09LTEsYVt0KihvLTEpK2ldPS0xO2ZvcihsZXQgaT0wO2k8bztpKyspYVtpKnRdPS0xLGFbaSp0K3QtMV09LTE7Zm9yKGxldCBpPTE7aTx0LTE7aSsrKWZvcihsZXQgcD0xO3A8by0xO3ArKyl7bGV0IGY9aSt0KnAsaD0wLGM9MDtmb3IobGV0IHU9LTE7dTw9MTt1KyspaCs9c1tmK3QqdSsxXS1zW2YrdCp1LTFdLGMrPXNbZit0K3VdLXNbZi10K3VdO2gvPTMqMjU2LGMvPTMqMjU2LGFbZl09TWF0aC5zcXJ0KChoKmgrYypjKS8yKX1jb25zdCBnPW5ldyBVaW50MzJBcnJheSgxZTMpO2ZvcihsZXQgaT0wO2k8MWUzO2krKylnW2ldPTA7Y29uc3QgZD1bLTEsMSwtdCx0XTtmb3IobGV0IGk9MTtpPHQtMTtpKyspZm9yKGxldCBwPTE7cDxvLTE7cCsrKXtsZXQgZj1pK3QqcCxoPSEwO2ZvcihsZXQgYz0wO2M8ZC5sZW5ndGg7YysrKWlmKGFbZl08PWFbZitkW2NdXSl7aD0hMTticmVha31pZihoKXtsZXQgYz1NYXRoLmZsb29yKGFbZl0qMWUzKTtjPjk5OSYmKGM9OTk5KSxjPDAmJihjPTApLGdbY10rPTEsbltmXT0hMH19Y29uc3Qgdz0uMDIqdCpvO2xldCBqPTk5OSxFPTA7Zm9yKDtqPj0wJiYoRSs9Z1tqXSwhKEU+dykpOylqLS07Zm9yKGxldCBpPTA7aTxuLmxlbmd0aDtpKyspbltpXSYmYVtpXSoxZTM8aiYmKG5baV09ITEpO2NvbnN0IGw9W107Zm9yKGxldCBpPTA7aTxzLmxlbmd0aDtpKyspbFtpXT1zW2ldKnNbaV07Y29uc3QgUz1uZXcgeihzLHQsbyksRD1uZXcgeihsLHQsbyksaz1uZXcgRmxvYXQzMkFycmF5KHMubGVuZ3RoKTtmb3IobGV0IGk9MDtpPHQ7aSsrKWZvcihsZXQgcD0wO3A8bztwKyspe2NvbnN0IGY9cCp0K2k7aWYoIW5bZl0pe2tbZl09MTtjb250aW51ZX1jb25zdCBoPVAoe2ltYWdlOnIsY3g6aSxjeTpwLHNkVGhyZXNoOkYsaW1hZ2VEYXRhQ3Vtc3VtOlMsaW1hZ2VEYXRhU3FyQ3Vtc3VtOkR9KTtpZihoPT09bnVsbCl7a1tmXT0xO2NvbnRpbnVlfWxldCBjPS0xO2ZvcihsZXQgdT0tQzt1PD1DO3UrKyl7Zm9yKGxldCBtPS1DO208PUM7bSsrKXtpZihtKm0rdSp1PD1iKmIpY29udGludWU7Y29uc3QgeD1SKHtpbWFnZTpyLGN4OmkrbSxjeTpwK3UsdmxlbjpoLHR4OmksdHk6cCxpbWFnZURhdGFDdW1zdW06UyxpbWFnZURhdGFTcXJDdW1zdW06RH0pO2lmKHghPT1udWxsJiZ4PmMmJihjPXgsYz5JKSlicmVha31pZihjPkkpYnJlYWt9a1tmXT1jfXJldHVybiBWKHtpbWFnZTpyLGZlYXR1cmVNYXA6ayx0ZW1wbGF0ZVNpemU6TSxzZWFyY2hTaXplOmIsb2NjU2l6ZTpOLG1heFNpbVRocmVzaDpMLG1pblNpbVRocmVzaDpPLHNkVGhyZXNoOlosaW1hZ2VEYXRhQ3Vtc3VtOlMsaW1hZ2VEYXRhU3FyQ3Vtc3VtOkR9KX0sVj1yPT57bGV0e2ltYWdlOnMsZmVhdHVyZU1hcDp0LHRlbXBsYXRlU2l6ZTpvLHNlYXJjaFNpemU6ZSxvY2NTaXplOm4sbWF4U2ltVGhyZXNoOmEsbWluU2ltVGhyZXNoOmcsc2RUaHJlc2g6ZCxpbWFnZURhdGFDdW1zdW06dyxpbWFnZURhdGFTcXJDdW1zdW06an09cjtjb25zdHtkYXRhOkUsd2lkdGg6bCxoZWlnaHQ6UyxzY2FsZTpEfT1zO249TWF0aC5mbG9vcihNYXRoLm1pbihzLndpZHRoLHMuaGVpZ2h0KS8xMCk7Y29uc3Qgaz0obyoyKzEpKjMsQT1NYXRoLmZsb29yKGwvayksaT1NYXRoLmZsb29yKFMvayk7bGV0IHA9TWF0aC5mbG9vcihsL24pKk1hdGguZmxvb3IoUy9uKStBKmk7Y29uc3QgZj1bXSxoPW5ldyBGbG9hdDMyQXJyYXkoRS5sZW5ndGgpO2ZvcihsZXQgdT0wO3U8aC5sZW5ndGg7dSsrKWhbdV09dFt1XTtsZXQgYz0wO2Zvcig7YzxwOyl7bGV0IHU9YSxtPS0xLHg9LTE7Zm9yKGxldCB5PTA7eTxTO3krKylmb3IobGV0IFQ9MDtUPGw7VCsrKWhbeSpsK1RdPHUmJih1PWhbeSpsK1RdLG09VCx4PXkpO2lmKG09PT0tMSlicmVhaztjb25zdCB2PVAoe2ltYWdlOnMsY3g6bSxjeTp4LHNkVGhyZXNoOjAsaW1hZ2VEYXRhQ3Vtc3VtOncsaW1hZ2VEYXRhU3FyQ3Vtc3VtOmp9KTtpZih2PT09bnVsbCl7aFt4KmwrbV09MTtjb250aW51ZX1pZih2LyhvKjIrMSk8ZCl7aFt4KmwrbV09MTtjb250aW51ZX1sZXQgcT0xLF89LTE7Zm9yKGxldCB5PS1lO3k8PWU7eSsrKXtmb3IobGV0IFQ9LWU7VDw9ZTtUKyspe2lmKFQqVCt5Knk+ZSplfHxUPT09MCYmeT09PTApY29udGludWU7Y29uc3QgSD1SKHtpbWFnZTpzLHZsZW46dixjeDptK1QsY3k6eCt5LHR4Om0sdHk6eCxpbWFnZURhdGFDdW1zdW06dyxpbWFnZURhdGFTcXJDdW1zdW06an0pO2lmKEghPT1udWxsJiYoSDxxJiYocT1ILHE8ZyYmcTx1KXx8SD5fJiYoXz1ILF8+Ljk5KSkpYnJlYWt9aWYocTxnJiZxPHV8fF8+Ljk5KWJyZWFrfWlmKHE8ZyYmcTx1fHxfPi45OSl7aFt4KmwrbV09MTtjb250aW51ZX1mLnB1c2goe3g6bSx5Onh9KSxjKz0xO2ZvcihsZXQgeT0tbjt5PD1uO3krKylmb3IobGV0IFQ9LW47VDw9bjtUKyspeCt5PDB8fHgreT49U3x8bStUPDB8fG0rVD49bHx8KGhbKHgreSkqbCsobStUKV09MSl9cmV0dXJuIGZ9LFA9KHtpbWFnZTpyLGN4OnMsY3k6dCxzZFRocmVzaDpvLGltYWdlRGF0YUN1bXN1bTplLGltYWdlRGF0YVNxckN1bXN1bTpufSk9PntpZihzLU08MHx8cytNPj1yLndpZHRofHx0LU08MHx8dCtNPj1yLmhlaWdodClyZXR1cm4gbnVsbDtjb25zdCBhPTIqTSsxLGc9YSphO2xldCBkPWUucXVlcnkocy1NLHQtTSxzK00sdCtNKTtkLz1nO2xldCB3PW4ucXVlcnkocy1NLHQtTSxzK00sdCtNKTtyZXR1cm4gdy09MipkKmUucXVlcnkocy1NLHQtTSxzK00sdCtNKSx3Kz1nKmQqZCx3L2c8bypvP251bGw6KHc9TWF0aC5zcXJ0KHcpLHcpfSxSPXI9Pntjb25zdHtpbWFnZTpzLGN4OnQsY3k6byx2bGVuOmUsdHg6bix0eTphLGltYWdlRGF0YUN1bXN1bTpnLGltYWdlRGF0YVNxckN1bXN1bTpkfT1yLHtkYXRhOncsd2lkdGg6aixoZWlnaHQ6RX09cyxsPU07aWYodC1sPDB8fHQrbD49anx8by1sPDB8fG8rbD49RSlyZXR1cm4gbnVsbDtjb25zdCBTPTIqbCsxO2xldCBEPWcucXVlcnkodC1sLG8tbCx0K2wsbytsKSxrPWQucXVlcnkodC1sLG8tbCx0K2wsbytsKSxBPTAsaT0oby1sKSpqKyh0LWwpLHA9KGEtbCkqaisobi1sKSxmPWotUztmb3IobGV0IG09MDttPFM7bSsrKXtmb3IobGV0IHg9MDt4PFM7eCsrKUErPXdbaV0qd1twXSxpKz0xLHArPTE7aSs9ZixwKz1mfWxldCBoPWcucXVlcnkobi1sLGEtbCxuK2wsYStsKTtoLz1TKlMsQS09aCpEO2xldCBjPWstRCpELyhTKlMpO3JldHVybiBjPT0wP251bGw6KGM9TWF0aC5zcXJ0KGMpLDEqQS8oZSpjKSl9LFc9KHIscyk9Pntjb25zdCB0PVtdO2ZvcihsZXQgbz0wO288ci5sZW5ndGg7bysrKXtjb25zdCBlPXJbb10sbj1VKGUpLGE9e2RhdGE6ZS5kYXRhLHNjYWxlOmUuc2NhbGUsd2lkdGg6ZS53aWR0aCxoZWlnaHQ6ZS5oZWlnaHQscG9pbnRzOm59O3QucHVzaChhKSxzKG8pfXJldHVybiB0fSxYPSh7aW1hZ2U6cixyYXRpbzpzfSk9Pntjb25zdCB0PU1hdGgucm91bmQoci53aWR0aCpzKSxvPU1hdGgucm91bmQoci5oZWlnaHQqcyksZT1uZXcgVWludDhBcnJheSh0Km8pO2ZvcihsZXQgbj0wO248dDtuKyspe2xldCBhPU1hdGgucm91bmQoMSpuL3MpLGc9TWF0aC5yb3VuZCgxKihuKzEpL3MpLTE7Zz49ci53aWR0aCYmKGc9ci53aWR0aC0xKTtmb3IobGV0IGQ9MDtkPG87ZCsrKXtsZXQgdz1NYXRoLnJvdW5kKDEqZC9zKSxqPU1hdGgucm91bmQoMSooZCsxKS9zKS0xO2o+PXIuaGVpZ2h0JiYoaj1yLmhlaWdodC0xKTtsZXQgRT0wLGw9MDtmb3IobGV0IFM9YTtTPD1nO1MrKylmb3IobGV0IEQ9dztEPD1qO0QrKylFKz0xKnIuZGF0YVtEKnIud2lkdGgrU10sbCs9MTtlW2QqdCtuXT1NYXRoLmZsb29yKEUvbCl9fXJldHVybntkYXRhOmUsd2lkdGg6dCxoZWlnaHQ6b319LFk9cj0+e2NvbnN0IHM9TWF0aC5taW4oci53aWR0aCxyLmhlaWdodCksdD1bXSxvPVtdO3QucHVzaCgyNTYvcyksdC5wdXNoKDEyOC9zKTtmb3IobGV0IGU9MDtlPHQubGVuZ3RoO2UrKylvLnB1c2goT2JqZWN0LmFzc2lnbihYKHtpbWFnZTpyLHJhdGlvOnRbZV19KSx7c2NhbGU6dFtlXX0pKTtyZXR1cm4gb307b25tZXNzYWdlPXI9Pntjb25zdHtkYXRhOnN9PXI7aWYocy50eXBlPT09ImNvbXBpbGUiKXtjb25zdHt0YXJnZXRJbWFnZXM6dH09cyxvPTEwMC90Lmxlbmd0aDtsZXQgZT0wO2NvbnN0IG49W107Zm9yKGxldCBhPTA7YTx0Lmxlbmd0aDthKyspe2NvbnN0IGc9dFthXSxkPVkoZyksdz1vL2QubGVuZ3RoLGo9VyhkLEU9PntlKz13LHBvc3RNZXNzYWdlKHt0eXBlOiJwcm9ncmVzcyIscGVyY2VudDplfSl9KTtuLnB1c2goail9cG9zdE1lc3NhZ2Uoe3R5cGU6ImNvbXBpbGVEb25lIixsaXN0Om59KX19fSkoKTsK",UR=typeof window<"u"&&window.Blob&&new Blob([atob(HR)],{type:"text/javascript;charset=utf-8"});function Wne(n){let e;try{if(e=UR&&(window.URL||window.webkitURL).createObjectURL(UR),!e)throw"";const t=new Worker(e,{name:n==null?void 0:n.name});return t.addEventListener("error",()=>{(window.URL||window.webkitURL).revokeObjectURL(e)}),t}catch{return new Worker("data:application/javascript;base64,"+HR,{name:n==null?void 0:n.name})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}class jR extends Gne{createProcessCanvas(e){const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t}compileTrack({progressCallback:e,targetImages:t,basePercent:r}){return new Promise((s,i)=>{const l=new Wne;l.onmessage=u=>{u.data.type==="progress"?e(r+u.data.percent*r/100):u.data.type==="compileDone"&&s(u.data.list)},l.postMessage({type:"compile",targetImages:t})})}}class Mne{constructor(e,t){this.width=e,this.height=t,this.texShape=[t,e];const r=document.createElement("canvas").getContext("2d");r.canvas.width=e,r.canvas.height=t,this.context=r,this.program=this.buildProgram(e,t);const s=Ka();this.tempPixelHandle=s.makeTensorInfo(this.texShape,"float32"),s.texData.get(this.tempPixelHandle.dataId).usage=2}_loadInput(e){return ee(()=>{let t=wX(e);return t=t.mean(2),t})}loadInput(e){const t=this.context;if(t.clearRect(0,0,this.context.canvas.width,this.context.canvas.height),e.width===this.height&&e.height===this.width){let s=this.context.canvas.width/2,i=this.context.canvas.height/2;t.save(),t.translate(s,i),t.rotate(90*Math.PI/180),t.drawImage(e,-e.width/2,-e.height/2),t.restore()}else this.context.drawImage(e,0,0,e.width,e.height);const r=Ka();return r.gpgpu.uploadPixelDataToTexture(r.getTexture(this.tempPixelHandle.dataId),this.context.canvas),this._compileAndRun(this.program,[this.tempPixelHandle])}buildProgram(e,t){const r=ae().getNumber("WEBGL_VERSION")===2?"texture":"texture2D";return{variableNames:["A"],outputShape:this.texShape,userCode:`
	void main() {
	  ivec2 coords = getOutputCoords();
	  int texR = coords[0];
	  int texC = coords[1];
	  vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${e}.0, ${t}.0);

	  vec4 values = ${r}(A, uv);
	  setOutput((0.299 * values.r + 0.587 * values.g + 0.114 * values.b) * 255.0);
	}
      `}}_compileAndRun(e,t){const r=Ka().compileAndRun(e,t);return vt().makeTensorFromDataId(r.dataId,r.shape,r.dtype)}_runWebGLProgram(e,t,r){const s=Ka().runWebGLProgram(e,t,r);return vt().makeTensorFromDataId(s.dataId,s.shape,s.dtype)}}const YR=(n,e)=>{const t=2*Math.PI*e*n;return t/(t+1)},QR=(n,e,t)=>n*e+(1-n)*t;class $ne{constructor({minCutOff:e,beta:t}){this.minCutOff=e,this.beta=t,this.dCutOff=.001,this.xPrev=null,this.dxPrev=null,this.tPrev=null,this.initialized=!1}reset(){this.initialized=!1}filter(e,t){if(!this.initialized)return this.initialized=!0,this.xPrev=t,this.dxPrev=t.map(()=>0),this.tPrev=e,t;const{xPrev:r,tPrev:s,dxPrev:i}=this,l=e-s,u=YR(l,this.dCutOff),c=[],h=[],p=[];for(let m=0;m<t.length;m++){c[m]=(t[m]-r[m])/l,h[m]=QR(u,c[m],i[m]);const g=this.minCutOff+this.beta*Math.abs(h[m]),y=YR(l,g);p[m]=QR(y,t[m],r[m])}return this.xPrev=p,this.dxPrev=h,this.tPrev=e,p}}const Sx={memory:N0,nextFrame:Tp},Fne=.001,Vne=1e3,Pne=5,Xne=5;class JR{constructor({inputWidth:e,inputHeight:t,onUpdate:r=null,debugMode:s=!1,maxTrack:i=1,warmupTolerance:l=null,missTolerance:u=null,filterMinCF:c=null,filterBeta:h=null}){this.inputWidth=e,this.inputHeight=t,this.maxTrack=i,this.filterMinCF=c===null?Fne:c,this.filterBeta=h===null?Vne:h,this.warmupTolerance=l===null?Pne:l,this.missTolerance=u===null?Xne:u,this.cropDetector=new Fte(this.inputWidth,this.inputHeight,s),this.inputLoader=new Mne(this.inputWidth,this.inputHeight),this.markerDimensions=null,this.onUpdate=r,this.debugMode=s,this.processingVideo=!1,this.interestedTargetIndex=-1,this.trackingStates=[];const p=10,m=1e5,g=45*Math.PI/180,y=this.inputHeight/2/Math.tan(g/2);this.projectionTransform=[[y,0,this.inputWidth/2],[0,y,this.inputHeight/2],[0,0,1]],this.projectionMatrix=this._glProjectionMatrix({projectionTransform:this.projectionTransform,width:this.inputWidth,height:this.inputHeight,near:p,far:m}),this.worker=new Yee,this.workerMatchDone=null,this.workerTrackDone=null,this.worker.onmessage=v=>{v.data.type==="matchDone"&&this.workerMatchDone!==null&&this.workerMatchDone(v.data),v.data.type==="trackUpdateDone"&&this.workerTrackDone!==null&&this.workerTrackDone(v.data)}}showTFStats(){console.log(Sx.memory().numTensors),console.table(Sx.memory())}addImageTargets(e){return new Promise(async(t,r)=>{const s=await(await fetch(e)).arrayBuffer(),i=this.addImageTargetsFromBuffer(s);t(i)})}addImageTargetsFromBuffer(e){const t=new jR().importData(e),r=[],s=[],i=[];for(let l=0;l<t.length;l++)s.push(t[l].matchingData),r.push(t[l].trackingData),i.push([t[l].targetImage.width,t[l].targetImage.height]);return this.tracker=new ite(i,r,this.projectionTransform,this.inputWidth,this.inputHeight,this.debugMode),this.worker.postMessage({type:"setup",inputWidth:this.inputWidth,inputHeight:this.inputHeight,projectionTransform:this.projectionTransform,debugMode:this.debugMode,matchingDataList:s}),this.markerDimensions=i,{dimensions:i,matchingDataList:s,trackingDataList:r}}dispose(){this.stopProcessVideo(),this.worker.postMessage({type:"dispose"})}dummyRun(e){const t=this.inputLoader.loadInput(e);this.cropDetector.detect(t),this.tracker.dummyRun(t),t.dispose()}getProjectionMatrix(){return this.projectionMatrix}getRotatedZ90Matrix(e){return[-e[1],e[0],e[2],e[3],-e[5],e[4],e[6],e[7],-e[9],e[8],e[10],e[11],-e[13],e[12],e[14],e[15]]}getWorldMatrix(e,t){return this._glModelViewMatrix(e,t)}async _detectAndMatch(e,t){const{featurePoints:r}=this.cropDetector.detectMoving(e),{targetIndex:s,modelViewTransform:i}=await this._workerMatch(r,t);return{targetIndex:s,modelViewTransform:i}}async _trackAndUpdate(e,t,r){const{worldCoords:s,screenCoords:i}=this.tracker.track(e,t,r);return s.length<4?null:await this._workerTrackUpdate(t,{worldCoords:s,screenCoords:i})}processVideo(e){if(!this.processingVideo){this.processingVideo=!0,this.trackingStates=[];for(let t=0;t<this.markerDimensions.length;t++)this.trackingStates.push({showing:!1,isTracking:!1,currentModelViewTransform:null,trackCount:0,trackMiss:0,filter:new $ne({minCutOff:this.filterMinCF,beta:this.filterBeta})});(async()=>{for(;this.processingVideo;){const t=this.inputLoader.loadInput(e);if(this.trackingStates.reduce((r,s)=>r+(s.isTracking?1:0),0)<this.maxTrack){const r=[];for(let l=0;l<this.trackingStates.length;l++)this.trackingStates[l].isTracking!==!0&&(this.interestedTargetIndex!==-1&&this.interestedTargetIndex!==l||r.push(l));const{targetIndex:s,modelViewTransform:i}=await this._detectAndMatch(t,r);s!==-1&&(this.trackingStates[s].isTracking=!0,this.trackingStates[s].currentModelViewTransform=i)}for(let r=0;r<this.trackingStates.length;r++){const s=this.trackingStates[r];if(s.isTracking){let i=await this._trackAndUpdate(t,s.currentModelViewTransform,r);i===null?s.isTracking=!1:s.currentModelViewTransform=i}if(s.showing||s.isTracking&&(s.trackMiss=0,s.trackCount+=1,s.trackCount>this.warmupTolerance&&(s.showing=!0,s.trackingMatrix=null,s.filter.reset())),s.showing&&(s.isTracking?s.trackMiss=0:(s.trackCount=0,s.trackMiss+=1,s.trackMiss>this.missTolerance&&(s.showing=!1,s.trackingMatrix=null,this.onUpdate&&this.onUpdate({type:"updateMatrix",targetIndex:r,worldMatrix:null})))),s.showing){const i=this._glModelViewMatrix(s.currentModelViewTransform,r);s.trackingMatrix=s.filter.filter(Date.now(),i);let l=[];for(let u=0;u<s.trackingMatrix.length;u++)l[u]=s.trackingMatrix[u];e.width===this.inputHeight&&e.height===this.inputWidth&&(l=this.getRotatedZ90Matrix(l)),this.onUpdate&&this.onUpdate({type:"updateMatrix",targetIndex:r,worldMatrix:l})}}t.dispose(),this.onUpdate&&this.onUpdate({type:"processDone"}),await Sx.nextFrame()}})()}}stopProcessVideo(){this.processingVideo=!1}async detect(e){const t=this.inputLoader.loadInput(e),{featurePoints:r,debugExtra:s}=await this.cropDetector.detect(t);return t.dispose(),{featurePoints:r,debugExtra:s}}async match(e,t){const{modelViewTransform:r,debugExtra:s}=await this._workerMatch(e,[t]);return{modelViewTransform:r,debugExtra:s}}async track(e,t,r){const s=this.inputLoader.loadInput(e),i=this.tracker.track(s,t,r);return s.dispose(),i}async trackUpdate(e,t){return t.worldCoords.length<4?null:await this._workerTrackUpdate(e,t)}_workerMatch(e,t){return new Promise(async(r,s)=>{this.workerMatchDone=i=>{r({targetIndex:i.targetIndex,modelViewTransform:i.modelViewTransform,debugExtra:i.debugExtra})},this.worker.postMessage({type:"match",featurePoints:e,targetIndexes:t})})}_workerTrackUpdate(e,t){return new Promise(async(r,s)=>{this.workerTrackDone=u=>{r(u.modelViewTransform)};const{worldCoords:i,screenCoords:l}=t;this.worker.postMessage({type:"trackUpdate",modelViewTransform:e,worldCoords:i,screenCoords:l})})}_glModelViewMatrix(e,t){const r=this.markerDimensions[t][1];return[e[0][0],-e[1][0],-e[2][0],0,-e[0][1],e[1][1],e[2][1],0,-e[0][2],e[1][2],e[2][2],0,e[0][1]*r+e[0][3],-(e[1][1]*r+e[1][3]),-(e[2][1]*r+e[2][3]),1]}_glProjectionMatrix({projectionTransform:e,width:t,height:r,near:s,far:i}){const l=[[2*e[0][0]/t,0,-(2*e[0][2]/t-1),0],[0,2*e[1][1]/r,-(2*e[1][2]/r-1),0],[0,0,-(i+s)/(i-s),-2*i*s/(i-s)],[0,0,-1,0]],u=[];for(let c=0;c<4;c++)for(let h=0;h<4;h++)u.push(l[h][c]);return u}}const One=`<div class="mindar-ui-overlay mindar-ui-loading">
  <div class="loader"/>
</div>
`,Dne=`<div class="mindar-ui-overlay mindar-ui-compatibility">
  <div class="content">
    <h1>Failed to launch :(</h1>
    <p>
      Looks like your device/browser is not compatible.
    </p>

    <br/>
    <br/>
    <p>
      Please try the following recommended browsers:
    </p>
    <p>
      For Android device - Chrome
    </p>
    <p>
      For iOS device - Safari
    </p>
  </div>
</div>
`,Ane=`<div class="mindar-ui-overlay mindar-ui-scanning">
  <div class="scanning">
    <div class="inner">
      <div class="scanline"/>
    </div>
  </div>
</div>
`,Kne=".mindar-ui-overlay{display:flex;align-items:center;justify-content:center;position:absolute;left:0;right:0;top:0;bottom:0;background:transparent;z-index:2}.mindar-ui-overlay.hidden{display:none}.mindar-ui-loading .loader{border:16px solid #222;border-top:16px solid white;opacity:.8;border-radius:50%;width:120px;height:120px;animation:spin 2s linear infinite}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.mindar-ui-compatibility .content{background:black;color:#fff;opacity:.8;text-align:center;margin:20px;padding:20px;min-height:50vh}@media (min-aspect-ratio: 1/1){.mindar-ui-scanning .scanning{width:50vh;height:50vh}}@media (max-aspect-ratio: 1/1){.mindar-ui-scanning .scanning{width:80vw;height:80vw}}.mindar-ui-scanning .scanning .inner{position:relative;width:100%;height:100%;opacity:.8;background:linear-gradient(to right,white 10px,transparent 10px) 0 0,linear-gradient(to right,white 10px,transparent 10px) 0 100%,linear-gradient(to left,white 10px,transparent 10px) 100% 0,linear-gradient(to left,white 10px,transparent 10px) 100% 100%,linear-gradient(to bottom,white 10px,transparent 10px) 0 0,linear-gradient(to bottom,white 10px,transparent 10px) 100% 0,linear-gradient(to top,white 10px,transparent 10px) 0 100%,linear-gradient(to top,white 10px,transparent 10px) 100% 100%;background-repeat:no-repeat;background-size:40px 40px}.mindar-ui-scanning .scanning .inner .scanline{position:absolute;width:100%;height:10px;background:white;animation:move 2s linear infinite}@keyframes move{0%,to{top:0%}50%{top:calc(100% - 10px)}}";class qR{constructor({uiLoading:e,uiScanning:t,uiError:r}){const s=document.createElement("style");s.innerText=Kne,document.head.appendChild(s),e==="yes"?this.loadingModal=this._loadHTML(One):e!=="no"&&(this.loadingModal=document.querySelector(e)),r==="yes"?this.compatibilityModal=this._loadHTML(Dne):r!=="no"&&(this.compatibilityModal=document.querySelector(r)),t==="yes"?this.scanningMask=this._loadHTML(Ane):t!=="no"&&(this.scanningMask=document.querySelector(t)),this.hideLoading(),this.hideCompatibility(),this.hideScanning()}showLoading(){this.loadingModal&&this.loadingModal.classList.remove("hidden")}hideLoading(){this.loadingModal&&this.loadingModal.classList.add("hidden")}showCompatibility(){this.compatibilityModal&&this.compatibilityModal.classList.remove("hidden")}hideCompatibility(){this.compatibilityModal&&this.compatibilityModal.classList.add("hidden")}showScanning(){this.scanningMask&&this.scanningMask.classList.remove("hidden")}hideScanning(){this.scanningMask&&this.scanningMask.classList.add("hidden")}_loadHTML(e){const t=document.createElement("template");t.innerHTML=e.trim();const r=t.content.firstChild;return document.getElementsByTagName("body")[0].appendChild(r),r}}window.MINDAR||(window.MINDAR={}),window.MINDAR.IMAGE={Controller:JR,Compiler:jR,UI:qR},AFRAME.registerSystem("mindar-image-system",{container:null,video:null,processingImage:!1,init:function(){this.anchorEntities=[]},tick:function(){},setup:function({imageTargetSrc:n,maxTrack:e,showStats:t,uiLoading:r,uiScanning:s,uiError:i,missTolerance:l,warmupTolerance:u,filterMinCF:c,filterBeta:h}){this.imageTargetSrc=n,this.maxTrack=e,this.filterMinCF=c,this.filterBeta=h,this.missTolerance=l,this.warmupTolerance=u,this.showStats=t,this.ui=new qR({uiLoading:r,uiScanning:s,uiError:i})},registerAnchor:function(n,e){this.anchorEntities.push({el:n,targetIndex:e})},start:function(){this.container=this.el.sceneEl.parentNode,this.showStats&&(this.mainStats=new Stats,this.mainStats.showPanel(0),this.mainStats.domElement.style.cssText="position:absolute;top:0px;left:0px;z-index:999",this.container.appendChild(this.mainStats.domElement)),this.ui.showLoading(),this._startVideo()},switchTarget:function(n){this.controller.interestedTargetIndex=n},stop:function(){this.pause(),this.video.srcObject.getTracks().forEach(function(n){n.stop()}),this.video.remove(),this.controller.dispose()},pause:function(n=!1){n||this.video.pause(),this.controller.stopProcessVideo()},unpause:function(){this.video.play(),this.controller.processVideo(this.video)},_startVideo:function(){if(this.video=document.createElement("video"),this.video.setAttribute("autoplay",""),this.video.setAttribute("muted",""),this.video.setAttribute("playsinline",""),this.video.style.position="absolute",this.video.style.top="0px",this.video.style.left="0px",this.video.style.zIndex="-2",this.container.appendChild(this.video),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){this.el.emit("arError",{error:"VIDEO_FAIL"}),this.ui.showCompatibility();return}navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}}).then(n=>{this.video.addEventListener("loadedmetadata",()=>{this.video.setAttribute("width",this.video.videoWidth),this.video.setAttribute("height",this.video.videoHeight),this._startAR()}),this.video.srcObject=n}).catch(n=>{console.log("getUserMedia error",n),this.el.emit("arError",{error:"VIDEO_FAIL"})})},_startAR:async function(){const n=this.video;this.container,this.controller=new JR({inputWidth:n.videoWidth,inputHeight:n.videoHeight,maxTrack:this.maxTrack,filterMinCF:this.filterMinCF,filterBeta:this.filterBeta,missTolerance:this.missTolerance,warmupTolerance:this.warmupTolerance,onUpdate:t=>{if(t.type==="processDone")this.mainStats&&this.mainStats.update();else if(t.type==="updateMatrix"){const{targetIndex:r,worldMatrix:s}=t;for(let i=0;i<this.anchorEntities.length;i++)this.anchorEntities[i].targetIndex===r&&this.anchorEntities[i].el.updateWorldMatrix(s);this.anchorEntities.reduce((i,l)=>i||l.el.el.object3D.visible,!1)?this.ui.hideScanning():this.ui.showScanning()}}}),this._resize(),window.addEventListener("resize",this._resize.bind(this));const{dimensions:e}=await this.controller.addImageTargets(this.imageTargetSrc);for(let t=0;t<this.anchorEntities.length;t++){const{el:r,targetIndex:s}=this.anchorEntities[t];s<e.length&&r.setupMarker(e[s])}await this.controller.dummyRun(this.video),this.el.emit("arReady"),this.ui.hideLoading(),this.ui.showScanning(),this.controller.processVideo(this.video)},_resize:function(){const n=this.video,e=this.container;let t,r;const s=n.videoWidth/n.videoHeight,i=e.clientWidth/e.clientHeight;s>i?(r=e.clientHeight,t=r*s):(t=e.clientWidth,r=t/s);const l=this.controller.getProjectionMatrix(),u=2*Math.atan(1/l[5]/r*e.clientHeight)*180/Math.PI,c=l[14]/(l[10]-1),h=l[14]/(l[10]+1);l[5]/l[0];const p=e.clientWidth/e.clientHeight,m=e.getElementsByTagName("a-camera")[0].getObject3D("camera");m.fov=u,m.aspect=p,m.near=c,m.far=h,m.updateProjectionMatrix(),this.video.style.top=-(r-e.clientHeight)/2+"px",this.video.style.left=-(t-e.clientWidth)/2+"px",this.video.style.width=t+"px",this.video.style.height=r+"px"}}),AFRAME.registerComponent("mindar-image",{dependencies:["mindar-image-system"],schema:{imageTargetSrc:{type:"string"},maxTrack:{type:"int",default:1},filterMinCF:{type:"number",default:-1},filterBeta:{type:"number",default:-1},missTolerance:{type:"int",default:-1},warmupTolerance:{type:"int",default:-1},showStats:{type:"boolean",default:!1},autoStart:{type:"boolean",default:!0},uiLoading:{type:"string",default:"yes"},uiScanning:{type:"string",default:"yes"},uiError:{type:"string",default:"yes"}},init:function(){const n=this.el.sceneEl.systems["mindar-image-system"];n.setup({imageTargetSrc:this.data.imageTargetSrc,maxTrack:this.data.maxTrack,filterMinCF:this.data.filterMinCF===-1?null:this.data.filterMinCF,filterBeta:this.data.filterBeta===-1?null:this.data.filterBeta,missTolerance:this.data.missTolerance===-1?null:this.data.missTolerance,warmupTolerance:this.data.warmupTolerance===-1?null:this.data.warmupTolerance,showStats:this.data.showStats,uiLoading:this.data.uiLoading,uiScanning:this.data.uiScanning,uiError:this.data.uiError}),this.data.autoStart&&this.el.sceneEl.addEventListener("renderstart",()=>{n.start()})},remove:function(){this.el.sceneEl.systems["mindar-image-system"].stop()}}),AFRAME.registerComponent("mindar-image-target",{dependencies:["mindar-image-system"],schema:{targetIndex:{type:"number"}},postMatrix:null,init:function(){this.el.sceneEl.systems["mindar-image-system"].registerAnchor(this,this.data.targetIndex),this.invisibleMatrix=new AFRAME.THREE.Matrix4().set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const n=this.el.object3D;n.visible=!1,n.matrixAutoUpdate=!1,n.matrix=this.invisibleMatrix},setupMarker([n,e]){const t=new AFRAME.THREE.Vector3,r=new AFRAME.THREE.Quaternion,s=new AFRAME.THREE.Vector3;t.x=n/2,t.y=n/2+(e-n)/2,s.x=n,s.y=n,s.z=n,this.postMatrix=new AFRAME.THREE.Matrix4,this.postMatrix.compose(t,r,s)},updateWorldMatrix(n){if(this.el.emit("targetUpdate"),!this.el.object3D.visible&&n!==null?this.el.emit("targetFound"):this.el.object3D.visible&&n===null&&this.el.emit("targetLost"),this.el.object3D.visible=n!==null,n===null){this.el.object3D.matrix=this.invisibleMatrix;return}var e=new AFRAME.THREE.Matrix4;e.elements=n,e.multiply(this.postMatrix),this.el.object3D.matrix=e}})})();const Que=({videoUrl:a,targetFile:o})=>{const d=Q.useRef(null),[f,b]=Q.useState("Initializing..."),[x,k]=Q.useState(null),[N,E]=Q.useState(!1),[z,W]=Q.useState(!o),[T,A]=Q.useState(a),[Y,M]=Q.useState(o),[B,H]=Q.useState(1);Q.useEffect(()=>{if(o&&a){A(a),M(o),W(!1);return}const ie=new URLSearchParams(window.location.search).get("id");if(!ie){k("ID topilmadi. Havola noto'g'ri."),W(!1);return}(async()=>{console.log(" Fetching Gift Data:",ie),b("Yuklanmoqda...");try{const fe=await fetch(`/api/gifts/${ie}`),ge=await fe.json();if(!fe.ok)throw new Error(ge.error||"Gift not found");A((Ve=>!Ve||!Ve.includes("cloudinary.com")?Ve:Ve.includes("/upload/")?Ve.replace("/upload/","/upload/f_auto,q_auto/"):Ve)(ge.videoUrl)),M(ge.targetFile)}catch(fe){console.error("Fetch Error:",fe),k(fe.message)}finally{W(!1)}})()},[o,a]);const O=()=>{const X=document.getElementById("gift-video");X?(console.log(" Unlocking video playback..."),X.muted=!1,X.play().then(()=>{X.pause(),X.currentTime=0,console.log(" Video unlocked successfully."),E(!0)}).catch(ie=>{console.error(" Unlock failed:",ie),alert("Videoni ochib bo'lmadi: "+ie.message)})):E(!0)};Q.useEffect(()=>{if(!N||!Y)return;console.log(" Mounting AR Scene (Optimized)...");const X=d.current,ie=document.getElementById("gift-video");if(!X||!ie)return;const oe=()=>{console.log(" AR System Ready"),b("Kamera Tayyor - Marker qidiring")},fe=be=>{var Ve;console.error("AR Error:",be),k("Kamera xatosi: "+(((Ve=be.detail)==null?void 0:Ve.error)||"Unknown"))};X.addEventListener("arReady",oe),X.addEventListener("arError",fe);const ge=()=>{const be=document.querySelector("[mindar-image-target]");if(!be){setTimeout(ge,100);return}console.log(" Target Entity Found - Attaching Listeners"),be.addEventListener("targetFound",()=>{console.log(" TARGET FOUND - FORCING PLAY"),b("Playing..."),ie.paused&&ie.play().catch(Ve=>console.error("Force Play Error:",Ve))}),be.addEventListener("targetLost",()=>{console.log(" TARGET LOST - PAUSING"),b("Qidirilmoqda..."),ie.pause()})};return ge(),()=>{X.removeEventListener("arReady",oe),X.removeEventListener("arError",fe)}},[N,Y]);const P=X=>{const ie=X.target;if(ie.videoWidth&&ie.videoHeight){const oe=ie.videoHeight/ie.videoWidth;console.log(` Video Aspect Ratio: ${oe}`),H(oe)}};return z?te.jsxs("div",{style:El.fullscreenCenter,children:[te.jsx("div",{className:"loader",style:El.spinner}),te.jsx("p",{style:{marginTop:"20px",color:"gold"},children:"Yuklanmoqda..."})]}):x?te.jsxs("div",{style:El.fullscreenCenter,children:[te.jsx("h2",{style:{color:"red"},children:" XATOLIK"}),te.jsx("p",{children:x}),te.jsx("button",{onClick:()=>window.location.reload(),style:El.btn,children:"Qayta Yuklash"})]}):N?te.jsxs("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",zIndex:999},children:[te.jsx("style",{dangerouslySetInnerHTML:{__html:`
                html, body { margin: 0; padding: 0; overflow: hidden !important; width: 100%; height: 100%; }
                video#gift-video { opacity: 0; position:absolute; z-index:-10; } 
                .mindar-ui-overlay { display: none !important; }
            `}}),te.jsx("div",{style:{position:"absolute",top:20,left:"50%",transform:"translateX(-50%)",zIndex:1e3,background:"rgba(0,0,0,0.6)",padding:"8px 16px",borderRadius:"20px",color:"#fff",fontFamily:"sans-serif",fontSize:"14px",fontWeight:"bold",pointerEvents:"none",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",border:"1px solid rgba(255,255,255,0.2)"},children:f==="Kamera Tayyor - Marker qidiring"?"Kamerani RASMGA tuting":f}),te.jsxs("a-scene",{ref:d,"mindar-image":`imageTargetSrc: ${Y}; uiLoading: no; uiScanning: no; uiError: no; filterMinCF:0.0001; filterBeta: 0.001; missTolerance: 10;`,"color-space":"sRGB",renderer:"colorManagement: true, physicallyCorrectLights: false; antialias: false;","vr-mode-ui":"enabled: false","device-orientation-permission-ui":"enabled: false",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:1},embedded:!0,children:[te.jsx("a-assets",{children:te.jsx("video",{id:"gift-video",src:T,preload:"auto",playsInline:!0,"webkit-playsinline":"true",loop:!0,crossOrigin:"anonymous",onLoadedMetadata:P})}),te.jsx("a-camera",{position:"0 0 0","look-controls":"enabled: false"}),te.jsx("a-entity",{"mindar-image-target":"targetIndex: 0",children:te.jsx("a-plane",{src:"#gift-video",position:"0 0 0",height:B,width:"1",rotation:"0 0 0",opacity:"1"})})]})]}):te.jsxs("div",{style:{...El.fullscreenCenter,zIndex:9999,background:"black"},children:[te.jsx("img",{src:"/logo.png",alt:"logo",style:{width:"80px",marginBottom:"30px"}}),te.jsx("h1",{style:{color:"white",marginBottom:"10px"},children:"Tayyormisiz?"}),te.jsx("p",{style:{color:"#aaa",marginBottom:"40px"},children:"AR Camera rejimini yoqish"}),te.jsx("button",{onClick:O,style:El.bigBtn,children:"VIDEONI KO'RISH "})]})},El={fullscreenCenter:{position:"fixed",top:0,left:0,width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"black",color:"white",textAlign:"center",padding:"20px"},spinner:{width:"50px",height:"50px",border:"4px solid rgba(255,215,0,0.1)",borderTop:"4px solid #FFD700",borderRadius:"50%",animation:"spin 1s linear infinite"},btn:{marginTop:"20px",padding:"10px 20px",borderRadius:"8px",border:"none",cursor:"pointer"},bigBtn:{padding:"20px 40px",fontSize:"22px",fontWeight:"bold",background:"linear-gradient(45deg, #FFD700, #FFA500)",border:"none",borderRadius:"50px",color:"black",cursor:"pointer",boxShadow:"0 0 25px rgba(255,215,0,0.4)",transform:"scale(1)",transition:"transform 0.2s"}},FE=()=>{const[a,o]=Q.useState(""),[d,f]=Q.useState(null),[b,x]=Q.useState(""),[k,N]=Q.useState("pin"),[E,z]=Q.useState(localStorage.getItem("device_id"));Q.useEffect(()=>{if(!E){const T="dev_"+Math.random().toString(36).substr(2,9);localStorage.setItem("device_id",T),z(T)}},[]),Q.useEffect(()=>{new URLSearchParams(window.location.search).get("id")&&N("ar")},[]);const W=async T=>{var A,Y;T.preventDefault(),N("loading");try{const M=await mt.post("/api/verify-pin",{pinCode:a,deviceId:E});M.data.success&&(f(M.data.data),ia.success("Sovg'a topildi!"),setTimeout(()=>N("ar"),1e3))}catch(M){x(((Y=(A=M.response)==null?void 0:A.data)==null?void 0:Y.error)||"Xatolik"),N("pin")}};return k==="ar"?(new URLSearchParams(window.location.search).get("id"),te.jsx(Que,{videoUrl:d==null?void 0:d.videoUrl,targetFile:d==null?void 0:d.targetFile})):te.jsxs("div",{className:"min-h-screen bg-black flex items-center justify-center p-4",children:[te.jsx(xg,{}),te.jsxs("div",{className:"w-full max-w-md text-center",children:[te.jsx("img",{src:"/logo.png",alt:"logo",className:"h-24 mx-auto mb-8 opacity-80",onError:T=>T.target.style.display="none"}),k==="loading"?te.jsx("div",{className:"text-pinhan-gold animate-pulse text-xl",children:"Qidirilmoqda..."}):te.jsxs("form",{onSubmit:W,className:"space-y-4",children:[te.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"PIN KODNI KIRITING"}),te.jsx("p",{className:"text-zinc-500 mb-6 text-sm",children:"Sovg'a qutisi ustidagi kodni kiriting"}),te.jsx("input",{type:"text",maxLength:4,value:a,onChange:T=>o(T.target.value.toUpperCase()),className:"w-full bg-transparent border-b-2 border-zinc-700 text-center text-4xl font-bold text-pinhan-gold focus:border-pinhan-gold outline-none py-2 tracking-widest uppercase",placeholder:"A1B2"}),b&&te.jsx("p",{className:"text-red-500 text-sm",children:b}),te.jsx("button",{type:"submit",className:"w-full bg-zinc-800 text-white py-4 rounded-xl font-bold hover:bg-zinc-700 transition-colors",children:"KORISH"})]})]})]})},Jue=()=>te.jsx(Kie,{children:te.jsxs(xie,{children:[te.jsx(Ll,{path:"/login",element:te.jsx(mue,{})}),te.jsx(Ll,{path:"/",element:te.jsx(FE,{})}),te.jsx(Ll,{path:"/view",element:te.jsx(FE,{})}),te.jsx(Ll,{path:"/admin",element:te.jsx(ME,{roles:["admin"],children:te.jsx(_ue,{})})}),te.jsx(Ll,{path:"/shop",element:te.jsx(ME,{roles:["shop"],children:te.jsx(Bue,{})})})]})});class que extends HE.Component{constructor(o){super(o),this.state={hasError:!1}}static getDerivedStateFromError(o){return{hasError:!0}}componentDidCatch(o,d){console.error("ErrorBoundary caught an error",o,d)}render(){return this.state.hasError?te.jsxs("div",{style:{padding:"40px",textAlign:"center",background:"#000",color:"#fff",height:"100vh",display:"flex",flexDirection:"column",justifyContent:"center"},children:[te.jsx("h2",{style:{color:"#ff4444"},children:"Kechirasiz, muammo yuz berdi."}),te.jsx("p",{style:{color:"#aaa",margin:"20px 0"},children:"Sahifani qayta yuklab ko'ring yoki birozdan so'ng harakat qiling."}),te.jsx("button",{onClick:()=>window.location.reload(),style:{background:"#FFD700",border:"none",padding:"12px 24px",borderRadius:"12px",fontWeight:"bold",cursor:"pointer"},children:"QAYTA YUKLASH"})]}):this.props.children}}s1.createRoot(document.getElementById("root")).render(te.jsx(HE.StrictMode,{children:te.jsx(que,{children:te.jsx(Jue,{})})}));
